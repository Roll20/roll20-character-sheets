<input class='method-display' type='hidden' name='attr_mod_method' value='wizard'>
<div class='starfinder compendium-drop-target npcs'>
    <input type='hidden' name='attr_variant_data' value=''>
    <input type='hidden' class='wizard-display' name='attr_spell_to_drop' value=''>
    <div class='section-container wizard'>
        <button type='compendium' class='h1 section' name='attr_compendium_link'><span class='label' name='attr_spell_to_drop'></span></button>
        <div class='section-container hide-repcontrols'>
            <span class='label' data-i18n='specify spell level charmancer'>This is a variable-level spell. Which level(s) would you like to add to your sheet?</span>
            <fieldset class='repeating_variant'>
                <label class='hover-react'>
                    <input type='checkbox' name='attr_drop' value='1'>
                    <span class='label' name='attr_variant'></span>
                </label>
            </fieldset>
            <div class='button-container'>
                <button type='action' name='act_submit' data-i18n='add spell variants' data-i18n-title='spell variant title' title='Will add the checked spells to your sheet and will clear and hide this dialog'>Add Spell Variant(s)</button>
                <button type='action' name='act_cancel' data-i18n='cancel' data-i18n-title='cancel variant title' title='Clear the dialog.'>Cancel</button>
            </div>
        </div>
    </div>
    <!-- Mod wizard-->
    <input type='hidden' name='attr_item_to_mod' value=''>
    <input type='hidden' class='wizard-display' name='attr_mod_row_data' value=''>
    <div class='section-container wizard'>
        <div class='section h1 label'><span name='attr_item_to_mod'></span></div>
        <div class='section-container'>
            <span class='label span-all' data-i18n='mod wizard instructions'>This wizard will help you add bonuses and penalties to the selected buff, ability, or piece of equipment to affect your character's stats. Simply add a new row by clicking the '+' sign. Once you've added all the bonuses, click 'Add Mods'. Effects of the mods will not show on your sheet until you finish the wizard.</span>
            <div class='mod-template-container'>
                <span class='label' data-i18n='mod templates'></span>
                <select class='label input-field' name='attr_mod_template'>
                    <option value='' data-i18n='select template'>Select a Template</option>
                    <option value='armor template' data-i18n='armor template'>Armor Template</option>
                    <option value='weapon template' data-i18n='weapon template'>Weapon Template</option>
                    <option value='spell template' data-i18n='spell template'>Spell Template</option>
                    <option value='ability template' data-i18n='ability template'>Ability Template</option>
                    <option value='backpack template' data-i18n='backpack template'>Backpack Template</option>
                    <option value='global attack template' data-i18n='global attack template'>Global Attack Template</option>
                    <option value='global damage template' data-i18n='global damage template'>Global Damage Template</option>
                    <option value='global dc template' data-i18n='global dc template'>Global DC Template</option>
                </select>
            </div>
            <div class='container-header'>
                <span class='label input-field medium-input' data-i18n='mod value'>Value</span>
                <span class='label input-field medium-input' data-i18n='bonus type'>Bonus Type</span>
                <span class='label input-field medium-input' data-i18n='Attribute affected by the mod'>Affected attribute</span>
            </div>
            <fieldset class='repeating_wizard'>
                <input class='medium-input' type='text' name='attr_mod_value'>
                <input class='type-display' type='hidden' name='attr_effect_type'>
                <select class='label medium-input input-field' name='attr_effect_type'>
                    <option value='' data-i18n='untyped bonus'>Untyped Bonus</option>
                    <option value='armor ' data-i18n='armor bonus'>Armor Bonus</option>
                    <option value='circumstance ' data-i18n='circumstance bonus'>Circumstance Bonus</option>
                    <option value='divine ' data-i18n='divine bonus'>Divine Bonus</option>
                    <option value='enhancement ' data-i18n='enhancement bonus'>Enhancement Bonus</option>
                    <option value='insight ' data-i18n='insight bonus'>Insight Bonus</option>
                    <option value='luck ' data-i18n='luck bonus'>Luck Bonus</option>
                    <option value='morale ' data-i18n='morale bonus'>Morale Bonus</option>
                    <option value='racial ' data-i18n='racial bonus'>Racial Bonus</option>
                    <option value='max dex ' data-i18n='maximum dexterity'>Maximum Dexterity</option>
                    <option value='custom' data-i18n='custom bonus'>Custom Bonus</option>
                </select>
                <input class='custom-type input-field medium-input' type='text' name='attr_custom_type'>
                <input class='attribute-display' type='hidden' name='attr_affected_attribute'>
                <select class='label input-field medium-input' name='attr_affected_attribute'>
                    <option value='' data-i18n='choose attribute'>Choose Attribute</option>
                    <option value='strength' data-i18n='strength'></option>
                    <option value='dexterity' data-i18n='dexterity'></option>
                    <option value='constitution' data-i18n='constitution'></option>
                    <option value='intelligence' data-i18n='intelligence'></option>
                    <option value='wisdom' data-i18n='wisdom'></option>
                    <option value='charisma' data-i18n='charisma'></option>
                    <option value='initiative' data-i18n='initiative'></option>
                    <option value='sp' data-i18n='sp'></option>
                    <option value='hp' data-i18n='hp'></option>
                    <option value='rp' data-i18n='rp'></option>
                    <option value='temp_hp' data-i18n='temp-hp'></option>
                    <option value='armor' data-i18n='ac'></option>
                    <option value='acp' data-i18n='armor check penalty'></option>
                    <option value='eac' data-i18n='eac'></option>
                    <option value='kac' data-i18n='kac'></option>
                    <option value='cmd' data-i18n='cmd'></option>
                    <option value='saves' data-i18n='all-saves'></option>
                    <option value='fort' data-i18n='fort-save'></option>
                    <option value='ref' data-i18n='ref-save'></option>
                    <option value='will' data-i18n='will-save'></option>
                    <option value='skill points' data-i18n='skill points'></option>
                    <option value='skills' data-i18n='skills'></option>
                    <option value='acrobatics' data-i18n='acrobatics'></option>
                    <option value='athletics' data-i18n='athletics'></option>
                    <option value='bluff' data-i18n='bluff'></option>
                    <option value='computers' data-i18n='computers'></option>
                    <option value='culture' data-i18n='culture'></option>
                    <option value='diplomacy' data-i18n='diplomacy'></option>
                    <option value='disguise' data-i18n='disguise'></option>
                    <option value='engineering' data-i18n='engineering'></option>
                    <option value='intimidate' data-i18n='intimidate'></option>
                    <option value='life science' data-i18n='life-science'></option>
                    <option value='medicine' data-i18n='medicine'></option>
                    <option value='mysticism' data-i18n='mysticism'></option>
                    <option value='perception' data-i18n='perception'></option>
                    <option value='physical science' data-i18n='physical-science'></option>
                    <option value='piloting' data-i18n='piloting'></option>
                    <option value='profession' data-i18n='profession'></option>
                    <option value='sense motive' data-i18n='sense-motive'></option>
                    <option value='sleight of hand' data-i18n='sleight-of-hand'></option>
                    <option value='stealth' data-i18n='stealth'></option>
                    <option value='survival' data-i18n='survival'></option>
                    <option value='attack' data-i18n='attack'></option>
                    <option value='attack|section:attack' data-i18n='weapon attacks'></option>
                    <option value='attack|section:attack,engagement_range:melee' data-i18n='melee weapon attacks'></option>
                    <option value='attack|section:attack,engagement_range:ranged' data-i18n='ranged weapon attacks'></option>
                    <option value='attack|section:spell' data-i18n='spell attacks'></option>
                    <option value='attack|section:ability' data-i18n='ability attacks'></option>
                    <option value='damage' data-i18n='damage'></option>
                    <option value='damage|section:attack' data-i18n='weapon damage'></option>
                    <option value='damage|section:spell' data-i18n='spell damage'></option>
                    <option value='damage|section:ability' data-i18n='ability damage'></option>
                    <option value='encumber bulk' data-i18n='encumber bulk'></option>
                    <option value='overburden bulk' data-i18n='overburden bulk'></option>
                    <option value='dc' data-i18n='dc'></option>
                    <option value='dc|section:ability' data-i18n='ability dc'></option>
                    <option value='dc|section:spell' data-i18n='spell dc'></option>
                    <option value='caster level' data-i18n='caster-level_'></option>
                    <option value='spell penetration' data-i18n='spell-penetration'></option>
                    <option value='custom' data-i18n='custom attribute'>Custom Attribute</option>
                </select>
                <input class='custom-attribute input-field medium-input' type='text' name='attr_custom_attribute'>
            </fieldset>
            <div class='button-container'>
                <button type='action' name='act_submit_mods' data-i18n='add mods' data-i18n-title='mod wizard title' title='Will add the mods to your sheet and will clear and hide this dialog'>Add Mods</button>
                <button type='action' name='act_cancel_mods' data-i18n='cancel' data-i18n-title='cancel variant title' title='Clear the dialog.'>Cancel</button>
            </div>
        </div>
    </div>
    <!--Drag and drop acceptors-->
    <input type="hidden" name="attr_drop_category" accept="Category" value=''>
    <input type="hidden" name="attr_drop_name" accept="Name" value=''>
    <input type="hidden" name="attr_drop_data" accept="data" value=''>
    <input type="hidden" name="attr_drop_content" accept="Content" value=''>
    <input type="hidden" name="attr_drop_header" accept="dropSubhead" value=''>
    <!--End compendium acceptors-->

    <input hidden='true' type='number' title='@{initiative_npc}' name='attr_initiative_npc'>
    <input hidden='true' type='number' title='@{bab}' name='attr_bab' value='0'>
    <!-- The above 3 attributes are used for calculations for NPCs-->
    <div class='name-container'>
        <img class='header-image' src='https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Starfinder%20by%20Roll20/Assets/starfinder_1000x200.png'>
    </div>
    <input class="tab-button options nav hide-tab" type="checkbox" title='@{tab_select}' name="attr_tab_select" value="options" checked>
    <span class='pictos nav'>y</span>
    <span class='nav pictos'>x</span>
    <input class='page-control' type='hidden' name='attr_sheet_type' value='pc'>
    <!-- Containers -->
    <div class='container settings'>
        <div class='section-container type-container'>
            <div class='section'>
                <!-- section is the class that is placed as the header of a section-->
                <h1 class='label' data-i18n='comms'>COMMS</h1>
                <!-- always-glow is a class that has the glow applied always. bottom-left locates it relative to the item to be glowed. corner sets it to be rotated-->
            </div>
            <div class='section-container'>
                <div class='gutter'></div>
                <!--provides a buffer via css grid placement-->
                <div class='row'>
                    <!-- this row holds inputs that control the whisper state (/w gm or '')-->
                    <span class='label' data-i18n='rolls-are'>ROLLS ARE</span>
                    <label class='hover-react'><input type='radio' title='@{whisper_state}' name='attr_whisper_state' value='' checked='checked'> <span class='label' data-i18n='public'>PUBLIC</span></label>
                    <label class='hover-react'><input type='radio' title='@{whisper_state}' name='attr_whisper_state' value='/w gm '> <span class='label' data-i18n='private'>PRIVATE</span></label>
                </div>
                <div class='gutter'></div>
            </div>
        </div>
        <div class='section-container house-container'>
            <!-- controls what type of sheet this is-->
            <div class='section'>
                <h1 class='label' data-i18n='display-mode'>DISPLAY MODE</h1>
            </div>
            <div class='section-container'>
                <input class='pc-display' type='hidden' name='attr_sheet_type' value='pc'>
                <div class='gutter'></div>
                <div class='row'>
                    <label class='hover-react'><input type='radio' title='@{sheet_type}' name='attr_sheet_type' value='pc' checked='checked'> <span class='label' data-i18n='pc' >PC</span></label>
                    <label class='hover-react'><input type='radio' title='@{sheet_type}' name='attr_sheet_type' value='npc'> <span class='label' data-i18n='npc'>NPC</span></label>
                    <label class='hover-react'><input type='radio' title='@{sheet_type}' name='attr_sheet_type' value='ship'> <span class='label' data-i18n='ship'>SHIP</span></label>
                </div>
                <div class='row pcrow pc'>
                    <label class='hover-react'><input type='checkbox' title='@{drone}' name='attr_drone' value='1'><span class='label' data-i18n='drone'>DRONE</span></label>
                </div>
                <div class='row'>
                    <span class='label' data-i18n='mod method'>Mod Input Method</span>
                    <label class='hover-react'><input type='radio' title='@{mod_method}' name='attr_mod_method' value='manual'> <span class='label' data-i18n='manual' >Manual</span></label>
                    <label class='hover-react'><input type='radio' title='@{mod_method}' name='attr_mod_method' value='wizard' checked> <span class='label' data-i18n='wizard'>Wizard</span></label>
                </div>
                <div class='gutter'></div>
            </div>
        </div>
        <div class='section-container house-container'>
            <!--holds various house rules and rule customization options-->
            <div class='section'>
                <h1 class='label' data-i18n='house-rules'>HOUSE RULES</h1>
            </div>
            <div class='section-container'>
                <div class='gutter'></div>
                <div class='row'>
                    <span class='label' data-i18n='resolve'>RESOLVE</span>
                    <label class='hover-react'><input type='radio' title='@{resolve_source}' name='attr_resolve_source' value='key' checked='checked'> <span class='label' data-i18n='key-ability'>KEY ABILITY</span></label>
                    <label class='hover-react'><input type='radio' title='@{resolve_source}' name='attr_resolve_source' value='highest'> <span class='label' data-i18n='highest-ability'>HIGHEST ABILITY</span></label>
                </div>
                <div class='row'>
                    <span class='label' data-i18n='buff-stacking'>BUFF STACKING</span>
                </div>
                <textarea class='buff-stack input-field' title='@{stackable_buffs}' name='attr_stackable_buffs'>Circumstance</textarea>
                <div class='row'>
                    <span class='label' data-i18n='half-specialization-weapons'>HALF SPECIALIZATION WEAPONS</span>
                </div>
                <textarea class='buff-stack input-field' title='@{half_specializations}' name='attr_half_specializations'>operative,small_arm</textarea>
                <div class='gutter'></div>
            </div>
        </div><!--
        <div class='section-container mancer-container'>
            <div class='section'>
                <h1 class='label' data-i18n='charactermancers'>CHARACTERMANCERS</h1>
            </div>
            <div class='section-container'>
                <div class='gutter'></div>
                <div class='row'>
                    <button type='action' name='act_create_pc' data-i18n='create pc'>Create PC</button>
                </div>
                <div class='row'>
                </div>
                <div class='gutter'></div>
            </div>
        </div><!-- End of Charmancer buttons-->
    </div>
    <div class='in-play'>
        <!-- contains the menus and buffs sections-->
        <input class='hide-tab menu-tab' type='radio' title='@{in-play-tab}' name='attr_in-play-tab' value='menus' checked>
        <div class='section menu-tab'>
            <h1 class='label' data-i18n='menus'>MENUS</h1>
        </div>
        <div class='menus'>
            <!-- contains the chat menus for the sheet. Menus that reference an attribute, like the attacks menu, are assembled by sheetworker. The default value is only so that something is output to chat if it is clicked before any change is made to the sheet-->
            <button type='roll' title='%{attacks}' name='roll_attacks' value='@{attacks_menu}' data-i18n='attacks'>ATTACKS</button>
            <button type='roll' title='%{saves}' name='roll_saves' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=SAVES}} {{buttons1=[Fort](~@{character_name}|fort) | [Ref](~@{character_name}|ref) | [Will](~@{character_name}|will)}}'
                data-i18n='saves'>SAVES</button>
            <button type='roll' title='%{abilities}' name='roll_abilities' value='@{abilities_menu}' data-i18n='abilities-u'>ABILITIES</button>
            <button type='roll' title='%{ability_checks}' name='roll_ability_checks' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=ABILITY CHECKS}} {{buttons1=[Strength](~@{character_name}|strength) | [Dexterity](~@{character_name}|dexterity) | [Constitution](~@{character_name}|constitution) | [Intelligence](~@{character_name}|intelligence) | [Wisdom](~@{character_name}|wisdom) | [Charisma](~@{character_name}|charisma)}}'
                data-i18n='ability_checks'>ABILITY CHECKS</button>
            <button type='roll' title='%{skills}' name='roll_skills' value='@{skills_menu}' data-i18n='skills'>SKILLS</button>
            <input type='text' title='@{attacks_menu}' name='attr_attacks_menu' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{title=ATTACKS}}' hidden='true'>
            <input class='is-caster' title='@{caster_select}' name='attr_caster_select' type='checkbox' value='1' hidden='true'>
            <div class='spell-button-container spells'>
                <!--Contains all the spell menus. This section is only shown if one of the classes is a spellcaster. This is controlled by sheetworkers-->
                <button type='roll' title='%{spells}' name='roll_spells' value='@{spells_menu}' data-i18n='spells'>SPELLS</button>
                <input type='text' title='@{spells_menu}' name='attr_spells_menu' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{title=SPELLBOOKS}}' hidden='true'>
                <!--These additional menus are displayed depending on which class is a spellcaster and contain menus specific to the spellcaster class-->
                <input class='class-1 class-spells' title='@{class_1_spells}' name='attr_class_1_spells' type='checkbox' value='1' hidden='true'>
                <button type='roll' title='%{class_1_spellbook}' name='roll_class_1_spellbook' value='@{class_1_spellbook}'><span class='class-1 class-name' type='text' title='@{class_1_name}' name='attr_class_1_name' value=''></span></button>

                <input class='class-2 class-spells' title='@{class_2_spells}' name='attr_class_2_spells' type='checkbox' value='1' hidden='true'>
                <button type='roll' title='%{class_2_spellbook}' name='roll_class_2_spellbook' value='@{class_2_spellbook}'><span class='class-1 class-name' type='text' title='@{class_2_name}' name='attr_class_2_name' value=''></span></button>

                <input class='class-3 class-spells' title='@{class_3_spells}' name='attr_class_3_spells' type='checkbox' value='1' hidden='true'>
                <button type='roll' title='%{class_3_spellbook}' name='roll_class_3_spellbook' value='@{class_3_spellbook}'><span class='class-1 class-name' type='text' title='@{class_3_name}' name='attr_class_3_name' value=''></span></button>

                <input class='class-4 class-spells' title='@{class_4_spells}' name='attr_class_4_spells' type='checkbox' value='1' hidden='true'>
                <button type='roll' title='%{class_4_spellbook}' name='roll_class_4_spellbook' value='@{class_4_spellbook}'><span class='class-1 class-name' type='text' title='@{class_4_name}' name='attr_class_4_name' value=''></span></button>

                <input class='class-5 class-spells' title='@{class_5_spells}' name='attr_class_5_spells' type='checkbox' value='1' hidden='true'>
                <button type='roll' title='%{class_5_spellbook}' name='roll_class_5_spellbook' value='@{class_5_spellbook}'><span class='class-1 class-name' type='text' title='@{class_5_name}' name='attr_class_5_name' value=''></span></button>

                <input type='text' title='@{class_1_spellbook}' name='attr_class_1_spellbook' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}}' hidden='true'>
                <input type='text' title='@{class_2_spellbook}' name='attr_class_2_spellbook' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}}' hidden='true'>
                <input type='text' title='@{class_3_spellbook}' name='attr_class_3_spellbook' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}}' hidden='true'>
                <input type='text' title='@{class_4_spellbook}' name='attr_class_4_spellbook' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}}' hidden='true'>
                <input type='text' title='@{class_5_spellbook}' name='attr_class_5_spellbook' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}}' hidden='true'>
            </div>
            <input type='text' title='@{abilities_menu}' name='attr_abilities_menu' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{title=ABILITIES}}' hidden='true'>
            <input type='text' title='@{skills_menu}' name='attr_skills_menu' value='/w "@{character_name}" &{template:sf_generic} {{name=@{character_name}}} {{title=SKILLS}}' hidden='true'>
        </div>
        <input class='hide-tab buff-tab' type='radio' title='@{in-play-tab}' name='attr_in-play-tab' value='buffs'>
        <div class='section buff-tab'>
            <h1 class='label' data-i18n='buffs'>BUFFS</h1>
        </div>
        <div class='buffs'>
            <!-- contains the buffs repeating section-->
            <fieldset class='repeating_buff'>
                <input class='filter' type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                <div class='filter-container buff'>
                    <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                    <div class='row-options'>
                        <input class='buff-name input-field' type='text' title='@{name}' name='attr_name' placeholder='Haste'>
                        <div class='manual-mod mod-container'>
                            <span class='label buff-mod' data-i18n='mods'>MODS</span>
                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                        </div>
                        <button class='wizard-mod' type='action' name='act_mod'><span title='@{mods}' name='attr_mods'>Click to add bonuses</span></button>
                    </div>
                    <div class='display'>
                        <label>
                            <input type='checkbox' title='@{toggle}' name='attr_toggle' value='1'>
                            <span class='buff-name label' title='@{name}' name='attr_name'>TEST</span>
                        </label>
                    </div>
                </div>
            </fieldset>
        </div>
        <div class='help-container buffs'>
            <div class='help-content'>
                <span class='manual-mod' data-i18n='buffs-help-first-line'>The textareas in this repeating section are used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                <span class='manual-mod' data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                <span class='wizard-mod' data-i18n='wizard-buffs-help-first-line'>The textareas in this repeating section display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
            </div>
            <span class='help-icon pictos'>?</span>
        </div>
        <input class='hide-tab condition-tab' type='radio' title='@{in-play-tab}' name='attr_in-play-tab' value='conditions'>
        <div class='section condition-tab'>
            <h1 class='label' data-i18n='conditions'>CONDITIONS</h1>
        </div>
        <div class='conditions'>
            <div class='span-all track-container'>
                <fieldset class='repeating_condition'>
                    <input class='filter' type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                    <div class='filter-container condition'>
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Insanity' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='track'>TRACK</span>
                                <input type='hidden' name='attr_track' placeholder='Insanity' value='physical_track'>
                                <select class='medium-input input-field' title='@{repeating_condition_$X_track}' name='attr_track'>
                                    <option value='physical_track' data-i18n='physical_track' selected>PHYSICAL TRACK</option>
                                    <option value='mental_track' data-i18n='mental_track' selected>MENTAL TRACK</option>
                                    <option value='strength_track' data-i18n='strength_track' selected>STRENGTH TRACK</option>
                                    <option value='dexterity_track' data-i18n='dexterity_track' selected>DEXTERITY TRACK</option>
                                    <option value='constitution_track' data-i18n='constitution_track' selected>CONSTITUTION TRACK</option>
                                    <option value='intelligence_track' data-i18n='intelligence_track' selected>INTELLIGENCE TRACK</option>
                                    <option value='wisdom_track' data-i18n='wisdom_track' selected>WISDOM TRACK</option>
                                    <option value='charisma_track' data-i18n='charisma_track' selected>CHARISMA TRACK</option>
                                </select>
                            </div>
                            <textarea class='group' name='attr_description' title='repeating_condition_$X_description'></textarea>
                        </div>
                        <div class='display'>
                            <div class='button-description'>
                                <input type='text' readonly='true' name='attr_name' placeholder='Insanity' value=''>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <div class='tracks'>
                                <input class='track-filter' type='hidden' name='attr_track' placeholder='Insanity' value='physical_track'>
                                <label><input class='healthy' type='radio' hidden='true' data-i18n-title='healthy' title='HEALTHY' name='attr_track_status' value='healthy' checked><span class='label' data-i18n='healthy'>HEALTHY</span></label>
                                <input class='specific-track physical mental' type='radio' data-i18n-title='latent' title='latent' name='attr_track_status' value='latent'>
                                <input class='specific-track dexterity' type='radio' data-i18n-title='sluggish' title='sluggish' name='attr_track_status' value='sluggish'>
                                <input class='specific-track dexterity' type='radio' data-i18n-title='stiffened' title='stiffened' name='attr_track_status' value='stiffened'>
                                <input class='specific-track physical mental strength constitution intelligence wisdom charisma' type='radio' data-i18n-title='weakened' title='weakened' name='attr_track_status' value='weakened'>
                                <input class='specific-track physical mental strength constitution intelligence wisdom charisma' type='radio' data-i18n-title='impaired' title='impaired' name='attr_track_status' value='impaired'>
                                <input class='specific-track charisma' type='radio' data-i18n-title='pliable' title='pliable' name='attr_track_status' value='pliable'>
                                <input class='specific-track charisma' type='radio' data-i18n-title='catatonic' title='catatonic' name='attr_track_status' value='catatonic'>
                                <input class='specific-track wisdom' type='radio' data-i18n-title='confused' title='confused' name='attr_track_status' value='confused'>
                                <input class='specific-track intelligence' type='radio' data-i18n-title='animalistic' title='animalistic' name='attr_track_status' value='animalistic'>
                                <input class='specific-track constitution' type='radio' data-i18n-title='debilitated' title='debilitated' name='attr_track_status' value='debilitated'>
                                <input class='specific-track constitution' type='radio' data-i18n-title='unconscious' title='unconscious' name='attr_track_status' value='unconscious'>
                                <input class='specific-track strength dexterity' type='radio' data-i18n-title='staggered' title='staggered' name='attr_track_status' value='staggered'>
                                <input class='specific-track strength dexterity' type='radio' data-i18n-title='immobile' title='immobile' name='attr_track_status' value='immobile'>
                                <input class='specific-track mental' type='radio' data-i18n-title='befuddled' title='befuddled' name='attr_track_status' value='befuddled'>
                                <input class='specific-track mental' type='radio' data-i18n-title='disassociated' title='disassociated' name='attr_track_status' value='disassociated'>
                                <input class='specific-track physical' type='radio' data-i18n-title='debilitated' title='debilitated' name='attr_track_status' value='debilitating'>
                                <input class='specific-track physical' type='radio' data-i18n-title='bedridden' title='bedridden' name='attr_track_status' value='bedridden'>
                                <input class='specific-track physical mental intelligence wisdom' type='radio' data-i18n-title='comatose' title='comatose' name='attr_track_status' value='comatose'>
                                <label><input class='dead' type='radio' hidden='true' data-i18n-title='dead' title='dead' name='attr_track_status' value='dead'><span class='label' data-i18n='dead'>DEAD</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description span-all' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
            </div>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_asleep'><span class='input-field' data-i18n='asleep'>ASLEEP</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_bleeding'><span class='input-field' data-i18n='bleeding'>BLEEDING</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_blinded'><span class='input-field' data-i18n='blinded'>BLINDED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_burning'><span class='input-field' data-i18n='burning'>BURNING</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_confused'><span class='input-field' data-i18n='confused'>CONFUSED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_cowering'><span class='input-field' data-i18n='cowering'>COWERING</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_dazed'><span class='input-field' data-i18n='dazed'>DAZED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_dazzled'><span class='input-field' data-i18n='dazzled'>DAZZLED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_dead'><span class='input-field' data-i18n='dead'>DEAD</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_deafened'><span class='input-field' data-i18n='deafened'>DEAFENED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_dying'><span class='input-field' data-i18n='dying'>DYING</span></label>
            <div class='label tactical-condition input-field'><input class='encumbrance' hidden='true' type='number' min='1' max='1' name='attr_encumber_level' value='0'><span class='span-two' data-i18n='encumbered'>ENCUMBERED</span></div>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_entangled'><span class='input-field' data-i18n='entangled'>ENTANGLED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_exhausted'><span class='input-field' data-i18n='exhausted'>EXHAUSTED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_fascinated'><span class='input-field' data-i18n='fascinated'>FASCINATED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_fatigued'><span class='input-field' data-i18n='fatigued'>FATIGUED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_flat_footed'><span class='input-field' data-i18n='flat_footed'>FLAT-FOOTED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_frightened'><span class='input-field' data-i18n='frightened'>FRIGHTENED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_grappled'><span class='input-field' data-i18n='grappled'>GRAPPLED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_helpless'><span class='input-field' data-i18n='helpless'>HELPLESS</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_nauseated'><span class='input-field' data-i18n='nauseated'>NAUSEATED</span></label>
            <div class='tactical-condition'><input class='input-field' type='number' class='label' name='attr_negative_levels' value='0'><span class='label' data-i18n='negative_levels'>NEGATIVE LEVELS</span></div>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_off_kilter'><span class='input-field' data-i18n='off_kilter'>OFF-KILTER</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_off_target'><span class='input-field' data-i18n='off_target'>OFF-TARGET</span></label>
            <div class='label tactical-condition input-field'><input class='encumbrance' hidden='true' type='number' min='2' max='2' name='attr_encumber_level' value='0'><span class='span-two' data-i18n='overburdened'>OVERBURDENED</span></div>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_panicked'><span class='input-field' data-i18n='panicked'>PANICKED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_paralyzed'><span class='input-field' data-i18n='paralyzed'>PARALYZED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_pinned'><span class='input-field' data-i18n='pinned'>PINNED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_prone'><span class='input-field' data-i18n='prone'>PRONE</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_shaken'><span class='input-field' data-i18n='shaken'>SHAKEN</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_sickened'><span class='input-field' data-i18n='sickened'>SICKENED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_stable'><span class='input-field' data-i18n='stable'>STABLE</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_staggered'><span class='input-field' data-i18n='staggered'>STAGGERED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_stunned'><span class='input-field' data-i18n='stunned'>STUNNED</span></label>
            <label class='label tactical-condition'><input value='1' type='checkbox' hidden='true' name='attr_unconscious'><span class='input-field' data-i18n='unconscious'>UNCONSCIOUS</span></label>
        </div>
    </div>
    <div class="container pc">
        <!-- holds all of the pc sheets-->
        <div class='content-container header-content'>
            <!-- contains the character info and class info sections-->
            <input class='hide-tab char-details' title='@{char-tab}' name='attr_char-tab' type='radio' value='char info' checked>
            <!--hide-tab ensures that the checkbox is set to opacity 0. The other class in the class declaration sets where the pseudo button is located-->
            <div class='section char-details'>
                <h1 class='label' data-i18n='character'>CHARACTER</h1>
            </div>
            <input class='hide-tab class-details' title='@{char-tab}' name='attr_char-tab' type='radio' value='class details'>
            <div class='section class-details'>
                <h1 class='label' data-i18n='class'>CLASS</h1>
            </div>
            <input class='is-not-caster' title='@{is_caster}' name='attr_is_caster' type='radio' value='0' hidden='true' checked>
            <input class='is-caster' title='@{is_caster}' name='attr_is_caster' type='radio' value='1' hidden='true'>
            <input class='hide-tab third-tab spells' title='@{char-tab}' name='attr_char-tab' type='radio' value='spellcaster'>
            <div class='spells third-tab section'>
                <h1 class='label' data-i18n='spellclasses'>SPELLCLASSES</h1>
            </div>
            <div class='char-info'>
                <div class='hlabel-container char-name'>
                    <!-- hlabel-container creates a div that is styled so that the input is on the top, and the label is below, with both centered in the container-->
                    <input class='input-field' type="text" title='@{character_name}' name="attr_character_name">
                    <span class="label" data-i18n="char-name-u">CHARACTER NAME</span>
                </div>
                <div class='hlabel-container class-level'>
                    <input class='input-field' type='text' readonly='true' title='@{class&level}' name='attr_class&level'>
                    <span class='label' data-i18n='class-level'>CLASS/LEVEL</span>
                </div>
                <div class='hlabel-container race'>
                    <input class='input-field' type='text' title='@{race}' name='attr_race'>
                    <span class='label' data-i18n='race'>RACE</span>
                </div>
                <div class='hlabel-container race-hp'>
                    <input class='input-field' class='' type='number' title='@{race_hp}' name='attr_race_hp'>
                    <span class='label' data-i18n='hp'>HP</span>
                </div>
                <div class='hlabel-container theme'>
                    <input class='input-field' type='text' title='@{theme}' name='attr_theme'>
                    <span class='label' data-i18n='theme'>THEME</span>
                </div>
                <div class='hlabel-container size'>
                    <select class='input-field' title='@{size}' name='attr_size'>
                        <option value='-4' data-i18n='fine'>FINE</option>
                        <option value='-3' data-i18n='diminutive'>DIMINUTIVE</option>
                        <option value='-2' data-i18n='tiny'>TINY</option>
                        <option value='-1' data-i18n='small'>SMALL</option>
                        <option value='0' data-i18n='medium' selected>MEDIUM</option>
                        <option value='1' data-i18n='large'>LARGE</option>
                        <option value='2' data-i18n='huge'>HUGE</option>
                        <option value='3' data-i18n='gargantuan'>GARGANTUAN</option>
                        <option value='4' data-i18n='colossal'>COLOSSAL</option>
                    </select>
                    <span class='label' data-i18n='size'>SIZE</span>
                </div>
                <div class='hlabel-container speed'>
                    <input class='input-field' type='text' title='@{speed}' name='attr_speed'>
                    <span class='label' data-i18n='speed'>SPEED</span>
                </div>
                <div class='hlabel-container gender'>
                    <input class='input-field' type='text' title='@{gender}' name='attr_gender'>
                    <span class='label' data-i18n='gender'>GENDER</span>
                </div>
                <div class='hlabel-container home-world'>
                    <input class='input-field' type='text' title='@{home_world}' name='attr_home_world'>
                    <span class='label' data-i18n='home-world'>HOME WORLD</span>
                </div>
                <div class='hlabel-container alignment'>
                    <input class='input-field' type='text' title='@{alignment}' name='attr_alignment'>
                    <span class='label' data-i18n='alignment'>ALIGNMENT</span>
                </div>
                <div class='hlabel-container deity'>
                    <input class='input-field' type='text' title='@{deity}' name='attr_deity'>
                    <span class='label' data-i18n='deity'>DEITY</span>
                </div>
                <div class='hlabel-container player'>
                    <input class='input-field' type='text' title='@{player}' name='attr_player'>
                    <span class='label' data-i18n='player'>PLAYER</span>
                </div>
                <div class='hlabel-container language'>
                    <input class='input-field' type='text' title='@{language}' name='attr_language'>
                    <span class='label' data-i18n='languages'>LANGUAGES</span>
                </div>
            </div>
            <div class='class-info'>
                <!-- contains all of the basic class info like sp/hp per level, bab, saves, skills, and spellcasting-->
                <div class='left-gutter'></div>
                <div class='right-gutter'></div>
                <span class='label class-name' data-i18n='class'>CLASS</span>
                <span class='label class-num-level' data-i18n='class-num-level'>LVL</span>
                <span class='label class-health' data-i18n='class-stam'>SP</span>
                <span class='label class-health' data-i18n='hp'>HP</span>
                <span class='label class-bab' data-i18n='bab'>BAB</span>
                <span class='label class-save' data-i18n='fort'>FORT</span>
                <span class='label class-save' data-i18n='ref'>REF</span>
                <span class='label class-save' data-i18n='will'>WILL</span>
                <span class='label class-skills' data-i18n='skills'>SKILLS</span>
                <span class='label class-ability' data-i18n='abi'>ABI</span>
                <span class='label class-spells' data-i18n='spell'>SPELL</span>
                <!-- class 1 -->
                <input class='class-1 class-name input-field' type='text' title='@{class_1_name}' name='attr_class_1_name' placeholder='1st Class'>
                <input class='class-1 class-num-level input-field' type='number' title='@{class_1_level}' name='attr_class_1_level' placeholder='1'>
                <input class='class-1 class-health input-field' type='number' title='@{class_1_sp}' name='attr_class_1_sp' placeholder='4'>
                <input class='class-1 class-health input-field' type='number' title='@{class_1_hp}' name='attr_class_1_hp' placeholder='4'>
                <select class='class-1 class-bab input-field' title='@{class_1_bab}' name='attr_class_1_bab'>
                    <option value='0.5'>1/2</option>
                    <option value='0.75' selected>3/4</option>
                    <option value='1'>1</option>
                </select>
                <select class='class-1 class-save input-field' title='@{class_1_fort}' name='attr_class_1_fort'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-1 class-save input-field' title='@{class_1_ref}' name='attr_class_1_ref'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-1 class-save input-field' title='@{class_1_will}' name='attr_class_1_will'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <input class='class-1 class-skills input-field' type='number' title='@{class_1_skills}' name='attr_class_1_skills' placeholder='4'>
                <select class='class-1 class-ability input-field' title='@{class_1_ability}' name='attr_class_1_ability' placeholder='@{class_1_ability}'>
                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                </select>
                <input class='class-1 class-spells' title='@{class_1_spells}' name='attr_class_1_spells' type='checkbox' value='1'>
                <!-- class 2 -->
                <input class='class-2 class-name input-field' type='text' title='@{class_2_name}' name='attr_class_2_name' placeholder='2nd Class'>
                <input class='class-2 class-num-level input-field' type='number' title='@{class_2_level}' name='attr_class_2_level' placeholder='1'>
                <input class='class-2 class-health input-field' type='number' title='@{class_2_sp}' name='attr_class_2_sp' placeholder='4'>
                <input class='class-2 class-health input-field' type='number' title='@{class_2_hp}' name='attr_class_2_hp' placeholder='4'>
                <select class='class-2 class-bab input-field' title='@{class_2_bab}' name='attr_class_2_bab'>
                    <option value='0.5'>1/2</option>
                    <option value='0.75' selected>3/4</option>
                    <option value='1'>1</option>
                </select>
                <select class='class-2 class-save input-field' title='@{class_2_fort}' name='attr_class_2_fort'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-2 class-save input-field' title='@{class_2_ref}' name='attr_class_2_ref'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-2 class-save input-field' title='@{class_2_will}' name='attr_class_2_will'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <input class='class-2 class-skills input-field' type='number' title='@{class_2_skills}' name='attr_class_2_skills' placeholder='4'>
                <select class='class-2 class-ability input-field' title='@{class_2_ability}' name='attr_class_2_ability' placeholder='@{class_2_ability}'>
                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                </select>
                <input class='class-2 class-spells' title='@{class_2_spells}' name='attr_class_2_spells' type='checkbox' value='1'>
                <!-- class 3 -->
                <input class='class-3 class-name input-field' type='text' title='@{class_3_name}' name='attr_class_3_name' placeholder='3rd Class'>
                <input class='class-3 class-num-level input-field' type='number' title='@{class_3_level}' name='attr_class_3_level' placeholder='1'>
                <input class='class-3 class-health input-field' type='number' title='@{class_3_sp}' name='attr_class_3_sp' placeholder='4'>
                <input class='class-3 class-health input-field' type='number' title='@{class_3_hp}' name='attr_class_3_hp' placeholder='4'>
                <select class='class-3 class-bab input-field' title='@{class_3_bab}' name='attr_class_3_bab'>
                    <option value='0.5'>1/2</option>
                    <option value='0.75' selected>3/4</option>
                    <option value='1'>1</option>
                </select>
                <select class='class-3 class-save input-field' title='@{class_3_fort}' name='attr_class_3_fort'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-3 class-save input-field' title='@{class_3_ref}' name='attr_class_3_ref'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-3 class-save input-field' title='@{class_3_will}' name='attr_class_3_will'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <input class='class-3 class-skills input-field' type='number' title='@{class_3_skills}' name='attr_class_3_skills' placeholder='4'>
                <select class='class-3 class-ability input-field' title='@{class_3_ability}' name='attr_class_3_ability' placeholder='@{class_3_ability}'>
                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                </select>
                <input class='class-3 class-spells' title='@{class_3_spells}' name='attr_class_3_spells' type='checkbox' value='1'>
                <!-- class 4 -->
                <input class='class-4 class-name input-field' type='text' title='@{class_4_name}' name='attr_class_4_name' placeholder='4th Class'>
                <input class='class-4 class-num-level input-field' type='number' title='@{class_4_level}' name='attr_class_4_level' placeholder='1'>
                <input class='class-4 class-health input-field' type='number' title='@{class_4_sp}' name='attr_class_4_sp' placeholder='4'>
                <input class='class-4 class-health input-field' type='number' title='@{class_4_hp}' name='attr_class_4_hp' placeholder='4'>
                <select class='class-4 class-bab input-field' title='@{class_4_bab}' name='attr_class_4_bab'>
                    <option value='0.5'>1/2</option>
                    <option value='0.75' selected>3/4</option>
                    <option value='1'>1</option>
                </select>
                <select class='class-4 class-save input-field' title='@{class_4_fort}' name='attr_class_4_fort'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-4 class-save input-field' title='@{class_4_ref}' name='attr_class_4_ref'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-4 class-save input-field' title='@{class_4_will}' name='attr_class_4_will'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <input class='class-4 class-skills input-field' type='number' title='@{class_4_skills}' name='attr_class_4_skills' placeholder='4'>
                <select class='class-4 class-ability input-field' title='@{class_4_ability}' name='attr_class_4_ability' placeholder='@{class_4_ability}'>
                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                </select>
                <input class='class-4 class-spells' title='@{class_4_spells}' name='attr_class_4_spells' type='checkbox' value='1'>
                <!-- class 5 -->
                <input class='class-5 class-name input-field' type='text' title='@{class_5_name}' name='attr_class_5_name' placeholder='5th Class'>
                <input class='class-5 class-num-level input-field' type='number' title='@{class_5_level}' name='attr_class_5_level' placeholder='1'>
                <input class='class-5 class-health input-field' type='number' title='@{class_5_sp}' name='attr_class_5_sp' placeholder='4'>
                <input class='class-5 class-health input-field' type='number' title='@{class_5_hp}' name='attr_class_5_hp' placeholder='4'>
                <select class='class-5 class-bab input-field' title='@{class_5_bab}' name='attr_class_5_bab'>
                    <option value='0.5'>1/2</option>
                    <option value='0.75' selected>3/4</option>
                    <option value='1'>1</option>
                </select>
                <select class='class-5 class-save input-field' title='@{class_5_fort}' name='attr_class_5_fort'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-5 class-save input-field' title='@{class_5_ref}' name='attr_class_5_ref'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <select class='class-5 class-save input-field' title='@{class_5_will}' name='attr_class_5_will'>
                    <option value='poor' data-i18n='poor' selected>POOR</option>
                    <option value='good' data-i18n='good'>GOOD</option>
                </select>
                <input class='class-5 class-skills input-field' type='number' title='@{class_5_skills}' name='attr_class_5_skills' placeholder='4'>
                <select class='class-5 class-ability input-field' title='@{class_5_ability}' name='attr_class_5_ability' placeholder='@{class_5_ability}'>
                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                </select>
                <input class='class-5 class-spells' title='@{class_5_spells}' name='attr_class_5_spells' type='checkbox' value='1'>
            </div>
            <div class='spellclass-details'>
                <div class='gutter'></div>
                <!-- Caster 1 -->
                <input class='class-1 class-spells' title='@{class_1_spells}' name='attr_class_1_spells' type='checkbox' value='1' hidden='true'>
                <div class='spellclass-container'>
                    <input class='class-1 class-show' title='@{class_1_show}' name='attr_class_1_show' titel='@{class_1_show}' type=checkbox checked='checked' value='1'>
                    <span class='class-1 class-name' title='@{class_1_name}' name='attr_class_1_name' placeholder='1st Class' readonly='true'>1st Class</span>
                    <span class='class-1 class-num-level' title='@{class_1_level}' name='attr_class_1_level' placeholder='1' readonly='true'>5</span>
                    <span class='casting-ability' data-i18n='ability'>ABILITY</span>
                    <select class='class-1 class-ability input-field' title='@{class_1_casting_ability}' name='attr_class_1_casting_ability'>
                        <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                    </select>
                    <span CLASS='spell-progression' data-i18n='progress'>PROGRESS</span>
                    <select class='class-1 class-spell-progression input-field' title='@{class_1_spell_progression}' name='attr_class_1_spell_progression'>
                        <option value='half' data-i18n='half'>HALF</option>
                        <option value='partial' data-i18n='partial' selected>PARTIAL</option>
                        <option value='full_prep' data-i18n='full_prep'>FULL PREP</option>
                        <option value='full_spont' data-i18n='full_spont'>FULL SPONT</option>
                    </select>
                    <input type='radio' class='cantrips-only' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='0' checked='checked' hidden='true'>
                    <input type='radio' class='spell1' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='1' hidden='true'>
                    <input type='radio' class='spell2' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='2' hidden='true'>
                    <input type='radio' class='spell3' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='3' hidden='true'>
                    <input type='radio' class='spell4' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='4' hidden='true'>
                    <input type='radio' class='spell5' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='5' hidden='true'>
                    <input type='radio' class='spell6' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='6' hidden='true'>
                    <input type='radio' class='spell7' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='7' hidden='true'>
                    <input type='radio' class='spell8' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='8' hidden='true'>
                    <input type='radio' class='spell9' title='@{class_1_max_spell}' name='attr_class_1_max_spell' value='9' hidden='true'>
                    <span class='label daily' data-i18n='spells-per-day'>SPELLS PER DAY</span>
                    <span class='label num aspell0'>0</span>
                    <input class='label current aspell0 input-field' title='@{class_1_cantrips_per_day}' name='attr_class_1_cantrips_per_day' type='text'><span class='label slash aspell0'>/</span>
                    <input class='label max aspell0 input-field' title='@{class_1_cantrips_per_day_max}' name='attr_class_1_cantrips_per_day_max' type='text' type='text'>
                    <span class='label num class-spells-day aspell1'>1</span>
                    <input class='label class-spells-day current aspell1 input-field' title='@{class_1_level_1_spells_per_day}' name='attr_class_1_level_1_spells_per_day' type='text'><span class='label class-spells-day slash aspell1'>/</span>
                    <input class='label class-spells-day max aspell1 input-field' title='@{class_1_level_1_spells_per_day_max}' name='attr_class_1_level_1_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell2'>2</span>
                    <input class='label class-spells-day current aspell2 input-field' title='@{class_1_level_2_spells_per_day}' name='attr_class_1_level_2_spells_per_day' type='text'><span class='label class-spells-day slash aspell2'>/</span>
                    <input class='label class-spells-day max aspell2 input-field' title='@{class_1_level_2_spells_per_day_max}' name='attr_class_1_level_2_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell3'>3</span>
                    <input class='label class-spells-day current aspell3 input-field' title='@{class_1_level_3_spells_per_day}' name='attr_class_1_level_3_spells_per_day' type='text'><span class='label class-spells-day slash aspell3'>/</span>
                    <input class='label class-spells-day max aspell3 input-field' title='@{class_1_level_3_spells_per_day_max}' name='attr_class_1_level_3_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell4'>4</span>
                    <input class='label class-spells-day current aspell4 input-field' title='@{class_1_level_4_spells_per_day}' name='attr_class_1_level_4_spells_per_day' type='text'><span class='label class-spells-day slash aspell4'>/</span>
                    <input class='label class-spells-day max aspell4 input-field' title='@{class_1_level_4_spells_per_day_max}' name='attr_class_1_level_4_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell5'>5</span>
                    <input class='label class-spells-day current aspell5 input-field' title='@{class_1_level_5_spells_per_day}' name='attr_class_1_level_5_spells_per_day' type='text'><span class='label class-spells-day slash aspell5'>/</span>
                    <input class='label class-spells-day max aspell5 input-field' title='@{class_1_level_5_spells_per_day_max}' name='attr_class_1_level_5_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell6'>6</span>
                    <input class='label class-spells-day current aspell6 input-field' title='@{class_1_level_6_spells_per_day}' name='attr_class_1_level_6_spells_per_day' type='text'><span class='label class-spells-day slash aspell6'>/</span>
                    <input class='label class-spells-day max aspell6 input-field' title='@{class_1_level_6_spells_per_day_max}' name='attr_class_1_level_6_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell7'>7</span>
                    <input class='label class-spells-day current aspell7 input-field' title='@{class_1_level_7_spells_per_day}' name='attr_class_1_level_7_spells_per_day' type='text'><span class='label class-spells-day slash aspell7'>/</span>
                    <input class='label class-spells-day max aspell7 input-field' title='@{class_1_level_7_spells_per_day_max}' name='attr_class_1_level_7_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell8'>8</span>
                    <input class='label class-spells-day current aspell8 input-field' title='@{class_1_level_8_spells_per_day}' name='attr_class_1_level_8_spells_per_day' type='text'><span class='label class-spells-day slash aspell8'>/</span>
                    <input class='label class-spells-day max aspell8 input-field' title='@{class_1_level_8_spells_per_day_max}' name='attr_class_1_level_8_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell9'>9</span>
                    <input class='label class-spells-day current aspell9 input-field' title='@{class_1_level_9_spells_per_day}' name='attr_class_1_level_9_spells_per_day' type='text'><span class='label class-spells-day slash aspell9'>/</span>
                    <input class='label class-spells-day max aspell9 input-field' title='@{class_1_level_9_spells_per_day_max}' name='attr_class_1_level_9_spells_per_day_max' type='text'>
                </div>
                <!-- Caster 2 -->
                <input class='class-2 class-spells' title='@{class_2_spells}' name='attr_class_2_spells' type='checkbox' value='1' hidden='true'>
                <div class='spellclass-container'>
                    <input class='class-2 class-show' title='@{class_2_show}' name='attr_class_2_show' titel='@{class_2_show}' type=checkbox checked='checked' value='1'>
                    <span class='class-2 class-name' title='@{class_2_name}' name='attr_class_2_name' placeholder='1st Class' readonly='true'></span>
                    <span class='class-2 class-num-level' title='@{class_2_level}' name='attr_class_2_level' placeholder='1' readonly='true'></span>
                    <span class='casting-ability' data-i18n='ability'>ABILITY</span>
                    <select class='class-2 class-ability input-field' title='@{class_2_casting_ability}' name='attr_class_2_casting_ability'>
                        <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                    </select>
                    <span CLASS='spell-progression' data-i18n='progress'>PROGRESS</span>
                    <select class='class-2 class-spell-progression input-field' title='@{class_2_spell_progression}' name='attr_class_2_spell_progression'>
                        <option value='half' data-i18n='half'>HALF</option>
                        <option value='partial' data-i18n='partial' selected>PARTIAL</option>
                        <option value='full_prep' data-i18n='full_prep'>FULL PREP</option>
                        <option value='full_spont' data-i18n='full_spont'>FULL SPONT</option>
                    </select>
                    <input type='radio' class='cantrips-only' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='0' checked='checked' hidden='true'>
                    <input type='radio' class='spell1' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='1' hidden='true'>
                    <input type='radio' class='spell2' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='2' hidden='true'>
                    <input type='radio' class='spell3' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='3' hidden='true'>
                    <input type='radio' class='spell4' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='4' hidden='true'>
                    <input type='radio' class='spell5' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='5' hidden='true'>
                    <input type='radio' class='spell6' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='6' hidden='true'>
                    <input type='radio' class='spell7' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='7' hidden='true'>
                    <input type='radio' class='spell8' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='8' hidden='true'>
                    <input type='radio' class='spell9' title='@{class_2_max_spell}' name='attr_class_2_max_spell' value='9' hidden='true'>
                    <span class='label daily' data-i18n='spells-per-day'>SPELLS PER DAY</span>
                    <span class='label num aspell0'>0</span>
                    <input class='label current aspell0 input-field' title='@{class_2_cantrips_per_day}' name='attr_class_2_cantrips_per_day' type='text'><span class='label slash aspell0'>/</span>
                    <input class='label max aspell0 input-field' title='@{class_2_cantrips_per_day_max}' name='attr_class_2_cantrips_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell1'>1</span>
                    <input class='label class-spells-day current aspell1 input-field' title='@{class_2_level_1_spells_per_day}' name='attr_class_2_level_1_spells_per_day' type='text'><span class='label class-spells-day slash aspell1'>/</span>
                    <input class='label class-spells-day max aspell1 input-field' title='@{class_2_level_1_spells_per_day_max}' name='attr_class_2_level_1_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell2'>2</span>
                    <input class='label class-spells-day current aspell2 input-field' title='@{class_2_level_2_spells_per_day}' name='attr_class_2_level_2_spells_per_day' type='text'><span class='label class-spells-day slash aspell2'>/</span>
                    <input class='label class-spells-day max aspell2 input-field' title='@{class_2_level_2_spells_per_day_max}' name='attr_class_2_level_2_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell3'>3</span>
                    <input class='label class-spells-day current aspell3 input-field' title='@{class_2_level_3_spells_per_day}' name='attr_class_2_level_3_spells_per_day' type='text'><span class='label class-spells-day slash aspell3'>/</span>
                    <input class='label class-spells-day max aspell3 input-field' title='@{class_2_level_3_spells_per_day_max}' name='attr_class_2_level_3_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell4'>4</span>
                    <input class='label class-spells-day current aspell4 input-field' title='@{class_2_level_4_spells_per_day}' name='attr_class_2_level_4_spells_per_day' type='text'><span class='label class-spells-day slash aspell4'>/</span>
                    <input class='label class-spells-day max aspell4 input-field' title='@{class_2_level_4_spells_per_day_max}' name='attr_class_2_level_4_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell5'>5</span>
                    <input class='label class-spells-day current aspell5 input-field' title='@{class_2_level_5_spells_per_day}' name='attr_class_2_level_5_spells_per_day' type='text'><span class='label class-spells-day slash aspell5'>/</span>
                    <input class='label class-spells-day max aspell5 input-field' title='@{class_2_level_5_spells_per_day_max}' name='attr_class_2_level_5_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell6'>6</span>
                    <input class='label class-spells-day current aspell6 input-field' title='@{class_2_level_6_spells_per_day}' name='attr_class_2_level_6_spells_per_day' type='text'><span class='label class-spells-day slash aspell6'>/</span>
                    <input class='label class-spells-day max aspell6 input-field' title='@{class_2_level_6_spells_per_day_max}' name='attr_class_2_level_6_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell7'>7</span>
                    <input class='label class-spells-day current aspell7 input-field' title='@{class_2_level_7_spells_per_day}' name='attr_class_2_level_7_spells_per_day' type='text'><span class='label class-spells-day slash aspell7'>/</span>
                    <input class='label class-spells-day max aspell7 input-field' title='@{class_2_level_7_spells_per_day_max}' name='attr_class_2_level_7_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell8'>8</span>
                    <input class='label class-spells-day current aspell8 input-field' title='@{class_2_level_8_spells_per_day}' name='attr_class_2_level_8_spells_per_day' type='text'><span class='label class-spells-day slash aspell8'>/</span>
                    <input class='label class-spells-day max aspell8 input-field' title='@{class_2_level_8_spells_per_day_max}' name='attr_class_2_level_8_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell9'>9</span>
                    <input class='label class-spells-day current aspell9 input-field' title='@{class_2_level_9_spells_per_day}' name='attr_class_2_level_9_spells_per_day' type='text'><span class='label class-spells-day slash aspell9'>/</span>
                    <input class='label class-spells-day max aspell9 input-field' title='@{class_2_level_9_spells_per_day_max}' name='attr_class_2_level_9_spells_per_day_max' type='text'>
                </div>
                <!-- Caster 3 -->
                <input class='class-3 class-spells' title='@{class_3_spells}' name='attr_class_3_spells' type='checkbox' value='1' hidden='true'>
                <div class='spellclass-container'>
                    <input class='class-3 class-show' title='@{class_3_show}' name='attr_class_3_show' titel='@{class_3_show}' type=checkbox checked='checked' value='1'>
                    <span class='class-3 class-name' title='@{class_3_name}' name='attr_class_3_name' placeholder='1st Class' readonly='true'></span>
                    <span class='class-3 class-num-level' title='@{class_3_level}' name='attr_class_3_level' placeholder='1' readonly='true'></span>
                    <span class='casting-ability' data-i18n='ability'>ABILITY</span>
                    <select class='class-3 class-ability input-field' title='@{class_3_casting_ability}' name='attr_class_3_casting_ability'>
                        <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                    </select>
                    <span CLASS='spell-progression' data-i18n='progress'>PROGRESS</span>
                    <select class='class-3 class-spell-progression input-field' title='@{class_3_spell_progression}' name='attr_class_3_spell_progression'>
                        <option value='half' data-i18n='half'>HALF</option>
                        <option value='partial' data-i18n='partial' selected>PARTIAL</option>
                        <option value='full_prep' data-i18n='full_prep'>FULL PREP</option>
                        <option value='full_spont' data-i18n='full_spont'>FULL SPONT</option>
                    </select>
                    <input type='radio' class='cantrips-only' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='0' checked='checked' hidden='true'>
                    <input type='radio' class='spell1' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='1' hidden='true'>
                    <input type='radio' class='spell2' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='2' hidden='true'>
                    <input type='radio' class='spell3' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='3' hidden='true'>
                    <input type='radio' class='spell4' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='4' hidden='true'>
                    <input type='radio' class='spell5' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='5' hidden='true'>
                    <input type='radio' class='spell6' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='6' hidden='true'>
                    <input type='radio' class='spell7' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='7' hidden='true'>
                    <input type='radio' class='spell8' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='8' hidden='true'>
                    <input type='radio' class='spell9' title='@{class_3_max_spell}' name='attr_class_3_max_spell' value='9' hidden='true'>
                    <span class='label daily' data-i18n='spells-per-day'>SPELLS PER DAY</span>
                    <span class='label num aspell0'>0</span>
                    <input class='label current aspell0 input-field' title='@{class_3_cantrips_per_day}' name='attr_class_3_cantrips_per_day' type='text'><span class='label slash aspell0'>/</span>
                    <input class='label max aspell0 input-field' title='@{class_3_cantrips_per_day_max}' name='attr_class_3_cantrips_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell1'>1</span>
                    <input class='label class-spells-day current aspell1 input-field' title='@{class_3_level_1_spells_per_day}' name='attr_class_3_level_1_spells_per_day' type='text'><span class='label class-spells-day slash aspell1'>/</span>
                    <input class='label class-spells-day max aspell1 input-field' title='@{class_3_level_1_spells_per_day_max}' name='attr_class_3_level_1_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell2'>2</span>
                    <input class='label class-spells-day current aspell2 input-field' title='@{class_3_level_2_spells_per_day}' name='attr_class_3_level_2_spells_per_day' type='text'><span class='label class-spells-day slash aspell2'>/</span>
                    <input class='label class-spells-day max aspell2 input-field' title='@{class_3_level_2_spells_per_day_max}' name='attr_class_3_level_2_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell3'>3</span>
                    <input class='label class-spells-day current aspell3 input-field' title='@{class_3_level_3_spells_per_day}' name='attr_class_3_level_3_spells_per_day' type='text'><span class='label class-spells-day slash aspell3'>/</span>
                    <input class='label class-spells-day max aspell3 input-field' title='@{class_3_level_3_spells_per_day_max}' name='attr_class_3_level_3_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell4'>4</span>
                    <input class='label class-spells-day current aspell4 input-field' title='@{class_3_level_4_spells_per_day}' name='attr_class_3_level_4_spells_per_day' type='text'><span class='label class-spells-day slash aspell4'>/</span>
                    <input class='label class-spells-day max aspell4 input-field' title='@{class_3_level_4_spells_per_day_max}' name='attr_class_3_level_4_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell5'>5</span>
                    <input class='label class-spells-day current aspell5 input-field' title='@{class_3_level_5_spells_per_day}' name='attr_class_3_level_5_spells_per_day' type='text'><span class='label class-spells-day slash aspell5'>/</span>
                    <input class='label class-spells-day max aspell5 input-field' title='@{class_3_level_5_spells_per_day_max}' name='attr_class_3_level_5_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell6'>6</span>
                    <input class='label class-spells-day current aspell6 input-field' title='@{class_3_level_6_spells_per_day}' name='attr_class_3_level_6_spells_per_day' type='text'><span class='label class-spells-day slash aspell6'>/</span>
                    <input class='label class-spells-day max aspell6 input-field' title='@{class_3_level_6_spells_per_day_max}' name='attr_class_3_level_6_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell7'>7</span>
                    <input class='label class-spells-day current aspell7 input-field' title='@{class_3_level_7_spells_per_day}' name='attr_class_3_level_7_spells_per_day' type='text'><span class='label class-spells-day slash aspell7'>/</span>
                    <input class='label class-spells-day max aspell7 input-field' title='@{class_3_level_7_spells_per_day_max}' name='attr_class_3_level_7_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell8'>8</span>
                    <input class='label class-spells-day current aspell8 input-field' title='@{class_3_level_8_spells_per_day}' name='attr_class_3_level_8_spells_per_day' type='text'><span class='label class-spells-day slash aspell8'>/</span>
                    <input class='label class-spells-day max aspell8 input-field' title='@{class_3_level_8_spells_per_day_max}' name='attr_class_3_level_8_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell9'>9</span>
                    <input class='label class-spells-day current aspell9 input-field' title='@{class_3_level_9_spells_per_day}' name='attr_class_3_level_9_spells_per_day' type='text'><span class='label class-spells-day slash aspell9'>/</span>
                    <input class='label class-spells-day max aspell9 input-field' title='@{class_3_level_9_spells_per_day_max}' name='attr_class_3_level_9_spells_per_day_max' type='text'>
                </div>
                <!-- Caster 4 -->
                <input class='class-4 class-spells' title='@{class_4_spells}' name='attr_class_4_spells' type='checkbox' value='1' hidden='true'>
                <div class='spellclass-container'>
                    <input class='class-4 class-show' title='@{class_4_show}' name='attr_class_4_show' titel='@{class_4_show}' type=checkbox checked='checked' value='1'>
                    <span class='class-4 class-name' title='@{class_4_name}' name='attr_class_4_name' placeholder='1st Class' readonly='true'></span>
                    <span class='class-4 class-num-level' title='@{class_4_level}' name='attr_class_4_level' placeholder='1' readonly='true'></span>
                    <span class='casting-ability' data-i18n='ability'>ABILITY</span>
                    <select class='class-4 class-ability input-field' title='@{class_4_casting_ability}' name='attr_class_4_casting_ability'>
                        <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                    </select>
                    <span CLASS='spell-progression' data-i18n='progress'>PROGRESS</span>
                    <select class='class-4 class-spell-progression input-field' title='@{class_4_spell_progression}' name='attr_class_4_spell_progression'>
                        <option value='half' data-i18n='half'>HALF</option>
                        <option value='partial' data-i18n='partial' selected>PARTIAL</option>
                        <option value='full_prep' data-i18n='full_prep'>FULL PREP</option>
                        <option value='full_spont' data-i18n='full_spont'>FULL SPONT</option>
                    </select>
                    <input type='radio' class='cantrips-only' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='0' checked='checked' hidden='true'>
                    <input type='radio' class='spell1' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='1' hidden='true'>
                    <input type='radio' class='spell2' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='2' hidden='true'>
                    <input type='radio' class='spell3' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='3' hidden='true'>
                    <input type='radio' class='spell4' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='4' hidden='true'>
                    <input type='radio' class='spell5' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='5' hidden='true'>
                    <input type='radio' class='spell6' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='6' hidden='true'>
                    <input type='radio' class='spell7' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='7' hidden='true'>
                    <input type='radio' class='spell8' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='8' hidden='true'>
                    <input type='radio' class='spell9' title='@{class_4_max_spell}' name='attr_class_4_max_spell' value='9' hidden='true'>
                    <span class='label daily' data-i18n='spells-per-day'>SPELLS PER DAY</span>
                    <span class='label num aspell0'>0</span>
                    <input class='label current aspell0 input-field' title='@{class_4_cantrips_per_day}' name='attr_class_4_cantrips_per_day' type='text'><span class='label slash aspell0'>/</span>
                    <input class='label max aspell0 input-field' title='@{class_4_cantrips_per_day_max}' name='attr_class_4_cantrips_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell1'>1</span>
                    <input class='label class-spells-day current aspell1 input-field' title='@{class_4_level_1_spells_per_day}' name='attr_class_4_level_1_spells_per_day' type='text'><span class='label class-spells-day slash aspell1'>/</span>
                    <input class='label class-spells-day max aspell1 input-field' title='@{class_4_level_1_spells_per_day_max}' name='attr_class_4_level_1_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell2'>2</span>
                    <input class='label class-spells-day current aspell2 input-field' title='@{class_4_level_2_spells_per_day}' name='attr_class_4_level_2_spells_per_day' type='text'><span class='label class-spells-day slash aspell2'>/</span>
                    <input class='label class-spells-day max aspell2 input-field' title='@{class_4_level_2_spells_per_day_max}' name='attr_class_4_level_2_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell3'>3</span>
                    <input class='label class-spells-day current aspell3 input-field' title='@{class_4_level_3_spells_per_day}' name='attr_class_4_level_3_spells_per_day' type='text'><span class='label class-spells-day slash aspell3'>/</span>
                    <input class='label class-spells-day max aspell3 input-field' title='@{class_4_level_3_spells_per_day_max}' name='attr_class_4_level_3_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell4'>4</span>
                    <input class='label class-spells-day current aspell4 input-field' title='@{class_4_level_4_spells_per_day}' name='attr_class_4_level_4_spells_per_day' type='text'><span class='label class-spells-day slash aspell4'>/</span>
                    <input class='label class-spells-day max aspell4 input-field' title='@{class_4_level_4_spells_per_day_max}' name='attr_class_4_level_4_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell5'>5</span>
                    <input class='label class-spells-day current aspell5 input-field' title='@{class_4_level_5_spells_per_day}' name='attr_class_4_level_5_spells_per_day' type='text'><span class='label class-spells-day slash aspell5'>/</span>
                    <input class='label class-spells-day max aspell5 input-field' title='@{class_4_level_5_spells_per_day_max}' name='attr_class_4_level_5_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell6'>6</span>
                    <input class='label class-spells-day current aspell6 input-field' title='@{class_4_level_6_spells_per_day}' name='attr_class_4_level_6_spells_per_day' type='text'><span class='label class-spells-day slash aspell6'>/</span>
                    <input class='label class-spells-day max aspell6 input-field' title='@{class_4_level_6_spells_per_day_max}' name='attr_class_4_level_6_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell7'>7</span>
                    <input class='label class-spells-day current aspell7 input-field' title='@{class_4_level_7_spells_per_day}' name='attr_class_4_level_7_spells_per_day' type='text'><span class='label class-spells-day slash aspell7'>/</span>
                    <input class='label class-spells-day max aspell7 input-field' title='@{class_4_level_7_spells_per_day_max}' name='attr_class_4_level_7_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell8'>8</span>
                    <input class='label class-spells-day current aspell8 input-field' title='@{class_4_level_8_spells_per_day}' name='attr_class_4_level_8_spells_per_day' type='text'><span class='label class-spells-day slash aspell8'>/</span>
                    <input class='label class-spells-day max aspell8 input-field' title='@{class_4_level_8_spells_per_day_max}' name='attr_class_4_level_8_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell9'>9</span>
                    <input class='label class-spells-day current aspell9 input-field' title='@{class_4_level_9_spells_per_day}' name='attr_class_4_level_9_spells_per_day' type='text'><span class='label class-spells-day slash aspell9'>/</span>
                    <input class='label class-spells-day max aspell9 input-field' title='@{class_4_level_9_spells_per_day_max}' name='attr_class_4_level_9_spells_per_day_max' type='text'>
                </div>
                <!-- Caster 5 -->
                <input class='class-5 class-spells' title='@{class_5_spells}' name='attr_class_5_spells' type='checkbox' value='1' hidden='true'>
                <div class='spellclass-container'>
                    <input class='class-5 class-show' title='@{class_5_show}' name='attr_class_5_show' titel='@{class_5_show}' type=checkbox checked='checked' value='1'>
                    <span class='class-5 class-name' title='@{class_5_name}' name='attr_class_5_name' placeholder='1st Class' readonly='true'></span>
                    <span class='class-5 class-num-level' title='@{class_5_level}' name='attr_class_5_level' placeholder='1' readonly='true'></span>
                    <span class='casting-ability' data-i18n='ability'>ABILITY</span>
                    <select class='class-5 class-ability input-field' title='@{class_5_casting_ability}' name='attr_class_5_casting_ability'>
                        <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                    </select>
                    <span CLASS='spell-progression' data-i18n='progress'>PROGRESS</span>
                    <select class='class-5 class-spell-progression input-field' title='@{class_5_spell_progression}' name='attr_class_5_spell_progression'>
                        <option value='half' data-i18n='half'>HALF</option>
                        <option value='partial' data-i18n='partial' selected>PARTIAL</option>
                        <option value='full_prep' data-i18n='full_prep'>FULL PREP</option>
                        <option value='full_spont' data-i18n='full_spont'>FULL SPONT</option>
                    </select>
                    <input type='radio' class='cantrips-only' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='0' checked='checked' hidden='true'>
                    <input type='radio' class='spell1' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='1' hidden='true'>
                    <input type='radio' class='spell2' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='2' hidden='true'>
                    <input type='radio' class='spell3' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='3' hidden='true'>
                    <input type='radio' class='spell4' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='4' hidden='true'>
                    <input type='radio' class='spell5' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='5' hidden='true'>
                    <input type='radio' class='spell6' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='6' hidden='true'>
                    <input type='radio' class='spell7' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='7' hidden='true'>
                    <input type='radio' class='spell8' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='8' hidden='true'>
                    <input type='radio' class='spell9' title='@{class_5_max_spell}' name='attr_class_5_max_spell' value='9' hidden='true'>
                    <span class='label daily' data-i18n='spells-per-day'>SPELLS PER DAY</span>
                    <span class='label num aspell0'>0</span>
                    <input class='label current aspell0 input-field' title='@{class_5_cantrips_per_day}' name='attr_class_5_cantrips_per_day' type='text'><span class='label slash aspell0'>/</span>
                    <input class='label max aspell0 input-field' title='@{class_5_cantrips_per_day_max}' name='attr_class_5_cantrips_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell1'>1</span>
                    <input class='label class-spells-day current aspell1 input-field' title='@{class_5_level_1_spells_per_day}' name='attr_class_5_level_1_spells_per_day' type='text'><span class='label class-spells-day slash aspell1'>/</span>
                    <input class='label class-spells-day max aspell1 input-field' title='@{class_5_level_1_spells_per_day_max}' name='attr_class_5_level_1_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell2'>2</span>
                    <input class='label class-spells-day current aspell2 input-field' title='@{class_5_level_2_spells_per_day}' name='attr_class_5_level_2_spells_per_day' type='text'><span class='label class-spells-day slash aspell2'>/</span>
                    <input class='label class-spells-day max aspell2 input-field' title='@{class_5_level_2_spells_per_day_max}' name='attr_class_5_level_2_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell3'>3</span>
                    <input class='label class-spells-day current aspell3 input-field' title='@{class_5_level_3_spells_per_day}' name='attr_class_5_level_3_spells_per_day' type='text'><span class='label class-spells-day slash aspell3'>/</span>
                    <input class='label class-spells-day max aspell3 input-field' title='@{class_5_level_3_spells_per_day_max}' name='attr_class_5_level_3_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell4'>4</span>
                    <input class='label class-spells-day current aspell4 input-field' title='@{class_5_level_4_spells_per_day}' name='attr_class_5_level_4_spells_per_day' type='text'><span class='label class-spells-day slash aspell4'>/</span>
                    <input class='label class-spells-day max aspell4 input-field' title='@{class_5_level_4_spells_per_day_max}' name='attr_class_5_level_4_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell5'>5</span>
                    <input class='label class-spells-day current aspell5 input-field' title='@{class_5_level_5_spells_per_day}' name='attr_class_5_level_5_spells_per_day' type='text'><span class='label class-spells-day slash aspell5'>/</span>
                    <input class='label class-spells-day max aspell5 input-field' title='@{class_5_level_5_spells_per_day_max}' name='attr_class_5_level_5_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell6'>6</span>
                    <input class='label class-spells-day current aspell6 input-field' title='@{class_5_level_6_spells_per_day}' name='attr_class_5_level_6_spells_per_day' type='text'><span class='label class-spells-day slash aspell6'>/</span>
                    <input class='label class-spells-day max aspell6 input-field' title='@{class_5_level_6_spells_per_day_max}' name='attr_class_5_level_6_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell7'>7</span>
                    <input class='label class-spells-day current aspell7 input-field' title='@{class_5_level_7_spells_per_day}' name='attr_class_5_level_7_spells_per_day' type='text'><span class='label class-spells-day slash aspell7'>/</span>
                    <input class='label class-spells-day max aspell7 input-field' title='@{class_5_level_7_spells_per_day_max}' name='attr_class_5_level_7_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell8'>8</span>
                    <input class='label class-spells-day current aspell8 input-field' title='@{class_5_level_8_spells_per_day}' name='attr_class_5_level_8_spells_per_day' type='text'><span class='label class-spells-day slash aspell8'>/</span>
                    <input class='label class-spells-day max aspell8 input-field' title='@{class_5_level_8_spells_per_day_max}' name='attr_class_5_level_8_spells_per_day_max' type='text'>
                    <span class='label num class-spells-day aspell9'>9</span>
                    <input class='label class-spells-day current aspell9 input-field' title='@{class_5_level_9_spells_per_day}' name='attr_class_5_level_9_spells_per_day' type='text'><span class='label class-spells-day slash aspell9'>/</span>
                    <input class='label class-spells-day max aspell9 input-field' title='@{class_5_level_9_spells_per_day_max}' name='attr_class_5_level_9_spells_per_day_max' type='text'>
                </div>
            </div>
            <div class='char-info help-container'>
                <div class='help-content'>
                    <span data-i18n='character-info-help-first-line'>This section stores all the basic information on your character. Most of these fields have no effect on the sheet itself, but there are two that do:</span>
                    <span data-i18n='character-info-help-second-line'><b>Class/Level:</b> is filled by the sheet as you enter your class(es) and level(s) in the class tab.</span>
                    <span data-i18n='character-info-help-third-line'><b>Race HP:</b> This is used by the sheet to calculate your hp and stores your racial starting hp.</span>
                </div>
                <span class='help-icon pictos'>?</span>
            </div>
            <div class='class-info help-container'>
                <div class='help-content'>
                    <span data-i18n='class-info-help-first-line'>This section stores all the basic information on your class(es). The fields are organized into the following columns:</span>
                    <span data-i18n='class-info-help-second-line'><b>Name:</b> The name of the class. This is concatenated with level to create the class/level field in the character details screen.</span>
                    <span data-i18n='class-info-help-third-line'><b>Level:</b> The level of this class. In addition to affecting the class/level field, this is used to calculate much of your character's info from health to skills</span>
                    <span data-i18n='class-info-help-fourth-line'><b>Stamina Points:</b> How many stamina points the class grants at each level.</span>
                    <span data-i18n='class-info-help-fifth-line'><b>Hit Points:</b> How many hit points the class grants at each level.</span>
                    <span data-i18n='class-info-help-sixth-line'><b>Base Attack Bonus Progression:</b> The progression of the class' BAB. 1/2 BAB classes will have a bab of 0 at level 1 and 10 at level 20. 3/4 BAB classes will have a bab of 0 at level 1 and 15 at level 20. Full BAB (or 1) will have a BAB equal to their level.</span>
                    <span data-i18n='class-info-help-seventh-line'><b>Fortitude/Reflex/Will Save Progressions:</b> The progression of the saves. There are two progressions: Good, which starts at 2, and Poor which starts at 0.</span>
                    <span data-i18n='class-info-help-eighth-line'><b>Skills/Level:</b> The number of skill points your class grants each level, not counting intelligence bonus</span>
                    <span data-i18n='class-info-help-ninth-line'><b>Key Ability:</b> The class' key ability score</span>
                    <span data-i18n='class-info-help-tenth-line'><b>Spells Checkbox:</b> Checked if the class casts spells</span>
                </div>
                <span class='help-icon pictos'>?</span>
            </div>
            <div class='spellclass-details help-container'>
                <div class='help-content'>
                    <span data-i18n='spellclass-info-help-first-line'>This section stores the details of all your spellcasting classes. A panel is created for each class that casts spells, and each panel has the following editable fields:</span>
                    <span data-i18n='spellclass-info-help-second-line'><b>Casting Ability:</b> The ability used to cast spells.</span>
                    <span data-i18n='spellclass-info-help-third-line'><b>Spell Progression:</b> How quickly the class gains new spell levels. Technomancer and Mystic are partial spell casters. Other progressions are included to support importing pathfinder classes.</span>
                    <span data-i18n='spellclass-info-help-fourth-line'><b>Spells/Day:</b> There is a current and a maximum for each spell level. These are displayed as different spell levels are gained.</span>
                </div>
                <span class='help-icon pictos'>?</span>
            </div>
        </div>
        <div class=tab-container>
            <!--Contains the core and spellcasting pc sheets. Which one is displayed depends on the first two inputs-->
            <input class="tab-button core" hidden='true' type="radio" title='@{tab}' name="attr_tab" value="core" checked='checked'>
            <input class="tab-button spells" hidden='true' type="radio" title='@{tab}' name="attr_tab" value="spells">
            <div class='page core'>
                <div class='initiative-container'>
                    <div class='section'>
                        <h1><button class='label' type='roll' title='%{initiative}' name='roll_initiative' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Initiative}} {{r1=[[1d20+@{initiative_ability}[ABILITY]@{initiative_misc}+[[(@{initiative_ability}[ABILITY]@{initiative_misc})/100)]][TIE BREAKER]&{tracker}]]}}'
                                data-i18n='initiative'>INITIATIVE</button></h1>
                    </div>
                    <div class='section-container'>
                        <input class='mod-buff' type='hidden' name='attr_initiative_change' value='0'>
                        <span class='mod tot modified-attr label' readonly='true' type='text' title='@{initiative}' name='attr_initiative' value='0'>0</span>
                        <span class='arith'>=</span>
                        <select class='label abi input-field' title='@{initiative_ability}' name='attr_initiative_ability'>
                            <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <input hidden='true' type='text' title='@{initiative_misc}' name='attr_initiative_misc' value=''>
                    </div>
                </div>
                <div class='xp-container'>
                    <span class='label' data-i18n='xp'>XP</span>
                    <input type='number' class='currxp input-field' title='@{xp}' name='attr_xp' value=''>
                    <span class='slash'>/</span>
                    <input type='number' class='maxxp input-field' title='@{xp_max}' name='attr_xp_max' value=''>
                </div>
                <!-- <div class='four-row'>contains the sections that span across the top of the core page (ability scores, health, ac, saves)-->
                <div class='section-container attributes'>
                    <div class='section'>
                        <h1 class='label' data-i18n='ability_scores'>ABILITY SCORES</h1>
                    </div>
                    <div class='attribute-container'>
                        <input type='hidden' name='attr_strength' value='10'>
                        <input type='hidden' name='attr_dexterity' value='10'>
                        <input type='hidden' name='attr_constitution' value='10'>
                        <input type='hidden' name='attr_intelligence' value='10'>
                        <input type='hidden' name='attr_wisdom' value='10'>
                        <input type='hidden' name='attr_charisma' value='10'>
                        <span class='button label'></span>
                        <span class='mod label' data-i18n='mod'>MOD</span>
                        <span class='attr-total-container label tot' data-i18n='tot'>TOT</span>
                        <span class='label pen' data-i18n='pen'>PEN</span>
                        <span class='label drain' data-i18n='drain'>DRN</span>
                        <button class='strength button' type='roll' title='%{strength}' name='roll_strength' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{strength}}} {{r1=[[1d20+@{strength_mod}]]}}' data-i18n='strength'>STRENGTH</button>
                        <span class='strength mod' type='text' title='@{strength_mod}' name='attr_strength_mod' readonly='true' value='0'>0</span>
                        <div class='strength attr-base-mod-container'>
                            <!-- sometimes, to properly restrict the formatting of a buff, it needs to be in a separate div. This div also is used when the actual value may be different from what is entered by the user -->
                            <input class='base-attr attr' type='number' title='@{strength}' name='attr_strength_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_strength_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{strength}' name='attr_strength' value='10'>10</span>
                        </div>
                        <input class='strength pen input-field' type='number' title='@{strength_penalty}' name='attr_strength_penalty' value=''>
                        <input class='strength drain input-field' type='number' title='@{strength_drain}' name='attr_strength_drain' value=''>
                        <button class='dexterity button' type='roll' title='%{dexterity}' name='roll_dexterity' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{dexterity}}} {{r1=[[1d20+@{dexterity_mod}]]}}' data-i18n='dexterity'>DEXTERITY</button>
                        <span class='dexterity mod' type='text' title='@{dexterity_mod}' name='attr_dexterity_mod' readonly='true' value='0'>0</span>
                        <div class='dexterity attr-base-mod-container'>
                            <input class='base-attr attr' type='number' title='@{dexterity}' name='attr_dexterity_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_dexterity_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{dexterity}' name='attr_dexterity' value='10'>10</span>
                        </div>
                        <input class='dexterity pen input-field' type='number' title='@{dexterity_penalty}' name='attr_dexterity_penalty' value=''>
                        <input class='dexterity drain input-field' type='number' title='@{dexterity_drain}' name='attr_dexterity_drain' value=''>
                        <button class='constitution button' type='roll' title='%{constitution}' name='roll_constitution' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{constitution}}} {{r1=[[1d20+@{constitution_mod}]]}}'
                            data-i18n='constitution'>CONSTITUTION</button>
                        <span class='constitution mod' type='text' title='@{constitution_mod}' name='attr_constitution_mod' readonly='true' value='0' value='0'>0</span>
                        <div class='constitution attr-base-mod-container'>
                            <input class='base-attr attr' type='number' title='@{constitution}' name='attr_constitution_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_constitution_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{constitution}' name='attr_constitution' value='10'>10</span>
                        </div>
                        <input class='constitution pen input-field' type='number' title='@{constitution_penalty}' name='attr_constitution_penalty' value=''>
                        <input class='constitution drain input-field' type='number' title='@{constitution_drain}' name='attr_constitution_drain' value=''>
                        <button class='intelligence button' type='roll' title='%{intelligence}' name='roll_intelligence' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{intelligence}}} {{r1=[[1d20+@{intelligence_mod}]]}}'
                            data-i18n='intelligence'>INTELLIGENCE</button>
                        <span class='intelligence mod' type='text' title='@{intelligence_mod}' name='attr_intelligence_mod' readonly='true' value='0'>0</span>
                        <div class='intelligence attr-base-mod-container'>
                            <input class='base-attr attr' type='number' title='@{intelligence}' name='attr_intelligence_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_intelligence_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{intelligence}' name='attr_intelligence' value='10'>10</span>
                        </div>
                        <input class='intelligence pen input-field' type='number' title='@{intelligence_penalty}' name='attr_intelligence_penalty' value=''>
                        <input class='intelligence drain input-field' type='number' title='@{intelligence_drain}' name='attr_intelligence_drain' value=''>
                        <button class='wisdom button' type='roll' title='%{wisdom}' name='roll_wisdom' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{wisdom}}} {{r1=[[1d20+@{wisdom_mod}]]}}' data-i18n='wisdom'>WISDOM</button>
                        <span class='wisdom mod' type='text' title='@{wisdom_mod}' name='attr_wisdom_mod' readonly='true' value='0'>0</span>
                        <div class='wisdom attr-base-mod-container'>
                            <input class='base-attr attr' type='number' title='@{wisdom}' name='attr_wisdom_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_wisdom_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{wisdom}' name='attr_wisdom' value='10'>10</span>
                        </div>
                        <input class='wisdom pen input-field' type='number' title='@{wisdom_penalty}' name='attr_wisdom_penalty' value=''>
                        <input class='wisdom drain input-field' type='number' title='@{wisdom_drain}' name='attr_wisdom_drain' value=''>
                        <button class='charisma button' type='roll' title='%{charisma}' name='roll_charisma' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{charisma}}} {{r1=[[1d20+@{charisma_mod}]]}}' data-i18n='charisma'>CHARISMA</button>
                        <span class='charisma mod' type='text' title='@{charisma_mod}' name='attr_charisma_mod' readonly='true' value='0'>0</span>
                        <div class='charisma attr-base-mod-container'>
                            <input class='base-attr attr' type='number' title='@{charisma}' name='attr_charisma_base' value='10'>
                            <input class='mod-buff' type='hidden' name='attr_charisma_change' value='0'>
                            <span class='modified-attr attr input-field' readonly='true' type='number' title='@{charisma}' name='attr_charisma' value='10'>10</span>
                        </div>
                        <input class='charisma pen input-field' type='number' title='@{charisma_penalty}' name='attr_charisma_penalty' value=''>
                        <input class='charisma drain input-field' type='number' title='@{charisma_drain}' name='attr_charisma_drain' value=''>
                    </div>
                    <div class='help-container attribute-container'>
                        <div class='help-content'>
                            <span data-i18n='attribute help first line'>This section stores your ability scores and modifiers, as well as allowing handling for ability damage, penalties, and drain.</span>
                        </div>
                        <span class='help-icon pictos'>?</span>
                    </div>
                </div>
                <div class='section-container health'>
                    <div class='section'>
                        <h1 class='label' data-i18n='health'>HEALTH</h1>
                    </div>
                    <!-- The next 4 inputs control the reactive styling of the health section based on health available -->
                    <input class='full-health' type='radio' title='@{health_status}' name='attr_health_status' readonly='true' hidden='true' value='0' checked='checked'>
                    <input class='no-sp' type='radio' title='@{health_status}' name='attr_health_status' value='1' readonly='true' hidden='true'>
                    <input class='no-hp' type='radio' title='@{health_status}' name='attr_health_status' value='2' readonly='true' hidden='true'>
                    <input class='no-rp' type='radio' title='@{health_status}' name='attr_health_status' value='3' readonly='true' hidden='true'>
                    <input type='hidden' name='attr_sp_max_misc'>
                    <input type='hidden' name='attr_hp_max_misc'>
                    <input type='hidden' name='attr_rp_max_misc'>
                    <input type='hidden' name='attr_temp_hp_max_misc'>
                    <div class='health-resolve-container section-container'>
                        <div class='health-container'>
                            <span class='health-label label stamina' data-i18n='sp'>STAMINA POINTS</span>
                            <span class='health-label label hp' data-i18n='char-hp'>HIT POINTS</span>
                            <span class='health-label label resolve' data-i18n='rp'>RESOLVE POINTS</span>
                            <span class='health-label label temp' data-i18n='temp-hp'>TEMPORARY HIT POINTS</span>
                            <span class='label max' data-i18n='total'>Total</span>
                            <span class='label current' data-i18n='current'>Current</span>
                            <input class='current temp' type='number' title='@{temp_hp}' name='attr_temp_hp' value='0'>
                            <div class='attr-total-container temp max'>
                                <input class='mod-buff' type='hidden' name='attr_temp_hp_change' value='0'>
                                <span class='max temp modified-attr' type='number' title='@{temp_hp_max}' name='attr_temp_hp_max' readonly='true' value='0' title=@{temp_hp|max}>0</span>
                            </div>
                            <input class='current stamina input-field' type='number' title='@{sp}' name='attr_sp' value='0'>
                            <div class='attr-total-container stamina max'>
                                <input class='mod-buff' type='hidden' name='attr_sp_change' value='0'>
                                <span class='max stamina modified-attr' type='number' title='@{sp_max}' name='attr_sp_max' readonly='true' value='0'>0</span>
                            </div>
                            <input class='current hp input-field' type='number' title='@{hp}' name='attr_hp' value='0'>
                            <div class='attr-total-container hp max'>
                                <input class='mod-buff' type='hidden' name='attr_hp_change' value='0'>
                                <span class='max hp modified-attr' type='number' title='@{hp_max}' name='attr_hp_max' readonly='true' value='0' title=@{hp|max}>0</span>
                            </div>
                            <input class='current resolve input-field' type='number' title='@{rp}' name='attr_rp' value='0'>
                            <div class='attr-total-container resolve max'>
                                <input class='mod-buff' type='hidden' name='attr_rp_change' value='0'>
                                <span class='max resolve modified-attr' type='number' title='@{rp_max}' name='attr_rp_max' readonly='true' value='0' title=@{rp|max}>0</span>
                            </div>
                        </div>
                    </div>
                    <div class='help-container section-container'>
                        <div class='help-content'>
                            <span data-i18n='health help first line'>This section displays your total and current health values. The hp, sp, and rp maximums are calculated based on your stats and class levels. Any items or abilities that modify these values are handled via the mods section of the item, ability, and buff repeating sections.</span>
                        </div>
                        <span class='help-icon pictos'>?</span>
                    </div>
                </div>
                <div class='section-container ac'>
                    <div class='section'>
                        <h1 class='label' data-i18n='armorclass'>ARMOR CLASS</h1>
                    </div>
                    <div class='ac-container section-container'>
                        <input type='hidden' name='attr_eac_misc'>
                        <input type='hidden' name='attr_kac_misc'>
                        <input type='hidden' name='attr_eac_armor_misc'>
                        <input type='hidden' name='attr_kac_armor_misc'>
                        <input type='hidden' name='attr_cmd_misc'>
                        <span class='ac-type'></span>
                        <span class='label tot' data-i18n='tot'>TOT</span>
                        <span class='label arm' style='font-family:Pictos Three;'>b</span>
                        <span class='label abi' data-i18n='abi'>ABI</span>
                        <div class='label ac-type' data-i18n='eac'>EAC</div>
                        <div class='attr-total-container tot'>
                            <input class='mod-buff' type='hidden' name='attr_eac_change' value='0'>
                            <span class='tot mod modified-attr' readonly='true' title='@{eac}' name='attr_eac' value='10'>10</span>
                        </div>
                        <span class='equal'>=</span>
                        <span class='base-ten'>10</span>
                        <span class='ten-plus'>+</span>
                        <div class='attr-total-container arm'>
                            <input class='mod-buff' type='hidden' name='attr_eac_armor_change' value='0'>
                            <span class='arm mod modified-attr' readonly='true' title='@{eac_armor}' name='attr_eac_armor' value='0'>0</span>
                        </div>
                        <span class='arm-plus'>+</span>
                        <select class='label abi input-field' title='@{eac_ability}' name='attr_eac_ability' style='width; .5em;'>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <span class='label ac-type' data-i18n='kac'>KAC</span>
                        <div class='attr-total-container tot'>
                            <input class='mod-buff' type='hidden' name='attr_kac_change' value='0'>
                            <span class='tot mod modified-attr' readonly='true' title='@{kac}' name='attr_kac' value='10'>10</span>
                        </div>
                        <span class='equal'>=</span>
                        <span class='base-ten'>10</span>
                        <span class='ten-plus'>+</span>
                        <div class='attr-total-container arm'>
                            <input class='mod-buff' type='hidden' name='attr_kac_armor_change' value='0'>
                            <span class='arm mod modified-attr' readonly='true' title='@{kac_armor}' name='attr_kac_armor' value='0'>0</span>
                        </div>
                        <span class='arm-plus'>+</span>
                        <select class='label abi input-field' title='@{kac_ability}' name='attr_kac_ability' style='width; .5em;'>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <span class='label ac-type' data-i18n='cmd'>CMD</span>
                        <div class='attr-total-container tot'>
                            <input class='mod-buff' type='hidden' name='attr_cmd_change' value='0'>
                            <span class='tot mod modified-attr' readonly='true' title='@{cmd}' name='attr_cmd' value='18'>18</span>
                        </div>
                        <span class='arm'></span>
                        <span class='abi'></span>
                        <span class='label dr-span' data-i18n='dr_resist'>DR/RESIST</span>
                        <input class='dr input-field' type='text' title='@{dr}' name='attr_dr' placeholder='5/- Fire 5'>
                        <textarea class='ac-notes input-field' title='@{ac_notes}' name='attr_ac_notes' placeholder='Notes'></textarea>
                    </div>
                    <div class='help-container section-container'>
                        <div class='help-content'>
                            <span data-i18n='ac help first line'>This section displays your character's armor classes and miscellaneous notes about them. Armor bonuses are handled via the mods section of the item, ability, and/or buff repeating sections below and above. You can enter armor related buffs like so:</span>
                            <span>+X armor to eac</span>
                            <span>+Y armor to kac</span>
                            <span>-Z armor to acp</span>
                            <span>U max dex to armor</span>
                        </div>
                        <span class='help-icon pictos'>?</span>
                    </div>
                </div>
                <div class='section-container saves'>
                    <div class='section'>
                        <h1 class='label' data-i18n='savingthrows'>SAVING THROWS</h1>
                    </div>
                    <div class='saving-container section-container'>
                        <div class='gutter'></div>
                        <input hidden='true' type='text' title='@{fort_misc}' name='attr_fort_misc'>
                        <input hidden='true' type='text' title='@{ref_misc}' name='attr_ref_misc'>
                        <input hidden='true' type='text' title='@{will_misc}' name='attr_will_misc'>
                        <span class='label tot' data-i18n='tot'>TOT</span>
                        <span class='label base' data-i18n='base'>BASE</span>
                        <div class='label abi' data-i18n='abi'>ABI</div>
                        <button type='roll' title='%{fort}' name='roll_fort' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Fortitude}} {{r1=[[1d20+@{fort_base}[BASE]+@{fort_ability}[ABILITY]@{fort_misc}]] }} {{notes=@{save_notes}}}'
                            data-i18n='fort'>FORT</button>
                        <div class='attr-total-container'>
                            <input class='mod-buff' type='hidden' name='attr_fort_change' value='0'>
                            <span class='mod tot modified-attr' readonly='true' type='text' title='@{fort}' name='attr_fort' value='0'>0</span>
                        </div>
                        <span class='equal'>=</span>
                        <span class='base mod' readonly='true' title='@{fort_base}' name='attr_fort_base' value='0'>0</span>
                        <span class='base-plus'>+</span>
                        <select class='label abi input-field' title='@{fort_ability}' name='attr_fort_ability' style='width; .5em;'>
                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{constitution_mod}' data-i18n='con' selected>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <button type='roll' title='%{ref}' name='roll_ref' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Reflex}} {{r1=[[1d20+@{ref_base}[BASE]+@{ref_ability}[ABILITY]@{ref_misc}]] }} {{notes=@{save_notes}}}'
                            data-i18n='ref'>REF</button>
                        <div class='attr-total-container'>
                            <input class='mod-buff' type='hidden' name='attr_ref_change' value='0'>
                            <span class='mod tot modified-attr' readonly='true' type='text' title='@{ref}' name='attr_ref' value='0'>0</span>
                        </div>
                        <span class='equal'>=</span>
                        <span class='base mod' readonly='true' title='@{ref_base}' name='attr_ref_base' value='0'>0</span>
                        <span class='base-plus'>+</span>
                        <select class='label abi input-field' title='@{ref_ability}' name='attr_ref_ability' style='width; .5em;'>
                            <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <button type='roll' title='%{will}' name='roll_will' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Will}} {{r1=[[1d20+@{will_base}[BASE]+@{will_ability}[ABILITY]@{will_misc}]] }} {{notes=@{save_notes}}}'
                            data-i18n='will'>WILL</button>
                        <div class='attr-total-container'>
                            <input class='mod-buff' type='hidden' name='attr_will_change' value='0'>
                            <span class='mod tot modified-attr' readonly='true' type='text' title='@{will}' name='attr_will' value='0'>0</span>
                        </div>
                        <span class='equal'>=</span>
                        <span class='base mod' readonly='true' title='@{will_base}' name='attr_will_base' value='0'>0</span>
                        <span class='base-plus'>+</span>
                        <select class='label abi input-field' title='@{will_ability}' name='attr_will_ability' style='width; .5em;'>
                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                            <option value='@{wisdom_mod}' data-i18n='wis' selected>WIS</option>
                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                        </select>
                        <textarea class='input-field' title='@{save_notes}' name='attr_save_notes' placeholder='Notes'></textarea>
                    </div>
                    <div class='help-container section-container'>
                        <div class='help-content'>
                            <span data-i18n='saves help first line'>This section displays your character's save bonuses and miscellaneous notes about them. The BASE column shows what bonus you receive from your class levels and is calculated by the sheet based on the information entered in the class details pane above. Any items or abilities that modify these values are handled via the mods section of the item, ability, and buff repeating sections.</span>
                        </div>
                        <span class='help-icon pictos'>?</span>
                    </div>
                </div>
                <div class='skills section-container'>
                    <input type='hidden' name='attr_skill_points_max_misc'>
                    <h1 class='section label'><span data-i18n='skills'>SKILLS</span> <span> ❙ </span> <span title='@{skill_points}' name='attr_skill_points' type='number' readonly='true'>0</span> <span>/</span>
                        <input class='mod-buff' type='hidden' name='attr_skill_points_change' value='0'>
                        <span class='skills modified-attr' title='@{skill_points_max}' name='attr_skill_points_max' type='number' readonly='true'>0</span>
                    </h1>
                    <div class='skills-container section-container'>
                        <div class='skill-container'>
                            <span class='label tot' data-i18n='tot'>TOT</span>
                            <span class='label ranks' data-i18n='rnk'>RNK</span>
                            <span class='label class-skill' data-i18n='class-skill'>CS</span>
                            <span class='label abi' data-i18n='abi'>ABI</span>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{acrobatics_show_options}' name="attr_acrobatics_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{acrobatics_misc}' name='attr_acrobatics_misc' value=''>
                                <input class='acp' type='checkbox' title='@{acrobatics_acp}' name='attr_acrobatics_acp' hidden='true' value='1' checked='checked'>
                                <button class='acp' type='roll' title='%{acrobatics}' name='roll_acrobatics' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Acrobatics}}  {{r1=[[1d20+@{acrobatics_ranks}[Ranks]+[[({0,@{acrobatics_ranks}}>1)*@{acrobatics_class_skill}]][CS]+@{acrobatics_ability}[Ability]@{acrobatics_misc}]]}} {{notes=@{acrobatics_description}}}'
                                    data-i18n='acrobatics'>ACROBATICS</button>
                                <input class='mod-buff' type='hidden' name='attr_acrobatics_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{acrobatics}' name='attr_acrobatics' value='0'>0</span>
                                <div class='arith-equal'>=</div>
                                <input class='ranks input-field' type='number' title='@{acrobatics_ranks}' name='attr_acrobatics_ranks' value=''>
                                <div class='arith-plus'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{acrobatics_class_skill}' name='attr_acrobatics_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith-plus2'>+</div>
                                <select class='label abi input-field' title='@{acrobatics_ability}' name='attr_acrobatics_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{acrobatics_acp}' name='attr_acrobatics_acp' value='1' checked='checked'>
                                </div>
                                <textarea class='skill-description input-field' title='@{acrobatics_description}' name='attr_acrobatics_description' placeholder='Notes'></textarea>
                                <input title='@{acrobatics_buff_notes}' name='attr_acrobatics_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{athletics_show_options}' name="attr_athletics_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{athletics_misc}' name='attr_athletics_misc' value=''>
                                <input class='acp' type='checkbox' title='@{athletics_acp}' name='attr_athletics_acp' hidden='true' value='1' checked='checked'>
                                <button class='acp' type='roll' title='%{athletics}' name='roll_athletics' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Athletics}}  {{r1=[[1d20+@{athletics_ranks}[RANKS]+[[({0,@{athletics_ranks}}>1)*@{athletics_class_skill}]][CS]+@{athletics_ability}[ABILITY]@{athletics_misc}]]}} {{notes=@{athletics_description}}}'
                                    data-i18n='athletics'>ATHLETICS</button>
                                <input class='mod-buff' type='hidden' name='attr_athletics_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{athletics}' name='attr_athletics' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{athletics_ranks}' name='attr_athletics_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{athletics_class_skill}' name='attr_athletics_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{athletics_ability}' name='attr_athletics_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str' selected>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{athletics_acp}' name='attr_athletics_acp' value='1' checked='checked'>
                                </div>
                                <textarea class='skill-description input-field' title='@{athletics_description}' name='attr_athletics_description' placeholder='Notes'></textarea>
                                <input title='@{athletics_buff_notes}' name='attr_athletics_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{bluff_show_options}' name="attr_bluff_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{bluff_misc}' name='attr_bluff_misc' value=''>
                                <input class='acp' type='checkbox' title='@{bluff_acp}' name='attr_bluff_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{bluff}' name='roll_bluff' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Bluff}}  {{r1=[[1d20+@{bluff_ranks}[RANKS]+[[({0,@{bluff_ranks}}>1)*@{bluff_class_skill}]][CS]+@{bluff_ability}[ABILITY]@{bluff_misc}]]}} {{notes=@{bluff_description}}}'
                                    data-i18n='bluff'>BLUFF </button>
                                <input class='mod-buff' type='hidden' name='attr_bluff_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{bluff}' name='attr_bluff' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{bluff_ranks}' name='attr_bluff_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{bluff_class_skill}' name='attr_bluff_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{bluff_ability}' name='attr_bluff_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha' selected>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{bluff_acp}' name='attr_bluff_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{bluff_description}' name='attr_bluff_description' placeholder='Notes'></textarea>
                                <input title='@{bluff_buff_notes}' name='attr_bluff_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{computers_show_options}' name="attr_computers_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{computers_misc}' name='attr_computers_misc' value=''>
                                <input class='acp' type='checkbox' title='@{computers_acp}' name='attr_computers_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{computers}' name='roll_computers' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Computers}}  {{r1=[[1d20+@{computers_ranks}[RANKS]+[[({0,@{computers_ranks}}>1)*@{computers_class_skill}]][CS]+@{computers_ability}[ABILITY]@{computers_misc}]]}} {{notes=@{computers_description}}}'
                                    data-i18n='computers'>COMPUTERS</button>
                                <input class='mod-buff' type='hidden' name='attr_computers_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{computers}' name='attr_computers' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{computers_ranks}' name='attr_computers_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{computers_class_skill}' name='attr_computers_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{computers_ability}' name='attr_computers_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{computers_acp}' name='attr_computers_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{computers_description}' name='attr_computers_description' placeholder='Notes'></textarea>
                                <input title='@{computers_buff_notes}' name='attr_computers_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{culture_show_options}' name="attr_culture_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{culture_misc}' name='attr_culture_misc' value=''>
                                <input class='acp' type='checkbox' title='@{culture_acp}' name='attr_culture_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{culture}' name='roll_culture' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Culture}}  {{r1=[[1d20+@{culture_ranks}[RANKS]+[[({0,@{culture_ranks}}>1)*@{culture_class_skill}]][CS]+@{culture_ability}[ABILITY]@{culture_misc}]]}} {{notes=@{culture_description}}}'
                                    data-i18n='culture'>CULTURE</button>
                                <input class='mod-buff' type='hidden' name='attr_culture_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{culture}' name='attr_culture' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{culture_ranks}' name='attr_culture_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{culture_class_skill}' name='attr_culture_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{culture_ability}' name='attr_culture_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{culture_acp}' name='attr_culture_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{culture_description}' name='attr_culture_description' placeholder='Notes'></textarea>
                                <input title='@{culture_buff_notes}' name='attr_culture_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{diplomacy_show_options}' name="attr_diplomacy_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{diplomacy_misc}' name='attr_diplomacy_misc' value=''>
                                <input class='acp' type='checkbox' title='@{diplomacy_acp}' name='attr_diplomacy_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{diplomacy}' name='roll_diplomacy' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Diplomacy}}  {{r1=[[1d20+@{diplomacy_ranks}[RANKS]+[[({0,@{diplomacy_ranks}}>1)*@{diplomacy_class_skill}]][CS]+@{diplomacy_ability}[ABILITY]@{diplomacy_misc}]]}} {{notes=@{diplomacy_description}}}'
                                    data-i18n='diplomacy'>DIPLOMACY</button>
                                <input class='mod-buff' type='hidden' name='attr_diplomacy_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{diplomacy}' name='attr_diplomacy' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{diplomacy_ranks}' name='attr_diplomacy_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{diplomacy_class_skill}' name='attr_diplomacy_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{diplomacy_ability}' name='attr_diplomacy_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha' selected>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{diplomacy_acp}' name='attr_diplomacy_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{diplomacy_description}' name='attr_diplomacy_description' placeholder='Notes'></textarea>
                                <input title='@{diplomacy_buff_notes}' name='attr_diplomacy_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{disguise_show_options}' name="attr_disguise_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{disguise_misc}' name='attr_disguise_misc' value=''>
                                <input class='acp' type='checkbox' title='@{disguise_acp}' name='attr_disguise_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{disguise}' name='roll_disguise' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Disguise}}  {{r1=[[1d20+@{disguise_ranks}[RANKS]+[[({0,@{disguise_ranks}}>1)*@{disguise_class_skill}]][CS]+@{disguise_ability}[ABILITY]@{disguise_misc}]]}} {{notes=@{disguise_description}}}'
                                    data-i18n='disguise'>DISGUISE</button>
                                <input class='mod-buff' type='hidden' name='attr_disguise_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{disguise}' name='attr_disguise' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{disguise_ranks}' name='attr_disguise_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{disguise_class_skill}' name='attr_disguise_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{disguise_ability}' name='attr_disguise_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha' selected>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{disguise_acp}' name='attr_disguise_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{disguise_description}' name='attr_disguise_description' placeholder='Notes'></textarea>
                                <input title='@{disguise_buff_notes}' name='attr_disguise_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{engineering_show_options}' name="attr_engineering_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{engineering_misc}' name='attr_engineering_misc' value=''>
                                <input class='acp' type='checkbox' title='@{engineering_acp}' name='attr_engineering_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{engineering}' name='roll_engineering' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Engineering}}  {{r1=[[1d20+@{engineering_ranks}[RANKS]+[[({0,@{engineering_ranks}}>1)*@{engineering_class_skill}]][CS]+@{engineering_ability}[ABILITY]@{engineering_misc}]]}} {{notes=@{engineering_description}}}'
                                    data-i18n='engineering'>ENGINEERING</button>
                                <input class='mod-buff' type='hidden' name='attr_engineering_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{engineering}' name='attr_engineering' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{engineering_ranks}' name='attr_engineering_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{engineering_class_skill}' name='attr_engineering_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{engineering_ability}' name='attr_engineering_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{engineering_acp}' name='attr_engineering_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{engineering_description}' name='attr_engineering_description' placeholder='Notes'></textarea>
                                <input title='@{engineering_buff_notes}' name='attr_engineering_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{intimidate_show_options}' name="attr_intimidate_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{intimidate_misc}' name='attr_intimidate_misc' value=''>
                                <input class='acp' type='checkbox' title='@{intimidate_acp}' name='attr_intimidate_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{intimidate}' name='roll_intimidate' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Intimidate}}  {{r1=[[1d20+@{intimidate_ranks}[RANKS]+[[({0,@{intimidate_ranks}}>1)*@{intimidate_class_skill}]][CS]+@{intimidate_ability}[ABILITY]@{intimidate_misc}]]}} {{notes=@{intimidate_description}}}'
                                    data-i18n='intimidate'>INTIMIDATE</button>
                                <input class='mod-buff' type='hidden' name='attr_intimidate_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{intimidate}' name='attr_intimidate' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{intimidate_ranks}' name='attr_intimidate_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{intimidate_class_skill}' name='attr_intimidate_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{intimidate_ability}' name='attr_intimidate_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha' selected>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{intimidate_acp}' name='attr_intimidate_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{intimidate_description}' name='attr_intimidate_description' placeholder='Notes'></textarea>
                                <input title='@{intimidate_buff_notes}' name='attr_intimidate_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{life_science_show_options}' name="attr_life_science_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{life_science_misc}' name='attr_life_science_misc' value=''>
                                <input class='acp' type='checkbox' title='@{life_science_acp}' name='attr_life_science_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{life_science}' name='roll_life_science' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Life Science}}  {{r1=[[1d20+@{life_science_ranks}[RANKS]+[[({0,@{life_science_ranks}}>1)*@{life_science_class_skill}]][CS]+@{life_science_ability}[ABILITY]@{life_science_misc}]]}} {{notes=@{life_science_description}}}'
                                    data-i18n='life-science'>LIFE SCIENCE</button>
                                <input class='mod-buff' type='hidden' name='attr_life_science_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{life_science}' name='attr_life_science' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{life_science_ranks}' name='attr_life_science_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{life_science_class_skill}' name='attr_life_science_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{life_science_ability}' name='attr_life_science_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{life_science_acp}' name='attr_life_science_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{life_science_description}' name='attr_life_science_description' placeholder='Notes'></textarea>
                                <input title='@{life_science_buff_notes}' name='attr_life_science_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{medicine_show_options}' name="attr_medicine_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{medicine_misc}' name='attr_medicine_misc' value=''>
                                <input class='acp' type='checkbox' title='@{medicine_acp}' name='attr_medicine_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{medicine}' name='roll_medicine' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Medicine}}  {{r1=[[1d20+@{medicine_ranks}[RANKS]+[[({0,@{medicine_ranks}}>1)*@{medicine_class_skill}]][CS]+@{medicine_ability}[ABILITY]@{medicine_misc}]]}} {{notes=@{medicine_description}}}'
                                    data-i18n='medicine'>MEDICINE </button>
                                <input class='mod-buff' type='hidden' name='attr_medicine_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{medicine}' name='attr_medicine' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{medicine_ranks}' name='attr_medicine_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{medicine_class_skill}' name='attr_medicine_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{medicine_ability}' name='attr_medicine_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{medicine_acp}' name='attr_medicine_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{medicine_description}' name='attr_medicine_description' placeholder='Notes'></textarea>
                                <input title='@{medicine_buff_notes}' name='attr_medicine_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{mysticism_show_options}' name="attr_mysticism_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{mysticism_misc}' name='attr_mysticism_misc' value=''>
                                <input class='acp' type='checkbox' title='@{mysticism_acp}' name='attr_mysticism_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{mysticism}' name='roll_mysticism' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Mysticism}}  {{r1=[[1d20+@{mysticism_ranks}[RANKS]+[[({0,@{mysticism_ranks}}>1)*@{mysticism_class_skill}]][CS]+@{mysticism_ability}[ABILITY]@{mysticism_misc}]]}} {{notes=@{mysticism_description}}}'
                                    data-i18n='mysticism'>MYSTICISM </button>
                                <input class='mod-buff' type='hidden' name='attr_mysticism_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{mysticism}' name='attr_mysticism' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{mysticism_ranks}' name='attr_mysticism_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{mysticism_class_skill}' name='attr_mysticism_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{mysticism_ability}' name='attr_mysticism_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis' selected>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{mysticism_acp}' name='attr_mysticism_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{mysticism_description}' name='attr_mysticism_description' placeholder='Notes'></textarea>
                                <input title='@{mysticism_buff_notes}' name='attr_mysticism_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{perception_show_options}' name="attr_perception_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{perception_misc}' name='attr_perception_misc' value=''>
                                <input class='acp' type='checkbox' title='@{perception_acp}' name='attr_perception_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{perception}' name='roll_perception' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Perception}}  {{r1=[[1d20+@{perception_ranks}[RANKS]+[[({0,@{perception_ranks}}>1)*@{perception_class_skill}]][CS]+@{perception_ability}[ABILITY]@{perception_misc}]]}} {{notes=@{perception_description}}}'
                                    data-i18n='perception'>PERCEPTION </button>
                                <input class='mod-buff' type='hidden' name='attr_perception_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{perception}' name='attr_perception' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{perception_ranks}' name='attr_perception_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{perception_class_skill}' name='attr_perception_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{perception_ability}' name='attr_perception_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis' selected>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{perception_acp}' name='attr_perception_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{perception_description}' name='attr_perception_description' placeholder='Notes'></textarea>
                                <input title='@{perception_buff_notes}' name='attr_perception_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{physical_science_show_options}' name="attr_physical_science_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{physical_science_misc}' name='attr_physical_science_misc' value=''>
                                <input class='acp' type='checkbox' title='@{physical_science_acp}' name='attr_physical_science_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{physical_science}' name='roll_physical_science' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Physical Science}}  {{r1=[[1d20+@{physical_science_ranks}[RANKS]+[[({0,@{physical_science_ranks}}>1)*@{physical_science_class_skill}]][CS]+@{physical_science_ability}[ABILITY]@{physical_science_misc}]]}} {{notes=@{physical_science_description}}}'
                                    data-i18n='physical-science'>PHYSICAL SCIENCE</button>
                                <input class='mod-buff' type='hidden' name='attr_physical_science_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{physical_science}' name='attr_physical_science' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{physical_science_ranks}' name='attr_physical_science_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{physical_science_class_skill}' name='attr_physical_science_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{physical_science_ability}' name='attr_physical_science_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{physical_science_acp}' name='attr_physical_science_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{physical_science_description}' name='attr_physical_science_description' placeholder='Notes'></textarea>
                                <input title='@{physical_science_buff_notes}' name='attr_physical_science_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{piloting_show_options}' name="attr_piloting_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{piloting_misc}' name='attr_piloting_misc' value=''>
                                <input class='acp' type='checkbox' title='@{piloting_acp}' name='attr_piloting_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{piloting}' name='roll_piloting' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Piloting}}  {{r1=[[1d20+@{piloting_ranks}[RANKS]+[[({0,@{piloting_ranks}}>1)*@{piloting_class_skill}]][CS]+@{piloting_ability}[ABILITY]@{piloting_misc}]]}} {{notes=@{piloting_description}}}'
                                    data-i18n='piloting'>PILOTING</button>
                                <input class='mod-buff' type='hidden' name='attr_piloting_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{piloting}' name='attr_piloting' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{piloting_ranks}' name='attr_piloting_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{piloting_class_skill}' name='attr_piloting_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{piloting_ability}' name='attr_piloting_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{piloting_acp}' name='attr_piloting_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{piloting_description}' name='attr_piloting_description' placeholder='Notes'></textarea>
                                <input title='@{piloting_buff_notes}' name='attr_piloting_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-fieldset'>
                            <fieldset class='repeating_profession'>
                                <input type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                                <!-- controls whether the repeating item is displayed. Had plans to use this to add the ability for people to filter their repeating sections -->
                                <div class='skill-container'>
                                    <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options"><span>y</span>
                                    <div class='display'>
                                        <input hidden='true' title='@{misc}' name='attr_misc' value=''>
                                        <input class='acp' type='checkbox' title='@{acp}' name='attr_acp' hidden='true' value='1'>
                                        <button class='acp' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}}  {{r1=[[1d20+@{ranks}[RANKS]+[[({0,@{ranks}}>1)*@{class_skill}]][CS]+@{ability}[ABILITY]@{misc}]]}} {{notes=@{description}}}'><span class='profession-name' type='text' title='@{name}' name='attr_name' value='Profession'>Profession</span></button>
                                        <input class='mod-buff' type='hidden' name='attr_change' value='0'>
                                        <input hidden='true' type='text' title='@{profession}' name='attr_profession' value='0'>
                                        <span class='mod tot modified-attr' readonly='true' type='text' title='@{profession}' name='attr_profession' value='0'>0</span>
                                        <div class='arith'>=</div>
                                        <input class='ranks input-field' type='number' title='@{ranks}' name='attr_ranks' value='0'>
                                        <div class='arith'>+</div>
                                        <div class='class-skill'><input type='checkbox' title='@{class_skill}' name='attr_class_skill' checked='checked' value='3'><span class='cs'>3</span></div>
                                        <div class='arith'>+</div>
                                        <select class='label abi input-field' title='@{ability}' name='attr_ability' style='width; .5em;'>
                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                            <option value='@{intelligence_mod}' data-i18n='int' selected>INT</option>
                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                        </select>
                                    </div>
                                    <div class='row-options'>
                                        <div class='row'>
                                            <input class='scalable-input input-field' type='text' title='@{name}' name='attr_name' value='Profession'>
                                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                                            <input class='acp' type='checkbox' title='@{acp}' name='attr_acp' value='1'>
                                        </div>
                                        <textarea class='skill-description input-field' title='@{description}' name='attr_description' placeholder='Notes'></textarea>
                                        <input readonly=true class='id-label' title='@{id}' name='attr_id'></input>
                                        <input title='@{buff_notes}' name='attr_buff_notes' hidden='true'>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{sense_motive_show_options}' name="attr_sense_motive_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{sense_motive_misc}' name='attr_sense_motive_misc' value=''>
                                <input class='acp' type='checkbox' title='@{sense_motive_acp}' name='attr_sense_motive_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{sense_motive}' name='roll_sense_motive' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Sense Motive}}  {{r1=[[1d20+@{sense_motive_ranks}[RANKS]+[[({0,@{sense_motive_ranks}}>1)*@{sense_motive_class_skill}]][CS]+@{sense_motive_ability}[ABILITY]@{sense_motive_misc}]]}} {{notes=@{sense_motive_description}}}'
                                    data-i18n='sense-motive'>SENSE MOTIVE</button>
                                <input class='mod-buff' type='hidden' name='attr_sense_motive_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{sense_motive}' name='attr_sense_motive' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{sense_motive_ranks}' name='attr_sense_motive_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{sense_motive_class_skill}' name='attr_sense_motive_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{sense_motive_ability}' name='attr_sense_motive_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis' selected>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{sense_motive_acp}' name='attr_sense_motive_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{sense_motive_description}' name='attr_sense_motive_description' placeholder='Notes'></textarea>
                                <input title='@{sense_motive_buff_notes}' name='attr_sense_motive_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{sleight_of_hand_show_options}' name="attr_sleight_of_hand_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{sleight_of_hand_misc}' name='attr_sleight_of_hand_misc' value=''>
                                <input class='acp' type='checkbox' title='@{sleight_of_hand_acp}' name='attr_sleight_of_hand_acp' hidden='true' value='1' checked='checked'>
                                <button class='acp' type='roll' title='%{sleight_of_hand}' name='roll_sleight_of_hand' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Sleight of Hand}}  {{r1=[[1d20+@{sleight_of_hand_ranks}[RANKS]+[[({0,@{sleight_of_hand_ranks}}>1)*@{sleight_of_hand_class_skill}]][CS]+@{sleight_of_hand_ability}[ABILITY]@{sleight_of_hand_misc}]]}} {{notes=@{sleight_of_hand_description}}}'
                                    data-i18n='sleight-of-hand'>SLEIGHT OF HAND</button>
                                <input class='mod-buff' type='hidden' name='attr_sleight_of_hand_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{sleight_of_hand}' name='attr_sleight_of_hand' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{sleight_of_hand_ranks}' name='attr_sleight_of_hand_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{sleight_of_hand_class_skill}' name='attr_sleight_of_hand_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{sleight_of_hand_ability}' name='attr_sleight_of_hand_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{sleight_of_hand_acp}' name='attr_sleight_of_hand_acp' value='1' checked='checked'>
                                </div>
                                <textarea class='skill-description input-field' title='@{sleight_of_hand_description}' name='attr_sleight_of_hand_description' placeholder='Notes'></textarea>
                                <input title='@{sleight_of_hand_buff_notes}' name='attr_sleight_of_hand_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{stealth_show_options}' name="attr_stealth_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{stealth_misc}' name='attr_stealth_misc' value=''>
                                <input class='acp' type='checkbox' title='@{stealth_acp}' name='attr_stealth_acp' hidden='true' value='1' checked='checked'>
                                <button class='acp' type='roll' title='%{stealth}' name='roll_stealth' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Stealth}}  {{r1=[[1d20+@{stealth_ranks}[RANKS]+[[({0,@{stealth_ranks}}>1)*@{stealth_class_skill}]][CS]+@{stealth_ability}[ABILITY]@{stealth_misc}]]}} {{notes=@{stealth_description}}}'
                                    data-i18n='stealth'>STEALTH</button>
                                <input class='mod-buff' type='hidden' name='attr_stealth_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{stealth}' name='attr_stealth' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{stealth_ranks}' name='attr_stealth_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{stealth_class_skill}' name='attr_stealth_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{stealth_ability}' name='attr_stealth_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex' selected>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{stealth_acp}' name='attr_stealth_acp' value='1' checked='checked'>
                                </div>
                                <textarea class='skill-description input-field' title='@{stealth_description}' name='attr_stealth_description' placeholder='Notes'></textarea>
                                <input title='@{stealth_buff_notes}' name='attr_stealth_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{survival_show_options}' name="attr_survival_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{survival_misc}' name='attr_survival_misc' value=''>
                                <input class='acp' type='checkbox' title='@{survival_acp}' name='attr_survival_acp' hidden='true' value='1'>
                                <button class='acp' type='roll' title='%{survival}' name='roll_survival' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Survival}}  {{r1=[[1d20+@{survival_ranks}[RANKS]+[[({0,@{survival_ranks}}>1)*@{survival_class_skill}]][CS]+@{survival_ability}[ABILITY]@{survival_misc}]]}} {{notes=@{survival_description}}}'
                                    data-i18n='survival'>SURVIVAL</button>
                                <input class='mod-buff' type='hidden' name='attr_survival_change' value='0'>
                                <span class='mod tot modified-attr' readonly='true' type='text' title='@{survival}' name='attr_survival' value='0'>0</span>
                                <div class='arith'>=</div>
                                <input class='ranks input-field' type='number' title='@{survival_ranks}' name='attr_survival_ranks' value=''>
                                <div class='arith'>+</div>
                                <div class='class-skill'><input type='checkbox' title='@{survival_class_skill}' name='attr_survival_class_skill' value='3'><span class='cs'>3</span></div>
                                <div class='arith'>+</div>
                                <select class='label abi input-field' title='@{survival_ability}' name='attr_survival_ability' style='width; .5em;'>
                                    <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                    <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                    <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                    <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                    <option value='@{wisdom_mod}' data-i18n='wis' selected>WIS</option>
                                    <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{survival_acp}' name='attr_survival_acp' value='1'>
                                </div>
                                <textarea class='skill-description input-field' title='@{survival_description}' name='attr_survival_description' placeholder='Notes'></textarea>
                                <input title='@{suvival_buff_notes}' name='attr_suvival_buff_notes' hidden='true'>
                            </div>
                        </div>
                        <div class='skill-container gutter'></div>
                    </div>
                    <div class='help-container section-container'>
                        <div class='help-content'>
                            <span data-i18n='skills help first line'>This section contains all of your skills. Profession skills may be added by clicking the plus sign.</span>
                        </div>
                        <span class='help-icon pictos'>?</span>
                    </div>
                </div>
                <div class='combat'>
                    <input type='radio' class='section section-check proficiencies-tab' name='attr_combat_view' value='proficiency' checked='checked'></input>
                    <div class='section head proficiencies-tab'>
                        <h1 class='label' data-i18n='combat-proficiencies'>WEAPON & ARMOR PROFICIENCIES</h1>
                    </div>
                    <input type='radio' class='section section-check items' name='attr_combat_view' value='items'></input>
                    <div class='section head items'>
                        <h1 class='label' data-i18n='equipment'>EQUIPMENT</h1>
                    </div>
                    <input type='radio' class='section section-check attacks' name='attr_combat_view' value='attacks'></input>
                    <div class='section head attacks'>
                        <h1 class='label' data-i18n='attacks'>ATTACKS</h1>
                    </div>
                    <input type='radio' class='section section-check abilities' name='attr_combat_view' value='abilities'></input>
                    <div class='section head abilities'>
                        <h1 class='label' data-i18n='abilities'>ABILITIES</h1>
                    </div>
                    <input class='is-caster' title='@{caster_select}' name='attr_caster_select' type='checkbox' value='1' hidden='true'>
                    <input type='radio' class='section section-check spells' name='attr_combat_view' value='spells'></input>
                    <div class='section head spells'>
                        <h1 class='label' data-i18n='spells'>SPELLS</h1>
                    </div>
                    <div class='section-container proficiency-section'>
                        <div class='section-container'>
                            <span class='light-armor label' data-i18n='light-armor'>LIGHT ARMOR</span>
                            <select title='@{light_armor_proficiency}' name='attr_light_armor_proficiency' class='light-armor select input-field'>
                                <option value='no' data-i18n='Not-Proficient'>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient' selected>PROFICIENT</option>
                            </select>
                            <span class='heavy-armor label' data-i18n='heavy-armor'>HEAVY ARMOR</span>
                            <select title='@{heavy_armor_proficiency}' name='attr_heavy_armor_proficiency' class='heavy-armor select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                            </select>
                            <span class='power-armor label' data-i18n='power-armor'>POWER ARMOR</span>
                            <select title='@{power_armor_proficiency}' name='attr_power_armor_proficiency' class='power-armor select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                            </select>
                            <span class='basic-melee label' data-i18n='basic-melee'>BASIC MELEE</span>
                            <select title='@{basic_melee_proficiency}' name='attr_basic_melee_proficiency' class='basic-melee select input-field'>
                                <option value='no' data-i18n='Not-Proficient'>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient' selected>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                            <span class='advanced-melee label' data-i18n='advanced-melee'>ADVANCED MELEE</span>
                            <select title='@{advanced_melee_proficiency}' name='attr_advanced_melee_proficiency' class='advanced-melee select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                            <div class='prof-gutter'></div>
                            <span class='small-arms label' data-i18n='small-arms'>SMALL ARMS</span>
                            <select title='@{small_arm_proficiency}' name='attr_small_arm_proficiency' class='small-arms select input-field'>
                                <option value='no' data-i18n='Not-Proficient'>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient' selected>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                            <span class='longarms label' data-i18n='longarms'>LONGARMS</span>
                            <select title='@{longarm_proficiency}' name='attr_longarm_proficiency' class='longarms select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                            <span class='heavy-weapons label' data-i18n='heavy-weapons'>HEAVY WEAPONS</span>
                            <select title='@{heavy_weapon_proficiency}' name='attr_heavy_weapon_proficiency' class='heavy-weapons select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                            <span class='grenades label' data-i18n='grenades'>GRENADES</span>
                            <select title='@{grenade_proficiency}' name='attr_grenade_proficiency' class='grenades select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                            </select>
                            <span class='snipers label' data-i18n='snipers'>SNIPERS</span>
                            <select title='@{sniper_proficiency}' name='attr_sniper_proficiency' class='snipers select input-field'>
                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                                <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                            </select>
                        </div>
                    </div>
                    <div class='weapons section-container'>
                        <div class='button-description'>
                            <span data-i18n='name'>NAME</span>
                            <span data-i18n='attack'>ATTACK</span>
                            <span class='span-two' data-i18n='damage'>DAMAGE</span>
                            <span data-i18n='type'>TYPE</span>
                        </div>
                        <fieldset class='repeating_attack'>
                            <input class='filter' type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                            <div class='filter-container attack'>
                                <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                                <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                                <div class='row-options'>
                                    <div class='group'>
                                        <span class='label' data-i18n='name-u'>NAME</span>
                                        <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol' value=''>
                                        <span class='label' data-i18n='lvl'>LVL</span>
                                        <input class='atk-level bab-input input-field' type='text' title='@{level}' name='attr_level' value='0'>
                                        <select class='label proficiency input-field' title='@{proficiency}' name='attr_proficiency'>
                                            <option value='no' data-i18n='Not-Proficient'>NOT PROFICIENT</option>
                                            <option value='yes' data-i18n='proficient' selected>PROFICIENT</option>
                                            <option value='specialized' data-i18n='specialized'>SPECIALIZED</option>
                                        </select>
                                        
                                        <input hidden='true' type='text' title='@{proficiency_value}' name='attr_proficiency_value' value='0'>
                                        <input hidden='true' type='text' title='@{damage_proficiency_value}' name='attr_damage_proficiency_value' value='0'>
                                        <span class='label' data-i18n='category'>CATEGORY</span>
                                        <select class='weapon-cat input-field' type='text' title='@{category}' name='attr_category'>
                                            <option value = '' data-i18n='select' selected>SELECT</option>
                                            <option value = 'basic_melee' data-i18n='basic_melee' selected>BASIC MELEE</option>
                                            <option value = 'advanced_melee' data-i18n='advanced_melee'>ADVANCED MELEE</option>
                                            <option value = 'small_arm' data-i18n='small_arm'>SMALL ARM</option>
                                            <option value = 'longarm' data-i18n='longarm'>LONGARM</option>
                                            <option value = 'heavy' data-i18n='heavy'>HEAVY WEAPON</option><option value = 'grenade' data-i18n='grenade'>GRENADE</option>
                                            <option value = 'sniper' data-i18n='sniper'>SNIPER</option>
                                            <option value = 'special' data-i18n='special'>SPECIAL</option>
                                        </select>
                                    </div>
                                    <div class='group'>
                                        <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                        <select class='label atk-ability abi input-field' title='@{ability}' name='attr_ability'>
                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                        </select>
                                        <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                        <span class='arith'>+</span>
                                        <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                        <input class='atk-misc misc small-input input-field' type='text' title='@{bonus}' name='attr_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                        <span class='label' data-i18n='rng'>RANGE</span>
                                        <input class='atk-range small-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft' value=''>
                                        <select class='label atk-range-type input-field' title='@{engagement_range}' name='attr_engagement_range'>
                                            <option value='melee' data-i18n='melee' selected>MELEE</option>
                                            <option value='ranged' data-i18n='ranged'>RANGED</option>
                                        </select>
                                    </div>
                                    <div class='group'>
                                        <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                        <input class='dmg-dice medium-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                        <span>+</span>
                                        <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                        </select>
                                        <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                        <input class='atk-type small-input input-field' type='text' title='@{type}' name='attr_type' placeholder='Fire' value=''>
                                        <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                        <input class='atk-crit small-input input-field' type='text' title='@{crit}' name='attr_crit' placeholder='Burn [[1d6]]' value=''>
                                    </div>
                                    <div class='group'>
                                        <span class='label' data-i18n='special'>SPECIAL</span>
                                        <input class='atk-special small-input input-field' type='text' title='@{special}' name='attr_special' placeholder='heirloom' value=''>
                                        <input class='label small-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                        <input class='bab-input' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                        <span class='label'>/</span>
                                        <input class='input-field bab-input' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                        <span class='label' data-i18n='usage'>USAGE</span>
                                        <input class='atk-usage medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='1 charge' value=''>
                                    </div>
                                    <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                    <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                            <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}' checked='checked'><span class='label'  data-i18n='query'>QUERY</span></label>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'><span class='label'  data-i18n='never'>NEVER</span></label>
                                            <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                            <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                            <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                            <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                    </div>
                                    <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                    <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                        <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                        <div class='help-container mods'>
                                            <div class='help-content'>
                                                <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                            </div>
                                            <span class='help-icon pictos'>?</span>
                                        </div>
                                    </div>
                                    <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                    <input readonly=true class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                                <div class='display'>
                                    <div class='button-description'>
                                        <input title='@{name}' type='text' name='attr_name' placeholder='Laser Rifle'>
                                        <div class='attr-total-container'>
                                            <input class='mod-buff' type='hidden' name='attr_total_change' value='0'>
                                            <span class='label modified-attr' title='@{total}' name='attr_total' value='0'>0</span>
                                        </div>
                                        <div class='attr-total-container span-two'>
                                            <input class='mod-buff' type='hidden' name='attr_damage_total_change' value='0'>
                                            <span class='label modified-attr' title='@{damage_total}' name='attr_damage_total' value='0'>0</span>
                                        </div>
                                        <input type='text' class='label' title='@{type}' name='attr_type' placeholder='Fire'>
                                        <button class='summary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1name=@{name}}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage1type=@{type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1effect=@{crit}}} {{r2name=@{name}}} {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]+@{proficiency_value}[PROF]+[[@{full_attack_penalty}]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage2type=@{type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2effect=@{crit}}} {{r3name=@{name}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]+@{proficiency_value}[PROF]+@{full_attack_penalty}[FULL ATTACK]@{misc}@{bonus}]]}} {{damage3type=@{type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3effect=@{crit}}} {{r4name=@{name}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]+@{proficiency_value}[PROF]+@{full_attack_penalty}[FULL ATTACK]@{misc}@{bonus}]]}} {{damage4type=@{type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4effect=@{crit}}} {{r5name=@{name}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]+@{proficiency_value}[PROF]+@{full_attack_penalty}[FULL ATTACK]@{misc}@{bonus}]]}} {{damage5type=@{type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5effect=@{crit}}} {{range=@{range}}} {{ammo_type=@{ammo_type}}} {{curr_ammo=@{ammo}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'></button>
                                        <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                    </div>
                                    <input class='expand-description' type='hidden' name='attr_expand_description'>
                                    <textarea class='description span-all' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class='equipment section-container'>
                        <input type='radio' title='@{encumber_level}' name='attr_encumber_level' hidden='true' value='0' checked='checked'>
                        <input type='hidden' name='attr_encumber_bulk_misc'>
                        <input type='hidden' name='attr_overburden_bulk_misc'>
                        <div class='bulk-container carried'>
                            <span class='number scalable-input' title='@{carried_bulk}' name='attr_carried_bulk' readonly='true' value='0'>0</span>
                            <span class='label' data-i18n='carried'>CARRIED</span>
                        </div>
                        <input class='encumbered' type='radio' title='@{encumber_level}' name='attr_encumber_level' hidden='true' value='1'>
                        <div class='bulk-container encumber'>
                            <input class='mod-buff' type='hidden' name='attr_encumber_bulk_change' value='0'>
                            <span class='number modified-attr' name=attr_encumber_bulk readonly='true' value='5'>5</span>
                            <span class='label' data-i18n='encumber'>ENCUMBER</span>
                        </div>
                        <input class='overburdened' type='radio' title='@{encumber_level}' name='attr_encumber_level' hidden='true' value='2'>
                        <div class='bulk-container overburden'>
                            <input class='mod-buff' type='hidden' name='attr_overburden_bulk_change' value='0'>
                            <span class='number modified-attr' title='@{overburden_bulk}' name='attr_overburden_bulk' readonly='true' value='10'>10</span>
                            <span class='label' data-i18n='over'>OVER</span>
                        </div>
                        <div class='credits-container credits'>
                            <input class='input-field' type='number' title='@{credits}' name='attr_credits' value='0'>
                            <span class='label' data-i18n='credits'>CREDITS</span>
                        </div>
                        <div class='credits-container wealth'>
                            <span type='number' title='@{wealth}' name='attr_wealth' readonly='true' value='0'>0</span>
                            <span class='label' data-i18n='wealth'>WEALTH</span>
                        </div>
                        <div class='credits-container upb'>
                            <input class='input-field' type='number' title='@{upb}' name='attr_upb' value='0'>
                            <span class='label' data-i18n='upbs'>UPBs</span>
                        </div>
                        <div class='item-container'>
                            <div class='button-description'>
                                <span data-i18n='name'>NAME</span>
                                <span data-i18n='level'>LEVEL</span>
                                <span data-i18n='quantity'>QUANTITY</span>
                                <span data-i18n='bulk'>BULK</span>
                                <span data-i18n='cost'>COST</span>
                            </div>
                            <fieldset class='repeating_item'>
                                <input class='filter' type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                                <div class='filter-container item'>
                                    <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                    <div class='row-options'>
                                        <div class='group'>
                                            <span class='label' data-i18n='name-u'>NAME</span>
                                            <input class='item-name large-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol'>
                                            <span class='label' data-i18n='level'>LEVEL</span>
                                            <input class='level bab-input' type='number' title='@{level}' name='attr_level' placeholder='1'>
                                            <span class='label' data-i18n='num'>NUM</span>
                                            <input class='item-quantity bab-input input-field' type='text' title='@{quantity}' name='attr_quantity' placeholder='1'>
                                            <span class='label' data-i18n='bulk'>BULK</span>
                                            <input class='item-quantity bab-input input-field' type='text' title='@{bulk}' name='attr_bulk' placeholder='1'>
                                            <span class='label' data-i18n='cost'>COST</span>
                                            <input class='item-quantity bab-input input-field' type='text' title='@{cost}' name='attr_cost' placeholder='1'>
                                            <span class='label' data-i18n='uses'>USES</span>
                                            <input class='bab-input' type='number' title='@{uses}' name='attr_uses' value='0'>
                                            <span class='label'>/</span>
                                            <div class='tiny-input attr-base-mod-container'>
                                                <input class='base-attr ability-uses' type='text' title='@{uses_max}' name='attr_uses_max_base' value='10'>
                                                <input class='mod-buff' type='hidden' name='attr_uses_change' value='0'>
                                                <span class='input-field modified-attr attr ability-uses' readonly='true' type='text' title='@{uses_max}' name='attr_uses_max' value='10'>10</span>
                                            </div>
                                        </div>
                                        <div class='group'>
                                            <select class='item-equip input-field' title='@{equipped}' name='attr_equipped'>
                                                <option value='equipped' data-i18n='equipped' selected>EQUIPPED</option>
                                                <option value='carried' data-i18n='carried'>CARRIED</option>
                                                <option value='not carried' data-i18n='not carried'>NOT CARRIED</option>
                                            </select>
                                            <select class='input-field' title='@{purpose}' name='attr_purpose'>
                                                <option value='' data-i18n='purpose' selected>PURPOSE</option>
                                                <option value='armor' data-i18n='armor'>ARMOR</option>
                                                <option value='weapon' data-i18n='weapon'>WEAPON</option>
                                                <option value='equipment' data-i18n='equipment'>EQUIPMENT</option>
                                            </select>
                                            <input class='purpose-filter' type='hidden' name='attr_purpose'>
                                            <select title='@{type}' class='armor-purpose input-field' name='attr_type'>
                                                <option value='' data-i18n='armor-type' selected>ARMOR TYPE</option>
                                                <option value='light_armor' data-i18n='light-armor'>LIGHT ARMOR</option>
                                                <option value='heavy_armor' data-i18n='heavy-armor'>HEAVY ARMOR</option>
                                                <option value='power_armor' data-i18n='power-armor'>POWER ARMOR</option>
                                            </select>
                                            <select title='@{proficiency}' class='armor-purpose input-field' name='attr_proficiency'>
                                                <option value='no' data-i18n='Not-Proficient' selected>NOT PROFICIENT</option>
                                                <option value='yes' data-i18n='proficient'>PROFICIENT</option>
                                            </select>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab mods-tab item-mods' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'><span class='label field' data-i18n='mods'>MODS</span></label>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <div class='manual-mod field-container group expandable'>
                                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='mods-help-first-line'>This textarea is used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                                                    <span data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                                                    <span data-i18n='armor-help-third-line'><b>Entering Armor Mods:</b> The mods syntax can handle eac and kac bonuses, armor check penalty, and maximum dexterity bonuses:</span>
                                                    <span>+X armor to eac</span>
                                                    <span>+Y armor to kac</span>
                                                    <span>-Z armor to acp</span>
                                                    <span>U max dex to armor</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <button class='wizard-mod' type='action' name='act_mod'>
                                            <span title='@{mods}' name='attr_mods'>Click to add bonuses</span>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='wizard-mods-help-first-line'>This textarea is display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </button>
                                        <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                        <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                        <div class='field-container group expandable'>
                                            <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                            <div class='help-container mods'>
                                                <div class='help-content'>
                                                    <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                        <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                    </div>
                                    <div class='display'>
                                        <div class='button-description'>
                                            <span title='@{name}' name='attr_name'></span>
                                            <span name='attr_level'></span>
                                            <span name='attr_quantity'></span>
                                            <span name='attr_bulk'></span>
                                            <span name='attr_cost'></span>
                                            <button class='summary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{r1name=Quantity}} {{r1=@{quantity}}} {{r2name=Bulk}} {{r2=@{bulk}}} {{r3name=Value}} {{r3=@{cost}}} {{notes=@{description}}} @{attacher}'></button>
                                            <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                        </div>
                                        <input class='expand-description' type='hidden' name='attr_expand_description'>
                                        <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class='abilities-container section-container'>
                        <div class='button-description'>
                            <span class='label' type='text' data-i18n='name'>NAME</span>
                            <span class='label' type='text' data-i18n='source'>SOURCE</span>
                            <span class='label' type='text' data-i18n='ability-type'>ABILITY TYPE</span>
                            <span class='label span-two' type='text' data-i18n='usage'>USAGE</span>
                        </div>
                        <fieldset class='repeating_ability'>
                            <input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'>
                            <input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                            <input class='filter' type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                            <div class='filter-container ability'>
                                <!--Hidden Ability Attributes -->
                                <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                <input type='text' hidden='true' title='@{attack_damage_misc}' name='attr_attack_damage_misc' value=''>
                                <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                <!--Shown Ability Attributes -->
                                <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                <div class='row-options'>
                                    <div class='group'>
                                        <span class='label' data-i18n='name-u'>NAME</span>
                                        <input class='large-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                        <select class='freq-select' title='@{frequency}' name='attr_frequency'>
                                            <option value='constant' data-i18n='constant' selected>CONSTANT</option>
                                            <option value='at-will' data-i18n='at-will'>AT WILL</option>
                                            <option value='daily-limit' data-i18n='x/day'>X/DAY</option>
                                        </select>
                                        <span class='label' data-i18n='source'>SOURCE</span>
                                        <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                        <select title='@{type}' name='attr_type'>
                                            <option value='EX' data-i18n='extraordinary' selected>EX</option>
                                            <option value='SU' data-i18n='supernatural'>SU</option>
                                            <option value='SP' data-i18n='spell-like'>SP</option>
                                        </select>
                                    </div>
                                    <div class='group'>
                                        <span class='label' data-i18n='target'>TARGET</span>
                                        <input class='small-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                        <span class='label' data-i18n='rng'>RANGE</span>
                                        <input class='small-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                        <span class='label' data-i18n='duration'>DURATION</span>
                                        <input class='small-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                        <input class='type-filter' type='hidden' name='attr_type' value='EX'>
                                        <div class='type-span'>
                                            <span class='label' data-i18n='level'>LEVEL</span>
                                            <input class='bab-input atk-level input-field' type='number' name='attr_level' value='0'>
                                            <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                            <input type='hidden' name='attr_spell_penetration_misc' value=''><select name='attr_spell_resistance'>
                                                <option value='' data-i18n='no' selected>NO</option>
                                                <option value='yes' data-i18n='yes'>YES</option>
                                            </select>
                                        </div>
                                    </div>
                                    <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                                    <div class='group at-will'>
                                        <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                                        <span class='label abi-cost at-will' data-i18n='usage'>USAGE</span>
                                        <input class='tiny-input input-field at-will' type='text' title='@{usage}' name='attr_usage' placeholder='move action, 1 resolve point'>
                                        <span class='daily-limit label' data-i18n='_-daily-uses'>Daily Uses</span>
                                        <input class='daily-limit' type='number' title='@{uses}' name='attr_uses' value='0'>
                                        <span class='daily-limit label'>/</span>
                                        <div class='daily-limit tiny-input attr-base-mod-container'>
                                            <input class='base-attr ability-uses' type='text' title='@{uses_max}' name='attr_uses_max_base' value='10'>
                                            <input class='mod-buff' type='hidden' name='attr_uses_change' value='0'>
                                            <span class='input-field modified-attr attr ability-uses' readonly='true' type='text' title='@{uses_max}' name='attr_uses_max' value='10'>10</span>
                                        </div>
                                    </div>
                                    <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                    <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                        <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                        </select>
                                        <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                        <span class='arith'>+</span>
                                        <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                        <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                    </div>
                                    <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                    <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                        <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                        <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                        <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                        </select>
                                        <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                        <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                        <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                        <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                        <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                    </div>
                                    <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                    <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                            <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                            <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                            <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                            <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                            <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                            <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                    </div>
                                    <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                    <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                    <div class='field-container expandable group'>
                                        <div class='group'>
                                            <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                <option value='0' selected data-i18n='n/a'>N/A</option>
                                                <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                            </select>
                                            <span class='label' data-i18n='based-dc_'>Based DC </span>
                                            <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                            <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                            <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                            <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                <option value='save' selected>-</option>
                                                <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                            </select>
                                        </div>
                                        <div class='group'>
                                            <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                        </div>
                                        <div class='group'>
                                            <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                        </div>
                                        <div class='group'>
                                            <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                        </div>
                                    </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab mods-tab item-mods' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'><span class='label field' data-i18n='mods'>MODS</span></label>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <div class='manual-mod field-container group expandable'>
                                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='mods-help-first-line'>This textarea is used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                                                    <span data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                                                    <span data-i18n='armor-help-third-line'><b>Entering Armor Mods:</b> The mods syntax can handle eac and kac bonuses, armor check penalty, and maximum dexterity bonuses:</span>
                                                    <span>+X armor to eac</span>
                                                    <span>+Y armor to kac</span>
                                                    <span>-Z armor to acp</span>
                                                    <span>U max dex to armor</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <button class='wizard-mod' type='action' name='act_mod'>
                                            <span title='@{mods}' name='attr_mods'>Click to add bonuses</span>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='wizard-mods-help-first-line'>This textarea is display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </button>
                                    <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                    <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                    <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                    <div class='field-container group expandable'>
                                        <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                        <div class='help-container mods'>
                                            <div class='help-content'>
                                                <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                            </div>
                                            <span class='help-icon pictos'>?</span>
                                        </div>
                                    </div>
                                    <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                    <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                </div>
                                <div class='display'>
                                    <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                                    <input class='freq-check at-will' type='checkbox' title='@{toggle}' name='attr_toggle' value='1'>
                                    <div class='button-description'>
                                        <input class='label' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol'>
                                        <input class='label' type='text' name='attr_source' placeholder='Operative'>
                                        <input class='label force-uppercase' type='text' name='attr_type'>
                                        <input class='const-check' name='attr_frequency' type='hidden'>
                                        <input class='label span-two constant force-uppercase' type='text' name='attr_frequency'>
                                        <input class='label span-two not-constant' type='text' name='attr_usage'>
                                        <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{rightbanner=@{source}}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{character_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{type}}} {{notes=@{description}}} @{attacher}'></button>
                                        <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                    </div>
                                    <input class='expand-description' type='hidden' name='attr_expand_description'>
                                    <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class='spell-containers'>
                        <div class='spell-column'>
                            <input type='hidden' class='spell-levels-display' title='@{char_max_spell}' name='attr_char_max_spell'>
                            <div class='section-container aspell0'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='cantrips'>CANTRIPS</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell cantrip'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_cantrip}' name='attr_create_cantrip' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell2 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='2nd-level'>2nd LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell second'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_2nd}' name='attr_create_2nd' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell4 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='4th-level'>4th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell fourth'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_4th}' name='attr_create_4th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell6 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='6th-level'>6th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell sixth'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_6th}' name='attr_create_6th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell8 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='8th-level'>8th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell eighth'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_8th}' name='attr_create_8th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class='spell-column'>
                            <input type='hidden' class='spell-levels-display' title='@{char_max_spell}' name='attr_char_max_spell'>
                            <div class='section-container aspell1 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='1st-level'>1st LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell first'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_1st}' name='attr_create_1st' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell3 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='3rd-level'>3rd LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell third'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_3rd}' name='attr_create_3rd' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell5 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='5th-level'>5th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell fifth'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_5th}' name='attr_create_5th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell7 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='7th-level'>7th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell seventh'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_7th}' name='attr_create_7th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                            <div class='section-container aspell9 class-spells-day'>
                                <div class='section'>
                                    <h1 class='label' data-i18n='9th-level'>9th LEVEL</h1>
                                </div>
                                <div class='section-container'>
                                    <div class='button-description'>
                                        <span class='label' data-i18n='name'>NAME</span>
                                        <span class='label' data-i18n='school'>SCHOOL</span>
                                    </div>
                                    <fieldset class='repeating_spell'><input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'><input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                                        <input class='filter' type='hidden' title='@{filter}' name='attr_filter'>
                                        <div class='filter-container spell ninth'>
                                            <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                                            <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                                            <div class='row-options'>
                                                <div class='group'>
                                                    <span class='label' data-i18n='name-u'>NAME</span>
                                                    <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                                    <span class='label' data-i18n='lvl'>LVL</span>
                                                    <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='source'>SOURCE</span>
                                                    <input class='medium-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='school'>SCHOOL</span>
                                                    <input class='medium-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='target'>TARGET</span>
                                                    <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                                    <span class='label' data-i18n='rng'>RNG</span>
                                                    <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                                </div>
                                                <div class='group'>
                                                    <span class='label' data-i18n='duration'>DURATION</span>
                                                    <input class='medium-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                                </div>
                                                <div class='group'>
                                                    <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                                    <input class='medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                                    <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                                    <select name='attr_spell_resistance'>
                                                        <option value='' data-i18n='no' selected>NO</option>
                                                        <option value='yes' data-i18n='yes'>YES</option>
                                                    </select>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <select class='label atk-ability abi' title='@{attack_ability}' name='attr_attack_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input hidden='true' title='@{attack_ability}' name='attr_attack_ability' value='0'>
                                                    <span class='arith'>+</span>
                                                    <input class='bab-input' title='@{base_attack_bonus}' name='attr_base_attack_bonus' readonly='true' value='0'>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <input hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                                                    <input class='tiny-input input-field' type='text' name=attr_damage_dice placeholder='1d8'><span>+</span>
                                                    <select class='label atk-ability abi' title='@{damage_ability}' name='attr_damage_ability'>
                                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                    </select>
                                                    <input type='text' hidden='true' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                                    <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                                    <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                                        <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                        <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                                        <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                                                <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                                                <div class='field-container expandable group'>
                                                    <div class='group'>
                                                        <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                                            <option value='0' selected data-i18n='n/a'>N/A</option>
                                                            <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                                            <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                                            <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                                            <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                                            <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                                            <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                                        </select>
                                                        <span class='label' data-i18n='based-dc_'>Based DC </span>
                                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                                        <input title='@{dc}' name='attr_dc' type='number' value='10' hidden='true'>
                                                        <span class='save-dc modified-attr label' title='@{dc}' name='attr_dc' value='10'>10</span>
                                                        <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                                            <option value='save' selected>-</option>
                                                            <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                                            <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                                            <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                                        </select>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                                    </div>
                                                    <div class='group'>
                                                        <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                                    </div>
                                                    <div class='group'>
                                                        <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                                    </div>
                                                </div>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                                <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                                <div class='field-container group expandable'>
                                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                                    <div class='help-container mods'>
                                                        <div class='help-content'>
                                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                                        </div>
                                                        <span class='help-icon pictos'>?</span>
                                                    </div>
                                                </div>
                                                <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                                <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                                            </div>
                                            <div class='display'>
                                                <div class='button-description'>
                                                    <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                                    <input class='label' name='attr_school' placeholder='Abjuration'>
                                                    <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus}[BAB]+@{attack_ability}[ABILITY]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                                    <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                                                </div>
                                                <input class='expand-description' type='hidden' name='attr_expand_description'>
                                                <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                    <label class='pseudo-repcontrol spell'>
                                        <input type='checkbox' title='@{create_9th}' name='attr_create_9th' value='1'>
                                        <span>&</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container npc">
        <div class='statblock'>
            <div class='statblock-header'>
                <input class='scalable-input char-name' type='text' title='@{character_name}' name='attr_character_name'>
                <span class='cr label' data-i18n='cr'>CR</span>
                <input class='cr' type='text' title='@{character_level}' name='attr_character_level' value='' placeholder='1/3'>
            </div>
            <div class='row'>
                <span class='xp label' data-i18n='xp'>XP</span>
                <input class='xp' type='text' title='@{xp}' name='attr_xp' placeholder='200'>
            </div>
            <div class='row'>
                <input class='scalable-input input-field' type='text' title='@{race}' name='attr_race' placeholder='RACE & GRAFTS'>
            </div>
            <div class='row'>
                <input class='alignment' type='text' title='@{alignment}' name='attr_alignment' placeholder='NE'>
                <select class='size' title='@{size}' name='attr_size'>
                    <option value='-4' data-i18n='fine'>FINE</option>
                    <option value='-3' data-i18n='diminutive'>DIMINUTIVE</option>
                    <option value='-2' data-i18n='tiny'>TINY</option>
                    <option value='-1' data-i18n='small'>SMALL</option>
                    <option value='0' data-i18n='medium' selected>MEDIUM</option>
                    <option value='1' data-i18n='large'>LARGE</option>
                    <option value='2' data-i18n='huge'>HUGE</option>
                    <option value='3' data-i18n='gargantuan'>GARGANTUAN</option>
                    <option value='4' data-i18n='colossal'>COLOSSAL</option>
                </select>
                <input class='scalable-input input-field' type='text' title='@{type_subtype}' name='attr_type_subtype' placeholder='Type (subtype)'>
            </div>
            <div class='row initiative-row'>
                <button class='label' type='roll' title='%{npc_initiative}' name='roll_npc_initiative' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Initiative}} {{r1=[[1d20+@{initiative_base}[BASE]+[[@{dexterity_mod}-@{dexterity_base}]][DEX Buffs]@{initiative_misc}+[[(@{initiative_base}+[[@{dexterity_mod}-@{dexterity_base}]]@{initiative_misc})/100)]][TIE BREAKER]&{tracker}]]}}'
                    data-i18n='init'>INIT</button>
                <div class='attr-base-mod-container init'>
                    <input class='base-attr input-field' type='number' title='@{initiative}' name='attr_initiative_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_initiative_change' value='0'>
                    <span class='modified-attr input-field' title='@{initiative}' name='attr_initiative' value='0'>0</span>
                </div>
                <input hidden='true' type='text' title='@{initiative_misc}' name='attr_initiative_misc' value=''>
                <span class='senses label' data-i81n='senses'>SENSES</span>
                <input class='senses input-field' type='text' title='@{senses}' name='attr_senses' placeholder='Darkvision (60ft)'>
            </div>
            <div class='row ability-scores'>
                <button class='perception label' data-i18n='perception' title='%{npc_perception}' type='roll' name='roll_npc_perception' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Perception}}  {{r1=[[1d20+@{perception_base}[Base]+[[@{wisdom_mod}-({@{perception_base},0}>1)*@{wisdom_base}]][Ability Buffs]@{perception_misc}]]}} {{notes=@{perception_description}}}'>PERCEPTION</button>
                <div class='attr-base-mod-container perception'>
                    <input class='base-attr' type='number' title='@{perception}' name='attr_perception_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_perception_change' value='0'>
                    <span class='modified-attr input-field' name='attr_perception'>0</span>
                </div>
            </div>
            <div class='row'>
                <span class='aura label' data-i18n='aura'>AURA</span>
                <input class='aura scalable-input input-field' type='text' title='@{aura}' name='attr_aura' placeholder='Unnatural Aura (30ft)'>
            </div>
            <div class='statblock-section-header defense-header'>
                <span data-i18n='defense'>DEFENSE</span>
                <div class='hp-rp-container'>
                    <span class='hp' data-i18n='hp'>HP</span>
                    <input class='hp' type='number' title='@{hp}' name='attr_hp' placeholder='20'>
                    <span class='slash'>/</span>
                    <input class='hp' type='number' title='@{hp_max}' name='attr_hp_max' placeholder='20'>
                    <span class='rp' data-18n='rp'>RP</span>
                    <input class='rp' type='number' title='@{rp}' name='attr_rp' value='0'>
                    <span class='slash'>/</span>
                    <input class='rp' type='number' title='@{rp_max}' name='attr_rp_max' value='0'>
                </div>
            </div>
            <div class='row defense-row'>
                <span class='npc-ac' data-i18n='eac'>EAC</span>
                <div class='attr-base-mod-container npc-ac'>
                    <input class='base-attr' type='number' title='@{eac}' name='attr_eac_base' value='10'>
                    <input class='mod-buff' type='hidden' name='attr_eac_change' value='0'>
                    <span class='modified-attr input-field' title='@{eac}' name='attr_eac' value='10'>10</span>
                </div>
                <span class='npc-ac' data-i18n='kac'>KAC</span>
                <div class='attr-base-mod-container npc-ac'>
                    <input class='base-attr' type='number' title='@{kac}' name='attr_kac_base' value='10'>
                    <input class='mod-buff' type='hidden' name='attr_kac_change' value='0'>
                    <span class='modified-attr input-field' title='@{kac}' name='attr_kac' value='10'>10</span>
                </div>
                <span class='npc-ac' data-i18n='cmd'>CMD</span>
                <div class='attr-base-mod-container npc-ac'>
                    <input class='base-attr' type='number' title='@{cmd}' name='attr_cmd_base' value='10'>
                    <input class='mod-buff' type='hidden' name='attr_cmd_change' value='0'>
                    <span class='modified-attr input-field' title='@{kac}' name='attr_cmd' value='10'>10</span>
                </div>
                <input class='npc-ac-notes input-field' type='text' title='@{ac_notes}' name='attr_ac_notes' placeholder='AC Notes'>
            </div>
            <div class='row defense-row'>
                <button class='npc-save' type='roll' title='%{npc_fort}' name='roll_npc_fort' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Fortitude}} {{r1=[[1d20+@{fort_base}[BASE]+[[@{constitution_mod}-@{constitution_base}]][ABILITY BUFFS]@{fort_misc}]] }} {{notes=@{save_notes}}}'
                    data-i18n='fort'>FORT</button>
                <div class='attr-base-mod-container npc-save'>
                    <input class='base-attr' type='number' title='@{fort}' name='attr_fort_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_fort_change' value='0'>
                    <span class='modified-attr input-field' title='@{fort}' name='attr_fort' value='0'>0</span>
                </div>
                <button class='npc-save' type='roll' title='%{npc_ref}' name='roll_npc_ref' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Ref}} {{r1=[[1d20+@{ref_base}[BASE]+[[@{dexterity_mod}-@{dexterity_base}]][ABILITY BUFFS]@{ref_misc}]] }} {{notes=@{save_notes}}}'
                    data-i18n='ref'>REF</button>
                <div class='attr-base-mod-container npc-save'>
                    <input class='base-attr' type='number' title='@{ref}' name='attr_ref_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_ref_change' value='0'>
                    <span class='modified-attr input-field' title='@{ref}' name='attr_ref' value='0'>0</span>
                </div>
                <button class='npc-save' type='roll' title='%{npc_will}' name='roll_npc_will' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Will}} {{r1=[[1d20+@{will_base}[BASE]+[[@{wisdom_mod}-@{wisdom_base}]][ABILITY BUFFS]@{will_misc}]] }} {{notes=@{save_notes}}}'
                    data-i18n='will'>WILL</button>
                <div class='attr-base-mod-container npc-save'>
                    <input class='base-attr' type='number' title='@{will}' name='attr_will_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_will_change' value='0'>
                    <span class='modified-attr input-field' title='@{will}' name='attr_will' value='0'>0</span>
                </div>
                <input class='npc-save-notes input-field' type='text' title='@{save_notes}' name='attr_save_notes' placeholder='Save Notes'>
            </div>
            <div class='row'>
                <span class='def-abilities' data-i18n='defensive-abilities'>DEFENSIVE ABILITIES</span>
                <input class='def-abilities scalable-input input-field' type='text' title='@{defensive_abilities}' name='attr_defensive_abilities'>
            </div>
            <div class='row'>
                <span class='dr' data-i18n='dr'>DR</span>
                <input class='scalable-input input-field' type='text' title='@{dr}' name='attr_dr'>
                <span class='immunities' data-i18n='immunities'>IMMUNITIES</span>
                <input class='immunities scalable-input input-field' type='text' title='@{immunities}' name='attr_immunities'>
                <span class='sr' data-i18n='sr'>SR</span>
                <input class='sr' type='number' title='@{sr}' name='attr_sr'>
            </div>
            <div class='row'>
                <span class='resistances' data-i18n='resistances'>RESISTANCES</span>
                <input class='resistances scalable-input input-field' type='text' title='@{resistances}' name='attr_resistances'>
                <span class='weaknesses' data-i18n='weaknesses'>WEAKNESSES</span>
                <input class='weaknesses scalable-input input-field' type='text' title='@{weaknesses}' name='attr_weaknesses'>
            </div>
            <div class='statblock-section-header offense-header'>
                <span data-i18n='offense'>OFFENSE</span>
            </div>
            <div class='row'>
                <span data-i18n='speed'>SPEED</span>
                <input class='speed scalable-input input-field' type='text' title='@{speed}' name='attr_speed'>
            </div>
            <div class='attack-row'>
                <span class='attack-label label' data-i18n='melee'>MELEE</span>
                <fieldset class='repeating_attack'>
                    <input hidden='true' type='text' title='@{proficiency_value}' name='attr_proficiency_value' value='0'>
                    <input hidden='true' type='text' title='@{damage_proficiency_value}' name='attr_damage_proficiency_value' value='0'>
                    <input class='filter' type='radio' hidden='true' title='@{range_filter}' name='attr_range_filter' value='melee' checked='checked'>
                    <input type='radio' hidden='true' title='@{range_filter}' name='attr_range_filter' value='ranged'>
                    <div class='filter-container attack'>
                        <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol' value=''>
                                <span class='label' data-i18n='lvl'>LVL</span>
                                <input class='atk-level bab-input input-field' type='text' title='@{level}' name='attr_level' value='0'>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                            </div>
                            <div class='group'>
                                <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{ability}' name='attr_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                                <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='atk-type medium-input input-field' type='text' title='@{type}' name='attr_type' placeholder='Fire' value=''>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='atk-crit medium-input input-field' type='text' title='@{crit}' name='attr_crit' placeholder='Burn [[1d6]]' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='rng'>RANGE</span>
                                <input class='atk-range small-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft' value=''>
                                <select class='label atk-range-type input-field' title='@{engagement_range}' name='attr_engagement_range'>
                                    <option value='melee' data-i18n='melee' selected>MELEE</option>
                                    <option value='ranged' data-i18n='ranged'>RANGED</option>
                                    <option value='multiattack' data-i18n='multiattack'>MULTIATTACK</option>
                                </select>
                                <input class='label small-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                <input class='bab-input' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                <span class='label'>/</span>
                                <input class='bab-input input-field' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='usage'>USAGE</span>
                                <input class='atk-usage medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='1 charge' value=''>
                                <span class='label' data-i18n='special'>SPECIAL</span>
                                <input class='atk-special medium-input input-field' type='text' title='@{special}' name='attr_special' placeholder='heirloom' value=''>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}' checked='checked'><span class='label'  data-i18n='query'>QUERY</span></label>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'><span class='label'  data-i18n='never'>NEVER</span></label>
                                <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                            </div>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                            <input readonly=true class='id-label' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <div class='button-description'>
                                <input class='label' title='@{name}' type='text' name='attr_name' placeholder='Laser Rifle'>
                                <div class='attr-total-container'>
                                    <input class='mod-buff' type='hidden' name='attr_total_change' value='0'>
                                    <span class='label modified-attr' title='@{total}' name='attr_total' value='0'>0</span>
                                </div>
                                <div class='attr-total-container span-two'>
                                    <input class='mod-buff' type='hidden' name='attr_damage_total_change' value='0'>
                                    <span class='label modified-attr' title='@{damage_total}' name='attr_damage_total' value='0'>0</span>
                                </div>
                                <input type='text' class='label' title='@{type}' name='attr_type' placeholder='Fire'>
                                <button class='summary' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1name=@{name}}} {{r1=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage1type=@{type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1effect=@{crit}}} {{r2name=@{name}}} {{r2=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage2type=@{type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2effect=@{crit}}} {{r3name=@{name}}} {{r3=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage3type=@{type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3effect=@{crit}}} {{r4name=@{name}}} {{r4=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage4type=@{type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4effect=@{crit}}} {{r5name=@{name}}} {{r5=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage5type=@{type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5effect=@{crit}}} {{range=@{range}}} {{ammo_type=@{ammo_type}}} {{curr_ammo=@{ammo}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description span-all' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
                <label class='pseudo-repcontrol'><input type='checkbox' title='@{create_npcmelee}' name='attr_create_npcmelee' value='melee'><span>&</span></label>
            </div>
            <div class='attack-row'>
                <input type='hidden' name='attr_multiattack_macro' value='{{notes=^{add multiattack}}}'>
                <span class='attack-label label' data-i18n='multiattack'>MULTIATTACK</span>
                <button class='multiattack-button' type='roll' name='roll_multiattack' data-i18n='multiattack' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{multiattack}}} @{multiattack_macro}'></button>
                <fieldset class='repeating_attack'>
                    <input hidden='true' type='text' title='@{proficiency_value}' name='attr_proficiency_value' value='0'>
                    <input hidden='true' type='text' title='@{damage_proficiency_value}' name='attr_damage_proficiency_value' value='0'>
                    <input type='radio' hidden='true' title='@{range_filter}' name='attr_range_filter' value='melee' checked='checked'>
                    <input type='radio' class='filter' hidden='true' title='@{range_filter}' name='attr_range_filter' value='multiattack'>
                    <div class='filter-container attack'>
                        <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol' value=''>
                                <span class='label' data-i18n='lvl'>LVL</span>
                                <input class='atk-level bab-input input-field' type='text' title='@{level}' name='attr_level' value='0'>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                            </div>
                            <div class='group'>
                                <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{ability}' name='attr_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                                <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='atk-type medium-input input-field' type='text' title='@{type}' name='attr_type' placeholder='Fire' value=''>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='atk-crit medium-input input-field' type='text' title='@{crit}' name='attr_crit' placeholder='Burn [[1d6]]' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='rng'>RANGE</span>
                                <input class='atk-range small-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft' value=''>
                                <select class='label atk-range-type input-field' title='@{engagement_range}' name='attr_engagement_range'>
                                    <option value='melee' data-i18n='melee' selected>MELEE</option>
                                    <option value='ranged' data-i18n='ranged'>RANGED</option>
                                    <option value='multiattack' data-i18n='multiattack'>MULTIATTACK</option>
                                </select>
                                <input class='label small-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                <input class='bab-input' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                <span class='label'>/</span>
                                <input class='bab-input input-field' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='usage'>USAGE</span>
                                <input class='atk-usage medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='1 charge' value=''>
                                <span class='label' data-i18n='special'>SPECIAL</span>
                                <input class='atk-special medium-input input-field' type='text' title='@{special}' name='attr_special' placeholder='heirloom' value=''>
                            </div>
                            <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                            <input class='bab-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                            <input readonly=true class='id-label' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <div class='button-description'>
                                <input class='label' title='@{name}' type='text' name='attr_name' placeholder='Laser Rifle'>
                                <div class='attr-total-container'>
                                    <input class='mod-buff' type='hidden' name='attr_total_change' value='0'>
                                    <span class='label modified-attr' title='@{total}' name='attr_total' value='0'>0</span>
                                </div>
                                <div class='attr-total-container span-two'>
                                    <input class='mod-buff' type='hidden' name='attr_damage_total_change' value='0'>
                                    <span class='label modified-attr' title='@{damage_total}' name='attr_damage_total' value='0'>0</span>
                                </div>
                                <input type='text' class='label' title='@{type}' name='attr_type' placeholder='Fire'>
                                <button class='summary' type='roll' title='%{npc_multiattack}' name='roll_npc_multiattack' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{multiattack}}} @{multiattack_macro}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description span-all' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
                <label class='pseudo-repcontrol'><input type='checkbox' title='@{create_npcmelee}' name='attr_create_npcmultiattack' value='multiattack'><span>&</span></label>
            </div>
            <div class='attack-row'>
                <span class='attack-label label' data-i18n='ranged'>RANGED</span>
                <fieldset class='repeating_attack'>
                    <input hidden='true' type='text' title='@{proficiency_value}' name='attr_proficiency_value' value='0'>
                    <input hidden='true' type='text' title='@{damage_proficiency_value}' name='attr_damage_proficiency_value' value='0'>
                    <input type='radio' hidden='true' title='@{range_filter}' name='attr_range_filter' value='melee' checked='checked'>
                    <input class='filter' type='radio' hidden='true' title='@{range_filter}' name='attr_range_filter' value='ranged'>
                    <div class='filter-container attack'>
                        <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='atk-name medium-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol' value=''>
                                <span class='label' data-i18n='lvl'>LVL</span>
                                <input class='atk-level bab-input input-field' type='text' title='@{level}' name='attr_level' value='0'>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                            </div>
                            <div class='group'>
                                <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{ability}' name='attr_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                                <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                    <option value='0' selected data-i18n='n/a'>N/A</option>
                                    <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                    <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                    <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                    <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                    <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                    <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                </select>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='atk-type medium-input input-field' type='text' title='@{type}' name='attr_type' placeholder='Fire' value=''>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='atk-crit medium-input input-field' type='text' title='@{crit}' name='attr_crit' placeholder='Burn [[1d6]]' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='rng'>RANGE</span>
                                <input class='atk-range small-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft' value=''>
                                <select class='label atk-range-type input-field' title='@{engagement_range}' name='attr_engagement_range'>
                                    <option value='melee' data-i18n='melee' selected>MELEE</option>
                                    <option value='ranged' data-i18n='ranged'>RANGED</option>
                                    <option value='multiattack' data-i18n='multiattack'>MULTIATTACK</option>
                                </select>
                                <input class='label small-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                <input class='bab-input' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                <span class='label'>/</span>
                                <input class='bab-input input-field' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='usage'>USAGE</span>
                                <input class='atk-usage medium-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='1 charge' value=''>
                                <span class='label' data-i18n='special'>SPECIAL</span>
                                <input class='atk-special medium-input input-field' type='text' title='@{special}' name='attr_special' placeholder='heirloom' value=''>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}' checked='checked'><span class='label'  data-i18n='query'>QUERY</span></label>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'><span class='label'  data-i18n='never'>NEVER</span></label>
                                <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                            </div>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                            <input readonly=true class='id-label' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <div class='button-description'>
                                <input class='label' title='@{name}' type='text' name='attr_name' placeholder='Laser Rifle'>
                                <div class='attr-total-container'>
                                    <input class='mod-buff' type='hidden' name='attr_total_change' value='0'>
                                    <span class='label modified-attr' title='@{total}' name='attr_total' value='0'>0</span>
                                </div>
                                <div class='attr-total-container span-two'>
                                    <input class='mod-buff' type='hidden' name='attr_damage_total_change' value='0'>
                                    <span class='label modified-attr' title='@{damage_total}' name='attr_damage_total' value='0'>0</span>
                                </div>
                                <input type='text' class='label' title='@{type}' name='attr_type' placeholder='Fire'>
                                <button class='summary' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1name=@{name}}} {{r1=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage1type=@{type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit1effect=@{crit}}} {{r2name=@{name}}} {{r2=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage2type=@{type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit2effect=@{crit}}} {{r3name=@{name}}} {{r3=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage3type=@{type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit3effect=@{crit}}} {{r4name=@{name}}} {{r4=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage4type=@{type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit4effect=@{crit}}} {{r5name=@{name}}} {{r5=[[1d20+@{base_attack_bonus_base}[BAB]+@{ability}[ABILITY BUFFS]+@{proficiency_value}[PROF]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{misc}@{bonus}]]}} {{damage5type=@{type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]+@{damage_proficiency_value}[SPEC]@{damage_misc}]]}} {{crit5effect=@{crit}}} {{range=@{range}}} {{ammo_type=@{ammo_type}}} {{curr_ammo=@{ammo}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description span-all' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
                <label class='pseudo-repcontrol'><input type='checkbox' title='@{create_npcranged}' name='attr_create_npcranged' value='ranged'><span>&</span></label>
            </div>
            <div class='row'>
                <span data-i18n='space'>SPACE</span>
                <input class='space' type='text' title='@{space}' name='attr_space' value='5 ft'>
                <span data-i18n='reach'>REACH</span>
                <input class='reach scalable-input input-field' type='text' title='@{reach}' name='attr_reach'>
            </div>
            <div class='row'>
                <span data-i18n='spell-like abilities'>SPELL-LIKE ABILITIES</span>
                <span>(</span>
                <span data-i18n='cl'>CL</span>
                <input class='cl' type='number' title='@{spell_like_caster_level}' name='attr_spell_like_caster_level'>
                <span data-i18n='melee'>MELEE</span>
                <input class='cl' type='number' title='@{melee_spell_like_attack}' name='attr_melee_spell_like_attack'>
                <span data-i18n='ranged'>RANGED</span>
                <input class='cl' type='number' title='@{ranged_spell_like_attack}' name='attr_ranged_spell_like_attack'>
                <span>)</span>
            </div>
            <div class='spell-like-row'>
                <fieldset class='repeating_ability'>
                    <input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'>
                    <input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                    <input class='filter' type='hidden' hidden='true' title='@{filter}' name='attr_type' value='EX'>
                    <div class='filter-container ability'>
                        <!--Hidden Ability Attributes -->
                        <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                        <input type='hidden' name='attr_dc' value='10'>
                        <!--Shown Ability Attributes -->
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='small-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                <select class='freq-select' title='@{frequency}' name='attr_frequency'>
                                    <option value='constant' data-i18n='constant' selected>CONSTANT</option>
                                    <option value='at-will' data-i18n='at-will'>AT WILL</option>
                                    <option value='daily-limit' data-i18n='x/day'>X/DAY</option><option value='hourly-limit' data-i18n='x/hour'>X/HOUR</option><option value='other-limit' data-i18n='x/other'>X/OTHER</option>
                                </select>
                                <span class='label' data-i18n='source'>SOURCE</span>
                                <input class='tiny-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                <select title='@{type}' name='attr_type'>
                                    <option value='EX' data-i18n='extraordinary' selected>EX</option>
                                    <option value='SU' data-i18n='supernatural'>SU</option>
                                    <option value='SP' data-i18n='spell-like'>SP</option>
                                </select>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='target'>TARGET</span>
                                <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                <span class='label' data-i18n='rng'>RANGE</span>
                                <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                <span class='label' data-i18n='duration'>DURATION</span>
                                <input class='tiny-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                <input class='type-filter' type='hidden' name='attr_type' value='EX'>
                                <div class='type-span'>
                                    <span class='label' data-i18n='level'>LEVEL</span>
                                    <input class='bab-input atk-level input-field' type='number' name='attr_level' value='0'>
                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                    <input type='hidden' name='attr_spell_penetration_misc' value=''><select name='attr_spell_resistance'>
                                        <option value='' data-i18n='no' selected>NO</option>
                                        <option value='yes' data-i18n='yes'>YES</option>
                                    </select>
                                </div>
                            </div>
                            <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                            <div class='group at-will'>
                                <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                                <span class='label abi-cost at-will' data-i18n='usage'>USAGE</span>
                                <input class='tiny-input input-field at-will' type='text' title='@{usage}' name='attr_usage' placeholder='move action, 1 resolve point'>
                                <span class='daily-limit label' data-i18n='_-daily-uses'>Daily Uses</span>
                                <input class='daily-limit' type='number' title='@{uses}' name='attr_uses' value='0'>
                                <span class='daily-limit label'>/</span>
                                <div class='daily-limit tiny-input attr-base-mod-container'>
                                    <input class='base-attr ability-uses' type='text' title='@{uses_max}' name='attr_uses_max_base' value='10'>
                                    <input class='mod-buff' type='hidden' name='attr_uses_change' value='0'>
                                    <span class='input-field modified-attr attr ability-uses' readonly='true' type='text' title='@{uses_max}' name='attr_uses_max' value='10'>10</span>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                    <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                    <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                    <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                    <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                    <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{attack_ability}' name='attr_attack_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                    <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                    <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                    <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                    <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <div class='field-container expandable group'>
                                <div class='group'>
                                    <span class='label' data-i18n='dc'>DC</span>
                                    <div class='attr-base-mod-container save-dc bab-input'>
                                        <input class='base-attr' type='number' title='@{dc}' name='attr_dc_base' value='10'>
                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                        <span class='modified-attr input-field' title='@{dc}' name='attr_dc' value='10'>10</span>
                                    </div>
                                    <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                        <option value='save' selected>-</option>
                                        <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                        <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                        <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                    </select>
                                    <span class='label' data-i18n='dc-affected-by-buffs-to'>DC AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                </div>
                                <div class='group'>
                                    <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                </div>
                            </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab mods-tab item-mods' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'><span class='label field' data-i18n='mods'>MODS</span></label>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <div class='manual-mod field-container group expandable'>
                                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='mods-help-first-line'>This textarea is used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                                                    <span data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                                                    <span data-i18n='armor-help-third-line'><b>Entering Armor Mods:</b> The mods syntax can handle eac and kac bonuses, armor check penalty, and maximum dexterity bonuses:</span>
                                                    <span>+X armor to eac</span>
                                                    <span>+Y armor to kac</span>
                                                    <span>-Z armor to acp</span>
                                                    <span>U max dex to armor</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <button class='wizard-mod' type='action' name='act_mod'>
                                            <span title='@{mods}' name='attr_mods'>Click to add bonuses</span>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='wizard-mods-help-first-line'>This textarea is display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </button>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                            <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                            <input class='freq-check at-will' type='checkbox' title='@{toggle}' name='attr_toggle' value='1'>
                            <div class='button-description'>
                                <input class='label' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol'>
                                <input class='label' type='text' name='attr_source' placeholder='Operative'>
                                <input class='label force-uppercase' type='text' name='attr_type'>
                                <input class='const-check' name='attr_frequency' type='hidden'>
                                <input class='label span-two constant force-uppercase' type='text' name='attr_frequency'>
                                <input class='label span-two not-constant' type='text' name='attr_usage'>
                                <button class='npcsummary' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{rightbanner=@{source}}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20 + @{character_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{type}}} {{notes=@{description}}} @{attacher}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
                <label class='pseudo-repcontrol'><input type='checkbox' title='@{create_spell_like}' name='attr_create_spell_like' value='spell-like'><span>&</span></label>
            </div>
            <div class='row'>
                <span data-i18n='spells-known'>SPELLS KNOWN</span>
                <span>(</span>
                <span data-i18n='cl'>CL</span>
                <input class='cl' type='number' title='@{caster_level}' name='attr_caster_level'>
                <span data-i18n='melee'>MELEE</span>
                <input class='cl' type='number' title='@{melee_spell_attack}' name='attr_melee_spell_attack'>
                <span data-i18n='ranged'>RANGED</span>
                <input class='cl' type='number' title='@{ranged_spell_attack}' name='attr_ranged_spell_attack'>
                <span>)</span>
                <fieldset class='repeating_spell'>
                    <input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'>
                    <input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                    <div class='spell'>
                        <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                        <input type='hidden' name='attr_dc' value='10'>
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='atk-name small-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                <span class='label' data-i18n='lvl'>LVL</span>
                                <input class='bab-input' title='@{level}' name='attr_level' type='text' value=''>
                                <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                <input type='hidden' name='attr_spell_penetration_misc' value=''>
                                <select name='attr_spell_resistance'>
                                    <option value='' data-i18n='no' selected>NO</option>
                                    <option value='yes' data-i18n='yes'>YES</option>
                                </select>
                                <span class='label' data-i18n='school'>SCHOOL</span>
                                <input class='small-input input-field' title='@{school}' name='attr_school' type='text' placeholder='abjuration'>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='source'>SOURCE</span>
                                <input class='small-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                <span class='label' data-i18n='target'>TARGET</span>
                                <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                <span class='label' data-i18n='rng'>RNG</span>
                                <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                <span class='label' data-i18n='duration'>DURATION</span>
                                <input class='tiny-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                            </div>
                            <div class='group'>
                                <span class='label abi-cost' data-i18n='usage'>USAGE</span>
                                <input class='small-input input-field' type='text' title='@{usage}' name='attr_usage' placeholder='Standard Action'>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                    <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                    <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                    <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                    <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                    <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{attack_ability}' name='attr_attack_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                    <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                    <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                    <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                    <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <div class='field-container expandable group'>
                                <div class='group'>
                                    <span class='label' data-i18n='dc'>DC</span>
                                    <div class='attr-base-mod-container save-dc bab-input'>
                                        <input class='base-attr' type='number' title='@{dc}' name='attr_dc_base' value='10'>
                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                        <span class='modified-attr input-field' title='@{dc}' name='attr_dc' value='10'>10</span>
                                    </div>
                                    <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                        <option value='save' selected>-</option>
                                        <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                        <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                        <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                    </select>
                                    <span class='label' data-i18n='dc-affected-by-buffs-to'>DC AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                </div>
                                <div class='group'>
                                    <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                </div>
                            </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab mods-tab item-mods' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'><span class='label field' data-i18n='mods'>MODS</span></label>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <div class='manual-mod field-container group expandable'>
                                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='mods-help-first-line'>This textarea is used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                                                    <span data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                                                    <span data-i18n='armor-help-third-line'><b>Entering Armor Mods:</b> The mods syntax can handle eac and kac bonuses, armor check penalty, and maximum dexterity bonuses:</span>
                                                    <span>+X armor to eac</span>
                                                    <span>+Y armor to kac</span>
                                                    <span>-Z armor to acp</span>
                                                    <span>U max dex to armor</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <button class='wizard-mod' type='action' name='act_mod'>
                                            <span title='@{mods}' name='attr_mods'>Click to add bonuses</span>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='wizard-mods-help-first-line'>This textarea is display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </button>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                            <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <div class='button-description'>
                                <input class='label' title='@{name}' name='attr_name' placeholder='Operative'>
                                <input class='label' name='attr_school' placeholder='Abjuration'>
                                <button class='npcsummary' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{rightbanner=@{school}}} {{title=@{name}}} {{leftbanner=^{level} [[[[@{level}]]d1cs>2cf>2]]}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20+@{caster_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}}{{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{school}}}{{notes=@{description}}} @{attacher}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class='statblock-section-header statistics-header'>
                <span data-i18n='statistics'>STATISTICS</span>
            </div>
            <div class='row ability-scores'>
                <button class='button label' type='roll' title='%{strength}' name='roll_strength' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{strength}}} {{r1=[[1d20+@{strength_mod}]]}}' data-i18n='str'>STR</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_strength_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field'>-</span>
                    <input class='base-attr' type='text' title='@{strength_mod}' name='attr_strength_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_strength_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{strength_mod}' name='attr_strength_mod' value='0'>0</span>
                </div>
                <button class='button label' type='roll' title='%{dexterity}' name='roll_dexterity' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{dexterity}}} {{r1=[[1d20+@{dexterity_mod}]]}}' data-i18n='dex'>DEX</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_dexterity_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field'>-</span>
                    <input class='base-attr input-field' type='text' title='@{dexterity_mod}' name='attr_dexterity_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_dexterity_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{dexterity_mod}' name='attr_dexterity_mod' value='0'>0</span>
                </div>
                <button class='button label' type='roll' title='%{constitution}' name='roll_constitution' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{constitution}}} {{r1=[[1d20+@{constitution_mod}]]}}' data-i18n='con'>CON</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_constitution_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field'>-</span>
                    <input class='base-attr input-field' type='text' title='@{constitution_mod}' name='attr_constitution_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_constitution_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{constitution_mod}' name='attr_constitution_mod' value='0'>0</span>
                </div>
                <button class='button label' type='roll' title='%{intelligence}' name='roll_intelligence' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{intelligence}}} {{r1=[[1d20+@{intelligence_mod}]]}}' data-i18n='int'>INT</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_intelligence_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field'>-</span>
                    <input class='base-attr input-field' type='text' title='@{intelligence_mod}' name='attr_intelligence_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_intelligence_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{intelligence_mod}' name='attr_intelligence_mod' value='0'>0</span>
                </div>
                <button class='button label' type='roll' title='%{wisdom}' name='roll_wisdom' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{wisdom}}} {{r1=[[1d20+@{wisdom_mod}]]}}' data-i18n='wis'>WIS</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_wisdom_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field'>-</span>
                    <input class='base-attr input-field' type='text' title='@{wisdom_mod}' name='attr_wisdom_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_wisdom_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{wisdom_mod}' name='attr_wisdom_mod' value='0'>0</span>
                </div>
                <button class='button label' type='roll' title='%{charisma}' name='roll_charisma' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{charisma}}} {{r1=[[1d20+@{charisma_mod}]]}}' data-i18n='cha'>CHA</button>
                <div class='input-field attr-base-mod-container init'>
                    <input class='invalid-detector' type='hidden'name='attr_charisma_base' value='0'>
                    <span class='invalid-display input-field modified-attr input-field label'>-</span>
                    <input class='base-attr input-field' type='text' title='@{charisma_mod}' name='attr_charisma_base' value='0'>
                    <input class='mod-buff' type='hidden' name='attr_charisma_mod_change' value='0'>
                    <span class='modified-attr input-field' title='@{charisma_mod}' name='attr_charisma_mod' value='0'>0</span>
                </div>
            </div>
            <div class='row skills-row'>
                <span data-i18n='skills'>SKILLS</span>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{acrobatics_show_options}' name="attr_acrobatics_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{acrobatics_misc}' name='attr_acrobatics_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{acrobatics_ranks}' name='attr_acrobatics_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{acrobatics_class_skill}' name='attr_acrobatics_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_acrobatics}' name='roll_npc_acrobatics' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Acrobatics}}  {{r1=[[1d20+@{acrobatics_base}+[[@{dexterity_mod}-({@{acrobatics_base},0}>1)*@{dexterity_base}]][Ability Buffs]@{acrobatics_misc}]]}} {{notes=@{acrobatics_description}}}'
                            data-i18n='acrobatics'>ACROBATICS</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{acrobatics}' name='attr_acrobatics_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_acrobatics_change' value='0'>
                            <span class='modified-attr input-field' title='@{acrobatics}' name='attr_acrobatics' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{acrobatics_acp}' name='attr_acrobatics_acp' value='1' checked='checked'>
                        </div>
                        <textarea class='skill-description input-field' title='@{acrobatics_description}' name='attr_acrobatics_description' placeholder='Notes'></textarea>
                        <input title='@{acrobatics_buff_notes}' name='attr_acrobatics_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{athletics_show_options}' name="attr_athletics_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{athletics_misc}' name='attr_athletics_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{athletics_ranks}' name='attr_athletics_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{athletics_class_skill}' name='attr_athletics_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_athletics}' name='roll_npc_athletics' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Athletics}}  {{r1=[[1d20+@{athletics_base}+[[@{strength_mod}-({@{athletics_base},0}>1)*@{strength_base}]][Ability Buffs]@{athletics_misc}]]}} {{notes=@{athletics_description}}}'
                            data-i18n='athletics'>ATHLETICS</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{athletics}' name='attr_athletics_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_athletics_change' value='0'>
                            <span class='modified-attr input-field' title='@{athletics}' name='attr_athletics' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{athletics_acp}' name='attr_athletics_acp' value='1' checked='checked'>
                        </div>
                        <textarea class='skill-description input-field' title='@{athletics_description}' name='attr_athletics_description' placeholder='Notes'></textarea>
                        <input title='@{athletics_buff_notes}' name='attr_athletics_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{bluff_show_options}' name="attr_bluff_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{bluff_misc}' name='attr_bluff_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{bluff_ranks}' name='attr_bluff_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{bluff_class_skill}' name='attr_bluff_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_bluff}' name='roll_npc_bluff' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Bluff}}  {{r1=[[1d20+@{bluff_base}+[[@{charisma_mod}-({@{bluff_base},0}>1)*@{charisma_base}]][Ability Buffs]@{bluff_misc}]]}} {{notes=@{bluff_description}}}'
                            data-i18n='bluff'>BLUFF </button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{bluff}' name='attr_bluff_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_bluff_change' value='0'>
                            <span class='modified-attr input-field' title='@{bluff}' name='attr_bluff' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{bluff_acp}' name='attr_bluff_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{bluff_description}' name='attr_bluff_description' placeholder='Notes'></textarea>
                        <input title='@{bluff_buff_notes}' name='attr_bluff_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{computers_show_options}' name="attr_computers_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{computers_misc}' name='attr_computers_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{computers_ranks}' name='attr_computers_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{computers_class_skill}' name='attr_computers_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_computers}' name='roll_npc_computers' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Computers}}  {{r1=[[1d20+@{computers_base}+[[@{intelligence_mod}-({@{computers_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{computers_misc}]]}} {{notes=@{computers_description}}}'
                            data-i18n='computers'>COMPUTERS</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{computers}' name='attr_computers_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_computers_change' value='0'>
                            <span class='modified-attr input-field' title='@{computers}' name='attr_computers' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{computers_acp}' name='attr_computers_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{computers_description}' name='attr_computers_description' placeholder='Notes'></textarea>
                        <input title='@{computers_buff_notes}' name='attr_computers_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{culture_show_options}' name="attr_culture_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{culture_misc}' name='attr_culture_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{culture_ranks}' name='attr_culture_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{culture_class_skill}' name='attr_culture_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_culture}' name='roll_npc_culture' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Culture}}  {{r1=[[1d20+@{culture_base}+[[@{intelligence_mod}-({@{culture_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{culture_misc}]]}} {{notes=@{culture_description}}}'
                            data-i18n='culture'>CULTURE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{culture}' name='attr_culture_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_culture_change' value='0'>
                            <span class='modified-attr input-field' title='@{culture}' name='attr_culture' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{culture_acp}' name='attr_culture_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{culture_description}' name='attr_culture_description' placeholder='Notes'></textarea>
                        <input title='@{culture_buff_notes}' name='attr_culture_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{diplomacy_show_options}' name="attr_diplomacy_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{diplomacy_misc}' name='attr_diplomacy_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{diplomacy_ranks}' name='attr_diplomacy_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{diplomacy_class_skill}' name='attr_diplomacy_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_diplomacy}' name='roll_npc_diplomacy' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Diplomacy}}  {{r1=[[1d20+@{diplomacy_base}+[[@{charisma_mod}-({@{diplomacy_base},0}>1)*@{charisma_base}]][Ability Buffs]@{diplomacy_misc}]]}} {{notes=@{diplomacy_description}}}'
                            data-i18n='diplomacy'>DIPLOMACY</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{diplomacy}' name='attr_diplomacy_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_diplomacy_change' value='0'>
                            <span class='modified-attr input-field' title='@{diplomacy}' name='attr_diplomacy' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{diplomacy_acp}' name='attr_diplomacy_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{diplomacy_description}' name='attr_diplomacy_description' placeholder='Notes'></textarea>
                        <input title='@{diplomacy_buff_notes}' name='attr_diplomacy_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{disguise_show_options}' name="attr_disguise_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{disguise_misc}' name='attr_disguise_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{disguise_ranks}' name='attr_disguise_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{disguise_class_skill}' name='attr_disguise_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_disguise}' name='roll_npc_disguise' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Disguise}}  {{r1=[[1d20+@{disguise_base}+[[@{charisma_mod}-({@{disguise_base},0}>1)*@{charisma_base}]][Ability Buffs]@{disguise_misc}]]}} {{notes=@{disguise_description}}}'
                            data-i18n='disguise'>DISGUISE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{disguise}' name='attr_disguise_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_disguise_change' value='0'>
                            <span class='modified-attr input-field' title='@{disguise}' name='attr_disguise' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{disguise_acp}' name='attr_disguise_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{disguise_description}' name='attr_disguise_description' placeholder='Notes'></textarea>
                        <input title='@{disguise_buff_notes}' name='attr_disguise_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{engineering_show_options}' name="attr_engineering_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{engineering_misc}' name='attr_engineering_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{engineering_ranks}' name='attr_engineering_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{engineering_class_skill}' name='attr_engineering_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_engineering}' name='roll_npc_engineering' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Engineering}}  {{r1=[[1d20+@{engineering_base}+[[@{intelligence_mod}-({@{engineering_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{engineering_misc}]]}} {{notes=@{engineering_description}}}'
                            data-i18n='engineering'>ENGINEERING</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{engineering}' name='attr_engineering_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_engineering_change' value='0'>
                            <span class='modified-attr input-field' title='@{engineering}' name='attr_engineering' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{engineering_acp}' name='attr_engineering_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{engineering_description}' name='attr_engineering_description' placeholder='Notes'></textarea>
                        <input title='@{engineering_buff_notes}' name='attr_engineering_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{intimidate_show_options}' name="attr_intimidate_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{intimidate_misc}' name='attr_intimidate_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{intimidate_ranks}' name='attr_intimidate_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{intimidate_class_skill}' name='attr_intimidate_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_intimidate}' name='roll_npc_intimidate' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Intimidate}}  {{r1=[[1d20+@{intimidate_base}+[[@{charisma_mod}-({@{intimidate_base},0}>1)*@{charisma_base}]][Ability Buffs]@{intimidate_misc}]]}} {{notes=@{intimidate_description}}}'
                            data-i18n='intimidate'>INTIMIDATE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{intimidate}' name='attr_intimidate_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_intimidate_change' value='0'>
                            <span class='modified-attr input-field' title='@{intimidate}' name='attr_intimidate' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{intimidate_acp}' name='attr_intimidate_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{intimidate_description}' name='attr_intimidate_description' placeholder='Notes'></textarea>
                        <input title='@{intimidate_buff_notes}' name='attr_intimidate_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{life_science_show_options}' name="attr_life_science_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{life_science_misc}' name='attr_life_science_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{life_science_ranks}' name='attr_life_science_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{life_science_class_skill}' name='attr_life_science_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_life_science}' name='roll_npc_life_science' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Life Science}}  {{r1=[[1d20+@{life_science_base}+[[@{intelligence_mod}-({@{life_science_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{life_science_misc}]]}} {{notes=@{life_science_description}}}'
                            data-i18n='life-science'>LIFE SCIENCE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{life_science}' name='attr_life_science_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_life_science_change' value='0'>
                            <span class='modified-attr input-field' title='@{life_science}' name='attr_life_science' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{life_science_acp}' name='attr_life_science_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{life_science_description}' name='attr_life_science_description' placeholder='Notes'></textarea>
                        <input title='@{life_science_buff_notes}' name='attr_life_science_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{medicine_show_options}' name="attr_medicine_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{medicine_misc}' name='attr_medicine_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{medicine_ranks}' name='attr_medicine_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{medicine_class_skill}' name='attr_medicine_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_medicine}' name='roll_npc_medicine' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Medicine}}  {{r1=[[1d20+@{medicine_base}+[[@{intelligence_mod}-({@{medicine_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{medicine_misc}]]}} {{notes=@{medicine_description}}}'
                            data-i18n='medicine'>MEDICINE </button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{medicine}' name='attr_medicine_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_medicine_change' value='0'>
                            <span class='modified-attr input-field' title='@{medicine}' name='attr_medicine' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{medicine_acp}' name='attr_medicine_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{medicine_description}' name='attr_medicine_description' placeholder='Notes'></textarea>
                        <input title='@{medicine_buff_notes}' name='attr_medicine_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{mysticism_show_options}' name="attr_mysticism_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{mysticism_misc}' name='attr_mysticism_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{mysticism_ranks}' name='attr_mysticism_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{mysticism_class_skill}' name='attr_mysticism_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_mysticism}' name='roll_npc_mysticism' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Mysticism}}  {{r1=[[1d20+@{mysticism_base}+[[@{wisdom_mod}-({@{mysticism_base},0}>1)*@{wisdom_base}]][Ability Buffs]@{mysticism_misc}]]}} {{notes=@{mysticism_description}}}'
                            data-i18n='mysticism'>MYSTICISM </button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{mysticism}' name='attr_mysticism_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_mysticism_change' value='0'>
                            <span class='modified-attr input-field' title='@{mysticism}' name='attr_mysticism' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{mysticism_acp}' name='attr_mysticism_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{mysticism_description}' name='attr_mysticism_description' placeholder='Notes'></textarea>
                        <input title='@{mysticism_buff_notes}' name='attr_mysticism_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{perception_show_options}' name="attr_perception_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{perception_misc}' name='attr_perception_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{perception_ranks}' name='attr_perception_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{perception_class_skill}' name='attr_perception_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_perception}' name='roll_npc_npcperception' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Perception}}  {{r1=[[1d20+@{perception_base}[Base]+[[@{wisdom_mod}-({@{perception_base},0}>1)*@{wisdom_base}]][Ability Buffs]@{perception_misc}]]}} {{notes=@{perception_description}}}'
                            data-i18n='perception'>PERCEPTION </button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{perception}' name='attr_perception_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_perception_change' value='0'>
                            <span class='modified-attr input-field' title='@{perception}' name='attr_perception' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{perception_acp}' name='attr_perception_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{perception_description}' name='attr_perception_description' placeholder='Notes'></textarea>
                        <input title='@{perception_buff_notes}' name='attr_perception_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{physical_science_show_options}' name="attr_physical_science_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{physical_science_misc}' name='attr_physical_science_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{physical_science_ranks}' name='attr_physical_science_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{physical_science_class_skill}' name='attr_physical_science_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_physical_science}' name='roll_npc_physical_science' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Physical Science}}  {{r1=[[1d20+@{physical_science_base}+[[@{intelligence_mod}-({@{physical_science_base},0}>1)*@{intelligence_base}]][Ability Buffs]@{physical_science_misc}]]}} {{notes=@{physical_science_description}}}'
                            data-i18n='physical-science'>PHYSICAL SCIENCE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{physical_science}' name='attr_physical_science_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_physical_science_change' value='0'>
                            <span class='modified-attr input-field' title='@{physical_science}' name='attr_physical_science' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{physical_science_acp}' name='attr_physical_science_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{physical_science_description}' name='attr_physical_science_description' placeholder='Notes'></textarea>
                        <input title='@{physical_science_buff_notes}' name='attr_physical_science_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{piloting_show_options}' name="attr_piloting_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{piloting_misc}' name='attr_piloting_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{piloting_ranks}' name='attr_piloting_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{piloting_class_skill}' name='attr_piloting_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_piloting}' name='roll_npc_piloting' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Piloting}}  {{r1=[[1d20+@{piloting_base}+[[@{dexterity_mod}-({@{piloting_base},0}>1)*@{dexterity_base}]][Ability Buffs]@{piloting_misc}]]}} {{notes=@{piloting_description}}}'
                            data-i18n='piloting'>PILOTING</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{piloting}' name='attr_piloting_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_piloting_change' value='0'>
                            <span class='modified-attr input-field' title='@{piloting}' name='attr_piloting' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{piloting_acp}' name='attr_piloting_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{piloting_description}' name='attr_piloting_description' placeholder='Notes'></textarea>
                        <input title='@{piloting_buff_notes}' name='attr_piloting_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{sense_motive_show_options}' name="attr_sense_motive_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{sense_motive_misc}' name='attr_sense_motive_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{sense_motive_ranks}' name='attr_sense_motive_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{sense_motive_class_skill}' name='attr_sense_motive_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_sense_motive}' name='roll_npc_sense_motive' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Sense Motive}}  {{r1=[[1d20+@{sense_motive_base}+[[@{wisdom_mod}-({@{sense_motive_base},0}>1)*@{wisdom_base}]][Ability Buffs]@{sense_motive_misc}]]}} {{notes=@{sense_motive_description}}}'
                            data-i18n='sense-motive'>SENSE MOTIVE</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{sense_motive}' name='attr_sense_motive_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_sense_motive_change' value='0'>
                            <span class='modified-attr input-field' title='@{sense_motive}' name='attr_sense_motive' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{sense_motive_acp}' name='attr_sense_motive_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{sense_motive_description}' name='attr_sense_motive_description' placeholder='Notes'></textarea>
                        <input title='@{sense_motive_buff_notes}' name='attr_sense_motive_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{sleight_of_hand_show_options}' name="attr_sleight_of_hand_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{sleight_of_hand_misc}' name='attr_sleight_of_hand_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{sleight_of_hand_ranks}' name='attr_sleight_of_hand_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{sleight_of_hand_class_skill}' name='attr_sleight_of_hand_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_sleight_of_hand}' name='roll_npc_sleight_of_hand' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Sleight of Hand}}  {{r1=[[1d20+@{sleight_of_hand_base}+[[@{dexterity_mod}-({@{sleight_of_hand_base},0}>1)*@{dexterity_base}]][Ability Buffs]@{sleight_of_hand_misc}]]}} {{notes=@{sleight_of_hand_description}}}'
                            data-i18n='sleight-of-hand'>SLEIGHT OF HAND</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{sleight_of_hand}' name='attr_sleight_of_hand_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_sleight_of_hand_change' value='0'>
                            <span class='modified-attr input-field' title='@{sleight_of_hand}' name='attr_sleight_of_hand' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{sleight_of_hand_acp}' name='attr_sleight_of_hand_acp' value='1' checked='checked'>
                        </div>
                        <textarea class='skill-description input-field' title='@{sleight_of_hand_description}' name='attr_sleight_of_hand_description' placeholder='Notes'></textarea>
                        <input title='@{sleight_of_hand_buff_notes}' name='attr_sleight_of_hand_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{stealth_show_options}' name="attr_stealth_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{stealth_misc}' name='attr_stealth_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{stealth_ranks}' name='attr_stealth_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{stealth_class_skill}' name='attr_stealth_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_stealth}' name='roll_npc_stealth' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Stealth}}  {{r1=[[1d20+@{stealth_base}+[[@{dexterity_mod}-({@{stealth_base},0}>1)*@{dexterity_base}]][Ability Buffs]@{stealth_misc}]]}} {{notes=@{stealth_description}}}'
                            data-i18n='stealth'>STEALTH</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{stealth}' name='attr_stealth_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_stealth_change' value='0'>
                            <span class='modified-attr input-field' title='@{stealth}' name='attr_stealth' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{stealth_acp}' name='attr_stealth_acp' value='1' checked='checked'>
                        </div>
                        <textarea class='skill-description input-field' title='@{stealth_description}' name='attr_stealth_description' placeholder='Notes'></textarea>
                        <input title='@{stealth_buff_notes}' name='attr_stealth_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-container'>
                    <input class="show-options" type="checkbox" title='@{survival_show_options}' name="attr_survival_show_options"><span>y</span>
                    <div class='display'>
                        <input hidden='true' title='@{survival_misc}' name='attr_survival_misc' value=''>
                        <input class='ranks input-field' type='number' hidden='true' title='@{survival_ranks}' name='attr_survival_ranks' value='0'>
                        <input hidden='true' type='checkbox' title='@{survival_class_skill}' name='attr_survival_class_skill' value='3'>
                        <button class='acp' type='roll' title='%{npc_survival}' name='roll_npc_survival' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Survival}}  {{r1=[[1d20+@{survival_base}+[[@{wisdom_mod}-({@{wisdom_base},0}>1)*@{wisdom_base}]][Ability Buffs]@{survival_misc}]]}} {{notes=@{survival_description}}}'
                            data-i18n='survival'>SURVIVAL</button>
                        <div class='attr-base-mod-container tot'>
                            <input class='base-attr input-field' type='number' title='@{survival}' name='attr_survival_base' value='0'>
                            <input class='mod-buff' type='hidden' name='attr_survival_change' value='0'>
                            <span class='modified-attr input-field' title='@{survival}' name='attr_survival' value='0'>0</span>
                        </div>
                    </div>
                    <div class='row-options'>
                        <div class='row'>
                            <span class='skill-span label' data-i18n='acp'>ACP</span>
                            <input class='acp' type='checkbox' title='@{survival_acp}' name='attr_survival_acp' value='1'>
                        </div>
                        <textarea class='skill-description input-field' title='@{survival_description}' name='attr_survival_description' placeholder='Notes'></textarea>
                        <input title='@{suvival_buff_notes}' name='attr_suvival_buff_notes' hidden='true'>
                    </div>
                </div>
                <div class='skill-fieldset'>
                    <fieldset class='repeating_profession'>
                        <input type='checkbox' hidden='true' title='@{filter}' name='attr_filter' value='1' checked='checked'>
                        <!-- controls whether the repeating item is displayed. Had plans to use this to add the ability for people to filter their repeating sections -->
                        <div class='skill-container'>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options"><span>y</span>
                            <div class='display'>
                                <input hidden='true' title='@{repeating_profession_$X_misc}' name='attr_misc' value=''>
                                <input class='ranks input-field' type='number' hidden='true' title='@{stealth_ranks}' name='attr_ranks' value='0'>
                                <input hidden='true' type='checkbox' title='@{stealth_class_skill}' name='attr_class_skill' value='3'>
                                <button class='acp' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}}  {{r1=[[1d20+@{base}+[[@{npc_ability}]][Ability Buffs]@{misc}]]}} {{notes=@{description}}}'><span class='profession-name' type='text' title='@{name}' name='attr_name' value='Profession'>Profession</span></button>
                                <div class='attr-base-mod-container tot'>
                                    <input class='base-attr input-field' type='number' title='@{repeating_profession_$X_profession}' name='attr_base' value='0'>
                                    <input class='mod-buff' type='hidden' name='attr_change' value='0'>
                                    <span class='modified-attr input-field' title='@{repeating_profession_$X_profession}' name='attr_profession' value='0'>0</span>
                                </div>
                            </div>
                            <div class='row-options'>
                                <div class='row'>
                                    <input class='scalable-input input-field' type='text' title='@{name}' name='attr_name' value='Profession'>
                                </div>
                                <div class='row'>
                                    <span class='skill-span label' data-i18n='acp'>ACP</span>
                                    <input class='acp' type='checkbox' title='@{acp}' name='attr_acp' value='1'>
                                    <select class='label abi input-field' title='@{npc_ability}' name='attr_npc_ability' style='width; .5em;'>
                                        <option value='@{strength_mod}-@{strength_base}' data-i18n='str'>STR</option>
                                        <option value='@{dexterity_mod}-@{dexterity_base}' data-i18n='dex'>DEX</option>
                                        <option value='@{constitution_mod}-@{constitution_base}' data-i18n='con'>CON</option>
                                        <option selected value='@{intelligence_mod}-@{intelligence_base}' data-i18n='int'>INT</option>
                                        <option value='@{wisdom_mod}-@{wisdom_base}' data-i18n='wis'>WIS</option>
                                        <option value='@{charisma_mod}-@{charisma_base}' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <textarea class='skill-description input-field' title='@{repeating_profession_$X_description}' name='attr_description' placeholder='Notes'></textarea>
                                <input title='@{repeating_profession_$Xbuff_notes}' name='attr_buff_notes' hidden='true'>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class='row'>
                <span data-i18n='feats'>FEATS</span>
                <input class='scalable-input input-field' type='text' title='@{feats}' name='attr_feats'>
            </div>
            <div class='row'>
                <span data-i18n='languages'>LANGUAGES</span>
                <input class='scalable-input input-field' type='text' title='@{languages}' name='attr_languages'>
            </div>
            <div class='row'>
                <span data-i18n='other-abilities'>OTHER ABILITIES</span>
                <input class='scalable-input input-field' type='text' title='@{other_abilities}' name='attr_other_abilities'>
            </div>
            <div class='row'>
                <span data-i18n='gear'>GEAR</span>
            </div>
            <div class='row'>
                <textarea title='@{gear}' name='attr_gear' type='text' class='scalable-input input-field'></textarea>
            </div>
            <div class='statblock-section-header ecology-header'>
                <span data-i18n='ecology'>ECOLOGY</span>
            </div>
            <div class='row'>
                <span data-i18n='environment'>ENVIRONMENT</span>
            </div>
            <div class='row'>
                <textarea class='scalable-input input-field' type='text' title='@{environment}' name='attr_environment'></textarea>
            </div>
            <div class='row'>
                <span data-i18n='organization'>ORGANIZATION</span>
            </div>
            <div class='row'>
                <textarea class='scalable-input input-field' type='text' title='@{organization}' name='attr_organization'></textarea>
            </div>
            <div class='row'>
                <span data-i18n='tactics'>TACTICS</span>
            </div>
            <div class='row'>
                <textarea class='scalable-input input-field' type='text' title='@{tactics}' name='attr_tactics'></textarea>
            </div>
            <div class='row special-abilities'>
                <div class='statblock-section-header special-abilities-header'>
                    <span data-i18n='special-abilities'>SPECIAL ABILITIES</span>
                </div>
                <fieldset class='repeating_ability'>
                    <input hidden='true' type='text' title='@{attack_total}' name='attr_attack_total'>
                    <input hidden='true' type='text' title='@{damage_total}' name='attr_damage_total'>
                    <input class='filter' type='hidden' hidden='true' title='@{filter}' name='attr_type' value='EX'>
                    <div class='filter-container ability'>
                        <!--Hidden Ability Attributes -->
                        <input type='text' hidden='true' title='@{attack_misc}' name='attr_attack_misc' value=''>
                        <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                        <input type='text' hidden='true' title='@{effect_misc}' name='attr_effect_misc' value=''>
                        <input type='hidden' name='attr_dc' value='10'>
                        <!--Shown Ability Attributes -->
                        <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" checked="checked"><span>y</span>
                        <div class='row-options'>
                            <div class='group'>
                                <span class='label' data-i18n='name-u'>NAME</span>
                                <input class='small-input input-field' type='text' title='@{name}' name='attr_name' placeholder="Operative's Edge">
                                <select class='freq-select' title='@{frequency}' name='attr_frequency'>
                                    <option value='constant' data-i18n='constant' selected>CONSTANT</option>
                                    <option value='at-will' data-i18n='at-will'>AT WILL</option>
                                    <option value='daily-limit' data-i18n='x/day'>X/DAY</option><option value='hourly-limit' data-i18n='x/hour'>X/HOUR</option><option value='other-limit' data-i18n='x/other'>X/OTHER</option>
                                </select>
                                <span class='label' data-i18n='source'>SOURCE</span>
                                <input class='tiny-input input-field' type='text' title='@{source}' name='attr_source' placeholder='Operative'>
                                <select title='@{type}' name='attr_type'>
                                    <option value='EX' data-i18n='extraordinary' selected>EX</option>
                                    <option value='SU' data-i18n='supernatural'>SU</option>
                                    <option value='SP' data-i18n='spell-like'>SP</option>
                                </select>
                            </div>
                            <div class='group'>
                                <span class='label' data-i18n='target'>TARGET</span>
                                <input class='tiny-input input-field' type='text' title='@{target}' name='attr_target' placeholder='self'>
                                <span class='label' data-i18n='rng'>RANGE</span>
                                <input class='tiny-input input-field' type='text' title='@{range}' name='attr_range' placeholder='30 ft'>
                                <span class='label' data-i18n='duration'>DURATION</span>
                                <input class='tiny-input input-field' type='text' title='@{duration}' name='attr_duration' placeholder='1 round' value=''>
                                <input class='type-filter' type='hidden' name='attr_type' value='EX'>
                                <div class='type-span'>
                                    <span class='label' data-i18n='level'>LEVEL</span>
                                    <input class='bab-input atk-level input-field' type='number' name='attr_level' value='0'>
                                    <span class='label' data-i18n='spell-resistance-abbrv'>SR</span>
                                    <input type='hidden' name='attr_spell_penetration_misc' value=''><select name='attr_spell_resistance'>
                                        <option value='' data-i18n='no' selected>NO</option>
                                        <option value='yes' data-i18n='yes'>YES</option>
                                    </select>
                                </div>
                            </div>
                            <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                            <div class='group at-will'>
                                <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                                <span class='label abi-cost at-will' data-i18n='usage'>USAGE</span>
                                <input class='tiny-input input-field at-will' type='text' title='@{usage}' name='attr_usage' placeholder='move action, 1 resolve point'>
                                <span class='daily-limit label' data-i18n='_-daily-uses'>Daily Uses</span>
                                <input class='daily-limit' type='number' title='@{uses}' name='attr_uses' value='0'>
                                <span class='daily-limit label'>/</span>
                                <div class='daily-limit tiny-input attr-base-mod-container'>
                                    <input class='base-attr ability-uses' type='text' title='@{uses_max}' name='attr_uses_max_base' value='10'>
                                    <input class='mod-buff' type='hidden' name='attr_uses_change' value='0'>
                                    <span class='input-field modified-attr attr ability-uses' readonly='true' type='text' title='@{uses_max}' name='attr_uses_max' value='10'>10</span>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab atk-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'><span class='field label' data-i18n='atk'>ATTACK ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{attack_checkbox}' name='attr_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='atk-u'>ATTACK ROLL</span>
                                    <input class='bab-input input-field' type='number' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus_base' value='0'>
                                    <input type='hidden' title='@{base_attack_bonus_base}' name='attr_base_attack_bonus' value='0'>
                                    <input class='atk-misc misc tiny-input input-field' type='text' title='@{bonus}' name='attr_attack_bonus' placeholder='+@{attr}/2 + ?{Query}' value=''>
                                    <input hidden='true' type='text' title='@{ability}' name='attr_ability' value='0'>
                                    <span class='label' data-i18n='attack-affected-by-buffs-to'>ATTACK ROLL AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{attack_ability}' name='attr_attack_ability'>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab dmg-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'><span class='field label' data-i18n='dmg'>DAMAGE ROLL</span></label>
                            <input class='field-tab' type='checkbox' title='@{damage_checkbox}' name='attr_damage_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DAMAGE ROLL</span>
                                    <input class='dmg-dice small-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                    <input hidden='true' type='text' title='@{damage_ability}' name='attr_damage_ability' value='0'>
                                    <span class='label' data-i18n='damage-affected-by-buffs-to'>DAMAGE AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{damage_ability}' name='attr_damage_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='[[@{strength_mod}-@{strength_base}]]' data-i18n='str'>STR</option>
                                        <option value='[[@{dexterity_mod}-@{dexterity_base}]]' data-i18n='dex'>DEX</option>
                                        <option value='[[@{constitution_mod}-@{constitution_base}]]' data-i18n='con'>CON</option>
                                        <option value='[[@{intelligence_mod}-@{intelligence_base}]]' data-i18n='int'>INT</option>
                                        <option value='[[@{wisdom_mod}-@{wisdom_base}]]' data-i18n='wis'>WIS</option>
                                        <option value='[[@{charisma_mod}-@{charisma_base}]]' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <span class='label' data-i18n='damage-type'>DAMAGE TYPE</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_type}' name='attr_attack_type' placeholder='Fire'>
                                <span class='label' data-i18n='crit-effect'>CRITICAL EFFECT</span>
                                <input class='tiny-input input-field' type='text' title='@{attack_crit}' name='attr_attack_crit' placeholder='Burn'>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'><span class='label field' data-i18n='additional-attack'>ADDITIONAL ATTACKS</span></label>
                            <input class='field-tab' type='checkbox' title='@{full_attack_checkbox}' name='attr_full_attack_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <div class='group'>
                                    <span class='label' data-i18n='roll-full-attack_'>ROLL FULL ATTACK: </span>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='?{Full Attack|No,0|Yes,1}'><span class='label'  data-i18n='query'>QUERY</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='1'><span class='label' data-i18n='always'>ALWAYS</span></label>
                                    <label><input type='radio' title='@{full_attack_query}' name='attr_full_attack_query' value='0'checked><span class='label'  data-i18n='never'>NEVER</span></label>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='number-of-attacks:'>NUMBER OF ATTACKS:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_number}' name='attr_full_attack_number' value='2'>
                                    <span class='label' data-i8n='full-attack-penalty:'>ATTACK PENALTY:</span>
                                    <input class='small-input attack-num input-field' type='text' title='@{full_attack_penalty}' name='attr_full_attack_penalty' value='-4'>
                                </div>
                            </div>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab save-effect-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'><span class='field label' data-i18n='save-effect'>SAVE EFFECT</span></label>
                            <input class='field-tab' type='checkbox' title='@{save_checkbox}' name='attr_save_checkbox' value='1' hidden='true'>
                            <div class='field-container expandable group'>
                                <div class='group'>
                                    <span class='label' data-i18n='dc'>DC</span>
                                    <div class='attr-base-mod-container save-dc bab-input'>
                                        <input class='base-attr' type='number' title='@{dc}' name='attr_dc_base' value='10'>
                                        <input class='mod-buff' type='hidden' name='attr_dc_change' value='0'>
                                        <span class='modified-attr input-field' title='@{dc}' name='attr_dc' value='10'>10</span>
                                    </div>
                                    <select class='label save-type input-field' title='@{save_type}' name='attr_save_type'>
                                        <option value='save' selected>-</option>
                                        <option value='fort-save' data-i18n='fort-save'>FORT SAVE</option>
                                        <option value='ref-save' data-i18n='ref-save'>REF SAVE</option>
                                        <option value='will-save' data-i18n='will-save'>WILL SAVE</option>
                                    </select>
                                    <span class='label' data-i18n='dc-affected-by-buffs-to'>DC AFFECTED BY BUFFS TO</span>
                                    <select class='label atk-ability abi input-field' title='@{save_ability}' name='attr_save_ability'>
                                        <option value='0' selected data-i18n='n/a'>N/A</option>
                                        <option value='@{strength_mod}' data-i18n='str'>STR</option>
                                        <option value='@{dexterity_mod}' data-i18n='dex'>DEX</option>
                                        <option value='@{constitution_mod}' data-i18n='con'>CON</option>
                                        <option value='@{intelligence_mod}' data-i18n='int'>INT</option>
                                        <option value='@{wisdom_mod}' data-i18n='wis'>WIS</option>
                                        <option value='@{charisma_mod}' data-i18n='cha'>CHA</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <textarea title='@{effect}' name='attr_effect' placeholder='Effect on a Failed Save'></textarea>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='A-Sucessful-Save:'>A Sucessful Save:</span>
                                </div>
                                <div class='group'>
                                    <textarea title='@{save_effect}' name='attr_save_effect' placeholder='Effect on a Successful Save'></textarea>
                                </div>
                            </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <label class='expandable'><input class='field-tab mods-tab item-mods' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'><span class='label field' data-i18n='mods'>MODS</span></label>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <div class='manual-mod field-container group expandable'>
                                            <textarea class='buff-mod input-field' title='@{mods}' name='attr_mods' placeholder='+X to EAC'></textarea>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='mods-help-first-line'>This textarea is used to enter buffs, penalties, and other modifications to the sheet. Full details can be found on the sheet's wiki page, but the basic syntax is given here:</span>
                                                    <span data-i18n='mods-help-second-line DO NOT TRANSLATE attack OR damage'><b>+X BonusType to target</b> BonusType is optional and can be any word (letters and spaces). Target is the name of the attribute you want to modify. Underscores in the name can be replaced with spaces. You may also use the keywords attack and damage to affect all attack and damage attributes of attacks, spells, and abilities.</span>
                                                    <span data-i18n='armor-help-third-line'><b>Entering Armor Mods:</b> The mods syntax can handle eac and kac bonuses, armor check penalty, and maximum dexterity bonuses:</span>
                                                    <span>+X armor to eac</span>
                                                    <span>+Y armor to kac</span>
                                                    <span>-Z armor to acp</span>
                                                    <span>U max dex to armor</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </div>
                                        <input class='field-tab' type='checkbox' title='@{mods_checkbox}' name='attr_mods_checkbox' value='1' hidden='true'>
                                        <button class='wizard-mod' type='action' name='act_mod'>
                                            <span title='@{mods}' name='attr_mods'>Click to add bonuses</span>
                                            <div class='help-container'>
                                                <div class='help-content'>
                                                    <span data-i18n='wizard-mods-help-first-line'>This textarea is display buffs & penalties that are part of each item. Click on the textarea to open the wizard.</span>
                                                </div>
                                                <span class='help-icon pictos'>?</span>
                                            </div>
                                        </button>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <label class='expandable'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                            <input class='field-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                            <div class='field-container group expandable'>
                                <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                <div class='help-container mods'>
                                    <div class='help-content'>
                                        <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                    </div>
                                    <span class='help-icon pictos'>?</span>
                                </div>
                            </div>
                            <textarea class='item-description description input-field' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                            <input readonly=true class='id-label id' title='@{id}' name='attr_id'></input>
                        </div>
                        <div class='display'>
                            <input type='hidden' title='@{frequency}' name='attr_frequency' class='freq-check'>
                            <input class='freq-check at-will' type='checkbox' title='@{toggle}' name='attr_toggle' value='1'>
                            <div class='button-description'>
                                <input class='label' type='text' title='@{name}' name='attr_name' placeholder='Laser Pistol'>
                                <input class='label' type='text' name='attr_source' placeholder='Operative'>
                                <input class='label force-uppercase' type='text' name='attr_type'>
                                <input class='const-check' name='attr_frequency' type='hidden'>
                                <input class='label span-two constant force-uppercase' type='text' name='attr_frequency'>
                                <input class='label span-two not-constant' type='text' name='attr_usage'>
                                <button class='npcsummary' type='roll' title='%{npc_roll}' name='roll_npc_roll' value='@{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{rightbanner=@{source}}} {{saveflag=[[1d@{save_checkbox}]]}} {{srflag=@{spell_resistance}}} {{srroll=[[1d20 + @{character_level}@{spell_penetration_misc}]]}} {{activation=@{usage}}} {{duration=@{duration}}} {{targets=@{target}}} {{range=@{range}}} {{savedc=@{dc}}} {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}} {{fullattack=[[@{full_attack_query}*(@{full_attack_number})]]}} {{r1=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+[[@{full_attack_query}*(@{full_attack_penalty})]][FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damage1type=@{attack_type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit1effect=@{attack_crit}}}  {{r2=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage2type=@{attack_type}}} {{damage2=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit2effect=@{attack_crit}}} {{r3=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage3type=@{attack_type}}} {{damage3=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit3effect=@{attack_crit}}} {{r4=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage4type=@{attack_type}}} {{damage4=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit4effect=@{attack_crit}}} {{r5=[[1d20+@{base_attack_bonus_base}[BAB]+@{attack_ability}[ABILITY BUFFS]+@{full_attack_penalty}[FULL ATTACK]@{attack_misc}@{attack_bonus}]]}} {{damage5type=@{attack_type}}} {{damage5=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5damage=[[@{damage_dice}+@{damage_ability}[ABILITY BUFFS]@{damage_misc}]]}} {{crit5effect=@{attack_crit}}} {{rightbanner=@{type}}} {{notes=@{description}}} @{attacher}'></button>
                                <label class='expand-button'><input hidden='true' class='expand-description' type='checkbox' name='attr_expand_description' value='1'><span class='collapsed pictos'>`</span><span class='expanded pictos'>J</span></label>
                            </div>
                            <input class='expand-description' type='hidden' name='attr_expand_description'>
                            <textarea class='description' title='@{description}' name='attr_description' placeholder='Description'></textarea>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
    </div>
    <div class="container ship">
        <input hidden='true' title='@{attack_query}' name='attr_attack_query' type='text' value='?{Fire at will|No, |Yes,-4}'>
        <div class='shields'>
            <div class='hex-container'>
                <!-- contains the hex displays of the shield container -->
                <div class='hex-row'>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row'>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row'>
                    <div class='hexagon'></div>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row center-container'>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon center-hex'>
                        <img src='https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Starfinder%20by%20Roll20/Assets/ship.png'>
                    </div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row'>
                    <div class='hexagon'></div>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row'>
                    <div class='hexagon dual-arc'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='hex-row'>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                    <div class='hexagon'></div>
                </div>
                <div class='line-left'></div>
                <div class='line-right'></div>
            </div>
        </div>
        <div class="starship-type section-container">
            <div class='section'>
                <h1 class='label' data-i18n='starship-info'>STARSHIP INFO</h1>
            </div>
            <div class='section-container'>
                <div class='top-gutter'></div>
                <div class='label-container ship-name'>
                    <input type="text" title='@{character_name}' name="attr_character_name">
                    <span class="label" data-i18n="starship-name">STARSHIP NAME</span>
                </div>
                <div class='label-container ship-tier'>
                    <input type="text" title='@{ship_tier}' name="attr_ship_tier">
                    <span class="label" data-i18n="tier">TIER</span>
                </div>

                <div class='label-container ship-make-model'>
                    <input type="text" title='@{make_model}' name="attr_make_model">
                    <span class="label" data-i18n="make-and-model">MAKE AND MODEL</span>
                </div>
                <div class='label-container ship-size'>
                    <select class='input-field' title='@{size}' name="attr_size">
                        <option value='tiny' data-i18n='tiny' selected>TINY</option>
                        <option value='small' data-i18n='small'>SMALL</option>
                        <option value='medium' data-i18n='medium'>MEDIUM</option>
                        <option value='large' data-i18n='large'>LARGE</option>
                        <option value='huge' data-i18n='huge'>HUGE</option>
                        <option value='gargantuan' data-i18n='gargantuan'>GARGANTUAN</option>
                        <option value='colossal' data-i18n='colossal'>COLOSSAL</option>
                    </select>
                    <span class="label" data-i18n="size">SIZE</span>
                </div>
                <div class='label-container ship-frame'>
                    <input type="text" title='@{frame}' name="attr_frame">
                    <span class="label" data-i18n="frame">FRAME</span>
                </div>
                <div class='label-container ship-speed'>
                    <input type="number" title='@{speed}' name="attr_speed">
                    <span class="label" data-i18n="speed">SPEED</span>
                </div>

                <div class='label-container ship-maneuverability'>
                    <select class='input-field' title='@{maneuverability}' name="attr_maneuverability">
                        <option value='clumsy' data-i18n='clumsy' selected>CLUMSY</option>
                        <option value='poor' data-i18n='poor'>POOR</option>
                        <option value='average' data-i18n='average'>AVERAGE</option>
                        <option value='good' data-i18n='good'>GOOD</option>
                        <option value='perfect' data-i18n='perfect'>PERFECT</option>
                    </select>
                    <span class="label" data-i18n="maneuverability">MANEUVERABILITY</span>
                </div>

                <div class='label-container ship-drift-rating'>
                    <input type="text" title='@{drift_rating}' name="attr_drift_rating">
                    <span class="label" data-i18n="drift-rating">DRIFT RATING</span>
                </div>
                <div class='top-gutter'></div>


            </div>




        </div>
        <div class='crew section-container'>
            <div class='section'>
                <h1 class='label' data-i18n='crew'>CREW</h1>
            </div>
            <div class='section-container'>
                <div class='top-gutter'></div>
                <div class='label-container captain'>
                    <input type="text" title='@{captain}' name="attr_captain">
                    <button type='roll' class="label" title='%{captain}' data-i18n="captain" name='roll_captain' value='@{captain_bonus}'>CAPTAIN</button>
                    <input hidden='true' type='text' title='@{captain_bonus}' name='attr_captain_bonus'>
                </div>
                <div class='label-container engineer'>
                    <input type="text" title='@{engineer}' name="attr_engineer">
                    <button type='roll' class="label" title='%{engineer}' data-i18n="engineer" name='roll_engineer' value='@{engineer_bonus}'>ENGINEER</button>
                    <input hidden='true' type='text' title='@{engineer_bonus}' name='attr_engineer_bonus'>
                </div>
                <div class='label-container pilot'>
                    <input type="text" title='@{pilot}' name="attr_pilot">
                    <button type='roll' class="label" title='%{pilot}' data-i18n="pilot" name='roll_pilot' value='@{pilot_bonus}'>PILOT</button>
                    <input hidden='true' type='text' title='@{pilot_bonus}' name='attr_pilot_bonus'>
                </div>
                <div class='label-container science-officer'>
                    <input type="text" title='@{science_officer}' name="attr_science_officer">
                    <button type='roll' class="label" title='%{science_officer}' data-i18n="science-officer" name='roll_science_officer' value='@{science_officer_bonus}'>SCIENCE OFFICER</button>
                    <input hidden='true' type='text' title='@{science_officer_bonus}' name='attr_science_officer_bonus'>
                </div>
                <div class='label-container gunner'>
                    <input type="text" title='@{gunner}' name="attr_gunner">
                    <input type='text' name='attr_gunner_roll' hidden='true'>
                    <span type='roll' class="label" data-i18n="gunner">GUNNER</span>
                    <input hidden='true' type='text' title='@{gunner_bonus}' name='attr_gunner_bonus'>
                </div>
                <div class='top-gutter'></div>
            </div>
        </div>
        <div class='shields non-hex'>
            <div class='forward-shield arc-shield'>
                <input type='number' title='@{forward_shields}' name='attr_forward_shields' value='' placeholder='0'>
                <span class='label' data-i18n='forward'>FORWARD</span>
            </div>
            <div class='port-shield arc-shield'>
                <span class='label' data-i18n='port'>PORT</span>
                <input type='number' title='@{port_shields}' name='attr_port_shields' value='' placeholder='0'>
            </div>
            <div class='aft-shield arc-shield'>
                <span class='label' data-i18n='aft'>AFT</span>
                <input type='number' title='@{aft_shields}' name='attr_aft_shields' value='' placeholder='0'>
            </div>
            <div class='starboard-shield arc-shield'>
                <span class='label' data-i18n='starboard'>STARBOARD</span>
                <input type='number' title='@{starboard_shields}' name='attr_starboard_shields' value='' placeholder='0'>
            </div>
        </div>
        <div class='starship-defense section-container'>
            <label class='rank-import'><input name='attr_update_pilot_ranks' type='checkbox' value='1' hidden='true'><span data-i18n-title='update-pilot-tooltip' title="Pull piloting ranks from the opened pilot's sheet" class='label' data-i18n='update-pilot'>UPDATE PILOT</span></label>
            <div class='section'>
                <h1 class='label' data-i18n='starship-defenses'>DEFENSES</h1>
            </div>
            <div class='section-container'>
                <div class='top-gutter'></div>
                <div class='ac-container'>
                    <span class='total labels' data-i18n='total'>TOTAL</span> <span class='piloting labels' data-i18n='piloting'>PILOTING</span> <span class='armor label'>b</span>
                    <span class='ac row-label' data-i18n='ac'>AC</span> <span class='ac total' type='number' title='@{ac}' name='attr_ac' readonly='true'>0</span><span class='ac equal'>=</span> <input class='piloting ac' type='text' title='@{ship_piloting_ranks}'
                        name='attr_ship_piloting_ranks' value='0'><span class='ac plus'>+</span> <span class='armor ac' type='number' title='@{ac_armor}' name='attr_ac_armor' readonly='true'>0</span>
                    <span class='tl row-label' data-i18n='tl'>TL</span> <span class='tl total' type='number' title='@{tl}' name='attr_tl' readonly='true'>0</span><span class='tl equal'>=</span> <input class='piloting tl' type='text' title='@{ship_piloting_ranks}'
                        name='attr_ship_piloting_ranks' value='0'><span class='tl plus'>+</span> <span class='armor tl' type='number' title='@{tl_countermeasures}' name='attr_tl_countermeasures' readonly='true'>0</span>
                </div>
                <div class='hp-container'>
                    <span class='current labels' data-i18n='current'>CURRENT</span><span class='total labels' data-i18n='total'>TOTAL</span>
                    <span class='value row-label' data-i18n='hp'>HP</span> <input class='value current' type='number' title='@{hp}' name='attr_hp'><span class='value slash'>/</span> <input class='value total' type='number' title='@{hp_max}' name='attr_hp_max'>
                </div>
                <div class='threshold-container'>
                    <span class='over-label' data-i18n='thresholds'>THRESHOLDS</span>
                    <span class='labels damage label' data-i18n='damage'>DAMAGE</span><span class='labels critical label' data-i18n='critical'>CRITICAL</span>
                    <input class='value damage' type='number' title='@{damage_threshold}' name='attr_damage_threshold' value='0'><input type='number' class='value critical' title='@{critical_threshold}' name='attr_critical_threshold' value='' placeholder='10'>
                </div>
                <div class='shields-container'>
                    <span class='label' data-i18n='shield-total'>SHIELD TOTAL</span>
                    <input class='current' type='number' value='0' title='@{shield_total}' name='attr_shield_total'>
                    <span class='label slash'>/</span>
                    <input type='max number' value='0' title='@{shield_total_max}' name='attr_shield_total_max'>
                </div>
                <div class='modifiers-container'>
                </div>
            </div>
        </div>
        <div class='ship-menus section-container'>
            <div class='section'>
                <h1 class='label' data-i18n='power&computers'>POWER & COMPUTERS</h1>
            </div>
            <div class='section-container'>
                <span class='label power' data-i18n='power'>POWER</span>
                <input class='current power' type='number' readonly='true' title='@{ship_pcu}' name='attr_ship_pcu'>
                <span class='slash power'>/</span>
                <input class='max power' type='number' readonly='true' title='@{ship_pcu_max}' name='attr_ship_pcu_max'>
                <span class='label computer' data-i18n='computer'>COMPUTER</span>
                <input class='current computer' readonly='true' type='text' title='@{ship_computer}' name='attr_ship_computer'>
                <input hidden='true' name='attr_computer_query' value='?{Use Computer|No, |Yes, }'>
                <div class='sensor-bp'>
                    <span class='label sensor' data-i18n='sensors'>SENSORS</span>
                    <input type='text' readonly='true' title='@{ship_sensors}' name='attr_ship_sensors' value=0>
                    <span class='label bp' data-i18n='bp'>BP</span>
                    <input type='text' title='@{ship_bp}' readonly='true' name='attr_ship_bp'>
                </div>
            </div>
        </div>
        <div class='ship-weapons'>
            <div class='forward-weapon section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='forward'>FORWARD</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_attack'>
                        <input class='filter' type='radio' hidden='true' title='@{arc}' name='attr_arc' value='forward' checked='checked'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='port'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='aft'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='starboard'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='turret'>
                        <div class='filter-container attack'>
                            <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                            <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Cannon' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='type'>TYPE</span>
                                    <select class='medium-input input-field label' title='@{type}' name='attr_type'>
                                        <option value='' direct-fire'' selected>-</option><option value='direct-fire' data-i8n='direct-fire'>DIRECT FIRE</option>
                                        <option value='tracking' data-i8n='tracking'>TRACKING</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='class'>CLASS</span>
                                    <select class='medium-input input-field label' title='@{class}' name='attr_class'>
                                        <option value='light' data-i8n='light' selected>LIGHT</option>
                                        <option value='heavy' data-i8n='heavy'>HEAVY</option>
                                        <option value='capital' data-i8n='capital'>CAPITAL</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='rng'>RNG</span>
                                    <select class=' medium-input input-field label' title='@{range}' name='attr_range'>
                                        <option value='' selected data-i18n='n/a'>NA</option>
                                        <option value='5' data-i18n='short'>SHORT</option>
                                        <option value='10' data-i18n='medium'>MEDIUM</option>
                                        <option value='20' data-i18n='long'>LONG</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DMG</span>
                                    <input class='dmg-dice scalable-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='arc'>ARC</span>
                                    <select class='scalable-input input-field atk-type' title='@{arc}' name='attr_arc'>
                                        <option value='forward' data-i18n='forward' selected>FORWARD</option>
                                        <option value='port' data-i18n='port'>PORT</option>
                                        <option value='aft' data-i18n='aft'>AFT</option>
                                        <option value='starboard' data-i18n='starboard' selected>STARBOARD</option>
                                        <option value='turret' data-i18n='turret'>TURRET</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                </div>
                                <div class='group'>
                                    <input class='label scalable-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                    <input class='bab' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                    <span class='label'>/</span>
                                    <input class='bab' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='special'>SPECIAL</span>
                                    <input class='atk-special scalable-input input-field' type='text' title='@{special}' name='attr_special' placeholder='Array' value=''>
                                </div>
                                <div class='group'>
                                    <select class='scalable-input input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <input class='field-tab attacher' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                <label class='attacher'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                <div class='field-container attacher'>
                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                    <div class='help-container mods'>
                                        <div class='help-content'>
                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                        </div>
                                        <span class='help-icon pictos'>?</span>
                                    </div>
                                </div>
                                <textarea class='atk-description span-all input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                <div class='group'>
                                    <input readonly class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                            </div>
                            <input hidden='true' name='attr_arc_status' type='text' value=''>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{repeating_attack_$X_ship_roll}' name='roll_ship_roll' value='@{whisper_state}&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{@{arc}}}} {{r1=[[1d20+[[@{gunner_roll}]]@{attack_query}@{computer_query}@{arc_status}@{power_core_status}]]}} {{damage1=[[@{damage_dice}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_forward}' name='attr_create_forward' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
            <div class='port-weapon section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='port'>PORT</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_attack'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='forward' checked='checked'>
                        <input class='filter' type='radio' hidden='true' title='@{arc}' name='attr_arc' value='port'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='aft'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='starboard'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='turret'>
                        <div class='filter-container attack'>
                            <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                            <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Cannon' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='type'>TYPE</span>
                                    <select class='medium-input input-field label' title='@{type}' name='attr_type'>
                                        <option value='' direct-fire'' selected>-</option><option value='direct-fire' data-i8n='direct-fire'>DIRECT FIRE</option>
                                        <option value='tracking' data-i8n='tracking'>TRACKING</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='class'>CLASS</span>
                                    <select class='medium-input input-field label' title='@{class}' name='attr_class'>
                                        <option value='light' data-i8n='light' selected>LIGHT</option>
                                        <option value='heavy' data-i8n='heavy'>HEAVY</option>
                                        <option value='capital' data-i8n='capital'>CAPITAL</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='rng'>RNG</span>
                                    <select class=' medium-input input-field label' title='@{range}' name='attr_range'>
                                        <option value='' selected data-i18n='n/a'>NA</option>
                                        <option value='5' data-i18n='short'>SHORT</option>
                                        <option value='10' data-i18n='medium'>MEDIUM</option>
                                        <option value='20' data-i18n='long'>LONG</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DMG</span>
                                    <input class='dmg-dice scalable-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='arc'>ARC</span>
                                    <select class='scalable-input input-field atk-type' title='@{arc}' name='attr_arc'>
                                        <option value='forward' data-i18n='forward' selected>FORWARD</option>
                                        <option value='port' data-i18n='port'>PORT</option>
                                        <option value='aft' data-i18n='aft'>AFT</option>
                                        <option value='starboard' data-i18n='starboard' selected>STARBOARD</option>
                                        <option value='turret' data-i18n='turret'>TURRET</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                </div>
                                <div class='group'>
                                    <input class='label scalable-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                    <input class='bab' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                    <span class='label'>/</span>
                                    <input class='bab' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='special'>SPECIAL</span>
                                    <input class='atk-special scalable-input input-field' type='text' title='@{special}' name='attr_special' placeholder='Array' value=''>
                                </div>
                                <div class='group'>
                                    <select class='scalable-input input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <input class='field-tab attacher' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                <label class='attacher'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                <div class='field-container attacher'>
                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                    <div class='help-container mods'>
                                        <div class='help-content'>
                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                        </div>
                                        <span class='help-icon pictos'>?</span>
                                    </div>
                                </div>
                                <textarea class='atk-description span-all input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                <div class='group'>
                                    <input readonly class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                            </div>
                            <input hidden='true' name='attr_arc_status' type='text' value=''>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{repeating_attack_$X_ship_roll}' name='roll_ship_roll' value='@{whisper_state}&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{@{arc}}}} {{r1=[[1d20+[[@{gunner_roll}]]@{attack_query}@{computer_query}@{arc_status}@{power_core_status}]]}} {{damage1=[[@{damage_dice}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_port}' name='attr_create_port' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
            <div class='aft-weapon section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='aft'>AFT</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_attack'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='forward' checked='checked'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='port'>
                        <input class='filter' type='radio' hidden='true' title='@{arc}' name='attr_arc' value='aft'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='starboard'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='turret'>
                        <div class='filter-container attack'>
                            <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                            <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Cannon' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='type'>TYPE</span>
                                    <select class='medium-input input-field label' title='@{type}' name='attr_type'>
                                        <option value='' direct-fire'' selected>-</option><option value='direct-fire' data-i8n='direct-fire'>DIRECT FIRE</option>
                                        <option value='tracking' data-i8n='tracking'>TRACKING</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='class'>CLASS</span>
                                    <select class='medium-input input-field label' title='@{class}' name='attr_class'>
                                        <option value='light' data-i8n='light' selected>LIGHT</option>
                                        <option value='heavy' data-i8n='heavy'>HEAVY</option>
                                        <option value='capital' data-i8n='capital'>CAPITAL</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='rng'>RNG</span>
                                    <select class=' medium-input input-field label' title='@{range}' name='attr_range'>
                                        <option value='' selected data-i18n='n/a'>NA</option>
                                        <option value='5' data-i18n='short'>SHORT</option>
                                        <option value='10' data-i18n='medium'>MEDIUM</option>
                                        <option value='20' data-i18n='long'>LONG</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DMG</span>
                                    <input class='dmg-dice scalable-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='arc'>ARC</span>
                                    <select class='scalable-input input-field atk-type' title='@{arc}' name='attr_arc'>
                                        <option value='forward' data-i18n='forward' selected>FORWARD</option>
                                        <option value='port' data-i18n='port'>PORT</option>
                                        <option value='aft' data-i18n='aft'>AFT</option>
                                        <option value='starboard' data-i18n='starboard' selected>STARBOARD</option>
                                        <option value='turret' data-i18n='turret'>TURRET</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                </div>
                                <div class='group'>
                                    <input class='label scalable-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                    <input class='bab' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                    <span class='label'>/</span>
                                    <input class='bab' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='special'>SPECIAL</span>
                                    <input class='atk-special scalable-input input-field' type='text' title='@{special}' name='attr_special' placeholder='Array' value=''>
                                </div>
                                <div class='group'>
                                    <select class='scalable-input input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <input class='field-tab attacher' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                <label class='attacher'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                <div class='field-container attacher'>
                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                    <div class='help-container mods'>
                                        <div class='help-content'>
                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                        </div>
                                        <span class='help-icon pictos'>?</span>
                                    </div>
                                </div>
                                <textarea class='atk-description span-all input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                <div class='group'>
                                    <input readonly class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                            </div>
                            <input hidden='true' name='attr_arc_status' type='text' value=''>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{repeating_attack_$X_ship_roll}' name='roll_ship_roll' value='@{whisper_state}&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{@{arc}}}} {{r1=[[1d20+[[@{gunner_roll}]]@{attack_query}@{computer_query}@{arc_status}@{power_core_status}]]}} {{damage1=[[@{damage_dice}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_aft}' name='attr_create_aft' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
            <div class='starboard-weapon section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='starboard'>STARBOARD</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_attack'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='forward' checked='checked'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='port'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='aft'>
                        <input class='filter' type='radio' hidden='true' title='@{arc}' name='attr_arc' value='starboard'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='turret'>
                        <div class='filter-container attack'>
                            <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                            <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Cannon' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='type'>TYPE</span>
                                    <select class='medium-input input-field label' title='@{type}' name='attr_type'>
                                        <option value='' direct-fire'' selected>-</option><option value='direct-fire' data-i8n='direct-fire'>DIRECT FIRE</option>
                                        <option value='tracking' data-i8n='tracking'>TRACKING</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='class'>CLASS</span>
                                    <select class='medium-input input-field label' title='@{class}' name='attr_class'>
                                        <option value='light' data-i8n='light' selected>LIGHT</option>
                                        <option value='heavy' data-i8n='heavy'>HEAVY</option>
                                        <option value='capital' data-i8n='capital'>CAPITAL</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='rng'>RNG</span>
                                    <select class=' medium-input input-field label' title='@{range}' name='attr_range'>
                                        <option value='' selected data-i18n='n/a'>NA</option>
                                        <option value='5' data-i18n='short'>SHORT</option>
                                        <option value='10' data-i18n='medium'>MEDIUM</option>
                                        <option value='20' data-i18n='long'>LONG</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DMG</span>
                                    <input class='dmg-dice scalable-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='arc'>ARC</span>
                                    <select class='scalable-input input-field atk-type' title='@{arc}' name='attr_arc'>
                                        <option value='forward' data-i18n='forward' selected>FORWARD</option>
                                        <option value='port' data-i18n='port'>PORT</option>
                                        <option value='aft' data-i18n='aft'>AFT</option>
                                        <option value='starboard' data-i18n='starboard' selected>STARBOARD</option>
                                        <option value='turret' data-i18n='turret'>TURRET</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                </div>
                                <div class='group'>
                                    <input class='label scalable-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                    <input class='bab' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                    <span class='label'>/</span>
                                    <input class='bab' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='special'>SPECIAL</span>
                                    <input class='atk-special scalable-input input-field' type='text' title='@{special}' name='attr_special' placeholder='Array' value=''>
                                </div>
                                <div class='group'>
                                    <select class='scalable-input input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <input class='field-tab attacher' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                <label class='attacher'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                <div class='field-container attacher'>
                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                    <div class='help-container mods'>
                                        <div class='help-content'>
                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                        </div>
                                        <span class='help-icon pictos'>?</span>
                                    </div>
                                </div>
                                <textarea class='atk-description span-all input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                <div class='group'>
                                    <input readonly class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                            </div>
                            <input hidden='true' name='attr_arc_status' type='text' value=''>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{repeating_attack_$X_ship_roll}' name='roll_ship_roll' value='@{whisper_state}&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{@{arc}}}} {{r1=[[1d20+[[@{gunner_roll}]]@{attack_query}@{computer_query}@{arc_status}@{power_core_status}]]}} {{damage1=[[@{damage_dice}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_starboard}' name='attr_create_starboard' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
            <div class='turret-weapon section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='turret'>TURRET</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_attack'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='forward' checked='checked'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='port'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='aft'>
                        <input type='radio' hidden='true' title='@{arc}' name='attr_arc' value='starboard'>
                        <input class='filter' type='radio' hidden='true' title='@{arc}' name='attr_arc' value='turret'>
                        <div class='filter-container attack'>
                            <input type='text' hidden='true' title='@{misc}' name='attr_misc' value=''>
                            <input type='text' hidden='true' title='@{damage_misc}' name='attr_damage_misc' value=''>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Laser Cannon' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='type'>TYPE</span>
                                    <select class='medium-input input-field label' title='@{type}' name='attr_type'>
                                        <option value='' direct-fire'' selected>-</option><option value='direct-fire' data-i8n='direct-fire'>DIRECT FIRE</option>
                                        <option value='tracking' data-i8n='tracking'>TRACKING</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='class'>CLASS</span>
                                    <select class='medium-input input-field label' title='@{class}' name='attr_class'>
                                        <option value='light' data-i8n='light' selected>LIGHT</option>
                                        <option value='heavy' data-i8n='heavy'>HEAVY</option>
                                        <option value='capital' data-i8n='capital'>CAPITAL</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='rng'>RNG</span>
                                    <select class=' medium-input input-field label' title='@{range}' name='attr_range'>
                                        <option value='' selected data-i18n='n/a'>NA</option>
                                        <option value='5' data-i18n='short'>SHORT</option>
                                        <option value='10' data-i18n='medium'>MEDIUM</option>
                                        <option value='20' data-i18n='long'>LONG</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='dmg'>DMG</span>
                                    <input class='dmg-dice scalable-input input-field' type='text' name=attr_damage_dice placeholder='1d8' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='arc'>ARC</span>
                                    <select class='scalable-input input-field atk-type' title='@{arc}' name='attr_arc'>
                                        <option value='forward' data-i18n='forward' selected>FORWARD</option>
                                        <option value='port' data-i18n='port'>PORT</option>
                                        <option value='aft' data-i18n='aft'>AFT</option>
                                        <option value='starboard' data-i18n='starboard' selected>STARBOARD</option>
                                        <option value='turret' data-i18n='turret'>TURRET</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='small-input atk-special scalable-input input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                </div>
                                <div class='group'>
                                    <input class='label scalable-input input-field' data-i18n-placeholder='ammo' title='@{ammo_type}' name='attr_ammo_type' value='' type='text' placeholder='ammo'>
                                    <input class='bab' title='@{ammo}' name='attr_ammo' type='number' value=''>
                                    <span class='label'>/</span>
                                    <input class='bab' title='@{ammo_max}' name='attr_ammo_max' type='number' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='special'>SPECIAL</span>
                                    <input class='atk-special scalable-input input-field' type='text' title='@{special}' name='attr_special' placeholder='Array' value=''>
                                </div>
                                <div class='group'>
                                    <select class='scalable-input input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <input class='field-tab attacher' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'>
                                <label class='attacher'><input class='field-tab macro-tab' type='checkbox' title='@{macro_checkbox}' name='attr_macro_checkbox' value='1' hidden='true'><span class='label field' data-i18n='attacher'>ATTACHER</span></label>
                                <div class='field-container attacher'>
                                    <textarea class='field row input-field' title='@{attacher}' name='attr_attacher'></textarea>
                                    <div class='help-container mods'>
                                        <div class='help-content'>
                                            <span data-i18n='attacher-help-first-line'>This textarea is used to override the default roll template output, send api commands with the roll, or include any other chat messages you want sent at the same time as the roll. The first line of the textarea is included with the roll template, while any other lines are sent as independent chat messages.</span>
                                        </div>
                                        <span class='help-icon pictos'>?</span>
                                    </div>
                                </div>
                                <textarea class='atk-description span-all input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                <div class='group'>
                                    <input readonly class='id-label' title='@{id}' name='attr_id'></input>
                                </div>
                            </div>
                            <input hidden='true' name='attr_arc_status' type='text' value=''>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{repeating_attack_$X_ship_roll}' name='roll_ship_roll' value='@{whisper_state}&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{@{arc}}}} {{r1=[[1d20+[[@{gunner_roll}]]@{attack_query}@{computer_query}@{arc_status}@{power_core_status}]]}} {{damage1=[[@{damage_dice}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_turret}' name='attr_create_turret' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
        </div>
        <div class='bottom-section'>
            <div class='systems section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='systems'>SYSTEMS</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_system'>
                        <input type='radio' class='filter' title='@{type}' name='attr_type' value='system' hidden='true' checked='checked'>
                        <input type='radio' title='@{type}' name='attr_type' value='expansion' hidden='true'>
                        <div class='filter-container system'>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Power Core' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='purpose'>PURPOSE</span>
                                    <select class='input-field label' title='@{purpose}' name='attr_purpose'>
                                        <option value='power-core' data-i8n='power-core' selected>POWER CORE</option>
                                        <option value='thrusters' data-i8n='thrusters'>THRUSTERS</option>
                                        <option value='armor' data-i8n='armor'>ARMOR</option>
                                        <option value='computer' data-i8n='computer'>COMPUTER</option>
                                        <option value='crew-quarters' data-i8n='crew-quarters'>CREW QUARTERS</option>
                                        <option value='countermeasures' data-i8n='countermeasures'>COUNTERMEASURES</option>
                                        <option value='drift-engines' data-i8n='drift-engines'>DRIFT ENGINES</option>
                                        <option value='expansion-bay' data-i8n='expansion-bay'>EXPANSION BAY</option>
                                        <option value='security' data-i8n='security'>SECURITY</option>
                                        <option value='sensors' data-i8n='sensors'>SENSORS</option>
                                        <option value='shields' data-i8n='shields'>SHIELDS</option>
                                    </select>
                                    <select class='input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='computer-bonus'>COMPUTER BONUS</span>
                                    <input class='scalable-input input-field' title='@{comp_bonus}' type='text' name='attr_comp_bonus' value=''>
                                    <span class='label' data-i18n='sensor-bonus'>SENSOR BONUS</span>
                                    <input class='scalable-input input-field' title='@{sensor_bonus}' type='text' name='attr_sensor_bonus' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='bab input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='bab input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                    <span class='label' data-i18n='shields'>SHIELDS</span>
                                    <input class='bab input-field' title='@{shields}' type='text' name='attr_shields' value=''>
                                    <span class='label armor'>b</span>
                                    <input class='bab input-field' title='@{armor}' type='text' name='attr_armor' value=''>
                                    <span class='label' data-i18n='tl'>TL</span>
                                    <input class='bab input-field' title='@{countermeasure}' type='text' name='attr_countermeasure' value=''>
                                </div>
                                <div class='row'>
                                    <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                </div>
                            </div>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{r1name=@{name}}} {{r1=[[1d20+@{base_attack_bonus}@{attack_query}]]}} {{damage1=[[@{damage_dice}]]}} {{notes=@{description}}}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_system}' name='attr_create_system' value='1'>
                        <span>&</span>
                    </label>
                </div>
            </div>
            <div class='expansion section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='expansion-bays'>EXPANSION BAYS</h1>
                </div>
                <div class='section-container'>
                    <fieldset class='repeating_system'>
                        <input type='radio' title='@{type}' name='attr_type' value='system' hidden='true' checked='checked'>
                        <input type='radio' class='filter' title='@{type}' name='attr_type' value='expansion' hidden='true'>
                        <div class='filter-container system'>
                            <input class="show-options" type="checkbox" title='@{show_options}' name="attr_show_options" value='1' checked="checked"><span>y</span>
                            <div class='row-options'>
                                <div class='group'>
                                    <span class='label' data-i18n='name-u'>NAME</span>
                                    <input class='atk-name scalable-input input-field' type='text' title='@{name}' name='attr_name' placeholder='Power Core' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='purpose'>PURPOSE</span>
                                    <select class='input-field label' title='@{purpose}' name='attr_purpose'>
                                        <option value='power-core' data-i8n='power-core' selected>POWER CORE</option>
                                        <option value='thrusters' data-i8n='thrusters'>THRUSTERS</option>
                                        <option value='armor' data-i8n='armor'>ARMOR</option>
                                        <option value='computer' data-i8n='computer'>COMPUTER</option>
                                        <option value='crew-quarters' data-i8n='crew-quarters'>CREW QUARTERS</option>
                                        <option value='countermeasures' data-i8n='countermeasures'>COUNTERMEASURES</option>
                                        <option value='drift-engines' data-i8n='drift-engines'>DRIFT ENGINES</option>
                                        <option value='expansion-bay' data-i8n='expansion-bay'>EXPANSION BAY</option>
                                        <option value='security' data-i8n='security'>SECURITY</option>
                                        <option value='sensors' data-i8n='sensors'>SENSORS</option>
                                        <option value='shields' data-i8n='shields'>SHIELDS</option>
                                    </select>
                                    <select class='input-field atk-type' title='@{powered}' name='attr_powered'>
                                        <option class='off' value='OFF' data-i18n='off'>OFF</option>
                                        <option class='on' value='ON' data-i18n='on' selected>ON</option>
                                    </select>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='computer-bonus'>COMPUTER BONUS</span>
                                    <input class='scalable-input input-field' title='@{comp_bonus}' type='text' name='attr_comp_bonus' value=''>
                                    <span class='label' data-i18n='sensor-bonus'>SENSOR BONUS</span>
                                    <input class='scalable-input input-field' title='@{sensor_bonus}' type='text' name='attr_sensor_bonus' value=''>
                                </div>
                                <div class='group'>
                                    <span class='label' data-i18n='pcu'>PCU</span>
                                    <input class='bab input-field' type='text' title='@{pcu}' name='attr_pcu' placeholder='1' value=''>
                                    <span class='label' data-i18n='bp'>BP</span>
                                    <input class='bab input-field' type='text' title='@{bp}' name='attr_bp' placeholder='1' value=''>
                                    <span class='label' data-i18n='shields'>SHIELDS</span>
                                    <input class='bab input-field' title='@{shields}' type='text' name='attr_shields' value=''>
                                    <span class='label armor'>b</span>
                                    <input class='bab input-field' title='@{armor}' type='text' name='attr_armor' value=''>
                                    <span class='label' data-i18n='tl'>TL</span>
                                    <input class='bab input-field' title='@{countermeasure}' type='text' name='attr_countermeasure' value=''>
                                </div>
                                <div class='row'>
                                    <textarea class='atk-description scalable-input input-field' title='@{description}' name='attr_description' placeholder='Description' value=''></textarea>
                                </div>
                            </div>
                            <div class='display'>
                                <button class='npcsummary' type='roll' title='%{roll}' name='roll_roll' value='@{whisper_state}&{template:sf_attack}{{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{r1name=@{name}}} {{r1=[[1d20+@{base_attack_bonus}@{attack_query}]]}} {{damage1=[[@{damage_dice}]]}} {{notes=@{description}}}'>
                                    <span class='label' title='@{name}' name='attr_name'></span>
                                </button>
                            </div>
                        </div>
                    </fieldset>
                    <label class='pseudo-repcontrol'>
                        <input hidden='true' type='checkbox' title='@{create_expansion}' name='attr_create_expansion' value='1'>
                        <span>&</span>
                    </label>


                </div>




            </div>
            <div class='cargo section-container'>
                <div class='section'>
                    <h1 class='label' data-i18n='cargo/passengers'>CARGO/PASSENGERS</h1>
                </div>
                <div class='section-container'>
                    <div class='top-gutter'></div>
                    <textarea title='@{cargo}' name='attr_cargo' data-i18n-placeholder='cargo-placeholder' placeholder='Enter any cargo/passengers being carried here'></textarea>
                    <div class='top-gutter'></div>
                </div>
            </div>
        </div>
        <div class='critical section-container'>
            <div class='section'>
                <h1 class='label' data-i18n='system-status'>SYSTEM STATUS</h1>
            </div>
            <div class='section-container'>
                <div class='roll-crit'>
                    <button title='%{starship_crit}' class='label' name='roll_starship_crit' type='roll' value='&{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=^{crit-effect}}} {{rcrit=[[1d100cf<0cs<0]]}} {{rcrit2=[[1d4cf<0cs<0]]}}'
                        data-i18n='roll-crit'>ROLL CRITICAL EFFECT</button>
                </div>
                <div class='life-support'>
                    <span class='label' data-i18n='life-support-dice-range'>LIFE SUPPORT (1-10)</span>
                    <input class='hide-patch' name='attr_life_support_status' type='hidden' value='+0'>
                    <input class='patch-status' name='attr_life_support_patch' type='hidden'>
                    <label class='patch'><input name='attr_life_support_patch' type='checkbox' hidden='true' value='1' data-toggle="toggle"><span class='label patched' data-i18n='patched'>PATCHED</span><span class='label unpatched' data-i18n='unpatched'>UNPATCHED</span></label>
                    <label class='nominal'><input type='radio' hidden='true' title='@{life_support_status}' name='attr_life_support_status' value='+0' checked='checked'><span class='label' data-i18n='nominal'>NOMINAL</span></label>
                    <label class='glitch'><input type='radio' hidden='true' title='@{life_support_status}' name='attr_life_support_status' value='-2'><span class='label' data-i18n='glitching'>GLITCHING</span></label>
                    <label class='malfunction'><input type='radio' hidden='true' title='@{life_support_status}' name='attr_life_support_status' value='-4'><span class='label' data-i18n='malfunctioning'>MALFUNCTIONING</span></label>
                    <label class='wreck'><input type='radio' hidden='true' title='@{life_support_status}' name='attr_life_support_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='wrecked'>WRECKED</span></label>
                </div>
                <div class='sensors'>
                    <span class='label' data-i18n='sensors-dice-range'>SENSORS (11-30)</span>
                    <input class='hide-patch' name='attr_sensors_status' type='hidden' value='+0'>
                    <input class='patch-status' name='attr_sensors_patch' type='hidden'>
                    <label class='patch'><input name='attr_sensors_patch' type='checkbox' hidden='true' value='1'><span class='label patched' data-i18n='patched'>PATCHED</span><span class='label unpatched' data-i18n='unpatched'>UNPATCHED</span></label>
                    <label class='nominal'><input type='radio' hidden='true' title='@{sensors_status}' name='attr_sensors_status' value='+0' checked='checked'><span class='label' data-i18n='nominal'>NOMINAL</span></label>
                    <label class='glitch'><input type='radio' hidden='true' title='@{sensors_status}' name='attr_sensors_status' value='-2'><span class='label' data-i18n='glitching'>GLITCHING</span></label>
                    <label class='malfunction'><input type='radio' hidden='true' title='@{sensors_status}' name='attr_sensors_status' value='-4'><span class='label' data-i18n='malfunctioning'>MALFUNCTIONING</span></label>
                    <label class='wreck'><input type='radio' hidden='true' title='@{sensors_status}' name='attr_sensors_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='wrecked'>WRECKED</span></label>
                </div>
                <div class='weapon-background'></div>
                <div class='weapons'>
                    <span class='label' data-i18n='weapons-array-dice-range'>WEAPONS ARRAY (31-60)</span>
                </div>
                <div class='engines'>
                    <span class='label' data-i18n='engines-dice-range'>ENGINES (61-80)</span>
                    <input class='hide-patch' name='attr_engines_status' type='hidden' value='+0'>
                    <input class='patch-status' name='attr_engines_patch' type='hidden'>
                    <label class='patch'><input name='attr_engines_patch' type='checkbox' hidden='true' value='1'><span class='label patched' data-i18n='patched'>PATCHED</span><span class='label unpatched' data-i18n='unpatched'>UNPATCHED</span></label>
                    <label class='nominal'><input type='radio' hidden='true' title='@{engines_status}' name='attr_engines_status' value='+0' checked='checked'><span class='label' data-i18n='nominal'>NOMINAL</span></label>
                    <label class='glitch'><input type='radio' hidden='true' title='@{engines_status}' name='attr_engines_status' value='-2'><span class='label' data-i18n='glitching'>GLITCHING</span></label>
                    <label class='malfunction'><input type='radio' hidden='true' title='@{engines_status}' name='attr_engines_status' value='-4'><span class='label' data-i18n='malfunctioning'>MALFUNCTIONING</span></label>
                    <label class='wreck'><input type='radio' hidden='true' title='@{engines_status}' name='attr_engines_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='wrecked'>WRECKED</span></label>
                </div>
                <div class='power'>
                    <span class='label' data-i18n='power-core-dice-range'>POWER CORE (81-100)</span>
                    <input class='hide-patch' name='attr_power_core_status' type='hidden' value='+0'>
                    <input class='patch-status' name='attr_power_core_patch' type='hidden'>
                    <label class='patch'><input name='attr_power_core_patch' type='checkbox' hidden='true' value='1'><span class='label patched' data-i18n='patched'>PATCHED</span><span class='label unpatched' data-i18n='unpatched'>UNPATCHED</span></label>
                    <label class='nominal'><input type='radio' hidden='true' title='@{power_core_status}' name='attr_power_core_status' value='+0' checked='checked'><span class='label' data-i18n='nominal'>NOMINAL</span></label>
                    <label class='glitch'><input type='radio' hidden='true' title='@{power_core_status}' name='attr_power_core_status' value=' '><span class='label' data-i18n='glitching'>GLITCHING</span></label>
                    <label class='malfunction'><input type='radio' hidden='true' title='@{power_core_status}' name='attr_power_core_status' value='-2'><span class='label' data-i18n='malfunctioning'>MALFUNCTIONING</span></label>
                    <label class='wreck'><input type='radio' hidden='true' title='@{power_core_status}' name='attr_power_core_status' value='-4'><span class='label' data-i18n='wrecked'>WRECKED</span></label>
                </div>
                <div class='weapon-details'>
                    <span class='label nominal' data-i18n='nominal'>NOMINAL</span>
                    <span class='label glitch' data-i18n='glitching'>GLITCHING</span>
                    <span class='label malfunction' data-i18n='malfunctioning'>MALFUNCTIONING</span>
                    <span class='label wreck' data-i18n='wrecked'>WRECKED</span>
                    <div class='status nominal'>
                        <label class='forward'><input type='radio' hidden='true' title='@{forward_weapons_status}' name='attr_forward_weapons_status' value='' checked='checked'><span class='label' data-i18n='fwd (1)'>FWD (1)</span><div></div></label>
                        <label class='starboard'><input type='radio' hidden='true' title='@{starboard_weapons_status}' name='attr_starboard_weapons_status' value='' checked='checked'><span class='label' data-i18n='stbd (2)'>STBD (2)</span><div></div></label>
                        <label class='port'><input type='radio' hidden='true' title='@{port_weapons_status}' name='attr_port_weapons_status' value='' checked='checked'><span class='label' data-i18n='port (4)'>PORT (4)</span><div></div></label>
                        <label class='aft'><input type='radio' hidden='true' title='@{aft_weapons_status}' name='attr_aft_weapons_status' value='' checked='checked'><span class='label' data-i18n='aft (3)'>AFT (3)</span><div></div></label>
                    </div>
                    <div class='status glitch'>
                        <label class='forward'><input type='radio' hidden='true' title='@{forward_weapons_status}' name='attr_forward_weapons_status' value='-2'><span class='label' data-i18n='fwd (1)'>FWD (1)</span><div></div></label>
                        <label class='starboard'><input type='radio' hidden='true' title='@{starboard_weapons_status}' name='attr_starboard_weapons_status' value='-2'><span class='label' data-i18n='stbd (2)'>STBD (2)</span><div></div></label>
                        <label class='port'><input type='radio' hidden='true' title='@{port_weapons_status}' name='attr_port_weapons_status' value='-2'><span class='label' data-i18n='port (4)'>PORT (4)</span><div></div></label>
                        <label class='aft'><input type='radio' hidden='true' title='@{aft_weapons_status}' name='attr_aft_weapons_status' value='-2'><span class='label' data-i18n='aft (3)'>AFT (3)</span><div></div></label>
                    </div>
                    <div class='status malfunction'>
                        <label class='forward'><input type='radio' hidden='true' title='@{forward_weapons_status}' name='attr_forward_weapons_status' value='-4'><span class='label' data-i18n='fwd (1)'>FWD (1)</span><div></div></label>
                        <label class='starboard'><input type='radio' hidden='true' title='@{starboard_weapons_status}' name='attr_starboard_weapons_status' value='-4'><span class='label' data-i18n='stbd (2)'>STBD (2)</span><div></div></label>
                        <label class='port'><input type='radio' hidden='true' title='@{port_weapons_status}' name='attr_port_weapons_status' value='-4'><span class='label' data-i18n='port (4)'>PORT (4)</span><div></div></label>
                        <label class='aft'><input type='radio' hidden='true' title='@{aft_weapons_status}' name='attr_aft_weapons_status' value='-4'><span class='label' data-i18n='aft (3)'>AFT (3)</span><div></div></label>
                    </div>
                    <div class='status wreck'>
                        <label class='forward'><input type='radio' hidden='true' title='@{forward_weapons_status}' name='attr_forward_weapons_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='fwd (1)'>FWD (1)</span><div></div></label>
                        <label class='starboard'><input type='radio' hidden='true' title='@{starboard_weapons_status}' name='attr_starboard_weapons_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='stbd (2)'>STBD (2)</span><div></div></label>
                        <label class='port'><input type='radio' hidden='true' title='@{port_weapons_status}' name='attr_port_weapons_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='port (4)'>PORT (4)</span><div></div></label>
                        <label class='aft'><input type='radio' hidden='true' title='@{aft_weapons_status}' name='attr_aft_weapons_status' value='+1d0cf<0cs>1[wrecked]'><span class='label' data-i18n='aft (3)'>AFT (3)</span><div></div></label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <span class='disclaimer' data-i18n='disclaimer'>© 2018. Starfinder, the Starfinder logo, the Paizo golem, all Paizo titles, the Starfinder Roleplaying Game rules, and Paizo’s character names and distinctive likenesses are property and copyright of Paizo, Inc. in the United States and other countries.</span>
</div>
<div class='rolltemplates' hidden='true'>
    <!-- Roll Template Definitions
    Generic Roll Template
    Macro Text: 
        @{whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title= }} {{r1name= }} {{r1= }} {{notes= }}
    -->
    <rolltemplate class="sheet-rolltemplate-sf_generic">
        {{#title}}
        <div class='generic-header'>
            <div>
                {{title}}
            </div>
        </div>
        {{/title}} {{#leftbanner}}
        <div class='side-banner left'>
            <div>
                {{leftbanner}}
            </div>
        </div>
        {{/leftbanner}}
        <div class='generic-body'>
            <div class='content-container'>{{#r1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r1name}} {{r1name}} {{/r1name}} {{^r1name}}
                        <span data-i18n='check'>CHECK</span> {{/r1name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r1}}
                    </div>
                </div>
                {{/r1}}{{#r2}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r2name}} {{r2name}} {{/r2name}} {{^r2name}}
                        <span data-i18n='check'>CHECK</span> {{/r2name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r2}}
                    </div>
                </div>
                {{/r2}}{{#r3}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r3name}} {{r3name}} {{/r3name}} {{^r3name}}
                        <span data-i18n='check'>CHECK</span> {{/r3name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r3}}
                    </div>
                </div>
                {{/r3}}{{#r4}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r4name}} {{r4name}} {{/r4name}} {{^r4name}}
                        <span data-i18n='check'>CHECK</span> {{/r4name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r4}}
                    </div>
                </div>
                {{/r4}}{{#r5}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r5name}} {{r5name}} {{/r5name}} {{^r5name}}
                        <span data-i18n='check'>CHECK</span> {{/r5name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r5}}
                    </div>
                </div>
                {{/r5}}{{#r6}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r6name}} {{r6name}} {{/r6name}} {{^r6name}}
                        <span data-i18n='check'>CHECK</span> {{/r6name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r6}}
                    </div>
                </div>
                {{/r6}}{{#notes}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='notes:'>NOTES:</span><span> {{notes}}</span>
                </div>
                {{/notes}}{{#buttons0}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons0}}</span>
                </div>
                {{/buttons0}}{{#buttons1}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons1}}</span>
                </div>
                {{/buttons1}}{{#buttons2}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons2}}</span>
                </div>
                {{/buttons2}}{{#buttons3}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons3}}</span>
                </div>
                {{/buttons3}}{{#buttons4}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons4}}</span>
                </div>
                {{/buttons4}}{{#buttons5}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons5}}</span>
                </div>
                {{/buttons5}}{{#buttons6}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons6}}</span>
                </div>
                {{/buttons6}}{{#buttons7}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons7}}</span>
                </div>
                {{/buttons7}}{{#buttons8}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons8}}</span>
                </div>
                {{/buttons8}}{{#buttons9}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons9}}</span>
                </div>
                {{/buttons9}}</div>
        </div>
        {{#rightbanner}}
        <div class='side-banner right'>
            <div>
                {{rightbanner}}
            </div>
        </div>
        {{/rightbanner}} {{#name}}
        <div class='generic-footer'>
            <div>
                {{#characterid}} {{#name}} [{{name}}](https://journal.roll20.net/character/{{characterid}}) {{/name}} {{/characterid}} {{^characterid}} {{name}} {{/characterid}}
            </div>
        </div>
        {{/name}}
    </rolltemplate>
    <!-- Attack Roll Templates -->
    <!-- Macro Text: 
        @{whisper_state}&{template:sf_attack} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{level} [[@{level}d1]]}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]@{misc}@{bonus}]]}} 
        {{damagetype=@{type}}} {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} 
        {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{crit}}}
        {{targets=}} {{range=}}
        {{notes=@{description}}}
    -->
    <rolltemplate class="sheet-rolltemplate-sf_attack">
        {{#title}}
        <div class='generic-header'>
            <div>
                {{title}}
            </div>
        </div>
        {{/title}} {{#leftbanner}}
        <div class='side-banner left'>
            <div>
                {{leftbanner}}
            </div>
        </div>
        {{/leftbanner}}
        <div class='generic-body'>
            <div class='content-container'>{{#r1}} {{#rollGreater() fullattack 1}}
                <span class='across attack-label' data-i18n='1st-attack'>1st ATTACK</span> {{/rollGreater() fullattack 1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r1name}} {{r1name}} {{/r1name}} {{^r1name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r1name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r1}}
                    </div>
                </div>
                {{/r1}}{{#damage1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage1type}} {{damage1type}} {{/damage1type}} {{^damage1type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage1type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage1}} {{#rollWasCrit() r1}} {{#crit1damage}} +{{crit1damage}} {{/crit1damage}} {{#crit1effect}}
                        <br>+{{crit1effect}} {{/crit1effect}} {{/rollWasCrit() r1}}
                    </div>
                </div>
                {{/damage1}}{{#rollGreater() fullattack 1}}
                <span class='across attack-label' data-i18n='2nd-attack'>2nd ATTACK</span> {{#r2}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r2name}} {{r2name}} {{/r2name}} {{^r2name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r2name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r2}}
                    </div>
                </div>
                {{/r2}} {{#damage2}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage2type}} {{damage2type}} {{/damage2type}} {{^damage2type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage2type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage2}} {{#rollWasCrit() r2}} {{#crit2damage}} +{{crit2damage}} {{/crit2damage}} {{#crit2effect}}
                        <br>+{{crit2effect}} {{/crit2effect}} {{/rollWasCrit() r2}}
                    </div>
                </div>
                {{/damage2}}{{/rollGreater() fullattack 1}}{{#rollGreater() fullattack 2}}
                <span class='across attack-label' data-i18n='3rd-attack'>3rd ATTACK</span> {{#r3}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r3name}} {{r3name}} {{/r3name}} {{^r3name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r3name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r3}}
                    </div>
                </div>
                {{/r3}} {{#damage3}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage3type}} {{damage3type}} {{/damage3type}} {{^damage3type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage3type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage3}} {{#rollWasCrit() r3}} {{#crit3damage}} +{{crit3damage}} {{/crit3damage}} {{#crit3effect}}
                        <br>+{{crit3effect}} {{/crit3effect}} {{/rollWasCrit() r3}}
                    </div>
                </div>
                {{/damage3}}{{/rollGreater() fullattack 2}}{{#rollGreater() fullattack 3}}
                <span class='across attack-label' data-i18n='4th-attack'>4th ATTACK</span> {{#r4}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r4name}} {{r4name}} {{/r4name}} {{^r4name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r4name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r4}}
                    </div>
                </div>
                {{/r4}} {{#damage4}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage4type}} {{damage4type}} {{/damage4type}} {{^damage4type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage4type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage4}} {{#rollWasCrit() r4}} {{#crit4damage}} +{{crit4damage}} {{/crit4damage}} {{#crit4effect}}
                        <br>+{{crit4effect}} {{/crit4effect}} {{/rollWasCrit() r4}}
                    </div>
                </div>
                {{/damage4}}{{/rollGreater() fullattack 3}}{{#rollGreater() fullattack 4}}
                <span class='across attack-label' data-i18n='5th-attack'>5th ATTACK</span> {{#r5}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r5name}} {{r5name}} {{/r5name}} {{^r5name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r5name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r5}}
                    </div>
                </div>
                {{/r5}} {{#damage5}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage5type}} {{damage5type}} {{/damage5type}} {{^damage5type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage5type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage5}} {{#rollWasCrit() r5}} {{#crit5damage}} +{{crit5damage}} {{/crit5damage}} {{#crit5effect}}
                        <br>+{{crit5effect}} {{/crit5effect}} {{/rollWasCrit() r5}}
                    </div>
                </div>
                {{/damage5}}{{/rollGreater() fullattack 4}}{{#rollGreater() fullattack 5}}
                <span class='across attack-label' data-i18n='6th-attack'>6th ATTACK</span> {{#r6}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r6name}} {{r6name}} {{/r6name}} {{^r6name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r6name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r6}}
                    </div>
                </div>
                {{/r6}} {{#damage6}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage6type}} {{damage6type}} {{/damage6type}} {{^damage6type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage6type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage6}} {{#rollWasCrit() r6}} {{#crit6damage}} +{{crit6damage}} {{/crit6damage}} {{#crit6effect}}
                        <br>+{{crit6effect}} {{/crit6effect}} {{/rollWasCrit() r6}}
                    </div>
                </div>
                {{/damage6}}{{/rollGreater() fullattack 5}}{{#rollGreater() fullattack 6}}
                <span class='across attack-label' data-i18n='7th-attack'>7th ATTACK</span> {{#r7}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r7name}} {{r7name}} {{/r7name}} {{^r7name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r7name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r7}}
                    </div>
                </div>
                {{/r7}} {{#damage7}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage7type}} {{damage7type}} {{/damage7type}} {{^damage7type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage7type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage7}} {{#rollWasCrit() r7}} {{#crit7damage}} +{{crit7damage}} {{/crit7damage}} {{#crit7effect}}
                        <br>+{{crit7effect}} {{/crit7effect}} {{/rollWasCrit() r7}}
                    </div>
                </div>
                {{/damage7}}{{/rollGreater() fullattack 6}}{{#rollGreater() fullattack 7}}
                <span class='across attack-label' data-i18n='8th-attack'>8th ATTACK</span> {{#r8}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r8name}} {{r8name}} {{/r8name}} {{^r8name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r8name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r8}}
                    </div>
                </div>
                {{/r8}} {{#damage8}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage8type}} {{damage8type}} {{/damage8type}} {{^damage8type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage8type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage8}} {{#rollWasCrit() r8}} {{#crit8damage}} +{{crit8damage}} {{/crit8damage}} {{#crit8effect}}
                        <br>+{{crit8effect}} {{/crit8effect}} {{/rollWasCrit() r8}}
                    </div>
                </div>
                {{/damage8}}{{/rollGreater() fullattack 7}}{{#rollGreater() fullattack 8}}
                <span class='across attack-label' data-i18n='9th-attack'>9th ATTACK</span> {{#r9}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r9name}} {{r9name}} {{/r9name}} {{^r9name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r9name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r9}}
                    </div>
                </div>
                {{/r9}} {{#damage9}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage9type}} {{damage9type}} {{/damage9type}} {{^damage9type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage9type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage9}} {{#rollWasCrit() r9}} {{#crit9damage}} +{{crit9damage}} {{/crit9damage}} {{#crit9effect}}
                        <br>+{{crit9effect}} {{/crit9effect}} {{/rollWasCrit() r9}}
                    </div>
                </div>
                {{/damage9}}{{/rollGreater() fullattack 8}}{{#rollGreater() fullattack 9}}
                <span class='across attack-label' data-i18n='10th-attack'>10th ATTACK</span> {{#r10}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r10name}} {{r10name}} {{/r10name}} {{^r10name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r10name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r10}}
                    </div>
                </div>
                {{/r10}} {{#damage10}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage10type}} {{damage10type}} {{/damage10type}} {{^damage10type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage10type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage10}} {{#rollWasCrit() r10}} {{#crit10damage}} +{{crit10damage}} {{/crit10damage}} {{#crit10effect}}
                        <br>+{{crit10effect}} {{/crit10effect}} {{/rollWasCrit() r10}}
                    </div>
                </div>
                {{/damage10}}{{/rollGreater() fullattack 9}}{{#targets}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='targets'>TARGETS</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{targets}}
                    </div>
                </div>
                {{/targets}}{{#range}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='range'>RANGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{range}}
                    </div>
                </div>
                {{/range}}{{#curr_ammo}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{^ammo_type}}
                        <span data-i18n='ammo'>AMMO</span> {{/ammo_type}} {{#ammo_type}} {{ammo_type}} {{/ammo_type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{curr_ammo}}
                    </div>
                </div>
                {{/curr_ammo}}{{#notes}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='notes:'>NOTES:</span>{{notes}}
                </div>
                {{/notes}}{{#buttons0}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons0}}</span>
                </div>
                {{/buttons0}}{{#buttons1}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons1}}</span>
                </div>
                {{/buttons1}}{{#buttons2}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons2}}</span>
                </div>
                {{/buttons2}}{{#buttons3}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons3}}</span>
                </div>
                {{/buttons3}}{{#buttons4}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons4}}</span>
                </div>
                {{/buttons4}}{{#buttons5}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons5}}</span>
                </div>
                {{/buttons5}}{{#buttons6}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons6}}</span>
                </div>
                {{/buttons6}}{{#buttons7}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons7}}</span>
                </div>
                {{/buttons7}}{{#buttons8}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons8}}</span>
                </div>
                {{/buttons8}}{{#buttons9}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons9}}</span>
                </div>
                {{/buttons9}}</div>
        </div>
        {{#rightbanner}}
        <div class='side-banner right'>
            <div>
                <span>{{rightbanner}}</span>
            </div>
        </div>
        {{/rightbanner}} {{#name}}
        <div class='generic-footer'>
            <div>
                {{#characterid}} {{#name}} [{{name}}](https://journal.roll20.net/character/{{characterid}}) {{/name}} {{/characterid}} {{^characterid}} {{name}} {{/characterid}}
            </div>
        </div>
        {{/name}}
    </rolltemplate>
    <!--Ship roll templates
    &{template:sf_ship} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=@{arc}}} {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]@{misc}@{bonus}]]}} 
    {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{range=@{range} ^{hexes}}} {{class=^{@{class}}}} {{type=^{@{type}}}} {{curr_ammo=@{ammo}}} {{ammo_type=@{ammo_type}}} {{rightbanner=@{special}}} {{notes=@{description}}} @{attacher}
    -->
    <rolltemplate class="sheet-rolltemplate-sf_ship">
        {{#title}}
        <div class='generic-header'>
            <div>
                {{title}}
            </div>
        </div>
        {{/title}} {{#leftbanner}}
        <div class='side-banner left'>
            <div>
                {{leftbanner}}
            </div>
        </div>
        {{/leftbanner}}
        <div class='generic-body'>
            <div class='content-container'>{{#rcrit}}
                <div class='highlighted across ship-crit'>
                    <div>{{rcrit}}
                        <span data-i18n="{{#rollLess() rcrit 11}}life-support{{/rollLess() rcrit 11}}{{#rollGreater() rcrit 10}}{{#rollLess() rcrit 31}}sensors{{/rollLess() rcrit 31}}{{/rollGreater() rcrit 10}}{{#rollGreater() rcrit 30}}{{#rollLess() rcrit 61}}weapons{{/rollLess() rcrit 61}}{{/rollGreater() rcrit 30}}{{#rollGreater() rcrit 60}}{{#rollLess() rcrit 81}}engines{{/rollLess() rcrit 81}}{{/rollGreater() rcrit 60}}{{#rollGreater() rcrit 80}}power-core{{/rollGreater() rcrit 80}}"></span>
                    </div>
                    {{#rollGreater() rcrit 30}}{{#rollLess() rcrit 61}}
                    <div>
                        {{rcrit2}}
                        <span data-i18n="{{#rollTotal() rcrit2 1}}forward-arc{{/rollTotal() rcrit2 1}}{{#rollTotal() rcrit2 2}}starboard-arc{{/rollTotal() rcrit2 2}}{{#rollTotal() rcrit2 3}}aft-arc{{/rollTotal() rcrit2 3}}{{#rollTotal() rcrit2 4}}port-arc{{/rollTotal() rcrit2 4}}"></span>
                    </div>
                    {{/rollLess() rcrit 61}}{{/rollGreater() rcrit 30}}
                </div>
                {{/rcrit}}{{#r1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r1name}} {{r1name}} {{/r1name}} {{^r1name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r1name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r1}}
                    </div>
                </div>
                {{/r1}}{{#damage1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage1type}} {{damage1type}} {{/damage1type}} {{^damage1type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage1type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage1}}
                    </div>
                </div>
                {{/damage1}}{{#range}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='range'>RANGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{range}}
                    </div>
                </div>
                {{/range}}{{#class}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='class'>CLASS</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{class}}
                    </div>
                </div>
                {{/class}}{{#type}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='type'>TYPE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{type}}
                    </div>
                </div>
                {{/type}}{{#curr_ammo}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{^ammo_type}}
                        <span data-i18n='ammo'>AMMO</span> {{/ammo_type}} {{#ammo_type}} {{ammo_type}} {{/ammo_type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{curr_ammo}}
                    </div>
                </div>
                {{/curr_ammo}}{{#notes}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='notes:'>NOTES:</span>{{notes}}
                </div>
                {{/notes}}{{#buttons0}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons0}}</span>
                </div>
                {{/buttons0}}{{#buttons1}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons1}}</span>
                </div>
                {{/buttons1}}{{#buttons2}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons2}}</span>
                </div>
                {{/buttons2}}{{#buttons3}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons3}}</span>
                </div>
                {{/buttons3}}{{#buttons4}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons4}}</span>
                </div>
                {{/buttons4}}{{#buttons5}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons5}}</span>
                </div>
                {{/buttons5}}{{#buttons6}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons6}}</span>
                </div>
                {{/buttons6}}{{#buttons7}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons7}}</span>
                </div>
                {{/buttons7}}{{#buttons8}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons8}}</span>
                </div>
                {{/buttons8}}{{#buttons9}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons9}}</span>
                </div>
                {{/buttons9}}</div>
        </div>
        {{#rightbanner}}
        <div class='side-banner right'>
            <div>
                <span>{{rightbanner}}</span>
            </div>
        </div>
        {{/rightbanner}} {{#name}}
        <div class='generic-footer'>
            <div>
                {{#characterid}} {{#name}} [{{name}}](https://journal.roll20.net/character/{{characterid}}) {{/name}} {{/characterid}} {{^characterid}} {{name}} {{/characterid}}
            </div>
        </div>
        {{/name}}
    </rolltemplate>
    <!-- Spell Roll Templates -->
    <!-- @{whisper_state}&{template:sf_spell} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=@{name}}} {{leftbanner=^{level} [[@{level}d1}} {{activation}} {{duration=}} {{targets=}} {{range=}} {{saveflag=[[1d@{save_checkbox}]]}} {{savedc=@{dc}}} 
    {{savetype=^{@{save_type}}}} {{effect=@{effect}}} {{saveeffect=@{save_effect}}} {{attackflag=[[1d@{attack_checkbox}]]}} 
    {{r1=[[1d20+@{base_attack_bonus}[BAB]+@{ability}[ABILITY]@{misc}@{bonus}]]}} {{damageflag=[[1d@{damage_checkbox}]]}} {{damagetype=@{type}}} 
    {{damage1=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} 
    {{crit1damage=[[@{damage_dice}+@{damage_ability}[ABILITY]@{damage_misc}]]}} {{crit1effect=@{crit_effect}}} 
    {{notes=@{description}}} -->
    <rolltemplate class="sheet-rolltemplate-sf_spell">
        {{#title}}
        <div class='generic-header'>
            <div>
                {{title}}
            </div>
        </div>
        {{/title}} {{#leftbanner}}
        <div class='side-banner left'>
            <div>
                {{leftbanner}}
            </div>
        </div>
        {{/leftbanner}}
        <div class='generic-body'>
            <div class='content-container'>{{#activation}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='activation'>ACTIVATION</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{activation}}
                    </div>
                </div>
                {{/activation}}{{#duration}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='duration'>DURATION</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{duration}}
                    </div>
                </div>
                {{/duration}}{{#targets}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='targets'>TARGETS</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{targets}}
                    </div>
                </div>
                {{/targets}}{{#range}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='range'>RANGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{range}}
                    </div>
                </div>
                {{/range}}{{#rollGreater() saveflag 0}}{{#effect}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='full-effect:'>FULL EFFECT:</span> <span>{{effect}}</span>
                </div>
                {{/effect}}{{#savedc}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#savetype}}<span class='savetype'>{{savetype}}</span>{{/savetype}}{{^savetype}}<span class='savetype' data-i18n='save'>SAVE</span>{{/savetype}}
                    </div>
                    <div class='highlighted split roll'>
                        <span data-i18n='dc'>DC</span> <span>{{savedc}}</span>
                    </div>
                </div>
                {{/savedc}}{{#saveeffect}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='save-effect:'>SAVE EFFECT:</span> <span>{{saveeffect}}</span>
                </div>
                {{/saveeffect}}{{/rollGreater() saveflag 0}}{{#srflag}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='spell-penetration'>Spell Penetration</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{srroll}}
                    </div>
                </div>
                {{/srflag}}{{#rollGreater() attackflag 0}} {{#r1}}
                <span class='across' data-i18n='1st-attack'>1st ATTACK</span>
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r1name}} {{r1name}} {{/r1name}} {{^r1name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r1name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r1}}
                    </div>
                </div>
                {{/r1}} {{/rollGreater() attackflag 0}}{{#rollGreater() damageflag 0}} {{#^rollGreater() attackflag 0}}
                <span class='across attack-label' data-i18n='1st-attack'>1st ATTACK</span> {{/^rollGreater() attackflag 0}} {{#damage1}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage1type}} {{damage1type}} {{/damage1type}} {{^damage1type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage1type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage1}}
                    </div>
                </div>
                {{#rollWasCrit() r1}} {{#rollGreater() attackflag 0}} {{#crit1effect}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-effect'>CRIT EFFECT</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit1effect}}
                    </div>
                </div>
                {{/crit1effect}} {{#crit1damage}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-damage'>CRIT DAMAGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit1damage}}
                    </div>
                </div>
                {{/crit1damage}} {{/rollGreater() attackflag 0}} {{/rollWasCrit() r1}} {{/damage1}} {{/rollGreater() damageflag 0}}{{#rollGreater() fullattack 1}} {{#rollGreater() attackflag 0}} {{#r2}}
                <span class='across attack-label' data-i18n='2nd-attack'>2nd ATTACK</span>
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r2name}} {{r2name}} {{/r2name}} {{^r2name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r2name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r2}}
                    </div>
                </div>
                {{/r2}} {{/rollGreater() attackflag 0}} {{#rollGreater() damageflag 0}} {{#damage2}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage2type}} {{damage2type}} {{/damage2type}} {{^damage2type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage2type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage2}}
                    </div>
                </div>
                {{#rollWasCrit() r2}} {{#rollGreater() attackflag 0}} {{#crit2effect}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-effect'>CRIT EFFECT</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit2effect}}
                    </div>
                </div>
                {{/crit2effect}} {{#crit2damage}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-damage'>CRIT DAMAGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit2damage}}
                    </div>
                </div>
                {{/crit2damage}} {{/rollGreater() attackflag 0}} {{/rollWasCrit() r2}} {{/damage2}} {{/rollGreater() damageflag 0}} {{/rollGreater() fullattack 1}}{{#rollGreater() fullattack 2}} {{#rollGreater() attackflag 0}} {{#r3}}
                <span class='across attack-label' data-i18n='3rd-attack'>3rd ATTACK</span>
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r3name}} {{r3name}} {{/r3name}} {{^r3name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r3name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r3}}
                    </div>
                </div>
                {{/r3}} {{/rollGreater() attackflag 0}} {{#rollGreater() damageflag 0}} {{#damage3}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage3type}} {{damage3type}} {{/damage3type}} {{^damage3type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage3type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage3}}
                    </div>
                </div>
                {{#rollWasCrit() r3}} {{#rollGreater() attackflag 0}} {{#crit3effect}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-effect'>CRIT EFFECT</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit3effect}}
                    </div>
                </div>
                {{/crit3effect}} {{#crit3damage}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-damage'>CRIT DAMAGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit3damage}}
                    </div>
                </div>
                {{/crit3damage}} {{/rollGreater() attackflag 0}} {{/rollWasCrit() r3}} {{/damage3}} {{/rollGreater() damageflag 0}} {{/rollGreater() fullattack 2}}{{#rollGreater() fullattack 3}} {{#rollGreater() attackflag 0}} {{#r4}}
                <span class='across attack-label' data-i18n='4th-attack'>4th ATTACK</span>
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r4name}} {{r4name}} {{/r4name}} {{^r4name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r4name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r4}}
                    </div>
                </div>
                {{/r4}} {{/rollGreater() attackflag 0}} {{#rollGreater() damageflag 0}} {{#damage4}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage4type}} {{damage4type}} {{/damage4type}} {{^damage4type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage4type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage4}}
                    </div>
                </div>
                {{#rollWasCrit() r4}} {{#rollGreater() attackflag 0}} {{#crit4effect}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-effect'>CRIT EFFECT</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit4effect}}
                    </div>
                </div>
                {{/crit4effect}} {{#crit4damage}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-damage'>CRIT DAMAGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit4damage}}
                    </div>
                </div>
                {{/crit4damage}} {{/rollGreater() attackflag 0}} {{/rollWasCrit() r4}} {{/damage4}} {{/rollGreater() damageflag 0}} {{/rollGreater() fullattack 3}}{{#rollGreater() fullattack 4}} {{#rollGreater() attackflag 0}} {{#r5}}
                <span class='across attack-label' data-i18n='5th-attack'>5th ATTACK</span>
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#r5name}} {{r5name}} {{/r5name}} {{^r5name}}
                        <span data-i18n='attack'>ATTACK</span> {{/r5name}}
                    </div>
                    <div class='highlighted split roll'>
                        {{r5}}
                    </div>
                </div>
                {{/r5}} {{/rollGreater() attackflag 0}} {{#rollGreater() damageflag 0}} {{#damage5}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        {{#damage5type}} {{damage5type}} {{/damage5type}} {{^damage5type}}
                        <span data-i18n='damage'>DAMAGE</span> {{/damage5type}}
                    </div>
                    <div class='highlighted split roll'>
                        {{damage5}}
                    </div>
                </div>
                {{#rollWasCrit() r5}} {{#rollGreater() attackflag 0}} {{#crit5effect}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-effect'>CRIT EFFECT</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit5effect}}
                    </div>
                </div>
                {{/crit5effect}} {{#crit5damage}}
                <div class='split-container across'>
                    <div class='highlighted split r1name'>
                        <span data-i18n='crit-damage'>CRIT DAMAGE</span>
                    </div>
                    <div class='highlighted split roll'>
                        {{crit5damage}}
                    </div>
                </div>
                {{/crit5damage}} {{/rollGreater() attackflag 0}} {{/rollWasCrit() r5}} {{/damage5}} {{/rollGreater() damageflag 0}} {{/rollGreater() fullattack 4}}{{#notes}}
                <div class='highlighted across notes-row'>
                    <span class='notes' data-i18n='notes:'>NOTES:</span> {{notes}}
                </div>
                {{/notes}}{{#buttons0}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons0}}</span>
                </div>
                {{/buttons0}}{{#buttons1}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons1}}</span>
                </div>
                {{/buttons1}}{{#buttons2}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons2}}</span>
                </div>
                {{/buttons2}}{{#buttons3}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons3}}</span>
                </div>
                {{/buttons3}}{{#buttons4}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons4}}</span>
                </div>
                {{/buttons4}}{{#buttons5}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons5}}</span>
                </div>
                {{/buttons5}}{{#buttons6}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons6}}</span>
                </div>
                {{/buttons6}}{{#buttons7}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons7}}</span>
                </div>
                {{/buttons7}}{{#buttons8}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons8}}</span>
                </div>
                {{/buttons8}}{{#buttons9}}
                <div class='highlighted across notes-row'>
                    <span>{{buttons9}}</span>
                </div>
                {{/buttons9}}</div>
        </div>
        {{#rightbanner}}
        <div class='side-banner right'>
            <div>
                <span>{{rightbanner}}</span>
            </div>
        </div>
        {{/rightbanner}} {{#name}}
        <div class='generic-footer'>
            <div>
                {{#characterid}} {{#name}} [{{name}}](https://journal.roll20.net/character/{{characterid}}) {{/name}} {{/characterid}} {{^characterid}} {{name}} {{/characterid}}
            </div>





        </div>
        {{/name}}
    </rolltemplate>
</div>
<!-- Start Charmancer slide definitions
Charmancer overall slide template
<charmancer class="sheet-charmancer-pc-start">
    <div class="slide-container">
        <div class="top-section">
            <div class='topbar-receiver'></div>
            <div class='mancernav image-button-holder'>
                <div class='section active'>
                    <button type="submit" class="mancernav-button" value="pc-start">Intro</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="pc-basic">Basic Info</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="ability-scores">Ability Scores</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="class-ability">Class Abilities</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="skill">Skills</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="feat">Feats</button>
                </div>
                <div class='section'>
                    <button type="submit" class="mancernav-button" value="equipment">Equipment</button>
                </div>
            </div>
        </div>
        <div>
            <h1 data-i18n='welcome charmancer'>Welcome to the Charactermancer!</h1>
            <p data-i18n='what charmancer is'>The Charactermancer is a step-by-step process that makes building a character simple and streamlined. Changes are saved as you progress, but the character sheet is only updated when the Charactermancer has been completed.</p>
            <h4 data-i18n='get started'>Get started by clicking Next</h4>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section hide-section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section hide-section'>
                <button type="action" name="act_finish">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
-->
<charmancer class="sheet-repeating-topbar">
    <div class="logo-row">
        <img alt="Starfindr logo" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Starfinder%20by%20Roll20/Assets/starfinder_1000x200.png" />
        <img alt="Charactermancer logo with a wizard hat, hammer, and wand" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Starfinder%20by%20Roll20/Assets/mancerpng.png" />
        <img alt="Roll20 logo of d20" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Starfinder%20by%20Roll20/Assets/Roll20.png" />
    </div>
    <div class='charmancerrow sheet-attributes-row'>
        <div class='attribute-container'>
            <span class='strength sheet-attribute-value'>10</span>
            <span class='strength_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='strength'>STRENGTH</span>
        </div>
        <div class='attribute-container'>
            <span class='dexterity sheet-attribute-value'>10</span>
            <span class='dexterity_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='dexterity'>STRENGTH</span>
        </div>
        <div class='attribute-container'>
            <span class='constitution sheet-attribute-value'>10</span>
            <span class='constitution_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='constitution'>STRENGTH</span>
        </div>
        <div class='attribute-container'>
            <span class='intelligence sheet-attribute-value'>10</span>
            <span class='intelligence_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='intelligence'>STRENGTH</span>
        </div>
        <div class='attribute-container'>
            <span class='wisdom sheet-attribute-value'>10</span>
            <span class='wisdom_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='wisdom'>STRENGTH</span>
        </div>
        <div class='attribute-container'>
            <span class='charisma sheet-attribute-value'>10</span>
            <span class='charisma_mod sheet-attribute-value'>(+0)</span>
            <span class='sheet-attribute-label' data-i18n='charisma'>STRENGTH</span>
        </div>
    </div>
    <div class='charmancerrow sheet-stat-row'>
        <div class='stat-container'>
            <span class='sheet-stat-label' data-i18n='hp'>HP</span>
            <span class='hp sheet-stat-value'>-</span>
        </div>
        <div class='stat-container'>
            <span class='sheet-stat-label' data-i18n='sp'>SP</span>
            <span class='sp sheet-stat-value'>-</span>
        </div>
        <div class='stat-container'>
            <span class='sheet-stat-label' data-i18n='rp'>RP</span>
            <span class='rp sheet-stat-value'>-</span>
        </div>
        <div class='stat-container'>
            <span class='sheet-stat-label' data-i18n='eac'>EAC</span>
            <span class='eac sheet-stat-value'>10</span>
        </div>
        <div class='stat-container'>
            <span class='sheet-stat-label' data-i18n='kac'>KAC</span>
            <span class='kac sheet-stat-value'>10</span>
        </div>
    </div>
    <div class='mancernav image-button-holder'>
        <div class='section pc-start'>
            <button type="submit" class="mancernav-button" value="pc-start">Intro</button>
        </div>
        <div class='section pc-race'>
            <button type="submit" class="mancernav-button" value="pc-race">Race</button>
        </div>
        <div class='section pc-theme'>
            <button type="submit" class="mancernav-button" value="pc-theme">Theme</button>
        </div>
        <div class='section pc-class'>
            <button type="submit" class="mancernav-button" value="pc-class">Class & Archetype</button>
        </div>
        <div class='section pc-ability-scores'>
            <button type="submit" class="mancernav-button" value="pc-ability-scores">Ability Scores</button>
        </div>
        <div class='section pc-skill'>
            <button type="submit" class="mancernav-button" value="pc-skill">Skills</button>
        </div>
        <div class='section choice spell pc-spell'>
            <button type="submit" class="mancernav-button" value="pc-spell">Spells</button>
        </div>
        <div class='section pc-feat'>
            <button type="submit" class="mancernav-button" value="pc-feat">Feats</button>
        </div><!--
        <div class='section pc-equipment'>
            <button type="submit" class="mancernav-button" value="pc-equipment">Equipment</button>
        </div>-->
    </div>
</charmancer>
<charmancer class="sheet-repeating-select">
    <input type='hidden' name='comp_source'>
    <select class='selection sheet-select-blue' name='comp_selection'>
        <option value="" data-i18n="choose" selected>Choose</option>
    </select>
</charmancer>
<charmancer class="sheet-repeating-ability-description">
    <div class='ability-description-container'>
        <span class='choice level-header'></span>
        <input type='hidden' name='comp_name' value=''>
        <input type='hidden' name='comp_source'>
        <span class='ability-name'>AbilityName here</span>
        <span class='ability-description'>abilityDescription here</span>
        <input type='hidden' name='comp_mods' value=''>
    </div>
</charmancer>
<charmancer class="sheet-repeating-ability-scores">
    <span class='ability-name'>Strength: </span>
    <span class='base-value choice buy'>10</span>
    <select class='base-value choice roll pick' type='number' name='comp_points_select'>
        <option value='??' selected>??</option>
    </select>
    <span class='base-plus choice buy roll'>+</span>
    <span class='race-value choice buy roll race_strength'></span>
    <span class='racial-plus choice buy roll'>+</span>
    <span class='theme-value choice buy roll theme_strength'></span>
    <span class='theme-plus choice buy'>+</span>
    <input class='points choice buy' type='number' name='comp_points' value='0'>
</charmancer>
<charmancer class="sheet-repeating-ability_level">
    <div class='ability-level-container'>
        <span class='level-header'></span>
        <select class='feat sheet-select-blue' name='comp_increase_1'>
            <option value='choose' selected>Choose</option>
            <option value='strength'>Strength</option>
            <option value='dexterity'>Dexterity</option>
            <option value='constitution'>Constitution</option>
            <option value='intelligence'>Intelligence</option>
            <option value='wisdom'>Wisdom</option>
            <option value='charisma'>Charisma</option>
        </select>
        <select class='feat sheet-select-blue' name='comp_increase_2'>
            <option value='choose' selected>Choose</option>
            <option value='strength'>Strength</option>
            <option value='dexterity'>Dexterity</option>
            <option value='constitution'>Constitution</option>
            <option value='intelligence'>Intelligence</option>
            <option value='wisdom'>Wisdom</option>
            <option value='charisma'>Charisma</option>
        </select>
        <select class='feat sheet-select-blue' name='comp_increase_3'>
            <option value='choose' selected>Choose</option>
            <option value='strength'>Strength</option>
            <option value='dexterity'>Dexterity</option>
            <option value='constitution'>Constitution</option>
            <option value='intelligence'>Intelligence</option>
            <option value='wisdom'>Wisdom</option>
            <option value='charisma'>Charisma</option>
        </select>
        <select class='feat sheet-select-blue' name='comp_increase_4'>
            <option value='choose' selected>Choose</option>
            <option value='strength'>Strength</option>
            <option value='dexterity'>Dexterity</option>
            <option value='constitution'>Constitution</option>
            <option value='intelligence'>Intelligence</option>
            <option value='wisdom'>Wisdom</option>
            <option value='charisma'>Charisma</option>
        </select>
    </div>
</charmancer>
<charmancer class="sheet-repeating-skill">
    <span class='name choice pregen'>Acrobatics: </span>
    <input style="width:auto;" class='name choice profession' type='text' name='comp_name' value=''>
    <span class='total_value'>0</span>
    <input type='hidden' name='comp_total_value' value='0'>
    <span class='equal'>=</span>
    <input class='ranks' type='number' name='comp_ranks' value='0' min='0'>
    <span class='ranks-plus'>+</span>
    <span class='ability_value choice pregen'></span>
    <select class='ability_value choice profession sheet-select-blue' name='comp_ability_select'>
        <option value='??'>??</option>
        <option value='strength'>Str</option>
        <option value='dexterity'>Dex</option>
        <option value='constitution'>Con</option>
        <option value='intelligence'>Int</option>
        <option value='wisdom'>Wis</option>
        <option value='charisma'>Cha</option>
    </select>
    <span class='ability-plus'>+</span>
    <input class='class_skill' type='checkbox' name='comp_class_skill' value='3'>
    <span class='class-plus'>+</span>
    <span class='bonus_value'>0</span>
    <input type='hidden' name='comp_bonus_value' value=''>
    <button class='choice profession' type='action' name='act_remove' style='font-family:Pictos;' title='Remove Profession Skill'>#</button>
</charmancer>
<charmancer class="sheet-repeating-feat">
    <div class='feat-container'>
        <input type = 'hidden' name='comp_level' value='1'>
        <span class='level-header'></span>
        <select class='feat' name='comp_feat'>
            <option value='choose' selected>Choose a feat</option>
        </select>
        <button class='pictos' type='action' name='act_compendium' title="View the feat's compendium page">i</button>
        <input type='hidden' name='comp_name'>
        <input type='hidden' name='comp_description'>
        <input type='hidden' name='comp_mods'>
    </div>
</charmancer>
<charmancer class="sheet-repeating-class">
    <input type='hidden' name='comp_specific_level' value='1'>
    <span class='specific_level'>1</span>
    <select name='comp_name' class='sheet-select-blue' accept='Category:Classes data-type:Class'>
        <option value="" selected>Select a Class</option>
        <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
    </select>
    <select class='archetype-select choice sheet-select-blue' name='comp_archetype' accept='Category:Classes data-type:Archetype'>
        <option value="No Archetype" selected>No Archetype</option>
    </select>
    <span class='archetype-display choice archetype'></span>
    <input type='hidden' name='comp_key_ability'>
    <span class='key_ability choice'></span>
    <select class='choice key_ability_select sheet-select-blue' name='comp_key_ability'>
        <option value='' data-i18n='choose'>Choose</option>
    </select>
    <div class='details'>
        <div class='charmancerrow sheet-choice-row'>
            <span class='sheet-choice-label'>Stamina:</span>
            <span class='stamina sheet-choice-value'></span>
            <input type='hidden' name='comp_stamina'><!--
        </div>
        <div class='charmancerrow'>-->
            <span class='sheet-choice-label'>HP:</span>
            <span class='class-hp sheet-choice-value'></span>
            <input type='hidden' name='comp_hp'><!--
        </div>
        <div class='charmancerrow'>-->
            <span class='sheet-choice-label'>Skill Points:</span>
            <span class='skill_points sheet-choice-value'></span>
            <input type='hidden' name='comp_skill_points'>
            <input type='hidden' name='comp_reflex'>
            <input type='hidden' name='comp_fortitude'>
            <input type='hidden' name='comp_will'>
            <input type='hidden' name='comp_bab'>
            <input type='hidden' name='comp_spell_list'>
        </div>
        <div class='charmancerrow sheet-choice-row'>           
            <button class='pictos sheet-button-view' type='action' name='act_compendium' title="View the feat's compendium page">i</button>
            <button class='pictos sheet-button-red' type='action' name='act_remove' title='Remove Profession Skill'>#</button>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-repeating-collapsible">
    <input class='status-control' type='hidden' name='comp_status' value='expanded'>
    <div class='mancernav sheet-mancernav-collapsible'>
        <div class='section'>
            <input type='hidden' name='comp_name'>
            <button class='section_name' type='action' name='act_control'></button>
        </div>
    </div>
    <div class='choice collapse'>
        
    </div>
</charmancer>
<charmancer class="sheet-repeating-spell">
    <span class='name choice pregen'></span>
    <input style="width:auto;" class='name choice profession' type='text' name='comp_name' value=''>
    <input type='checkbox' name='comp_known' value='1'>
    <button class='pictos sheet-button-view' type='action' name='act_compendium' title="View the spell's compendium page">i</button>
    <input type='hidden' name='comp_source'>
    <input type='hidden' name='comp_level'>
</charmancer>
<charmancer class="sheet-charmancer-loading-slide">
    <span>Loading Character Mancer</span>
    <!-- Intentionally left blank -->
</charmancer>
<charmancer class="sheet-charmancer-pc-start">
    <div class="slide-container pc-start">
        <div class="top-section">
        </div>
        <div class="sheet-charactermancer-welcome">
            <h1 data-i18n='welcome charmancer'>Welcome to the Charactermancer!</h1>
            <p data-i18n='what charmancer is'>The Charactermancer is a step-by-step process that makes building a character simple and streamlined. Changes are saved as you progress, but the character sheet is only updated when the Charactermancer has been completed.</p>
            <h4 data-i18n='get started'>Get started by clicking Next</h4>
        </div>
        <input type='hidden' name='comp_last_slide' value='pc-start'>
        <div class="mancer-button-container image-button-holder">
            <div class='section hide-section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section hide-section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-race">
    <div class="slide-container pc-race">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite select-div'>
                        <h1>Choose your race:</h1>
                        <select name='comp_race' accept='Category:Races'>
                            <option value="" data-i18n="choose" value='Rules:Races' selected>Choose</option>
                            <option class="custom" value="Rules:Races" data-i18n="custom">Custom</option>
                        </select>
                        <button type='action' name='act_race_info' style='font-family:Pictos'>i</button>
                    </div>
                </div>
                <div class='charmancerrow subrace choice'>
                    <div class='hilite select-div'>
                        <h1>Choose your subrace:</h1>
                        <select class='subrace-select' name='comp_subrace'>
                            <option value="" data-i18n="choose" value='Rules:Races' selected>Choose</option>
                        </select>
                        <button type='action' name='act_race_info' style='font-family:Pictos'>i</button>
                    </div>
                </div>
                <div class='charmancerrow choice official sheet-choice-row'>
                    <span class='sheet-choice-label'>Size:</span>
                    <input type='hidden' name='comp_race_size' value=''>
                    <span class='race_size sheet-choice-value'></span>
                </div>
                <div class='charmancerrow choice senses sheet-choice-row'>
                    <span class='sheet-choice-label'>Senses:</span>
                    <input type='hidden' name='comp_race_senses' value=''>
                    <span class='race_senses sheet-choice-value'></span>
                </div>
                <div class='charmancerrow choice official sheet-choice-row'>
                    <span class='sheet-choice-label'>Speed:</span>
                    <input type='hidden' name='comp_race_speed' value=''>
                    <span class='race_speed sheet-choice-value'></span>
                </div>
                <div class='charmancerrow choice official sheet-choice-row'>
                    <span class='sheet-choice-label'>Type (Subtype):</span>
                    <input type='hidden' name='comp_race_type' value=''>
                    <span class='race_type sheet-choice-value'></span>
                </div>
                <div class='charmancerrow choice official abilityBonuses sheet-choice-row'>
                    <span class='sheet-choice-label'>Ability Bonuses:</span>
                    <input type='hidden' name='comp_race_ability_bonus' value=''>
                    <input type='hidden' name='comp_subrace_ability_bonus' value=''>
                    <input type='hidden' name='comp_race_strength' value='0'>
                    <input type='hidden' name='comp_race_dexterity' value='0'>
                    <input type='hidden' name='comp_race_constitution' value='0'>
                    <input type='hidden' name='comp_race_intelligence' value='0'>
                    <input type='hidden' name='comp_race_wisdom' value='0'>
                    <input type='hidden' name='comp_race_charisma' value='0'>
                    <span class='race_ability_bonus maintain-returns sheet-choice-value'></span>
                </div>
                <div class='charmancerrow choice official sheet-choice-row'>
                    <span class='sheet-choice-label'>Racial HP:</span>
                    <input type='hidden' name='comp_race_hp'>
                    <span class='race_hp sheet-choice-value'></span>
                </div>
                <div class="charmancerrow choice language sheet-choice-row">
                    <span class='sheet-choice-label'>Languages:</span>
                    <input type='hidden' name='comp_race_language' valu=''>
                    <span class='race_language sheet-choice-value'></span>
                </div>
                <div class="charmancerrow">
                    <div class="sheet-hilite">
                        <h1>Abilities</h1>
                    </div>
                </div>
                <div class='ability-container choice official'>

                </div>
                <div class='charmancerrow choice custom'>
                    Custom Race fields
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Races'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-theme">
    <div class="slide-container pc-theme">
        <input type='hidden' name='comp_theme_strength' value='0'>
        <input type='hidden' name='comp_theme_dexterity' value='0'>
        <input type='hidden' name='comp_theme_constitution' value='0'>
        <input type='hidden' name='comp_theme_intelligence' value='0'>
        <input type='hidden' name='comp_theme_wisdom' value='0'>
        <input type='hidden' name='comp_theme_charisma' value='0'>
        <input type='hidden' name='comp_theme_ability_bonus' value='0'>
        <input type='hidden' name='comp_theme_skill' value=''>
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite select-div'>
                        <h1>Choose your theme:</h1>
                        <select name='comp_theme' accept='Category:Themes'>
                            <option value="" data-i18n="choose" value='Rules:Themes' selected>Choose</option>
                            <option class="custom" value="Rules:Themes" data-i18n="custom">Custom</option>
                        </select>
                        <button type='action' name='act_theme_info' style='font-family:Pictos'>i</button>
                    </div>
                </div>
                <div class='charmancerrow ability-container'>
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Character Themes'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-class">
    <div class="slide-container pc-class">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Choose your class</h1>
                    </div>
                </div>
                <input type='hidden' name='comp_character_level' value='1'>
                <input class='class-view' type='hidden' name='comp_current_class' value='levels'>
                <div class='mancernav sheet-mancernav-top image-button-holder'>
                    <div class='section mancer-level'>
                        <button type='action' name='act_levels' value='1'>Class Levels</button>
                    </div>
                    <div class='section mancer-abilities'>
                        <button type='action' value='2' name='act_abilities'>Class Abilities</button>
                    </div>
                </div>
                <div class='choice mancer-levels'>
                    <div class='charmancerrow class-levels'>
                    </div>
                    <div class='charmancerrow'>
                        <button type='action' name='act_add_level' class='sheet-button-blue'>Add a level</button>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Base Reflex:</span>
                        <span class='base_reflex sheet-choice-value'></span>
                        <input type='hidden' name='comp_base_reflex'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Base Fortitude:</span>
                        <span class='base_fortitude sheet-choice-value'></span>
                        <input type='hidden' name='comp_base_fortitude'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Base Will:</span>
                        <span class='base_will sheet-choice-value'></span>
                        <input type='hidden' name='comp_base_will'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>BAB:</span>
                        <span class='bab sheet-choice-value'></span>
                        <input type='hidden' name='comp_bab'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Class Skills:</span>
                        <span class='class_skills sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_skills'>
                    </div>
                    <div class='charmancerrow choice spell-list sheet-choice-row'>
                        <span class='sheet-choice-label'>Spell List:</span>
                        <span class='spell_list sheet-choice-value'></span>
                        <input type='hidden' name='comp_spell_list'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Armor Proficiencies:</span>
                        <span class='armor_proficiencies sheet-choice-value'></span>
                        <input type='hidden' name='comp_armor_proficiencies'>
                    </div>
                    <div class='charmancerrow sheet-choice-row sheet-class-choice'>
                        <span class='sheet-choice-label'>Weapon Proficiencies:</span>
                        <span class='weapon_proficiencies sheet-choice-value'></span>
                        <input type='hidden' name='comp_weapon_proficiencies'>
                    </div>
                </div>
                <div class='choice mancer-abilities-display'>
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Classes'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>

<charmancer class="sheet-charmancer-pc-ignoreclass">
    <div class="slide-container pc-class">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <input type='hidden' name='comp_character_level' value='1'>
                <input class='class-view' type='hidden' name='comp_current_class' value='1'>
                <div class='mancernav sheet-mancernav-top image-button-holder'>
                    <div class='section class-1'>
                        <button type='action' name='act_class_1' value='1'>Class 1</button>
                    </div>
                    <div class='section class-2'>
                        <button type='action' value='2' name='act_class_2'>Class 2</button>
                    </div>
                    <div class='section class-3'>
                        <button type='action' value='3' name='act_class_3'>Class 3</button>
                    </div>
                    <div class='section class-4'>
                        <button type='action' value='4' name='act_class_4'>Class 4</button>
                    </div>
                    <div class='section class-5'>
                        <button type='action' value='5' name='act_class_5'>Class 5</button>
                    </div>
                </div>
                <div class='class-1'>
                    <div class='charmancerrow'>
                        <div class='hilite class-selection select-div'>
                            <h1>Choose your Class:</h1>
                            <select name='comp_class_1' accept='Category:Classes data-type:Class'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <input type='number' name='comp_class_level_1' class='sheet-class-input' value='1'>
                            <button type='action' name='act_class_info_1' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow'>
                        <div class='hilite class-selection select-div'>
                            <h1>Choose your Archetype:</h1>
                            <select name='comp_archetype_1' accept='Category:Classes data-type:Archetype'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <button type='action' name='act_archetype_info_1' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Stamina/Level:</span>
                        <span class='class_stamina_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_stamina_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>HP/Level:</span>
                        <span class='class_hp_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_hp_1'>
                    </div>
                    <div class='charmancerrow choice official key-ability-1 sheet-choice-row'>
                        <span class='sheet-choice-label'>Key Ability:</span>
                        <span class='class_ability_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_ability_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Reflex:</span>
                        <span class='class_reflex_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_reflex_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Fortitude:</span>
                        <span class='class_fortitude_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_fortitude_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Will:</span>
                        <span class='class_will_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_will_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>BAB:</span>
                        <span class='class_bab_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_stamina_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Skill Points/Level:</span>
                        <span class='class_skill_points_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_skill_points_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Class Skills:</span>
                        <span class='class_skills_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_skills_1'>
                    </div>
                    <div class='charmancerrow choice spell sheet-choice-row'>
                        <span class='sheet-choice-label'>Spell List:</span>
                        <span class='class_spell_list_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_spell_list_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Armor Proficiencies:</span>
                        <span class='class_armor_proficiencies_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_class_armor_proficiencies_1'>
                    </div>
                    <div class='charmancerrow choice official sheet-choice-row'>
                        <span class='sheet-choice-label'>Weapon Proficiencies:</span>
                        <span class='class_weapon_proficiencies_1 sheet-choice-value'></span>
                        <input type='hidden' name='comp_weapon_proficiencies_1'>
                    </div>
                    <div class='charmancerrow choice official class-abilities-1'>
                        
                    </div>
                </div><!--
                <div class='class-2'>
                    <div class='charmancerrow'>
                        <div class='hilite select-div'>
                            <span>Choose your Class:</span>
                            <select name='comp_class_2' accept='Category:Classes'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <button type='action' name='act_class_info' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Stamina:</span>
                        <span class='class_stamina_2'></span>
                        <input type='hidden' name='comp_class_stamina_2'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>HP:</span>
                        <span class='class_hp_2'></span>
                        <input type='hidden' name='comp_class_hp_2'>
                    </div>
                    <div class='charmancerrow choice official key-ability'>
                        <span>Key Ability:</span>
                        <span class='class_ability_2'></span>
                        <input type='hidden' name='comp_class_ability_2'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Skill Points:</span>
                        <span class='class_skill_points_2'></span>
                        <input type='hidden' name='comp_class_skill_points_2'>
                    </div>
                    <div class='charmancerrow choice spell'>
                        <span>Spell List</span>
                        <span class='class_spell_list_2'></span>
                        <input type='hidden' name='comp_class_spell_list_2'>
                    </div>
                </div>
                <div class='class-3'>
                    <div class='charmancerrow'>
                        <div class='hilite select-div'>
                            <span>Choose your Class:</span>
                            <select name='comp_class_3' accept='Category:Classes'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <button type='action' name='act_class_info' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Stamina:</span>
                        <span class='class_stamina_3'></span>
                        <input type='hidden' name='comp_class_stamina_3'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>HP:</span>
                        <span class='class_hp_3'></span>
                        <input type='hidden' name='comp_class_hp_3'>
                    </div>
                    <div class='charmancerrow choice official key-ability'>
                        <span>Key Ability:</span>
                        <span class='class_ability_3'></span>
                        <input type='hidden' name='comp_class_ability_3'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Skill Points:</span>
                        <span class='class_skill_points_3'></span>
                        <input type='hidden' name='comp_class_skill_points_3'>
                    </div>
                    <div class='charmancerrow choice spell'>
                        <span>Spell List</span>
                        <span class='class_spell_list_3'></span>
                        <input type='hidden' name='comp_class_spell_list_3'>
                    </div>
                </div>
                <div class='class-4'>
                    <div class='charmancerrow'>
                        <div class='hilite select-div'>
                            <span>Choose your Class:</span>
                            <select name='comp_class_4' accept='Category:Classes'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <button type='action' name='act_class_info' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Stamina:</span>
                        <span class='class_stamina_4'></span>
                        <input type='hidden' name='comp_class_stamina_4'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>HP:</span>
                        <span class='class_hp_4'></span>
                        <input type='hidden' name='comp_class_hp_4'>
                    </div>
                    <div class='charmancerrow choice official key-ability'>
                        <span>Key Ability:</span>
                        <span class='class_ability_4'></span>
                        <input type='hidden' name='comp_class_ability_4'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Skill Points:</span>
                        <span class='class_skill_points_4'></span>
                        <input type='hidden' name='comp_class_skill_points_4'>
                    </div>
                    <div class='charmancerrow choice spell'>
                        <span>Spell List</span>
                        <span class='class_spell_list_4'></span>
                        <input type='hidden' name='comp_class_spell_list_4'>
                    </div>
                </div>
                <div class='class-5'>
                    <div class='charmancerrow'>
                        <div class='hilite select-div'>
                            <span>Choose your Class:</span>
                            <select name='comp_class_5' accept='Category:Classes'>
                                <option value="" data-i18n="choose" value='Rules:Classes' selected>Choose</option>
                                <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                            </select>
                            <button type='action' name='act_class_info' style='font-family:Pictos'>i</button>
                        </div>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Stamina:</span>
                        <span class='class_stamina_5'></span>
                        <input type='hidden' name='comp_class_stamina_5'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>HP:</span>
                        <span class='class_hp_5'></span>
                        <input type='hidden' name='comp_class_hp_5'>
                    </div>
                    <div class='charmancerrow choice official key-ability'>
                        <span>Key Ability:</span>
                        <span class='class_ability_5'></span>
                        <input type='hidden' name='comp_class_ability_5'>
                    </div>
                    <div class='charmancerrow choice official'>
                        <span>Skill Points:</span>
                        <span class='class_skill_points_5'></span>
                        <input type='hidden' name='comp_class_skill_points_5'>
                    </div>
                    <div class='charmancerrow choice spell'>
                        <span>Spell List</span>
                        <span class='class_spell_list_5'></span>
                        <input type='hidden' name='comp_class_spell_list_5'>
                    </div>
                </div>-->
            </div>
            <div class='sheet-compendium-page' accept='CategoryIndex:Classes'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-ability-scores">
    <div class="slide-container pc-ability-scores">
        <input type='hidden' name='comp_strength' value='10'>
        <input type='hidden' name='comp_dexterity' value='10'>
        <input type='hidden' name='comp_constitution' value='10'>
        <input type='hidden' name='comp_intelligence' value='10'>
        <input type='hidden' name='comp_wisdom' value='10'>
        <input type='hidden' name='comp_charisma' value='10'>
        
        <input type='hidden' name='comp_strength_mod' value='0'>
        <input type='hidden' name='comp_dexterity_mod' value='0'>
        <input type='hidden' name='comp_constitution_mod' value='0'>
        <input type='hidden' name='comp_intelligence_mod' value='0'>
        <input type='hidden' name='comp_wisdom_mod' value='0'>
        <input type='hidden' name='comp_charisma_mod' value='0'>
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Select your Ability Scores</h1>
                    </div>
                </div>
                <input class='method-view' type='hidden' name='comp_ability_method' value='buy'>
                <div class='mancernav sheet-mancernav-top image-button-holder'>
                    <div class='section buy'>
                        <button type='action' name='act_point_buy'>Point Buy</button>
                    </div>
                    <div class='section pick'>
                        <button type='action' name='act_quick_pick'>Quick Pick</button>
                    </div>
                    <div class='section roll'>
                        <button type='action' name='act_roll_ability'>Roll Ability Scores</button>
                    </div>
                </div>
                <div class='charmancerrow'>
                </div>
                <input type='hidden' name='comp_point_pool' value='10'>
                <div class='charmancerrow choice buy sheet-points-row'>
                    <span class='sheet-points-label'>Points Remaining</span>
                    <span class='point_pool sheet-points-value'>10</span>
                </div>
                <input class='pick-method' type='hidden' name='comp_pick_method' value='focus'>
                <div class='mancernav image-button-holder pick-display choice pick sheet-mancernav-lower'>
                    <div class='section focus'>
                        <button class='array' type='action' name ='act_focused_array'>Focused</button>
                    </div>
                    <div class='section split'>
                        <button class='array' type='action' name ='act_split_array'>Split</button>
                    </div>
                    <div class='section versatile'>
                        <button class='array' type='action' name ='act_versatile_array'>Versatile</button>
                    </div>
                </div>
                <div class='charmancerrow choice roll'>
                    <button type='roll' name='roll_ability_scores' value='&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=Rolling Ability Scores}} {{buttons0=[[4d6cs<0cf<0dl1]] [[4d6cs<0cf<0dl1]] [[4d6cs<0cf<0dl1]] [[4d6cs<0cf<0dl1]] [[4d6cs<0cf<0dl1]] [[4d6cs<0cf<0dl1]]}}'>Roll Scores</button>
                </div>
                <div class='charmancerrow choice roll pick'>
                    <span class='ability_array'></span>
                    <input type='hidden' name='comp_ability_array' value='18, 14, 11, 10, 10, 10'>
                </div>
                <div class='charmancerrow'>
                </div>
                <div class='charmancerrow'>
                    <div class='sheet-ability-row'>
                        <span class='ability-name'>Ability</span>
                        <span class='base-value choice buy'></span>
                        <span class='base-value choice roll'>Roll</span>
                        <span class='base-plus choice buy roll'></span>
                        <span class='race-value choice buy roll'>Racial</span>
                        <span class='racial-plus choice buy roll'></span>
                        <span class='theme-value choice buy roll'>Theme</span>
                        <span class='theme-plus choice buy'></span>
                        <span class='points choice buy'>Points</span>
                    </div>
                    <div class='gridrow'>
                    </div>
                </div>
                <div class='charmancerrow level'></div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Ability Scores'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-skill">
    <div class="slide-container pc-skill">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Assign Skill Points</h1>
                    </div>
                </div>
                <input type='hidden' name='comp_skill_points_available' value='0'>
                <div class='charmancerrow sheet-points-row'>
                    <span class='sheet-points-label'>Skill Points Available</span>
                    <span class='skill_points_available sheet-points-value'>0</span>
                </div>
                <div class='charmancerrow'>
                    <div class='sheet-skill-row'>
                        <span class='name' title='Skill'>Skill</span>
                        <span class='total_value' title='Total Skill Modifier'>Total</span>
                        <span class='equal'></span>
                        <span class='ranks' title='ranks'>Ranks</span>
                        <span class='ranks-plus'></span>
                        <span class='ability_value' title='Ability'>Ability</span>
                        <span class='ability-plus'></span>
                        <span class='class_skill' title='Class Skill'>Class</span>
                        <span class='class-plus'></span>
                        <span class='bonus_value' title='Bonuses'>Bonus</span>
                    </div>
                    <div class='gridrow'>
                    </div>
                </div>
                <div class='charmancerrow'>
                    <button class='repeat-control sheet-button-blue' type='action' name='act_add_profession' title='Add a Profession Skill'>Add Profession Skill</button>
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Skills'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-spell">
    <div class="slide-container pc-spell">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Select Your Spells</h1>
                    </div>
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Magic (Rules)'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <!-- Commenting out until UC-491 -->
                <!--<button type="action" name="act_next">Next</button>-->
                <button type="action" name="act_next">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-feat">
    <div class="slide-container pc-feat">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Select Your feats</h1>
                    </div>
                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Feats'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="submit" class="mancernav-button" value="summary-slide">Apply Changes</button>
            </div>
            <div class='section'>
                <!-- Commenting out until UC-491 -->
                <!--<button type="action" name="act_next">Next</button>-->
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-pc-equipment">
    <div class="slide-container pc-equipment">
        <div class="top-section">
        </div>
        <div class='data-frame'>
            <div class='mancer-entry'>
                <div class='charmancerrow'>
                    <div class='hilite'>
                        <h1>Buy your Equipment</h1>
                    </div>
                </div>
                <div class='charmancerrow'>

                </div>
            </div>
            <div class='sheet-compendium-page' accept='Rules:Equipment'></div>
        </div>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="action" name="act_back">Back</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <button type="action" name="act_Apply Changes">Apply Changes</button>
            </div>
            <div class='section hide-section'>
                <button type="submit" value="">Next</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-summary-slide">
    <div class="slide-container summary-slide">
        <div class="top-section">
        </div>
        <div class="sheet-charactermancer-welcome">
            <h1 data-i18n='finish charmancer'>Congratulations on completing your character</h1>
            <p data-i18n='final charactermancer step'>The last step is to choose whether to overwrite any existing data on this character, or update your existing character with your choices from the mancer.</p>
            <h4 data-i18n='final choice'>Pick a choice below</h4>
        </div>
        <input type='hidden' name='comp_last_slide' value='pc-start'>
        <div class="mancer-button-container image-button-holder">
            <div class='section'>
                <button type="finish" value="overwrite">Overwrite</button>
            </div>
            <div class='section'>
                <button type="cancel" value="example" data-i18n="cancel">Cancel</button>
            </div>
            <div class='section'>
                <!-- Disabling this button per UC-619 -->
                <button type="finish" value="update" disabled>Update Existing Character (Coming soon)</button>
            </div>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-final">
    <div class="charmancer">
        <div class="">
            <h1>Building your character...</h1>
        </div>
        <div class="mancer_progress">
            <div style="width: 0%"></div>
        </div>
        <input type="hidden" name='attr_mancer_category'>
        <input type="hidden" name='attr_mancer_progress'>
    </div>
</charmancer>
<script type="text/worker">/* ---- BEGIN: TheAaronSheet.js ---- */
    /* Github:   https://github.com/shdwjk/TheAaronSheet/blob/master/TheAaronSheet.js
     By:       The Aaron, Arcane Scriptomancer
     Contact:  https://app.roll20.net/users/104025/the-aaron*/

    //This is a stripped down block of TAS that only has the logging functions. I only have it in because it makes logs easier to spot in the console
    var TAS = TAS || (function() {
        'use strict';

        var loggingSettings = {
                debug: {
                    key: 'debug',
                    title: 'Starfinder-DEBUG',
                    color: {
                        bgLabel: '#7732A2',
                        label: '#F2EF40',
                        bgText: '#FFFEB7',
                        text: '#7732A2'
                    }
                },
                error: {
                    key: 'error',
                    title: 'Starfinder-Error',
                    color: {
                        bgLabel: '#C11713',
                        label: 'white',
                        bgText: '#C11713',
                        text: 'white'
                    }
                },
                warn: {
                    key: 'warn',
                    title: 'Starfinder-Warning',
                    color: {
                        bgLabel: '#F29140',
                        label: 'white',
                        bgText: '#FFD8B7',
                        text: 'black'
                    }
                },
                info: {
                    key: 'info',
                    title: 'Starfinder-Info',
                    color: {
                        bgLabel: '#413FA9',
                        label: 'white',
                        bgText: '#B3B2EB',
                        text: 'black'
                    }
                },
                notice: {
                    key: 'notice',
                    title: 'Starfinder-Notice',
                    color: {
                        bgLabel: '#33C133',
                        label: 'white',
                        bgText: '#ADF1AD',
                        text: 'black'
                    }
                },
                log: {
                    key: 'log',
                    title: 'Starfinder-Log',
                    color: {
                        bgLabel: '#f2f240',
                        label: 'black',
                        bgText: '#ffff90',
                        text: 'black'
                    }
                },
                callstack: {
                    key: 'TAS',
                    title: 'Starfinder-function',
                    color: {
                        bgLabel: '#413FA9',
                        label: 'white',
                        bgText: '#B3B2EB',
                        text: 'black'
                    }
                },
                callstack_async: {
                    key: 'TAS',
                    title: 'Starfinder-ASYNC CALL',
                    color: {
                        bgLabel: '#413FA9',
                        label: 'white',
                        bgText: '#413FA9',
                        text: 'white'
                    }
                },
                TAS: {
                    key: 'TAS',
                    title: 'Starfinder-TAS',
                    color: {
                        bgLabel: 'grey',
                        label: 'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)',
                        bgText: 'grey',
                        text: 'black;background:linear-gradient(#304352,#d7d2cc,#d7d2cc,#d7d2cc,#304352)'
                    }
                }
            },


            config = {
                debugMode: false,
                logging: {
                    log: true,
                    notice: true,
                    info: true,
                    warn: true,
                    error: true,
                    debug: false
                }
            },

            dataLogger = function(primaryLogger, secondaryLogger, data) {
                _.each(data, function(m) {
                    var type = complexType(m);
                    switch (type) {
                        case 'string':
                            primaryLogger(m);
                            break;
                        case 'undefined':
                        case 'null':
                        case 'NaN':
                            primaryLogger('[' + type + ']');
                            break;
                        case 'number':
                        case 'not a number':
                        case 'integer':
                        case 'decimal':
                        case 'boolean':
                            primaryLogger('[' + type + ']:' + m);
                            break;
                        default:
                            primaryLogger('[' + type + ']:=========================================');
                            secondaryLogger(m);
                            primaryLogger('=========================================================');
                            break;
                    }
                });
            },
            complexType = function(o) {
                switch (typeof o) {
                    case 'string':
                        return 'string';
                    case 'boolean':
                        return 'boolean';
                    case 'number':
                        return (_.isNaN(o) ? 'NaN' : (o.toString().match(/\./) ? 'decimal' : 'integer'));
                    case 'function':
                        return 'function:' + (o.name ? o.name + '()' : '(anonymous)');
                    case 'object':
                        return (_.isArray(o) ? 'array' : (_.isArguments(o) ? 'arguments' : (_.isNull(o) ? 'null' : 'object')));
                    default:
                        return typeof o;
                }
            },

            colorLog = function(options) {
                var coloredLoggerFunction,
                    key = options.key,
                    label = options.title || 'TAS',
                    lBGColor = (options.color && options.color.bgLabel) || 'blue',
                    lTxtColor = (options.color && options.color.label) || 'white',
                    mBGColor = (options.color && options.color.bgText) || 'blue',
                    mTxtColor = (options.color && options.color.text) || 'white';

                coloredLoggerFunction = function(message) {
                    console.log(
                        '%c' + label + ': %c' + message + '',
                        'background-color:' + lBGColor + ';color:' + lTxtColor + '; font-weight:bold;',
                        'background-color:' + mBGColor + ';color:' + mTxtColor + ';'
                    );
                };
                return function() {
                    if ('TAS' === key || config.logging[key]) {
                        dataLogger(coloredLoggerFunction, function(m) {
                            console.log(m);
                        }, _.toArray(arguments));
                    }
                };
            },

            logDebug = colorLog(loggingSettings.debug),
            logError = colorLog(loggingSettings.error),
            logWarn = colorLog(loggingSettings.warn),
            logInfo = colorLog(loggingSettings.info),
            logNotice = colorLog(loggingSettings.notice),
            logLog = colorLog(loggingSettings.log),
            log = colorLog(loggingSettings.TAS),
            logCS = colorLog(loggingSettings.callstack),
            logCSA = colorLog(loggingSettings.callstack_async);

        return {
            /* Logging */
            debug: logDebug,
            error: logError,
            warn: logWarn,
            info: logInfo,
            notice: logNotice,
            log: logLog
        };
    }());

    /* ---- END: TheAaronSheet.js ---- */
    /*start starfinder.js*/
    var starfinder = starfinder || (function() {
    'use strict';
    let version = '1.0071566306000', //The sheet's current version. This is put into the character_sheet attribute when a sheet is opened. I've been doing version numbering as 0.0Xyyyyyyyyyy where X represents the state of the sheet (currently in stage 4, or open beta) and y is the UNIX epoch timestamp for when I finished that build
        pilotingRanks = {},
        sheetAttributes = [
            /*An array of all the non-repeating sheet attributes that could potentially be used in the calculations performed by the script
                                            This array is used in the getAttrs call in accessStarfinder()*/
            /*Class & Character attributes*/
            'character_name', 'character_id', 'bab', 'character_level', 'race', 'caster_level',
            'class_1_name', 'class_2_name', 'class_3_name', 'class_4_name', 'class_5_name',
            'class_1_max_spell', 'class_2_max_spell', 'class_3_max_spell', 'class_4_max_spell', 'class_5_max_spell',
            'class_1_level', 'class_2_level', 'class_3_level', 'class_4_level', 'class_5_level', 'class_1_sp', 'class_2_sp',
            'class_3_sp', 'class_4_sp', 'class_5_sp', 'class_1_hp', 'class_2_hp', 'class_3_hp', 'class_4_hp', 'class_5_hp',
            'class_1_bab', 'class_2_bab', 'class_3_bab', 'class_4_bab', 'class_5_bab',
            'class_1_fort', 'class_2_fort', 'class_3_fort', 'class_4_fort', 'class_5_fort',
            'class_1_ref', 'class_2_ref', 'class_3_ref', 'class_4_ref', 'class_5_ref',
            'class_1_will', 'class_2_will', 'class_3_will', 'class_4_will', 'class_5_will',
            'class_1_ability', 'class_2_ability', 'class_3_ability', 'class_4_ability', 'class_5_ability',
            'class_1_skills', 'class_2_skills', 'class_3_skills', 'class_4_skills', 'class_5_skills',
            'class_1_casting_ability', 'class_2_casting_ability', 'class_3_casting_ability', 'class_4_casting_ability', 'class_5_casting_ability',
            'class_1_spells', 'class_2_spells', 'class_3_spells', 'class_4_spells', 'class_5_spells', 'is_caster',
            'class_1_spell_progression', 'class_2_spell_progression', 'class_3_spell_progression', 'class_4_spell_progression', 'class_5_spell_progression',
            'char_max_spell', 'race_hp', 'cr',
            /*ability score attributes*/
            'strength', 'dexterity', 'constitution', 'intelligence', 'wisdom', 'charisma', 'strength_penalty', 'dexterity_penalty', 'constitution_penalty',
            'strength_base', 'dexterity_base', 'constitution_base', 'intelligence_base', 'wisdom_base', 'charisma_base',
            'intelligence_penalty', 'wisdom_penalty', 'charisma_penalty', 'strength_drain', 'dexterity_drain', 'constitution_drain', 'intelligence_drain',
            'wisdom_drain', 'charisma_drain', 'strength_mod', 'dexterity_mod', 'constitution_mod', 'intelligence_mod', 'wisdom_mod', 'charisma_mod',
            /*Initiative attributes*/
            'initiative_ability', 'initiative', 'initiative_base',
            /*AC attributes*/
            'eac', 'kac', 'cmd', 'eac_armor', 'kac_armor', 'eac_ability', 'kac_ability', 'eac_base', 'kac_base', 'cmd_base',
            /*Save attributess*/
            'fort', 'ref', 'will', 'fort_base', 'ref_base', 'will_base', 'fort_ability', 'ref_ability', 'will_ability',
            /*Skill attributes*/
            'skill_points_max',
            'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism',
            'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival', 'acrobatics_ability', 'athletics_ability',
            'bluff_ability', 'computers_ability', 'culture_ability', 'diplomacy_ability', 'disguise_ability', 'engineering_ability', 'intimidate_ability',
            'life_science_ability', 'medicine_ability', 'mysticism_ability', 'perception_ability', 'physical_science_ability', 'piloting_ability',
            'sense_motive_ability', 'sleight_of_hand_ability', 'stealth_ability', 'survival_ability', 'acrobatics_ranks', 'athletics_ranks', 'bluff_ranks',
            'computers_ranks', 'culture_ranks', 'diplomacy_ranks', 'disguise_ranks', 'engineering_ranks', 'intimidate_ranks', 'life_science_ranks',
            'medicine_ranks', 'mysticism_ranks', 'perception_ranks', 'physical_science_ranks', 'piloting_ranks', 'sense_motive_ranks', 'sleight_of_hand_ranks',
            'stealth_ranks', 'survival_ranks', 'acrobatics_class_skill', 'athletics_class_skill', 'bluff_class_skill', 'computers_class_skill',
            'culture_class_skill', 'diplomacy_class_skill', 'disguise_class_skill', 'engineering_class_skill', 'intimidate_class_skill',
            'life_science_class_skill', 'medicine_class_skill', 'mysticism_class_skill', 'perception_class_skill', 'physical_science_class_skill',
            'piloting_class_skill', 'sense_motive_class_skill', 'sleight_of_hand_class_skill', 'stealth_class_skill', 'survival_class_skill',
            'acrobatics_acp', 'athletics_acp', 'bluff_acp', 'computers_acp', 'culture_acp', 'diplomacy_acp', 'disguise_acp', 'engineering_acp', 'intimidate_acp', 'life_science_acp', 'medicine_acp', 'mysticism_acp',
            'perception_acp', 'physical_science_acp', 'piloting_acp', 'sense_motive_acp', 'sleight_of_hand_acp', 'stealth_acp', 'survival_acp',
            'acrobatics_base', 'athletics_base', 'bluff_base', 'computers_base', 'culture_base', 'diplomacy_base', 'disguise_base', 'engineering_base', 'intimidate_base', 'life_science_base', 'medicine_base', 'mysticism_base',
            'perception_base', 'physical_science_base', 'piloting_base', 'sense_motive_base', 'sleight_of_hand_base', 'stealth_base', 'survival_base',
            /*Health attributes*/
            'sp', 'hp', 'rp', 'temp_hp', 'sp_max', 'hp_max', 'rp_max', 'temp_hp_max',
            /*Item attributes*/
            'wealth', 'carried_bulk', 'encumber_bulk', 'overburden_bulk',
            /*sheet setting attributes*/
            'resolve_source', 'stackable_buffs', 'sheet_type', 'half_specializations', 'drone',
            //proficiency attributes
            'light_armor_proficiency', 'heavy_armor_proficiency', 'power_armor_proficiency', 'basic_melee_proficiency', 'advanced_melee_proficiency',
            'small_arm_proficiency', 'longarm_proficiency', 'heavy_weapon_proficiency', 'grenade_proficiency', 'sniper_proficiency',
            //conditions
            'asleep', 'blinded', 'cowering', 'dazzled', 'deafened', 'encumbered', 'entangled', 'exhausted', 'fascinated', 'fatigued', 'flat_footed',
            'frightened', 'grappled', 'helpless', 'negative_levels', 'off_kilter', 'off_target', 'overburdened', 'panicked', 'paralyzed', 'pinned', 'prone',
            'shaken', 'sickened', 'stunned', 'unconscious'
        ],
        silent = {silent:true},
        repeatingAttributes = [
            /*Array of objects with the attributes in each repeating section that need to be gotten with getAttrs,
                                                used in getID()
                            Entity format:
                            {
                                section:'Name of the section',
                                fields:['name_of_the_attribute']
                            }
                            */
            {
                section: 'item',
                fields: ['name', 'bulk', 'cost', 'quantity', 'mods', 'equipped', 'purpose', 'type', 'proficiency', 'level', 'uses_max', 'uses_max_base', 'uses']
            }, {
                section: 'attack',
                fields: ['ability', 'bonus', 'damage_dice', 'damage_ability', 'damage_bonus', 'level', 'bonus',
                    'type', 'total', 'damage_total', 'proficiency', 'category', 'range', 'name', 'engagement_range', 'base_attack_bonus', 'base_attack_bonus_base', 'special','full_attack_number'
                ]
            }, {
                section: 'profession',
                fields: ['ranks', 'class_skill', 'ability', 'acp', 'name', 'base']
            }, {
                section: 'buff',
                fields: ['mods', 'toggle', 'range', 'name']
            }, {
                section: 'ability',
                fields: ['level', 'mods', 'toggle', 'frequency', 'source', 'uses_max_base', 'base_attack_bonus_base', 'base_attack_bonus', 'attack_bonus', 'range', 'name', 'attack_ability', 'damage_ability', 'attack_type', 'save_ability', 'dc_base', 'type', 'spell_resistance', 'spell_penetration_misc', 'save_type']
            }, {
                section: 'spell',
                fields: ['source', 'attack_bonus', 'attack_ability', 'damage_ability', 'base_attack_bonus_base', 'base_attack_bonus', 'range', 'name', 'attack_type', 'save_ability', 'level', 'dc_base', 'spell_resistance', 'spell_penetration_misc', 'save_checkbox', 'save_type']
            }, {
                section: 'condition',
                fields: ['track', 'track_status', 'name']
            }
        ],
        repeatingShipAttributes = [ //as repeatingAttributes, but for when the sheet is set to be a ship
            {
                section: 'attack',
                fields: ['pcu', 'bp', 'powered']
            }, {
                section: 'system',
                fields: ['pcu', 'bp', 'powered', 'comp_bonus', 'purpose', 'shields', 'armor', 'countermeasure', 'sensor_bonus']
            },
        ],
        skillList = [ //Array of all the skills, used to iterate through them.
            'acrobatics',
            'athletics',
            'bluff',
            'computers',
            'culture',
            'diplomacy',
            'disguise',
            'engineering',
            'intimidate',
            'life_science',
            'medicine',
            'mysticism',
            'profession',
            'perception',
            'physical_science',
            'piloting',
            'sense_motive',
            'sleight_of_hand',
            'stealth',
            'survival'
        ],
        conditionList = ['asleep', 'blinded', 'confused', 'cowering', 'dazed', 'dazzled', 'dead', 'deafened', 'dying', 'entangled', 'exhausted', 'fascinated', 'fatigued', 'flat_footed', 'frightened', 'grappled', 'helpless', 'nauseated', 'negative_levels', 'off_kilter', 'off_target', 'panicked', 'paralyzed', 'pinned', 'prone', 'shaken', 'sickened', 'stable', 'staggered', 'stunned', 'unconscious'],
        attributeObjs = {
            //proficiency attributes
            light_armor_proficiency: {
                attr: 'light_armor_proficiency',
                affects: ['item|proficiency']
            },
            heavy_armor_proficiency: {
                attr: 'heavy_armor_proficiency',
                affects: ['item|proficiency']
            },
            power_armor_proficiency: {
                attr: 'power_armor_proficiency',
                affects: ['item|proficiency']
            },
            basic_melee_proficiency: {
                attr: 'basic_melee_proficiency',
                affects: ['attack|proficiency']
            },
            advanced_melee_proficiency: {
                attr: 'advanced_melee_proficiency',
                affects: ['attack|proficiency']
            },
            small_arm_proficiency: {
                attr: 'small_arm_proficiency',
                affects: ['attack|proficiency']
            },
            longarm_proficiency: {
                attr: 'longarm_proficiency',
                affects: ['attack|proficiency']
            },
            heavy_weapon_proficiency: {
                attr: 'heavy_weapon_proficiency',
                affects: ['attack|proficiency']
            },
            grenade_proficiency: {
                attr: 'grenade_proficiency',
                affects: ['attack|proficiency']
            },
            sniper_proficiency: {
                attr: 'sniper_proficiency',
                affects: ['attack|proficiency']
            },
            'light_armor_proficiency': {
                attr: 'light_armor_proficiency',
                affects: ['eac', 'kac']
            },
            'heavy_armor_proficiency': {
                attr: 'heavy_armor_proficiency',
                affects: ['eac', 'kac']
            },
            'power_armor_proficiency': {
                attr: 'power_armor_proficiency',
                affects: ['eac', 'kac']
            },

            //condition attributes
            'asleep': {
                attr: 'asleep',
                affects: ['perception', 'helpless']
            },
            'blinded': {
                attr: 'blinded',
                affects: ['perception', 'flat_footed']
            },
            'confused': {
                attr: 'confused',
                affects: []
            },
            'cowering': {
                attr: 'cowering',
                affects: ['flat_footed']
            },
            'dazzled': {
                attr: 'dazzled',
                affects: ['perception', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'deafened': {
                attr: 'deafened',
                affects: ['initiative', 'perception']
            },
            'encumbered': {
                attr: 'encumbered',
                affects: ['eac', 'kac']
            },
            'entangled': {
                attr: 'entangled',
                affects: ['eac', 'kac', 'attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative']
            },
            'exhausted': {
                attr: 'exhausted',
                affects: ['eac', 'kac', 'attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative', 'encumber_bulk']
            },
            'fascinated': {
                attr: 'fascinated',
                affects: []
            }, //think about handling for this
            'fatigued': {
                attr: 'fatigued',
                affects: ['eac', 'kac', 'attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative', 'encumber_bulk']
            },
            'flat_footed': {
                attr: 'flat_footed',
                affects: ['eac', 'kac']
            },
            'frightened': {
                attr: 'frightened',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'grappled': {
                attr: 'grappled',
                affects: ['eac', 'kac', 'initiative', 'ref', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'helpless': {
                attr: 'helpless',
                affects: ['dexterity_mod']
            },
            'negative_levels': {
                attr: 'negative_levels',
                affects: ['ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival', 'eac', 'kac', 'sp_max', 'hp_max', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'off_kilter': {
                attr: 'off_kilter',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'flat_footed']
            },
            'off_target': {
                attr: 'off_target',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'overburdened': {
                attr: 'overburdened',
                affects: []
            },
            'panicked': {
                attr: 'panicked',
                affects: ['ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'paralyzed': {
                attr: 'paralyzed',
                affects: ['dexterity_mod']
            },
            'pinned': {
                attr: 'pinned',
                affects: ['eac', 'kac', 'initiative', 'ref', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'prone': {
                attr: 'prone',
                affects: ['attack|total']
            },
            'shaken': {
                attr: 'shaken',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'sickened': {
                attr: 'sickened',
                affects: ['attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'stunned': {
                attr: 'stunned',
                affects: ['flat_footed']
            },
            'unconscious': {
                attr: 'unconscious',
                affects: ['helpless']
            },
            'condition|track': {
                repeating: 'condition',
                attr: 'track',
                affects: ['sickened', 'fatigued', 'exhausted', 'unconscious', 'dead', 'shaken', 'spell|dc', 'ability|dc', 'flat_footed', 'encumber_level', 'overburden_bulk', 'encumber_bulk', 'staggered', 'helpless', 'ref', 'eac', 'kac', 'fort', 'intelligence', 'will', 'confused']
            },
            'condition|track_status': {
                repeating: 'condition',
                attr: 'track_status',
                affects: ['sickened', 'fatigued', 'exhausted', 'unconscious', 'dead', 'shaken', 'spell|dc', 'ability|dc', 'flat_footed', 'encumber_level', 'overburden_bulk', 'encumber_bulk', 'staggered', 'helpless', 'ref', 'eac', 'kac', 'fort', 'intelligence', 'will', 'confused']
            },

            //class/character generic attributes
            "race_hp": {
                "repeating": false,
                "attr": "race_hp",
                "affects": ["hp_max"]
            },
            "class_1_level": {
                "repeating": false,
                "attr": "class_1_level",
                "affects": ["sp_max", "hp_max", "rp_max", "fort_base", "ref_base", "will_base", "bab", "skill_points_max", "spell|dc", "ability|dc", "caster_level", "character_level",'attack|damage_total']
            },
            "class_1_sp": {
                "repeating": false,
                "attr": "class_1_sp",
                "affects": ["sp_max"]
            },
            "class_1_hp": {
                "repeating": false,
                "attr": "class_1_hp",
                "affects": ["hp_max"]
            },
            "class_1_bab": {
                "repeating": false,
                "attr": "class_1_bab",
                "affects": ["bab"]
            },
            "class_1_fort": {
                "repeating": false,
                "attr": "class_1_fort",
                "affects": ["fort_base"]
            },
            "class_1_ref": {
                "repeating": false,
                "attr": "class_1_ref",
                "affects": ["ref_base"]
            },
            "class_1_will": {
                "repeating": false,
                "attr": "class_1_will",
                "affects": ["will_base"]
            },
            "class_1_skills": {
                "repeating": false,
                "attr": "class_1_skills",
                "affects": ["skill_points_max"]
            },
            "class_1_spells": {
                repeating: false,
                attr: "class_1_spells",
                affects: ['caster_level']
            },
            "class_1_ability": {
                "repeating": false,
                "attr": "class_1_ability",
                "affects": ["rp_max", "spell|dc", "ability|dc"]
            },
            "class_2_level": {
                "repeating": false,
                "attr": "class_2_level",
                "affects": ["character_level",'attack|damage_total', "sp_max", "hp_max", "ability|dc", "caster_level", "rp_max", "fort_base", "ref_base", "will_base", "bab", "skill_points_max", "spell|dc", "ability|dc"]
            },
            "class_2_sp": {
                "repeating": false,
                "attr": "class_2_sp",
                "affects": ["sp_max"]
            },
            "class_2_hp": {
                "repeating": false,
                "attr": "class_2_hp",
                "affects": ["hp_max"]
            },
            "class_2_bab": {
                "repeating": false,
                "attr": "class_2_bab",
                "affects": ["bab"]
            },
            "class_2_fort": {
                "repeating": false,
                "attr": "class_2_fort",
                "affects": ["fort_base"]
            },
            "class_2_ref": {
                "repeating": false,
                "attr": "class_2_ref",
                "affects": ["ref_base"]
            },
            "class_2_will": {
                "repeating": false,
                "attr": "class_2_will",
                "affects": ["will_base"]
            },
            "class_2_skills": {
                "repeating": false,
                "attr": "class_2_skills",
                "affects": ["skill_points_max"]
            },
            "class_2_spells": {
                repeating: false,
                attr: "class_2_spells",
                affects: ['caster_level']
            },
            "class_2_ability": {
                "repeating": false,
                "attr": "class_2_ability",
                "affects": ["rp_max", "spell|dc", "ability|dc"]
            },
            "class_3_level": {
                "repeating": false,
                "attr": "class_3_level",
                "affects": ["character_level",'attack|damage_total', "sp_max", "hp_max", "ability|dc", "caster_level", "rp_max", "fort_base", "ref_base", "will_base", "bab", "skill_points_max", "spell|dc", "ability|dc"]
            },
            "class_3_sp": {
                "repeating": false,
                "attr": "class_3_sp",
                "affects": ["sp_max"]
            },
            "class_3_hp": {
                "repeating": false,
                "attr": "class_3_hp",
                "affects": ["hp_max"]
            },
            "class_3_bab": {
                "repeating": false,
                "attr": "class_3_bab",
                "affects": ["bab"]
            },
            "class_3_fort": {
                "repeating": false,
                "attr": "class_3_fort",
                "affects": ["fort_base"]
            },
            "class_3_ref": {
                "repeating": false,
                "attr": "class_3_ref",
                "affects": ["ref_base"]
            },
            "class_3_will": {
                "repeating": false,
                "attr": "class_3_will",
                "affects": ["will_base"]
            },
            "class_3_skills": {
                "repeating": false,
                "attr": "class_3_skills",
                "affects": ["skill_points_max"]
            },
            "class_3_spells": {
                repeating: false,
                attr: "class_3_spells",
                affects: ['caster_level']
            },
            "class_3_ability": {
                "repeating": false,
                "attr": "class_3_ability",
                "affects": ["rp_max", "spell|dc", "ability|dc"]
            },
            "class_4_level": {
                "repeating": false,
                "attr": "class_4_level",
                "affects": ["character_level",'attack|damage_total', "sp_max", "hp_max", "ability|dc", "caster_level", "rp_max", "fort_base", "ref_base", "will_base", "bab", "skill_points_max", "spell|dc", "ability|dc"]
            },
            "class_4_sp": {
                "repeating": false,
                "attr": "class_4_sp",
                "affects": ["sp_max"]
            },
            "class_4_hp": {
                "repeating": false,
                "attr": "class_4_hp",
                "affects": ["hp_max"]
            },
            "class_4_bab": {
                "repeating": false,
                "attr": "class_4_bab",
                "affects": ["bab"]
            },
            "class_4_fort": {
                "repeating": false,
                "attr": "class_4_fort",
                "affects": ["fort_base"]
            },
            "class_4_ref": {
                "repeating": false,
                "attr": "class_4_ref",
                "affects": ["ref_base"]
            },
            "class_4_will": {
                "repeating": false,
                "attr": "class_4_will",
                "affects": ["will_base"]
            },
            "class_4_skills": {
                "repeating": false,
                "attr": "class_4_skills",
                "affects": ["skill_points_max"]
            },
            "class_4_spells": {
                repeating: false,
                attr: "class_4_spells",
                affects: ['caster_level']
            },
            "class_4_ability": {
                "repeating": false,
                "attr": "class_4_ability",
                "affects": ["rp_max", "spell|dc", "ability|dc"]
            },
            "class_5_level": {
                "repeating": false,
                "attr": "class_5_level",
                "affects": ["character_level",'attack|damage_total', "sp_max", "hp_max", "ability|dc", "caster_level", "rp_max", "fort_base", "ref_base", "will_base", "bab", "skill_points_max", "spell|dc", "ability|dc"]
            },
            "class_5_sp": {
                "repeating": false,
                "attr": "class_5_sp",
                "affects": ["sp_max"]
            },
            "class_5_hp": {
                "repeating": false,
                "attr": "class_5_hp",
                "affects": ["hp_max"]
            },
            "class_5_bab": {
                "repeating": false,
                "attr": "class_5_bab",
                "affects": ["bab"]
            },
            "class_5_fort": {
                "repeating": false,
                "attr": "class_5_fort",
                "affects": ["fort_base"]
            },
            "class_5_ref": {
                "repeating": false,
                "attr": "class_5_ref",
                "affects": ["ref_base"]
            },
            "class_5_will": {
                "repeating": false,
                "attr": "class_5_will",
                "affects": ["will_base"]
            },
            "class_5_skills": {
                "repeating": false,
                "attr": "class_5_skills",
                "affects": ["skill_points_max"]
            },
            "class_5_spells": {
                repeating: false,
                attr: "class_5_spells",
                affects: ['caster_level']
            },
            "class_5_ability": {
                "repeating": false,
                "attr": "class_5_ability",
                "affects": ["rp_max", "spell|dc", "ability|dc"]
            },
            caster_level: {
                repeating: false,
                attr: 'caster_level',
                affects: []
            },
            character_level: {
                repeating: false,
                attr: 'character_level',
                affects: []
            },
            "bab": {
                "repeating": false,
                "attr": "bab",
                "affects": ["attack|base_attack_bonus", "spell|base_attack_bonus", "ability|base_attack_bonus", "spell|attack_total", "ability|attack_total", "attack|total"]
            },
            'caster_level_buff': {
                attr: 'caster_level_buff',
                affects: ['caster_level']
            },

            //ability score attributes
            "strength": {
                "repeating": false,
                "attr": "strength",
                "affects": ["strength_mod", "encumber_bulk", "overburden_bulk"],
                "numAdds": 0,
                "attrAdds": ["strength_base", "strength_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "strength_penalty": {
                "repeating": false,
                "attr": "strength_penalty",
                "affects": ["strength_mod"]
            },
            "strength_drain": {
                "repeating": false,
                "attr": "strength_drain",
                "affects": ["strength"]
            },
            "strength_base": {
                "repeating": false,
                "attr": "strength_base",
                "affects": ["strength"]
            },
            "dexterity": {
                "repeating": false,
                "attr": "dexterity",
                "affects": ["dexterity_mod"],
                "numAdds": 0,
                "attrAdds": ["dexterity_base", "dexterity_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "dexterity_penalty": {
                "repeating": false,
                "attr": "dexterity_penalty",
                "affects": ["dexterity_mod"]
            },
            "dexterity_drain": {
                "repeating": false,
                "attr": "dexterity_drain",
                "affects": ["dexterity"]
            },
            "dexterity_base": {
                "repeating": false,
                "attr": "dexterity_base",
                "affects": ["dexterity"]
            },
            "constitution": {
                "repeating": false,
                "attr": "constitution",
                "affects": ["constitution_mod"],
                "numAdds": 0,
                "attrAdds": ["constitution_base", "constitution_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "constitution_penalty": {
                "repeating": false,
                "attr": "constitution_penalty",
                "affects": ["constitution_mod"]
            },
            "constitution_drain": {
                "repeating": false,
                "attr": "constitution_drain",
                "affects": ["constitution"]
            },
            "constitution_base": {
                "repeating": false,
                "attr": "constitution_base",
                "affects": ["constitution"]
            },
            "intelligence": {
                "repeating": false,
                "attr": "intelligence",
                "affects": ["intelligence_mod"],
                "numAdds": 0,
                "attrAdds": ["intelligence_base", "intelligence_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "intelligence_penalty": {
                "repeating": false,
                "attr": "intelligence_penalty",
                "affects": ["intelligence_mod"]
            },
            "intelligence_drain": {
                "repeating": false,
                "attr": "intelligence_drain",
                "affects": ["intelligence"]
            },
            "intelligence_base": {
                "repeating": false,
                "attr": "intelligence_base",
                "affects": ["intelligence"]
            },
            "wisdom": {
                "repeating": false,
                "attr": "wisdom",
                "affects": ["wisdom_mod"],
                "numAdds": 0,
                "attrAdds": ["wisdom_base", "wisdom_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "wisdom_penalty": {
                "repeating": false,
                "attr": "wisdom_penalty",
                "affects": ["wisdom_mod"]
            },
            "wisdom_drain": {
                "repeating": false,
                "attr": "wisdom_drain",
                "affects": ["wisdom"]
            },
            "wisdom_base": {
                "repeating": false,
                "attr": "wisdom_base",
                "affects": ["wisdom"]
            },
            "charisma": {
                "repeating": false,
                "attr": "charisma",
                "affects": ["charisma_mod"],
                "numAdds": 0,
                "attrAdds": ["charisma_base", "charisma_drain"],
                "multAdds": [1, -1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "charisma_penalty": {
                "repeating": false,
                "attr": "charisma_penalty",
                "affects": ["charisma_mod"]
            },
            "charisma_drain": {
                "repeating": false,
                "attr": "charisma_drain",
                "affects": ["charisma"]
            },
            "charisma_base": {
                "repeating": false,
                "attr": "charisma_base",
                "affects": ["charisma"]
            },
            "strength_mod": {
                "repeating": false,
                "attr": "strength_mod",
                "affects": [],
                "numAdds": -5,
                "attrAdds": ["strength", "strength_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "dexterity_mod": {
                "repeating": false,
                "attr": "dexterity_mod",
                "affects": [],
                "numAdds": -5,
                "attrAdds": ["dexterity", "dexterity_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "constitution_mod": {
                "repeating": false,
                "attr": "constitution_mod",
                "affects": ["sp_max"],
                "numAdds": -5,
                "attrAdds": ["constitution", "constitution_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "intelligence_mod": {
                "repeating": false,
                "attr": "intelligence_mod",
                "affects": ["skill_points_max"],
                "numAdds": -5,
                "attrAdds": ["intelligence", "intelligence_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "wisdom_mod": {
                "repeating": false,
                "attr": "wisdom_mod",
                "affects": [],
                "numAdds": -5,
                "attrAdds": ["wisdom", "wisdom_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "charisma_mod": {
                "repeating": false,
                "attr": "charisma_mod",
                "affects": [],
                "numAdds": -5,
                "attrAdds": ["charisma", "charisma_penalty"],
                "multAdds": [0.5, 0.5],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            'strength_buff': {
                attr: 'strength_buff',
                affects: ['strength']
            },
            'dexterity_buff': {
                attr: 'dexterity_buff',
                affects: ['dexterity']
            },
            'constitution_buff': {
                attr: 'constitution_buff',
                affects: ['constitution']
            },
            'intelligence_buff': {
                attr: 'intelligence_buff',
                affects: ['intelligence']
            },
            'wisdom_buff': {
                attr: 'wisdom_buff',
                affects: ['wisdom']
            },
            'charisma_buff': {
                attr: 'charisma_buff',
                affects: ['charisma']
            },

            //health attributes
            "sp_max": {
                "repeating": false,
                "attr": "sp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["constitution_mod", "class_1_sp", "class_2_sp", "class_3_sp", "class_4_sp", "class_5_sp"],
                "multAdds": ["character_level", "class_1_level", "class_2_level", "class_3_level", "class_4_level", "class_5_level"],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "hp_max": {
                "repeating": false,
                "attr": "hp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["class_1_hp", "class_2_hp", "class_3_hp", "class_4_hp", "class_5_hp", "race_hp"],
                "multAdds": ["class_1_level", "class_2_level", "class_3_level", "class_4_level", "class_5_level", 1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "rp_max": {
                "repeating": false,
                "attr": "rp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "ability": "abi",
                "moddable": "_change"
            },
            "temp_hp_max": {
                "repeating": false,
                "attr": "temp_hp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            'temp_hp_buff': {
                attr: 'temp_hp_buff',
                affects: ['temp_hp_max']
            },
            'sp_buff': {
                attr: 'sp_buff',
                affects: ['sp_max']
            },
            'hp_buff': {
                attr: 'hp_buff',
                affects: ['hp_max']
            },
            'rp_buff': {
                attr: 'rp_buff',
                affects: ['rp_max']
            },
            'sp_max_buff': {
                attr: 'sp_max_buff',
                affects: ['sp_max']
            },
            'hp_max_buff': {
                attr: 'hp_max_buff',
                affects: ['hp_max']
            },
            'rp_max_buff': {
                attr: 'rp_max_buff',
                affects: ['rp_max']
            },
            'temp_hp_max_buff': {
                attr: 'temp_hp_max_buff',
                affects: ['temp_hp_max']
            },

            //defensive attributes
            "eac_armor": {
                "repeating": false,
                "attr": "eac_armor",
                rollTime: '_misc',
                "affects": ["eac"],
                "numAdds": 0,
                "attrAdds": [],
                "addlBonus": ["armor"],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "eac_ability": {
                "repeating": false,
                "attr": "eac_ability",
                "affects": ["eac"]
            },
            "kac_armor": {
                "repeating": false,
                "attr": "kac_armor",
                rollTime: '_misc',
                "affects": ["kac"],
                "numAdds": 0,
                "attrAdds": [],
                "addlBonus": ["armor"],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "kac_ability": {
                "repeating": false,
                "attr": "kac_ability",
                "affects": ["kac"]
            },
            "eac": {
                "repeating": false,
                "attr": "eac",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 10,
                "attrAdds": ["eac_armor"],
                "multAdds": [1],
                "ability": "eac_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "kac": {
                "repeating": false,
                "attr": "kac",
                rollTime: '_misc',
                "affects": ["cmd"],
                "numAdds": 10,
                "attrAdds": ["kac_armor"],
                "multAdds": [1],
                "ability": "kac_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "cmd": {
                "repeating": false,
                "attr": "cmd",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 8,
                "attrAdds": ["kac"],
                "multAdds": [1],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "fort": {
                "repeating": false,
                "attr": "fort",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["fort_base"],
                "multAdds": [1],
                "ability": "fort_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "fort_base": {
                "repeating": false,
                "attr": "fort_base",
                "affects": ["fort"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "fort_ability": {
                "repeating": false,
                "attr": "fort_ability",
                "affects": ["fort"]
            },
            "ref": {
                "repeating": false,
                "attr": "ref",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["ref_base"],
                "multAdds": [1],
                "ability": "ref_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "ref_base": {
                "repeating": false,
                "attr": "ref_base",
                "affects": ["ref"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "ref_ability": {
                "repeating": false,
                "attr": "ref_ability",
                "affects": ["ref"]
            },
            "will": {
                "repeating": false,
                "attr": "will",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["will_base"],
                "multAdds": [1],
                "ability": "will_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "will_base": {
                "repeating": false,
                "attr": "will_base",
                "affects": ["will"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "will_ability": {
                "repeating": false,
                "attr": "will_ability",
                "affects": ["will"]
            },
            "initiative": {
                "repeating": false,
                "attr": "initiative",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "ability": "initiative_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "initiative_ability": {
                "repeating": false,
                "attr": "initiative_ability",
                "affects": ["initiative"]
            },
            'initiative_buff': {
                attr: 'initiative_buff',
                affects: ['initiative']
            },
            'eac_buff': {
                attr: 'eac_buff',
                affects: ['eac']
            },
            'eac_armor_buff': {
                attr: 'eac_armor_buff',
                affects: ['eac_armor']
            },
            'kac_buff': {
                attr: 'kac_buff',
                affects: ['kac']
            },
            'kac_armor_buff': {
                attr: 'kac_armor_buff',
                affects: ['kac_armor']
            },
            armor_buff: {
                attr: 'armor_buff',
                affects: ['eac', 'eac_armor', 'kac', 'kac_armor']
            },
            'cmd_buff': {
                attr: 'cmd_buff',
                affects: ['cmd']
            },
            'fort_buff': {
                attr: 'fort_buff',
                affects: ['fort']
            },
            'ref_buff': {
                attr: 'ref_buff',
                affects: ['ref']
            },
            'will_buff': {
                attr: 'will_buff',
                affects: ['will']
            },
            saves_buff: {
                attr: 'saves_buff',
                affects: ['will', 'fort', 'ref']
            },

            //skill attributes
            'skills_buff': {
                attr: 'skills_buff',
                affects: ['acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'profession|profession', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            skill_points_max: {
                "repeating": false,
                "attr": "skill_points_max",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["intelligence_mod", 'class_1_skills', 'class_2_skills', 'class_3_skills', 'class_4_skills', 'class_5_skills'],
                "multAdds": ['character_level', 'class_1_level', 'class_2_level', 'class_3_level', 'class_4_level', 'class_5_level'],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "acrobatics": {
                "repeating": false,
                "attr": "acrobatics",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["acrobatics_ranks", "acrobatics_class_skill"],
                "multAdds": [1, 1],
                "ability": "acrobatics_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "acrobatics_ranks": {
                "repeating": false,
                "attr": "acrobatics_ranks",
                "affects": ["acrobatics"]
            },
            "acrobatics_class_skill": {
                "repeating": false,
                "attr": "acrobatics_class_skill",
                "affects": ["acrobatics"]
            },
            "acrobatics_ability": {
                "repeating": false,
                "attr": "acrobatics_ability",
                "affects": ["acrobatics"]
            },
            "athletics": {
                "repeating": false,
                "attr": "athletics",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["athletics_ranks", "athletics_class_skill"],
                "multAdds": [1, 1],
                "ability": "athletics_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "athletics_ranks": {
                "repeating": false,
                "attr": "athletics_ranks",
                "affects": ["athletics"]
            },
            "athletics_class_skill": {
                "repeating": false,
                "attr": "athletics_class_skill",
                "affects": ["athletics"]
            },
            "athletics_ability": {
                "repeating": false,
                "attr": "athletics_ability",
                "affects": ["athletics"]
            },
            "bluff": {
                "repeating": false,
                "attr": "bluff",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["bluff_ranks", "bluff_class_skill"],
                "multAdds": [1, 1],
                "ability": "bluff_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "bluff_ranks": {
                "repeating": false,
                "attr": "bluff_ranks",
                "affects": ["bluff"]
            },
            "bluff_class_skill": {
                "repeating": false,
                "attr": "bluff_class_skill",
                "affects": ["bluff"]
            },
            "bluff_ability": {
                "repeating": false,
                "attr": "bluff_ability",
                "affects": ["bluff"]
            },
            "computers": {
                "repeating": false,
                "attr": "computers",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["computers_ranks", "computers_class_skill"],
                "multAdds": [1, 1],
                "ability": "computers_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "computers_ranks": {
                "repeating": false,
                "attr": "computers_ranks",
                "affects": ["computers"]
            },
            "computers_class_skill": {
                "repeating": false,
                "attr": "computers_class_skill",
                "affects": ["computers"]
            },
            "computers_ability": {
                "repeating": false,
                "attr": "computers_ability",
                "affects": ["computers"]
            },
            "culture": {
                "repeating": false,
                "attr": "culture",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["culture_ranks", "culture_class_skill"],
                "multAdds": [1, 1],
                "ability": "culture_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "culture_ranks": {
                "repeating": false,
                "attr": "culture_ranks",
                "affects": ["culture"]
            },
            "culture_class_skill": {
                "repeating": false,
                "attr": "culture_class_skill",
                "affects": ["culture"]
            },
            "culture_ability": {
                "repeating": false,
                "attr": "culture_ability",
                "affects": ["culture"]
            },
            "diplomacy": {
                "repeating": false,
                "attr": "diplomacy",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["diplomacy_ranks", "diplomacy_class_skill"],
                "multAdds": [1, 1],
                "ability": "diplomacy_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "diplomacy_ranks": {
                "repeating": false,
                "attr": "diplomacy_ranks",
                "affects": ["diplomacy"]
            },
            "diplomacy_class_skill": {
                "repeating": false,
                "attr": "diplomacy_class_skill",
                "affects": ["diplomacy"]
            },
            "diplomacy_ability": {
                "repeating": false,
                "attr": "diplomacy_ability",
                "affects": ["diplomacy"]
            },
            "disguise": {
                "repeating": false,
                "attr": "disguise",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["disguise_ranks", "disguise_class_skill"],
                "multAdds": [1, 1],
                "ability": "disguise_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "disguise_ranks": {
                "repeating": false,
                "attr": "disguise_ranks",
                "affects": ["disguise"]
            },
            "disguise_class_skill": {
                "repeating": false,
                "attr": "disguise_class_skill",
                "affects": ["disguise"]
            },
            "disguise_ability": {
                "repeating": false,
                "attr": "disguise_ability",
                "affects": ["disguise"]
            },
            "engineering": {
                "repeating": false,
                "attr": "engineering",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["engineering_ranks", "engineering_class_skill"],
                "multAdds": [1, 1],
                "ability": "engineering_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "engineering_ranks": {
                "repeating": false,
                "attr": "engineering_ranks",
                "affects": ["engineering"]
            },
            "engineering_class_skill": {
                "repeating": false,
                "attr": "engineering_class_skill",
                "affects": ["engineering"]
            },
            "engineering_ability": {
                "repeating": false,
                "attr": "engineering_ability",
                "affects": ["engineering"]
            },
            "intimidate": {
                "repeating": false,
                "attr": "intimidate",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["intimidate_ranks", "intimidate_class_skill"],
                "multAdds": [1, 1],
                "ability": "intimidate_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "intimidate_ranks": {
                "repeating": false,
                "attr": "intimidate_ranks",
                "affects": ["intimidate"]
            },
            "intimidate_class_skill": {
                "repeating": false,
                "attr": "intimidate_class_skill",
                "affects": ["intimidate"]
            },
            "intimidate_ability": {
                "repeating": false,
                "attr": "intimidate_ability",
                "affects": ["intimidate"]
            },
            "life_science": {
                "repeating": false,
                "attr": "life_science",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["life_science_ranks", "life_science_class_skill"],
                "multAdds": [1, 1],
                "ability": "life_science_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "life_science_ranks": {
                "repeating": false,
                "attr": "life_science_ranks",
                "affects": ["life_science"]
            },
            "life_science_class_skill": {
                "repeating": false,
                "attr": "life_science_class_skill",
                "affects": ["life_science"]
            },
            "life_science_ability": {
                "repeating": false,
                "attr": "life_science_ability",
                "affects": ["life_science"]
            },
            "medicine": {
                "repeating": false,
                "attr": "medicine",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["medicine_ranks", "medicine_class_skill"],
                "multAdds": [1, 1],
                "ability": "medicine_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "medicine_ranks": {
                "repeating": false,
                "attr": "medicine_ranks",
                "affects": ["medicine"]
            },
            "medicine_class_skill": {
                "repeating": false,
                "attr": "medicine_class_skill",
                "affects": ["medicine"]
            },
            "medicine_ability": {
                "repeating": false,
                "attr": "medicine_ability",
                "affects": ["medicine"]
            },
            "mysticism": {
                "repeating": false,
                "attr": "mysticism",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["mysticism_ranks", "mysticism_class_skill"],
                "multAdds": [1, 1],
                "ability": "mysticism_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "mysticism_ranks": {
                "repeating": false,
                "attr": "mysticism_ranks",
                "affects": ["mysticism"]
            },
            "mysticism_class_skill": {
                "repeating": false,
                "attr": "mysticism_class_skill",
                "affects": ["mysticism"]
            },
            "mysticism_ability": {
                "repeating": false,
                "attr": "mysticism_ability",
                "affects": ["mysticism"]
            },
            "perception": {
                "repeating": false,
                "attr": "perception",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["perception_ranks", "perception_class_skill"],
                "multAdds": [1, 1],
                "ability": "perception_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "perception_ranks": {
                "repeating": false,
                "attr": "perception_ranks",
                "affects": ["perception"]
            },
            "perception_class_skill": {
                "repeating": false,
                "attr": "perception_class_skill",
                "affects": ["perception"]
            },
            "perception_ability": {
                "repeating": false,
                "attr": "perception_ability",
                "affects": ["perception"]
            },
            "physical_science": {
                "repeating": false,
                "attr": "physical_science",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["physical_science_ranks", "physical_science_class_skill"],
                "multAdds": [1, 1],
                "ability": "physical_science_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "physical_science_ranks": {
                "repeating": false,
                "attr": "physical_science_ranks",
                "affects": ["physical_science"]
            },
            "physical_science_class_skill": {
                "repeating": false,
                "attr": "physical_science_class_skill",
                "affects": ["physical_science"]
            },
            "physical_science_ability": {
                "repeating": false,
                "attr": "physical_science_ability",
                "affects": ["physical_science"]
            },
            "piloting": {
                "repeating": false,
                "attr": "piloting",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["piloting_ranks", "piloting_class_skill"],
                "multAdds": [1, 1],
                "ability": "piloting_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "piloting_ranks": {
                "repeating": false,
                "attr": "piloting_ranks",
                "affects": ["piloting"]
            },
            "piloting_class_skill": {
                "repeating": false,
                "attr": "piloting_class_skill",
                "affects": ["piloting"]
            },
            "piloting_ability": {
                "repeating": false,
                "attr": "piloting_ability",
                "affects": ["piloting"]
            },
            "sense_motive": {
                "repeating": false,
                "attr": "sense_motive",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["sense_motive_ranks", "sense_motive_class_skill"],
                "multAdds": [1, 1],
                "ability": "sense_motive_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "sense_motive_ranks": {
                "repeating": false,
                "attr": "sense_motive_ranks",
                "affects": ["sense_motive"]
            },
            "sense_motive_class_skill": {
                "repeating": false,
                "attr": "sense_motive_class_skill",
                "affects": ["sense_motive"]
            },
            "sense_motive_ability": {
                "repeating": false,
                "attr": "sense_motive_ability",
                "affects": ["sense_motive"]
            },
            "sleight_of_hand": {
                "repeating": false,
                "attr": "sleight_of_hand",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["sleight_of_hand_ranks", "sleight_of_hand_class_skill"],
                "multAdds": [1, 1],
                "ability": "sleight_of_hand_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "sleight_of_hand_ranks": {
                "repeating": false,
                "attr": "sleight_of_hand_ranks",
                "affects": ["sleight_of_hand"]
            },
            "sleight_of_hand_class_skill": {
                "repeating": false,
                "attr": "sleight_of_hand_class_skill",
                "affects": ["sleight_of_hand"]
            },
            "sleight_of_hand_ability": {
                "repeating": false,
                "attr": "sleight_of_hand_ability",
                "affects": ["sleight_of_hand"]
            },
            "stealth": {
                "repeating": false,
                "attr": "stealth",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["stealth_ranks", "stealth_class_skill"],
                "multAdds": [1, 1],
                "ability": "stealth_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "stealth_ranks": {
                "repeating": false,
                "attr": "stealth_ranks",
                "affects": ["stealth"]
            },
            "stealth_class_skill": {
                "repeating": false,
                "attr": "stealth_class_skill",
                "affects": ["stealth"]
            },
            "stealth_ability": {
                "repeating": false,
                "attr": "stealth_ability",
                "affects": ["stealth"]
            },
            "survival": {
                "repeating": false,
                "attr": "survival",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ["survival_ranks", "survival_class_skill"],
                "multAdds": [1, 1],
                "ability": "survival_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "survival_ranks": {
                "repeating": false,
                "attr": "survival_ranks",
                "affects": ["survival"]
            },
            "survival_class_skill": {
                "repeating": false,
                "attr": "survival_class_skill",
                "affects": ["survival"]
            },
            "survival_ability": {
                "repeating": false,
                "attr": "survival_ability",
                "affects": ["survival"]
            },
            'skill_points_buff': {
                attr: 'skill_points_buff',
                affects: ['skill_points_max']
            },
            'acrobatics_buff': {
                attr: 'acrobatics_buff',
                affects: ['acrobatics']
            },
            'athletics_buff': {
                attr: 'athletics_buff',
                affects: ['athletics']
            },
            'bluff_buff': {
                attr: 'bluff_buff',
                affects: ['bluff']
            },
            'computers_buff': {
                attr: 'computers_buff',
                affects: ['computers']
            },
            'culture_buff': {
                attr: 'culture_buff',
                affects: ['culture']
            },
            'diplomacy_buff': {
                attr: 'diplomacy_buff',
                affects: ['diplomacy']
            },
            'disguise_buff': {
                attr: 'disguise_buff',
                affects: ['disguise']
            },
            'engineering_buff': {
                attr: 'engineering_buff',
                affects: ['engineering']
            },
            'intimidate_buff': {
                attr: 'intimidate_buff',
                affects: ['intimidate']
            },
            'life_science_buff': {
                attr: 'life_science_buff',
                affects: ['life_science']
            },
            'medicine_buff': {
                attr: 'medicine_buff',
                affects: ['medicine']
            },
            'mysticism_buff': {
                attr: 'mysticism_buff',
                affects: ['mysticism']
            },
            'perception_buff': {
                attr: 'perception_buff',
                affects: ['perception']
            },
            'physical_science_buff': {
                attr: 'physical_science_buff',
                affects: ['physical_science']
            },
            'piloting_buff': {
                attr: 'piloting_buff',
                affects: ['piloting']
            },
            'sense_motive_buff': {
                attr: 'sense_motive_buff',
                affects: ['sense_motive']
            },
            'sleight_of_hand_buff': {
                attr: 'sleight_of_hand_buff',
                affects: ['sleight_of_hand']
            },
            'stealth_buff': {
                attr: 'stealth_buff',
                affects: ['stealth']
            },
            'survival_buff': {
                attr: 'survival_buff',
                affects: ['survival']
            },

            //profession attributes
            "profession|profession": {
                "repeating": "profession",
                "attr": "profession",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": [],
                "repeatAdds": ["ranks", "class_skill"],
                "ability": "ability",
                "repeatTextAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "profession|ranks": {
                "repeating": "profession",
                "attr": "ranks",
                "affects": ["profession|profession"]
            },
            "profession|class_skill": {
                "repeating": "profession",
                "attr": "class_skill",
                "affects": ["profession|profession"]
            },
            "profession|ability": {
                "repeating": 'profession',
                "attr": "ability",
                "affects": ["profession|profession"]
            },

            //item attributes
            'item|proficiency': {
                repeating: 'item',
                attr: 'proficiency',
                affects: ['eac', 'kac']
            },
            'item|type': {
                repeating: 'item',
                attr: 'type',
                affects: ['eac', 'kac']
            },
            'item|purpose': {
                repeating: 'item',
                attr: 'purpose',
                affects: ['eac', 'kac']
            },
            'item|equipped': {
                repeating: 'item',
                attr: 'equipped',
                affects: ['eac', 'kac', 'carried_bulk', 'wealth']
            },
            'item|bulk': {
                repeating: 'item',
                attr: 'bulk',
                affects: ['carried_bulk']
            },
            'item|quantity': {
                repeating: 'item',
                attr: 'quantity',
                affects: ['carried_bulk', 'wealth']
            },
            'item|cost': {
                repeating: 'item',
                attr: 'cost',
                affects: ['wealth']
            },
            'item|uses_max_base': {
                repeating: 'item',
                attr: 'uses_max_base',
                affects: ['item|uses_max']
            },
            "item|uses_max": {
                "repeating": "item",
                "attr": "uses_max",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "repeatParseField": ["uses_max_base"],
                "moddable": "_change"
            },
            "encumber_bulk": {
                "repeating": false,
                "attr": "encumber_bulk",
                "numAdds": 1,
                "attrAdds": ["strength"],
                "multAdds": [0.5],
                "affects": ['encumber_level'],
                rollTime: '_misc',
                moddable: '_change'
            },
            "overburden_bulk": {
                "repeating": false,
                "attr": "overburden_bulk",
                "numAdds": 0,
                "attrAdds": ["strength"],
                "multAdds": [1],
                "affects": ['encumber_level'],
                rollTime: '_misc',
                moddable: '_change'
            },
            carried_bulk: {
                repeating: false,
                attr: 'carried_bulk',
                affects: ['encumber_level']
            },
            wealth: {
                repeating: false,
                attr: 'wealth',
                affects: []
            },
            'encumber_bulk_buff': {
                attr: 'encumber_bulk_buff',
                affects: ['encumber_bulk']
            },
            'overburden_bulk_buff': {
                attr: 'overburden_bulk_buff',
                affects: ['overburden_bulk']
            },
            encumber_level: {
                repeating: false,
                attr: 'encumber_level',
                affects: ['eac', 'kac', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival', 'profession|profession']
            },

            //attack attributes
            'attack|name': {
                repeating: 'attack',
                attr: 'name',
                affects: ['attack|base_attack_bonus']
            },
            "attack|total": {
                "repeating": "attack",
                "attr": "total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "category": "category",
                "ability": "ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "repeatParseField": ['bonus'],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "attack|base_attack_bonus": {
                "repeating": "attack",
                "attr": "base_attack_bonus",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "category": "category",
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "attack|ability": {
                "repeating": 'attack',
                "attr": "ability",
                "affects": ["attack|total", 'attack|base_attack_bonus']
            },
            'attack|engagement_range': {
                repeating: 'attack',
                attr: 'engagement_range',
                affects: []
            },
            'attack|type': {
                repeating: 'attack',
                attr: 'type',
                affects: []
            },
            'attack|crit': {
                repeating: 'attack',
                attr: 'crit',
                affects: []
            },
            'attack|damage_dice': {
                repeating: 'attack',
                attr: 'damage_dice',
                affects: ['attack|damage_total']
            },
            'attack|proficiency': {
                "repeating": 'attack',
                "attr": "proficiency",
                "affects": ["attack|total", 'attack|damage_total']
            },
            'attack|category': {
                "repeating": 'attack',
                "attr": "category",
                "affects": ["attack|total", 'attack|damage_total']
            },
            'attack|bonus': {
                "repeating": 'attack',
                "attr": "bonus",
                "affects": ["attack|total"]
            },
            "attack|damage_total": {
                "repeating": "attack",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice"],
                "category": "category",
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "attack|damage_ability": {
                "repeating": 'attack',
                "attr": "damage_ability",
                "affects": ["attack|damage_total"]
            },

            //ability attributes
            'ability|name': {
                repeating: 'ability',
                attr: 'name',
                affects: ['ability|base_attack_bonus'],
                attrAdds: [],
                moddable: false,
                rollTime: false
            },
            'ability|uses_max_base': {
                repeating: 'ability',
                attr: 'uses_max_base',
                affects: ['ability|uses_max']
            },
            "ability|uses_max": {
                "repeating": "ability",
                "attr": "uses_max",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "repeatParseField": ["uses_max_base"],
                "moddable": "_change"
            },
            "ability|base_attack_bonus": {
                "repeating": "ability",
                "attr": "base_attack_bonus",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "category": "category",
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "ability|attack_total": {
                "repeating": "ability",
                "attr": "attack_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "ability": "ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": true,
                "rollTime": "misc"
            },
            "ability|attack_ability": {
                "repeating": 'ability',
                "attr": "attack_ability",
                "affects": ["ability|attack_total"]
            },
            'ability|damage_dice': {
                repeating: 'attack',
                attr: 'damage_dice',
                affects: ['ability|damage_total']
            },
            "ability|damage_total": {
                "repeating": "ability",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice"],
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": true,
                "rollTime": "misc"
            },
            "ability|damage_ability": {
                "repeating": 'ability',
                "attr": "damage_ability",
                "affects": ["ability|damage_total"]
            },
            'ability|type': {
                "repeating": 'ability',
                "attr": "type",
                "affects": ["ability|dc"]
            },
            'ability|level': {
                "repeating": 'ability',
                "attr": "level",
                "affects": ["ability|dc"]
            },
            "ability|dc": {
                "repeating": "ability",
                "attr": "dc",
                "affects": [],
                "attrAdds": ["lvl"],
                "multAdds": [0.5],
                "numAdds": 10,
                "ability": "save_ability",
                "moddable": "_change"
            },
            "ability|save_ability": {
                "repeating": 'ability',
                "attr": "save_ability",
                "affects": ["ability|dc"]
            },
            'ability|spell_resistance': {
                repeating: 'ability',
                attr: 'spell_resistance',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: 'spell_penetration_misc'
            },
            'ability|source': {
                repeating: 'ability',
                attr: 'source',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: false
            },

            //spell attributes
            'spell|name': {
                repeating: 'spell',
                attr: 'name',
                affects: ['spell|base_attack_bonus'],
                attrAdds: [],
                moddable: false,
                rollTime: false
            },
            'spell|save_checkbox': {
                repeating: 'spell',
                attr: 'save_checkbox',
                affects: ['spell|dc'],
                attrAdds: [],
                moddable: false,
                rollTime: false
            },
            'spell|spell_resistance': {
                repeating: 'spell',
                attr: 'spell_resistance',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: 'spell_penetration_misc'
            },
            'spell|source': {
                repeating: 'spell',
                attr: 'source',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: false
            },
            "spell|level": {
                "repeating": "spell",
                "attr": "level",
                "affects": ["spell|filter"]
            },
            "spell|base_attack_bonus": {
                "repeating": "spell",
                "attr": "base_attack_bonus",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "category": "category",
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "spell|filter": {
                "repeating": "spell",
                "attr": "filter",
                "affects": []
            },
            "spell|attack_total": {
                "repeating": "spell",
                "attr": "attack_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "ability": "attack_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "spell|attack_ability": {
                "repeating": 'spell',
                "attr": "attack_ability",
                "affects": ["spell|attack_total"]
            },
            "spell|damage_total": {
                "repeating": "spell",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice", "damage_bonus"],
                "category": "category",
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "spell|damage_ability": {
                "repeating": 'spell',
                "attr": "damage_ability",
                "affects": ["spell|damage_total"]
            },
            'spell|damage_dice': {
                repeating: 'spell',
                attr: 'damage_dice',
                affects: ['spell|damage_total']
            },
            "spell|dc": {
                "repeating": "spell",
                "attr": "dc",
                "affects": [],
                "attrAdds": [],
                "repeatAdds": ["level"],
                "numAdds": 10,
                "ability": "save_ability",
                "moddable": "_change"
            },
            "spell|save_ability": {
                "repeating": 'spell',
                "attr": "save_ability",
                "affects": ["spell|dc"]
            }
        },
        npcAttributeObjs = {
            'ability|spell_resistance': {
                repeating: 'ability',
                attr: 'spell_resistance',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: 'spell_penetration_misc'
            },
            'spell|spell_resistance': {
                repeating: 'spell',
                attr: 'spell_resistance',
                affects: [],
                attrAdds: [],
                moddable: false,
                rollTime: 'spell_penetration_misc'
            },
            'strength_buff': {
                attr: 'strength_buff',
                affects: ['strength_mod']
            },
            'dexterity_buff': {
                attr: 'dexterity_buff',
                affects: ['dexterity_mod']
            },
            'constitution_buff': {
                attr: 'constitution_buff',
                affects: ['constitution_mod']
            },
            'intelligence_buff': {
                attr: 'intelligence_buff',
                affects: ['intelligence_mod']
            },
            'wisdom_buff': {
                attr: 'wisdom_buff',
                affects: ['wisdom_mod']
            },
            'charisma_buff': {
                attr: 'charisma_buff',
                affects: ['charisma_mod']
            },
            'eac_buff': {
                attr: 'eac_buff',
                affects: ['eac']
            },
            'eac_armor_buff': {
                attr: 'eac_armor_buff',
                affects: ['eac_armor']
            },
            'kac_buff': {
                attr: 'kac_buff',
                affects: ['kac']
            },
            'kac_armor_buff': {
                attr: 'kac_armor_buff',
                affects: ['kac']
            },
            'cmd_buff': {
                attr: 'cmd_buff',
                affects: ['cmd']
            },
            'fort_buff': {
                attr: 'fort_buff',
                affects: ['fort']
            },
            'ref_buff': {
                attr: 'ref_buff',
                affects: ['ref']
            },
            'will_buff': {
                attr: 'will_buff',
                affects: ['will']
            },
            'skills_buff': {
                attr: 'skills_buff',
                affects: ['acrobatics']
            },
            'acrobatics_buff': {
                attr: 'acrobatics_buff',
                affects: ['acrobatics']
            },
            'athletics_buff': {
                attr: 'athletics_buff',
                affects: ['athletics']
            },
            'bluff_buff': {
                attr: 'bluff_buff',
                affects: ['bluff']
            },
            'computers_buff': {
                attr: 'computers_buff',
                affects: ['computers']
            },
            'culture_buff': {
                attr: 'culture_buff',
                affects: ['culture']
            },
            'diplomacy_buff': {
                attr: 'diplomacy_buff',
                affects: ['diplomacy']
            },
            'disguise_buff': {
                attr: 'disguise_buff',
                affects: ['disguise']
            },
            'engineering_buff': {
                attr: 'engineering_buff',
                affects: ['engineering']
            },
            'intimidate_buff': {
                attr: 'intimidate_buff',
                affects: ['intimidate']
            },
            'life_science_buff': {
                attr: 'life_science_buff',
                affects: ['life_science']
            },
            'medicine_buff': {
                attr: 'medicine_buff',
                affects: ['medicine']
            },
            'mysticism_buff': {
                attr: 'mysticism_buff',
                affects: ['mysticism']
            },
            'perception_buff': {
                attr: 'perception_buff',
                affects: ['perception']
            },
            'physical_science_buff': {
                attr: 'physical_science_buff',
                affects: ['physical_science']
            },
            'piloting_buff': {
                attr: 'piloting_buff',
                affects: ['piloting']
            },
            'sense_motive_buff': {
                attr: 'sense_motive_buff',
                affects: ['sense_motive']
            },
            'sleight_of_hand_buff': {
                attr: 'sleight_of_hand_buff',
                affects: ['sleight_of_hand']
            },
            'stealth_buff': {
                attr: 'stealth_buff',
                affects: ['stealth']
            },
            'survival_buff': {
                attr: 'survival_buff',
                affects: ['survival']
            },
            'caster_level_buff': {
                attr: 'caster_level_buff',
                affects: ['caster_level']
            },
            'initiative_buff': {
                attr: 'initiative_buff',
                affects: ['initiative']
            },
            'asleep': {
                attr: 'asleep',
                affects: ['perception', 'helpless']
            },
            'blinded': {
                attr: 'blinded',
                affects: ['perception', 'flat_footed']
            },
            'confused': {
                attr: 'confused',
                affects: []
            },
            'cowering': {
                attr: 'cowering',
                affects: ['flat_footed']
            },
            'dazzled': {
                attr: 'dazzled',
                affects: ['perception', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'deafened': {
                attr: 'deafened',
                affects: ['initiative', 'perception']
            },
            'encumbered': {
                attr: 'encumbered',
                affects: ['eac', 'kac']
            },
            'entangled': {
                attr: 'entangled',
                affects: ['eac', 'kac', 'attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative']
            },
            'exhausted': {
                attr: 'exhausted',
                affects: ['eac', 'kac', 'attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative']
            },
            'fascinated': {
                attr: 'fascinated',
                affects: [] //think about handling for this
            },
            'fatigued': {
                attr: 'fatigued',
                affects: ['eac', 'kac', 'attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'initiative']
            },
            'flat_footed': {
                attr: 'flat_footed',
                affects: ['eac', 'kac']
            },
            'frightened': {
                attr: 'frightened',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'grappled': {
                attr: 'grappled',
                affects: ['eac', 'kac', 'initiative', 'ref', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'helpless': {
                attr: 'helpless',
                affects: ['dexterity_mod']
            },
            'negative_levels': {
                attr: 'negative_levels',
                affects: ['ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival', 'eac', 'kac', 'sp_max', 'hp_max', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'off_kilter': {
                attr: 'off_kilter',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'flat_footed']
            },
            'off_target': {
                attr: 'off_target',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'overburdened': {
                attr: 'overburdened',
                affects: []
            },
            'panicked': {
                attr: 'panicked',
                affects: ['ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'paralyzed': {
                attr: 'paralyzed',
                affects: ['dexterity_mod']
            },
            'pinned': {
                attr: 'pinned',
                affects: ['eac', 'kac', 'initiative', 'ref', 'attack|total', 'spell|attack_total', 'ability|attack_total']
            },
            'prone': {
                attr: 'prone',
                affects: ['attack|total']
            },
            'shaken': {
                attr: 'shaken',
                affects: ['attack|total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'sickened': {
                attr: 'sickened',
                affects: ['attack|total', 'attack|damage_total', 'spell|attack_total', 'ability|attack_total', 'ref', 'fort', 'will', 'acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'profession|profession', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival']
            },
            'stunned': {
                attr: 'stunned',
                affects: ['flat_footed']
            },
            'unconscious': {
                attr: 'unconscious',
                affects: ['helpless']
            },
            'condition|track': {
                attr: 'condition|track',
                affects: ['sickened', 'fatigued', 'exhausted', 'unconscious', 'dead', 'shaken', 'spell|dc', 'ability|dc', 'flat_footed', 'encumber_level', 'overburden_bulk', 'encumber_bulk', 'staggered', 'helpless', 'ref', 'eac', 'kac', 'fort', 'intelligence', 'will', 'confused']
            },
            'condition|track_status': {
                attr: 'condition|track_status',
                affects: ['sickened', 'fatigued', 'exhausted', 'unconscious', 'dead', 'shaken', 'spell|dc', 'ability|dc', 'flat_footed', 'encumber_level', 'overburden_bulk', 'encumber_bulk', 'staggered', 'helpless', 'ref', 'eac', 'kac', 'fort', 'intelligence', 'will', 'confused']
            },
            "strength_base": {
                "repeating": false,
                "attr": "strength_base",
                "affects": ["strength_mod"]
            },
            "dexterity_base": {
                "repeating": false,
                "attr": "dexterity_base",
                "affects": ["dexterity_mod"]
            },
            "constitution_base": {
                "repeating": false,
                "attr": "constitution_base",
                "affects": ["constitution_mod"]
            },
            "intelligence_base": {
                "repeating": false,
                "attr": "intelligence_base",
                "affects": ["intelligence_mod"]
            },
            "wisdom_base": {
                "repeating": false,
                "attr": "wisdom_base",
                "affects": ["wisdom_mod"]
            },
            "charisma_base": {
                "repeating": false,
                "attr": "charisma_base",
                "affects": ["charisma_mod"]
            },
            "strength_mod": {
                "repeating": false,
                "attr": "strength_mod",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["strength_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "dexterity_mod": {
                "repeating": false,
                "attr": "dexterity_mod",
                "affects": ['eac', 'kac', 'initiative', 'ref'],
                "numAdds": 0,
                "attrAdds": ["dexterity_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "constitution_mod": {
                "repeating": false,
                "attr": "constitution_mod",
                "affects": ['fort'],
                "numAdds": 0,
                "attrAdds": ["constitution_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "intelligence_mod": {
                "repeating": false,
                "attr": "intelligence_mod",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["intelligence_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "wisdom_mod": {
                "repeating": false,
                "attr": "wisdom_mod",
                "affects": ['will'],
                "numAdds": 0,
                "attrAdds": ["wisdom_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "charisma_mod": {
                "repeating": false,
                "attr": "charisma_mod",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["charisma_base"],
                "multAdds": [1],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                moddable: '_change'
            },
            "hp_max": {
                "repeating": false,
                "attr": "hp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "addlBonus": [],
                "ability": '',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false
            },
            "rp_max": {
                "repeating": false,
                "attr": "rp_max",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "ability": '',
                "moddable": false
            },
            "eac_base": {
                "repeating": false,
                "attr": "eac_base",
                "affects": ["eac"],
                "numAdds": 0,
                "attrAdds": [],
                "addlBonus": ["armor"],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                rollTime: false
            },
            "kac_base": {
                "repeating": false,
                "attr": "kac_base",
                "affects": ["kac"],
                "numAdds": 0,
                "attrAdds": [],
                "addlBonus": [],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                rollTime: false
            },
            "cmd_base": {
                "repeating": false,
                "attr": "cmd_base",
                "affects": ["cmd"],
                "numAdds": 0,
                "attrAdds": [],
                "addlBonus": [],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                rollTime: false
            },
            "eac": {
                "repeating": false,
                "attr": "eac",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["eac_base"],
                "multAdds": [1],
                "ability": 'abi',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "kac": {
                "repeating": false,
                "attr": "kac",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["kac_base"],
                "multAdds": [1],
                "ability": 'abi',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "cmd": {
                "repeating": false,
                "attr": "cmd",
                rollTime: '_misc',
                "affects": [],
                "numAdds": 0,
                ability: 'abi',
                "attrAdds": ["cmd_base"],
                "multAdds": [1],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change"
            },
            "fort": {
                "repeating": false,
                "attr": "fort",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["fort_base"],
                "multAdds": [1],
                "ability": 'abi',
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "fort_base": {
                "repeating": false,
                "attr": "fort_base",
                "affects": ["fort"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "ref": {
                "repeating": false,
                "attr": "ref",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["ref_base"],
                "multAdds": [1],
                "ability": "abi",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "ref_base": {
                "repeating": false,
                "attr": "ref_base",
                "affects": ["ref"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "will": {
                "repeating": false,
                "attr": "will",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["will_base"],
                "multAdds": [1],
                "ability": "abi",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "will_base": {
                "repeating": false,
                "attr": "will_base",
                "affects": ["will"],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": false,
                "rollTime": false
            },
            "initiative": {
                "repeating": false,
                "attr": "initiative",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ['initiative_base'],
                multAdds: [1],
                "ability": "abi",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "initiative_base": {
                "repeating": false,
                "attr": "initiative_base",
                "affects": ['initiative'],
                "numAdds": 0,
                "attrAdds": [],
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "",
                "rollTime": ""
            },
            'profession|profession': {
                repeating: 'profession',
                attr: 'profession',
                affects: [],
                attrAdds: [],
                repeatAdds: ['base'],
                ability: 'ability',
                isSkill: true,
                numAdds: 0,
                moddable: 'change',
                rollTime: '_misc'
            },
            'profession|ranks': {
                repeating: 'profession',
                attr: 'ranks',
                affects: [],
                attrAdds: [],
                repeatAdds: ['base'],
                ability: 'ability'
            },
            'profession|base': {
                repeating: 'profession',
                attr: 'base',
                affects: ['profession|profession', 'profession|ranks']
            },
            'profession|ability': {
                repeating: 'profession',
                attr: 'ability',
                affects: ['profession|profession', 'profession|ranks']
            },
            "acrobatics": {
                "repeating": false,
                "attr": "acrobatics",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['acrobatics_base'],
                "multAdds": [1],
                "ability": "acrobatics_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "acrobatics_base": {
                attr: 'acrobatics_base',
                affects: ['acrobatics']
            },
            "acrobatics_ability": {
                "repeating": false,
                "attr": "acrobatics_ability",
                "affects": ["acrobatics"]
            },
            "athletics": {
                "repeating": false,
                "attr": "athletics",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['athletics_base'],
                "multAdds": [1],
                "ability": "athletics_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "athletics_base": {
                attr: 'athletics_base',
                affects: ['athletics']
            },
            "athletics_ability": {
                "repeating": false,
                "attr": "athletics_ability",
                "affects": ["athletics"]
            },
            "bluff": {
                "repeating": false,
                "attr": "bluff",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['bluff_base'],
                "multAdds": [1],
                "ability": "bluff_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "bluff_base": {
                attr: 'bluff_base',
                affects: ['bluff']
            },
            "bluff_ability": {
                "repeating": false,
                "attr": "bluff_ability",
                "affects": ["bluff"]
            },
            "computers": {
                "repeating": false,
                "attr": "computers",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['computers_base'],
                "multAdds": [1],
                "ability": "computers_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "computers_base": {
                attr: 'computers_base',
                affects: ['computers']
            },
            "computers_ability": {
                "repeating": false,
                "attr": "computers_ability",
                "affects": ["computers"]
            },
            "culture": {
                "repeating": false,
                "attr": "culture",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['culture_base'],
                "multAdds": [1],
                "ability": "culture_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "culture_base": {
                attr: 'culture_base',
                affects: ['culture']
            },
            "culture_ability": {
                "repeating": false,
                "attr": "culture_ability",
                "affects": ["culture"]
            },
            "diplomacy": {
                "repeating": false,
                "attr": "diplomacy",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['diplomacy_base'],
                "multAdds": [1],
                "ability": "diplomacy_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "diplomacy_base": {
                attr: 'diplomacy_base',
                affects: ['diplomacy']
            },
            "diplomacy_ability": {
                "repeating": false,
                "attr": "diplomacy_ability",
                "affects": ["diplomacy"]
            },
            "disguise": {
                "repeating": false,
                "attr": "disguise",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['disguise_base'],
                "multAdds": [1],
                "ability": "disguise_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "disguise_base": {
                attr: 'disguise_base',
                affects: ['disguise']
            },
            "disguise_ability": {
                "repeating": false,
                "attr": "disguise_ability",
                "affects": ["disguise"]
            },
            "engineering": {
                "repeating": false,
                "attr": "engineering",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['engineering_base'],
                "multAdds": [1],
                "ability": "engineering_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "engineering_base": {
                attr: 'engineering_base',
                affects: ['engineering']
            },
            "engineering_ability": {
                "repeating": false,
                "attr": "engineering_ability",
                "affects": ["engineering"]
            },
            "intimidate": {
                "repeating": false,
                "attr": "intimidate",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['intimidate_base'],
                "multAdds": [1],
                "ability": "intimidate_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "intimidate_base": {
                attr: 'intimidate_base',
                affects: ['intimidate']
            },
            "intimidate_ability": {
                "repeating": false,
                "attr": "intimidate_ability",
                "affects": ["intimidate"]
            },
            "life_science": {
                "repeating": false,
                "attr": "life_science",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['life_science_base'],
                "multAdds": [1],
                "ability": "life_science_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "life_science_base": {
                attr: 'life_science_base',
                affects: ['life_science']
            },
            "life_science_ability": {
                "repeating": false,
                "attr": "life_science_ability",
                "affects": ["life_science"]
            },
            "medicine": {
                "repeating": false,
                "attr": "medicine",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['medicine_base'],
                "multAdds": [1],
                "ability": "medicine_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "medicine_base": {
                attr: 'medicine_base',
                affects: ['medicine']
            },
            "medicine_ability": {
                "repeating": false,
                "attr": "medicine_ability",
                "affects": ["medicine"]
            },
            "mysticism": {
                "repeating": false,
                "attr": "mysticism",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['mysticism_base'],
                "multAdds": [1],
                "ability": "mysticism_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "mysticism_base": {
                attr: 'mysticism_base',
                affects: ['mysticism']
            },
            "mysticism_ability": {
                "repeating": false,
                "attr": "mysticism_ability",
                "affects": ["mysticism"]
            },
            "perception": {
                "repeating": false,
                "attr": "perception",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['perception_base'],
                "multAdds": [1],
                "ability": "perception_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "perception_base": {
                attr: 'perception_base',
                affects: ['perception']
            },
            "perception_ability": {
                "repeating": false,
                "attr": "perception_ability",
                "affects": ["perception"]
            },
            "physical_science": {
                "repeating": false,
                "attr": "physical_science",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['physical_science_base'],
                "multAdds": [1],
                "ability": "physical_science_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "physical_science_base": {
                attr: 'physical_science_base',
                affects: ['physical_science']
            },
            "physical_science_ability": {
                "repeating": false,
                "attr": "physical_science_ability",
                "affects": ["physical_science"]
            },
            "piloting": {
                "repeating": false,
                "attr": "piloting",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['piloting_base'],
                "multAdds": [1],
                "ability": "piloting_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "piloting_base": {
                attr: 'piloting_base',
                affects: ['piloting']
            },
            "piloting_ability": {
                "repeating": false,
                "attr": "piloting_ability",
                "affects": ["piloting"]
            },
            "sense_motive": {
                "repeating": false,
                "attr": "sense_motive",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['sense_motive_base'],
                "multAdds": [1],
                "ability": "sense_motive_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "sense_motive_base": {
                attr: 'sense_motive_base',
                affects: ['sense_motive']
            },
            "sense_motive_ability": {
                "repeating": false,
                "attr": "sense_motive_ability",
                "affects": ["sense_motive"]
            },
            "sleight_of_hand": {
                "repeating": false,
                "attr": "sleight_of_hand",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['sleight_of_hand_base'],
                "multAdds": [1],
                "ability": "sleight_of_hand_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "sleight_of_hand_base": {
                attr: 'sleight_of_hand_base',
                affects: ['sleight_of_hand']
            },
            "sleight_of_hand_ability": {
                "repeating": false,
                "attr": "sleight_of_hand_ability",
                "affects": ["sleight_of_hand"]
            },
            "stealth": {
                "repeating": false,
                "attr": "stealth",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['stealth_base'],
                "multAdds": [1],
                "ability": "stealth_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "stealth_base": {
                attr: 'stealth_base',
                affects: ['stealth']
            },
            "stealth_ability": {
                "repeating": false,
                "attr": "stealth_ability",
                "affects": ["stealth"]
            },
            "survival": {
                "repeating": false,
                "attr": "survival",
                "affects": [],
                "isSkill": true,
                "numAdds": 0,
                "attrAdds": ['survival_base'],
                "multAdds": [1],
                "ability": "survival_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "_misc"
            },
            "survival_base": {
                attr: 'survival_base',
                affects: ['survival']
            },
            "survival_ability": {
                "repeating": false,
                "attr": "survival_ability",
                "affects": ["survival"]
            },
            "attack|total": {
                "repeating": "attack",
                "attr": "total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "category": "category",
                "ability": "ability",
                "repeatTextAdds": [],
                "repeatAdds": ['base_attack_bonus_base'],
                "repeatParseField": ['bonus'],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "attack|base_attack_bonus": {
                "repeating": "attack",
                "attr": "base_attack_bonus",
                "affects": ['attack|total'],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [1],
                "category": "category",
                "ability": "ability",
                "repeatTextAdds": [],
                "repeatAdds": ['base_attack_bonus_base'],
                "textAdds": []
            },
            "attack|base_attack_bonus_base": {
                "repeating": "attack",
                "attr": "base_attack_bonus_base",
                "affects": ['attack|base_attack_bonus'],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [1],
                "category": "category",
                "ability": "",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "attack|ability": {
                "repeating": 'attack',
                "attr": "ability",
                "affects": ["attack|total", "attack|base_attack_bonus"]
            },
            'attack|damage_dice': {
                repeating: 'attack',
                attr: 'damage_dice',
                affects: ['attack|damage_total']
            },
            'attack|proficiency': {
                "repeating": 'attack',
                "attr": "proficiency",
                "affects": ["attack|total", 'attack|damage_total']
            },
            'attack|category': {
                "repeating": 'attack',
                "attr": "category",
                "affects": ["attack|total", 'attack|damage_total']
            },
            'attack|bonus': {
                "repeating": 'attack',
                "attr": "bonus",
                "affects": ["attack|total"]
            },
            "attack|damage_total": {
                "repeating": "attack",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice"],
                "category": "category",
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "attack|damage_ability": {
                "repeating": 'attack',
                "attr": "damage_ability",
                "affects": ["attack|damage_total"]
            },
            "ability|uses_max": {
                "repeating": "ability",
                "attr": "uses_max",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [],
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "repeatParseField": ["uses_max_base"],
                "moddable": "_change"
            },
            'ability|uses_max_base': {
                repeating: 'ability',
                attr: 'uses_max_base',
                affects: ['ability|uses_max']
            },
            "ability|base_attack_bonus": {
                "repeating": "ability",
                "attr": "base_attack_bonus",
                "affects": ['ability|attack_total'],
                "numAdds": 0,
                "attrAdds": [""],
                "multAdds": [1],
                "category": "category",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "ability|attack_total": {
                "repeating": "ability",
                "attr": "attack_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["base_attack_bonus"],
                "multAdds": [1],
                "ability": "ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": true,
                "rollTime": "misc"
            },
            "ability|attack_ability": {
                "repeating": 'ability',
                "attr": "attack_ability",
                "affects": ["ability|attack_total", 'ability|base_attack_bonus']
            },
            'ability|damage_dice': {
                repeating: 'attack',
                attr: 'damage_dice',
                affects: ['ability|damage_total']
            },
            "ability|damage_total": {
                "repeating": "ability",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice"],
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": true,
                "rollTime": "misc"
            },
            "ability|damage_ability": {
                "repeating": 'ability',
                "attr": "damage_ability",
                "affects": ["ability|damage_total"]
            },
            "ability|dc": {
                "repeating": "ability",
                "attr": "dc",
                "affects": [],
                "attrAdds": [],
                "multAdds": [],
                repeatAdds: ['dc_base'],
                "numAdds": 0,
                "ability": "save_ability",
                "moddable": "_change"
            },
            "ability|dc_base": {
                "repeating": "ability",
                "attr": "dc_base",
                "affects": ['ability|dc'],
                "attrAdds": [],
                "multAdds": [],
                "numAdds": 0,
                "ability": "",
                "moddable": false
            },
            "ability|save_ability": {
                "repeating": 'ability',
                "attr": "save_ability",
                "affects": ["ability|dc"]
            },
            "spell|level": {
                "repeating": "spell",
                "attr": "level",
                "affects": ["spell|filter"]
            },
            "spell|base_attack_bonus": {
                "repeating": "spell",
                "attr": "base_attack_bonus",
                "affects": ['spell|attack_total'],
                "numAdds": 0,
                "attrAdds": [""],
                "multAdds": [1],
                "category": "category",
                "ability": "attack_ability",
                "repeatTextAdds": [],
                "repeatAdds": ['base_attack_bonus_base'],
                "textAdds": []
            },
            "spell|base_attack_bonus_base": {
                "repeating": "spell",
                "attr": "base_attack_bonus_base",
                "affects": ['spell|base_attack_bonus'],
                "numAdds": 0,
                "attrAdds": [],
                "multAdds": [1],
                "category": "category",
                "ability": "attack_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": []
            },
            "spell|filter": {
                "repeating": "spell",
                "attr": "filter",
                "affects": []
            },
            "spell|attack_total": {
                "repeating": "spell",
                "attr": "attack_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": ["bab"],
                "multAdds": [1],
                "ability": "attack_ability",
                "repeatTextAdds": [],
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "spell|attack_ability": {
                "repeating": 'spell',
                "attr": "attack_ability",
                "affects": ["spell|attack_total", 'spell|base_attack_bonus']
            },
            "spell|damage_total": {
                "repeating": "spell",
                "attr": "damage_total",
                "affects": [],
                "numAdds": 0,
                "attrAdds": [],
                "repeatTextAdds": ["damage_dice", "damage_bonus"],
                "category": "category",
                "ability": "damage_ability",
                "repeatAdds": [],
                "textAdds": [],
                "moddable": "_change",
                "rollTime": "misc"
            },
            "spell|damage_ability": {
                "repeating": 'spell',
                "attr": "damage_ability",
                "affects": ["spell|damage_total"]
            },
            'spell|damage_dice': {
                repeating: 'spell',
                attr: 'damage_dice',
                affects: ['spell|damage_total']
            },
            "spell|dc": {
                "repeating": "spell",
                "attr": "dc",
                "affects": [],
                "attrAdds": [],
                "repeatAdds": ['dc_base'],
                "numAdds": 0,
                "ability": "save_ability",
                "moddable": "_change"
            },
            "spell|dc_base": {
                "repeating": "spell",
                "attr": "dc_base",
                "affects": ['spell|dc'],
                "attrAdds": [],
                "multAdds": [],
                "numAdds": 0,
                "ability": "",
                "moddable": false
            },
            "spell|save_ability": {
                "repeating": 'spell',
                "attr": "save_ability",
                "affects": ["spell|dc"]
            },
        },

        //esRE and HE are used to html escape characters for use in some of the menus that are made. Full credit to Aaron for these functions    
        esRE = function(s) {
            var escapeForRegexp = /(\\|\/|\[|\]|\(|\)|\{|\}|\?|\+|\*|\||\.|\^|\$)/g;
            return s.replace(escapeForRegexp, "\\$1");
        },
        
        reverseHE = (function() {
            var entities = {
                    ['&' + '#42' + ';']:'*',
                    ['&' + 'amp' + ';']:'&',
                    ['&' + 'lt' + ';']:'<',
                    ['&' + 'gt' + ';']:'>',
                    ['&' + '#39' + ';']:"'",
                    ['&' + '#64' + ';']:'@',
                    ['&' + '#123' + ';']:'{',
                    ['&' + '#124' + ';']:'|',
                    ['&' + '#125' + ';']:'}',
                    ['&' + '#44' + ';']:',',
                    ['&' + '#91' + ';']:'[',
                    ['&' + '#93' + ';']:']',
                    ['&' + 'quot' + ';']:'"',
                    ['&' + '#58' + ';']:':',
                    ['&' + '#40' + ';']:'(',
                    ['&' + '#41' + ';']:')'
                },
                re = new RegExp('(' + _.map(_.keys(entities), esRE).join('|') + ')', 'g');
            return function(s) {
                return s.replace(re, function(c) {
                    return entities[c] || c;
                });
            };
        }()),

        HE = (function() {
            var entities = {
                    /*'' :'&'+'nbsp'+';',*/
                    '*': '&' + '#42' + ';',
                    '&': '&' + 'amp' + ';',
                    '<': '&' + 'lt' + ';',
                    '>': '&' + 'gt' + ';',
                    "'": '&' + '#39' + ';',
                    '@': '&' + '#64' + ';',
                    '{': '&' + '#123' + ';',
                    '|': '&' + '#124' + ';',
                    '}': '&' + '#125' + ';',
                    ',': '&' + '#44' + ';',
                    '[': '&' + '#91' + ';',
                    ']': '&' + '#93' + ';',
                    '"': '&' + 'quot' + ';',
                    ':': '&' + '#58' + ';',
                    '(': '&' + '#40' + ';',
                    ')': '&' + '#41' + ';'
                        /*'-' :'&'+'mdash'+';'*/
                },
                re = new RegExp('(' + _.map(_.keys(entities), esRE).join('|') + ')', 'g');
            return function(s) {
                return s.replace(re, function(c) {
                    return entities[c] || c;
                });
            };
        }()),

        //Registers the on() handlers
        RegisterEventHandlers = function() {
            //Compendium drop handlers
            on('change:drop_category', dropHandler);
            //user changes
            on('sheet:opened', updateSheet); //when the sheet is first opened, do any fixes necessary, and update the sheet version attribute
            on('change:tab_select change:resolve_source change:stackable_buffs change:sheet_type ' +
                'change:class_1_name change:class_2_name change:class_3_name change:class_4_name change:class_5_name ' +
                'change:class_1_level change:class_2_level change:class_3_level change:class_4_level change:class_5_level ' +
                'change:class_1_sp change:class_2_sp change:class_3_sp change:class_4_sp change:class_5_sp ' +
                'change:class_1_hp change:class_2_hp change:class_3_hp change:class_4_hp change:class_5_hp ' +
                'change:class_1_bab change:class_2_bab change:class_3_bab change:class_4_bab change:class_5_bab ' +
                'change:class_1_fort change:class_2_fort change:class_3_fort change:class_4_fort change:class_5_fort ' +
                'change:class_1_ref change:class_2_ref change:class_3_ref change:class_4_ref change:class_5_ref ' +
                'change:class_1_will change:class_2_will change:class_3_will change:class_4_will change:class_5_will ' +
                'change:class_1_skills change:class_2_skills change:class_3_skills change:class_4_skills change:class_5_skills ' +
                'change:class_1_ability change:class_2_ability change:class_3_ability change:class_4_ability change:class_5_ability ' +
                'change:class_1_spells change:class_2_spells change:class_3_spells change:class_4_spells change:class_5_spells ' +
                'change:class_1_spell_progression change:class_2_spell_progression change:class_3_spell_progression change:class_4_spell_progression change:class_5_spell_progression ' +
                'change:class_1_casting_ability change:class_2_casting_ability change:class_3_casting_ability change:class_4_casting_ability change:class_5_casting_ability ' +
                'change:race_hp change:strength_base change:strength_enhance change:strength_penalty change:strength_drain ' +
                'change:dexterity_base change:dexterity_enhance change:dexterity_penalty change:dexterity_drain change:constitution_base ' +
                'change:constitution_enhance change:constitution_penalty change:constitution change:intelligence_base change:intelligence_enhance ' +
                'change:intelligence_penalty change:intelligence_drain change:wisdom_base change:wisdom_enhance change:wisdom_penalty change:wisdom_drain ' +
                'change:charisma_base change:charisma_enhance change:charisma_penalty change:charisma_drain change:eac_ability change:kac_ability ' +
                'change:dexterity_mod change:strength_mod change:constitution_mod change:intelligence_mod change:wisdom_mod change:charisma_mod ' +
                'change:fort_ability change:fort change:ref_ability change:ref change:will_ability change:will change:initiative_ability change:initiative_base change:initiative change:sp change:hp change:rp change:temp_hp ' +
                'change:acrobatics change:athletics change:bluff change:computers change:culture change:diplomacy change:disguise change:engineering change:intimidate change:life_science change:medicine change:mysticism change:profession change:perception change:physical_science change:piloting change:sense_motive change:sleight_of_hand change:stealth change:survival ' +
                'change:acrobatics_ranks change:acrobatics_class_skill change:acrobatics_ability change:acrobatics_acp ' +
                'change:athletics_ranks change:athletics_class_skill change:athletics_ability change:athletics_acp ' +
                'change:bluff_ranks change:bluff_class_skill change:bluff_ability change:bluff_acp ' +
                'change:computers_ranks change:computers_class_skill change:computers_ability change:computers_acp ' +
                'change:culture_ranks change:culture_class_skill change:culture_ability change:culture_acp ' +
                'change:diplomacy_ranks change:diplomacy_class_skill change:diplomacy_ability change:diplomacy_acp ' +
                'change:disguise_ranks change:disguise_class_skill change:disguise_ability change:disguise_acp ' +
                'change:engineering_ranks change:engineering_class_skill change:engineering_ability  change:engineering_acp ' +
                'change:intimidate_ranks change:intimidate_class_skill change:intimidate_ability  change:intimidate_acp ' +
                'change:life_science_ranks change:life_science_class_skill change:life_science_ability  change:life_science_acp ' +
                'change:medicine_ranks change:medicine_class_skill change:medicine_ability  change:medicine_acp ' +
                'change:mysticism_ranks change:mysticism_class_skill change:mysticism_ability change:mysticism_acp ' +
                'change:perception_ranks change:perception_class_skill change:perception_ability change:perception_acp ' +
                'change:physical_science_ranks change:physical_science_class_skill change:physical_science_ability change:physical_science_acp ' +
                'change:piloting_ranks change:piloting_class_skill change:piloting_ability change:_acp ' +
                'change:sense_motive_ranks change:sense_motive_class_skill change:sense_motive_ability change:sense_motive_acp ' +
                'change:sleight_of_hand_ranks change:sleight_of_hand_class_skill change:sleight_of_hand_ability change:sleight_of_hand_acp ' +
                'change:stealth_ranks change:stealth_class_skill change:stealth_ability change:stealth_acp ' +
                'change:survival_ranks change:survival_class_skill change:survival_ability change:survival_acp ' +
                'change:eac_base change:kac_base change:cmd_base change:fort_base change:ref_base change:will_base ' +
                'change:repeating_item change:repeating_attack change:repeating_profession change:repeating_buff change:repeating_ability change:repeating_spell ' +
                'change:create_cantrip change:create_1st change:create_2nd change:create_3rd change:create_4th change:create_5th change:create_6th change:create_7th change:create_8th change:create_9th ' +
                'change:create_npcmelee change:create_npcranged change:create_npcmultiattack change:stackable_buffs change:half_specializations change:drone change:create_spell_like ' +
                'remove:repeating_item remove:repeating_buff remove:repeating_ability ' +
                'change:light_armor_proficiency change:heavy_armor_proficiency change:power_armor_proficiency change:basic_melee_proficiency change:advanced_melee_proficiency ' +
                'change:small_arm_proficiency change:longarm_proficiency change:heavy_weapon_proficiency change:grenade_proficiency change:sniper_proficiency ' +
                'change:acrobatics_base change:athletics_base change:bluff_base change:computers_base change:culture_base change:diplomacy_base change:disguise_base change:engineering_base change:intimidate_base change:life_science_base change:medicine_base change:mysticism_base ' +
                'change:perception_base change:physical_science_base change:piloting_base change:sense_motive_base change:sleight_of_hand_base change:stealth_base change:survival_base '+
                /*starship events*/
                
                'change:create_forward change:create_port change:create_aft change:create_starboard change:create_turret ' +
                'change:create_system change:create_expansion '+
                //conditions
                //disease and poison tracks
                
                'change:repeating_condition '+
                //tactical conditions
                
                'change:asleep change:blinded change:cowering change:dazzled change:deafened change:encumbered change:entangled change:exhausted change:fascinated ' +
                'change:fatigued change:flat_footed change:frightened change:grappled change:helpless change:negative_levels change:off_kilter change:off_target ' +
                'change:overburdened change:panicked change:paralyzed change:pinned change:prone change:shaken change:sickened change:stunned change:unconscious ' +
                'change:gunner change:captain change:engineer change:pilot change:science_officer change:speed change:maneuverability',
                accessStarfinder);
            /*ship specific listener*/
            on('change:ship_piloting_ranks change:repeating_system:shields change:repeating_system:sensor_bonus change:repeating_system:armor change:repeating_system:countermeasure change:repeating_system:purpose change:repeating_system:pcu change:repeating_system:bp change:repeating_system:powered change:repeating_system:comp_bonus change:repeating_attack:pcu change:repeating_attack:bp change:repeating_attack:powered change:ship_computer change:size', () => {
                getID(JSON.parse(JSON.stringify(repeatingShipAttributes)), shipSystemHandler);
            });
            on('change:update_pilot_ranks', updatePilot);
            //shield change listener
            on('change:forward_shields change:port_shields change:aft_shields change:starboard_shields', shieldHandler);
            //patch listener
            on('change:life_support_patch change:sensors_patch change:engines_patch change:power_core_patch', patchHandler);

            on('clicked:submit', addSpells);
            on('clicked:cancel', cancelSpellDrop);
            on('clicked:repeating_item:mod clicked:repeating_buff:mod clicked:repeating_ability:mod', modWizard);
            on('change:mod_template',templateMod);
            on('clicked:cancel_mods',closeModWizard);
            on('clicked:submit_mods',processModWizard);
            mancerListeners();
        },
        //updates the sheet when it is first opened
        updateSheet = function() {
            var setObj = {
                    character_sheet: 'Starfinder v' + version
                },
                attributes = [];
            TAS.log('Updating Sheet');
            getID(JSON.parse(JSON.stringify(repeatingAttributes)), (sectionAggregate) => {
                TAS.log('Repeating Sections Loaded');
                _.each(sectionAggregate, (section) => {
                    _.each(section.id, (sid) => {
                        _.each(section.fields, (f) => {
                            attributes.push('repeating_' + section.section + '_' + sid + '_' + f);
                            if (f === 'name' && section.section === 'attack') {
                                attributes.push('repeating_' + section.section + '_' + sid + '_bab');
                            }
                        });
                    });
                });
                TAS.log('Repeating Section Attribute Names Assembled');
                attributes = attributes.concat(sheetAttributes).concat(['character_sheet', 'class&level']);
                getAttrs(attributes, (updateAttrs) => {
                    TAS.log('Sheet Attributes Acquired');
                    _.each(['strength_mod', 'dexterity_mod', 'constitution_mod', 'intelligence_mod', 'wisdom_mod', 'charisma_mod'], (mod) => {
                        if (!updateAttrs[mod]) {
                            setObj[mod] = 0;
                            updateAttrs[mod] = 0;
                        }
                    });
                    if (updateAttrs.character_sheet) {
                        let upgradeFrom = updateAttrs.character_sheet.replace(/Starfinder v/, ''),
                            lastDate;
                        TAS.log('Base Attack Bonuses Updated');
                        TAS.log(`upgradeFrom: ${upgradeFrom}`);
                        if (upgradeFrom * 1 < version) {
                            upgradeFrom.replace(/(\d+\.\d{3})(\d+)/, (match, version, build) => {
                                upgradeFrom = version * 1;
                                lastDate = build * 1;
                            });
                            TAS.log(`upgradeFrom: ${upgradeFrom}`);
                            TAS.log(`lastDate: ${lastDate}`);
                            if (upgradeFrom < 0.07) {
                                if (updateAttrs.whisper_state === '/w gm') {
                                    setObj.whisper_state = '/w gm ';
                                }
                                let repeatBabs = _.filter(_.keys(updateAttrs), (k) => {
                                    return k.match(/repeating_[^_]+_[^_]+_bab/);
                                });
                                _.each(repeatBabs, (r) => {
                                    if (updateAttrs[r] !== 'replaced') {
                                        setObj[r] = 'replaced';
                                        setObj[r.replace(/bab/, 'base_attack_bonus')] = updateAttrs[r];
                                    }
                                });
                                [updateAttrs, setObj] = updateToOfficial(updateAttrs, setObj);
                            }
                            if (upgradeFrom <= 0.08) {
                                TAS.log('update to new build');
                                if (lastDate < 1532287051) {
                                    updateToZeroEightJuly22(updateAttrs, setObj);
                                }
                                if (lastDate < 1532723850 && updateAttrs.sheet_type === 'npc') {
                                    updateToZeroEightJuly27(updateAttrs, setObj);
                                }
                            }
                            if (upgradeFrom <= 1.00) {
                                if (lastDate < 1539694800 && updateAttrs.sheet_type === 'npc') {
                                    TAS.log('upgrading to 1539694800');
                                    updateto1539694800(updateAttrs, setObj);
                                }
                                if (lastDate < 1540904400) {
                                    TAS.log('upgrading to 1540886400');
                                    updateto1540886400(updateAttrs, setObj);
                                }
                                if (lastDate < 1554814800) {
                                    TAS.log('upgrading to 1554814800');
                                    updateto1554814800(updateAttrs, setObj);
                                }
                                if (lastDate < 1556629200) {
                                    TAS.log('upgrading to 1556629200');
                                    updateto1556629200(updateAttrs, setObj);
                                }
                            }
                        }
                    }
                    setObj = buildMenus(updateAttrs, setObj);
                    storeInfo(updateAttrs);
                    TAS.log(`presetAttrs setObj:`);
                    TAS.log(setObj);
                    setAttrs(setObj, {silent: true},()=>{
                        const secondSetObj = {};
                        if(updateAttrs.sheet_type==='pc'){
                            TAS.log(`updating default PC ability scores`);
                            _.each(['strength','dexterity','constitution','intelligence','wisdom','charisma'],(abi)=>{
                                if(abi===undefined){
                                    secondSetObj[abi]=10;
                                }
                            });
                            setAttrs(secondSetObj);
                        }
                    });
                });
            });
        },
        
        updateto1556629200 = function(attributes,setObj){
            if(attributes.sheet_type ==='npc'){
                let repeatAbilities = _.filter(_.keys(attributes),(key)=>{
                    return /repeating_.+?_.+?_.*?ability/.test(key);
                });
                _.each(repeatAbilities,(key)=>{
                    TAS.log(`attributes[${key}]:${attributes[key]}`);
                    if(/base\]/.test(attributes[key])){
                        setObj[key]=attributes[key].replace(/base\]/g,'base}]');
                    }
                });
            }
            let weaponBonusFields = _.filter(_.keys(attributes),(key)=>{
                return /repeating_attack_[^_]+_bonus/.test(key);
            });
            _.each(weaponBonusFields,(bonus)=>{
                let calculated = calcBuffs(attributes, {untyped: [attributes[bonus]]}, setObj).total;
                setObj[bonus.replace(/bonus/,'total')] = (setObj[bonus.replace(/bonus/,'total')]*1||0) + (calculated*1||0);
                if(setObj[bonus.replace(/bonus/,'total')]*1 >= 0){
                    setObj[bonus.replace(/bonus/,'total')] = `+${setObj[bonus.replace(/bonus/,'total')]}`;
                }
            });
            setObj.stackable_buffs = attributes.stackable_buffs.replace(/,Luck/,'');
        },
        
        updateto1554814800 = function(attributes,setObj){
            if(attributes.sheet_type ==='npc'){
                const abiSwap = {
                    strength_mod:'[[@{strength_mod}-@{strength_base}]]',
                    dexterity_mod:'[[@{dexterity_mod}-@{dexterity_base}]]',
                    constitution_mod:'[[@{constitution_mod}-@{constitution_base}]]',
                    intelligence_mod:'[[@{intelligence_mod}-@{intelligence_base}]]',
                    wisdom_mod:'[[@{wisdom_mod}-@{wisdom_base}]]',
                    charisma_mod :'[[@{charisma_mod}-@{charisma_base}]]'
                };
                let repeatAbilities = _.filter(_.keys(attributes),(key)=>{
                    return /repeating_.+?_.+?_.*?ability/.test(key);
                });
                TAS.log(`repeatAbilities:`);
                TAS.log(repeatAbilities);
                _.each(repeatAbilities,(key)=>{
                    TAS.log(`attributes[${key}]:${attributes[key]}`);
                    if(!/\[\[/.test(attributes[key]) && attributes[key]*1!==0){
                        setObj[key]=abiSwap[attributes[key].replace(/@{|}/g,'')];
                    }
                });
            }
        },

        updateto1540886400 = function(attributes, setObj) {
            const typeConvert = {
                FORT: 'fort-save',
                REF: 'ref-save',
                WILL: 'will-save'
            }
            let saveTypes = _.filter(_.keys(attributes), (key) => {
                return /save_type/.test(key)
            });
            TAS.log(`saveTypes:`);
            TAS.log(saveTypes);
            _.each(saveTypes, (type) => {
                TAS.log(`attributes[${type}]: ${attributes[type]}`);
                setObj[type] = typeConvert[attributes[type]] || '';
            });
        },

        updateto1539694800 = function(attributes, setObj) {
            let damageAbilities = _.filter(_.keys(attributes), (key) => {
                return /damage_ability/.test(key)
            });

            _.each(damageAbilities, (ability) => {
                setObj[ability] = attributes[ability].replace(/^(@{([^}]+?)_mod})$/, '[[$1-@{$2_base}]]');
            });
        },

        updateToOfficial = function(attributes, setObj) {
            TAS.log('updating to Roll20 Official Sheet');
            let attributeKeys = _.keys(attributes),
                attackCategories = _.filter(attributeKeys, (k) => {
                    return /repeating_attack_[^_]+_category/.test(k)
                }),
                abilityFrequencies = _.filter(attributeKeys, (k) => {
                    return /repeating_ability_[^_]+_frequencies/.test(k)
                }),
                spellLevels = _.filter(attributeKeys, (k) => {
                    return /repeating_spell_[^_]+_level/.test(k)
                }),
                toggles = _.filter(attributeKeys, (k) => {
                    return /_toggle/.test(k)
                }),
                modFields = _.filter(attributeKeys, (k) => {
                    return /_mods/.test(k)
                });

            if (attributes.sheet_type === 'npc') {
                _.each(['strength_mod', 'dexterity_mod', 'constitution_mod', 'intelligence_mod', 'wisdom_mod', 'charisma_mod', 'eac', 'kac', 'cmd', 'initiative'], (attr) => {
                    setObj[attr.replace(/_mod$/, '') + '_base'] = attributes[attr] * 1 || 0;
                    attributes[attr.replace(/_mod$/, '') + '_base'] = attributes[attr] * 1 || 0;
                });
                TAS.log('ability mods, ac, and initiative updated');
                _.each(['acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival'], (skill) => {
                    setObj[skill + '_base'] = attributes[skill] * 1 || 0;
                    setObj[skill + '_ranks'] = (attributes[skill] * 1 || 0) > 0 ? (attributes[skill] * 1 || 0) - (attributes[attributes[skill + '_ability'].replace(/@{|}/g, '').replace(/mod$/, 'base')] * 1 || 0) : 0;
                });
                TAS.log('skills updated');
                _.each(attackCategories, (category) => {
                    const rowID = category.replace(/category$/, '');
                    setObj[rowID + 'base_attack_bonus_base'] = attributes[rowID + 'base_attack_bonus'] * 1 || 0;
                    setObj[rowID + 'base_attack_bonus'] = (attributes[rowID + 'base_attack_bonus'] * 1 || 0) - (attributes[attributes[rowID + 'ability'].replace(/@{|}/g, '').replace(/mod$/, 'base')] * 1 || 0);
                    TAS.log(`setObj[${rowID}base_attack_bonus_base]: ${setObj[rowID+'base_attack_bonus_base']} | setObj[${rowID}base_attack_bonus]: ${setObj[rowID+'base_attack_bonus']}`);
                });
                TAS.log('attacks updated');
                _.each(abilityFrequencies.concat(spellLevels), (level) => {
                    const rowID = level.replace(/(?:level|frequency)$/, '');
                    setObj[rowID + 'base_attack_bonus_base'] = attributes[rowID + 'base_attack_bonus'] * 1 || 0;
                    setObj[rowID + 'base_attack_bonus'] = (attributes[rowID + 'base_attack_bonus'] * 1 || 0) - (attributes[attributes[rowID + 'attack_ability'].replace(/@{|}/g, '').replace(/mod$/, 'base')] * 1 || 0);
                    setObj[rowID + 'dc_base'] = attributes[rowID + 'dc'] * 1 || 0;
                    if (/repeating_ability_/.test(rowID)) {
                        setObj[rowID + 'frequency'] = attributes[rowID + 'frequency'].replace(/\s+/, '-');
                    }
                });
                TAS.log('spells and special abilities updated');
            }
            _.each(attackCategories, (category) => {
                switch (true) {
                    case /operative/i.test(attributes[category]):
                        setObj[category] = 'basic_melee';
                        setObj[category.replace(/category/, 'special')] = [setObj[category.replace(/category/, 'special')], 'Operative'].join(', ');
                        break;
                    case /basic/i.test(attributes[category]):
                        setObj[category] = 'basic_melee';
                        break;
                    case /advance/i.test(attributes[category]):
                        setObj[category] = 'advanced_melee';
                        break;
                    case /small/i.test(attributes[category]):
                        setObj[category] = 'small_arm';
                        break;
                    case /long/i.test(attributes[category]):
                        setObj[category] = 'longarm';
                        break;
                    case /sniper/i.test(attributes[category]):
                        setObj[category] = 'sniper';
                        break;
                    case /heavy/i.test(attributes[category]):
                        setObj[category] = 'heavy';
                        break;
                    case /grenade/i.test(attributes[category]):
                        setObj[category] = 'grenade';
                        break;
                    default:
                        setObj[category] = 'special';
                        break;
                }
                attributes[category] = setObj[category];
            });
            _.each(abilityFrequencies, (frequency) => {
                const freqSwitch = {
                    "at will": "at-will",
                    "daily limit": "daily-limit",
                    "constant": "constant"
                }
                setObj[frequency] = freqSwitch[attributes[frequency]];
                attributes[frequency] = setObj[frequency];
            });
            _.each(spellLevels, (filter) => {
                let rowID = filter.replace(/(repeating_spell_[^_]+)_level/, '$1');
                setObj[rowID + '_filter'] = attributes[filter] * 1 || 'cantrip';
            });
            _.each(toggles, (toggle) => {
                if (attributes[toggle] === 'enabled') {
                    setObj[toggle] = 1;
                    attributes[toggle] = 1;
                }
            });
            _.each(modFields, (mods) => {
                setObj[mods] = attributes[mods].replace(/(\|.*category:.+) weapons?/g, '$1');
            });
            setObj.char_max_spell = '';
            _.each(_.range(attributes.char_max_spell * 1 || 0) + 1, (r) => {
                setObj.char_max_spell += ' ' + r;
            });
            attributes['class&level'].replace(/(.+?) (\d+)/g, (match, p1, p2) => {
                const profLevel = p2 * 1 >= 3 ? 'specialized' : 'yes',
                    profs = {
                        soldier: {
                            armor: ['heavy_armor'],
                            weapons: ['basic_melee', 'small_arm', 'advanced_melee', 'heavy_weapon', 'sniper', 'grenade', 'longarm']
                        },
                        solarian: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm', 'advanced_melee']
                        },
                        envoy: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm', 'grenade']
                        },
                        mechanic: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm', 'grenade']
                        },
                        mystic: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm']
                        },
                        technomancer: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm']
                        },
                        operative: {
                            armor: [],
                            weapons: ['basic_melee', 'small_arm', 'sniper']
                        },
                    }
                if (!/soldier|solari[ao]n|envoy|mystic|operative|mechanic|technomancer/i.test(p1)) {
                    p1 = 'mystic';
                }
                _.each(profs[p1.trim().toLowerCase()].weapons, (prof) => {
                    setObj[prof + '_proficiency'] = profLevel;
                });
                _.each(profs[p1.trim().toLowerCase()].armor, (prof) => {
                    setObj[prof + '_proficiency'] = 'yes';
                });
            });
            TAS.log('Starfinder HUD upgraded to Starfinder (Official)');
            return [attributes, setObj];
        },

        updateToZeroEightJuly22 = function(attributes, setObj) {
            attributes.half_specializations = attributes.half_specializations.replace(/small\s+arms,\s*small\s+arm/i, 'small_arm');
            setObj.half_specializations = attributes.half_specializations;
        },

        updateToZeroEightJuly27 = function(attributes, setObj) {
            attributes.character_level = attributes.cr;
            setObj.character_level = attributes.cr;
        },

        storeInfo = function(attributes) {
            pilotingRanks[attributes.character_name.replace(/\s+/, '_').toLowerCase()] = attributes.piloting_ranks;
        },
        //gets the repeating item IDs to assemble an array of repeating attributes to be used in getAttrs() calls
        /*arguments:
            cloneRepAttr: a cloned version of the repeatingAttributes or repeatingShipAttributes variable
            callback: the function to execute and pass sectionAggregate to
            sectionAggregate: Array of objects containing the information on each repeating item
        */
        getID = function(cloneRepAttr, callback, sectionAggregate) {
            var currSection = cloneRepAttr.shift();
            sectionAggregate = sectionAggregate || [];
            getSectionIDs(`repeating_${currSection.section}`, (itemIDArr) => {
                sectionAggregate.push({
                    section: currSection.section,
                    id: itemIDArr,
                    fields: currSection.fields
                });
                if (_.isEmpty(cloneRepAttr)) {
                    callback(sectionAggregate);
                } else {
                    getID(cloneRepAttr, callback, sectionAggregate);
                }
            });
        },

        //Function that acts as a traffic switch to determine how to react to many of the attribute changes.
        //This function needs some serious clean up which was on my to do list for the next version release once I had the release bugs handled.
        accessStarfinder = function(event) {
            if(!event.previousValue && !event.newValue && (!/remove/.test(event.triggerName) && event.sourceType!=='worker')){
                return;
            }
            TAS.log(`accessStarfinder for:`);
            TAS.log(event);
            var attribute = event.sourceAttribute,
                repeatSec = event.sourceAttribute.match(/repeating_([^_]+)/) ? event.sourceAttribute.match(/repeating_([^_]+)/)[1] : false,
                cloneRepAttr = JSON.parse(JSON.stringify(repeatingAttributes)),
                currSection, trigger,
                attributes = [],
                bonuses,
                setObj = {},
                useID = (sectionAggregate) => {
                    _.each(sectionAggregate, (section) => {
                        _.each(section.id, (sid) => {
                            _.each(section.fields, (f) => {
                                attributes.push('repeating_' + section.section + '_' + sid + '_' + f);
                            });
                        });
                    });
                    attributes = attributes.concat(sheetAttributes);
                    getAttrs(attributes, (objs) => {
                        /*if(attribute==='character_name' && objs.sheet_type==='ship'){
                            _.each(['captain','pilot','engineer','science_officer'],(crew)=>{
                                shipCrewHandler(event,crew);
                            });
                        }else */
                        if (attribute.match(/^(?:rp|hp|sp|temp_hp)$/)) {
                            healthHandler(objs, event);
                        } else if (attribute === 'sheet_type') {
                            if (event.newValue === 'npc') {
                                setObj.whisper_state = '/w gm ';
                            } else {
                                setObj.whisper_state = '';
                            }
                            setAttrs(setObj, {
                                silent: true
                            });
                        } else {
                            if (attribute.match(/frequency/)) {
                                setObj[event.sourceAttribute.replace(/frequency/, 'toggle_freq_dependency')] = objs[event.sourceAttribute];
                                setObj[event.sourceAttribute.replace(/frequency/, 'usage_freq_dependency')] = objs[event.sourceAttribute];
                                setObj[event.sourceAttribute.replace(/frequency/, 'uses_freq_dependency')] = objs[event.sourceAttribute];
                            } else if (attribute === 'drone') {
                                setObj = classLevelHandler(objs);
                            } else if (/_item_[^_]+_type|_attack_[^_]+_category|(?:armor|melee|longarm|arm|weapon|grenade|sniper)_proficiency/.test(attribute)) {
                                setObj = setProficiency(attribute, objs);
                            } else if (/asleep|blinded|cowering|dazzled|deafened|encumbered|entangled|exhausted|fascinated|fatigued|flat_footed|frightened|grappled|helpless|negative_levels|off_kilter|off_target|overburdened|panicked|paralyzed|pinned|prone|shaken|sickened|unconscious|stunned|_condition_/.test(attribute)) {
                                setObj = expandConditions(attribute, objs, setObj, event);
                            } else {
                                setObj = attribute.match(/class_\d/) ? classHandler(objs, attribute) : attribute.match(/repeating_ability|repeating_spell/) ? abilityHandler(objs, attribute) : {};
                            }
                            if (setObj) {
                                if (/_source/.test(event.sourceAttribute)) {
                                    event.sourceAttribute = event.sourceAttribute.replace(/source/, 'save_ability');
                                    attribute = event.sourceAttribute;
                                }
                                _.each(_.keys(setObj), (key) => {
                                    objs[key] = _.clone(setObj[key]);
                                });
                                bonuses = parseBuffs(objs);
                                bonuses = assignConditions(objs, bonuses);
                                trigger = assembleTrigger(attribute, objs, event);
                                if (!/remove/.test(event.triggerName)) {
                                    attribute.replace(/repeating_(?:attack|spell|ability|item)_([^_]+)_/, (match, id) => {
                                        if (!/^\-/.test(objs[match + 'id'])) {
                                            setObj[match + 'id'] = id;
                                        }
                                    });
                                }
                                applyBuffs(objs, trigger, bonuses, setObj);
                            }
                        }
                    });
                };
            if (attribute.match(/show_options/)) {
                return;
            }
            //Handles changes to the display state of the sheet. This ensures that the change to the attribute propagates to all instances of it
            if (attribute === 'tab_select') {
                if (event.newValue === 'options') {
                    setObj.npcship_toggle = 'settings';
                } else if (event.newValue === 'npc') {
                    setObj.npcship_toggle = 'npc';
                } else if (event.newValue === 'ship') {
                    setObj.npcship_toggle = 'ship';
                } else {
                    setObj.npcship_toggle = 'pc';
                    setObj.tab = event.newValue;
                }
                setAttrs(setObj, {
                    silent: true
                });
                //as with the tab_select, but for the section tabs within a repeating element
                /*}else if(attribute.match(/(?:save|attack|mods|damage)_checkbox/)){
                    getAttrs([event.sourceAttribute],(objs)=>{
                        setObj[event.sourceAttribute]=objs[event.sourceAttribute];
                        setAttrs(setObj,{silent:true});
                    });
                //Handles clicking of the change checkboxes for creation of various repeating elements to have them default to the appropriate stats.
                */
            } else if (attribute.match(/create/)) {
                let createSwitch = {
                        'cantrip': {section: '_spell_',attrs: ['_level', '_filter'],values: [0, 'cantrip']},
                        '1st': {section: '_spell_',attrs: ['_level', '_filter'],values: [1, 1]},
                        '2nd': {section: '_spell_',attrs: ['_level', '_filter'],values: [2, 2]},
                        '3rd': {section: '_spell_',attrs: ['_level', '_filter'],values: [3, 3]},
                        '4th': {section: '_spell_',attrs: ['_level', '_filter'],values: [4, 4]},
                        '5th': {section: '_spell_',attrs: ['_level', '_filter'],values: [5, 5]},
                        '6th': {section: '_spell_',attrs: ['_level', '_filter'],values: [6, 6]},
                        '7th': {section: '_spell_',attrs: ['_level', '_filter'],values: [7, 7]},
                        '8th': {section: '_spell_',attrs: ['_level', '_filter'],values: [8, 8]},
                        '9th': {section: '_spell_',attrs: ['_level', '_filter'],values: [9, 9]},
                        'npcmelee': {section: '_attack_',attrs: ['_engagement_range', '_range_filter', '_ability', '_damage_ability', '_proficiency'],values: ['melee', 'melee', '@{strength_mod}', '@{strength_mod}', 'specialized']},
                        'npcmultiattack': {section: '_attack_',attrs: ['_engagement_range', '_range_filter', '_ability', '_damage_ability', '_proficiency'],values: ['multiattack', 'multiattack', '@{strength_mod}', '@{strength_mod}', 'specialized']},
                        'npcranged': {section: '_attack_',attrs: ['_engagement_range', '_range_filter', '_ability', '_proficiency'],values: ['ranged', 'ranged', '@{dexterity_mod}', 'specialized']},
                        'forward': {section: '_attack_',attrs: ['_arc', '_arc_status'],values: ['forward', '@{forward_weapons_status}']},
                        'port': {section: '_attack_',attrs: ['_arc', '_arc_status'],values: ['port', '@{port_weapons_status}']},
                        'aft': {section: '_attack_',attrs: ['_arc', '_arc_status'],values: ['aft', '@{aft_weapons_status}']},
                        'starboard': {section: '_attack_',attrs: ['_arc', '_arc_status'],values: ['starboard', '@{starboard_weapons_status}']},
                        'turret': {section: '_attack_',attrs: ['_arc', '_arc_status'],values: ['turret', '?{' + getTranslationByKey('which-arc') + '|' + getTranslationByKey('forward') + ',@{forward_weapons_status}' + '|' + getTranslationByKey('port') + ',@{starboard_weapons_status}' + '|' + getTranslationByKey('aft') + ',@{aft_weapons_status}' + '|' + getTranslationByKey('starboard') + ',@{starboard_weapons_status}}']},
                        'system': {section: '_system_',attrs: ['_type'],values: ['system']},
                        'expansion': {section: '_system_',attrs: ['_type', '_purpose'],values: ['expansion', 'expansion-bay']},
                        'spell_like': {section: '_ability_',attrs: ['_type'],values: ['SP']},
                    },
                    createTarget = createSwitch[attribute.replace(/create_/, '')],
                    rowID = generateRowID();
                _.each(_.range(createTarget.attrs.length), (n) => {
                    setObj['repeating' + createTarget.section + rowID + createTarget.attrs[n]] = createTarget.values[n];
                    setObj['repeating' + createTarget.section + rowID + '_id'] = rowID;
                });
                setObj[attribute] = 0;
                setAttrs(setObj, {
                    silent: true
                }, () => {
                    setObj = {};
                    getID(cloneRepAttr, useID);
                });
                //Accesses the crew handling functions
            } else if (attribute.match(/^(?:captain|engineer|pilot|science_officer|speed|maneuverability)$/)) {
                if (attribute.match(/speed|maneuverability/)) {
                    getAttrs(['pilot'], (p) => {
                        event.newValue = p.pilot;
                        attribute = 'pilot';
                        shipCrewHandler(event, attribute);
                    });
                } else {
                    shipCrewHandler(event, attribute);
                }
                //accesses the gunner handling function
            } else if (attribute.match(/gunner/)) {
                shipGunnerHandler();
            } else {
                getID(cloneRepAttr, useID);
            }
        },

        updatePilot = function() {
            getAttrs(['pilot', 'ship_piloting_ranks', 'ac_armor', 'tl_countermeasures'], (attributes) => {
                const setObj = {
                    ship_piloting_ranks: pilotingRanks[attributes.pilot.replace(/\s+/, '_').toLowerCase()] || attributes.ship_piloting_ranks * 1 || 0,
                    update_pilot_ranks: 0,
                    ac: 10 + (pilotingRanks[attributes.pilot.replace(/\s+/, '_').toLowerCase()] * 1 || attributes.ship_piloting_ranks * 1 || 0) + (attributes.ac_armor * 1 || 0),
                    tl: 10 + (pilotingRanks[attributes.pilot.replace(/\s+/, '_').toLowerCase()] * 1 || attributes.ship_piloting_ranks * 1 || 0) + (attributes.tl_countermeasures * 1 || 0),
                };
                setAttrs(setObj, {
                    silent: true
                });
            });
        },

        expandConditions = function(attribute, attributes, setObj, event) {
            const propagatingConditions = {
                    asleep: {
                        triggers: ['helpless'],
                        triggeredBy: []
                    },
                    blinded: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    confused: {
                        triggers: [],
                        triggeredBy: ['wisdom_track4']
                    },
                    cowering: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    dazed: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dazzled: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dead: {
                        triggers: [],
                        triggeredBy: ['physical_track8', 'mental_track8', 'dexterity_track6', 'strength_track6', 'constitution_track6', 'intelligence_track6', 'wisdom_track6', 'charisma_track6']
                    },
                    deafened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dying: {
                        triggers: [],
                        triggeredBy: []
                    },
                    entangled: {
                        triggers: [],
                        triggeredBy: []
                    },
                    exhausted: {
                        triggers: [],
                        triggeredBy: ['physical_track4'],
                        replaces: ['fatigued']
                    },
                    fascinated: {
                        triggers: [],
                        triggeredBy: []
                    },
                    fatigued: {
                        triggers: [],
                        triggeredBy: ['physical_track3']
                    },
                    flat_footed: {
                        triggers: [],
                        triggeredBy: ['off_kilter', 'blinded', 'pinned', 'stunned', 'mental_track4']
                    },
                    frightened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    grappled: {
                        triggers: [],
                        triggeredBy: []
                    },
                    helpless: {
                        triggers: [],
                        triggeredBy: ['asleep', 'unconscious', 'dexterity_track5', 'strength_track5']
                    },
                    nauseated: {
                        triggers: [],
                        triggeredBy: []
                    },
                    negative_levels: {
                        triggers: [],
                        triggeredBy: []
                    },
                    off_kilter: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    off_target: {
                        triggers: [],
                        triggeredBy: []
                    },
                    panicked: {
                        triggers: [],
                        triggeredBy: []
                    },
                    paralyzed: {
                        triggers: [],
                        triggeredBy: []
                    },
                    pinned: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    prone: {
                        triggers: [],
                        triggeredBy: []
                    },
                    shaken: {
                        triggers: [],
                        triggeredBy: []
                    },
                    sickened: {
                        triggers: [],
                        triggeredBy: ['physical_track3']
                    },
                    stable: {
                        triggers: [],
                        triggeredBy: []
                    },
                    staggered: {
                        triggers: [],
                        triggeredBy: ['dexterity_track4', 'strength_track4']
                    },
                    stunned: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    unconscious: {
                        triggers: ['helpless'],
                        triggeredBy: ['physical_track7', 'mental_track7', 'constitution_track5', 'intelligence_track5', 'wisdom_track5', 'charisma_track5']
                    },

                    physical_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    }, //healthy
                    physical_tracklatent: {
                        triggers: [],
                        triggeredBy: []
                    },
                    physical_trackweakened: {
                        triggers: ['sickened', 'fatigued'],
                        triggeredBy: []
                    },
                    physical_trackimpaired: {
                        triggers: ['exhausted'],
                        triggeredBy: []
                    },
                    physical_trackdebilitated: {
                        triggers: [],
                        triggeredBy: []
                    },
                    physical_trackbedridden: {
                        triggers: [],
                        triggeredBy: []
                    },
                    physical_trackcomatose: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    physical_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    mental_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    mental_tracklatent: {
                        triggers: [],
                        triggeredBy: []
                    },
                    mental_trackweakened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    mental_trackimpaired: {
                        triggers: ['flat_footed'],
                        triggeredBy: []
                    },
                    mental_trackbefuddled: {
                        triggers: [],
                        triggeredBy: []
                    },
                    mental_trackdisassociated: {
                        triggers: [],
                        triggeredBy: []
                    },
                    mental_trackcomatose: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    mental_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    strength_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    strength_trackweakened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    strength_trackimpaired: {
                        triggers: [],
                        triggeredBy: []
                    },
                    strength_trackstaggered: {
                        triggers: ['staggered'],
                        triggeredBy: []
                    },
                    strength_trackimmobile: {
                        triggers: ['helpless'],
                        triggeredBy: []
                    },
                    strength_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    dexterity_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dexterity_tracksluggish: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dexterity_trackstiffened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    dexterity_trackstaggered: {
                        triggers: ['staggered'],
                        triggeredBy: []
                    },
                    dexterity_trackimmobile: {
                        triggers: ['helpless'],
                        triggeredBy: []
                    },
                    dexterity_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    constitution_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    constitution_trackweakened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    constitution_trackimpaired: {
                        triggers: [],
                        triggeredBy: []
                    },
                    constitution_trackdebilitated: {
                        triggers: [],
                        triggeredBy: []
                    },
                    constitution_trackunconscious: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    constitution_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    intelligence_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    intelligence_trackweakend: {
                        triggers: [],
                        triggeredBy: []
                    },
                    intelligence_trackimpaired: {
                        triggers: [],
                        triggeredBy: []
                    },
                    intelligence_trackanimalistic: {
                        triggers: [],
                        triggeredBy: []
                    },
                    intelligence_trackcomatose: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    intelligence_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    wisdom_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    },
                    wisdom_trackweakened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    wisdom_trackimpaired: {
                        triggers: [],
                        triggeredBy: []
                    },
                    wisdom_trackconfused: {
                        triggers: ['confused'],
                        triggeredBy: []
                    },
                    wisdom_trackcomatose: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    wisdom_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },

                    charisma_trackhealthy: {
                        triggers: [],
                        triggeredBy: []
                    }, //healthy
                    charisma_trackweakened: {
                        triggers: [],
                        triggeredBy: []
                    },
                    charisma_trackimpaired: {
                        triggers: [],
                        triggeredBy: []
                    },
                    charisma_trackpliable: {
                        triggers: [],
                        triggeredBy: []
                    },
                    charisma_trackcatatonic: {
                        triggers: ['unconscious'],
                        triggeredBy: []
                    },
                    charisma_trackdead: {
                        triggers: ['dead'],
                        triggeredBy: []
                    },
                },
                trackStatusConverter = {
                    physical_track: {
                        numConvert: ["healthy", "latent", "weakened", "impaired", "debilitated", "bedridden", "comatose", "dead"],
                        statusConvert: {
                            "healthy": 1,
                            "latent": 2,
                            "weakened": 3,
                            "impaired": 4,
                            "debilitated": 5,
                            "bedridden": 6,
                            "comatose": 7,
                            "dead": 8
                        }
                    },
                    mental_track: {
                        numConvert: ["healthy", "latent", "weakened", "impaired", "befuddled", "disassociated", "comatose", "dead"],
                        statusConvert: {
                            "healthy": 1,
                            "latent": 2,
                            "weakened": 3,
                            "impaired": 4,
                            "befuddled": 5,
                            "disassociated": 6,
                            "comatose": 7,
                            "dead": 8
                        }
                    },
                    strength_track: {
                        numConvert: ["healthy", "weakened", "impaired", "staggered", "immobile", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "weakened": 2,
                            "impaired": 3,
                            "staggered": 4,
                            "immobile": 5,
                            "dead": 6
                        }
                    },
                    dexterity_track: {
                        numConvert: ["healthy", "sluggish", "stiffened", "staggered", "immobile", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "sluggish": 2,
                            "stiffened": 3,
                            "staggered": 4,
                            "immobile": 5,
                            "dead": 6
                        }
                    },
                    constitution_track: {
                        numConvert: ["healthy", "weakened", "impaired", "debilitated", "unconscious", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "weakened": 2,
                            "impaired": 3,
                            "debilitated": 4,
                            "unconscious": 5,
                            "dead": 6
                        }
                    },
                    intelligence_track: {
                        numConvert: ["healthy", "weakend", "impaired", "animalistic", "comatose", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "weakend": 2,
                            "impaired": 3,
                            "animalistic": 4,
                            "comatose": 5,
                            "dead": 6
                        }
                    },
                    wisdom_track: {
                        numConvert: ["healthy", "weakened", "impaired", "confused", "comatose", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "weakened": 2,
                            "impaired": 3,
                            "confused": 4,
                            "comatose": 5,
                            "dead": 6
                        }
                    },
                    charisma_track: {
                        numConvert: ["healthy", "weakened", "impaired", "pliable", "catatonic", "dead", "", ""],
                        statusConvert: {
                            "healthy": 1,
                            "weakened": 2,
                            "impaired": 3,
                            "pliable": 4,
                            "catatonic": 5,
                            "dead": 6
                        }
                    }
                },
                finalConditions = [],
                toSet = [];
            let additionalChecks = [],
                trackState = '',
                value;

            if (/_condition_/.test(attribute)) {
                let track = attributes[attribute.replace(/_status/, '')];
                if (/_track_status$/.test(attribute)) {
                    trackState = _.max([trackStatusConverter[track].statusConvert[event.newValue], trackStatusConverter[track].statusConvert[event.previousValue], 1]);
                } else if (/_track$/.test(attribute)) {
                    trackState = trackStatusConverter[track].statusConvert[attributes[attribute + '_status']];
                }
                _.each(_.range(trackState), (r) => {
                    let status = trackStatusConverter[track].numConvert[r];
                    additionalChecks = additionalChecks.concat(propagatingConditions[track + status].triggers);
                });
            } else {
                additionalChecks = additionalChecks.concat(propagatingConditions[attribute].triggers);
            }
            while (additionalChecks.length) {
                let condition = additionalChecks.shift(),
                    tempObj = {};

                value = '';
                _.each(propagatingConditions[condition].triggers, (triggered) => {
                    if (!_.contains(additionalChecks.concat(toSet), triggered)) {
                        additionalChecks.push(triggered);
                    }
                });
                toSet.push(condition);
            }
            if (/_track_status$/.test(attribute) && event.newValue * 1 > event.previousValue * 1) {
                _.each(toSet, (ts) => {
                    if (!setObj[ts]) {
                        setObj[ts] = 1;
                        attributes[ts] = 1;
                    }
                    if (propagatingConditions[ts]) {
                        if (propagatingConditions[ts].replaces) {
                            setObj[propagatingConditions[ts].replaces] = '0';
                            attributes[propagatingConditions[ts].replaces] = '0';
                        }
                    }
                });
            } else {
                const afflictionIDs = _.chain(_.keys(attributes))
                    .filter((attr) => {
                        return /_condition_[^_]+_track$/.test(attr)
                    })
                    .map((attr) => {
                        return attr.replace(/track/, '');
                    })
                    .value();
                _.each(toSet, (ts) => {
                    if (_.every(propagatingConditions[ts].triggeredBy, (triggeredBy) => {
                            let value,
                                check = triggeredBy.replace(/([a-z_]+)(\d*)/i, (match, p1, p2) => {
                                    value = p2 * 1 || 1;
                                    return p1;
                                });
                            if (/_track/.test(check)) {
                                return _.every(afflictionIDs, (rowID) => {
                                    return attributes[rowID + 'track'] !== check || trackStatusConverter[attributes[rowID + 'track']].statusConvert[attributes[rowID + 'track_status']] < value;
                                });
                            } else {
                                return attributes[check] * 1 < value;
                            }
                        })) {
                        setObj[ts] = 0;
                        attributes[ts] = 0;
                    } else {
                        setObj[ts] = 1;
                        attributes[ts] = 1;
                    }
                });
            }
            return setObj;
        },

        assembleTrigger = function(attribute, objs, origEvent) {
            TAS.log(`origEvent:`);
            TAS.log(origEvent);
            let trigger = [];
            attribute = attribute.replace(/(repeating_[^_]+_[^_]+_.*?)(?:frequency|toggle)$/, (match, p1) => {
                origEvent.newValue = objs[p1 + 'mods'];
                origEvent.previousValue = undefined;
                return p1 + 'mods';
            });
            if (/_(?:equipped|mods)$|(?:spell|item|ability)_drop/.test(attribute)) {
                let event = {};
                if (/_equipped$/.test(attribute)) {
                    trigger.push(attribute);
                    attribute.replace(/(repeating_item_[^_]+_).+/, (match, p1) => {
                        event.newValue = objs[p1 + 'mods'];
                    });
                } else if (/_drop/.test(attribute)) {
                    if (/item/.test(attribute)) {
                        if (/attack/.test(origEvent.previousValue)) {
                            trigger = trigger.concat([`${origEvent.previousValue}damage_ability`, `${origEvent.previousValue}ability`]);
                        }
                        trigger = trigger.concat([`${origEvent.newValue}bulk`, `${origEvent.newValue}quantity`, `${origEvent.newValue}cost`]);
                        event.newValue = objs[`${origEvent.newValue}mods`];
                    } else if (/spell|ability/.test(attribute)) {
                        trigger = trigger.concat([`${origEvent.newValue}attack_ability`, `${origEvent.newValue}damage_ability`, `${origEvent.newValue}save_ability`]);
                        if(/ability/.test(attribute)){
                            event.newValue = objs[`${origEvent.newValue}mods`];
                        }
                    }
                } else {
                    event = origEvent;
                }
                const repeatAttrs = {
                        total: ['attack'],
                        damage_total: ['attack', 'ability', 'spell'],
                        dc: ['ability', 'spell'],
                        attack_total: ['ability', 'spell'],
                        profession: ['profession'],
                        attack: ['attack', 'ability', 'spell'],
                        damage: ['attack', 'ability', 'spell'],
                        spell_penetration: ['ability', 'spell']
                    },
                    repeatAbilities = {
                        total: ['ability'],
                        damage_total: ['damage_ability'],
                        dc: ['save_ability'],
                        attack_total: ['attack_ability'],
                        profession: ['ability'],
                        attack: ['ability', 'attack_ability'],
                        damage: ['damage_ability'],
                        spell_penetration: ['spell_resistance']
                    };
                _.each([event.previousValue, event.newValue], (value) => {
                    if (value) {
                        value = value.replace(/category:heavy(?:_|\s+)weapons?/, 'heavy');
                        value.replace(/(?:\s+([a-z\s]+))?(?:\s+to\s+)(.+)/gmi, (match, p1, seg2) => {
                            _.each(seg2.split(/\s+and\s+/g), (target) => {
                                target.replace(/(.+?(?=\||$))(?:\|(.+))?/, (m, p2, p3) => {
                                    if (repeatAttrs[p2.trim().replace(/\s+/g, '_').toLowerCase()]) {
                                        const objKeys = _.keys(objs);
                                        _.each(repeatAttrs[p2.replace(/\s+/g, '_')], (sct) => {
                                            const sctKeys = _.filter(objKeys, (key) => {
                                                return new RegExp('repeating_' + sct + '_[^_]+_(?:' + repeatAbilities[p2.replace(/\s+/g, '_')].join('|') + ')').test(key)
                                            });
                                            _.each(sctKeys, (attrName) => {
                                                let filtered = true;
                                                let id = attrName.match(/repeating_[^_]+_[^_]+_/)[0];
                                                try {
                                                    p3.replace(/([^:,]+):([^,]+)/g, (expr, filterAttr, filterValue) => {
                                                        if (/section/i.test(filterAttr)) {
                                                            filtered = sct === filterValue.toLowerCase();
                                                        } else {
                                                            filtered = (objs[id + filterAttr.replace(/\s+/g, '_')] + '').toLowerCase() === filterValue.toLowerCase();
                                                        }
                                                        if (!filtered) {
                                                            undefinedToBreak;
                                                        }
                                                    });
                                                } catch (err) {
                                                    //breaks the replace loop
                                                }
                                                if (filtered) {
                                                    trigger.push(attrName.trim().toLowerCase());
                                                }
                                            });
                                        });
                                    } else {
                                        p2 = p2.trim().replace(/\s+/g, '_');
                                        if (/armor/i.test(p1) && /^(?:eac|kac)$/i.test(p2)) {
                                            trigger.push(p2 + '_armor_buff');
                                        } else if (/armor/i.test(p1) && /^(?:ac|armor)$/i.test(p2)) {
                                            trigger = trigger.concat(['eac_armor_buff', 'kac_armor_buff']);
                                        } else if (/caster_level/i.test(p2)) {
                                            trigger.push('caster_level_buff');
                                        } else if (/acp/i.test(p2)) {
                                            let skillArray = ['acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival'];
                                            _.each(_.keys(objs), (a) => {
                                                if (/repeating_profession_[^_]+_profession/.test(a)) {
                                                    skillArray.push(a.match(/repeating_profession_[^_]+/)[0]);
                                                }
                                            });
                                            _.each(skillArray, (skill) => {
                                                if (objs[skill + '_acp'] * 1 === 1) {
                                                    trigger.push(skill + '_ranks');
                                                }
                                            });
                                        } else {
                                            trigger.push((p2.replace(/_max/, '') + '_buff').toLowerCase());
                                        }
                                    }
                                });
                            });
                        });
                    }
                });
            }else if(origEvent.removedInfo){
                trigger = _.keys(origEvent.removedInfo);
            }else if(/mancer/i.test(origEvent.sourceAttribute)){
                trigger=['strength_base','dexterity_base','constitution_base','intelligence_base','wisdom_base','charisma_base','class_1_spells','class_2_spells','class_3_spells','class_4_spells','class_5_spells','class_1_level','class_2_level','class_3_level','class_4_level','class_5_level'];
            }else{
                trigger.push(attribute.toLowerCase());
            }
            return _.unique(trigger);
        },

        setProficiency = function(attribute, attributes) {
            const setObj = {};
            let sectionAttr;
            if (/repeating/.test(attribute)) {
                const profItem = attributes[attribute] + '_proficiency';
                sectionAttr = attribute.replace(/(repeating_[^_]+_[^_]+_).+/i, '$1proficiency');
                setObj[sectionAttr] = attributes[profItem];
                attributes[sectionAttr] = setObj[sectionAttr];
            } else {
                const profArray = _.filter(_.keys(attributes), (a) => {
                    if (/(?:melee|arm|weapon|grenade|sniper)/.test(attribute) && /repeating_attack_[^_]+_category/.test(a) && attributes[a] === attribute.replace(/_proficiency/, '')) {
                        return true;
                    } else if (/armor/.test(attribute) && /repeating_item_[^_]+_purpose/.test(a) && attributes[a] === 'armor' && attributes[a.replace(/purpose/, 'type')] === attribute.replace(/_proficiency/, '')) {
                        return true;
                    }
                    return false;
                });
                _.each(profArray, (a) => {
                    sectionAttr = a.replace(/(repeating_[^_]+_[^_]+_).+/i, '$1proficiency');
                    setObj[sectionAttr] = attributes[attribute];
                    attributes[sectionAttr] = attributes[attribute];
                });
            }
            return setObj;
        },

        //Sets the current total sheilds to be equal to the total of the four arcs' shields
        shieldHandler = function(event) {
            var shields = 0,
                setObj = {};

            getAttrs(['forward_shields', 'port_shields', 'aft_shields', 'starboard_shields'], (shields) => {
                setObj.shield_total = _.reduce(shields, (memo, s) => {
                    return memo += s * 1 || 0;
                }, 0);
                setAttrs(setObj, {
                    silent: true
                });
            });
        },

        //Handles changes to the repeating_system items. Affects the computers bonus of the ship, armor, Defensive countermeasures, shields, and power
        shipSystemHandler = function(sections) {
            var attributes = ['size', 'ship_piloting_ranks', 'ship_computer'],
                setObj = {},
                ids = [],
                pcu = 0,
                pcu_max = 0,
                bp = 0,
                shield_total = 0,
                armor = 0,
                countermeasure = 0,
                computerMatch,
                computerQuery = '',
                computer = '',
                newComp,
                sensor = 0,
                sizeSwitch = {
                    'tiny': 2,
                    'small': 1,
                    'medium': 0,
                    'large': -1,
                    'huge': -2,
                    'gargantuan': -4,
                    'colossal': -8
                };
            _.each(sections, (section) => {
                _.each(section.id, (sid) => {
                    ids.push('repeating_' + section.section + '_' + sid);
                    _.each(section.fields, (f) => {
                        attributes.push('repeating_' + section.section + '_' + sid + '_' + f);
                    });
                });
            });
            getAttrs(attributes, (resources) => {
                _.each(ids, (i) => {
                    bp += resources[i + '_bp'] * 1 || 0;
                    if (i.match(/attack/)) {
                        if (resources[i + '_powered'] === 'ON') {
                            pcu += resources[i + '_pcu'] * 1 || 0;
                        }
                    } else if (i.match(/system/)) {
                        if (resources[i + '_powered'] === 'ON') {
                            armor += resources[i + '_armor'] * 1 || 0;
                            countermeasure += resources[i + '_countermeasure'] * 1 || 0;
                            shield_total += resources[i + '_shields'] * 1 || 0;
                            if (resources[i + '_comp_bonus'].length > 1) {
                                let origComp = newComp * 1 || 0;
                                resources[i + '_comp_bonus'].replace(/\d+/, (match) => {
                                    newComp = match * 1 || 0;
                                });
                                if (newComp * 1 > origComp) {
                                    computer = resources[i + '_comp_bonus'];
                                }
                            }
                            if (resources[i + '_sensor_bonus'].length > 0) {
                                sensor = Math.max(sensor, (resources[i + '_sensor_bonus'].replace(/\+|\s+/g, '') * 1 || 0));
                            }
                            if (resources[i + '_purpose'] === 'power-core') {
                                pcu_max += resources[i + '_pcu'] * 1 || 0;
                            } else {
                                pcu += resources[i + '_pcu'] * 1 || 0;
                            }
                        }
                    }
                });
                computerMatch = computer.replace(/\+\s*\d+/, (match) => {
                    computerQuery = '?{' + getTranslationByKey('use-computer') + '|' + getTranslationByKey('no') + ', |' + getTranslationByKey('yes') + ',' + match + '}';
                });
                armor += sizeSwitch[resources.size] * 1 || 0;
                countermeasure += sizeSwitch[resources.size] * 1 || 0;
                setObj = {
                    ship_pcu_max: pcu_max,
                    ship_pcu: pcu,
                    ship_computer: computer,
                    computer_query: computerQuery,
                    shield_total_max: shield_total,
                    ac_armor: armor,
                    ship_bp: bp,
                    ship_sensors: sensor,
                    tl_countermeasures: countermeasure,
                    ac: (resources.ship_piloting_ranks * 1 || 0) + armor + 10,
                    tl: (resources.ship_piloting_ranks * 1 || 0) + countermeasure + 10
                };
                setAttrs(setObj, {
                    silent: true
                });
            });
        },

        //Handles the changes to the crew attributes (except for gunner), and creates the menus, or skill rolls necessary for that position
        shipCrewHandler = function(event, attribute) {
            var people = event.newValue.split(/\s*,\s*/),
                maneuverSwitch = {
                    'clumsy': '-2',
                    'poor': '-1',
                    'average': '',
                    'good': '+1',
                    'perfect': '+2'
                },
                speedMod = (speed) => {
                    switch (speed) {
                        case 1:
                        case 2:
                        case 3:
                        case 4:
                            return '+2';
                            break;
                        case 5:
                        case 6:
                        case 7:
                            return '+1';
                            break;
                        case 8:
                        case 9:
                        case 10:
                            return '';
                            break;
                        case 11:
                        case 12:
                            return '-1';
                            break;
                        default:
                            return '-2';
                            break;
                    }
                },
                crewSwitch = {
                    'engineer': (name, shipName) => '@{' + name + '|engineering_ranks}[RNK]+[[({0,@{' + name + '|engineering_ranks}}>1) * @{' + name + '|engineering_class_skill}]][CS]+@{' + name + '|engineering_ability}[ABI]@{' + name + '|engineering_misc}',
                    'pilot': (name, shipName, size, maneuver) => '@{' + name + '|piloting_ranks}[RNK]+[[({0,@{' + name + '|piloting_ranks}}>1) * @{' + name + '|piloting_class_skill}]][CS]+@{' + name + '|piloting_ability}[ABI]' + speedMod(size * 1 || 1) + maneuverSwitch[maneuver] + '@{' + name + '|piloting_misc}@{' + shipName + '|engines_status}@{' + shipName + '|power_core_status}',
                    'science_officer': (name, shipName) => '@{' + name + '|computers_ranks}[RNK]+[[({0,@{' + name + '|computers_ranks}}>1) * @{' + name + '|computers_class_skill}]][CS]+@{' + name + '|computers_ability}[ABI]@{' + name + '|computers_misc}+@{ship_sensors}[sensors]@{' + shipName + '|sensors_status}@{' + shipName + '|power_core_status}',
                },
                npcCrewSwitch = {
                    'engineer': (name) => '',
                    'pilot': (name) => '@{' + name + '|engines_status}',
                    'science_officer': (name) => '@{' + name + '|sensors_status}',
                    'captain': (name) => '@{' + name + '|life_support_status}'
                },
                query = '{{title=' + getTranslationByKey(attribute.replace(/_/g, '-') + '-query') + '}} {{buttons0=',
                matcher = '',
                setObj = {},
                shipSpeed, shipManeuver, values;
            people = _.map(people, (p) => {
                let retValue = {};
                retValue.bonus = p.match(/[+\-–—―−]\s*\d+/);
                if (retValue.bonus) {
                    retValue.bonus = retValue.bonus[0];
                    p = p.replace(retValue.bonus, '');
                }
                retValue.actor = p.trim();
                return retValue;
            });
            getAttrs(['character_name', 'speed', 'maneuverability'], (name) => {
                shipSpeed = name.speed;
                shipManeuver = name.maneuverability;
                name = name.character_name;
                _.each(people, (p) => {
                    if (p.bonus) {
                        if (people.length > 1) {
                            query += (query.match(/=$/) ? '' : ' |') + '[' + p.actor.trim() + '](!/&#13;' + HE('@{' + name + '|whisper_state}&{template:sf_generic} {{name=@{' + name + '|character_name}}} {{characterid=@{' + name + '|character_id}}} {{title=^{' + attribute.replace(/_/g, '-') + '}}} {{r1=[[1d20' + p.bonus + npcCrewSwitch[attribute](name) + '@{' + name + '|power_core_status}@{' + name + '|computer_query}' + (attribute === 'pilot' ? '?{' + getTranslationByKey('helm-check') + '|' + getTranslationByKey('no') + ', |' + getTranslationByKey('yes') + ',&{tracker' + HE('}') + '}' : '') + ']]}} {{r1name=' + p.actor.trim() + '}}') + ')';
                        } else {
                            query = ' {{title=^{' + attribute.replace(/_/g, '-') + '}}} {{r1=[[1d20' + p.bonus + npcCrewSwitch[attribute](name) + '@{power_core_status}@{' + name + '|computer_query}' + (attribute === 'pilot' ? '?{' + getTranslationByKey('helm-check') + '|' + getTranslationByKey('no') + ', |' + getTranslationByKey('yes') + ',&{tracker' + HE('}') + '}' : '') + ']]}} {{r1name=' + p.actor;
                        }
                    } else {
                        if (people.length > 1 && attribute !== 'captain') {
                            query += (query.match(/=$/) ? '' : ' |') + '[' + p.actor.trim() + '](!/&#13;' + HE('@{' + name + '|whisper_state}&{template:sf_generic} {{name=@{' + name + '|character_name}}} {{characterid=@{' + name + '|character_id}}} {{title=^{' + attribute.replace(/_/g, '-') + '}}} {{r1=[[1d20+' + crewSwitch[attribute](p.actor.trim(), name, shipSpeed, shipManeuver) + '@{' + name + '|power_core_status}@{' + name + '|computer_query}' + (attribute === 'pilot' ? '?{' + getTranslationByKey('helm-check') + '|' + getTranslationByKey('no') + ', |' + getTranslationByKey('yes') + ',&{tracker' + HE('}') + '}' : '') + ']]}} {{r1name=' + p.actor + '}}') + ')';
                        } else if (people.length === 1 && attribute === 'captain') {
                            _.each(skillList, (s) => {
                                if (s !== 'profession') {
                                    query += (query.match(/=$/) ? '' : ' |') + '[^{' + s.toLowerCase().replace(/_/g, '-') + '}](!/&#13;' + HE('@{' + name + '|whisper_state}&{template:sf_generic} {{name=@{' + name + '|character_name}}} {{characterid=@{' + name + '|character_id}}} {{title=^{' + s.toLowerCase().replace(/_/g, '-') + '}}} {{r1=[[1d20+@{' + p.actor.trim() + '|' + s + '_ranks}+' + '@{' + p.actor.trim() + '|' + s + '_ability}@{' + p.actor.trim() + '|' + s + '_misc}@{' + name + '|power_core_status}@{' + name + '|computer_query}]]}} {{r1name=' + p.actor + '}}') + ')';
                                }
                            });
                        } else if (people.length === 1) {
                            query = ' {{title=^{' + attribute.replace(/_/g, '-') + '}}} {{r1=[[1d20+' + crewSwitch[attribute](p.actor.trim(), name, shipSpeed, shipManeuver) + '@{' + name + '|computer_query}' + (attribute === 'pilot' ? '?{' + getTranslationByKey('helm-check') + '|' + getTranslationByKey('no') + ', |' + getTranslationByKey('yes') + ',&{tracker' + HE('}') + '}' : '') + ']]}} {{r1name=' + p.actor;
                        }
                    }
                });
                if (query.match(/buttons0=/)) {
                    query = '/w "' + name + '"&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}}' + query + '}}';
                } else {
                    query = '@{' + name + '|whisper_state}&{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}}' + query + '}}';
                }
                setObj[attribute + '_bonus'] = query;
                setAttrs(setObj, {
                    silent: true
                });
            });

        },

        //Handles changes to the gunner attribute, sets the gunner_roll attribute which is used by all the ship attacks to calculate the attack bonus.
        shipGunnerHandler = function() {
            var setObj = {},
                query = '?{' + getTranslationByKey('which-gunner') + '|',
                matcher;
            getAttrs(['gunner'], (gunners) => {
                gunners = _.map(gunners.gunner.split(/\s*,\s*/), (p) => {
                    let retValue = {};
                    retValue.bonus = p.match(/[+\-–—―−]\s*\d+/);
                    if (retValue.bonus) {
                        retValue.bonus = retValue.bonus[0];
                        p = p.replace(retValue.bonus, '');
                    }
                    retValue.actor = p.trim();
                    return retValue;
                });
                if (gunners.length > 1) {
                    _.each(gunners, (gun) => {
                        query += gun.actor + ',' + (gun.bonus || HE('{') + '@{' + gun.actor + '|piloting_ranks}' + HE(',') + '@{' + gun.actor + '|bab}' + HE('}') + 'kh1+@{' + gun.actor + '|dexterity_mod}') + '|';
                    });
                    query += '}';
                } else {
                    query = gunners[0].bonus || '{@{' + gunners[0].actor + '|piloting_ranks},@{' + gunners[0].actor + '|bab}}kh1+@{' + gunners[0].actor + '|dexterity_mod}';
                }
                setObj.gunner_roll = query;
                setAttrs(setObj, {
                    silent: true
                });
            });
        },

        patchHandler = function(event) {
            const system = event.sourceAttribute.replace(/patch/, 'status'),
                valueConvert = {
                    '+0': 0,
                    '-2': 1,
                    '-4': 2,
                    '+1d0cf<0cs>1[wrecked]': 3,
                },
                powerConvert = {
                    '+0': 0,
                    ' ': 1,
                    '-2': 2,
                    '-4': 3,
                },
                valueArray = _.keys(valueConvert),
                powerValueArray = _.keys(powerConvert),
                setObj = {};

            getAttrs([system], (attributes) => {
                let converted
                if (/power_core/.test(system)) {
                    converted = powerConvert[attributes[system]];
                    converted = Math.min(Math.max((converted + (event.newValue * 1 === 1 ? -1 : 1)), 0), 3);
                    setObj[system] = powerValueArray[converted];
                } else {
                    converted = valueConvert[attributes[system]];
                    converted = Math.min(Math.max((converted + (event.newValue * 1 === 1 ? -1 : 1)), 0), 3);
                    setObj[system] = valueArray[converted];
                }
                setAttrs(setObj, {
                    silent: true
                });
            });
        },

        //Handles changes to current health that cause the reactive styling of the health container to change.
        healthHandler = function(attributes, event) {
            const setObj = _.reduce(['temp_hp', 'sp', 'hp', 'rp'], (memo, h) => {
                if (attributes[h] * 1 < 0) {
                    if (h === 'sp') {
                        memo.hp = attributes.hp * 1 + attributes.sp * 1;
                        attributes.hp = memo.hp;
                    } else if (h === 'temp_hp') {
                        memo.sp = attributes.sp * 1 + attributes.temp_hp * 1;
                        attributes.sp = memo.sp;
                    }
                    memo[h] = 0;
                    attributes[h] = memo[h];
                }
                if (h !== 'temp_hp') {
                    memo.health_status += ((attributes[h] * 1 <= 0 && attributes[h] * 1 !== attributes[h + '_max'] * 1) ? 1 : 0);
                }
                return memo;
            }, {
                health_status: 0
            });
            setAttrs(setObj, {
                silent: true
            });
            return undefined;
        },

        /*class attribute handling functions*/
        //Handles changes to the class specific attributes and acts as a traffic switch to determine how to handle them
        classHandler = function(attributes, attribute) {
            var classVar = attribute.replace(/class_\d_/, ''),
                classNum = attribute.replace(/class_(\d)_.+/, '$1'),
                varSwitch = {
                    name: classNameHandler, //Handles changes to the class's name. Attributes affected: class&name
                    level: classLevelHandler, //Handles changes to the class's level. Attributes affected: class&name, bab, saves, skill points, sp, hp
                    sp: classHealthHandler, //actually does nothing, only here to prevent errors when class attributes change
                    hp: classHealthHandler,
                    spell_progression: spell_progressionHandler,
                    bab: classBABHandler, //Handles changes to the class's bab. Attributes affected: bab
                    fort: classSaveHandler, //Handles changes to the class's save progressions. Attributes affected: saves
                    ref: classSaveHandler, //Handles changes to the class's save progressions. Attributes affected: saves
                    will: classSaveHandler, //Handles changes to the class's save progressions. Attributes affected: saves
                    spells: classSpellHandler,
                    /*Handles changes to the class's spell attributes. Controls whether the spells sheet is accessible
                                                                and what spell levels are accessible*/
                    casting_ability: classAbilityHandler, //Handles changes to what is the core ability score. Controls what abilities and spells linked to that
                    //class are set to base their DC off of by default.
                    ability: classAbilityHandler, //See above
                    skills: classHealthHandler
                },
                setObj;
            return varSwitch[classVar](attributes, classVar, classNum);
        },

        spell_progressionHandler = function(attributes) {
            const convertProgress = { //object of fat arrow functions that calculates the spell level available for a class
                'half': (lvl) => lvl >= 13 ? 4 : lvl >= 10 ? 3 : lvl >= 7 ? 2 : lvl >= 4 ? 1 : 0,
                'partial': (lvl) => lvl >= 16 ? 6 : lvl >= 13 ? 5 : lvl >= 10 ? 4 : lvl >= 7 ? 3 : lvl >= 4 ? 2 : lvl >= 1 ? 1 : 0,
                'full_prep': (lvl) => Math.min(Math.floor((lvl + 1) / 2), 9),
                'full_spont': (lvl) => lvl * 1 === 1 ? 1 : Math.floor(lvl / 2)
            };
            const setObj = _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                let preClass = 'class_' + n;
                if (attributes[preClass + '_spells'] * 1 === 1) {
                    memo['caster_level'] += (attributes[preClass + '_level'] * 1 || 0);
                    memo[preClass + '_show'] = 1;
                    memo[preClass + '_max_spell'] = convertProgress[attributes[preClass + '_spell_progression']](attributes[preClass + '_level'] * 1) || 0;
                } else {
                    memo[preClass + '_show'] = 0;
                    memo[preClass + '_max_spell'] = 0;
                }
                memo.char_max_spell = _.max([memo.char_max_spell, memo[preClass + '_max_spell'], 0]);
                return memo;
            }, {
                caster_level: 0
            });
            setObj.char_max_spell = _.reduce(_.range(setObj.char_max_spell + 1), (m, num) => {
                return m += ' ' + num;
            }, '');
            return setObj;
        },

        classNameHandler = function(attributes) {
            var temp,
                classNL = _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                    temp = (attributes['class_' + n + '_name'] || '') + ((attributes['class_' + n + '_name'] && attributes['class_' + n + '_name'] !== '' && attributes['class_' + n + '_level'] && attributes['class_' + n + '_level'] !== '') ? ' ' : '') + (attributes['class_' + n + '_level'] || '');
                    memo += temp.length > 0 ? (memo.length > 0 ? ' /' : '') + temp : '';
                    return memo;
                }, '');
            setAttrs({
                'class&level': classNL
            }, {
                silent: true
            });
            return undefined;
        },

        classLevelHandler = function(attributes) {
            const convertProgress = { //object of fat arrow functions that calculates the spell level available for a class
                'half': (lvl) => lvl >= 13 ? 4 : lvl >= 10 ? 3 : lvl >= 7 ? 2 : lvl >= 4 ? 1 : 0,
                'partial': (lvl) => lvl >= 16 ? 6 : lvl >= 13 ? 5 : lvl >= 10 ? 4 : lvl >= 7 ? 3 : lvl >= 4 ? 2 : lvl >= 1 ? 1 : 0,
                'full_prep': (lvl) => Math.min(Math.floor((lvl + 1) / 2), 9),
                'full_spont': (lvl) => lvl * 1 === 1 ? 1 : Math.floor(lvl / 2)
            };
            var convertSave = {
                    poor: (lvl) => attributes.drone * 1 === 1 ? Math.round((lvl - 1) / 4) : Math.floor(lvl / 3),
                    good: (lvl) => 2 + (attributes.drone * 1 === 1 ? Math.ceil((lvl * 0.75 - 1) / 2) : Math.floor(lvl / 2))
                },
                temp;
            const setObj = _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                let preClass = 'class_' + n;
                memo.character_level = (memo.character_level || 0) + (attributes[preClass + '_level'] * 1 || 0);
                memo.bab += attributes.drone * 1 === 1 ? Math.ceil((attributes[preClass + '_level'] * 0.75) || 0) : Math.floor(attributes[preClass + '_bab'] * attributes[preClass + '_level'] || 0);
                temp = (attributes['class_' + n + '_name'] || '') + ((attributes[preClass + '_name'] && attributes[preClass + '_name'] !== '' && attributes[preClass + '_level'] && attributes[preClass + '_level'] !== '') ? ' ' : '') + (attributes[preClass + '_level'] || '');
                memo['class&level'] += temp.length > 0 ? (memo['class&level'].length > 0 ? ' / ' : '') + temp : '';
                if (attributes[preClass + '_spells'] * 1 === 1) {
                    memo['caster_level'] += (attributes[preClass + '_level'] * 1 || 0);
                    memo[preClass + '_show'] = 1;
                    memo[preClass + '_max_spell'] = convertProgress[attributes[preClass + '_spell_progression']](attributes[preClass + '_level'] * 1) || 0;
                } else {
                    memo[preClass + '_show'] = 0;
                    memo[preClass + '_max_spell'] = 0;
                }
                _.each(['fort', 'ref', 'will'], (save) => {
                    memo[save + '_base'] += convertSave[attributes[preClass + '_' + save]](attributes[preClass + '_level']);
                });
                memo.char_max_spell = _.max([memo.char_max_spell, memo[preClass + '_max_spell'], 0]);
                return memo;
            }, {
                level: 0,
                fort_base: 0,
                ref_base: 0,
                will_base: 0,
                bab: 0,
                'class&level': '',
                caster_level: 0
            });
            setObj.char_max_spell = _.reduce(_.range(setObj.char_max_spell + 1), (m, num) => {
                return m += ' ' + num;
            }, '');
            return setObj;
        },

        classHealthHandler = function() {
            return {};
        },

        classBABHandler = function(attributes) {
            return _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                memo.bab += Math.floor(attributes['class_' + n + '_bab'] * attributes['class_' + n + '_level'] || 0);
                return memo;
            }, {
                bab: 0
            });
        },

        classSaveHandler = function(attributes, save) {
            var convertSave = {
                    poor: (lvl) => Math.floor(lvl / 3),
                    good: (lvl) => lvl > 0 ? (Math.floor(lvl / 2) + 2) : 0
                },
                memObj = {};

            memObj[save + '_base'] = 0;
            memObj = _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                memo[save + '_base'] += convertSave[attributes['class_' + n + '_' + save]](attributes['class_' + n + '_level'] * 1 || 0);
                return memo;
            }, memObj);
            return memObj;
        },

        classAbilityHandler = function(attributes, attr, classNum) {
            var preClass = 'class_' + classNum,
                setObj = {},
                repeatingSources = _.filter(_.keys(attributes), (a) => {
                    return a.match(/repeating_[^_]+_-[^_]+_source/)
                });

            if (attr === 'ability') {
                setObj[preClass + '_casting_ability'] = attributes[preClass + '_ability'];
            }
            return _.reduce(repeatingSources, (memo, s) => {
                if ((attributes[s] + '').toLowerCase() === (attributes[preClass + '_name'] + '').toLowerCase()) {
                    memo[s.replace(/source/, 'save_ability')] = attributes[preClass + ((attr === 'casting_ability' && s.match(/spell/)) ? '_casting' : '') + '_ability'];
                }
                return memo;
            }, setObj);
        },

        classSpellHandler = function(attributes, attr, classNum) {
            var setObj = {},
                preClass = 'class_' + classNum;
            _.some([1, 2, 3, 4, 5], (n) => {
                if (attributes['class_' + n + '_spells'] * 1 === 1) {
                    setObj.is_caster = 1;
                    setObj.caster_select = 1;
                    return true;
                } else {
                    setObj.is_caster = 0;
                    setObj.caster_select = 0;
                }
            });
            if (attr === 'spells' && attributes[preClass + '_spells'] * 1 === 1) {
                setObj[preClass + '_casting_ability'] = attributes[preClass + '_ability'];
            }
            let progressionObj = spell_progressionHandler(attributes);
            Object.assign(setObj, progressionObj);
            return setObj;
        },

        abilityHandler = function(attributes, attr) { //Handles changes to an ability or spell item. Was originally planned as a switcher function, however only one function was needed in the end
            var field = attr.replace(/repeating_(?:spell|ability)_-[^_]+_/, ''),
                setObj = {};
            switch (field) {
                case 'source':
                    setObj = abilitySourceHandler(attributes, attr);
                    break;
            }
            return setObj;
        },
        
        abilitySourceHandler = function(attributes, attr) { //Handles when an ability's or spell's source attribute is changed to automatically set
            // it's save DC ability and what class level it is based off of
            return _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                if ((attributes['class_' + n + '_name'] + '').toLowerCase() === (attributes[attr] + '').toLowerCase()) {
                    memo[attr.replace(/source/, 'save_ability')] = attributes[`class_${n}_${/repeating_spell/.test(attr) ? 'casting_':''}ability`];
                }
                return memo;
            }, {});
        },
        
        buildMenus = function(attributes, setObj) { //Constructs the chat based menus using the character's name, and the abilities/spells/attacks
            var sectionIDs,
                preMenu = '/w @{character_name} &{template:sf_generic} {{name=@{character_name}}} {{characterid=@{character_id}}} {{title=';
            setObj.attacks_menu = preMenu + 'ATTACKS}}';
            setObj.spells_menu = attributes.sheet_type === 'pc' ? preMenu + 'SPELLBOOKS}} {{buttons1=' : preMenu + 'SPELLS}}';
            setObj.ability_checks_menu = preMenu + 'ABILITY CHECKS}}';
            setObj.abilities_menu = preMenu + 'SPECIAL ABILITIES}}';
            setObj.skills_menu = preMenu + 'SKILLS}}';
            /*attack menu build*/
            sectionIDs = _.chain(_.keys(attributes))
                .reduce((m, a) => {
                    if (a.match(/repeating_attack_[^_]+_name/)) {
                        m.push(a.replace(/repeating_attack_(-[^_]+)_.*/, '$1'));
                    }
                    return m;
                }, [])
                .uniq()
                .value();
            let ranged = '{{buttons2=RANGED\n',
                melee = '{{buttons1=MELEE\n',
                multiAttack = '{{buttons3=',
                multiAttackMacro = '',
                multiAttackNumber = 0;
            
            _.each(sectionIDs, (id) => {
                let preRepeat = 'repeating_attack_' + id + '_';
                if ((attributes[preRepeat + 'engagement_range']) === 'ranged') {
                    if (ranged !== '{{buttons2=RANGED\n') {
                        ranged += ' |';
                    }
                    ranged += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                }else if(attributes[`${preRepeat}engagement_range`] === 'multiattack'){
                    if(multiAttack = '{{buttons3='){
                        multiAttack +=`[^{multiattack}](~${attributes.character_id}|multiattack)`;
                    }
                    _.each(_.range(attributes[`${preRepeat}full_attack_number`]*1||1),()=>{
                        multiAttackNumber++;
                        multiAttackMacro += `{{fullattack=[[${multiAttackNumber}]]}} {{r${multiAttackNumber}name=@{${preRepeat}name}}} {{r${multiAttackNumber}=[[1d20+@{${preRepeat}base_attack_bonus_base}[BAB]+@{${preRepeat}ability}[ABILITY BUFFS]+@{${preRepeat}proficiency_value}[PROF]@{${preRepeat}misc}@{${preRepeat}bonus}]]}} {{damage${multiAttackNumber}type=@{${preRepeat}type}}} {{damage${multiAttackNumber}=[[@{${preRepeat}damage_dice}+@{${preRepeat}damage_ability}[ABILITY BUFFS]+@{${preRepeat}damage_proficiency_value}[SPEC]@{${preRepeat}damage_misc}]]}} {{crit${multiAttackNumber}damage=[[@{${preRepeat}damage_dice}+@{${preRepeat}damage_ability}[ABILITY BUFFS]+@{${preRepeat}damage_proficiency_value}[SPEC]@{${preRepeat}damage_misc}]]}} {{crit${multiAttackNumber}effect=@{${preRepeat}crit}}}`
                    });
                }else{
                    if (melee !== '{{buttons1=MELEE\n') {
                        melee += ' |';
                    }
                    melee += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                }
            });
            melee += '}}';
            ranged += '}}';
            multiAttack +='}}';
            setObj.attacks_menu += `${melee} ${ranged} ${multiAttack}`;
            if(multiAttackMacro===''){
                multiAttackMacro='{{notes=^{add multiattack}}}'
            }
            setObj.multiattack_macro = multiAttackMacro;
            if (attributes.sheet_type === 'pc') {
                /*spells menu build*/
                let spellClassNums = _.filter([1, 2, 3, 4, 5], (n) => {
                    return attributes['class_' + n + '_spells'] * 1 === 1;
                });
                _.each(spellClassNums, (n) => {
                    let preClass = 'class_' + n + '_';
                    if (setObj.spells_menu !== preMenu + 'SPELLBOOKS}} {{buttons1=') {
                        setObj.spells_menu += ' |';
                    }
                    setObj.spells_menu += '[' + HE(attributes[preClass + 'name']||'').toUpperCase() + '](~' + attributes.character_id + '|' + preClass + 'spellbook)';
                    let spellLevels = attributes[preClass + 'max_spell'] * 1 + 1;
                    let classSpellBook = preMenu + attributes[preClass + 'name'].toUpperCase() + ' Spells}}';
                    _.each(_.range(spellLevels), (r) => {
                        let spellLevel = '{{buttons' + r + '=' + (r === 0 ? 'CANTRIPS' : 'LEVEL' + r) + ' [[0@{' + preClass + (r === 0 ? 'cantrips' : 'level_' + r + '_spells') + '_per_day}]] / [[0@{' + preClass + (r === 0 ? 'cantrips' : 'level_' + r + '_spells') + '_per_day|max}]]\n';
                        sectionIDs = _.chain(_.keys(attributes))
                            .reduce((m, a) => {
                                if (a.match(/repeating_spell_([^_]+)_source/)) {
                                    if (attributes[a] === attributes[preClass + 'name'] && attributes[a.replace(/source/, 'level')] * 1 === r) {
                                        m.push(a.replace(/repeating_spell_(-[^_]+)_.*/, '$1'));
                                    }
                                }
                                return m;
                            }, [])
                            .value();
                        _.each(sectionIDs, (id) => {
                            let preRepeat = 'repeating_spell_' + id + '_';
                            if (spellLevel !== '{{buttons' + r + '=' + (r === 0 ? 'CANTRIPS' : 'LEVEL' + r) + ' [[0@{' + preClass + (r === 0 ? 'cantrips' : 'level_' + r + '_spells') + '_per_day}]] / [[0@{' + preClass + (r === 0 ? 'cantrips' : 'level_' + r + '_spells') + '_per_day|max}]]\n') {
                                spellLevel += ' |';
                            }
                            spellLevel += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                        });
                        spellLevel += '}}';
                        classSpellBook += spellLevel.replace(/\n}}/, '}}');
                    });
                    setObj[preClass + 'spellbook'] = classSpellBook;
                });
                setObj.spells_menu += '}}';
                /*abilities menu*/
                sectionIDs = _.chain(_.keys(attributes))
                    .reduce((m, a) => {
                        if (a.match(/repeating_ability/)) {
                            m.push(a.replace(/repeating_ability_(-[^_]+)_.*/, '$1'));
                        }
                        return m;
                    }, [])
                    .uniq()
                    .value();
                let racial_abilities = '{{buttons1=^{racial}\n';
                let feat_abilities = '{{buttons2=^{feats}\n';
                let class_abilities = {
                    class_1_abilities: '{{buttons3=' + attributes.class_1_name.toUpperCase() + '\n',
                    class_2_abilities: '{{buttons4=' + attributes.class_2_name.toUpperCase() + '\n',
                    class_3_abilities: '{{buttons5=' + attributes.class_3_name.toUpperCase() + '\n',
                    class_4_abilities: '{{buttons6=' + attributes.class_4_name.toUpperCase() + '\n',
                    class_5_abilities: '{{buttons7=' + attributes.class_5_name.toUpperCase() + '\n'
                }
                _.each(sectionIDs, (id) => {
                    let preRepeat = 'repeating_ability_' + id + '_';
                    let classNum = 0;
                    if ((attributes[preRepeat + 'source'] + '').toLowerCase() === (attributes.race + '').toLowerCase()) {
                        if (racial_abilities !== '{{buttons1=^{racial}\n') {
                            racial_abilities += ' |';
                        }
                        racial_abilities += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                    } else if (_.some([1, 2, 3, 4, 5], (n) => {
                            classNum = n;
                            return (attributes['class_' + n + '_name'] + '').toLowerCase() === (attributes[preRepeat + 'source'] + '').toLowerCase();
                        })) {
                        if (class_abilities['class_' + classNum + '_abilities'] !== '{{buttons' + (classNum + 2) + '=' + attributes['class_' + classNum + '_name'].toUpperCase() + '\n') {
                            class_abilities['class_' + classNum + '_abilities'] += ' |';
                        }
                        class_abilities['class_' + classNum + '_abilities'] += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                    } else {
                        if (feat_abilities !== '{{buttons2=^{feats}\n') {
                            feat_abilities += ' |';
                        }
                        feat_abilities += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
                    }
                });
                racial_abilities += '}}';
                feat_abilities += '}}';
                class_abilities = {
                    class_1_abilities: (class_abilities.class_1_abilities + '}}').replace(/\n}}/, ''),
                    class_2_abilities: (class_abilities.class_2_abilities + '}}').replace(/\n}}/, ''),
                    class_3_abilities: (class_abilities.class_3_abilities + '}}').replace(/\n}}/, ''),
                    class_4_abilities: (class_abilities.class_4_abilities + '}}').replace(/\n}}/, ''),
                    class_5_abilities: (class_abilities.class_5_abilities + '}}').replace(/\n}}/, '')
                }
                racial_abilities = racial_abilities.replace(/{{buttons1=\^{racial}\n}}/, '');
                feat_abilities = feat_abilities.replace(/{{buttons2=\^{feats}\n}}/, '');
                setObj.abilities_menu += racial_abilities + '' + feat_abilities + '' + _.reduce(class_abilities, (m, ca) => {
                    return m + ca
                }, '');
            } else if (attributes.sheet_type === 'npc') {
                /*spells menu build*/
                let spellObjs = _.reduce(_.keys(attributes), (memo, k) => {
                    if (k.match('repeating_spell_-[^_]+_name')) {
                        memo.push({
                            name: attributes[k],
                            level: attributes[k.replace(/name/, 'level')] * 1 || 0,
                            roll: k.replace(/name/, 'npc_roll')
                        });
                    }
                    return memo;
                }, []);
                let spellLevels = {
                    cantrips: '{{buttons0=CANTRIPS',
                    level1: '{{buttons1=LEVEL 1',
                    level2: '{{buttons2=LEVEL 2',
                    level3: '{{buttons3=LEVEL 3',
                    level4: '{{buttons4=LEVEL 4',
                    level5: '{{buttons5=LEVEL 5',
                    level6: '{{buttons6=LEVEL 6',
                    level7: '{{buttons7=LEVEL 7',
                    level8: '{{buttons8=LEVEL 8',
                    level9: '{{buttons9=LEVEL 9'
                }
                _.each(spellObjs, (s) => {
                    spellLevels[s.level === 0 ? 'cantrips' : 'level' + s.level] += (spellLevels[s.level === 0 ? 'cantrips' : 'level' + s.level].match(/\n/) ? ' |' : '\n') + '[' + s.name + '](~' + attributes.character_name + '|' + s.roll + ')';
                });
                _.each(_.keys(spellLevels), (k) => {
                    if (spellLevels[k].match(/\n/)) {
                        spellLevels[k] += '}}';
                    } else {
                        spellLevels[k] = spellLevels[k].replace(/({{buttons\d=).+/, '$1}}');
                    }
                    setObj.spells_menu += '' + spellLevels[k];
                });
                if (setObj.spells_menu.match(/\n/)) {
                    setObj.caster_select = 1;
                }
                /*abilities menu*/
                sectionIDs = _.chain(_.keys(attributes))
                    .reduce((m, a) => {
                        if (a.match(/repeating_ability/)) {
                            m.push(a.replace(/repeating_ability_(-[^_]+)_.*/, '$1'));
                        }
                        return m;
                    }, [])
                    .uniq()
                    .value();
                let racial_abilities = '{{buttons1=RACIAL\n';
                let feat_abilities = '{{buttons2=FEATS\n';
                let class_abilities = {
                    class_1_abilities: '{{buttons3=' + attributes.class_1_name.toUpperCase() + '\n',
                    class_2_abilities: '{{buttons4=' + attributes.class_2_name.toUpperCase() + '\n',
                    class_3_abilities: '{{buttons5=' + attributes.class_3_name.toUpperCase() + '\n',
                    class_4_abilities: '{{buttons6=' + attributes.class_4_name.toUpperCase() + '\n',
                    class_5_abilities: '{{buttons7=' + attributes.class_5_name.toUpperCase() + '\n'
                }
                _.each(sectionIDs, (id) => {
                    let preRepeat = 'repeating_ability_' + id + '_';
                    let classNum = 0;
                    if ((attributes[preRepeat + 'source'] + '').toLowerCase() === (attributes.race + '').toLowerCase()) {
                        if (racial_abilities !== '{{buttons1=RACIAL\n') {
                            racial_abilities += ' |';
                        }
                        racial_abilities += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'npc_roll)';
                    } else if (_.some([1, 2, 3, 4, 5], (n) => {
                            classNum = n;
                            return (attributes['class_' + n + '_name'] + '').toLowerCase() === (attributes[preRepeat + 'source'] + '').toLowerCase();
                        })) {
                        if (class_abilities['class_' + classNum + '_abilities'] !== '{{buttons' + (classNum + 2) + '=' + attributes['class_' + classNum + '_name'] + '\n') {
                            class_abilities['class_' + classNum + '_abilities'] += ' |';
                        }
                        class_abilities['class_' + classNum + '_abilities'] += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'npc_roll)';
                    } else {
                        if (feat_abilities !== '{{buttons2=FEATS\n') {
                            feat_abilities += ' |';
                        }
                        feat_abilities += '[' + HE(attributes[preRepeat + 'name']||'') + '](~' + attributes.character_id + '|' + preRepeat + 'npc_roll)';
                    }
                });
                racial_abilities += '}}';
                feat_abilities += '}}';
                class_abilities = {
                    class_1_abilities: (class_abilities.class_1_abilities + '}}').replace(/\n}}/, ''),
                    class_2_abilities: (class_abilities.class_2_abilities + '}}').replace(/\n}}/, ''),
                    class_3_abilities: (class_abilities.class_3_abilities + '}}').replace(/\n}}/, ''),
                    class_4_abilities: (class_abilities.class_4_abilities + '}}').replace(/\n}}/, ''),
                    class_5_abilities: (class_abilities.class_5_abilities + '}}').replace(/\n}}/, '')
                }
                setObj.abilities_menu += racial_abilities + '' + feat_abilities + '' + _.reduce(class_abilities, (m, ca) => {
                    return m + ca
                }, '');
            }
            /*skills*/
            setObj.skills_menu += '{{buttons0=[Perception](~' + attributes.character_id + '|perception)}}' +
                '{{buttons1=PHYSICAL\n[Acrobatics](~' + attributes.character_id + '|acrobatics) | [Athletics](~' + attributes.character_id + '|athletics) | [Piloting](~' + attributes.character_id + '|piloting)}}' +
                '{{buttons2=SOCIAL\n[Bluff](~' + attributes.character_id + '|bluff) | [Diplomacy](~' + attributes.character_id + '|diplomacy) | [Disguise](~' + attributes.character_id + '|disguise) | [Intimidate](~' + attributes.character_id + '|intimidate) | [Sense Motive](~' + attributes.character_id + '|sense_motive)}}' +
                '{{buttons3=THIEVERY\n[Sleight of Hand](~' + attributes.character_id + '|sleight_of_hand) | [Stealth](~' + attributes.character_id + '|stealth)}}' +
                '{{buttons4=KNOWLEDGE\n[Computers](~' + attributes.character_id + '|computers) | [Culture](~' + attributes.character_id + '|culture) | [Engineering](~' + attributes.character_id + '|engineering) | [Life Science](~' + attributes.character_id + '|life_science) | [Medicine](~' + attributes.character_id + '|medicine) | [Mysticism](~' + attributes.character_id + '|mysticism) | [Physical Science](~' + attributes.character_id + '|physical_science) | [Survival](~' + attributes.character_id + '|survival)}}';
            let professionMenu = '{{buttons5=PROFESSION\n'
            sectionIDs = _.chain(_.keys(attributes))
                .reduce((m, a) => {
                    if (a.match(/repeating_profession/)) {
                        m.push(a.replace(/repeating_profession_(-[^_]+)_.*/, '$1'));
                    }
                    return m;
                }, [])
                .uniq()
                .value();
            _.each(sectionIDs, (id) => {
                let preRepeat = 'repeating_profession_' + id + '_';
                if (professionMenu !== '{{buttons5=PROFESSION\n') {
                    professionMenu += ' |';
                }
                professionMenu += '[' + HE(attributes[preRepeat + 'name']) + '](~' + attributes.character_id + '|' + preRepeat + 'roll)';
            });
            professionMenu += '}}';
            setObj.skills_menu += professionMenu.replace(/PROFESSION\n}}/, '');
            return setObj;
        },

        assignConditions = function(attributes, bonuses) {
            const skillArray = ['acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival'],
                activeConditions = _.filter(_.keys(attributes), (k) => {
                    return /repeating_condition_[^_]+_name/.test(k)
                }),
                filteredSkillDamage = {
                    'dexSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp(skillArray.join('|') + '$').test(key) && attributes[key + '_ability'] === '@{dexterity_mod}') {
                            return true;
                        }
                        return false;
                    }).concat(['profession|ability:@{dexterity_mod}']),
                    'strSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp(skillArray.join('|') + '$').test(key) && attributes[key + '_ability'] === '@{strength_mod}') {
                            return true;
                        }
                        return false;
                    }).concat(['profession|ability:@{strength_mod}']),
                    'intSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp(skillArray.join('|') + '$').test(key) && attributes[key + '_ability'] === '@{intelligence_mod}') {
                            return true;
                        }
                        return false;
                    }).concat(['profession|ability:@{intelligence_mod}']),
                    'wisSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp(skillArray.join('|') + '$').test(key) && attributes[key + '_ability'] === '@{wisdom_mod}') {
                            return true;
                        }
                        return false;
                    }).concat(['profession|ability:@{wisdom_mod}']),
                    'chaSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp(skillArray.join('|') + '$').test(key) && attributes[key + '_ability'] === '@{charisma_mod}') {
                            return true;
                        }
                        return false;
                    }).concat(['profession|ability:@{charisma_mod}']),
                    'meleeDamage': ['damage|engagement_range:melee'],
                    'meleeAttack': ['attack|engagement_range:melee'],
                    'weaponDamage': ['damage|section:attack'],
                    'dexAttack': ['total|ability:@{dexterity_mod}'],
                    'strAttack': ['total|ability:@{strength_mod}'],
                    'strDamage': ['damage|damage_ability:@{strength_mod},section:attack'],
                    'conDC': ['dc|save_ability:@{constitution_mod}'],
                },
                conditions = [{
                    condition: 'asleep',
                    penalties: [
                        ['perception', -10]
                    ]
                }, {
                    condition: 'blinded',
                    penalties: [
                        ['dexSkills', -4],
                        ['strSkills', -4],
                        ['perception', '-?{' + getTranslationByKey('opposed-roll') + '|' + getTranslationByKey('no') + ',0|' + getTranslationByKey('yes') + ',4}']
                    ]
                }, {
                    condition: 'dazzled',
                    penalties: [
                        ['perception', '-?{' + getTranslationByKey('visual') + '|' + getTranslationByKey('no') + ',0|' + getTranslationByKey('yes') + ',1}'],
                        ['attack', -1]
                    ]
                }, {
                    condition: 'deafened',
                    penalties: [
                        ['initiative', -4],
                        ['perception', '-?{' + getTranslationByKey('opposed-roll') + '|' + getTranslationByKey('no') + ',0|' + getTranslationByKey('yes') + ',4}']
                    ]
                }, {
                    condition: 'entangled',
                    penalties: [
                        ['eac', -2],
                        ['kac', -2],
                        ['attack', -2],
                        ['ref', -2],
                        ['initiative', -2],
                        ['dexSkills', -2]
                    ]
                }, {
                    condition: 'exhausted',
                    penalties: [
                        ['eac', -3],
                        ['kac', -3],
                        ['attack', -3],
                        ['meleeDamage', -3],
                        ['ref', -3],
                        ['initiative', -3],
                        ['strSkills', -3],
                        ['dexSkills', -3],
                        ['encumber_bulk', -3]
                    ]
                }, {
                    condition: 'fatigued',
                    penalties: [
                        ['eac', -1],
                        ['kac', -1],
                        ['attack', -1],
                        ['meleeDamage', -1],
                        ['ref', -1],
                        ['initiative', -1],
                        ['strSkills', -1],
                        ['dexSkills', -1],
                        ['encumber_bulk', -1]
                    ]
                }, {
                    condition: 'flat_footed',
                    penalties: [
                        ['eac', -2],
                        ['kac', -2]
                    ]
                }, {
                    condition: 'frightened',
                    penalties: [
                        ['attack', -2],
                        ['ref', -2],
                        ['fort', -2],
                        ['will', -2],
                        ['skills', -2]
                    ]
                }, {
                    condition: 'negative_levels',
                    penalties: [
                        ['attack', -1],
                        ['ref', -1],
                        ['fort', -1],
                        ['will', -1],
                        ['skills', -1],
                        ['eac', -1],
                        ['kac', -1],
                        ['sp_max', -5],
                        ['hp_max', -5]
                    ]
                }, {
                    condition: 'off_kilter',
                    penalties: [
                        ['attack', -2]
                    ]
                }, {
                    condition: 'off_target',
                    penalties: [
                        ['attack', -2]
                    ]
                }, {
                    condition: 'panicked',
                    penalties: [
                        ['ref', -2],
                        ['fort', -2],
                        ['will', -2],
                        ['skills', -2]
                    ]
                }, {
                    condition: 'grappled',
                    penalties: [
                        ['eac', -2],
                        ['kac', -2],
                        ['attack', -2],
                        ['ref', -2],
                        ['initiative', -2],
                        ['dexSkills', '-?{' + getTranslationByKey('escaping-grapple') + '|' + getTranslationByKey('no') + ',0|' + getTranslationByKey('yes') + ',2}']
                    ]
                }, {
                    condition: 'pinned',
                    penalties: [
                        ['eac', -4],
                        ['kac', -4],
                        ['attack', -4],
                        ['ref', -4],
                        ['initiative', -4],
                        ['dexSkills', -4]
                    ]
                }, {
                    condition: 'prone',
                    penalties: [
                        ['meleeAttack', -4]
                    ]
                }, {
                    condition: 'shaken',
                    penalties: [
                        ['attack', -2],
                        ['ref', -2],
                        ['fort', -2],
                        ['will', -2],
                        ['skills', -2]
                    ]
                }, {
                    condition: 'sickened',
                    penalties: [
                        ['attack', -2],
                        ['fort', -2],
                        ['ref', -2],
                        ['will', -2],
                        ['weaponDamage', -2],
                        ['skills', -2]
                    ]
                }, ],
                diseasePoison = {
                    'physical_track': [
                        [], //Healthy
                        [], //latent
                        [], //weakened
                        [], //impaired
                        [], //debilitated
                        [], //bedridden
                        [], //comatose
                        [], //You're Dead!
                    ],
                    'mental_track': [
                        [], //healthy
                        [], //latent
                        [
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //weakened
                        [
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //impaired
                        [], //befuddled
                        [], //disassociated
                        [], //comatose
                        [], //You're Dead!
                    ],
                    'strength_track': [
                        [], //healthy
                        [
                            ['strAttack', -2],
                            ['strDamage', -2],
                            ['strSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //weakened
                        [
                            ['strAttack', -2],
                            ['strDamage', -2],
                            ['strSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //impaired
                        [], //staggered
                        [], //immobile
                        [], //You're Dead!
                    ],
                    'dexterity_track': [
                        [], //healthy
                        [
                            ['ref', -2],
                            ['dexAttack', -2],
                            ['dexSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //sluggish
                        [], //stiffened
                        [], //staggered
                        [], //immobile
                        [], //You're Dead!
                    ],
                    'constitution_track': [
                        [], //healthy
                        [
                            ['fort', -2],
                            ['conDC', -2]
                        ], //weakened
                        [
                            ['fort', -2],
                            ['conDC', -2]
                        ], //impaired
                        [], //debilitated
                        [], //unconscious
                        [], //You're Dead!
                    ],
                    'intelligence_track': [
                        [], //healthy
                        [
                            ['intSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //weakend
                        [
                            ['intSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //impaired
                        [], //animalistic
                        [], //comatose
                        [], //You're Dead!
                    ],
                    'wisdom_track': [
                        [], //healthy
                        [
                            ['will', -2],
                            ['wisSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //weakened
                        [
                            ['will', -2],
                            ['wisSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //impaired
                        [], //confused
                        [], //comatose
                        [], //You're Dead!
                    ],
                    'charisma_track': [
                        [], //healthy
                        [
                            ['chaSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //weakened
                        [
                            ['chaSkills', -2],
                            ['spell|dc', -2],
                            ['ability|dc', -2]
                        ], //impaired
                        [], //pliable
                        [], //catatonic
                        [], //You're Dead!
                    ]
                },
                trackNumConvert = {
                    'physical_track': {
                        healthy: 1,
                        latent: 2,
                        weakened: 3,
                        impaired: 4,
                        debilitated: 5,
                        bedridden: 6,
                        comatose: 7,
                        dead: 8
                    },
                    'mental_track': {
                        healthy: 1,
                        latent: 2,
                        weakened: 3,
                        impaired: 4,
                        befuddled: 5,
                        disassociated: 6,
                        comatose: 7,
                        dead: 8
                    },
                    'strength_track': {
                        healthy: 1,
                        weakened: 2,
                        impaired: 3,
                        staggered: 4,
                        immobile: 5,
                        dead: 6
                    },
                    'dexterity_track': {
                        healthy: 1,
                        sluggish: 2,
                        stiffened: 3,
                        staggered: 4,
                        immobile: 5,
                        dead: 6
                    },
                    'constitution_track': {
                        healthy: 1,
                        weakened: 2,
                        impaired: 3,
                        debilitated: 4,
                        unconscious: 5,
                        dead: 6
                    },
                    'intelligence_track': {
                        healthy: 1,
                        weakened: 2,
                        impaired: 3,
                        animalistic: 4,
                        comatose: 5,
                        dead: 6
                    },
                    'wisdom_track': {
                        healthy: 1,
                        weakened: 2,
                        impaired: 3,
                        confused: 4,
                        comatose: 5,
                        dead: 6
                    },
                    'charisma_track': {
                        healthy: 1,
                        weakened: 2,
                        impaired: 3,
                        pliable: 4,
                        catatonic: 5,
                        dead: 6
                    },
                };

            _.each(activeConditions, (condition) => {
                const rowID = condition.replace(/name/, ''),
                    track = attributes[rowID + 'track'],
                    status = attributes[rowID + 'track_status'],
                    statusValue = trackNumConvert[track] ? trackNumConvert[track][status] || 1 : undefined;

                if (statusValue) {
                    _.each(_.range(statusValue), (state) => {
                        _.each(diseasePoison[track][state], (effect) => {
                            let expandedPenalties = filteredSkillDamage[effect[0]] || [effect[0]];
                            _.each(expandedPenalties, (affected) => {
                                bonuses[affected] = bonuses[affected] || {};
                                bonuses[affected]['Affliction'] = bonuses[affected]['Affliction'] || [];
                                bonuses[affected]['Affliction'].push(effect[1]);
                            });
                        });
                    });
                }
            });
            _.each(conditions, (cond) => {
                let conditionName = cond.condition.replace(/_/g, '-');
                if (Math.abs(attributes[cond.condition] * 1) > 0) {
                    _.each(cond.penalties, (effect) => {
                        let expandedPenalties
                        if (effect[0] === 'skills') {
                            expandedPenalties = skillArray.concat(['profession']);
                        } else {
                            expandedPenalties = filteredSkillDamage[effect[0]] || [effect[0]];
                        }
                        _.each(expandedPenalties, (affected) => {
                            bonuses[affected] = bonuses[affected] || {};
                            bonuses[affected][conditionName] = bonuses[affected][conditionName] || [];
                            bonuses[affected][conditionName].push(effect[1] * Math.abs(attributes[cond.condition] * 1) || effect[1]);
                        });
                    });
                }
            });
            return bonuses;
        },

        parseBuffs = function(attributes) { //parses all of the buffs contained in the repeating_buff, repeating_item, and repeating_ability items
            //  creates an object indexed by attribute to be buffed containing objects that have all of the buffs for that attribute
            //  indexed by buff type
            let armor = false,
                armorProf,
                profPenalty = '';
            var modRegex = /((?:\+|\-)?.*?(?=(?:[a-z\s]+)?\s+to\s+))(?:\s+([a-z\s]+))?\s+to\s+([^\n]+)/i, //allow wrapping of equation in ()'s
                buffSplit, buffMatch, buff, buffType, buffed, evalBuff,
                buffFields = _.chain(_.keys(attributes))
                .filter((k) => {
                    return k.match(/_mods$/);
                })
                .filter((k) => {
                    let typeSwitch = {
                        'item': (p1) => [p1 + 'equipped'],
                        'buff': (p1) => [p1 + 'toggle'],
                        'ability': (p1) => [p1 + 'toggle', p1 + 'frequency']
                    };
                    let typeMatch = k.match(/(repeating_(item|buff|ability)_-[^_]+_)mods/);
                    if(typeMatch){
                        return _.some(typeSwitch[typeMatch[2]](typeMatch[1]), (ts) => {
                            return (attributes[ts] + '').match(/enabled|equipped|constant|1/);
                        });
                    }else{
                        return true;
                    }
                })
                .map((k) => {
                    let typeMatch = k.match(/(repeating_(item|buff|ability)_-[^_]+_)mods/);
                    if(typeMatch){
                        if (typeMatch[2] === 'item' && attributes[typeMatch[1] + 'purpose'] === 'armor') {
                            armor = /power/.test(attributes[typeMatch[1] + 'type']) ? 'power' : (armor === 'power' ? 'power' : true);
                            armorProf = attributes[typeMatch[1] + 'proficiency'];
                        }
                    }
                    return attributes[k];
                })
                .reject((f) => {
                    return _.isEmpty(f)
                })
                .reduce((memo, f) => {
                    buffSplit = f.split(/\s*\n\s*/);
                    memo = memo.concat(buffSplit);
                    return memo;
                }, [])
                .reduce((memo, f) => {
                    buffMatch = f.match(modRegex);
                    if (buffMatch) {
                        let rawBuff = buffMatch[1].toLowerCase();
                        buffed = buffMatch[3].toLowerCase().split(/\s+and\s+/);
                        buffType = buffMatch[2] ? buffMatch[2].toLowerCase().replace(/max dex/i, 'max_dex') : 'untyped';
                        _.each(buffed, (b) => {
                            b = b.trim();
                            buff = rawBuff;
                            if (/^(?:strength|dexterity|constitution|intelligence|wisdom|charisma)$/i.test(b) && attributes.sheet_type === 'npc') {
                                buff = 'floor((' + rawBuff + ')/2)';
                                b = b + '_mod';
                            }
                            if ((b === 'eac' || b === 'kac') && buffType === 'armor') {
                                b += '_armor';
                            } else if (b === 'sp' || b === 'rp' || b === 'hp' || b.match(/temp[^\s]*\s*hp/)) {
                                b += '_max';
                            }
                            if (armor) {
                                if (armorProf === 'no') {
                                    profPenalty = '-4';
                                }
                            }
                            b = b.replace(/(.+?(?=\|)|(?:\||,).+?(?=:))/g, '$1').replace(/\s+/g, '_').replace(/heavy(?:_|\s+)weapons?/, 'heavy').toLowerCase();
                            if (b.startsWith('category:')) {
                                b = b.replace(/category:_?/, '');
                                memo.categories[b] = memo.categories[b] || {};
                                memo.categories[b][buffType] = memo.categories[b][buffType] || [];
                                memo.categories[b][buffType].push(buff);
                            } else if (b.match(/^(?:ac|armor)$/i)) {
                                if (/armor/i.test(buffType)) {
                                    memo.eac_armor = memo.eac_armor || {};
                                    memo.eac_armor[buffType] = memo.eac_armor[buffType] || [];
                                    memo.eac_armor[buffType].push(buff);
                                    memo.kac_armor = memo.kac_armor || {};
                                    memo.kac_armor[buffType] = memo.kac_armor[buffType] || [];
                                    memo.kac_armor[buffType].push(buff);
                                } else {
                                    memo.eac = memo.eac || {};
                                    memo.eac[buffType] = memo.eac[buffType] || [];
                                    memo.eac[buffType].push(buff);
                                    memo.kac = memo.kac || {};
                                    memo.kac[buffType] = memo.kac[buffType] || [];
                                    memo.kac[buffType].push(buff);
                                }
                            } else if (b.match(/^skills?$/i)) {
                                _.each(skillList, (skill) => {
                                    memo[skill] = memo[skill] || {};
                                    memo[skill][buffType] = memo[skill][buffType] || [];
                                    memo[skill][buffType].push(buff);
                                });
                            } else if (b === 'acp') {
                                memo[b] = memo[b] || {};
                                memo[b].acp = memo[b].acp || [];
                                memo[b].acp.push(buff);
                            } else if (b === 'saves') {
                                _.each(['fort', 'ref', 'will'], (save) => {
                                    memo[save] = memo[save] || {};
                                    memo[save][buffType] = memo[save][buffType] || [];
                                    memo[save][buffType].push(buff);
                                });
                            } else {
                                memo[b] = memo[b] || {};
                                memo[b][buffType] = memo[b][buffType] || [];
                                memo[b][buffType].push(buff);
                            }
                        });
                    }
                    return memo;
                }, {})
                .value();
            if (armor) {
                if (armorProf === 'no') {
                    buffFields.eac = buffFields.eac || {};
                    buffFields.eac.untyped = buffFields.eac.untyped || [];
                    buffFields.eac.untyped.push('-4');
                    buffFields.kac = buffFields.kac || {};
                    buffFields.kac.untyped = buffFields.kac.untyped || [];
                    buffFields.kac.untyped.push('-4');
                }
            }
            return buffFields;
        },

        starfinderMax = function() { //Returns the maximum value if first argument is null/undefined/false. otherwise returns minimum
            if (arguments[0] === true) {
                return _.min(_.rest(arguments));
            } else {
                return _.max(_.rest(arguments));
            }
        },

        calcBuffs = function(attributes, bonus, setObj, output) { //calculates the buff to apply for any given type. Also takes into account stacking.
            var tObj, evalBuff, redAttr = _.reduce(_.keys(bonus), (memo, t) => {
                tObj = _.reduce(bonus[t], (m, b) => {
                    evalBuff = (b + '').replace(/(floor|ceil|abs|round|abs)\(/g, 'Math.$1(').replace(/@{([^}]+)}/g, (match, p1) => {
                        return setObj[p1.toLowerCase()] * 1 || attributes[p1.toLowerCase()] * 1 || '@{' + p1 + '}';
                    });
                    try {
                        evalBuff = eval(evalBuff);
                        if (t === 'acp') {
                            m.acp = starfinderMax(true, m.acp, evalBuff);
                        } else if (evalBuff >= 0) {
                            if (t === 'armor') {
                                m.armor = starfinderMax(false, m.armor, evalBuff);
                            } else if (t === 'max_dex') {
                                m.max_dex = starfinderMax(true, m.max_dex, evalBuff);
                            } else if (_.contains((attributes.stackable_buffs.toLowerCase() + ',untyped').split(/\s*(?:,|\n+)\s*/), t.toLowerCase())) {
                                m.buff += evalBuff;
                            } else {
                                m.buff = starfinderMax(false, m.buff, evalBuff);
                            }
                        } else if (evalBuff < 0) {
                            m.pen += evalBuff;
                        }
                    } catch (err) {}
                    if (_.contains((attributes.stackable_buffs.toLowerCase() + ',untyped,affliction').split(/\s*(?:,|\n+)\s*/), t.toLowerCase())) {
                        m.misc += (m.misc === '' ? '' : '+') + (b + '').replace(/^\+/, '');
                    } else if ((b + '').length > 0) {
                        m.misc += (m.misc === '' ? '' : ',') + '{' + (b + '').replace(/^\+/, '') + '}'
                    }
                    return m;
                }, {
                    buff: 0,
                    pen: 0,
                    misc: '',
                    armor: 0,
                    acp: 0
                });
                memo.total += tObj.buff + tObj.pen + tObj.acp;
                if (_.contains((`${attributes.stackable_buffs.toLowerCase()},untyped,affliction`).split(/\s*(?:,|\n+)\s*/).concat(conditionList), t.toLowerCase()) && tObj.misc.length > 0) {
                    memo.misc += '+[[' + tObj.misc + ']][' + t + ']';
                } else {
                    if (tObj.misc.length > 1) {
                        memo.misc += `+[[{${tObj.misc},{0}}kl1 + {${tObj.misc},{0}}kh1]][${t}]`;
                    }
                }
                memo.armor = starfinderMax(false, memo.armor, tObj.armor);
                if (_.isNumber(tObj.max_dex * 1)) {
                    memo.max_dex = starfinderMax(true, memo.max_dex, tObj.max_dex);
                }
                return memo;
            }, {
                total: 0,
                misc: '',
                armor: 0,
                acp: 0
            });
            return redAttr;
        },

        affectWhat = function(attributes, trigger, bonus) {
            let abiSel;
            if (attributes.sheet_type === 'pc') {
                abiSel = ['eac_ability', 'kac_ability', 'fort_ability', 'ref_ability', 'initiative_ability', 'will_ability', 'class_1_ability', 'class_2_ability', 'class_3_ability', 'class_4_ability', 'class_5_ability', 'acrobatics_ability', 'athletics_ability', 'bluff_ability', 'computers_ability', 'culture_ability', 'diplomacy_ability', 'disguise_ability', 'engineering_ability', 'intimidate_ability', 'life_science_ability', 'medicine_ability', 'mysticism_ability', 'perception_ability', 'physical_science_ability', 'piloting_ability', 'sense_motive_ability', 'sleight_of_hand_ability', 'stealth_ability', 'survival_ability'];
            }else{
                abiSel = ['acrobatics_ability', 'athletics_ability', 'bluff_ability', 'computers_ability', 'culture_ability', 'diplomacy_ability', 'disguise_ability', 'engineering_ability', 'intimidate_ability', 'life_science_ability', 'medicine_ability', 'mysticism_ability', 'perception_ability', 'physical_science_ability', 'piloting_ability', 'sense_motive_ability', 'sleight_of_hand_ability', 'stealth_ability', 'survival_ability']
            }
            const objSwitch = {
                    npc: npcAttributeObjs,
                    pc: attributeObjs
                },
                bonusKeys = _.keys(bonus),
                affected = {},
                affectedKeys = [],
                propagatedTriggers = _.reduce(trigger, (memo, trig) => {
                    trig.replace(/(?:(repeating_([^_]+)_[^_]+_))?(.+)/, (match, sectionID, section, attr) => {
                        let objName;
                        if (section) {
                            objName = section + '|' + attr;
                        } else {
                            objName = attr;
                        }
                        if(objSwitch[attributes.sheet_type][objName]){
                            memo[trig] = JSON.parse(JSON.stringify(objSwitch[attributes.sheet_type][objName]));
                        }
                    });
                    return memo;
                }, {}),
                complicatedConditions = {
                    entangled: ['dexSkills'],
                    exhausted: ['dexSkills', 'strSkills'],
                    blinded: ['dexSkills', 'strSkills'],
                    fatigued: ['dexSkills', 'strSkills', 'meleeDamage'],
                    strength_track: ['strSkills', 'strAttack', 'strDamage'],
                    dexterity_track: ['dexSkills', 'dexAttack'],
                    constitution_track: ['conDC'],
                    intelligence_track: ['intSkills'],
                    wisdom_track: ['wisSkills'],
                    charisma_track: ['chaSkills'],
                },
                skillArray = ['acrobatics', 'athletics', 'bluff', 'computers', 'culture', 'diplomacy', 'disguise', 'engineering', 'intimidate', 'life_science', 'medicine', 'mysticism', 'perception', 'physical_science', 'piloting', 'sense_motive', 'sleight_of_hand', 'stealth', 'survival'],
                filteredSkillDamage = {
                    'dexSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp('(?:repeating_profession_[^_]+_profession|' + skillArray.join('|') + ')').test(key) && attributes[key.replace(/_profession$/, '') + '_ability'] === '@{dexterity_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'strSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp('(?:repeating_profession_[^_]+_profession|' + skillArray.join('|') + ')').test(key) && attributes[key.replace(/_profession$/, '') + '_ability'] === '@{strength_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'intSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp('(?:repeating_profession_[^_]+_profession|' + skillArray.join('|') + ')').test(key) && attributes[key.replace(/_profession$/, '') + '_ability'] === '@{intelligence_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'wisSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp('(?:repeating_profession_[^_]+_profession|' + skillArray.join('|') + ')').test(key) && attributes[key.replace(/_profession$/, '') + '_ability'] === '@{wisdom_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'chaSkills': _.filter(_.keys(attributes), (key) => {
                        if (new RegExp('(?:repeating_profession_[^_]+_profession|' + skillArray.join('|') + ')').test(key) && attributes[key.replace(/_profession$/, '') + '_ability'] === '@{charisma_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'meleeDamage': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_attack_[^_]+_damage_total/.test(key) && attributes[key.replace(/_damage_total$/, '_engagement_range')] === 'melee') {
                            return true;
                        }
                        return false;
                    }),
                    'meleeAttack': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_attack_[^_]+_total/.test(key) && attributes[key.replace(/_total$/, '_engagement_range')] === 'melee') {
                            return true;
                        }
                        return false;
                    }),
                    'weaponDamage': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_attack_[^_]+_damage_total/.test(key)) {
                            return true;
                        }
                        return false;
                    }),
                    'dexAttack': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_(?:attack_[^_]+_total|(?:spell|ability)_[^_]+_attack_total)/.test(key) && attributes[key.replace(/_total$/, '_ability')] === '@{dexterity_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'strAttack': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_(?:attack_[^_]+_total|(?:spell|ability)_[^_]+_attack_total)/.test(key) && attributes[key.replace(/_total$/, '_ability')] === '@{strength_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'strDamage': _.filter(_.keys(attributes), (key) => {
                        if (/repeating_(?:attack|spell|ability)_[^_]+_damage_total/.test(key) && attributes[key.replace(/_total$/, '_ability')] === '@{strength_mod}') {
                            return true;
                        }
                        return false;
                    }),
                    'conDC': _.filter(_.keys(attributes), (key) => {
                        if (/_dc$/.test(key) && attributes[key.replace(/_dc$/, '_save_ability')] === '@{constitution_mod}') {
                            return true;
                        }
                        return false;
                    }),
                },
                repeatAttrs = {
                    total: [
                        ['attack', 'total']
                    ],
                    damage_total: [
                        ['attack', 'damage_total'],
                        ['ability', 'damage_total'],
                        ['spell', 'damage_total']
                    ],
                    dc: [
                        ['ability', 'dc'],
                        ['spell', 'dc']
                    ],
                    attack_total: [
                        ['ability', 'attack_total'],
                        ['spell', 'attack_total']
                    ],
                    profession: [
                        ['profession','profession']
                    ],
                    attack: [
                        ['attack', 'total'],
                        ['ability', 'attack_total'],
                        ['spell', 'attack_total']
                    ],
                    damage: [
                        ['attack', 'damage_total'],
                        ['ability', 'damage_total'],
                        ['spell', 'damage_total']
                    ]
                },
                triggerKeys = _.keys(propagatedTriggers),
                repeatKeys = _.reduce(_.keys(attributes), (memo, key) => {
                    key.replace(/(repeating_([^_]+)_[^_]+_).+|_ability$/, (match, p1, p2) => {
                        if (p1) {
                            if (!_.contains(memo[p2], p1)) {
                                memo[p2].push(p1);
                            }
                        }
                        if (/_ability$/.test(match) && /repeating/.test(key)) {
                            memo.abilitySelects.push(match);
                        }
                    });
                    return memo;
                }, {
                    attack: [],
                    condition: [],
                    profession: [],
                    ability: [],
                    spell: [],
                    item: [],
                    abilitySelects: abiSel,
                    buff: []
                });
            while (triggerKeys[0]) {
                let key = triggerKeys.shift();
                let section = propagatedTriggers[key].repeating;
                if (/^(?:strength|dexterity|constitution|intelligence|wisdom|charisma)_mod$/.test(propagatedTriggers[key].attr)) {
                    _.each(repeatKeys.abilitySelects, (as) => {
                        if (new RegExp(key).test(attributes[as])) {
                            as.replace(/(repeating_([^_]+)_[^_]+_)?(.+)/, (match, sectionID, section, attr) => {
                                let objName;
                                if (section) {
                                    objName = section + '|' + attr;
                                } else {
                                    objName = attr;
                                }
                                _.each(objSwitch[attributes.sheet_type][objName].affects, (affect) => {
                                    let affectName
                                    if (sectionID) {
                                        affectName = affect.replace(/.+?\|(.+)/, sectionID + '$1');
                                        if (!_.contains(propagatedTriggers[key].affects, affect)) {
                                            propagatedTriggers[key].affects.push(affectName);
                                        }
                                    } else {
                                        affect.replace(/(?:(.+?)\|)?(.+)/, (match, section, attribute) => {
                                            if (section) {
                                                _.each(_.keys(attributes), (a) => {
                                                    if (new RegExp(`repeating_${section}_[^_]+_${attribute}$`).test(a)) {
                                                        propagatedTriggers[key].affects.push(a);
                                                    }
                                                });
                                            } else {
                                                propagatedTriggers[key].affects.push(affect);
                                            }
                                        });
                                    }
                                });
                            });
                        }
                    });
                }
                _.each(complicatedConditions[propagatedTriggers[key].attr], (filt) => {
                    propagatedTriggers[key].affects = propagatedTriggers[key].affects.concat(filteredSkillDamage[filt]);
                });
                _.each(bonusKeys, (buffTarget) => {
                    if (!propagatedTriggers[buffTarget] && !_.contains(propagatedTriggers[key].affects, buffTarget)) {
                        let trueTarget = [buffTarget.replace(/\|.+/, '')],
                            repeatTarget = repeatAttrs[trueTarget[0]];
                            
                        if (repeatTarget) {
                            trueTarget = _.reduce(repeatTarget, (memo, sectionAttr) => {
                                let sectionIDs = _.map(repeatKeys[sectionAttr[0]], (id) => {
                                    return `${id}${sectionAttr[1]}`;
                                });
                                return memo.concat(sectionIDs);
                            }, []);
                        }
                        _.some(bonus[buffTarget], (buffType) => {
                            return _.some(buffType, (buffValue) => {
                                if (new RegExp('@{' + propagatedTriggers[key].attr + '}').test(buffValue)) {
                                    propagatedTriggers[key].affects = propagatedTriggers[key].affects.concat(trueTarget);
                                    return true;
                                }
                                return false;
                            });
                        });
                    }
                });
                if (section) {
                    _.each(_.range(propagatedTriggers[key].affects.length), (n) => {
                        if (new RegExp(section + '\\|').test(propagatedTriggers[key].affects[n])) {
                            propagatedTriggers[key].affects[n] = propagatedTriggers[key].affects[n].replace(/[^|]+\|(.+)/, key.replace(/(repeating_[^_]+_[^_]+_).+/, '$1') + '$1');
                        }
                    });
                    if (propagatedTriggers[key].repeatAdds) {
                        _.each(_.range(propagatedTriggers[key].repeatAdds.length), (n) => {
                            propagatedTriggers[key].repeatAdds[n] = key.replace(/(repeating_[^_]+_[^_]+_).+/, '$1') + propagatedTriggers[key].repeatAdds[n];
                        });
                    }
                    if (propagatedTriggers[key].repeatTextAdds) {
                        _.each(_.range(propagatedTriggers[key].repeatTextAdds.length), (n) => {
                            propagatedTriggers[key].repeatTextAdds[n] = key.replace(/(repeating_[^_]+_[^_]+_).+/, '$1') + propagatedTriggers[key].repeatTextAdds[n];
                        });
                    }
                    if (propagatedTriggers[key].repeatParseField) {
                        _.each(_.range(propagatedTriggers[key].repeatParseField.length), (n) => {
                            propagatedTriggers[key].repeatParseField[n] = key.replace(/(repeating_[^_]+_[^_]+_).+/, '$1') + propagatedTriggers[key].repeatParseField[n];
                        });
                    }
                } else {
                    propagatedTriggers[key].affects = _.reduce(propagatedTriggers[key].affects, (memo, affect) => {
                        affect.replace(/(?:([^|]+)\|)?(.+)/, (match, section, attr) => {
                            if (section) {
                                memo = memo.concat(_.map(repeatKeys[section], (id) => {
                                    return id + attr
                                }));
                            } else {
                                memo.push(attr);
                            }
                        });
                        return memo;
                    }, []);
                }
                _.each(propagatedTriggers[key].affects, (affect) => {
                    if (!propagatedTriggers[affect]) {
                        affect.replace(/(?:(repeating_([^_]+)_[^_]+_))?(.+)/, (match, sectionID, sectionMatch, attrMatch) => {
                            let objName;
                            if (sectionMatch) {
                                objName = sectionMatch + '|' + attrMatch;
                            } else {
                                objName = attrMatch;
                            }
                            propagatedTriggers[affect] = JSON.parse(JSON.stringify(objSwitch[attributes.sheet_type][objName]));
                            triggerKeys.push(affect);
                            affectedKeys.push(affect);
                        });
                    }
                });
                if (/spell_resistance/.test(key)) {
                    affectedKeys.push(key);
                }
            }
            _.each(affectedKeys, (key) => {
                affected[key] = propagatedTriggers[key];
            });
            return affected;
        },

        oldaffectWhat = function(attributes, trigger, bonus) {
            let index = 0;
            // Need to check buffs
            // Need to handle differing repeating items (e.g. different attack ability)
            do {
                let aObj = currentAttributeObjs[propagatedTriggers[index]];
                if (aObj) {

                    _.each(aObj.affects, (attr) => {
                        if (!_.contains(_.keys(affected), attr)) {
                            affected[attr] = currentAttributeObjs[attr];
                            propagatedTriggers.push(attr);
                        }
                    });
                }
                index++;
            } while (index < propagatedTriggers.length);
            return affected;
        },

        applyBuffs = function(attributes, trigger, bonus, setObj) {
            /*
                This is the workhorse of the sheet. It iterates through all of the attributes contained in the attributeObjs or npcAttributeObjs variable
                to calculate the final value of any given attribute. This function is not used for starships. Currently it iterates through all variables
                regardless of what attribute was changed. I had planned to put logic in to assemble a list of attributes that actually needed to be
                updated based on what was changed, but had not gotten to it yet.
            */
            const objSwitch = {
                    'pc': attributeObjs,
                    'npc': npcAttributeObjs,
                    'ship': {}
                },
                bonusKeys = _.keys(bonus), //Keys of the bonus object
                affected = affectWhat(attributes, trigger, bonus);
            const nonRecursiveEvalKeys = [],
                sortAffected = (keys) => {
                    let key = keys.shift();
                    let insertIndex = 0;
                    _.each(_.range(sortedAffectedKeys.length), (i) => {
                        if (_.contains(affected[sortedAffectedKeys[i]].affects, key)) {
                            insertIndex = i + 1;
                        }
                    });
                    sortedAffectedKeys.splice(insertIndex, 0, key);
                    if (keys[0]) {
                        sortAffected(keys);
                    }
                };

            let bTotal, //total buff
                sectionIDs, //array for all section IDs
                repeatIDs, //Array of the applicable repeating IDs
                rpAbility, //resolve point ability value
                specificBonus, //holds the specific bonus object for the attribute being worked on
                abilityMax, //The maximum ability score to apply
                levelClass = 0,
                spellFilters = [],
                affectedKeys = _.keys(affected),
                sortedAffectedKeys = [];
            affectedKeys = _.reject(affectedKeys, (key) => {
                if ((/^strength$/.test(key) && attributes.sheet_type === 'pc') || /_proficiency|repeating_spell_[^_]+_filter|caster_level|encumber_bulk|overburden_bulk|character_level|bab|(?:ref|will|fort)?_base$|encumber_level|wealth|carried_bulk|asleep|bleeding|blinded|burning|confused|cowering|dazed|dazzled|dead|deafened|dying|encumbered|entangled|exhausted|fascinated|fatigued|flat_footed|frightened|grappled|helpless|nauseated|negative_levels|off_kilter|off_target|overburdened|panicked|paralyzed|pinned|prone|shaken|sickened|stable|staggered|stunned|unconscious/.test(key)) {
                    if (/^strength$|encumber_level|wealth|carried_bulk|encumber_bulk|overburden_bulk|caster_level/.test(key)) {
                        nonRecursiveEvalKeys.push(key);
                    } else if (/repeating_spell_[^_]+_filter/.test(key)) {
                        spellFilters.push(key);
                    }
                    return true;
                } else {
                    return false;
                }
            });
            sortAffected(affectedKeys);
            affectedKeys = _.reject(sortedAffectedKeys, (sak) => {
                return !sak
            });
            /*Caster Class buffing*/
            if ((setObj.is_caster || attributes.is_caster) && setObj.is_caster !== 0 && _.contains(nonRecursiveEvalKeys, 'caster_level')) {
                if (!setObj.caster_level) {
                    const convertProgress = { //object of fat arrow functions that calculates the spell level available for a class
                        'half': (lvl) => lvl >= 13 ? 4 : lvl >= 10 ? 3 : lvl >= 7 ? 2 : lvl >= 4 ? 1 : 0,
                        'partial': (lvl) => lvl >= 16 ? 6 : lvl >= 13 ? 5 : lvl >= 10 ? 4 : lvl >= 7 ? 3 : lvl >= 4 ? 2 : lvl >= 1 ? 1 : 0,
                        'full_prep': (lvl) => Math.min(Math.floor((lvl + 1) / 2), 9),
                        'full_spont': (lvl) => lvl * 1 === 1 ? 1 : Math.floor(lvl / 2)
                    };
                    setObj.caster_level = 0;
                    setObj = _.reduce([1, 2, 3, 4, 5], (memo, n) => {
                        let preClass = 'class_' + n;
                        if (attributes[preClass + '_spells'] * 1 === 1) {
                            memo['caster_level'] += (attributes[preClass + '_level'] * 1 || 0);
                        }
                        return memo;
                    }, setObj);
                    attributes.caster_level = setObj.caster_level;
                }
                if (attributes.caster_level > 0) {
                    bTotal = calcBuffs(attributes, bonus.caster_level, setObj).total;
                    setObj.caster_level = attributes.caster_level + bTotal;
                    setObj.caster_level_change = bTotal > 0 ? 1 : bTotal < 0 ? -1 : 0;
                }
            }
            if (attributes.sheet_type === 'pc') {
                /*Encumbrance*/
                const bulkCost = [];
                let bulkTest = false,
                    wealthTest = false;
                if (_.contains(nonRecursiveEvalKeys, 'carried_bulk')) {
                    setObj.carried_bulk = 0;
                    bulkCost.push('bulk');
                    bulkTest = true;
                }
                if (_.contains(nonRecursiveEvalKeys, 'wealth')) {
                    setObj.wealth = 0;
                    bulkCost.push('cost');
                    wealthTest = true;
                }
                if (bulkTest || wealthTest) {
                    _.each(_.keys(attributes), (a) => {
                        let aMatch = a.match(new RegExp('repeating_item_-[^_]+_(' + bulkCost.join('|') + ')'));
                        if (aMatch) {
                            if (aMatch[1] === 'bulk' && attributes[a.replace(/bulk/, 'equipped')] !== 'not carried') {
                                setObj.carried_bulk = setObj.carried_bulk + ((attributes[a] + '').match(/l/i) ? 0.1 : attributes[a] * 1 || 0) * attributes[a.replace(/bulk/, 'quantity')] || 0;
                            } else if (aMatch[1] === 'cost') {
                                setObj.wealth = setObj.wealth + (attributes[a] * 1 || 0) * attributes[a.replace(/cost/, 'quantity')] || 0;
                            }
                        }
                    });
                    if (bulkTest) {
                        setObj.carried_bulk = Math.floor(setObj.carried_bulk) || 0;
                        attributes.carried_bulk = setObj.carried_bulk;
                    }
                }
                _.each(spellFilters, (filter) => {
                    let sLevel = attributes[filter.replace(/filter/, 'level')];
                    setObj[filter] = sLevel * 1 ? Math.min(Math.max(sLevel, 1), 9) : 'cantrip';
                });
                if (_.contains(nonRecursiveEvalKeys, 'strength')) {
                    /*strength handling*/
                    //Strength calculations are not included in the iteration further down due to their effect on carry weight
                    specificBonus = calcBuffs(attributes, bonus.strength, setObj); //Converts specific Bonus to the calculated object.
                    bTotal = specificBonus.total; //sets bTotal to the total value from specificBonus
                    setObj.strength = (attributes.strength_base * 1 || 0) - (Math.abs(attributes.strength_drain * 1 || 0)) + bTotal;
                    attributes.strength = setObj.strength;
                    setObj.strength_misc = specificBonus.misc;
                    setObj.strength_change = bTotal > 0 ? 1 : (bTotal < 0 ? -1 : 0);
                }
                const strength_track = _.chain(_.keys(attributes))
                    .filter((attr) => {
                        return /_condition_[^_]+_track/.test(attr) && attributes[attr] === 'strength_track';
                    })
                    .reduce((memo, attr) => {
                        if (attributes[attr + '_status'] !== 'healthy') {
                            if (attributes[attr + '_status'] !== 'weakened') {
                                memo = 3;
                            } else {
                                memo = Math.max(memo, 2);
                            }
                        }
                        return memo;
                    }, 1)
                    .value();
                if (_.contains(nonRecursiveEvalKeys, 'encumber_bulk')) {
                    bTotal = calcBuffs(attributes, bonus.encumber_bulk, setObj).total;
                    if (strength_track * 1 > 1) {
                        setObj.encumber_bulk = 0;
                        setObj.encumber_bulk_change = -1;
                    } else {
                        setObj.encumber_bulk = Math.floor(attributes.strength / 2) + 1 + bTotal;
                        setObj.encumber_bulk_change = bTotal > 0 ? 1 : (bTotal < 0 ? -1 : 0);
                    }
                    attributes.encumber_bulk = setObj.encumber_bulk;
                }
                if (_.contains(nonRecursiveEvalKeys, 'overburden_bulk')) {
                    if (strength_track * 1 > 1) {
                        setObj.overburden_bulk = Math.max(Math.floor(((attributes.strength * 1 || 0) + bTotal) / 3), 1);
                        setObj.overburden_bulk_change = -1;
                    } else {
                        bTotal = calcBuffs(attributes, bonus.overburden_bulk, setObj).total;
                        setObj.overburden_bulk = (attributes.strength * 1 || 0) + bTotal;
                        setObj.overburden_bulk_change = bTotal > 0 ? 1 : (bTotal < 0 ? -1 : 0);
                    }
                    attributes.overburden_bulk = setObj.overburden_bulk;
                }
                if (_.contains(nonRecursiveEvalKeys, 'encumber_level')) {
                    if (strength_track === 1) {
                        setObj.encumber_level = Math.min(Math.floor(attributes.carried_bulk / attributes.encumber_bulk || 0), 1) + Math.min(Math.floor(attributes.carried_bulk / attributes.overburden_bulk || 0), 1);
                    } else if (strength_track < 3) {
                        setObj.encumber_level = 1 + Math.min(Math.floor(attributes.carried_bulk / attributes.overburden_bulk || 0), 1);
                    } else {
                        setObj.encumber_level = 2;
                    }
                    if (setObj.encumber_level > 0) {
                        bonus.eac = bonus.eac || {};
                        bonus.kac = bonus.kac || {};
                        bonus.eac.max_dex = bonus.eac.max_dex || [];
                        bonus.kac.max_dex = bonus.kac.max_dex || [];
                        bonus.acp = bonus.acp || {
                            acp: []
                        };
                        bonus.acp.acp.push(-5);
                        if (setObj.encumber_level > 1) {
                            bonus.eac.max_dex.push(0);
                            bonus.kac.max_dex.push(0);
                        } else {
                            bonus.eac.max_dex.push(2);
                            bonus.kac.max_dex.push(2);
                        }
                    }
                }
            }
            _.each(affectedKeys, (key) => {
                TAS.log(`updating key: ${key}`);
                let id = '';
                if(attributes[key.replace(/mod/,'base')]!=='-'&&attributes[key.replace(/mod/,'base')]!=='0[-]'){
                    key.replace(/repeating_[^_]+_[^_]+_/, (match) => {
                        id = match;
                    });
                    if (/_dc/.test(key) && /sp/i.test(attributes[id + 'type'])) {
                        affected[key].attrAdds = [];
                        affected[key].multAdds = [];
                        affected[key].repeatAdds = [id + 'level'];
                    }
                    if (key === 'rp_max') { //The rp attribute has special handling
                        if (attributes.resolve_source === 'key') { //RAW RP calculation
                            rpAbility = _.reduce([1, 2, 3, 4, 5], (m, n) => {
                                if (attributes['class_' + n + '_level'] > 0) {
                                    m = _.max([m, attributes[attributes['class_' + n + '_ability'].replace(/@{|}/g, '')] * 1]);
                                }
                                return m;
                            }, 0);
                        } else { //Homebrew Calculation
                            rpAbility = _.max([attributes.strength_mod, attributes.dexterity_mod, attributes.constitution_mod, attributes.intelligence_mod, attributes.wisdom_mod, attributes.charisma_mod, 0], (v) => {
                                return v * 1
                            });
                        }
                    } else { //if affected[key].attr is not rp_max, rpAbility is 0
                        rpAbility = 0;
                    }
                    bTotal = 0; //reset bTotal
                    let attributeMod;
                    if (attributes.sheet_type === 'pc') {
                        attributeMod = _.reduce([attributes[(attributes[id + affected[key].ability] + '').replace(/@{|}/g, '')] * 1, rpAbility * 1], (m, a) => {
                            if ((a || a === 0) && m === '') {
                                m = a;
                            }
                            return m;
                        }, ''); //Set the mod score of the relevant attribute
                    } else {
                        const abiSwap = {
                            ref: 'dexterity_mod',
                            fort: 'constitution_mod',
                            will: 'wisdom_mod',
                            eac: 'dexterity_mod',
                            kac: 'dexterity_mod',
                            cmd: 'dexterity_mod',
                            initiative: 'dexterity_mod',
                            [`[[@{strength_mod}-@{strength_base}]]`]:'strength_mod',
                            [`[[@{dexterity_mod}-@{dexterity_base}]]`]:'dexterity_mod',
                            [`[[@{constitution_mod}-@{constitution_base}]]`]:'constitution_mod',
                            [`[[@{intelligence_mod}-@{intelligence_base}]]`]:'intelligence_mod',
                            [`[[@{wisdom_mod}-@{wisdom_base}]]`]:'wisdom_mod',
                            [`[[@{charisma_mod}-@{charisma_base}]]`]:'charisma_mod '
                        };
                        let abi;
                        if (affected[key].ability === 'abi') {
                            abi = abiSwap[key];
                        } else {
                            if(/\[\[/.test(attributes[`${id}${affected[key].ability}`])){
                                abi = abiSwap[attributes[`${id}${affected[key].ability}`]];
                            }else{
                                abi = (attributes[id + affected[key].ability] + '').replace(/@{|}/g, '');
                            }
                        }
                        if (/_ranks|base_attack_bonus$/.test(key)) {
                            abi = abi.replace(/_mod/, '_base');
                            if (/_ranks/.test(key) && attributes[key.replace(/_ranks/, '')]) {
                                attributeMod = 0;
                            } else {
                                attributeMod = attributes[abi] * -1 || 0;
                            }
                        } else {
                            attributeMod = ((attributes[abi] * 1 || 0) - (attributes[abi.replace(/_mod/, '_base')] * 1 || 0));
                        }
                    }
                    if (affected[key].moddable || affected[key].rollTime) {
                        specificBonus = bonus[key.replace(/repeating_[^_]+_[^_]+_/, '').replace(/spell_resistance/, 'spell_penetration')] || {}; //assign specificBonus to the relevant bonus object or an empty object
                        _.each(bonusKeys, (k) => { //Looks for special bonus keywords like attack and damage, and looks for special filtering of buffs
                            if (k.startsWith(key.replace(/repeating_[^_]+_[^_]+_/, '') + '|') || (k.startsWith('attack') && /repeating_[^_]+_[^_]+_(?:attack_)?total/.test(key)) || (k.startsWith('damage') && /damage_total$/.test(key))) {
                                /*Handling for filtering application of buffs to attributes based on filtering syntax.
                                                                                                                                                                                                                Looks for bonus keys that start with the relevant attribute name with the | after it or special attack/damage syntax*/
                                let kSplit = k.replace(/[^|]+\|/, '').split(/\s*,\s*/g); //remove the non filtering text from the bonus key and split the objects to filter by into their separate keys
                                let objSpec = _.reduce(kSplit, (m, s) => {
                                    let sSplit = s.split(/:/); //separate the name of the attribute to filter by from the value to look for
                                    if (sSplit[1]) {
                                        m[sSplit[0]] = sSplit[1]; //undo the earlier handling for spaces
                                    }
                                    return m;
                                }, {});
                                if (_.isEmpty(objSpec) || _.every(_.keys(objSpec), (os) => {
                                        if (os.toLowerCase() === 'section') {
                                            return affected[key].repeating.toLowerCase() === objSpec[os.toLowerCase()].toLowerCase();
                                        } else {
                                            return (setObj[id + os] ? (setObj[id + os] + '').toLowerCase() === objSpec[os].toLowerCase() : (attributes[id + os] + '').toLowerCase() === objSpec[os].toLowerCase());
                                        }
                                    })) { //Check to see if the current attribute matches the filtering
                                    _.each(_.keys(bonus[k]), (sk) => { //iterate through the keys of the bonus types for the attribute in question
                                        specificBonus[sk] = specificBonus[sk] || []; //Default the array of the bonuses for this type to an array if it doesn't already exist
                                        specificBonus[sk] = specificBonus[sk].concat(bonus[k][sk]); //Concatenate the current bonuses of a given type with the new array of bonuses for that type
                                    });
                                }
                            }
                        });
                        if (attributes[id + (affected[key].repeating ? 'acp' : key + '_acp')] * 1 === 1) { //if there is an attribute for acp
                            specificBonus.acp = bonus.acp ? bonus.acp.acp : 0; //set the acp key of specificBonus to the acp array from bonus
                        }
                        specificBonus = calcBuffs(attributes, specificBonus, setObj, key === 'acrobatics' ? true : false); //Convert the specificBonus object to an object of the calculated bonuses
                        if (affected[key].rollTime) {
                            setObj[key.replace(/total$|profession$|_npc|spell_resistance/, '') + affected[key].rollTime] = specificBonus.misc || ''; //set the attribute for holding rollTime evaluation macros of bonuses
                        }
                        abilityMax = _.min([attributeMod, specificBonus.max_dex * 1, (attributes.dexterity_track * 1 > 2 ? 0 : undefined)]); //figures the maximum ability to be applied
                        let abilityDiff = abilityMax - attributeMod; //if this is negative, and overwhelms any bonuses, the attr is formatted for penalty
                        bTotal = specificBonus.total + (/eac|kac/.test(key) ? 0 : specificBonus.armor * 1 || 0);
                        if (affected[key].moddable) {
                            setObj[key.replace(/_max|_profession$/, '') + affected[key].moddable] = (bTotal + abilityDiff) > 0 ? 1 : ((bTotal + abilityDiff) < 0 ? -1 : 0);
                        }
                    } else {
                        abilityMax = attributeMod; //abilityMax defaults to attributeMod if not moddable
                    }
                    //assemble the numerical values of the attribute
                    if (!/spell_resistance/.test(key)) {
                        let memoNum = _.reduce(affected[key].repeatParseField, (m, add) => { //Handles fields that will have macro syntax in them
                                let calculated = calcBuffs(attributes, {
                                    untyped: [attributes[add]]
                                }, setObj).total
                                return m + calculated;
                            }, 0) //add the value of the parse field
                            +
                            abilityMax //add the maximum ability score
                            +
                            (affected[key].numAdds || 0); //add any flat numbers that should be added to the attribute
                        memoNum += _.reduce(_.range(affected[key].attrAdds.length), (m, add) => { //iterate through all the attributes to add to the attribute and add their numerical values
                            let csMatch = affected[key].attrAdds[add].match('class_skill');
                            levelClass = 0;
                            if (affected[key].attr === 'dc' && affected[key].attrAdds[add] === 'lvl') { //if the attribute is the dc, or attrAdds of the obj is "lvl"
                                if (affected[key].repeating === 'ability') { //if the repeating section is "ability"
                                    levelClass = _.reduce([1, 2, 3, 4, 5], (mem, n) => { //iterate through all the classes
                                        if (attributes['class_' + n + '_name'].toLowerCase() === attributes[id + 'source'].toLowerCase()) { //check if the name of the class is the same as the source of the section in question
                                            mem = attributes['class_' + n + '_level'] * 1 || 0; //set the memo to the level of this class (There should only ever be one match, so there is no handling for multiple matches)
                                        }
                                        if (n === 5 && mem === 0) { //check if all the classes have been iterated through already and no level has already been recognized (This should never be 0)
                                            mem = attributes.character_level; //set mem to the total character_level
                                        }
                                        return mem;
                                    }, 0);
                                }
                            }
                            if (attributes.sheet_type === 'npc' && affected[key].isSkill) { //handling for npc skills
                                if (attributes[affected[key].attrAdds[add]] * 1) { //otherwise add it to m
                                    m += (attributes[affected[key].attrAdds[add]] * 1 || 0) - (rpAbility * 1 || 0);
                                }
                            } else if (!csMatch || attributes[affected[key].attrAdds[add].replace(/class_skill/, 'ranks')] * 1 > 0) { //if the attribute being added is either not a class skill attribute or the skill's ranks are at least 1
                                if (affected[key].attrAdds[add].match(/(?:strength|dexterity|constitution|intelligence|wisdom|charisma)_(?:penalty|drain)/)) { //special calculation for penalty/drain
                                    m -= Math.abs(Math.floor((attributes[affected[key].attrAdds[add]] * 1 || levelClass || 0) * (affected[key].multAdds[add] * 1 || attributes[affected[key].multAdds[add]] * 1 || 1)));
                                } else { //otherwise add the value to m
                                    m += Math.floor((attributes[affected[key].attrAdds[add]] * 1 || levelClass || 0) * (affected[key].multAdds[add] * 1 || attributes[affected[key].multAdds[add]] * 1 || 1));
                                }
                            }
                            return m;
                        }, 0);
                        memoNum += _.reduce(affected[key].repeatAdds, (m, add) => { //iterate through all of the attributes internal to the repeating section to add
                                let csMatch = add.match('class_skill');
                                if (!csMatch || attributes[add.replace(/class_skill/, 'ranks')] * 1 > 0) { //This is the same handling for class skills as seen above
                                    m += (attributes[add] * 1 || 0);
                                }
                                return m;
                            }, 0) +
                            bTotal //add the total numerical value of the bonus for the attribute
                            +
                            _.reduce(affected[key].addlBonus, (m, add) => { //add any additional bonuses to the attribute (bonuses not specifically called out to this attribute)
                                return m + (specificBonus[add] * 1 || 0);
                            }, 0);
                        //assembles the text values of the attribute
                        let memoText = _.reduce(affected[key].repeatTextAdds, (m, add) => { //iterate through all of the attributes within the repeating item that should hold text
                            return m + (attributes[add] || '')
                        }, '') + _.reduce(affected[key].textAdds, (m, add) => { //iterate through all of the attributes within the repeating item that should hold text
                            return m + (attributes[add] || '')
                        }, '');
                        if (key.match(/_filter/) && affected[key].repeating === 'spell') { //handling for the filtering attribute for spells
                            setObj[key] = Math.min(Math.max(attributes[key] * 1 || 0, 0), 9); //set the filter attribute to the level of the spell or to 0 if no level parsed
                            setObj[key] = attributes[key] * 1 === 0 ? 'cantrip' : attributes[key];
                        } else if (/repeating_(?:attack|spell|ability)_[^_]+_(?:damage_)?total/.test(key)) {
                            if (attributes.sheet_type === 'pc' && /repeating_attack/.test(key)) {
                                if (attributes[id + 'proficiency'] === 'no') { //setting the prof value to -4 when not prof
                                    setObj[id + 'proficiency_value'] = -4;
                                    setObj[id + 'damage_proficiency_value'] = 0;
                                    attributes[id + 'proficiency_value'] = setObj[id + 'proficiency_value'];
                                    attributes[id + 'damage_proficiency_value'] = setObj[id + 'damage_proficiency_value'];
                                } else if (attributes[id + 'proficiency'] === 'specialized') { //setting the damage prof value to level or half level (depending on weapon type or weapon special properties) if specialized
                                    setObj[id + 'proficiency_value'] = 0;
                                    attributes[id + 'proficiency_value'] = setObj[id + 'proficiency_value'];
                                    if (_.some(attributes.half_specializations.toLowerCase().split(/,|\n+/), (half) => {
                                            return attributes[id + 'category'].toLowerCase().match(half) || attributes[id + 'special'].toLowerCase().match(half);
                                        })) {
                                        setObj[id + 'damage_proficiency_value'] = Math.floor((attributes.character_level * 1) / 2);
                                        attributes[id + 'proficiency_value'] = setObj[id + 'proficiency_value'];
                                    } else {
                                        setObj[id + 'damage_proficiency_value'] = attributes.character_level * 1;
                                        attributes[id + 'damage_proficiency_value'] = setObj[id + 'damage_proficiency_value'];
                                    }
                                } else {
                                    setObj[id + 'proficiency_value'] = 0;
                                    setObj[id + 'damage_proficiency_value'] = 0;
                                    attributes[id + 'proficiency_value'] = setObj[id + 'proficiency_value'];
                                    attributes[id + 'damage_proficiency_value'] = setObj[id + 'damage_proficiency_value'];
                                }
                                memoNum += setObj[id + (/repeating_[^_]+_[^_]+_total/.test(key) ? 'proficiency_value' : 'damage_proficiency_value')] * 1 || 0;
                            }
                        }
                        memoNum = memoNum || 0;
                        if (key === 'dexterity_mod' && (attributes.helpless * 1 === 1 || attributes.paralyzed * 1 === 1)) {
                            memoNum = -5;
                        } else if (/intelligence/.test(key)) {
                            let intelligence_tracks = _.filter(_.keys(attributes), (cond) => {
                                return /_track_status$/.test(cond) && attributes[cond.replace(/_status/, '')] === 'intelligence_track';
                            });
                            if (_.every(intelligence_tracks, (track) => {
                                    return /healthy|weakened|impaired/.test(attributes[track])
                                })) {
                                setObj.intelligence_change = setObj.intelligence_change || 0;
                            } else {
                                if (key === 'intelligence' && attributes.sheet_type === 'pc') {
                                    memoNum = 1;
                                    setObj.intelligence_change = -1;
                                } else if (key === 'intelligence_mod' && attributes.sheet_type === 'npc') {
                                    memoNum = -5;
                                    setObj.intelligence_change = -1;
                                }
                            }
                        }
                        memoText = memoText || '';
                        setObj[key] = (memoText + ' +' + memoNum).replace(/(.+)\s+\+\s*0/, '$1');
                        if (!/_total$/.test(key) || affected[key].repeating !== 'attack') {
                            setObj[key] = setObj[key].replace(/^\s*\+/, '');
                        }
                        setObj[key] = setObj[key].replace(/\+\-/g, '-');
                        if (!/(?:rp|sp|hp)_max/.test(key)) {
                            attributes[key] = setObj[key];
                        }
                    }
                }else{
                    setObj[key] = 0;
                    setObj[key.replace(/mod/,'base')]='0[-]';
                    attributes[key] = 0;
                    attributes[key.replace(/mod/,'base')] = '0[-]';
                }
            });
            if (attributes.sheet_type === 'pc') {
                //calculates the skill points used and available
                let skillRanks = _.filter(_.keys(attributes), (a) => {
                    return a.match(/_ranks/)
                });
                setObj.skill_points = _.reduce(skillRanks, (memo, r) => {
                    return memo + (attributes[r] * 1 || 0);
                }, 0);
                if (attributes.drone * 1 === 1) { //handling for when the sheet is a pc drone
                    if (setObj.sp_max) {
                        setObj.sp_max = 0;
                    }
                    if (setObj.hp_max) {
                        setObj.hp_max = _.reduce(_.range(1, (setObj.character_level * 1 || attributes.character_level * 1 || 0) + 1), (memo, l) => {
                            return memo + 10 * (1 + Math.floor(l / 18));
                        }, 0);
                    }
                    if (setObj.rp_max) {
                        setObj.rp_max = 0;
                    }
                } else if (setObj.rp_max) {
                    setObj.rp_max = Math.max((setObj.rp_max * 1 + Math.max(Math.floor((setObj.character_level * 1 || attributes.character_level * 1 || 0) / 2), 1)), 1);
                }
                _.each(['sp', 'hp', 'rp', 'temp_hp'], (p) => {
                    if (setObj[p + '_max'] || setObj[p + '_max'] === 0) {
                        setObj[p] = Math.max(Math.min((attributes[p] * 1 || 0) + ((setObj[p + '_max'] * 1 || 0) - (attributes[p + '_max'] || 0)), (setObj[p + '_max'] * 1 || 0)), 0);
                    }
                });
            }
            storeInfo(attributes);
            setObj = buildMenus(attributes, setObj); //build the menus
            setAttrs(setObj,silent);
        },

        dropObjs = {
            /*sheet_attribute:{
                data:[array of data keys to add/concatenate],
                propagates_to:[array of sheet attributes that the final calculated value propagates to],
                default_adds:[array of arrays, each array contains a sheet attribute or raw value to add and a multiplier],
                default_value:what value to use if there isn't a data attribute passed},*/
            npc: {
                //sheet_attribute:{data:[array of data keys to add/concatenate],propagates_to:[array of sheet attributes that the final calculated value propagates to],default_adds:[array of arrays, each array contains a sheet attribute or raw value to add and a multiplier],default_value:what value to use if there isn't a data attribute passed},
                character_name: {
                    data: ['name'],
                    default_value: ''
                },
                tab_select: {
                    default_value: 0
                },
                character_level: {
                    data: ['cr'],
                    default_value: ''
                },
                xp: {
                    data: ['xp'],
                    default_value: ''
                },
                race: {
                    data: ['race', 'creature type graft', 'class grafts', 'other grafts'],
                    joiner: ' ',
                    default_value: ''
                },
                alignment: {
                    data: ['alignment'],
                    default_value: ''
                },
                size: {
                    data: ['size'],
                    translator: {
                        Fine: -4,
                        Diminutive: -3,
                        Tiny: -2,
                        Small: -1,
                        Medium: 0,
                        Large: 1,
                        Huge: 2,
                        Colossal: 3,
                        Gargantuan: 4
                    },
                    default_value: 'Medium'
                },
                type_subtype: {
                    data: ['type (subtype)'],
                    default_value: ''
                },
                initiative_base: {
                    data: ['initiative'],
                    propagates_to: ['initiative'],
                    default_value: 0
                },
                senses: {
                    data: ['senses'],
                    propagates_to: [],
                    default_value: ''
                },
                aura: {
                    data: ['aura'],
                    propagates_to: [],
                    default_value: ''
                },
                hp: {
                    data: ['hp'],
                    propagates_to: ['hp_max'],
                    default_value: 0
                },
                rp: {
                    data: ['rp'],
                    propagates_to: ['rp_max'],
                    default_value: 0
                },
                eac_base: {
                    data: ['eac'],
                    propagates_to: ['eac'],
                    default_value: 10
                },
                kac_base: {
                    data: ['kac'],
                    propagates_to: ['kac'],
                    default_value: 10
                },
                cmd_base: {
                    data: ['cmd'],
                    propagates_to: ['cmd'],
                    default_adds: [
                        ['kac_base', 1],
                        [8, 1]
                    ],
                    default_value: 0
                },
                ac_notes: {
                    data: ['ac-notes'],
                    propagates_to: [],
                    default_value: ''
                },
                fort_base: {
                    data: ['fort'],
                    propagates_to: ['fort'],
                    default_value: 0
                },
                ref_base: {
                    data: ['ref'],
                    propagates_to: ['ref'],
                    default_value: 0
                },
                will_base: {
                    data: ['will'],
                    propagates_to: ['will'],
                    default_value: 0
                },
                save_notes: {
                    data: ['save-notes'],
                    propagates_to: [],
                    default_value: ''
                },
                defensive_abilities: {
                    data: ['defensive-abilities'],
                    propagates_to: [],
                    default_value: ''
                },
                dr: {
                    data: ['dr'],
                    propagates_to: [],
                    default_value: ''
                },
                immunities: {
                    data: ['immunities'],
                    propagates_to: [],
                    default_value: ''
                },
                sr: {
                    data: ['sr'],
                    propagates_to: [],
                    default_value: 0
                },
                resistances: {
                    data: ['resistances'],
                    propagates_to: [],
                    default_value: ''
                },
                weaknesses: {
                    data: ['weaknesses'],
                    propagates_to: [],
                    default_value: ''
                },
                speed: {
                    data: ['speed'],
                    propagates_to: [],
                    default_value: ''
                },
                offensive_abilities: {
                    data: ['offensive abilities'],
                    propagates_to: [],
                    default_value: ''
                },
                space: {
                    data: ['space'],
                    propagates_to: [],
                    default_value: ''
                },
                reach: {
                    data: ['reach'],
                    propagates_to: [],
                    default_value: ''
                },
                caster_level: {
                    data: ['spell caster level'],
                    propagates_to: [],
                    default_value: 0
                },
                melee_spell_attack: {
                    data: ['melee spell attack'],
                    propagates_to: [],
                    default_value: 0
                },
                ranged_spell_attack: {
                    data: ['ranged spell attack'],
                    propagates_to: [],
                    default_value: 0
                },
                spell_like_caster_level: {
                    data: ['spell-like caster level'],
                    propagates_to: [],
                    default_value: 0
                },
                melee_spell_like_attack: {
                    data: ['melee spell attack'],
                    propagates_to: [],
                    default_value: 0
                },
                ranged_spell_like_attack: {
                    data: ['ranged spell attack'],
                    propagates_to: [],
                    default_value: 0
                },
                strength_base: {
                    data: ['strength mod'],
                    propagates_to: ['strength_mod'],
                    default_value: 0
                },
                dexterity_base: {
                    data: ['dexterity mod'],
                    propagates_to: ['dexterity_mod'],
                    default_value: 0
                },
                constitution_base: {
                    data: ['constitution mod'],
                    propagates_to: ['constitution_mod'],
                    default_value: 0
                },
                intelligence_base: {
                    data: ['intelligence mod'],
                    propagates_to: ['intelligence_mod'],
                    default_value: 0
                },
                wisdom_base: {
                    data: ['wisdom mod'],
                    propagates_to: ['wisdom_mod'],
                    default_value: 0
                },
                charisma_base: {
                    data: ['charisma mod'],
                    propagates_to: ['charisma_mod'],
                    default_value: 0
                },
                acrobatics_base: {
                    data: ['acrobatics'],
                    propagates_to: ['acrobatics'],
                    default_value: 0
                },
                athletics_base: {
                    data: ['athletics'],
                    propagates_to: ['athletics'],
                    default_value: 0
                },
                bluff_base: {
                    data: ['bluff'],
                    propagates_to: ['bluff'],
                    default_value: 0
                },
                computers_base: {
                    data: ['computers'],
                    propagates_to: ['computers'],
                    default_value: 0
                },
                culture_base: {
                    data: ['culture'],
                    propagates_to: ['culture'],
                    default_value: 0
                },
                diplomacy_base: {
                    data: ['diplomacy'],
                    propagates_to: ['diplomacy'],
                    default_value: 0
                },
                disguise_base: {
                    data: ['disguise'],
                    propagates_to: ['disguise'],
                    default_value: 0
                },
                engineering_base: {
                    data: ['engineering'],
                    propagates_to: ['engineering'],
                    default_value: 0
                },
                intimidate_base: {
                    data: ['intimidate'],
                    propagates_to: ['intimidate'],
                    default_value: 0
                },
                life_science_base: {
                    data: ['life science'],
                    propagates_to: ['life_science'],
                    default_value: 0
                },
                medicine_base: {
                    data: ['medicine'],
                    propagates_to: ['medicine'],
                    default_value: 0
                },
                mysticism_base: {
                    data: ['mysticism'],
                    propagates_to: ['mysticism'],
                    default_value: 0
                },
                perception_base: {
                    data: ['perception'],
                    propagates_to: ['perception'],
                    default_value: 0
                },
                physical_science_base: {
                    data: ['physical science'],
                    propagates_to: ['physical_science'],
                    default_value: 0
                },
                piloting_base: {
                    data: ['piloting'],
                    propagates_to: ['piloting'],
                    default_value: 0
                },
                sense_motive_base: {
                    data: ['sense motive'],
                    propagates_to: ['sense_motive'],
                    default_value: 0
                },
                sleight_of_hand_base: {
                    data: ['sleight of hand'],
                    propagates_to: ['sleight_of_hand'],
                    default_value: 0
                },
                stealth_base: {
                    data: ['stealth'],
                    propagates_to: ['stealth'],
                    default_value: 0
                },
                survival_base: {
                    data: ['survival'],
                    propagates_to: ['survival'],
                    default_value: 0
                },
                feats: {
                    data: ['feats'],
                    default_value: ''
                },
                languages: {
                    data: ['languages'],
                    default_value: ''
                },
                other_abilities: {
                    data: ['other abilities'],
                    default_value: ''
                },
                gear: {
                    data: ['gear'],
                    default_value: ''
                },
                environment: {
                    data: ['environment'],
                    default_value: ''
                },
                organization: {
                    data: ['organization'],
                    default_value: ''
                },
                tactics: {
                    data: ['tactics'],
                    default_value: ''
                },
            },
            equipment: {
                name: {
                    data: ['name'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                level: {
                    data: ['level'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: 0
                },
                quantity: {
                    data: ['quantity'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: 0
                },
                bulk: {
                    data: ['bulk'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                cost: {
                    data: ['cost'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: 0
                },
                mods: {
                    data: ['data-mods'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                usage:{
                    data: ['usage'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                special:{
                    data: ['special'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                }
            },
            weapon: {
                name: {
                    data: ['name'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                damage_dice: {
                    data: ['damage dice'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                type: {
                    data: ['damage type'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                special: {
                    data: ['special'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                level: {
                    data: ['level'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                range: {
                    data: ['range'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                crit: {
                    data: ['crit'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
            },
            ability: {
                mods: {
                    data: ['data-mods'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                }
            },
            spell: {
                name: {
                    data: ['name'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                damage_dice: {
                    data: ['Damage Dice'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                damage_type: {
                    data: ['Damage Type'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                range: {
                    data: ['Range'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                base_attack_bonus: {
                    data: [],
                    propagates_to: [],
                    default_adds: [
                        ['bab', 1]
                    ],
                    default_value: 0
                },
                duration: {
                    data: ['Duration'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                description: {
                    data: ['Description','Benefit'],
                    joiner: '\nBenefit:\n',
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                usage: {
                    data: ['Casting Time', 'usage'],
                    joiner: '',
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                school: {
                    data: ['School'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                target: {
                    data: ['Targets Effect Area'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                level: {
                    data: ['Classes'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: 0
                },
                save_type: {
                    data: ['Saving Throw'],
                    translator: {
                        Reflex: 'ref-save',
                        Fortitude: 'fort-save',
                        Will: 'will-save'
                    },
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                save_effect: {
                    data: ['Save Effect'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                type: {
                    data: ['ability-type'],
                    propagates_to: [],
                    translator: {
                        ex: 'EX',
                        su: "SU",
                        sp: 'SP'
                    },
                    default_adds: [],
                    default_value: ''
                },
                uses_max: {
                    data: ['uses-max'],
                    propagates_to: ['uses'],
                    default_adds: [],
                    default_value: ''
                },
                attack_crit: {
                    data: ['critical-effect'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                effect: {
                    data: ['Fail Effect'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
                frequency: {
                    data: ['Frequency'],
                    propagates_to: [],
                    default_adds: [],
                    default_value: ''
                },
            },
        },

        dropHandler = function(event) {
            let category = event.newValue;
            const categorySwitch = {
                    NPCs: npcDropHandler,
                    Equipment: equipmentDropHandler,
                    Spells: spellAndAbilityDropHandler,
                    Feats: spellAndAbilityDropHandler,
                    Classes: spellAndAbilityDropHandler
                },
                dropSkillList = _.reject(skillList, (skill) => {
                    return skill === 'profession'
                }),
                attributeNames = sheetAttributes.concat(['drop_name', 'drop_category', 'drop_data', 'drop_content', 'drop_header']),
                setObj = {};
                
            TAS.log(`Drop Category Change: ${JSON.stringify(event)}`);
            getAttrs(attributeNames, (dropValues) => {
                dropValues.drop_data = JSON.parse(dropValues.drop_data);
                dropValues.drop_data.name = dropValues.drop_name;
                dropValues.drop_data.content = dropValues.drop_content;
                dropValues.drop_data.header = dropValues.drop_header;
                setAttrs({
                    drop_name: '',
                    drop_category: '',
                    drop_data: '',
                    drop_content: '',
                    drop_header: ''
                }, {
                    silent: true
                });
                categorySwitch[category](dropValues, setObj);
            });
        },
        
        npcDropHandler = function(attributes, setObj) {
            const data = attributes.drop_data,
                dropSkillList = _.reject(skillList, (skill) => {
                    return skill === 'profession'
                });
                
            TAS.log(`drop_data:`);
            TAS.log(data);
            setObj.sheet_type = 'npc';
            attributes.sheet_type = 'npc';
            
            _.each(_.keys(dropObjs.npc), (attr) => {
                setObj[attr] = _.reduce(dropObjs.npc[attr].data, (memo, dataKey) => {
                    let iterativeAdd = data[dataKey] || dropObjs.npc[attr].default_value;
                    if (typeof dropObjs.npc[attr].default_value === 'number') {
                        iterativeAdd = iterativeAdd * 1 || dropObjs.npc[attr].default_value;
                    } else if (dropObjs.npc[attr].joiner) {
                        iterativeAdd += dropObjs.npc[attr].joiner;
                    }
                    return memo += iterativeAdd;
                }, (typeof dropObjs.npc[attr].default_value === 'number' ? 0 : ''));
                if (setObj[attr] === dropObjs.npc[attr].default_value) {
                    _.each(dropObjs.npc[attr].default_adds, (add) => {
                        if (typeof add[0] === 'string') {
                            setObj[attr] += setObj[add[0]] * add[1];
                        } else {
                            setObj[attr] += add[0] * add[1];
                        }
                    });
                }
                if (dropObjs.npc[attr].translator) {
                    setObj[attr] = dropObjs.npc[attr].translator[setObj[attr]];
                }
                if (typeof setObj[attr] === 'string') {
                    setObj[attr] = setObj[attr].trim();
                }
                _.each(dropObjs.npc[attr].propagates_to, (prop) => {
                    setObj[prop] = setObj[attr];
                });
            });
            let squareSize = 70;
            if (setObj.size * 1 + 1 >= 0) {
                squareSize = (setObj.size * 1 + 1) * 70 || 70;
            } else if (setObj.size * 1 < 0) {
                squareSize = 35;
            }
            setDefaultToken({
                bar1_value: setObj.sp,
                bar1_max: setObj.sp_max,
                bar3_value: setObj.hp,
                bar3_max: setObj.hp_max,
                bar2_value: setObj.rp*1||'',
                bar2_max: setObj.rp_max*1||'',
                showname: true,
                width: squareSize,
                height: squareSize
            });
            _.each(dropSkillList, (skill) => {
                if (setObj[`${skill}_base`] * 1 === 0) {
                    setObj[`${skill}_ranks`] = 0;
                    setObj[`${skill}`] = setObj[attributes[`${skill}_ability`].replace(/@{|}/g, '')];
                    setObj[`${skill}_base`] = setObj[attributes[`${skill}_ability`].replace(/@{|}/g, '')];
                } else {
                    setObj[`${skill}_ranks`] = setObj[`${skill}_base`] * 1 - setObj[attributes[`${skill}_ability`].replace(/@{|}/g, '')] * 1 || 0;
                }
            });
            if(data['data-profession']){
                TAS.log(`processing Professions`);
                data['data-profession']=JSON.parse(data['data-profession']);
                _.each(data['data-profession'],(profObj)=>{
                    let rowID = generateRowID();
                    setObj[`repeating_profession_${rowID}_name`]=profObj.name||'';
                    setObj[`repeating_profession_${rowID}_id`]=rowID;
                    if(profObj.mod*1===0){
                        setObj[`repeating_profession_${rowID}_ranks`]=0;
                        setObj[`repeating_profession_${rowID}_profession`]=setObj.intelligence_mod;
                        setObj[`repeating_profession_${rowID}_base`]=setObj.intelligence_mod;
                    }else{
                        setObj[`repeating_profession_${rowID}_base`]=profObj.mod||0;
                        setObj[`repeating_profession_${rowID}_profession`]=profObj.mod||0;
                        setObj[`repeating_profession_${rowID}_ranks`]=profObj.mod*1 - setObj.intelligence_mod*1||0;
                    }
                });
            }
            //Attack parsing
            if(data['data-attacks']){
                TAS.log(`processing Attacks`);
                data['data-attacks']=JSON.parse(data['data-attacks']);
                TAS.log(data['data-attacks']);
                _.each(data['data-attacks'],(obj)=>{
                    if(obj.name){
                        TAS.log(`create attack for:`);
                        let rowID = generateRowID();
                        setObj[`repeating_attack_${rowID}_name`]=obj.name;
                        setObj[`repeating_attack_${rowID}_id`]=rowID;
                        setObj[`repeating_attack_${rowID}_base_attack_bonus_base`]=obj.attack_total*1||0;
                        setObj[`repeating_attack_${rowID}_total`]=obj.attack_total*1||0;
                        setObj[`repeating_attack_${rowID}_damage_dice`]=obj.damage_total||'';
                        setObj[`repeating_attack_${rowID}_damage_total`]=obj.damage_total||'';
                        setObj[`repeating_attack_${rowID}_type`]=obj.damage_type||'';
                        setObj[`repeating_attack_${rowID}_crit`]=obj.critical_effect||'';
                        setObj[`repeating_attack_${rowID}_special`]=obj.special||'';
                        obj.engagement_range = `${obj.engagement_range}`.replace(/multi-attack/i,'multiattack').toLowerCase();
                        setObj[`repeating_attack_${rowID}_engagement_range`]=(obj.engagement_range||'melee').toLowerCase();
                        setObj[`repeating_attack_${rowID}_range_filter`]=(obj.engagement_range||'melee').toLowerCase();
                        if(obj.engagement_range==='multiattack'){
                            setObj[`repeating_attack_${rowID}_full_attack_number`]=obj.full_attack_number||1;
                        }
                        setObj[`repeating_attack_${rowID}_show_options`]=0;
                        if(/ranged/i.test(obj.engagement_range)){
                            setObj[`repeating_attack_${rowID}_ability`]='[[@{dexterity_mod}-@{dexterity_base}]]';
                            setObj[`repeating_attack_${rowID}_damage_ability`]=0;
                            setObj[`repeating_attack_${rowID}_base_attack_bonus`]=setObj[`repeating_attack_${rowID}_base_attack_bonus_base`]*1 - setObj.dexterity_mod*1||0;
                        }else{
                            setObj[`repeating_attack_${rowID}_ability`]='[[@{strength_mod}-@{strength_base}]]';
                            setObj[`repeating_attack_${rowID}_damage_ability`]='[[@{strength_mod}-@{strength_base}]]';
                            setObj[`repeating_attack_${rowID}_base_attack_bonus`]=setObj[`repeating_attack_${rowID}_base_attack_bonus_base`]*1 - setObj.strength_mod*1||0;
                        }
                    }
                });
            }
            //Spell parsing
            if(data['data-spells']){
                TAS.log(`processing spells`);
                data['data-spells']=JSON.parse(data['data-spells']);
                _.each(data['data-spells'],(obj)=>{
                    TAS.log(`spell Object:`);
                    TAS.log(obj);
                    let rowID = generateRowID();
                    obj.name = obj.name.replace(/(^|\s+)([a-z])/ig,(match,space,letter)=>{
                        return `${space}${letter.toUpperCase()}`;
                    });
                    let altName = obj.name.replace(/\s*\(\s*(?:\d+\s*\/\s*[a-z]+?|at will|constant)\s*\)\s*/i,'');
                    let spellBlob = data.blobs[altName.replace(/\s*\([a-z\s]+\)\s*/i,'')]||data.blobs[altName.replace(/(.*?)\s*(greater|lesser)\s*(.+)/i,'$1 $3 ($2)').replace(/\s*\([a-z\s]+\)\s*/i,'')];
                    if(spellBlob && data.blobs[`${altName} (Level ${obj.level})`]){
                        Object.assign(spellBlob,data.blobs[`${altName} (Level ${obj.level})`]);
                    }
                    TAS.log(`spellBlob for ${obj.name} or ${altName}:`);
                    TAS.log(spellBlob);
                    if(spellBlob){
                        spellBlob.name = obj.name;
                        parseSpellBlob(attributes,spellBlob,'spell',rowID,setObj);
                    }
                    setObj[`repeating_spell_${rowID}_name`] = obj.name;
                    setObj[`repeating_spell_${rowID}_show_options`]=0;
                    setObj[`repeating_spell_${rowID}_dc_base`]=obj.dc||10;
                    setObj[`repeating_spell_${rowID}_dc`]=obj.dc||10;
                    setObj[`repeating_spell_${rowID}_level`]=obj.level||0;
                    setObj[`repeating_spell_${rowID}_id`]=rowID;
                    if(obj.attack_bonus){
                        setObj[`repeating_spell_${rowID}_base_attack_bonus_base`]=obj.attack_bonus;
                        setObj[`repeating_spell_${rowID}_base_attack_bonus`]=obj.attack_bonus*1;
                        setObj[`repeating_spell_${rowID}_attack_checkbox`]=1;
                    }
                    if(obj.dc){
                        setObj[`repeating_spell_${rowID}_save_checkbox`]=1;
                    }
                });
            }
            //Spell Like Ability parsing
            if(data['data-spell-like-abilities']){
                TAS.log(`processing Spell Like Abilities`);
                data['data-spell-like-abilities']=JSON.parse(data['data-spell-like-abilities']);
                TAS.log(data['data-spell-like-abilities']);
                _.each(data['data-spell-like-abilities'],(obj)=>{
                    TAS.log(`obj:`);
                    TAS.log(obj);
                    let rowID = generateRowID();
                    obj.name = obj.name.replace(/(^|\s+)([a-z])/ig,(match,space,letter)=>{
                        return `${space}${letter.toUpperCase()}`;
                    });
                    let altName = obj.name.replace(/\s*\(\s*(?:\d+\s*\/\s*[a-z]+?|at will|constant)\s*\)\s*/i,'');
                    let spellBlob = data.blobs[altName.replace(/\s*\([a-z\s]+\)\s*/i,'')]||data.blobs[altName.replace(/(.*?)\s*(greater|lesser)\s*(.+)/i,'$1 $3 ($2)').replace(/\s*\([a-z\s]+\)\s*/i,'')];
                    if(spellBlob && data.blobs[`${altName} (Level ${obj.level})`]){
                        Object.assign(spellBlob,data.blobs[`${altName} (Level ${obj.level})`]);
                    }
                    TAS.log(`spellBlob for ${obj.name} or ${altName}:`);
                    TAS.log(spellBlob);
                    setObj[`repeating_ability_${rowID}_name`] = obj.name;
                    setObj[`repeating_ability_${rowID}_show_options`]=0;
                    setObj[`repeating_ability_${rowID}_dc_base`]=obj.dc||10;
                    setObj[`repeating_ability_${rowID}_dc`]=obj.dc||10;
                    setObj[`repeating_ability_${rowID}_save_type`]=(obj['save type']||'save').toLowerCase().replace(/(will|fort|ref)(?:lex|itude)/g,'$1-save');
                    setObj[`repeating_ability_${rowID}_duration`]=obj.duration||'';
                    setObj[`repeating_ability_${rowID}_frequency`]=(obj.frequency||'').toLowerCase();
                    setObj[`repeating_ability_${rowID}_description`]=obj['description']||'';
                    setObj[`repeating_ability_${rowID}_id`]=rowID;
                    if(obj.damage_total){
                        setObj[`repeating_ability_${rowID}_damage_checkbox`]=1;
                        setObj[`repeating_ability_${rowID}_damage_dice`]=obj.damage_total||'';
                        setObj[`repeating_ability_${rowID}_damage_total`]=obj.damage_total||'';
                        setObj[`repeating_ability_${rowID}_attack_type`]=obj.damage_type||'';
                        setObj[`repeating_ability_${rowID}_attack_crit`]=obj.critical_effect||'';
                    }
                    if(obj.dc){
                        setObj[`repeating_ability_${rowID}_save_checkbox`]=1;
                    }
                    if(spellBlob){
                        spellBlob.name = obj.name;
                        parseSpellBlob(attributes,spellBlob,'ability',rowID,setObj);
                    }
                    TAS.log(`spell like spellBlob created items:`);
                    TAS.log(
                        _.reduce(_.keys(setObj),(m,k)=>{
                            if(new RegExp(rowID).test(k)){
                                m[k] = setObj[k];
                            }
                            return m;
                        },{})
                    );
                    if(spellBlob && spellBlob.Classes){
                        spellBlob.Classes.replace(/[a-z\s]+\s+(\d+)(?:,[a-z\s]+\s+(\d+))?/,(match,level1,level2)=>{
                            setObj[`repeating_ability_${rowID}_level`] = _.max([level1,level2]);
                        })
                    }else{
                        setObj[`repeating_ability_${rowID}_level`]=obj.level||0;
                    }
                    setObj[`repeating_ability_${rowID}_type`]='SP';
                });
            }
            //Ability parsing
            if(data['data-abilities']){
                TAS.log(`processing Abilities`);
                data['data-abilities']=JSON.parse(data['data-abilities']);
                _.each(data['data-abilities'],(obj)=>{
                    let rowID = generateRowID();
                    setObj[`repeating_ability_${rowID}_show_options`]=0;
                    setObj[`repeating_ability_${rowID}_name`]=obj.name||'';
                    setObj[`repeating_ability_${rowID}_dc_base`]=obj.dc||10;
                    setObj[`repeating_ability_${rowID}_dc`]=obj.dc||10;
                    setObj[`repeating_ability_${rowID}_level`]=obj.level||0;
                    setObj[`repeating_ability_${rowID}_type`]=(obj.type||'').toUpperCase();
                    setObj[`repeating_ability_${rowID}_save_type`]=(obj['save type']||'save').toLowerCase().replace(/(will|fort|ref)(?:lex|itude)/g,'$1-save');
                    setObj[`repeating_ability_${rowID}_duration`]=obj.duration||'';
                    setObj[`repeating_ability_${rowID}_frequency`]=(obj.frequency||'').toLowerCase();
                    setObj[`repeating_ability_${rowID}_description`]=obj['description']||'';
                    setObj[`repeating_ability_${rowID}_id`]=rowID;
                    if(obj.damage_total){
                        setObj[`repeating_ability_${rowID}_damage_checkbox`]=1;
                        setObj[`repeating_ability_${rowID}_damage_dice`]=obj.damage_total||'';
                        setObj[`repeating_ability_${rowID}_damage_total`]=obj.damage_total||'';
                        setObj[`repeating_ability_${rowID}_attack_type`]=obj.damage_type||'';
                        setObj[`repeating_ability_${rowID}_attack_crit`]=obj.critical_effect||'';
                    }
                    if(obj.dc){
                        setObj[`repeating_ability_${rowID}_save_checkbox`]=1;
                    }
                });
            }
            Object.assign(attributes,setObj);
            TAS.log(`Final setObj:`);
            TAS.log(setObj);
            buildMenus(attributes,setObj);
            setAttrs(setObj,{silent:true});
        },
        
        spellAndAbilityDropHandler = function(attributes,setObj,force_source){
            const data = attributes.drop_data,
                catSwitch ={
                    Spells:'spell',
                    Abilities:'ability',
                    Classes:'ability',
                    Feats:'ability'
                },
                delaySet = {};
                /*TAS.log(`data.blobs: ${JSON.stringify(data.blobs)}`);
                data.blobs = JSON.parse(JSON.stringify(data.blobs));*/
            let sourceClass,spellClasses,sLevel,
                levelBlob = _.omit(data,'blobs'),
                currentCat = catSwitch[attributes.drop_category],
                rowID = generateRowID();
                TAS.log(`data:`);
                TAS.log(data);
                TAS.log(attributes);
            if(data.header!==''){
                let levelName = data.header.replace(/:(.+)/,' ($1)');
                Object.assign(levelBlob,data.blobs[levelName]);
            }
            TAS.log(`levelBlob:`);
            TAS.log(levelBlob);
            if(levelBlob.Category === 'Feats'){
                levelBlob.Category = 'Feat';
                if(/proficiency/i.test(levelBlob.name)){
                    const proficiencySwitch = {
                        //Armor
                        [`Light Armor Proficiency`]:'light_armor',
                        [`Heavy Armor Proficiency`]:'heavy_armor',
                        [`Powered Armor Proficiency`]:'power_armor',
                        //Melee Weapons
                        [`Basic Melee Weapon Proficiency`]:'basic_melee',
                        [`Advanced Melee Weapon Proficiency`]:'advanced_melee',
                        //Ranged Weapons
                        [`Small Arm Proficiency`]:'small_arm',
                        [`Longarm Proficiency`]:'longarm',
                        [`Heavy Weapon Proficiency`]:'heavy_weapon',
                        [`Grenade Proficiency`]:'grenade',
                        [`Sniper Weapon Proficiency`]:'sniper'
                    };
                    if(/proficiency/i.test(levelBlob.name)){
                        delaySet[`${proficiencySwitch[levelBlob.name]}_proficiency`] = 'yes';
                    }
                }
            }
            if(levelBlob && _.keys(data.blobs).length < 2){
                levelBlob.name=data.name;
                parseSpellBlob(attributes,levelBlob,currentCat,rowID,setObj);
                if(force_source){
                    setObj[`repeating_${currentCat}_${rowID}_source`] = force_source;
                }else if((!setObj[`repeating_${currentCat}_${rowID}_source`] || setObj[`repeating_${currentCat}_${rowID}_source`]==='') && attributes.sheet_type!=='npc'){
                    TAS.log(`exiting without setting`);
                    return;
                }
                //instead of setAttrsing, this should trigger a mancer dialog to determine whether to import as a spell-like or a spell, what the source of the spell/spell-like is, and what abilities to use for attacks, damage, and dc 
                if(!force_source){
                    setAttrs(setObj,silent,()=>{
                        let newEvent = {sourceAttribute:`${currentCat}_drop`};
                        newEvent.newValue = `repeating_${currentCat}_${rowID}_`.toLowerCase();
                        accessStarfinder(newEvent);
                        if(!_.isEmpty(delaySet)){
                            setAttrs(delaySet);
                        }
                    });
                }
            }else if(data.header==='' && _.keys(data.blobs).length > 1){
                getSectionIDs('repeating_variant',(oldIDs)=>{
                    _.each(oldIDs,(id)=>{
                        removeRepeatingRow(`repeating_variant_${id}`);
                    });
                    _.each(_.keys(data.blobs),(key)=>{
                        let variantName = `${data.name} (${key.replace(/.+?\((.+?)\).*/,'$1')})`;
                        setObj[`repeating_variant_${rowID}_variant`] = variantName;
                        rowID = generateRowID();
                    });
                    setObj.compendium_link = data.name;
                    setObj.spell_to_drop = data.name;
                    setObj.variant_data = JSON.stringify(data);
                    if(!force_source){
                        setAttrs(setObj,silent,()=>{
                            if(!_.isEmpty(delaySet)){
                                setAttrs(delaySet);
                            }
                        });
                    }
                });
            }
        },
        
        parseSpellBlob = function(attributes,levelBlob,currentCat,rowID,setObj){
            TAS.log(`starting spell blob parse for the blob:`);
            TAS.log(levelBlob)
            let spellClasses, sourceClass,sLevel;
            _.each(_.keys(dropObjs[`${currentCat}`]),(attr)=>{
                setObj[`repeating_${currentCat}_${rowID}_${attr}`] = _.reduce(dropObjs[`${currentCat}`][attr].data,(memo,dataKey)=>{
                    let iterativeAdd = levelBlob[dataKey]||dropObjs[`${currentCat}`][attr].default_value;
                    if(attr==='level' && currentCat === 'spell'){
                        spellClasses = `${iterativeAdd}`.match(/[a-z]+/gi);
                        _.some(classNumbers,(n)=>{
                            if(attributes[`class_${n}_spells`]*1===1){
                                sourceClass = attributes[`class_${n}_name`];
                                setObj[`repeating_${currentCat}_${rowID}_save_ability`]=attributes[`class_${n}_casting_ability`];
                                return _.some(spellClasses,(sClass)=>{
                                    if(new RegExp(sClass).test(attributes[`class_${n}_name`])){
                                        return true;
                                    }
                                    return false;
                                });
                            }
                            return false;
                        });
                        iterativeAdd = iterativeAdd.replace(/(\w+?)\s+(\d)(?:,|$)/,(match,spellList,spellLevel)=>{
                            if(spellLevel*1){
                                setObj[`repeating_${currentCat}_${rowID}_filter`]=spellLevel;
                            }else{
                                setObj[`repeating_${currentCat}_${rowID}_filter`]='cantrip';
                            }
                            sLevel = spellLevel;
                        });
                        iterativeAdd = sLevel;
                        setObj[`repeating_${currentCat}_${rowID}_source`] = sourceClass||'';
                    }else if(attr==='save_type' && levelBlob[dataKey]){
                        setObj[`repeating_${currentCat}_${rowID}_save_checkbox`]=1;
                    }
                    if(typeof dropObjs[`${currentCat}`][attr].default_value ==='number'){
                        iterativeAdd = iterativeAdd*1||dropObjs[`${currentCat}`][attr].default_value;
                    }
                    if(typeof iterativeAdd ==='string'){
                        iterativeAdd = iterativeAdd.replace(/\(([^()]*?)([A-Z]{2,})([^)]*)\)/g,(match,math1,compAttr,math2)=>{
                            const compendiumTranslator = {
                                CASTERLEVEL:'@{caster_level}'
                            };
                            return `[[floor(${math1}${compendiumTranslator[compAttr]}${math2})]]`;
                        });
                    }
                    if(dropObjs[`${currentCat}`][attr].translator){
                        iterativeAdd=dropObjs[`${currentCat}`][attr].translator[iterativeAdd]||iterativeAdd.toUpperCase();
                    }
                    if(memo !== '' && iterativeAdd !== '' && dropObjs[`${currentCat}`][attr].joiner){
                        memo+=dropObjs[`${currentCat}`][attr].joiner;
                    }
                    return memo += iterativeAdd;
                },(typeof dropObjs[`${currentCat}`][attr].default_value === 'number' ? 0 : ''));
            });
            if(levelBlob['Requires Attack']){
                setObj[`repeating_${currentCat}_${rowID}_attack_checkbox`] = 1;
                levelBlob['Requires Attack'] = levelBlob['Requires Attack'].replace(/melee/i,'strength').replace(/ranged/i,'dexterity');
                if(!/special/i.test(levelBlob.requires_attack)){
                    if(attributes.sheet_type==='pc'){
                        setObj[`repeating_${currentCat}_${rowID}_attack_ability`] = `@{${levelBlob['Requires Attack']}_mod}`;
                    }else{
                        setObj[`repeating_${currentCat}_${rowID}_attack_ability`] = `[[@{${levelBlob['Requires Attack']}_mod}-@{${levelBlob['Requires Attack']}_base}]]`;
                    }
                }
            }
            if(levelBlob['Damage Dice']){
                setObj[`repeating_${currentCat}_${rowID}_damage_checkbox`] = 1;
            }
            if(levelBlob.mods){
                setObj[`repeating_${currentCat}_${rowID}_mods`]=_.reduce(levelBlob.mods,(mod)=>{
                    return mod.push(`${mod.bonus} ${mod.type||''} to ${mod.target}`);
                },[]).join('\n');
            }
            if(/^yes$/i.test(levelBlob['Spell Resistance'])){
                setObj[`repeating_${currentCat}_${rowID}_spell_resistance`]='yes';
            }
            if(currentCat === 'ability' && levelBlob.Category === 'Feat'){
                setObj[`repeating_${currentCat}_${rowID}_source`]='Feat';
            }
            setObj[`repeating_${currentCat}_${rowID}_id`]=rowID;
            setObj[`repeating_${currentCat}_${rowID}_show_options`]=0;
        },
        
        equipmentDropHandler = function(attributes,setObj){
            const data = attributes.drop_data,
                itemRowID = generateRowID(),
                weaponRowID = generateRowID();
            _.each(_.keys(dropObjs.equipment),(attr)=>{
                setObj[`repeating_item_${itemRowID}_${attr}`] = _.reduce(dropObjs.equipment[attr].data,(memo,dataKey)=>{
                    let iterativeAdd = data[dataKey]||dropObjs.equipment[attr].default_value;
                    if(typeof dropObjs.equipment[attr].default_value ==='number'){
                        iterativeAdd = iterativeAdd*1||dropObjs.equipment[attr].default_value;
                    }else if(dropObjs.equipment[attr].joiner){
                        iterativeAdd+=dropObjs.equipment[attr].joiner;
                    }
                    return memo += iterativeAdd;
                },(typeof dropObjs.equipment[attr].default_value === 'number' ? 0 : ''));
            });
            setObj[`repeating_item_${itemRowID}_show_options`]=0;
            if(/small|longarm|weapon|grenade/i.test(data.category)){
                TAS.log(`data:`);
                TAS.log(data)
                setObj[`repeating_attack_${weaponRowID}_show_options`]=0;
                _.each(_.keys(dropObjs.weapon),(attr)=>{
                    setObj[`repeating_attack_${weaponRowID}_${attr}`] = _.reduce(dropObjs.weapon[attr].data,(memo,dataKey)=>{
                        let iterativeAdd = data[dataKey]||dropObjs.weapon[attr].default_value;
                        if(typeof dropObjs.weapon[attr].default_value ==='number'){
                            iterativeAdd = iterativeAdd*1||dropObjs.weapon[attr].default_value;
                        }else if(dropObjs.weapon[attr].joiner){
                            iterativeAdd+=dropObjs.weapon[attr].joiner;
                        }
                        if(typeof dropObjs.weapon[attr.default_value === 'string']){
                            iterativeAdd = reverseHE(iterativeAdd);
                        }
                        return memo += iterativeAdd;
                    },(typeof dropObjs.weapon[attr].default_value === 'number' ? 0 : ''));
                    TAS.log(`weapon compendium drop of ${attr} setting setObj[repeating_attack_${weaponRowID}_${attr}] to "${setObj[`repeating_attack_${weaponRowID}_${attr}`]}`);
                });
                setObj[`repeating_item_${itemRowID}_purpose`]='weapon';
                setObj[`repeating_attack_${weaponRowID}_category`]=data.category.replace(/\s+/g,'_').toLowerCase().replace(/heavy_weapons?/,'heavy').replace(/_(?:weapon|(arm))s$/,"$1");
                if(/melee/i.test(data.category)){
                    setObj[`repeating_attack_${weaponRowID}_damage_ability`]=`@{strength_mod}`;
                    setObj[`repeating_attack_${weaponRowID}_engagement_range`]='melee';
                    setObj[`repeating_attack_${weaponRowID}_ability`]='@{strength_mod}';
                }else{
                    setObj[`repeating_attack_${weaponRowID}_engagement_range`]='ranged';
                    setObj[`repeating_attack_${weaponRowID}_ability`]='@{dexterity_mod}';
                }
                if(attributes.sheet_type==='npc'){
                    setObj[`repeating_attack_${weaponRowID}_range_filter`]=setObj[`repeating_attack_${weaponRowID}_engagement_range`];
                }
                if(data.capacity){
                    data.capacity.replace(/(\d+)\s*([a-z]*)/i,(match,amount,type)=>{
                        setObj[`repeating_attack_${weaponRowID}_ammo_type`]=type;
                        setObj[`repeating_attack_${weaponRowID}_ammo_max`]=amount;
                        setObj[`repeating_attack_${weaponRowID}_ammo`]=amount;
                    });
                }
                if(data.special){
                    if(/blast/i.test(data.special)){
                        setObj[`repeating_attack_${weaponRowID}_bonus`]='-2';
                    }
                }
            }else if(/armor/i.test(data.category)){
                setObj[`repeating_item_${itemRowID}_purpose`]='armor';
                if(/heavy/i.test(data.category)){
                    setObj[`repeating_item_${itemRowID}_type`]='heavy_armor';
                }else if(/power/i.test(data.category)){
                    setObj[`repeating_item_${itemRowID}_type`]='power_armor';
                }else{
                    setObj[`repeating_item_${itemRowID}_type`]='light_armor';
                }
                setObj[`repeating_item_${itemRowID}_proficiency`]=attributes[`${setObj[`repeating_item_${itemRowID}_type`]}_proficiency`];
            }
            setAttrs(setObj,{silent:true},()=>{
                let newEvent = {sourceAttribute:'item_drop'};
                if(/small arm|longarm|weapon|grenade/i.test(data.category)){
                    newEvent.previousValue = `repeating_attack_${weaponRowID}_`.toLowerCase();
                }
                newEvent.newValue = `repeating_item_${itemRowID}_`.toLowerCase();
                accessStarfinder(newEvent);
            });
        },
        
        spellVariantAttrs = [
            {
                section:'variant',
                fields:['variant','drop']
            }
        ],
        
        cancelSpellDrop = function(){
            const attributes = [];
            getID(JSON.parse(JSON.stringify(spellVariantAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        removeRepeatingRow(`repeating_variant_${sid}`);
                    });
                });
                setAttrs({spell_to_drop:''},{silent:true});
            });
        },
        
        addSpells = function(){
            const attributeNames =['spell_to_drop','variant_data'].concat(sheetAttributes),
                rowArray = [];
            getID(JSON.parse(JSON.stringify(spellVariantAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        _.each(section.fields,(f)=>{
                            attributeNames.push('repeating_'+section.section+'_'+sid+'_'+f);
                        });
                    });
                });
                getAttrs(attributeNames,(attributes)=>{
                    try{
                        const setObj = {
                            spell_to_drop:'',
                            variant_data:''
                        },
                        data = JSON.parse(attributes.variant_data);
                        let variantIDs = _.reduce(_.keys(attributes),(memo,key)=>{
                            key.replace(/repeating_variant_(.+?)_variant/,(match,id)=>{
                                memo.push(id);
                            });
                            return memo;
                        },[]);
                        _.each(variantIDs,(id)=>{
                            if(attributes[`repeating_variant_${id}_drop`]*1===1){
                                let variant = attributes[`repeating_variant_${id}_variant`].replace(/:(.+)/,' ($1)'),
                                    levelBlob = _.omit(data,'blobs'),
                                    rowID;
                                    Object.assign(levelBlob,data.blobs[variant]);
                                    
                                if(levelBlob && data.blobs[variant]){
                                    rowID = generateRowID();
                                    rowArray.push(rowID);
                                    parseSpellBlob(attributes,levelBlob,'spell',rowID,setObj);
                                }
                            }
                            removeRepeatingRow(`repeating_variant_${id}`);
                        });
                        setAttrs(setObj,{silent:true},()=>{
                            _.each(rowArray,(rowID)=>{
                                let newEvent = {sourceAttribute:'spell_drop'};
                                newEvent.newValue = `repeating_spell_${rowID}_`.toLowerCase();
                                accessStarfinder(newEvent);
                            });
                        });
                    }catch(err){
                        TAS.log(`There wasn't a blob to pull`);
                        TAS.log(`Error generated was: "${err.message}"`);
                    }
                });
            });
        },
        
        //Start Charmancer Functions
        //Charmancer data objects to iterate through
        mancerPCSlides = ['summary-slide','loading-slide','pc-start','pc-race','pc-theme','pc-class','pc-ability-scores','pc-skill','pc-spell','pc-feat','pc-equipment'],
        compendiumControllers = ['race','subrace','class_1','class_2','class_3','class_4','class_5','theme'],
        
        mancerListeners = function(){
            /*on('sheet:opened',()=>{
                getAttrs(['character_name'],(attr)=>{
                    if(/mancer developer/i.test(attr.character_name)){
                        startCharactermancer('loading-slide');
                    }
                })
            });*/
            on('clicked:create_pc',()=>{
                startCharactermancer('loading-slide');
            });
            on(`clicked:next clicked:back`,changeSlide);
            on(`page:${mancerPCSlides.join(' page:')}`,loadSlide);
            on(`mancerchange:${compendiumControllers.join(' mancerchange:')} page:pc-ability-scores clicked:repeating_${['feat','classfeat','racialfeat'].join(' clicked:repeating_')} clicked:repeating_class clicked:repeating_spell`,viewCompendium);
            on('clicked:repeating_collapsible',(event)=>{collapse(event.sourceSection)});
            //race page handling
            on(`mancerchange:race`,raceSelected);
            on(`mancerchange:subrace`,subraceSelected);
            on(`mancerchange:repeating_race_ability mancerchange:repeating_theme_ability`,selectAbility);
            //on('mancerchange:repeating_race_')
            
            //theme page handling
            on(`mancerChange:theme`,themeSelected);
            
            //class page handling
            on('page:pc-class',loadClasses);
            on(`clicked:${['levels','abilities'].join(' clicked:')}`,viewClass);
            on(`clicked:add_level`,addClass);
            on('clicked:repeating_class',removeClass);
            on('mancerchange:repeating_class',updateClassLevels)
            //on(`mancerchange:repeating_class`,classSelected);
            //on(`mancerchange:class_level_${[1,2,3,4,5].join(' mancerchange:class_level_')}`,classLeveled);
            
            //ability page handling
            on(`page:pc-ability-scores`,loadMancerScores);
            on(`mancerchange:${_.map(scoreNames,(abi)=>{return `repeating_${abi}_points mancerchange:repeating_${abi}_points_select`}).join(' mancerchange:')}`,pointsAssigned);
            on(`clicked:${_.map(['point_buy','quick_pick','roll_ability','focused_array','split_array','versatile_array']).join(' clicked:')}`,changeAbilityMethod);
            on(`mancerroll:ability_scores`,parseAbilityRolls);
            on(`mancerchange:repeating_ability_level`,updateAbilitySelections)
            
            //Skill page handling
            on(`page:pc-skill`,loadMancerSkills);
            on('clicked:add_profession',addSkill);
            on('clicked:repeating_profession',removeSection);
            on(`mancerchange:repeating_${['profession',...mancerSkillList].join(' mancerchange:repeating_')}`,updateSkillValues);
            
            //Spell page handling
            on(`page:pc-spell`,loadSpells);
            on('mancerchange:repeating_spell',updateSpellDisplay);
            
            //Feat page handling
            on(`page:pc-feat`,loadFeats);
            on(`mancerchange:repeating_${['feat','classfeat','racialfeat'].join(' mancerchange:repeating_')}`,updateFeats);
            
            //generic selection handling
            on('mancerchange:repeating_selection',updateMod);
            
            //finish handling
            on('mancerfinish:overwrite',overwriteCharacter);
            on('mancerfinish:update',mergeCharacter);
        },
        
        changeSlide = function(event){
            TAS.log(`changing slide`);
            TAS.log(event);
            const data = getMancerData(),
                pageSwitch = {
                    'pc-start':{next:'pc-race'},
                    'pc-race':{back:'pc-start',next:'pc-theme'},
                    'pc-theme':{back:'pc-race',next:'pc-class'},
                    'pc-class':{back:'pc-theme',next:'pc-ability-scores'},
                    'pc-ability-scores':{back:'pc-class',next:'pc-skill'},
                    'pc-skill':{back:'pc-ability-scores',next:((data.mancerData.spell_list && data.mancerData.spell_list!=='') ? 'pc-spell' : 'pc-feat')},
                    'pc-spell':{back:'pc-skill',next:'pc-feat'},
                    'pc-feat':{back:((data.mancerData.spell_list && data.mancerData.spell_list!=='') ? 'pc-spell' : 'pc-skill')}
                };
                
            let new_slide = pageSwitch[event.currentStep];
            if(new_slide){
                new_slide = new_slide[event.sourceAttribute];
                if(new_slide){
                    changeCharmancerPage(new_slide);
                }
            }
        },
        
        loadSlide = function(event){
            TAS.log(`loading slide`);
            TAS.log(event);
            const data = getMancerData(),
                updateObj = {
                    setTextObj:{},
                    setObj:{last_slide:event.triggerName || 'pc-start'},
                    showArr:[]
                },
                newEvent = _.clone(event),
                keys = data.mancerData,
                buffs = parseBuffs(data.mancerData);
            TAS.log(`data:`);
            TAS.log(data);
            if(event.triggerName==='loading-slide'){
                changeCharmancerPage(data.mancerData.last_slide||'pc-start');
            }else{
                addRepeatingSection('top-section','topbar');
                if(data.mancerData.spell_list && data.mancerData.spell_list !== ''){
                    showChoices(['spell']);
                }else{
                    hideChoices(['spell']);
                }
                setScores(updateObj.setObj,updateObj.setTextObj,data,buffs);
                setHP(updateObj.setObj,updateObj.setTextObj,data,buffs);
                setAttrs(updateObj.setObj,silent);
                setCharmancerText(updateObj.setTextObj);
            }
        },
        
        viewCompendium = function(event){
            TAS.log(`viewing Compendium`);
            TAS.log(event);
            const data = getMancerData(),
                compendiumNulls = {
                    race:'Rules:Races',
                    subrace:'Rules:Races',
                    theme:'Rules:Character Themes',
                    [`pc-ability-scores`]:'Rules:Ability Scores',
                    spell:'Rules:Magic (Rules)',
                    repeating_class_compendium:'Rules:Character Creation Steps/#toc_7',
                    repeating_feat_compendium:'Rules:Feats'
                },
                repeat_converts = {
                    'clicked:repeating_feat_compendium':[data.mancerData[`${event.sourceSection}_feat`]],
                    'clicked:repeating_class_compendium':[data.mancerData[`${event.sourceSection}_name`]],
                    'clicked:repeating_spell_compendium':[data.mancerData[`${event.sourceSection}_name`],'card_only']
                };
            let value = [event.newValue];
            
            if(/repeating_|(?:class|archetype)_info_\d/.test(event.sourceAttribute)){
                value = repeat_converts[event.triggerName];
            }
            if(value==='' || !value){
                value=[compendiumNulls[event.triggerName.replace(/clicked:|_\d+/g,'')]];
            }
            changeCompendiumPage('sheet-compendium-page',...value);
        },
        
        getMancerData = function(data){
            const mancer = data || getCharmancerData();
            return _.reduce(mancer,(memo,slide)=>{
                memo.mancerData = _.extend(memo.mancerData,slide.values);
                if(slide.repeating){
                    memo.repeatIDs=[...memo.repeatIDs,...slide.repeating]
                }
                return memo;
            },{mancerData:{stackable_buffs:'circumstance'},repeatIDs:[]});
        },
        
        selectAbility = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            TAS.log(`ability selected`);
            const updateObj = {
                    setTextObj:{},
                    setObj:{},
                    showArr:[]
                },
                data=getMancerData(),
                buffs = parseBuffs(data.mancerData);
                
            subsetScore(updateObj.setObj,updateObj.setTextObj,data,true,buffs);
            setCharmancerText(updateObj.setTextObj);
            setAttrs(updateObj.setObj,{silent:true});
        },
        
        updateMod = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            TAS.log(`Updating mod`);
            TAS.log(event);
            const setTextObj={},
                setObj={},
                data=getMancerData();
                
            if(/.+?:/.test(event.newValue)){
                if(data.mancerData.last_slide === 'pc-class'){
                    updateClassSummary(data);
                }else{
                    insertAbility(event,data);
                }
            }else{
                getRepeatingSections((structure)=>{
                    let sectionKey = _.find(_.keys(structure.tree),(key)=>{
                        return _.contains(_.keys(structure.tree[key]),event.sourceSection);
                    });
                    if(data.mancerData[`${sectionKey}_mods`]){
                        if(/\(selected repeat\)/i.test(data.mancerData[`${sectionKey}_mods`])){
                            if(event.previousValue && new RegExp(event.previousValue).test(data.mancerData[`${sectionKey}_mods`])){
                                setObj[`${sectionKey}_mods`]=data.mancerData[`${sectionKey}_mods`].replace(new RegExp(event.previousValue,'i'),event.newValue);
                            }else{
                                setObj[`${sectionKey}_mods`]=data.mancerData[`${sectionKey}_mods`].replace(new RegExp(`(\\(selected repeat\\))`,'i'),`${event.newValue} and $1`);
                            }
                        }else{
                            setObj[`${sectionKey}_mods`]=data.mancerData[`${sectionKey}_mods`].replace(new RegExp(`\\(selected.*?\\)|${event.previousValue}`,'i'),event.newValue);
                        }
                    }
                    setAttrs(setObj,silent);
                });
            }
        },
        
        insertAbility = function(event,data,maintain){
            TAS.log(`inserting ability`);
            const setObj = {},
                setText = {},
                search_converter = {
                    IMPROVISATIONS:'Classes:Envoy',
                    'EXPERTISE TALENTS':'Classes:Envoy',
                    CONNECTIONS:'Classes:Mystic'
                };
            if(data.mancerData.last_slide !== 'pc-class' || !maintain){
                clearRepeatingSections(event.sourceSection);
            }
            event.newValue.replace(/(.+?):(.+)/,(match,search,blob_name)=>{
                addRepeatingSection(event.sourceSection,'ability-description','class_ability',(id)=>{
                    getCompendiumPage(search_converter[search],(page)=>{
                        data.pageData = page.data;
                        setObj[`${id}_mods`] = data.pageData.blobs[blob_name]['data-mods'];
                        setObj[`${id}_name`] = blob_name;
                        setText[`${id} .sheet-ability-name`] = '';
                        setText[`${id} .sheet-ability-description`] = data.pageData.blobs[blob_name].description;
                        setAttrs(setObj,silent);
                        setCharmancerText(setText);
                        if(data.pageData.blobs[blob_name]['data-multi-select']){
                            data.pageData.blobs[blob_name]['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                                search_term = search_term ? [search_term] : parseSelectList(list,data);
                                _.each(_.range(select_number),(num)=>{
                                    addRepeatingSection(id,'select','selection',(selectID)=>{
                                        setCharmancerOptions(`${selectID}_selection`,...search_term,()=>{
                                            if(maintain && data.mancerData[`${selectID}_selection`]){
                                                setAttrs({[`${selectID}_selection`]:data.mancerData[`${selectID}_selection`]||''},silent);
                                            }
                                        });
                                    });
                                });
                            });
                        }
                        Object.assign(data.mancerData,setObj);
                        if(data.mancerData.last_slide === 'pc-class' && !maintain){
                            updateClassSummary(data);
                        }
                    });
                });
            });
        },
        
        subsetScore = function(setObj,setText,data,showOnly,buffs){
            let scoreString = [data.mancerData.race_ability_bonus,data.mancerData.subrace_ability_bonus],
                themeAbilities = [],
                chooseTheme;
            
            scoreString = _.reject(scoreString,(string)=>{return !string||string===''});
            scoreString = scoreString.join(',').split(/,/).join('\n');
            setText.race_ability_bonus = scoreString||'';
            _.each(_.keys(data.mancerData),(key)=>{
                if(/race_ability_selection/.test(key) && data.mancerData[key]){
                    if(scoreString && scoreString!==''){
                        scoreString+=',';
                    }
                    scoreString+=data.mancerData[key];
                }
                if(/theme_ability_selection/.test(key)){
                    let abilityName,
                        abilityBonus;
                    data.mancerData[key].replace(/([a-z]+)\s*\+?(\-?\d+)/i,(match,name,bonus)=>{
                        abilityName = name;
                        abilityBonus = bonus;
                    });
                    setObj[`theme_${abilityName.toLowerCase()}`] = abilityBonus;
                    themeAbilities.push(abilityName.toLowerCase());
                    chooseTheme = true;
                }
            });
            if(!showOnly){
                clearRepeatingSections('abilityBonuses');
            }
            scoreString.replace(/([a-z]+)\s*\+?(\-?\d+)/gi,(match,ability,bonus)=>{
                setObj[`race_${ability.toLowerCase()}`]=bonus*1;
            });
            _.each(['strength','dexterity','constitution','intelligence','charisma','wisdom'],(abi)=>{
                if(!new RegExp(`${abi}`,'i').test(scoreString)){
                    setObj[`race_${abi}`] = 0;
                }
            });
            //Theme ability selection handling
            if(chooseTheme){
                _.each(scoreNames,(name)=>{
                    _.has(themeAbilities,name)
                    if(!_.some(themeAbilities,(test)=>{return test===name})){
                        setObj[`theme_${name}`] = 0;
                    }
                });
            }
            Object.assign(data.mancerData,setObj);
            setScores(setObj,setText,data,buffs);
        },
        
        raceSelected = function(event,showOnly){
            TAS.log(`############ raceSelected | showOnly: ${showOnly} ############`);
            TAS.log(event);
            const updateObj = {
                    setTextObj:{},
                    setObj:{},
                    showArr:[]
                },
                data=getMancerData(),
                oldAbilityBonus = {},
                newAbilityBonus = {};
                
            hideChoices(['charmancerrow']);
            clearRepeatingSections('ability-container');
            if(event.newValue==='Rules:Races'){
                showChoices(['sheet-custom']);
            }else{
                getCompendiumPage(event.newValue,(page)=>{
                    data.pageData = page.data;
                    if(event.sourceType !== 'worker'){
                        updateObj.setObj.subrace='';
                        updateObj.setObj.subrace_ability_bonus='';
                        _.each(scoreNames,(name)=>{
                            updateObj.setObj[`race_${name}`] = 0;
                        });
                        _.each(_.keys(data.mancerData),(key)=>{
                            if(/race_ability_selection/.test(key)){
                                data.mancerData[key]=undefined;
                            }
                        });
                    }
                    if(_.has(data.pageData,'data-subraces')){
                        let subraceNames = _.map(JSON.parse(data.pageData['data-subraces']),(subrace)=>{
                            return subrace.name;
                        });
                        subraceNames = _.map(subraceNames,(name)=>{
                            return name.replace(/([a-z])([a-z]+)/i,(match,first,rest)=>{
                                return `${first.toUpperCase()}${rest}`;
                            });
                        });
                        setCharmancerOptions('subrace',subraceNames);
                    }
                    Object.assign(data.mancerData,updateObj.setObj);
                    iterateDrop('raceDrops',updateObj,data);
                    if(_.has(data.pageData,'data-ability-score-choice')){
                        data.pageData[`data-ability-score-choice`].replace(/(\d+)(\+\d+)/g,(match,quantity,value)=>{
                            quantity = quantity*1||1;
                            _.each(_.range(quantity),()=>{
                                addRepeatingSection('abilityBonuses','select','race_ability',(id)=>{
                                    setCharmancerOptions(`${id}_selection`,_.map(scoreNames,(name)=>{
                                        return name.replace(/([a-z])([a-z]+)/i,(match,first,rest)=>{
                                            return `${first.toUpperCase()}${rest} ${value}`;
                                        });
                                    }));
                                });
                            });
                        });
                    }
                    let abilities = _.filter(_.keys(data.pageData.blobs),(key)=>{
                        return data.pageData.blobs[key]['Blob Type']==='Ability';
                    });
                    _.each(abilities,(ability)=>{
                        let abilityBlob = data.pageData.blobs[ability];
                        addRepeatingSection('ability-container','ability-description','racial_ability',(id)=>{
                            let repeatTextAdd = {
                                    [`${id} span.sheet-ability-name`]:`${ability}: `,
                                    [`${id} span.sheet-ability-description`]:abilityBlob.description
                                },
                                repeatSetObj = {
                                    [`${id}_name`]:ability
                                },
                                quantity = 0;
                                
                            if(abilityBlob['data-multi-select']){
                                abilityBlob['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                                    search_term = search_term ? [search_term] : parseSelectList(list,data);
                                    quantity = select_number*1;
                                    _.each(_.range(select_number*1),(num)=>{
                                        addRepeatingSection(id,'select','selection',(subid)=>{
                                            setCharmancerOptions(`${subid}_selection`,...search_term);
                                        });
                                    });
                                });
                            }
                            if(abilityBlob['data-mods']){
                                repeatSetObj[`${id}_mods`] = data.mancerData[`${id}_mods`] || _.reduce(abilityBlob['data-mods'].split(/\n+/),(memo,mod)=>{
                                    if(!/\(SELECTED/i.test(mod)){
                                        memo += `${mod}\n`;
                                    }else{
                                        memo += `${mod.replace(/(\(selected.+?\))/ig,_.map(_.range(quantity),(num)=>{return'$1'}).join(' and '))}\n`;
                                    }
                                    return memo;
                                },'');
                            }
                            setAttrs(repeatSetObj,{silent:true});
                            setCharmancerText(repeatTextAdd);
                        });
                    });
                    Object.assign(data.mancerData,updateObj.setObj);
                    let buffs = parseBuffs(data.mancerData);
                    setHP(updateObj.setObj,updateObj.setTextObj,data,buffs);
                    showChoices(updateObj.showArr);
                    setCharmancerText(updateObj.setTextObj);
                    _.each(_.keys(data.mancerData),(key)=>{
                        if(/repeating_/.test(key)){
                            updateObj.setObj[key]=data.mancerData[key];
                        }
                    });
                    setAttrs(updateObj.setObj,{silent:true},()=>{TAS.log(`race Set, nothing should be after this`)});
                });
            }
        },
        
        subraceSelected = function(event){
            TAS.log(`subrace selected`);
            TAS.log(event);
            const data = getMancerData(),
                updateObj = {
                    setTextObj:{},
                    setObj:{
                        subrace_ability_bonus:'',
                    }
                },
                buffs = parseBuffs(data.mancerData);
            getCompendiumPage(data.mancerData.race,(page)=>{
                data.pageData = page.data;
                let subraces = JSON.parse(data.pageData['data-subraces']);
                _.some(subraces,(sub)=>{
                    if(sub.name===event.newValue){
                        updateObj.setObj.subrace_ability_bonus = sub['ability-score-modifiers'];
                        return true;
                    }
                    return false;
                });
                data.mancerData = _.extend(data.mancerData,updateObj.setObj);
                subsetScore(updateObj.setObj,updateObj.setTextObj,data,true,buffs);
                setCharmancerText(updateObj.setTextObj);
                setAttrs(updateObj.setObj,{silent:true});
            });
        },
        
        themeSelected = function(event,showOnly){
            TAS.log(`themeSelected`);
            const data=getMancerData(),
                buffs = parseBuffs(data.mancerData);
                
            clearRepeatingSections('mancer-entry');
            if(event.newValue==='Rules:Themes'){
                
            }else{
                getCompendiumPage(event.newValue,(page)=>{
                    data.pageData = page.data;
                    let blob_keys = _.filter(_.keys(data.pageData.blobs),(key)=>{return data.pageData.blobs[key].available_levels*1 <= (data.mancerData.character_level*1||1)}),
                        blob_worker = (key)=>{
                            let abilityBlob = data.pageData.blobs[key]
                            addRepeatingSection('ability-container','ability-description','theme_ability',(id)=>{
                                let repeatTextAdd = {
                                        [`${id} span.sheet-ability-name`]:`${key}: `,
                                        [`${id} span.sheet-ability-description`]:abilityBlob.description,
                                        [`${id} span.sheet-level-header`]:`Level ${abilityBlob.available_levels}`
                                    },
                                    repeatSetObj = {
                                        [`${id}_name`]:key,
                                        [`${id}_source`]:(data.mancerData.theme||'').replace(/Themes:/,'')
                                    },
                                    quantity = 0;
                                showChoices(['sheet-level-header']);
                                if(abilityBlob.available_levels*1 === 1){
                                    Object.assign(repeatSetObj,{theme_strength:0,theme_dexterity:0,theme_constitution:0,theme_intelligence:0,theme_wisdom:0,theme_charisma:0});
                                    if(/;/.test(abilityBlob['Theme Knowledge Skill'])){
                                        addRepeatingSection(id,'select','theme_skill',(skillID)=>{
                                            let skillSetObj = {};
                                            abilityBlob['Theme Knowledge Skill'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                                                search_term = search_term ? [search_term] : parseSelectList(list,data);
                                                setCharmancerOptions(`${skillID}_selection`,...search_term);
                                            });
                                            if(!data.mancerData[`${skillID}_selection`]){
                                                skillSetObj.theme_skill = '';
                                            }
                                            setAttrs(abilitySetObj,silent);
                                        });
                                    }else{
                                        data.mancerData = _.reduce(_.keys(data.mancerData),(memo,key)=>{
                                            if(!/theme_skill_selection/.test(key)){
                                                memo[key] = data.mancerData[key];
                                            }
                                            return memo;
                                        },{});
                                        repeatSetObj.theme_skill = abilityBlob['Theme Knowledge Score'];
                                    }
                                    if(/choose/i.test(abilityBlob['Ability Score'])){
                                        addRepeatingSection(id,'select','theme_ability',(abilityID)=>{
                                            let abilitySetObj = {};
                                            setCharmancerOptions(`${abilityID}_selection`,_.map(scoreNames,(name)=>{
                                                return name.replace(/([a-z])([a-z]+)/i,(match,first,rest)=>{
                                                    return `${first.toUpperCase()}${rest} +1`;
                                                });
                                            }));
                                            if(!data.mancerData[`${abilityID}_selection`]){
                                                abilitySetObj.theme_ability_bonus = '';
                                            }
                                            setAttrs(abilitySetObj,silent);
                                        });
                                    }else{
                                        data.mancerData = _.reduce(_.keys(data.mancerData),(memo,key)=>{
                                            if(!/theme_ability_selection/.test(key)){
                                                memo[key] = data.mancerData[key];
                                            }
                                            return memo;
                                        },{});
                                        abilityBlob['Ability Score'].replace(/([a-z]+) \+(\d+)/i,(match,ability,score)=>{
                                            repeatSetObj[`theme_${ability.toLowerCase()}`]=score*1;
                                        });
                                    }
                                }
                                if(abilityBlob['data-multi-select']){
                                    abilityBlob['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                                        search_term = search_term ? [search_term] : parseSelectList(list,data);
                                        _.each(_.range(select_number*1),(num)=>{
                                            addRepeatingSection(id,'select','selection',(subid)=>{
                                                TAS.log(`num:${num}| id:${subid}`);
                                                setCharmancerOptions(`${subid}_selection`,...search_term);
                                            });
                                        });
                                    });
                                }
                                if(abilityBlob['data-mods']){
                                    repeatSetObj[`${id}_mods`] = data.mancerData[`${id}_mods`] || _.reduce(abilityBlob['data-mods'].split(/\n+/),(memo,mod)=>{
                                        if(!/\(SELECTED/i.test(mod)){
                                            memo += `${mod}\n`;
                                        }else{
                                            memo += `${mod.replace(/(\(selected.+?\))/ig,_.map(_.range(quantity),(num)=>{return'$1'}).join(' and '))}\n`;
                                        }
                                        return memo;
                                    },'');
                                }
                                Object.assign(data.mancerData,repeatSetObj);
                                if(blob_keys.length){
                                    blob_worker(blob_keys.shift());
                                }else{
                                    subsetScore(repeatSetObj,repeatTextAdd,data,true,buffs);
                                }
                                setAttrs(repeatSetObj,{silent:true});
                                setCharmancerText(repeatTextAdd);
                            });
                        };
                    blob_worker(blob_keys.shift());
                });
            }
        },
        //Start of Class handling functions
        viewClass = function(event){
            TAS.log(`changing class view`);
            TAS.log(event);
            setAttrs({current_class:event.sourceAttribute},silent);
            hideChoices(['mancer-levels','mancer-abilities-display']);
            showChoices([`mancer-${event.sourceAttribute.replace(/abilities/,'abilities-display')}`]);
        },
        
        removeClass = function(event){
            if(!/remove/.test(event.triggerName)){
                return;
            }
            const sectionMatch = new RegExp(event.sourceSection),
                setObj = {},
                setText = {},
                data = getMancerData();;
            clearRepeatingSectionById(event.sourceSection,()=>{
                //updateClassLevels();
                _.each(data.repeatIDs,(id)=>{
                    if(id!==event.sourceSection && (data.mancerData[`${event.sourceSection}_specific_level`]*1||0) < (data.mancerData[`${id}_specific_level`]*1||0)){
                        setObj[`${id}_specific_level`] = data.mancerData[`${id}_specific_level`]*1 - 1;
                        setText[`${id} .sheet-specific_level`] = setObj[`${id}_specific_level`];
                    }
                });
                setAttrs(setObj,silent,()=>{
                    updateClassSummary(getMancerData());
                });
                setCharmancerText(setText);
            });
        },
        
        addClass = function(event,data,setObj,setText,old_id){
            let update = false;
            if(!data){
                data = getMancerData();
            }
            if(!setObj){
                setObj = {};
            }
            if(!setText){
                setText = {};
            }
            if(!old_id){
                old_id = event.sourceSection;
                update = true;
            }
            addRepeatingSection('class-levels','class',(id)=>{
                let current_level = data.mancerData[`${old_id}_specific_level`] || _.max(_.reduce(_.keys(data.mancerData),(memo,key)=>{
                        if(/repeating_.+?_class_specific_level/.test(key)){
                            memo.push(data.mancerData[key]*1||0);
                        }
                        return memo;
                    },[0])) + 1;
                    
                hideChoices([`${id} .sheet-key_ability`,`${id} .sheet-key_ability_select`]);
                setObj[`${id}_specific_level`] = current_level;
                setObj[`${id}_stamina`] = data.mancerData[`${old_id}_stamina`] || '';
                setObj[`${id}_hp`] = data.mancerData[`${old_id}_hp`] || '';
                setObj[`${id}_skill_points`] = data.mancerData[`${old_id}_skill_points`] || '';
                setObj[`${id}_key_ability`] = data.mancerData[`${old_id}_key_ability`];
                setText[`${id} .sheet-specific_level`] = current_level;
                setText[`${id} .sheet-stamina`] = setObj[`${id}_stamina`];
                setText[`${id} .sheet-class-hp`] = setObj[`${id}_hp`];
                setText[`${id} .sheet-skill_points`] = setObj[`${id}_skill_points`];
                setText[`${id} .sheet-key_ability`] = setObj[`${id}_key_ability`];
                Object.assign(data.mancerData,setObj);
                setAttrs(setObj,silent);
                setCharmancerText(setText);
                setCharmancerOptions(`${id}_name`,'Category:Classes data-type:Class');
                setCharmancerOptions(`${id}_archetype`,'Category:Classes data-type:Archetype');
                if(data.mancerData[`${id}_name`]){
                    getCompendiumPage(data.mancerData[`${id}_name`],(page)=>{
                        data.pageData = page.data;
                        if(/,/.test(data.pageData[`Key Ability`])){
                            showChoices([`${id} .sheet-key_ability_select`]);
                            let abilityArr = properCase(data.pageData[`Key Ability`]).split(/,/);
                            setCharmancerOptions(`${id}_key_ability`,abilityArr,{selected:data.mancerData[`${old_id}_key_ability`]||'choose'},()=>{
                                setAttrs({[`${id}_key_ability`]:data.mancerData[`${old_id}_key_ability`]||'choose'},silent);
                            });
                        }else{
                            showChoices([`${id} .sheet-key_ability`]);
                            setAttrs({[`${id}_key_ability`]:data.pageData['Key Ability']},silent);
                            setCharmancerText({[`${id} .sheet-key_ability`]:setObj[`${id}_key_ability`]});
                        }
                    });
                }
                if(update){
                    updateClassSelects();
                }
            });
        },
        
        loadClasses = function(event){
            TAS.log(`loading classes`);
            TAS.log(event);
            const setObj = {},
                setText = {},
                data = getMancerData(),
                scoreData = _.filter(data.repeatIDs,(key)=>{
                    return new RegExp(`repeating_.+?_(?:${scoreNames.join('|')})`).test(key);
                });
                
            _.each(data.repeatIDs,(id)=>{
                if(/repeating_.+?_class$/.test(id)){
                    addClass(event,data,{},{},id);//data.mancerData[`${id}_specific_level`],data.mancerData[`${id}_stamina`],data.mancerData[`${id}_hp`],data.mancerData[`${id}_skill_points`],data.mancerData[`${id}_key_ability`]);
                }
            });
            hideChoices(['mancer-levels','mancer-abilities-display']);
            showChoices([`mancer-${data.mancerData.current_class.replace(/abilities/,'abilities-display')}`]);
            updateClassSummary(data,true);
            setAttrs(setObj,silent);
            setCharmancerText(setText);
        },
        
        updateClassLevels = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            TAS.log(`updating levels`);
            TAS.log(event);
            const data = getMancerData(),
                sectionMatch = new RegExp(event.sourceSection),
                setObj = {},
                setText = {};
            getCompendiumPage(data.mancerData[`${event.sourceSection}_name`],(page)=>{
                data.pageData = page.data;
                if(/name$/.test(event.sourceAttribute)){
                    hideChoices([`${event.sourceSection} .sheet-key_ability`,`${event.sourceSection} .sheet-key_ability_select`]);
                    setObj[`${event.sourceSection}_stamina`] = data.pageData['Stamina Points'];
                    setObj[`${event.sourceSection}_hp`] = data.pageData['Hit Points'];
                    setObj[`${event.sourceSection}_skill_points`] = data.pageData['Skill Ranks'];
                    setObj[`${event.sourceSection}_reflex`] = data.pageData['Reflex Save Progression'];
                    setObj[`${event.sourceSection}_fortitude`] = data.pageData['Fortitude Save Progression'];
                    setObj[`${event.sourceSection}_will`] = data.pageData['Will Save Progression'];
                    setObj[`${event.sourceSection}_bab`] = data.pageData['BAB Progression'];
                    setObj[`${event.sourceSection}_spell_list`] = data.pageData['Spell List'];
            
                    if(/,/.test(data.pageData[`Key Ability`])){
                        showChoices([`${event.sourceSection} .sheet-key_ability_select`]);
                        let abilityArr = properCase(data.pageData[`Key Ability`]).split(/,/);
                        setObj[`${event.sourceSection}_key_ability`] = '';
                        setCharmancerOptions(`${event.sourceSection}_key_ability`,abilityArr,{selected:'choose'});
                    }else{
                        showChoices([`${event.sourceSection} .sheet-key_ability`]);
                        setObj[`${event.sourceSection}_key_ability`] = data.pageData['Key Ability'];
                    }
                    _.each(_.keys(setObj),(key)=>{
                        let textKey = key.replace(/(repeating_.+?_class)_(.+)/,'$1 .sheet-$2').replace(/hp/,'class-hp');
                        setText[textKey] = setObj[key];
                    });
                }
                Object.assign(data.mancerData,setObj);
                updateClassSummary(data);
                setAttrs(setObj,silent);
                setCharmancerText(setText);
            });
        },
        
        updateClassSummary = function(data,load){
            TAS.log(`updating class summary`);
            TAS.log(data);
            const setObj = {},
                setText = {},
                convertSave = {
                    poor: (lvl) => Math.floor(lvl / 3),
                    good: (lvl) => 2 + Math.floor(lvl / 2)
                },
                buffs = parseBuffs(data.mancerData);
                
            getRepeatingSections((structure)=>{
                data.structure = structure;
                flattenTree(data.structure);
                getCompendiumQuery('Category:Classes data-type:Class',(compendium_classes)=>{
                    compendium_classes = objectifySearchResults(compendium_classes);
                    let selected_classes = findSelectedClasses(data,compendium_classes);
                    let temp_set = _.reduce(_.keys(selected_classes),(memo,name)=>{
                        _.each(['reflex','fortitude','will'],(save)=>{
                            memo[`base_${save}`] += convertSave[compendium_classes[name].data[`${properCase(save)} Save Progression`].toLowerCase()](selected_classes[name]);
                        });
                        memo.bab += Math.floor(selected_classes[name]*eval(compendium_classes[name].data['BAB Progression']));
                        _.each(['Armor Proficiencies','Weapon Proficiencies','Class Skills','Spell List'],(key)=>{
                            if(compendium_classes[name].data[key]){
                                memo[key.replace(/\s+/g,'_').toLowerCase()].push(...compendium_classes[name].data[key].split(/\s*,\s*/));
                            }
                        });
                        return memo;
                    },{base_reflex:0,base_fortitude:0,base_will:0,bab:0,class_skills:[],spell_list:[],armor_proficiencies:[],weapon_proficiencies:[]});
                    if(temp_set.spell_list.length){
                        showChoices(['spell-list']);
                    }else{
                        hideChoices(['spell-list']);
                    }
                    _.each(['class_skills','class_spell_list','armor_proficiencies','weapon_proficiencies','spell_list'],(key)=>{
                        temp_set[key] = properCase(_.unique(temp_set[key]).join(', '));
                    });
                    setObj.character_level = _.reduce(data.repeatIDs,(memo,id)=>{
                        if(/repeating_.+?_class$/.test(id)){
                            memo++;
                        }
                        return memo;
                    },0);
                    Object.assign(setObj,temp_set);
                    Object.assign(setText,setObj);
                    Object.assign(data.mancerData,setObj);
                    if(!load){
                        clearRepeatingSections('mancer-abilities-display');
                    }
                    _.each(_.keys(selected_classes),(key)=>{
                        addRepeatingSection('mancer-abilities-display','collapsible',(id)=>{
                            collapse(id,true);
                            setCharmancerText({[`${id} .sheet-section_name`]:key});
                            let repeatSetObj = {[`${id}_name`]:key};
                            setAttrs(repeatSetObj,silent);
                            Object.assign(data.mancerData,repeatSetObj);
                            getCompendiumPage(`Classes:${key}`,(page)=>{
                                data.pageData = page.data;
                                let abilities = findClassAbilities(data,id,selected_classes[key],buffs,structure);
                                _.each(abilities,(abi)=>{
                                    addRepeatingSection(`${id} > .sheet-collapse`,'ability-description','class_ability',(abilityID)=>{
                                        let abilitySetObj = {},
                                            abilitySetText = {};
                                            
                                        _.each(_.keys(abi.setObj),(setKey)=>{
                                            abilitySetObj[`${abilityID}${setKey}`]=abi.setObj[setKey];
                                        });
                                        _.each(_.keys(abi.setText),(setKey)=>{
                                            abilitySetText[`${abilityID}${setKey}`]=abi.setText[setKey];
                                        });
                                        Object.assign(data.mancerData,abilitySetObj);
                                        setAttrs(abilitySetObj,silent);
                                        setCharmancerText(abilitySetText);
                                        _.each(abi.select.values,(value)=>{
                                            addRepeatingSection(abilityID,'select','selection',(selectID)=>{
                                                setCharmancerOptions(`${selectID}_selection`,...abi.select.search,()=>{
                                                    let selectSetObj = {
                                                        [`${selectID}_selection`]:value,
                                                        [`${selectID}_source`]:data.mancerData[`${abilityID}_name`]
                                                    };
                                                    setAttrs(selectSetObj,silent);
                                                });
                                            });
                                        });
                                    });
                                });
                            });
                        });
                    });
                    setSP(setObj,setText,data,buffs);
                    setHP(setObj,setText,data,buffs);
                    setRP(setObj,setText,data,buffs);
                    setAttrs(setObj,silent,updateClassSelects);
                    setCharmancerText(setText);
                });
            });
        },
        
        findSelectedClasses = function(data,compendium_classes){
            return _.reduce(_.keys(data.mancerData),(memo,key)=>{
                if(/repeating_.+?_class_name$/.test(key)){
                    memo[data.mancerData[key].replace(/Classes:/,'')] = memo[data.mancerData[key].replace(/Classes:/,'')] ? memo[data.mancerData[key].replace(/Classes:/,'')]*1 + 1 : 1;
                }
                return memo;
            },{});
        },
        
        updateClassSelects = function(){
            const data = getMancerData(),
                setObj = {},
                setText = {},
                hide_arr = [],
                show_arr = [];
                
            getCompendiumQuery('Category:Classes data-type:Class',(compendium_classes)=>{
                compendium_classes = objectifySearchResults(compendium_classes);
                const selected_classes = findSelectedClasses(data,compendium_classes),
                    selected_keys = _.keys(selected_classes);
                let disabled = [];
                if(selected_keys.length>=5){
                    disabled = _.chain(_.keys(compendium_classes))
                        .reject((key)=>{return _.contains(selected_keys,key)})
                        .map((key)=>{return `Classes:${key}`})
                        .value();
                }
                _.each(selected_keys,(key)=>{
                    if(/,/.test(compendium_classes[key].data['Key Ability'])){
                        let display_only = _.chain(data.repeatIDs)
                            .filter((id)=>{return /repeating_.+?_class/.test(id) && data.mancerData[`${id}_name`]===`Classes:${key}`})
                            .sortBy((id)=>{return data.mancerData[`${id}_specific_level`]*1})
                            .value(),
                            templateID = display_only.shift();
                            
                        _.each(display_only,(id)=>{
                            hide_arr.push(`${id} .sheet-key_ability`,`${id} .sheet-key_ability_select`);
                            show_arr.push(`${id} .sheet-key_ability`);
                            setObj[`${id}_key_ability`] = data.mancerData[`${templateID}_key_ability`];
                            setText[`${id} .sheet-key_ability`]=setObj[`${id}_key_ability`];
                        });
                        hide_arr.push(`${templateID} .sheet-key_ability`,`${templateID} .sheet-key_ability_select`);
                        show_arr.push(`${templateID} .sheet-key_ability_select`);
                    }
                    let archetype_display =_.chain(data.repeatIDs)
                            .filter((id)=>{return /repeating_.+?_class/.test(id) && data.mancerData[`${id}_name`]===`Classes:${key}`})
                            .sortBy((id)=>{return data.mancerData[`${id}_specific_level`]*1})
                            .value(),
                        archTemplateID = archetype_display.shift();
                    _.each(archetype_display,(id)=>{
                        hide_arr.push(`${id} .sheet-archetype-display`,`${id} .sheet-archetype-select`);
                        show_arr.push(`${id} .sheet-archetype-display`);
                        setObj[`${id}_archetype`] = data.mancerData[`${archTemplateID}_archetype`]||'No Archetype';
                        setText[`${id} .sheet-archetype`]=setObj[`${id}_archetype`].replace(/Classes:/,'');
                    });
                    hide_arr.push(`${archTemplateID} .sheet-archetype`);
                    show_arr.push(`${archTemplateID} .sheet-archetype-select`);
                });
                _.each(data.repeatIDs,(id)=>{
                    if(/repeating_.+?_class/.test(id)){
                        disableCharmancerOptions(`${id}_name`,disabled);
                    }
                });
                Object.assign(data.mancerData,setObj);
                Object.assign(setText,setObj);
                if(!_.isEmpty(hide_arr)){
                    hideChoices(hide_arr);
                }
                if(!_.isEmpty(show_arr)){
                    showChoices(show_arr);
                }
                setAttrs(setObj,silent);
                setCharmancerText(setText);
            });
        },
        
        checkPrerequisites = function(data,ability,class_level){
            TAS.log(`checking prerequisites: ${ability} at ${class_level}`);
            const keyword_parser = {
                BAB:'data.mancerData.bab'
            };
            let level = _.some(`${data.pageData.blobs[ability].available_levels}`.split(/\s*,\s*/),(l)=>{
                    return (l*1||0) <= class_level;
                }),
                class_ability_ids = _.filter(data.repeatIDs,(id)=>{
                    return /class_ability$/.test(id);
                }),
                selection_ids = _.filter(data.repeatIDs,(id)=>{
                    return /selection$/.test(id);
                }),
                required = !level || _.every(`${data.pageData.blobs[ability].Prerequisites}`.split(/\n/),(prereq)=>{
                    let return_value = true;
                    prereq.replace(/(.+?)(?: (SELECTED))?\s*:\s*(.+)/i,(match,keyword,selection,value)=>{
                        if(keyword_parser[keyword]){
                            return_value = [`${keyword_parser[keyword]}`] === value || [`${keyword_parser[keyword]}`] >= value;
                        }else if(selection){
                            return_value = _.some(selection_ids,(id)=>{
                                return data.mancerData[`${id}_selection`] === `${keyword}:${value}`;
                            });
                        }else{
                            return_value = false;
                        }
                    });
                    return return_value;
                });
            return level && required;
        },
        
        findClassAbilities = function(data,section,class_level,buffs){
            TAS.log(`filtering class abilities`);
            TAS.log(data);
            let current_abilities = _.filter(data.repeatIDs,(id)=>{
                    return data.mancerData[`${id}_source`] === data.mancerData[`${section}_name`];
                }),
                valid_abilities = _.filter(_.keys(data.pageData.blobs),(key)=>{
                    return data.pageData.blobs[key].blob_type === 'class feature' && checkPrerequisites(data,key,class_level);
                }),
                select_abilities,
                ability_worker = (ability_keys)=>{
                    let blob_key = ability_keys.shift();
                    let old_ability = _.find(current_abilities,(id)=>{return data.mancerData[`${id}_name`]===blob_key});
                    let search,
                        push_value = {
                            select:{
                                search:'',
                                values:[]
                            }
                        };
                        push_value.setText = {
                            [` span.sheet-ability-name`]:blob_key,
                            [` span.sheet-ability-description`]:data.pageData.blobs[blob_key].description
                        };
                        push_value.setObj = {
                            [`_name`]:blob_key,
                            [`_source`]:data.mancerData[`${section}_name`],
                            [`_mods`]:old_ability ? data.mancerData[`${old_ability}_mods`] : data.pageData.blobs[blob_key]['data-mods']
                        };
                        
                    if(data.pageData.blobs[blob_key]['data-multi-select']){
                        data.pageData.blobs[blob_key]['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                            push_value.select.search = search_term ? [search_term] : parseSelectList(list,data);
                        });
                        let levels = [1];
                        if(data.pageData.blobs[blob_key].available_levels){
                            levels = _.filter(data.pageData.blobs[blob_key].available_levels.split(/\s*,\s*/),(num)=>{return num*1 <= class_level});
                            let previous_selects = _.filter(data.repeatIDs,(key)=>{
                                return /_selection$/.test(key) && data.mancerData[`${key}_source`] === blob_key;
                            });
                            select_abilities = [];
                            _.each(levels,(level)=>{
                                let prev_select = previous_selects.shift();
                                if(prev_select){
                                    push_value.select.values.push(data.mancerData[`${prev_select}_selection`]);
                                    if(/:/.test(data.mancerData[`${prev_select}_selection`])){
                                        data.mancerData[`${prev_select}_selection`].replace(/(.+?)\s*:\s*(.+)/,(match,type,name)=>{
                                            select_abilities.push(name);
                                        });
                                    }
                                }else{
                                    push_value.select.values.push('');
                                }
                            });
                            valid_abilities = [...select_abilities,...valid_abilities];
                        }
                    }
                    return_value.push(push_value);
                    if(valid_abilities.length){
                        ability_worker(valid_abilities);
                    }
                },
                return_value = [];
            if(valid_abilities.length){
                ability_worker(valid_abilities);
            }
            return return_value;
        },
        //end of class handling functions
        //Start of Ability Score Handling Functions
        parseAbilityRolls = function(event){
            TAS.log(`parsing ability rolls`);
            TAS.log(event);
            const setObj = {
                    ability_array:_.map(event.roll,(r)=>{return r.result}).join(',')
                },
                setText = {},
                data = getMancerData();
            Object.assign(setText,setObj);
            Object.assign(data.mancerData,setObj);
            updateAbilityScores(data,setText);
            setCharmancerText(setObj);
            setAttrs(setObj,silent);
        },
        
        changeAbilityMethod = function(event){
            TAS.log(`changing ability method:`);
            TAS.log(event);
            hideChoices();
            let setObj = {},
                setText = {},
                data = getMancerData(),
                methodSwitch = {
                    point_buy:['ability_method','buy'],
                    quick_pick:['ability_method','pick'],
                    roll_ability:['ability_method','roll'],
                    focused_array:['pick_method','focus'],
                    split_array:['pick_method','split'],
                    versatile_array:['pick_method','versatile']
                },
                ability_array_switch = {
                    focused_array:'18, 14, 11, 10, 10, 10',
                    split_array:'16, 16, 11, 10, 10, 10',
                    versatile_array:'14, 14, 14, 11, 10, 10'
                },
                buffs = parseBuffs(data.mancerData);
            setObj[`${methodSwitch[event.sourceAttribute][0]}`]=methodSwitch[event.sourceAttribute][1];
            Object.assign(data.mancerData,setObj);
            setObj.ability_array = ability_array_switch[event.sourceAttribute] || (data.mancerData.ability_method !== 'roll' ? ability_array_switch[`${`${data.mancerData.pick_method}`.replace(/focus/,'focused')}_array`] : undefined) || 'Waiting on Rolled Scores';
            _.each(_.filter(_.keys(data.mancerData),(key)=>{return new RegExp(`repeating_.+?_(?:${scoreNames.join('|')})_points$`).test(key)}),(key)=>{
                setObj[key] = 0;
                setObj.point_pool = 10;
                setObj[`${key}_select`] = '??';
            });
            Object.assign(setText,setObj);
            Object.assign(data.mancerData,setObj);
            updateAbilityScores(data,setText);
            setScores(setObj,setText,data,buffs);
            setCharmancerText(setText);
            setAttrs(setObj,silent);
            let showArr = [setObj.ability_method || data.mancerData.ability_method || 'buy'];
            if(data.mancerData.spell_list && data.mancerData.spell_list!==''){
                showArr.push('spell');
            }
            showChoices(showArr);
        },
        
        updateAbilityScores = function(data,setText){
            TAS.log(`updating ability scores`);
            const type_match = new RegExp(`(repeating_.+?_(${scoreNames.join('|')}))`),
                section_keys = _.filter(data.repeatIDs,(key)=>{return type_match.test(key)}),
                buffs = parseBuffs(data.mancerData);
            _.each(section_keys,(key)=>{
                key.replace(type_match,(match,id,score)=>{
                    updateScoreOptions(id,data,setText,section_keys,buffs);
                });
            });
        },
        
        updateScoreOptions = function(id,data,setText,scoreData,buffs){
            TAS.log(`updating score options`);
            let score = id.replace(/repeating_.+?_(.+)/,'$1');
            if(!data.mancerData.ability_method || /buy|roll/.test(data.mancerData.ability_method)){
                _.each(['race','theme'],(spec)=>{
                    setText[`${id} span.sheet-${spec}-value`] = data.mancerData[`${spec}_${score}`]||0;
                });
            }
            if(data.mancerData.ability_method!=='buy'){
                let die = 1,
                    ability_array = !/,/.test(data.mancerData.ability_array) ? [] : _.reduce(data.mancerData.ability_array.split(/\s*,\s*/),(memo,score)=>{
                        memo[0].push(`${die}: ${score}`);
                        if(_.some(scoreData,(key)=>{
                            return data.mancerData[`${key}_points_select`]===`${die}: ${score}` && key!==id;
                        })){
                            memo[1].disable.push(`${die}: ${score}`);
                        }
                        die++;
                        return memo;
                    },[[],{disable:[]}]);
                setCharmancerOptions(`${id}_points_select`,...ability_array);
            }
        },
        
        loadMancerScores = function(event){
            /*if(event.sourceType==='worker'){
                return;
            }*/
            TAS.log(`loading Mancer Scores`);
            TAS.log(event);
            const setObj = {},
                setText = {},
                data = getMancerData(),
                scoreData = _.filter(data.repeatIDs,(key)=>{
                    return new RegExp(`repeating_.+?_(?:${scoreNames.join('|')})`).test(key);
                }),
                buffs = parseBuffs(data.mancerData);
            setObj.point_pool = 10 - _.reduce(scoreData,(memo,name)=>{
                memo += _.max([data.mancerData[`${name}_points`]*1,0]);
                return memo;
            },0);
            setObj.pick_method = data.mancerData.pick_method || 'focus';
            data.mancerData.pick_method = setObj.pick_method;
            clearRepeatingSections('gridrow');
            _.each(scoreNames,(score)=>{
                addRepeatingSection(`gridrow`,'ability-scores',score,(id)=>{
                    let setText = {},
                        repeatSetObj = {};/*
                        points = (data.mancerData[`${id}_points`]*1) || 0,
                        points_select = data.mancerData[`${id}_points_select`] || '??';
                    repeatSetObj[`${id}_points`] = points;
                    repeatSetObj[`${id}_points_select`] = points_select;*/
                    setText[`${id} span.sheet-ability-name`] = properCase(score);
                    updateScoreOptions(id,data,setText,scoreData,buffs);
                    setCharmancerText(setText);
                    setAttrs(repeatSetObj);
                });
            });
            let level_ups = Math.floor((data.mancerData.character_level||1)/5);
            if(level_ups > 0){
                showChoices(['level-header']);
            }else{
                hideChoices(['level-header']);
            }
            _.each(_.range(level_ups),(level)=>{
                addLevelAbility(data,(level + 1)*5);
            });
            setAttrs(setObj,silent);
            Object.assign(setText,setObj);
            setText.ability_array = data.mancerData.ability_array;
            setCharmancerText(setText);
            showChoices([data.mancerData.ability_method || 'buy']);
        },
        
        addLevelAbility = function(data,level){
            addRepeatingSection('level','ability_level',(id)=>{
                let disabled = _.reduce([1,2,3,4],(memo,num)=>{
                    if(data.mancerData[`${id}_increase_${num}`] && data.mancerData[`${id}_increase_${num}`]!=='choose'){
                        memo.push(data.mancerData[`${id}_increase_${num}`]);
                    }
                    return memo;
                },[]);
                _.each([1,2,3,4],(num)=>{
                    disableCharmancerOptions(`${id}_increase_${num}`,disabled);
                });
                setCharmancerText({[`${id} .sheet-level-header`]:`Level ${level}`});
            });
        },
        
        pointsAssigned = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            TAS.log(`points assigned changed. Event was:`);
            TAS.log(event);
            const setObj = {},
                setText = {},
                data = getMancerData(),
                scoreData = _.filter(data.repeatIDs,(key)=>{
                    return new RegExp(`repeating_.+?_(?:${scoreNames.join('|')})`).test(key);
                }),
                buffs = parseBuffs(data.mancerData);
            if(/_select/.test(event.sourceAttribute)){
                setObj[event.sourceAttribute.replace(/_select/,'')] = data.mancerData[event.sourceAttribute].replace(/\d:\s+(\d+)/,'$1')*1;
                _.each(scoreData,(id)=>{
                    updateScoreOptions(id,data,setText,scoreData);
                });
            }
            setObj.point_pool = 10 - _.reduce(scoreData,(memo,name)=>{
                memo += _.max([data.mancerData[`${name}_points`]*1,0]);
                return memo;
            },0);
            Object.assign(data.mancerData,setObj);
            Object.assign(setText,setObj);
            setScores(setObj,setText,data,buffs);
            setAttrs(setObj,silent);
            setCharmancerText(setText);
        },
        
        updateAbilitySelections = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            TAS.log(`updating Ability Level up Selections`);
            const data = getMancerData(),
                setObj = {},
                setText = {},
                disabled = _.reduce([1,2,3,4],(memo,num)=>{
                    if(data.mancerData[`${event.sourceSection}_increase_${num}`] && data.mancerData[`${event.sourceSection}_increase_${num}`]!=='choose'){
                        memo.push(data.mancerData[`${event.sourceSection}_increase_${num}`]);
                    }
                    return memo;
                },[]),
                buffs = parseBuffs(data.mancerData);
                
            _.each([1,2,3,4],(num)=>{
                disableCharmancerOptions(`${event.sourceSection}_increase_${num}`,disabled);
            });
            setScores(setObj,setText,data,buffs);
            setAttrs(setObj,silent);
            setCharmancerText(setText);
        },
        //End of Ability Score handling functions
        //Start of Skill handling
        
        mancerSkillList = [ //Array of all the skills, used to iterate through them.
            'acrobatics',
            'athletics',
            'bluff',
            'computers',
            'culture',
            'diplomacy',
            'disguise',
            'engineering',
            'intimidate',
            'life_science',
            'medicine',
            'mysticism',
            'perception',
            'physical_science',
            'piloting',
            'sense_motive',
            'sleight_of_hand',
            'stealth',
            'survival'
        ],
        
        loadMancerSkills = function(event){
            TAS.log(`loading skills slide`);
            TAS.log(event);
            const data = getMancerData(),
                buffs = parseBuffs(data.mancerData),
                setObj = {
                    skill_points_available:0
                },
                setText = {},
                skillRows = _.reduce(data.repeatIDs,(memo,key)=>{
                    if(new RegExp(`repeating_.+?_(?:${skillList.join('|')})`).test(key)){
                        memo.push(key);
                    }
                    return memo;
                },[]);
            if(_.isEmpty(skillRows)){
                skillRows.push(...mancerSkillList);
            }
            setObj.skill_points_available = _.reduce(data.repeatIDs,(memo,id)=>{
                if(/repeating_.+?_class$/.test(id)){
                    memo += (data.mancerData[`${id}_skill_points`]*1||0) + (data.mancerData.intelligence_mod*1||0);
                }
                return memo;
            },0);
            clearRepeatingSections('gridrow');
            _.each(skillRows,(skill)=>{
                setObj.skill_points_available -= data.mancerData[`${skill}_ranks`]*1||0;
                addSkill(skill,data,buffs);
            });
            setText.skill_points_available = setObj.skill_points_available;
            setAttrs(setObj,silent);
            setCharmancerText(setText);
        },
        
        abilitySwitch = {
            'acrobatics':'dexterity',
            'athletics':'strength',
            'bluff':'charisma',
            'computers':'intelligence',
            'culture':'intelligence',
            'diplomacy':'charisma',
            'disguise':'charisma',
            'engineering':'intelligence',
            'intimidate':'charisma',
            'life_science':'intelligence',
            'medicine':'intelligence',
            'mysticism':'wisdom',
            'perception':'wisdom',
            'physical_science':'intelligence',
            'piloting':'dexterity',
            'sense_motive':'wisdom',
            'sleight_of_hand':'dexterity',
            'stealth':'dexterity',
            'survival':'wisdom'
        },
        
        addSkill = function(skill,data,buffs){
            if(!data){
                data = getMancerData();
            }
            if(!buffs){
                buffs = parseBuffs(data.mancerData);
            }
            if(typeof skill !== 'string'){
                skill = 'profession';
            }else{
                skill = skill.replace(/repeating_.+?_/,'');
            }
            addRepeatingSection('gridrow','skill',skill,(id)=>{
                let setObj = {},
                    setText = {},
                    ability_mod = 0;
                hideChoices([id]);
                if(_.contains(mancerSkillList,skill)){
                    showChoices([`${id} .sheet-pregen`]);
                    setObj[`${id}_name`]=properCase(skill.replace(/_/g,' '));
                    setText[`${id} span.sheet-name`] = setObj[`${id}_name`];
                    setText[`${id} span.sheet-ability_value`] = (abilitySwitch[skill]||'').replace(/([a-z]{3}).+/i,'$1').toUpperCase();
                    ability_mod = data.mancerData[`${abilitySwitch[skill]}_mod`]*1||0;
                    if(skill === 'profession' || new RegExp(skill,'i').test(data.mancerData[`class_skills`])){
                        setObj[`${id}_class_skill`] = 3;
                    }else{
                        setObj[`${id}_class_skill`] = 0;
                    }
                    setObj[`${id}_bonus_value`] = calcBuffs(data.mancerData,buffs[skill],setObj).total;
                    let theme_skill = data.mancerData[_.find(_.keys(data.mancerData),(key)=>{return /theme_skill_selection/.test(key)})] || data.mancerData.theme_skill || '';
                    if(theme_skill.replace(/\s+/g,'_').toLowerCase() === skill){
                        if(setObj[`${id}_class_skill`]===3){
                            setObj[`${id}_bonus_value`] = (setObj[`${id}_bonus_value`]*1||0) + 1;
                        }else{
                            setObj[`${id}_class_skill`]=3;
                        }
                    }
                    setText[`${id} .sheet-bonus_value`] = setObj[`${id}_bonus_value`];
                }else{
                    showChoices([`${id} .sheet-profession`]);
                    ability_mod = data.mancerData[`${data.mancerData[`${id}_ability_select`]}_mod`]*1||0;
                    setObj[`${id}_class_skill`] = 3;
                    setObj[`${id}_bonus_value`] = calcBuffs(data.mancerData,buffs[skill],setObj).total;
                    setText[`${id} .sheet-bonus_value`] = setObj[`${id}_bonus_value`];
                }
                Object.assign(data.mancerData,setObj);
                setObj[`${id}_total_value`] = (data.mancerData[`${id}_ranks`]*1||0) + (data.mancerData[`${id}_ranks`]*1 > 0 ? (data.mancerData[`${id}_class_skill`]*1||0) : 0) + ability_mod + (data.mancerData[`${id}_bonus_value`]*1||0);
                setText[`${id} span.sheet-total_value`] = setObj[`${id}_total_value`];
                setAttrs(setObj,silent);
                setCharmancerText(setText);
            });
        },
        
        updateSkillValues = function(event){
            if(event.sourceType === 'worker'){
                return;
            }
            const data = getMancerData(),
                setObj = {},
                setText = {},
                skill = event.sourceSection.replace(/repeating_.+?_/,'');
                
            if(/ranks/.test(event.sourceAttribute)){
                if(event.newValue > (data.mancerData.character_level||1)){
                    setObj[event.sourceAttribute]=data.mancerData.character_level;
                    data.mancerData[event.sourceAttribute]=data.mancerData.character_level;
                    event.newValue = data.mancerData.character_level;
                }
                setObj.skill_points_available = (data.mancerData.skill_points_available*1||0) - ((event.newValue*1||0) - (event.previousValue*1||0));
            }
            const ability_mod = data.mancerData[`${abilitySwitch[skill]}_mod`]*1||data.mancerData[`${data.mancerData[`${event.sourceSection}_ability_select`]}_mod`]*1||0;
            setObj[`${event.sourceSection}_total_value`] = (data.mancerData[`${event.sourceSection}_ranks`]*1||0) + (data.mancerData[`${event.sourceSection}_ranks`]*1 > 0 ? (data.mancerData[`${event.sourceSection}_class_skill`]*1||0) : 0) + ability_mod + (data.mancerData[`${event.sourceSection}_bonus_value`]*1||0);
            setText[`${event.sourceSection} span.sheet-total_value`] = setObj[`${event.sourceSection}_total_value`];
            Object.assign(setText,setObj);
            setAttrs(setObj,silent);
            setCharmancerText(setText);
        },
        
        removeSection = function(event){
            TAS.log(`removing repeating section`);
            TAS.log(event);
            clearRepeatingSectionById(event.sourceSection);
        },
        
        //End of skill handling
        //Start of feat handling
        
        loadFeats = function(event){
            TAS.log(`loading feats`);
            TAS.log(event);
            const data = getMancerData(),
                setObj = {},
                setText = {},
                featNum = Math.ceil(data.mancerData.character_level/2)||1;
            let featRows = _.reduce(data.repeatIDs,(memo,key)=>{
                    if(new RegExp(`repeating_.+?_feat`).test(key) && data.mancerData[`${key}_level`] <= data.mancerData.character_level){
                        memo.push(key);
                    }
                    return memo;
                },[]);
                
            if(featRows.length < featNum){
                _.each(_.range(_.max([featNum - featRows.length,0])),(num)=>{
                    featRows.push(`feat${(featRows.length + num + 1)*2 - 1}`);
                });
            }
            //Need racial, class, and custom feat handling
            //Racial and class repeating_feats will be named repeating_classfeat or repeating_racialfeat
            featRows = featRows.sort((a,b)=>{return (data.mancerData[`${a}_level`]*1||a.replace(/.*(\d+).*/,'$1')*1||0)-(data.mancerData[`${b}_level`]*1||b.replace(/.*(\d+).*/,'$1')*1||0)})
            clearRepeatingSections('mancer-entry');
            getCompendiumQuery('Category:Feats',(compendium_feats)=>{
                compendium_feats = objectifySearchResults(compendium_feats);
                _.each(featRows,(key)=>{
                    let feat = 'feat1',
                        id;
                    key.replace(/(repeating_.+?_(.*?)feat)/,(match,i,n)=>{
                        feat = n;
                        id = i;
                    });
                    addRepeatingSection('mancer-entry','feat',(newID)=>{
                        let repeatSetObj = {},
                            repeatSetText = {},
                            disabled = disableFeats(newID,data,featRows,compendium_feats) ||[],
                            feat_name;
                            
                        if(data.mancerData[`${newID}_feat`]){
                            feat_name = data.mancerData[`${newID}_feat`].replace(/feats:/i,'');
                        }
                        repeatSetObj[`${newID}_level`] = data.mancerData[`${id}_level`] || key.replace(/.*(\d+).*/,'$1')*1 || 1;
                        repeatSetText[`${newID} .sheet-level-header`] = /racial/i.test(key) ? 'Racial Bonus Feat' : `Level ${repeatSetObj[`${newID}_level`]}${/class/i.test(key) ? ' Bonus':''} Feat`;
                        repeatSetObj[`${newID}_name`] = data.mancerData[`${id}_name`] || '';
                        repeatSetText[`${newID} .sheet-name`] = repeatSetObj[`${newID}_name`];
                        repeatSetObj[`${newID}_description`] = data.mancerData[`${id}_description`] || '';
                        repeatSetObj[`${newID}_mods`] = data.mancerData[`${id}_mods`] || '';
                        repeatSetObj[`${newID}_feat`] = data.mancerData[`${id}_feat`] || 'choose';
                        if(compendium_feats[feat_name]){
                            if(compendium_feats[feat_name].data['data-multi-select']){
                                compendium_feats[feat_name].data['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                                    search_term = search_term ? [search_term] : parseSelectList(list,data,compendium_feats);
                                    _.each(_.range(select_number*1),(num)=>{
                                        addRepeatingSection(newID,'select','selection',(subid)=>{
                                            setCharmancerOptions(`${subid}_selection`,...search_term);
                                            setObj[`${subid}_selection`] = data.mancerData[`${subid}_selection`];
                                        });
                                    });
                                });
                            }
                        }
                        setAttrs(repeatSetObj,silent,(passed)=>{
                            setCharmancerOptions(`${id}_feat`,'Category:Feats',{add:['Custom'],show_source:true},(variable)=>{
                                disableCharmancerOptions(`${id}_feat`,disabled);//added this line because the above line was not working for when the slide was reloaded when coming back from another slide
                            });
                        });
                        setCharmancerText(repeatSetText);
                    });
                });
            });
        },
        
        updateFeats = function(event){
            if(event.sourceType==='worker'){
                return;
            }
            TAS.log(`updating feats`);
            TAS.log(event);
            const data = getMancerData(),
                setObj = {},
                setText = {},
                featNum = Math.ceil(data.mancerData.character_level/2)||1,
                featName = event.newValue.replace(/Feats:/,'');
            let featRows = _.reduce(data.repeatIDs,(memo,key)=>{
                    if(new RegExp(`repeating_.+?_(?:class|racial)?feat`).test(key)){
                        memo.push(key);
                    }
                    return memo;
                },[]);
                
            clearRepeatingSections(event.sourceSection);
            getCompendiumQuery('Category:Feats',(compendium_feats)=>{
                compendium_feats = objectifySearchResults(compendium_feats);
                if(/feats:/i.test(event.newValue)){
                    setObj[`${event.sourceSection}_name`]=compendium_feats[featName].name||'';
                    setObj[`${event.sourceSection}_description`]=compendium_feats[featName].data.description||'';
                    setObj[`${event.sourceSection}_mods`]=compendium_feats[featName].data[`data-mods`]||'';
                    if(compendium_feats[featName].data['data-multi-select']){
                        compendium_feats[featName].data['data-multi-select'].replace(/(\d+);(.+?)(?:\|\s+(.+)|$)/g,(match,select_number,list,search_term)=>{
                            search_term = search_term ? [search_term] : parseSelectList(list,data,compendium_feats);
                            _.each(_.range(select_number*1),(num)=>{
                                addRepeatingSection(event.sourceSection,'select','selection',(id)=>{
                                    setCharmancerOptions(`${id}_selection`,...search_term);
                                });
                            });
                        });
                    }
                }
                Object.assign(data.mancerData,setObj);
                _.each(featRows,(rowID)=>{
                    let disable = disableFeats(rowID,data,featRows,compendium_feats);
                    disableCharmancerOptions(`${rowID}_feat`,disable);
                });
                const buffs = parseBuffs(data.mancerData);
                setScores(setObj,setText,data,buffs);
                setHP(setObj,setText,data,buffs);
                setAttrs(setObj,silent);
                setCharmancerText(setText);
            });
        },
        
        disableFeats = function(id,data,featRows,compendium_feats){
            return _.chain(_.keys(compendium_feats))
                .filter((key)=>{
                    if(!compendium_feats[key].data.selectable && _.some(featRows,(rowID)=>{return rowID !== id && data.mancerData[`${rowID}_feat`]===`Feats:${key}`})){
                        return true;
                    }
                    return false;
                })
                .reject((key)=>{return !key})
                .map((key)=>{return `Feats:${key}`})
                .value();
        },
        
        //End of feat handling
        //Start of Spell Handling
        loadSpells = function(event){
            const data = getMancerData(),
                setObj = {},
                setText = {},
                convertProgress = { //object of fat arrow functions that calculates the spell level available for a class
                    half: (lvl) => lvl >= 13 ? 4 : lvl >= 10 ? 3 : lvl >= 7 ? 2 : lvl >= 4 ? 1 : 0,
                    partial: (lvl) => lvl >= 16 ? 6 : lvl >= 13 ? 5 : lvl >= 10 ? 4 : lvl >= 7 ? 3 : lvl >= 4 ? 2 : lvl >= 1 ? 1 : 0,
                    full_prep: (lvl) => Math.min(Math.floor((lvl + 1) / 2), 9),
                    full_spont: (lvl) => lvl * 1 === 1 ? 1 : Math.floor(lvl / 2)
                },
                convert_known = {
                    partial: {
                        Cantrips:[4,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6],
                        'Level 1':[2,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,6,6,6,6],
                        'Level 2':[0,0,0,2,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,6],
                        'Level 3':[0,0,0,0,0,0,2,3,4,4,4,4,5,5,5,5,6,6,6,6],
                        'Level 4':[0,0,0,0,0,0,0,0,0,2,3,4,4,4,4,5,5,5,5,6],
                        'Level 5':[0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,4,4,4,5,5],
                        'Level 6':[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,4,4,5]
                    },
                };
                
            hideChoices(['mancer-entry']);
            getCompendiumQuery('Category:Classes data-type:Class',(compendium_classes)=>{
                compendium_classes = objectifySearchResults(compendium_classes);
                let selected_classes = findSelectedClasses(data,compendium_classes),
                    spell_classes = _.filter(_.keys(selected_classes),(key)=>{
                        return compendium_classes[key].data['Spell List'];
                    });
                _.each(spell_classes,(spell_class)=>{
                    addRepeatingSection('mancer-entry','collapsible',(id)=>{
                        let repeatSetObj = {},
                            repeatSetText = {};
                            
                        repeatSetText[`${id} .sheet-section_name`] = properCase(spell_class);
                        if(data.mancerData[`${id}_status`] === 'collapsed'){
                            hideChoices([`${id} > .sheet-collapse`]);
                        }else{
                            showChoices([`${id} > .sheet-collapse`]);
                        }
                        setAttrs(repeatSetObj,silent);
                        setCharmancerText(repeatSetText);
                        let progression = compendium_classes[spell_class].data['data-spell_progression'],
                            max_level = convertProgress[progression](selected_classes[spell_class]);
                        if(max_level){
                            _.each(_.range(max_level + 1),(level)=>{
                                addRepeatingSection(`${id} > .sheet-collapse`,'collapsible',(levelID)=>{
                                    let levelSetObj = {},
                                        levelSetText = {},
                                        level_name = level === 0 ? 'Cantrips' : `Level ${level}`,
                                        known = convert_known[progression][level_name][selected_classes[spell_class]*1 - 1];
                                        
                                    levelSetText[`${levelID} .sheet-section_name`] = `${level_name} <span class='current'></span><span>/</span><span class='max'></span>`;
                                    setCharmancerText(levelSetText);
                                    if(data.mancerData[`${levelID}_status`] === 'collapsed'){
                                        hideChoices([`${levelID} > .sheet-collapse`]);
                                    }else{
                                        showChoices([`${levelID} > .sheet-collapse`]);
                                    }
                                    getCompendiumQuery(`Category:Spells Level:*${spell_class} ${level}*`,(compendium_spells)=>{
                                        compendium_spells=objectifySearchResults(compendium_spells);
                                        let comp_keys = _.keys(compendium_spells),
                                            selected = 0,
                                            key_worker = (spell)=>{
                                                addRepeatingSection(`${levelID} .sheet-collapse`,'spell',(spellID)=>{
                                                    let spellSetObj = {},
                                                        spellSetText = {};
                                                        
                                                    spellSetObj[`${spellID}_name`] = `Spells:${spell}`;
                                                    spellSetObj[`${spellID}_source`] = properCase(spell_class);
                                                    spellSetObj[`${spellID}_level`] = level;
                                                    spellSetText[`${spellID} .sheet-name`] = spell;
                                                    if(data.mancerData[`${spellID}_known`]*1===1){
                                                        selected++;
                                                    }
                                                    showChoices(['pregen']);
                                                    if(comp_keys.length){
                                                        key_worker(comp_keys.shift());
                                                    }else{
                                                        spellSetText[`${levelID} .sheet-current`] = selected;
                                                        spellSetText[`${levelID} .sheet-max`] = known;
                                                    }
                                                    setAttrs(spellSetObj,silent);
                                                    setCharmancerText(spellSetText);
                                                });
                                            };
                                            
                                        key_worker(comp_keys.shift());
                                    });
                                });
                            });
                        }
                    });
                });
            });
        },
        
        updateSpellDisplay = function(event){
            if(event.sourceType==='worker'){
                return;
            }
            TAS.log(`updating spell display`);
            TAS.log(event);
            const data = getMancerData(),
                setText = {};
            getRepeatingSections((structure)=>{
                flattenTree(structure);
                let sectionKey = _.find(structure.list,(key)=>{
                        return _.contains(_.keys(structure.tree[key]),event.sourceSection)
                    }),
                    selected = 0;
                _.each(_.keys(structure.tree[sectionKey]),(spellID)=>{
                    if(data.mancerData[`${spellID}_known`]*1 === 1){
                        selected++;
                    }
                });
                setText[`${sectionKey} .sheet-current`] = selected;
                setCharmancerText(setText);
            });
        },
        //End of Spell Handling
        //Start of Equipment Handling
        //End of Equipment Handling
        //Start of finish handling
        overwriteCharacter = function(event){
            TAS.log(`overwriting character`);
            TAS.log(event);
            const data = getMancerData(event.data),
                cloneRepAttr = JSON.parse(JSON.stringify(repeatingAttributes)),
                setObj = {sheet_type:'pc',tab_select:0},
                buffs = parseBuffs(data.mancerData);
                
            getID(cloneRepAttr,(sectionAggregate) => {
                _.each(sectionAggregate, (section) => {
                    _.each(section.id, (sid) => {
                        _.each(section.fields, (f) => {
                            removeRepeatingRow(`repeating_${section.section}_${sid}`);
                        });
                    });
                });
                _.each(['strength','dexterity','constitution','intelligence','charisma','wisdom'],(ability)=>{
                    setObj[`${ability}_base`] = (data.mancerData[ability]*1||0) - calcBuffs(data.mancerData,buffs[ability],setObj).total;
                });
                _.each(skillList,(skill)=>{
                    let skillRow = _.filter(data.repeatIDs,(id)=>{return new RegExp(skill).test(id)}),
                        rowID;
                    _.each(skillRow,(skillID)=>{
                        if(skill==='profession'){
                            rowID = generateRowID();
                            setObj[`repeating_profession_${rowID}_ranks`] = data.mancerData[`${skillID}_ranks`]||0;
                            setObj[`repeating_profession_${rowID}_class_skill`] = data.mancerData[`${skillID}_class_skill`]||0;
                        }else{
                            setObj[`${skill}_ranks`] = data.mancerData[`${skillID}_ranks`]||0;
                            setObj[`${skill}_class_skill`] = data.mancerData[`${skillID}_class_skill`]||0;
                        }
                    });
                });
                let class_num = 0,
                    classes_to_pull = {},
                    spells_to_pull = [],
                    feats_to_pull = [],
                    racial_abilities_to_pull = [],
                    theme_abilities_to_pull = [];
                Object.assign(setObj,_.reduce(data.repeatIDs,(memo,id)=>{
                    if(/class$/.test(id) && data.mancerData[`${id}_name`]){
                        if(memo[`class_${class_num}_name`]!==`${data.mancerData[`${id}_name`]}`.replace(/Classes:/,'')){
                            class_num++;
                        }
                        memo[`class_${class_num}_name`] = `${data.mancerData[`${id}_name`]}`.replace(/Classes:/,'');
                        memo[`class_${class_num}_level`]++;
                        memo[`class_${class_num}_sp`]=data.mancerData[`${id}_stamina`];
                        memo[`class_${class_num}_hp`]=data.mancerData[`${id}_hp`];
                        memo[`class_${class_num}_skills`]=data.mancerData[`${id}_skill_points`];
                        memo[`class_${class_num}_ref`] = data.mancerData[`${id}_reflex`].toLowerCase();
                        memo[`class_${class_num}_fort`] = data.mancerData[`${id}_fortitude`].toLowerCase();
                        memo[`class_${class_num}_will`] = data.mancerData[`${id}_will`].toLowerCase();
                        memo[`class_${class_num}_bab`] = eval(data.mancerData[`${id}_bab`]);
                        memo[`class_${class_num}_ability`] = `@{${data.mancerData[`${id}_key_ability`].toLowerCase()}_mod}`;
                        if(data.mancerData[`${id}_spell_list`] && data.mancerData[`${id}_spell_list`]!==''){
                            memo[`class_${class_num}_spells`] = 1;
                            memo[`class_${class_num}_casting_ability`] = memo[`class_${class_num}_ability`];
                        }else{
                            memo[`class_${class_num}_spells`] = 0;
                        }
                    }else if(/class_ability/.test(id)){
                        classes_to_pull[data.mancerData[`${id}_source`]] = classes_to_pull[data.mancerData[`${id}_source`]] || [];
                        classes_to_pull[data.mancerData[`${id}_source`]].push(id);
                    }else if(/spell$/.test(id) && data.mancerData[`${id}_known`]*1){
                        spells_to_pull.push(id);
                    }else if(/feat$/.test(id)){
                        feats_to_pull.push(id);
                    }else if(/racial_ability$/.test(id)){
                        racial_abilities_to_pull.push(id);
                    }else if(/theme_ability$/.test(id)){
                        theme_abilities_to_pull.push(id);
                    }
                    return memo;
                },{class_1_name:'',class_2_name:'',class_3_name:'',class_4_name:'',class_5_name:'',
                    class_1_level:0,class_2_level:0,class_3_level:0,class_4_level:0,class_5_level:0,
                    class_1_sp:0,class_2_sp:0,class_3_sp:0,class_4_sp:0,class_5_sp:0,
                    class_1_hp:0,class_2_hp:0,class_3_hp:0,class_4_hp:0,class_5_hp:0,
                    class_1_skills:0,class_2_skills:0,class_3_skills:0,class_4_skills:0,class_5_skills:0,
                    class_1_ref:'poor',class_2_ref:'poor',class_3_ref:'poor',class_4_ref:'poor',class_5_ref:'poor',
                    class_1_fort:'poor',class_2_fort:'poor',class_3_fort:'poor',class_4_fort:'poor',class_5_fort:'poor',
                    class_1_will:'poor',class_2_will:'poor',class_3_will:'poor',class_4_will:'poor',class_5_will:'poor',
                    class_1_bab:0.75,class_2_bab:0.75,class_3_bab:0.75,class_4_bab:0.75,class_5_bab:0.75,
                }));
                _.each(_.keys(classes_to_pull),(key)=>{
                    getCompendiumPage(`Classes:${key}`,(page)=>{
                        let pageSetObj = {};
                        _.each(classes_to_pull[key],(mancerid)=>{
                            let rowID = generateRowID();
                            parseSpellBlob(setObj,page.data.blobs[data.mancerData[`${mancerid}_name`]],'ability',rowID,pageSetObj);
                            pageSetObj[`repeating_ability_${rowID}_name`]=data.mancerData[`${mancerid}_name`];
                            pageSetObj[`repeating_ability_${rowID}_mods`]=data.mancerData[`${mancerid}_mods`]||'';
                            pageSetObj[`repeating_ability_${rowID}_source`]=data.mancerData[`${mancerid}_source`];
                            pageSetObj[`repeating_ability_${rowID}_description`]=page.data.blobs[data.mancerData[`${mancerid}_name`]].description;
                        });
                        setAttrs(pageSetObj);
                    });
                });
                mancerSpellWorker(data,setObj,spells_to_pull,()=>{
                    /*_.each(feats_to_pull,(featID)=>{
                        getCompendiumPage(`Feats:${data.mancerData[`${featID}_name`]}`,(page)=>{
                            TAS.log(`pulling feat:`);
                            TAS.log(page);
                            let rowID = generateRowID(),
                                pageSetObj = {};
                            parseSpellBlob(setObj,page.data,'ability',rowID,pageSetObj);
                            pageSetObj[`repeating_ability_${rowID}_name`]=data.mancerData[`${featID}_name`];
                            pageSetObj[`repeating_ability_${rowID}_mods`]=data.mancerData[`${featID}_mods`]||'';
                            pageSetObj[`repeating_ability_${rowID}_source`]='Feat';
                            pageSetObj[`repeating_ability_${rowID}_description`]=`${page.data.Description}\nBenefit:\n${page.data.Benefit}`;
                            TAS.log(`pageSetObj:`);
                            TAS.log(pageSetObj);
                            setAttrs(pageSetObj);
                        });
                    });
                    getCompendiumPage(data.mancerData[`race`],(page)=>{
                        TAS.log(`pulling race:`);
                        TAS.log(page);
                        _.each(racial_abilities_to_pull,(abilityID)=>{
                            let rowID = generateRowID(),
                                pageSetObj = {};
                            parseSpellBlob(setObj,page.data.blobs[data.mancerData[`${abilityID}_name`]],'ability',rowID,pageSetObj);
                            pageSetObj[`repeating_ability_${rowID}_name`]=data.mancerData[`${abilityID}_name`];
                            pageSetObj[`repeating_ability_${rowID}_mods`]=data.mancerData[`${abilityID}_mods`]||'';
                            pageSetObj[`repeating_ability_${rowID}_source`]=data.mancerData.race.replace(/Races:/,'');
                            pageSetObj[`repeating_ability_${rowID}_description`]=page.data.blobs[data.mancerData[`${abilityID}_name`]].description;
                            TAS.log(`pageSetObj:`);
                            TAS.log(pageSetObj);
                            setAttrs(pageSetObj);
                        });
                    });
                    getCompendiumPage(data.mancerData[`theme`],(page)=>{
                        TAS.log(`pulling theme:`);
                        TAS.log(page);
                        _.each(theme_abilities_to_pull,(abilityID)=>{
                            let rowID = generateRowID(),
                                pageSetObj = {};
                            parseSpellBlob(setObj,page.data.blobs[data.mancerData[`${abilityID}_name`]],'ability',rowID,pageSetObj);
                            pageSetObj[`repeating_ability_${rowID}_name`]=data.mancerData[`${abilityID}_name`];
                            pageSetObj[`repeating_ability_${rowID}_mods`]=data.mancerData[`${abilityID}_mods`]||'';
                            pageSetObj[`repeating_ability_${rowID}_source`]='Theme';
                            pageSetObj[`repeating_ability_${rowID}_description`]=page.data.blobs[data.mancerData[`${abilityID}_name`]].description;
                            TAS.log(`pageSetObj:`);
                            TAS.log(pageSetObj);
                            setAttrs(pageSetObj);
                        });
                    });*/
                    TAS.log(`Overwrite setObj:`);
                    TAS.log(setObj);
                    setAttrs(setObj);
                    finishCharactermancer();
                });
            });
        },
        
        mancerSpellWorker = function(data,setObj,rows,callback){
            let rowID = rows.shift();
            getCompendiumPage(data.mancerData[`${rowID}_name`],(page)=>{
                TAS.log(`pulling spell:`);
                TAS.log(page);
                let drop_data = page.data;
                drop_data.name = data.mancerData[`${rowID}_name`].replace(/spells:/i,'');
                TAS.log(`spell drop_data:`);
                TAS.log(drop_data);
                if(_.some(_.keys(page.data.blobs),(key)=>{return /\(Level/.test(key)})){
                    drop_data.header = `${data.mancerData[`${rowID}_name`]} (Level ${data.mancerData[`${rowID}_level`]})`;
                }else{
                    drop_data.header = '';
                }
                spellAndAbilityDropHandler(_.extend({drop_data:drop_data,drop_category:'Spells'},setObj),setObj,data.mancerData[`${rowID}_source`]);
                if(_.isEmpty(rows)){
                    callback();
                }else{
                    mancerSpellWorker(data,setObj,rows,callback);
                }
            });
        },
        
        mergeCharacter = function(event){
            TAS.log(`updating character`);
            TAS.log(event);
        },
        
        verifyMancer = function(event){
            TAS.log(`verifying mancer`);
            TAS.log(event);
            const data = getMancerData();
        },
        //end of finish handling
        //Start of generic Mancer Functions
        flattenTree =  function(structure){
            let treeWorker = (key)=>{
                    _.each(_.keys(structure.tree[key]),(tree_key)=>{
                        structure.tree[tree_key] = structure.tree[key][tree_key];
                        tree_keys.push(tree_key);
                    });
                    if(tree_keys.length){
                        treeWorker(tree_keys.shift());
                    }
                },
                tree_keys = _.keys(structure.tree);
                
            treeWorker(tree_keys.shift());
        },
        
        parseSelectList = function(list,data,compendium_data){//Parses keywords for collecting valid select option values from the mancer
            let list_converter = _.reduce(_.keys(data.mancerData),(memo,key)=>{
                    if(new RegExp(`repeating_.+?_(?:${skillList.join('|')})_name`).test(key)){
                        memo.SKILLS[0].push(data.mancerData[key]);
                        if(data.mancerData[key.replace(/name/,'class_skill')]*1===3){
                            memo['CLASS SKILLS'][0].push(data.mancerData[key]);
                        }
                        if(data.mancerData[key.replace(/name/,'ranks')]*1>0){
                            memo['TRAINED SKILLS'][0].push(data.mancerData[key]);
                        }
                    }
                    return memo;
                },{SKILLS:[[],{}],[`CLASS SKILLS`]:[[],{}],['TRAINED SKILLS']:[[],{}],
                    //Envoy conversions
                    ['EXPERTISE TALENTS']:[[],{category:'EXPERTISE TALENTS'}],['SKILL EXPERTISE SELECTIONS']:[[],{category:'SKILL EXPERTISE SELECTIONS'}],IMPROVISATIONS:[[],{category:'IMPROVISATIONS'}],
                    //Soldier conversions
                    ['FIGHTING STYLES']:[[],{category:'FIGHTING STYLES'}],['GEAR BOOSTS']:[[],{category:'GEAR BOOSTS'}],
                    //technomancer conversions
                    ['MAGIC HACKS']:[[],{category:'MAGIC HACKS'}],
                    //mystic conversions
                    ['CONNECTIONS']:[[],{category:'CONNECTIONS'}],
                    //solarian conversions
                    ['REVELATIONS']:[[],{category:'REVELATIONS'}],
                    //mechanic conversions
                    ['TRICKS']:[[],{category:'TRICKS'}],
                    //operative conversions
                    ['SPECIALIZATIONS']:[[],{category:'SPECIALIZATIONS'}],['EXPLOITS']:[[],{category:'EXPLOITS'}]
                });
                
            if(!list_converter.SKILLS[0][0]){
                list_converter.SKILLS[0] = _.reduce(skillList,(memo,skill)=>{
                    if(skill !== 'profession'){
                        memo.push(skill.replace(/_/g,' '));
                    }
                    return memo;
                },[]);
            }
            if(data.pageData){
                const blob_type_converter = {
                    improvisation:'IMPROVISATIONS',
                    [`expertise talent`]:'EXPERTISE TALENTS',
                    connection:'CONNECTIONS',
                    'gear boost':'GEAR BOOSTS',
                    'fighting style':"FIGHTING STYLES",
                    'magic hack':'MAGIC HACKS',
                    revelation:'REVELATIONS',
                    exploit:'EXPLOITS',
                    specialization:'SPECIALIZATIONS',
                    trick:'TRICKS'
                };
                list_converter = _.reduce(_.keys(data.pageData.blobs),(memo,key)=>{
                    let blob = data.pageData.blobs[key];
                    if(memo[blob_type_converter[blob.blob_type]]){
                        memo[blob_type_converter[blob.blob_type]][0].push(key);
                    }
                    return memo;
                },list_converter);
            }
            return list_converter[list] || [list.split(','),{}];
        },
        objectifySearchResults = function(compendium_feats){
            return _.reduce(compendium_feats,(memo,obj)=>{
                memo[obj.name]=obj;
                return memo;
            },{});
        },
        
        collapse = function(id,maintain){
            const data = getMancerData(),
                setObj = {};
                
            if((data.mancerData[`${id}_status`]==='expanded' && !maintain) || (data.mancerData[`${id}_status`]==='collapsed' && maintain)){
                hideChoices([`${id} > .sheet-collapse`]);
                setObj[`${id}_status`] = 'collapsed';
            }else{
                showChoices([`${id} > .sheet-collapse`]);
                setObj[`${id}_status`] = 'expanded';
            }
            setAttrs(setObj,silent);
        },
        
        properCase = function(string){
            return string.replace(/(^|,|\s)([a-z])([a-z])/ig,(match,space,letter,rest)=>{
                return `${space}${letter.toUpperCase()}${rest.toLowerCase()}`;
            });
        },
        
        findConversions = function(data,dataObj){
            let converter,selects,tempObj;
            
            try{
                converter = JSON.parse(data.pageData['data-converter']);
            }catch (err){
                TAS.log(err);
                converter = [];
            }
            
            _.each(_.keys(dataObj),(key)=>{
                if(/[^\(](?:[A-Z]{2,}[^\)])/.test(dataObj[key])){
                    dataObj[key].replace(/[^\(]([A-Z\s]{2,})(\s+SELECTIONS?)[^\)]/g,(match,text,select)=>{
                        selects = true;
                        text = text.trim();
                        if(/(?:TRAINED|CLASS) SKILLS/.test(text)){
                            //Handle Class/trained skill selections
                        }else{
                            let convert = _.find(converter,(v)=>{
                                return new RegExp(`^${text}$`).test(v.searchKey);
                            });
                            if(!convert){
                                return text;
                            }else if(convert.type==='blob' && !selects){
                                tempObj = _.filter(data[`${convert.source}Data`].blobs,(blob)=>{
                                    return blob[convert.key]===convert.value;
                                });
                            }
                        }
                    });
                }
            });
        },
        
        iterateDrop = function(dropName,updateObj,data,showOnly){
            const attributeExtra = dropName.replace(/[^\d]/g,'').replace(/\d+/,'_$&'),
                tempName = dropName.replace(/\d/g,''),
                drop = mancerObjs[tempName];
                
            if(!drop){
                return;
            }
            _.each(drop,(dropInfo)=>{
                if(_.every(dropInfo.addIf,(objKey)=>{
                    return _.has(data[objKey[0]],objKey[1]);
                })){
                    let buffs = parseBuffs(data.mancerData);
                    _.each(dropInfo.obj,(objName)=>{
                        if(Array.isArray(updateObj[objName])){
                            if(dropInfo.template){
                                updateObj[objName].push([dropInfo.attr,template]);
                            }else{
                                updateObj[objName].push(dropInfo.attr);
                            }
                        }else{
                            if(dropInfo.func){
                                if(dropInfo.returnFunc){
                                    updateObj[objName][`${dropInfo.attr}${attributeExtra}`] = dropInfo.func(data[dropInfo.funcArgs[0]][dropInfo.funcArgs[1]]);
                                }else{
                                    if(dropInfo.funcArgs){
                                        dropInfo.func(data[dropInfo.funcArgs[0]][dropInfo.funcArgs[1]],updateObj.setObj,updateObj.setTextObj,data,showOnly,buffs);
                                    }else{
                                        dropInfo.func(updateObj.setObj,updateObj.setTextObj,data,showOnly,buffs);
                                    }
                                }
                            }else{
                                updateObj[objName][`${dropInfo.attr}${attributeExtra}`]=dropInfo.defaultValue;
                                updateObj[objName][`${dropInfo.attr}${attributeExtra}`]=_.reduce(dropInfo.value,(memo,keyValue)=>{
                                    if(data[keyValue[0]][keyValue[1]]){
                                        if(_.isNumber(memo)){
                                            data[keyValue[0]][keyValue[1]] = data[keyValue[0]][keyValue[1]]*1||0;
                                        }
                                        memo += data[keyValue[0]][keyValue[1]];
                                    }
                                    return memo;
                                },dropInfo.defaultValue);
                                if(dropInfo.translator){
                                    updateObj[objName][`${dropInfo.attr}${attributeExtra}`] = dropInfo.translator[updateObj[objName][`${dropInfo.attr}${attributeExtra}`]];
                                }
                            }
                        }
                    });
                }
                data.mancerData = _.extend(data.mancerData,updateObj.setObj);
            });
        },
        
        scoreNames = ['strength','dexterity','constitution','intelligence','wisdom','charisma'],
        classNumbers = [1,2,3,4,5],
        
        setScores = function(setObj,setText,data,buffs){
            let increases = _.filter(_.keys(data.mancerData),(key)=>{return /ability_level_increase_\d/.test(key)});
            _.each(scoreNames,(abi)=>{
                let abi_points = (data.mancerData[_.find(_.keys(data.mancerData),(key)=>{return new RegExp(`repeating_.+?_${abi}_points$`).test(key)})]*1)||0;
                if(data.mancerData.ability_method !== 'pick'){
                    setObj[abi]=_.min([(data.mancerData.ability_method === 'roll' ? 0 : 10) + (data.mancerData[`race_${abi}`]*1||0) + (data.mancerData[`theme_${abi}`]*1||0) + abi_points,18]);
                }else{
                    setObj[abi] = abi_points*1||0;
                }
                setObj[abi] = _.reduce(increases,(memo,key)=>{
                    if(data.mancerData[key]===abi){
                        memo+= memo <= 16 ? 2 : 1;
                    }
                    return memo;
                },setObj[abi]);
                setObj[abi] += calcBuffs(data.mancerData,buffs[abi],setObj).total;
                setText[abi]=setObj[abi];
                setObj[`${abi}_mod`]=figureModifier(setObj[abi]);
                setText[`${abi}_mod`]=setObj[`${abi}_mod`];
                if(setText[`${abi}_mod`] >= 0){
                    setText[`${abi}_mod`] = `+${setText[`${abi}_mod`]}`;
                }
                setText[`${abi}_mod`] = `(${setText[`${abi}_mod`]})`;
            });
            data.mancerData = _.extend(data.mancerData,setObj);
            setSP(setObj,setText,data,buffs);
            setRP(setObj,setText,data,buffs);
            setAC(setObj,setText,data,buffs);
        },
        
        setSP = function(setObj,setText,data,buffs){
            TAS.log(`setting sp`);
            let classSP = _.reduce(data.repeatIDs,(memo,id)=>{
                    if(/repeating_.+?_class/.test(id)){
                        memo += data.mancerData[`${id}_stamina`]*1||0;
                    }
                    return memo;
                },0);
            setObj.sp = Math.max(figureModifier(data.mancerData.constitution)*(data.mancerData.character_level*1||1) + classSP + calcBuffs(data.mancerData,buffs.sp,setObj).total + calcBuffs(data.mancerData,buffs.sp_max,setObj).total,0);
            setText.sp = setObj.sp;
        },
        
        figureModifier = function(score){//converts an ability score into an ability modifier. Accepts a number (in either string or number format)
            return Math.floor(((score*1||0) - 10)/2);
        },
        
        setRP = function(setObj,setText,data,buffs){//Sets the rp mancer attribute and text
            TAS.log(`setting RP`);
            let rpAbility=[];
            _.each(scoreNames,(score)=>{
                _.some(data.repeatIDs,(id)=>{
                    if(new RegExp(score,'i').test(data.mancerData[`${id}_key_ability`])){
                        rpAbility.push(figureModifier(data.mancerData[score]));
                        return true;
                    }
                    return false;
                });
            });
            if(_.isEmpty(rpAbility)){
                rpAbility = 0;
            }else{
                rpAbility = _.max(rpAbility);
            }
            setObj.rp = Math.max(Math.max(Math.floor(data.mancerData.character_level/2||0),1) + rpAbility,1);
            setText.rp = setObj.rp;
        },
        
        setHP = function(setObj,setText,data,buffs){
            let racial = data.mancerData.race_hp*1||0,
                classHP = _.reduce(data.repeatIDs,(memo,id)=>{
                    if(/repeating_.+?_class/.test(id)){
                        memo += data.mancerData[`${id}_hp`]*1||0;
                    }
                    return memo;
                },0);
            setObj.hp = Math.max(racial + classHP + calcBuffs(data.mancerData,buffs.hp,setObj).total + calcBuffs(data.mancerData,buffs.hp_max,setObj).total,0);
            setText.hp = setObj.hp;
        },
        
        setAC = function(setObj,setText,data,buffs){
            let eac_armor = data.mancerData.eac_armor*1||0,
                kac_armor = data.mancerData.kac_armor*1||0,
                dexterity_mod = data.mancerData.dexterity_mod*1||0,
                eac_bonus = data.mancerData.eac_bonus*1||0,
                kac_bonus = data.mancerData.kac_bonus*1||0;
                
            setObj.eac = 10+eac_armor+dexterity_mod+eac_bonus + calcBuffs(data.mancerData,buffs.eac,setObj).total + calcBuffs(data.mancerData,buffs.eac_armor,setObj).total;
            setObj.kac = 10+kac_armor+dexterity_mod+kac_bonus + calcBuffs(data.mancerData,buffs.kac,setObj).total + calcBuffs(data.mancerData,buffs.kac_armor,setObj).total;
            setText.eac = setObj.eac;
            setText.kac = setObj.kac;
        },
        
        mancerObjs = {
            raceDrops:[
                //template to go here
                //Official race Handling
                //showOptions possibilities
                {attr:'official',obj:['showArr']},
                {attr:'language',obj:['showArr'],addIf:[['pageData','languages']]},
                {attr:'subrace',obj:['showArr'],addIf:[['pageData','data-subraces']]},
                {attr:'senses',obj:['showArr'],addIf:[['pageData','Senses']]},
                
                //attribute and text options
                {attr:'race_language',obj:['setTextObj','setObj'],value:[['pageData','languages']],defaultValue:''},
                {attr:'race_ability_bonus',obj:['setObj'],value:[['pageData','Ability Score Modifiers']],defaultValue:''},
                {attr:'race_hp',obj:['setTextObj','setObj'],value:[['pageData','Race HP']],defaultValue:''},
                {attr:'race_senses',obj:['setTextObj','setObj'],value:[['pageData','Senses']],defaultValue:''},
                {attr:'expand_scores',obj:['setObj'],func:subsetScore},
                {attr:'race_size',obj:['setTextObj','setObj'],value:[['pageData','Size']],defaultValue:''},
                {attr:'race_type',obj:['setTextObj','setObj'],value:[['pageData','Type']],defaultValue:''},
                {attr:'race_speed',obj:['setTextObj','setObj'],value:[['pageData','Racial Speed']],defaultValue:''}
            ],
            classDrops:[
                //showOptions possibilities
                //{attr:'official',obj:['showArr']},
                
                //attribute and text options
                {attr:'class_stamina',obj:['setObj'],value:[['pageData','Stamina Points']],defaultValue:''},
                {attr:'class_hp',obj:['setObj'],value:[['pageData','Hit Points']],defaultValue:''},
                {attr:'class_ability',obj:['setObj'],value:[['pageData','Key Ability']],defaultValue:''},
                {attr:'class_skill_points',obj:['setObj'],value:[['pageData','Skill Ranks']],defaultValue:''},
                {attr:'class_skills',obj:['setObj'],value:[['pageData','Class Skills']],defaultValue:'',func:properCase,funcArgs:['pageData','Class Skills'],returnFunc:true},
                {attr:'class_spell_list',obj:['setObj'],value:[['pageData','Spell List']],defaultValue:''},
                {attr:'class_fortitude',obj:['setObj'],value:[['pageData','Fortitude Save Progression']],defaultValue:''},
                {attr:'class_will',obj:['setObj'],value:[['pageData','Will Save Progression']],defaultValue:''},
                {attr:'class_reflex',obj:['setObj'],value:[['pageData','Reflex Save Progression']],defaultValue:''},
                {attr:'class_bab',obj:['setObj'],value:[['pageData','BAB Progression']],translator:{'1':'Full','3/4':'3/4','1/2':'1/2'},defaultValue:''},
                {attr:'class_armor_proficiencies',obj:['setObj'],value:[['pageData','Armor Proficiencies']],defaultValue:'',func:properCase,funcArgs:['pageData','Armor Proficiencies'],returnFunc:true},
                {attr:'class_weapon_proficiencies',obj:['setObj'],value:[['pageData','Weapon Proficiencies']],defaultValue:'',func:properCase,funcArgs:['pageData','Weapon Proficiencies'],returnFunc:true}
                
            ]
        },
        //End of generic mancer functions
        //End Charmancer functions
        
        //Mod Wizard
        
        wizardAttrs = [
            {
                section:'wizard',
                fields:['mod_value','effect_type','custom_type','affected_attribute','custom_attribute']
            }
        ],
        
        modWizard = function(event){
            const rowID = event.sourceAttribute.replace(/(repeating_[^_]+_[^_]+).+/,'$1'),
                attributeNames = [],
                setObj = {},
                modTypes = [
                    'armor','circumstance','divine','enhancement','insight','luck','morale','racial','max dex','custom'
                ],
                modAttributes = [
                    'strength','dexterity','constitution','intelligence','wisdom','charisma','initiative',
                    'sp','hp','rp','temp_hp','armor','acp','eac','kac','cmd','saves','fort','ref','will',
                    'skill points','skills',
                    'acrobatics','athletics','bluff','computers','culture','diplomacy','disguise','engineering',
                    'intimidate','life science','medicine','mysticism','perception','physical science',
                    'piloting','profession','sleight of hand','sense motive','stealth','survival',
                    'attack|section:attack,engagement_range:ranged','attack|section:attack,engagement_range:melee',
                    'attack','attack|section:attack','attack|section:spell','attack|section:ability','damage','damage|section:attack','damage|section:spell','damage|ability',
                    'encumber bulk','overburden bulk','dc','dc|section:ability','dc|spell','caster level','spell penetration',
                    'custom'
                ];
            attributeNames.push(`${rowID}_name`);
            attributeNames.push(`${rowID}_mods`);
            getID(JSON.parse(JSON.stringify(wizardAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        removeRepeatingRow(`repeating_wizard_${sid}`);
                    });
                });
                getAttrs(attributeNames,(attrs)=>{
                    let mods = [],
                        name = attrs[`${rowID}_name`];
                    setObj.item_to_mod = attrs[`${rowID}_name`];
                    setObj.mod_row_data = `${rowID}_mods`;
                    attrs[`${rowID}_mods`].replace(/(.+?)\s+(?:([a-z\s]+?)\s+)?to\s+(.+)/ig,(match,bonus,type,target)=>{
                        mods.push([bonus,type,target]);
                    });
                    _.each(mods,(mod)=>{
                        let newID = `repeating_wizard_${generateRowID()}_`;
                        
                        setObj[`${newID}mod_value`]=mod[0];
                        if(!mod[1]){
                            setObj[`${newID}effect_type`]=''
                        }else if(_.contains(modTypes,mod[1].replace(/_/g,' ').toLowerCase())){
                            setObj[`${newID}effect_type`]=`${mod[1]} `;
                        }else{
                            setObj[`${newID}effect_type`]='custom';
                            setObj[`${newID}custom_type`]=mod[1];
                        }
                        if(!mod[2]){
                            //do nothing
                        }else if(_.contains(modAttributes,mod[2].replace(/_/g,' ').toLowerCase())){
                            setObj[`${newID}affected_attribute`]=mod[2];
                        }else{
                            setObj[`${newID}affected_attribute`]='custom';
                            setObj[`${newID}custom_attribute`]=mod[2];
                        }
                    });
                    setAttrs(setObj,{silent:true});
                });
            });
        },
        
        templateMod = function(event){
            const templates = {
                [`armor template`]:[
                        {mod_value:'', effect_type:'armor ', affected_attribute:'eac'},
                        {mod_value:'', effect_type:'armor ', affected_attribute:'kac'},
                        {mod_value:'', effect_type:'max dex ', affected_attribute:'ac'},
                        {mod_value:'', effect_type:'', affected_attribute:'acp'}
                    ],
                [`global attack template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'attack'}
                ],
                [`global damage template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'damage'}
                ],
                [`weapon template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'attack|section:attack'},
                    {mod_value:'', effect_type:'', affected_attribute:'damage|section:attack'}
                ],
                [`backpack template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'encumber bulk'},
                    {mod_value:'', effect_type:'', affected_attribute:'overburden bulk'}
                ],
                [`global dc template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'dc'}
                ],
                [`spell template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'attack|section:spell'},
                    {mod_value:'', effect_type:'', affected_attribute:'damage|section:spell'},
                    {mod_value:'', effect_type:'', affected_attribute:'dc|section:spell'},
                    {mod_value:'', effect_type:'', affected_attribute:'custom', custom_attribute:'spell penetration|section:spell'}
                ],
                [`ability template`]:[
                    {mod_value:'', effect_type:'', affected_attribute:'attack|section:ability'},
                    {mod_value:'', effect_type:'', affected_attribute:'damage|section:ability'},
                    {mod_value:'', effect_type:'', affected_attribute:'dc|section:ability'},
                    {mod_value:'', effect_type:'', affected_attribute:'custom', custom_attribute:'spell penetration|section:ability'}
                ],
            },
            setObj = {
                mod_template:''
            };
            getID(JSON.parse(JSON.stringify(wizardAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        removeRepeatingRow(`repeating_wizard_${sid}`);
                    });
                });
                _.each(templates[event.newValue],(preset)=>{
                    let rowID = generateRowID();
                    _.each(_.keys(preset),(attr)=>{
                        setObj[`repeating_wizard_${rowID}_${attr}`] = preset[attr];
                    });
                });
                setAttrs(setObj,silent);
            });
        },
        
        //clear the mod wizard
        closeModWizard = function(){
            const setObj = {
                    item_to_mod:'',
                    mod_row_data:''
                };
            getID(JSON.parse(JSON.stringify(wizardAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        removeRepeatingRow(`repeating_wizard_${sid}`);
                    });
                });
                setAttrs(setObj,{silent:true});
            });
        },
        
        //apply the mod changes
        processModWizard = function(){
            const setObj = {
                    item_to_mod:'',
                    mod_row_data:''
                },
                attributeNames =['item_to_mod','mod_row_data'].concat(sheetAttributes),
                rowArray = [];
            getID(JSON.parse(JSON.stringify(wizardAttrs)),(sectionAggregate)=>{
                _.each(sectionAggregate,(section)=>{
                    _.each(section.id,(sid)=>{
                        _.each(section.fields,(f)=>{
                            attributeNames.push('repeating_wizard_'+sid+'_'+f);
                        });
                    });
                });
                getAttrs(attributeNames,(attributes)=>{
                    let effectType,affectedAttr;
                    try{
                        let wizardIDs = _.reduce(_.keys(attributes),(memo,key)=>{
                            key.replace(/(repeating_wizard_.+?)_mod_value/,(match,id)=>{
                                memo.push(id);
                            });
                            return memo;
                        },[]);
                        _.each(wizardIDs,(id)=>{
                            if(attributes[`${id}_mod_value`]&&(attributes[`${id}_affected_attribute`]||attributes[`${id}_custom_attribute`])){
                                if(setObj[attributes.mod_row_data]){
                                    setObj[attributes.mod_row_data]+='\n';
                                }else{
                                    setObj[attributes.mod_row_data]='';
                                }
                                if(attributes[`${id}_effect_type`]==='custom'){
                                    if(!attributes[`${id}_custom_type`] || /^\s*$/.test(attributes[`${id}_custom_type`])){
                                        effectType = '';
                                    }else{
                                        effectType = `${attributes[`${id}_custom_type`]} `;
                                    }
                                }else{
                                    effectType = attributes[`${id}_effect_type`];
                                }
                                if(attributes[`${id}_affected_attribute`]==='custom'){
                                    affectedAttr = attributes[`${id}_custom_attribute`];
                                }else{
                                    affectedAttr = attributes[`${id}_affected_attribute`];
                                }
                                setObj[attributes.mod_row_data] += `${attributes[`${id}_mod_value`]} ${effectType}to ${affectedAttr}`;
                            }
                            removeRepeatingRow(id);
                        });
                        setAttrs(setObj);
                    }catch(err){
                        TAS.log(`Something went wrong with your buff/penalty`);
                        TAS.log(`Error generated was: "${err.message}"`);
                    }
                });
            });
        },
        
        bootup = function(){
            //Only purpose is to log the character sheet version in the console log at start
            version.replace(/(\d+\.\d{3})(.+)/,(match,ver,buildDate)=>{
                TAS.log(`Starfinder Character Sheet v${ver}, build Date:${new Date(buildDate*1000)} loaded`);
            });
            /*var selectItem = _.reduce(equipment,(m,e)=>{
                return m+='<option value="'+e.name+'" data-i18n="'+e.name.replace(/\s+/g,'_')+'">'+e.name.toUpperCase()+'</option>';
            },'<select title='@{equipment_compendium}' name="attr_equipment_compendium">');
            selectItem+='</select>';
            TAS.log(JSON.stringify(selectItem));*/
            /*const newObj = {};
            _.each(attributeObjs,(ak)=>{
                newObj[(ak.repeating ? ak.repeating+'|' : '')+ak.attr]=ak;
            });
            TAS.log(JSON.stringify(newObj));*/
        };/*
        dropObjs.Classes=dropObjs.ability;
        dropObjs.Feat=dropObjs.ability;
        dropObjs.Feat['source'] = {
            data:['Category'],
            propagates_to: [],
            default_adds: [],
            default_value: '',
            translator: {
                Feats:'Feat'
            },
        };*/
        Object.assign(dropObjs.ability,dropObjs.spell);
        _.each([1,2,3,4,5],(num)=>{
            mancerObjs[`classDrops${num}`]=[];
            _.each(mancerObjs.classDrops,(drop)=>{
                let newDrop = _.clone(drop);
                newDrop.attr = `${newDrop.attr}_${num}`;
                mancerObjs[`classDrops${num}`].push(newDrop);
            });
        });
        return {
            Bootup: bootup,
            RegisterEventHandlers: RegisterEventHandlers
        };
    }());
    starfinder.Bootup();
    starfinder.RegisterEventHandlers();
    /*end of starfinder.js*/
</script>
<!-- End Script -->
<!-- End Sheet Code -->




