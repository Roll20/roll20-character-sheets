<div class="main_container" >
    <input class="npc_toggle" name="attr_npc" type="hidden" value="0"/>
    <button type="action" name="act_showpc" class="npc" style="margin-top:-10px ;margin-right: -50px; margin-bottom:-25px; z-index:1;"><span >NPC</span></button>
    <button type="action" name="act_shownpc" class="pc" style="margin-top:-10px ;margin-right: -50px; margin-bottom:-25px; z-index:1;"><span >PC</span></button>
    
    
    <div class="container npc">
         <div class="container npc_main flex-center">
            <div class="npc_name section">
			
                <div class="section-small flex-center npc_vlastnost">
                    <div><label>Jméno: </label></div><input name="attr_character_name" type="text" class="">
                </div>
				
                <div class="section-small flex-center npc_vlastnost">
                    <div><label>Rasa: </label></div><input name="attr_rasa_popis" type="text" class="">
					<select name="attr_npc_velikost" class="velikost"> 
                        <option value="0">A0</option>
                        <option value="1">A</option>
                        <option value="2">B</option>
                        <option value="3">C</option>
                        <option value="4">D</option>
                        <option value="5">E</option>
                    </select>
                </div>
				
                <div class="stat-block flex-center npc_vlastnost"> </div>
			   
                <div class="section-small flex-center npc_vlastnost">
					<div><label>Přesvědčení: </label></div>
					<select name="attr_npc_presvedc" class="velikost"> 
                        <option value="0">ZkD</option>
                        <option value="1">ZmD</option>
                        <option value="2">N</option>
                        <option value="3">ZmZ</option>
                        <option value="4">ZkZ</option>
                    </select>
                    <div><label>Životasch.: </label></div><input name="attr_npc_zivotasch" type="number" class="">
					<button type="action" class="npc_hp" name="act_npc_hp"><span >set HP</span></button>
                </div>

                <div class="stat-block flex-center npc_vlastnost">
                  <label>Síla</label>
                  <input name="attr_npc_sil" type="number" value="1">
                  <span name="attr_npc_sil_mod">-5</span>
               </div>
            
                <div class="stat-block flex-center npc_vlastnost"> 
                  <label>Odolnost</label>
                  <input name="attr_npc_odl" type="number" value="1">
                  <span name="attr_npc_odl_mod">-5</span>
                  <label>Bojovnost</label>
                  <input name="attr_npc_boj" type="number" value="1">
				  <button name="roll_bojovnost" type="roll"  value="&{template:Bojovnost} {{name=Bojovnost(@{npc_boj})}} {{mod=[[@{npc_boj}]]}} {{int=[[@{npc_int}]]}} {{Result=[[2d6]]}}"/>
                </div>
            
                <div class="stat-block flex-center npc_vlastnost">
                  <label>Obratnost</label>
                  <input name="attr_npc_obr" type="number" value="1">
                  <span name="attr_npc_obr_mod">-5</span>
                  <label>Manevr.</label>
                  <input name="attr_npc_manevr" type="number" value="">
                </div>
				
                <div class="stat-block flex-center npc_vlastnost">
                  <label>Inteligence</label>
                  <input name="attr_npc_int" type="number" value="1">
                  <span name="attr_npc_int_mod">-5</span>
                  <label>ZSM</label>
                  <input name="attr_npc_zsm" type="number" value="">
                </div>
            
                <div class="stat-block flex-center npc_vlastnost">
                  <label>Charisma</label>
                  <input name="attr_npc_chr" type="number" value="1">
                  <span name="attr_npc_chr_mod">-5</span>
                  <label>Ochočení</label>
                  <input name="attr_npc_ochoc" type="number" value="">
                </div>
				
                <div class="stat-block flex-center npc_vlastnost">
					<div><label>Zranitelnost</label></div>
					<input type="text" name="attr_npc_zran_info" />
                </div>
				
                <div class="stat-block flex-center npc_vlastnost">
					<div><label>Pohyblivost</label></div>
					<input type="text" name="attr_npc_pohyb_info" />
                </div>
				
                <div class="stat-block flex-center npc_vlastnost">
					<div><label>Vytrvalost</label></div>
					<input type="text" name="attr_npc_vytrva_info" />
                </div>
				
                <div class="section-small flex-center npc_vlastnost">
                    <div><label>Poklady: </label></div><input name="attr_npc_poklady" type="text" class="">
                </div>
				
                <div class="section-small flex-center npc_vlastnost">
                    <div><label>Zkušenost: </label></div><input name="attr_npc_zk" type="text" class="">
                </div>
				
            </div>
				
            <div class="npc_stav section">
                <div class="section-small flex-center points">
                  <label>Max Životů: </label>
                  <input name="attr_npc_hit_points_max" type="number" value="0">
                  <label>Max Magů: </label>
                  <input name="attr_npc_mag_points_max" type="number" value="0">
                </div>
                <div class="section-small flex-center">
                  <label>Stav: </label>
                  <input name="attr_npc_hit_points" type="number" value="0">
                  <label>Stav: </label>
                  <input name="attr_npc_mag_points" type="number" value="0">
                </div>
                <div class="section-small flex-center">
                  <span name="attr_npc_bojeschopnost"></span>
                </div>
            </div>
            
            <div class="npc_info section">
                <textarea name="attr_npc_info" style="min-height: 200px;min-width: 600px;"></textarea>
            </div>
			
            <div class="npc_utok section">
<!--			value="&{template:Utok} {{name=Útok}} {{dcil=@{boj_vzdalenostcile}}} {{dvel=@{boj_rozdilvelikosti}}} {{utocnost=@{ucutoc}}} {{zbran=@{boj_jmeno}}} {{tvt=[[@{boj_tvt}]]}} {{Result=[[(@{uc}) + 1d6! + (@{ucopr})]]}}"><span class="small">Útok</span></button>-->
				<div class="section-small flex-center">
					<button name="roll_npc_utok1" type="roll" style="width:90px" value="&{template:NPCUtok} {{name=NPC Útok}} {{zbran=@{npcboj1}}} {{utocnost=@{npcboj1_uto}}} {{vyrazen=[[@{npcboj_vyrazen}]]}} {{tvt=[[@{npcboj1_tvt}]]}}  {{Result=[[1d6! + (@{npcboj1_uc}) + (@{npcboj1_mod}) + (@{npc_bojeschopnost_mod})]]}}"><span >Útok1</span></button>
					<button name="roll_npc_utok2" type="roll" style="width:90px"  value="&{template:NPCUtok} {{name=NPC Útok}} {{zbran=@{npcboj2}}} {{utocnost=@{npcboj2_uto}}} {{vyrazen=[[@{npcboj_vyrazen}]]}} {{tvt=[[@{npcboj2_tvt}]]}}  {{Result=[[1d6! + (@{npcboj2_uc}) + (@{npcboj2_mod}) + (@{npc_bojeschopnost_mod})]]}}"><span >Útok2</span></button>
					<button name="roll_npc_utok3" type="roll" style="width:90px"  value="&{template:NPCUtok} {{name=NPC Útok}} {{zbran=@{npcboj3}}} {{utocnost=@{npcboj3_uto}}} {{vyrazen=[[@{npcboj_vyrazen}]]}} {{tvt=[[@{npcboj3_tvt}]]}}  {{Result=[[1d6! + (@{npcboj3_uc}) + (@{npcboj3_mod}) + (@{npc_bojeschopnost_mod})]]}}"><span >Útok3</span></button>
				</div>
                <div class="section-small flex-center popisky">
                    <label class="jmeno">Útoky</label>
                    <label>ÚČ</label>
                    <label>útoč.</label>
                    <label>OZ</label>
                    <label>2H?</label>
                    <label>tvt?</label>
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npcboj1" type="text" class="jmeno" value="">
                  <input name="attr_npcboj1_uc" type="number" value="">
                  <input name="attr_npcboj1_uto" type="number" value="">
                  <input name="attr_npcboj1_ozv" type="checkbox" class="2h" style="margin:0px;" value="1" />
                  <input name="attr_npcboj1_oz" type="number" value="">
                  <input name="attr_npcboj1_2h" type="checkbox" class="2h" value="1" />
                  <input name="attr_npcboj1_tvt" type="checkbox" class="2h" value="1" />
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npcboj2" type="text" class="jmeno" value="">
                  <input name="attr_npcboj2_uc" type="number" value="">
                  <input name="attr_npcboj2_uto" type="number" value="">
                  <input name="attr_npcboj2_ozv" type="checkbox" class="2h" style="margin:0px;" value="1" />
                  <input name="attr_npcboj2_oz" type="number" value="">
                  <input name="attr_npcboj2_2h" type="checkbox" class="2h" value="1" />
                  <input name="attr_npcboj2_tvt" type="checkbox" class="2h" value="1" />
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npcboj3" type="text" class="jmeno" value="">
                  <input name="attr_npcboj3_uc" type="number" value="">
                  <input name="attr_npcboj3_uto" type="number" value="">
                  <input name="attr_npcboj3_ozv" type="checkbox" class="2h" style="margin:0px;" value="1" />
                  <input name="attr_npcboj3_oz" type="number" value="">
                  <input name="attr_npcboj3_2h" type="checkbox" class="2h" value="1" />
                  <input name="attr_npcboj3_tvt" type="checkbox" class="2h" value="1" />
                </div>
			</div>
			
            <div class="npc_zbroj section">
<!--    <button name="roll_obrana_strel" type="roll" class="btnObrana" value="&{template:Obrana} {{name=Obrana}} {{voz=[[0]]}} {{ozvolba=[[0]]}}  {{zbran=@{boj_jmeno}}} {{vyrazeny=[[@{vyrazeny_volba}*@{level}]]}} {{Result=[[(@{oc}) + 1d6! + (@{ocopr}) ]]}}"></button> -->
				<button name="roll_npc_obrana" type="roll" style="width:90px" value="&{template:NPCObrana} {{name=NPC Obrana}}  {{voz=[[0]]}} {{zbran=@{npcboj1}}} {{vyrazen=[[@{npcboj_vyrazen}*@{npc_zivotasch}]]}} {{Result=[[1d6! + (@{npcboj_oc}) + (@{npc_obr_mod}) + (@{npcboj_opr})]]}}"><span >Obrana</span></button>
				<button name="roll_npc_obrana_oz" type="roll" style="width:90px" value="&{template:NPCObrana} {{name=NPC Obrana s OZ @{npcboj_oz}}}  {{voz=[[@{npcboj_oz}]]}} {{vyrazen=[[@{npcboj_vyrazen}*@{npc_zivotasch}]]}} {{Result=[[1d6! + (@{npcboj_oc}) + (@{npc_obr_mod}) + (@{npcboj_opr}) + (@{npcboj_oz})]]}}"><span >OZ</span></button>
				<button name="roll_npc_obrana_bez" type="roll" style="width:90px" value="&{template:NPCObrana} {{name=NPC Obrana s OZ -3}}  {{voz=[[-3]]}} {{vyrazen=[[@{npcboj_vyrazen}*@{npc_zivotasch}]]}} {{Result=[[1d6! + (@{npcboj_oc}) + (@{npc_obr_mod}) + (@{npcboj_opr}) + (-3)]]}}"><span >OZ-3</span></button>
                <div class="section-small flex-center popisky">
                    <label class="jmeno" style="width:200px">Zbroj</label>
                    <label>OČ</label>
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npczbroj1_use" type="checkbox" checked="checked" value="1"/>
                  <input name="attr_npczbroj1" type="text" class="jmeno" value="přirozená zbroj" readonly="readonly">
                  <input name="attr_npczbroj1_oc" type="number" value="1">
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npczbroj2_use" type="checkbox" value="1"/>
                  <input name="attr_npczbroj2" type="text" class="jmeno" value="štít"  readonly="readonly">
                  <input name="attr_npczbroj2_oc" type="number" value="1">
                </div>
                <div class="section-small flex-center radek">
                  <input name="attr_npczbroj3_use" type="checkbox" value="1"/>
                  <input name="attr_npczbroj3" type="text" class="jmeno" value="">
                  <input name="attr_npczbroj3_oc" type="number" value="">
                </div>
            </div>
			
        </div>
    </div>
    
    
    
    
    
<!--PC sekce-->    
    <div class="container pc">
<!--PC Hlavicka sekce--> 
        <div class="container pc_hlavicka flex-center">
            <div class="pc_name section">
                <div class="section-small flex-center">
                    <label>Jméno: </label>
                    <input name="attr_character_name" type="text" class="">
                </div>
                <div class="section-small flex-center">
                    <label>Povolání: </label>
                  <!--<input name="attr_race" type="text">-->
                    <select name="attr_povolani"> 
                        <option value="Alchymista">Alchymista</option>
                        <option value="Alchymista-Theurg">Alchymista - Theurg</option>
                        <option value="Alchymista-Pyrofor">Alchymista - Pyrofor</option>
                        <option value="Hraničář">Hraničář</option>
                        <option value="Hraničář-Druid">Hraničář - Druid</option>
                        <option value="Hraničář-Chodec">Hraničář - Chodec</option>
                        <option value="Kouzelník">Kouzelník</option>
                        <option value="Kouzelník-Mág">Kouzelník - Mág</option>
                        <option value="Kouzelník-Čaroděj">Kouzelník - Čaroděj</option>
                        <option value="Válečník">Válečník</option>
                        <option value="Válečník-Bojovník">Válečník - Bojovník</option>
                        <option value="Válečník-Šermíř">Válečník - Šermíř</option>
                        <option value="Zloděj">Zloděj</option>
                        <option value="Zloděj-Lupič">Zloděj - Lupič</option>
                        <option value="Zloděj-Sicco">Zloděj - Sicco</option>
                    </select>
                </div>
                <div class="section-small flex-center">
                    <label>Rasa: </label>
                  <!--<input name="attr_race" type="text">-->
                    <select name="attr_rasa"> 
                        <option value="Člověk">Člověk</option>
                        <option value="Barbar">Barbar</option>
                        <option value="Hobit">Hobit</option>
                        <option value="Elf">Elf</option>
                        <option value="Trpaslík">Trpaslík</option>
                        <option value="Kudůk">Kudůk</option>
                        <option value="Kroll">Kroll</option>
                    </select>
                    <select name="attr_velikost" class="velikost"> 
                        <option value="0">A0</option>
                        <option value="1">A</option>
                        <option value="2">B</option>
                        <option value="3">C</option>
                        <option value="4">D</option>
                        <option value="5">E</option>
                    </select>
                </div>
            </div>

            <div class="pc_stav section">
                <div class="section-small flex-center">
                    <input name="attr_level" type="number" class="level" value="1">
                    <span name="attr_bojeschopnost"></span>
                    <span name="attr_pretizeni"></span>
                </div>
                <div class="section-small flex-center points">
                  <label>Max Životů: </label>
                  <input name="attr_hit_points_max" type="number" value="0">
                  <label>Max Magů: </label>
                  <input name="attr_mag_points_max" type="number" value="0">
                </div>
                <div class="section-small flex-center">
                  <label>Stav: </label>
                  <input name="attr_hit_points" type="number" value="0">
                  <label>Stav: </label>
                  <input name="attr_mag_points" type="number" value="0">
                </div>
            </div>
            
            <div class="pc_akce section">
                <div class="section-small flex-center ucoc">
                    <div class="setradio flex-down">
                        <div><input type="checkbox" name="attr_nehybny_volba" value="1" /> Nehybný</div>
                        <div><input type="checkbox" name="attr_vyrazeny_volba" value="1" /> Vyřazený</div>
                        <div></div>
                    </div>
                    <button name="roll_pc_utok" type="roll" class="attack" value="&{template:Utok} {{name=Útok}} {{dcil=@{boj_vzdalenostcile}}} {{dvel=@{boj_rozdilvelikosti}}} {{utocnost=@{ucutoc}}} {{zbran=@{boj_jmeno}}} {{tvt=[[@{boj_tvt}]]}} {{Result=[[(@{uc}) + 1d6! + (@{ucopr})]]}}"><span class="small">Útok</span></button>
                    <div class="hodnoty"><span name="attr_uc" class="ucoc">0</span><label>základ</label></div>
                    <div class="hodnoty"><span name="attr_ucopr" class="ucoc">0</span><label>oprava</label></div>
                    <div class="hodnoty"><span name="attr_ucutoc" class="ucoc">0</span><label>útočnost</label></div>
                </div>
                <div class="section-small flex-center ucoc">
                    <div class="flex-down">
                        <button name="roll_pc_obrana_oz" type="roll" class="btnObrana" value="&{template:Obrana} {{name=Obrana}} {{voz=[[@{ocoz_base}]]}} {{ozvolba=[[1]]}}  {{zbran=@{boj_jmeno}}} {{vyrazeny=[[@{vyrazeny_volba}*@{level}]]}} {{Result=[[(@{oc}) + 1d6! + (@{ocopr}) + (@{ocoz_base}) ]]}}"></button>
                        <div><input type="radio" name="attr_oz_volba" class="oz_volba" value="1" checked="true"> OZ </div>
                    </div> 
                    <div class="flex-down">
                        <button name="roll_pc_obrana_bez" type="roll" class="btnObrana" value="&{template:Obrana} {{name=Obrana}} {{voz=[[-3]]}} {{ozvolba=[[-3]]}}  {{zbran=@{boj_jmeno}}} {{vyrazeny=[[@{vyrazeny_volba}*@{level}]]}} {{Result=[[(@{oc}) + 1d6! + (@{ocopr}) + (-3) ]]}}"></button>
                        <div><input type="radio" name="attr_oz_volba" class="oz_volba" value="-3"> bez</div>
                    </div>
                    <div class="flex-down">
                        <button name="roll_pc_obrana_strel" type="roll" class="btnObrana" value="&{template:Obrana} {{name=Obrana}} {{voz=[[0]]}} {{ozvolba=[[0]]}}  {{zbran=@{boj_jmeno}}} {{vyrazeny=[[@{vyrazeny_volba}*@{level}]]}} {{Result=[[(@{oc}) + 1d6! + (@{ocopr}) ]]}}"></button>
                        <div><input type="radio" name="attr_oz_volba" class="oz_volba" value="0"> střel.</div>
                    </div>
                    <div class="hodnoty"><span name="attr_oc" class="ucoc">0</span><label>základ</label></div>
                    <div class="hodnoty"><span name="attr_ocopr" class="ucoc">0</span><label>oprava</label></div>
                    <div class="hodnoty"><span name="attr_ocoz" class="ucoc">0</span><label>OZbraně</label></div>
                </div>
                <div class="flex-center"  style="background-color:white; width:265px; height:20px">
                    <label style="font-size:1.4em; font-weight:normal; margin:0px; padding-left:50px;">Obrana</label>
                    <button name="roll_init" type="roll" class="iniciativa" value="&{template:k10Vlastnost} {{name=Iniciativa}} {{Result=[[d6]]}} &{tracker}"><span>Iniciativa</span></button>
                </div>
            </div>   
        </div>
        
        <input class="pc_toggle_page" name="attr_pc_page" type="hidden" value="0"/>
        <div class="pc_selector">
            <div class="section-small flex-center">
                <button type="action" class="pc_main" name="act_showpc_main"><span >Hlavní</span></button>
                <button type="action" class="pc_schopnosti" name="act_showpc_schopnosti"><span >Schopnosti</span></button>
                <button type="action" class="pc_vybava" name="act_showpc_vybava"><span >Výbava</span></button>
               <button type="action" class="pc_pozn" name="act_showpc_pozn"><span >Pozn.</span></button>
            </div>
        </div>  
<!--PC Main sekce-->        
        <div class="container pc_main">
            <div class="pc_stats section">
                <div class="stat-block flex-center vlastnost">
                  <label>Síla</label>
                  <input name="attr_sil" type="number" value="1">
                  <span name="attr_sil_mod">-5</span>
                  <button name="roll_pc_sila" type="roll" value="&{template:k10Vlastnost} {{name=Sila}} {{Result=[[d10+(@{sil_mod})]]}}"></button>
                </div>
            
                <div class="stat-block flex-center vlastnost">
                  <label>Odolnost</label>
                  <input name="attr_odl" type="number" value="1">
                  <span name="attr_odl_mod">-5</span>
                  <button name="roll_pc_odolnost" type="roll" value="&{template:k10Vlastnost} {{name=Odolnost}} {{Result=[[d10+(@{odl_mod})]]}}"></button>
                </div>
            
                <div class="stat-block flex-center vlastnost">
                  <label>Obratnost</label>
                  <input name="attr_obr" type="number" value="1">
                  <span name="attr_obr_mod">-5</span>
                  <button name="roll_pc_obratnost" type="roll" value="&{template:k10Vlastnost} {{name=Obratnost}} {{Result=[[d10+(@{obr_mod})]]}}"></button>
                </div>
            
                <div class="stat-block flex-center vlastnost">
                  <label>Inteligence</label>
                  <input name="attr_int" type="number" value="1">
                  <span name="attr_int_mod">-5</span>
                  <button name="roll_pc_inteligence" type="roll" value="&{template:k10Vlastnost} {{name=Inteligence}} {{Result=[[d10+(@{int_mod})]]}}"></button>
                </div>
            
                <div class="stat-block flex-center vlastnost">
                  <label>Charisma</label>
                  <input name="attr_chr" type="number" value="1">
                  <span name="attr_chr_mod">-5</span>
                  <button name="roll_pc_charisma" type="roll" value="&{template:k10Vlastnost} {{name=Charisma}} {{Result=[[d10+(@{chr_mod})]]}}"></button>
                </div>
            
                <div class="stat-block flex-center vlastnost">
                  <label>Pohyblivost</label>
                  <input name="attr_poh" type="number" value="1">
                  <span name="attr_poh_mod">-5</span>
                  <button name="roll_pc_pohyblivost" type="roll" value="&{template:k10Vlastnost} {{name=Pohyblivost}} {{Result=[[d10+(@{poh_mod})]]}}"></button>
                </div>
                
                <div class="section-small flex-center pohyb">
                  <input type="radio" name="attr_nalozeni" value="0">
                  <label>žádné</label>
                  <span name="attr_poh_0_vaha" class="vaha">X</span>
                  <span name="attr_poh_0">X</span>
                  <span name="attr_poh_0_mod">X</span>
                </div>
                <div class="section-small flex-center pohyb">
                  <input type="radio" name="attr_nalozeni" value="1">
                  <label>mírmé</label>
                  <span name="attr_poh_1_vaha" class="vaha">X</span>
                  <span name="attr_poh_1">X</span>
                  <span name="attr_poh_1_mod">X</span>
                </div>
                <div class="section-small flex-center pohyb">
                  <input type="radio" name="attr_nalozeni" value="2">
                  <label>střední</label>
                  <span name="attr_poh_2_vaha" class="vaha">X</span>
                  <span name="attr_poh_2">X</span>
                  <span name="attr_poh_2_mod">X</span>
                </div>
                <div class="section-small flex-center pohyb">
                  <input type="radio" name="attr_nalozeni" value="3">
                  <label>velké</label>
                  <span name="attr_poh_3_vaha" class="vaha">X</span>
                  <span name="attr_poh_3">X</span>
                  <span name="attr_poh_3_mod">X</span>
                </div>
            
                 <div class="section-small flex-center mezi">
                  <label> </label>
                  <button name="roll_nahoda" type="roll" value="&{template:Hledani} {{name=Náhodný postřeh}} {{Obj=[[ 1d100 - (@{postreh_obj}) ]]}} {{Mech=[[ 1d100 - (@{postreh_mech}) ]]}}"><span >Postřeh</span></button>
                  <button name="roll_hledani" type="roll" value="&{template:Hledani} {{name=Hledání}}  {{Obj=[[ 1d100 - (@{postreh_obj_hledani}) ]]}} {{Mech=[[ 1d100 - (@{postreh_mech_hledani}) ]]}}"><span >Hledání</span></button>
                </div>
               <div class="stat-block flex-center hledani">
                  <label>Objekty</label>
                  <input name="attr_postreh_obj" type="number" value="3">
                  <input name="attr_postreh_obj_hledani" type="number" value="10">
                </div>
                <div class="stat-block flex-center hledani">
                  <label>Mechanismy</label>
                  <input name="attr_postreh_mech" type="number" value="3">
                  <input name="attr_postreh_mech_hledani" type="number" value="10">
                </div>
            </div>

        <!--        &{template:default} {{name=Trap}} {{Pikes=[[1d4]]}} {{Damages=[Throw](~PikesDamages$[[0]])}} -->
        <!-- [[1d4]] [[ $[[0]]d4 + 2*$[[0]] ]] -->
            
            <div class="pc_tvt section">
                <div class="section-small flex-center popisky">
                    <input name="attr_pc_bojaddtvt" type="hidden" class="pc_bojaddtvt_toggle" value="0"/>
                    <div class="pc_bojadd_button"><button type="action" name="act_pc_addtvt"><span >+</span></button></div>
                    <div class="pc_bojaddtvt_select"><select name="attr_add_zbran_tvt"> 
                        <option value="zadna">žádná</option>
                        <option value="dyka">dýka</option>
                        <option value="tesak">tesák</option>
                        <option value="kratky mec">krátký meč</option>
                        <option value="obusek">obušek</option>
                        <option value="palcat">palcát</option>
                        <option value="savle">šavle</option>
                        <option value="siroky mec">široký meč</option>
                        <option value="sekera">sekera</option>
                        <option value="kyj">kyj</option>
                        <option value="mec bastard">meč bastard</option>
                        <option value="dlouhy mec">dlouhý meč</option>
                        <option value="valecne kladivo">válečné kladivo</option>
                        <option value="remnich">řemnich</option>
                        <option value="hul okovana">hůl okovaná</option>
                        <option value="dve dyky">dvě dýky</option>
                        <option value="vidle">vidle</option>
                        <option value="kopi">kopí</option>
                        <option value="valecna sekera">válečná sekera</option>
                        <option value="sudlice">sudlice</option>
                        <option value="pika">píka</option>
                        <option value="tesak a dyka">tesák a dýka</option>
                        <option value="kratky mec a dyka">krátký meč a dýka</option>
                        <option value="cep">cep</option>
                        <option value="halapartna">halapartna</option>
                        <option value="obourucni mec">obouruční meč</option>
                        <option value="tezky kyj">těžký kyj</option>
                        <option value="trojzubec">trojzubec</option>
                        <option value="dve savle">dvě šavle</option>
                        <option value="siroky mec a dyka">široký meč a dýka</option>
                        <option value="siroky mec a tesak">široký meč a tesák</option>
                    </select></div>
                    <label class="jmeno">Zbraň pro boj TvT</label>
                    <label>2H?</label>
                    <label>ÚČ</label>
                    <label>útoč.</label>
                    <label>OZ</label>
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="tvt1">
                  <input name="attr_tvt1" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_tvt1_2h" class="2h" value="1" />
                  <input name="attr_tvt1_uc" type="number" value="">
                  <input name="attr_tvt1_uto" type="number" value="">
                  <input name="attr_tvt1_oz" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="tvt2">
                  <input name="attr_tvt2" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_tvt2_2h" class="2h" value="1" />
                  <input name="attr_tvt2_uc" type="number" value="">
                  <input name="attr_tvt2_uto" type="number" value="">
                  <input name="attr_tvt2_oz" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="tvt3">
                  <input name="attr_tvt3" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_tvt3_2h" class="2h" value="1" />
                  <input name="attr_tvt3_uc" type="number" value="">
                  <input name="attr_tvt3_uto" type="number" value="">
                  <input name="attr_tvt3_oz" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="tvt4">
                  <input name="attr_tvt4" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_tvt4_2h" class="2h" value="1" />
                  <input name="attr_tvt4_uc" type="number" value="">
                  <input name="attr_tvt4_uto" type="number" value="">
                  <input name="attr_tvt4_oz" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="tvt5">
                  <input name="attr_tvt5" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_tvt5_2h" class="2h" value="1" />
                  <input name="attr_tvt5_uc" type="number" value="">
                  <input name="attr_tvt5_uto" type="number" value="">
                  <input name="attr_tvt5_oz" type="number" value="">
                </div>
            </div>
            
            
            <div class="pc_strel section">
                <div class="section-small flex-center popisky">
                    <input name="attr_pc_bojaddstrel" type="hidden" class="pc_bojaddstrel_toggle" value="0"/>
                    <div class="pc_bojaddstrel_button"><button type="action" name="act_pc_addstrel"><span >+</span></button></div>
                    <div class="pc_bojaddstrel_select"><select name="attr_add_zbran_strel"> 
                        <option value="kratky luk">krátký luk</option>
                        <option value="dlouhy luk">dlouhý luk</option>
                        <option value="lehka kuse">lehká kuše</option>
                        <option value="tezka kuse">těžká kuše</option>
                        <option value="prak">prak</option>
                        <option value="dyka">dýka</option>
                        <option value="hvezdice">hvězdice</option>
                        <option value="kamen">kámen</option>
                        <option value="flakonek">flakónek</option>
                        <option value="lahev">lahev</option>
                        <option value="pochoden">pochodeň</option>
                        <option value="kopi">kopí</option>
                        <option value="ostep">oštěp</option>
                        <option value="sekera">sekera</option>
                        <option value="vidle">vidle</option>
                    </select></div>
                    <label class="jmeno">Zbraň pro střelbu</label>
                    <label>2H?</label>
                    <label>ÚČ</label>
                    <label>útoč.</label>
                    <label>min./střední/max.</label>
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="strel1">
                  <input name="attr_strel1" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_strel1_2h" class="2h" value="1" />
                  <input name="attr_strel1_uc" type="number" value="">
                  <input name="attr_strel1_uto" type="number" value="">
                  <input name="attr_strel1_maly" type="number" value="">
                  <input name="attr_strel1_stredni" type="number" value="">
                  <input name="attr_strel1_velky" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="strel2">
                   <input name="attr_strel2" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_strel2_2h" class="2h" value="1" />
                  <input name="attr_strel2_uc" type="number" value="">
                  <input name="attr_strel2_uto" type="number" value="">
                  <input name="attr_strel2_maly" type="number" value="">
                  <input name="attr_strel2_stredni" type="number" value="">
                  <input name="attr_strel2_velky" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="strel3">
                   <input name="attr_strel3" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_strel3_2h" class="2h" value="1" />
                  <input name="attr_strel3_uc" type="number" value="">
                  <input name="attr_strel3_uto" type="number" value="">
                  <input name="attr_strel3_maly" type="number" value="">
                  <input name="attr_strel3_stredni" type="number" value="">
                  <input name="attr_strel3_velky" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                    <input type="radio" name="attr_zbran" value="strel4">
                   <input name="attr_strel4" type="text" class="jmeno" value="">
                   <input type="checkbox" name="attr_strel4_2h" class="2h" value="1" />
                 <input name="attr_strel4_uc" type="number" value="">
                  <input name="attr_strel4_uto" type="number" value="">
                  <input name="attr_strel4_maly" type="number" value="">
                  <input name="attr_strel4_stredni" type="number" value="">
                  <input name="attr_strel4_velky" type="number" value="">
                </div>
            </div>
            
            <div class="pc_zbroj section">
                <div class="section-small flex-center popisky">
                    <input name="attr_pc_bojaddzbroj" type="hidden" class="pc_bojaddzbroj_toggle" value="0"/>
                    <div class="pc_bojaddzbroj_button"><button type="action" name="act_pc_addzbroj"><span >+</span></button></div>
                    <div class="pc_bojaddzbroj_select"><select name="attr_add_zbran_zbroj"> 
                        <option value="stit">štít</option>
                        <option value="bezezbroje">bezezbroje</option>
                        <option value="vycpavane">vycpávané</option>
                        <option value="kozene">kožené</option>
                        <option value="supinove">šupinové</option>
                        <option value="krouzkove">kroužkové</option>
                        <option value="platove">plátové</option>
                        <option value="rytirska zbroj">rytířská zbroj</option>
                    </select></div>
                    <label class="jmeno">Zbroj</label>
                    <label>štít?</label>
                    <label>OČ</label>
                </div>
                <div class="section-small flex-center radek">
                  <input type="checkbox" name="attr_zbroj1_use" value="1"/>
                  <input name="attr_zbroj1" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_zbroj1_stit" class="2h" value="1" />
                  <input name="attr_zbroj1_oc" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                  <input type="checkbox" name="attr_zbroj2_use" value="1" />
                  <input name="attr_zbroj2" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_zbroj2_stit" class="2h" value="1" />
                  <input name="attr_zbroj2_oc" type="number" value="">
                </div>
                <div class="section-small flex-center radek">
                  <input type="checkbox" name="attr_zbroj3_use" value="1" />
                  <input name="attr_zbroj3" type="text" class="jmeno" value="">
                  <input type="checkbox" name="attr_zbroj3_stit" class="2h" value="1" />
                  <input name="attr_zbroj3_oc" type="number" value="">
                </div>
            </div>
        </div>
        
<!--PC Schopnosti sekce-->        
        <div class="container pc_schopnosti">
            <div class="container pc_sch_main">
                
               <div class="pc_sch_dovednost section">
                    <div class="grid gear"  style="height:200px;">
                        <h3>Dovednosti</h3>
                        <fieldset class="repeating_Dovednost" style="vertical-align: baseline;">
                            <div class="grid-contents gear-details flex-center" >
                                <div>
                                    <input type="text"  style="width:160px; margin:0px; padding:0px; font-weight:bold; font-size: 1em; height:20px;" name="attr_DovednostJmeno" />
                                    <div class="grid-contents gear-details flex-center" >
                                        <div class="pc_dovednost_select" style="width:110px;">
                                            <select name="attr_DovednostUroven" style="width:110px; margin:0px; padding:0px; "> 
                                                <option value="0">vůbec</option>
                                                <option value="1">velmi špatně</option>
                                                <option value="2">špatně</option>
                                                <option value="3">průměrně</option>
                                                <option value="4">dobře</option>
                                                <option value="5">velmi dobře</option>
                                                <option value="6">dokonale</option>
                                            </select>
                                        </div>
                                        <div class="pc_dovednost_select" style="width:60px;">
                                            <select name="attr_DovednostVlastnost"  style="width:60px; margin:0px; padding:0px; "> 
                                                <option value="1">SIL</option>
                                                <option value="2">OBR</option>
                                                <option value="3">ODL</option>
                                                <option value="4">INT</option>
                                                <option value="5">CHR</option>
                                            </select>
                                        </div>
                                     </div>
                                 </div>
                                 <button name="roll_past" style="width:70px; margin:0px; padding:0px; " type="roll" value="&{template:Past} {{name=@{DovednostJmeno}}} {{hod1=[[1d10+@{sil_mod}]]}} {{hod2=[[1d10+@{obr_mod}]]}} {{hod3=[[1d10+@{odl_mod}]]}} {{hod4=[[1d10+@{int_mod}]]}} {{hod5=[[1d10+@{chr_mod}]]}} {{vlastnost=[[@{DovednostVlastnost}]]}} {{uroven=[[@{DovednostUroven}]]}}"><span >Past</span></button> 
                            </div> 
                            <div class="grid-contents gear-details flex-center" >
                                <textarea class="gear-description" name="attrDovednostPopis" style="height:20px;min-width:200px; min-height:20px;max-width:200px;">ověření:</textarea>
                            </div>
                        </fieldset>
                    </div>
                </div>
                
                <div class="pc_sch_pozn1 section">
                    <textarea class="gear-description" name="attr_DovednostPopis1" style="min-height:230px;min-width:200px; " ></textarea>
                </div>
                
                <div class="pc_sch_pozn2 section">
                    <textarea class="gear-description" name="attr_DovednostPopis2" style="min-height:230px;min-width:200px; "></textarea>
                </div>
                
             </div>
                
        </div>
<!--PC Pozn sekce-->        
        <div class="container pc_pozn">
            <div class="container pc_pozn_main">
			
				<div  class="pc_pozn_souhrn section">
					<div class="top" style="position: relative; top: 10px;">
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Věk</span></div>
							<input type="text" name="attr_age">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Rozměry</span></div>
							<input type="text" name="attr_size">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Výška</span></div>
							<input type="text" name="attr_height">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Váha</span></div>
							<input type="text" name="attr_weight">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Oči</span></div>
							<input type="text" name="attr_eyes">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Kůže</span></div>
							<input type="text" name="attr_skin">
						</div>
						<div class="hlabel-container flex-center">
							<div><span class="pozn_label" >Vlasy</span></div>
							<input type="text" name="attr_hair">
						</div>
					</div>
				</div>

                <div class="pc_pozn_vzhled section">
					<span >Vzhled<br></span>
                    <textarea class="gear-description" name="attr_vzhled" style="min-height:100px;min-width:400px; " ></textarea>
                </div>
				
                <div class="pc_pozn_pribeh section">
					<span >Příběh/Pozadí<br></span>
                    <textarea class="gear-description" name="attr_pribeh" style="min-height:100px;min-width:400px; " ></textarea>
                </div>
			</div>	
        </div>
        
<!--PC Vybava sekce-->        
        <div class="container pc_vybava">
            <div class="container pc_vybava_main">
                
                <div class="pc_vybava_mince section flex-center"  style="height:60px;">
                    <div>
                        <div class="section-small flex-center">
                            <div style="width:50px;"><label>zlato: </label></div><input name="attr_mince_zl" type="number" style="width:60px;" value="0">
                        </div>
                        <div class="section-small flex-center">
                            <div style="width:50px;"><label>stříbro: </label></div><input name="attr_mince_st" type="number" style="width:60px;" value="0">
                        </div>
                        <div class="section-small flex-center">
                            <div style="width:50px;"><label>měď: </label></div><input name="attr_mince_med" type="number" style="width:60px;" value="0">
                        </div>
                    </div>
                    <div style="margin-left:20px;">
                        <h3>Celková váha</h3>
                        <div  style="vertical-align: baseline;">
                            <input name="attr_vaha_celkem" style="font-size: 1.5em; vertical-align: baseline;" type="number" value="0">
                            <span style="font-size: 1.5em; ">mn</span>
                        </div>
                    </div>
                </div>
                
                
                <div class="pc_vybava_poklad section">
                    <div class="grid gear"  style="height:100px;">
                        <h3>Poklady</h3>
                        <div class="grid-contents gear-titles head flex-center" style="background-color:#dddddd;">
                            <div style="width:150px;"><span class="head left">Jméno</span></div>
                            <div style="width:55px;"><span class="head">cena</span></div>
                            <div style="width:55px;"><span class="head">váha</span></div>
                            <div style="width:55px;"><span class="head">počet</span></div>
                        </div>
                        <fieldset class="repeating_poklad">
                            <div class="grid-contents gear-details flex-center" >
                                <input type="text" style="width:150px;"  name="attr_poklad_jmeno" />
                                <input type="number" style="width:50px;"  name="attr_poklad_cena" />
                                <input type="number" style="width:50px;"  name="attr_poklad_vaha" />
                                <input type="number" style="width:50px;"  name="attr_poklad_pocet" />
                            </div>
                        </fieldset>
                    </div>
                </div>
                
                
                <div class="pc_vybava_vybaveni section">
                    <div class="grid gear"  style="height:100px;">
                        <h3>Vybaveni</h3>
                        <div class="grid-contents gear-titles head flex-center" style="background-color:#dddddd;">
                            <div style="width:150px;"><span class="head left">Jméno</span></div>
                            <div style="width:55px;"><span class="head">váha</span></div>
                            <div style="width:55px;"><span class="head">počet</span></div>
                        </div>
                        <fieldset class="repeating_vybaveni">
                            <div class="grid-contents gear-details flex-center" >
                                <input type="text" style="width:150px;"  name="attr_vybaveni_jmeno" />
                                <input type="number" style="width:50px;"  name="attr_vybaveni_vaha" />
                                <input type="number" style="width:50px;"  name="attr_vybaveni_pocet" />
                            </div>
                        </fieldset>
                    </div>
                </div>
                
                
                <div class="pc_vybava_pozn section">
                    <textarea class="gear-description" name="attr_VybavaPopis"></textarea>
                </div>
                
                
            </div>
        </div>
        
    </div>
    
</div>





<input name="attr_sil_mod" type="hidden" value="-5">
<input name="attr_int_mod" type="hidden" value="-5">
<input name="attr_chr_mod" type="hidden" value="-5">
<input name="attr_odl_mod" type="hidden" value="-5">
<input name="attr_obr_mod" type="hidden" value="-5">
<input name="attr_poh_mod" type="hidden" value="-5">
<input name="attr_poh_0_vaha" type="hidden" value="(mn)">
<input name="attr_poh_0"      type="hidden" value="0">
<input name="attr_poh_0_mod"  type="hidden" value="0">
<input name="attr_poh_1_vaha" type="hidden" value="(mn)">
<input name="attr_poh_1"      type="hidden" value="0">
<input name="attr_poh_1_mod"  type="hidden" value="0">
<input name="attr_poh_2_vaha" type="hidden" value="(mn)">
<input name="attr_poh_2"      type="hidden" value="0">
<input name="attr_poh_2_mod"  type="hidden" value="0">
<input name="attr_poh_3_vaha" type="hidden" value="(mn)">
<input name="attr_poh_3"      type="hidden" value="0">
<input name="attr_poh_3_mod"  type="hidden" value="0">
<input name="attr_nosnost"       type="hidden" value="510">
<input name="attr_nalozeni"      type="hidden" value="-1">
<input name="attr_pretizeni"     type="hidden" value="">
<input name="attr_pretizeni_mod" type="hidden" value="0">
<input name="attr_bojeschopnost"               type="hidden" value="">
<input name="attr_bojeschopnost_mod"           type="hidden" value="0">
<input name="attr_bojeschopnost_tretina_zivotu"type="hidden" value="0">
<input name="attr_bojeschopnost_mez_vyrazeni"  type="hidden" value="0">
<input name="attr_bojeschopnost_mod_vyrazeni"  type="hidden" value="0">
<input name="attr_uc"           type="hidden" value="0">
<input name="attr_oc"           type="hidden" value="0">
<input name="attr_ucopr"        type="hidden" value="0">
<input name="attr_ocopr"        type="hidden" value="0">
<input name="attr_ucutoc"       type="hidden" value="0">
<input name="attr_ocoz"         type="hidden" value="-3">
<input name="attr_ocoz_base"    type="hidden" value="-3">

<input name="attr_boj_id"     type="hidden" value="-1">
<input name="attr_boj_jmeno"  type="hidden" value="0">
<input name="attr_boj_uc"     type="hidden" value="0">
<input name="attr_boj_uto"    type="hidden" value="0">
<input name="attr_boj_oz"     type="hidden" value="0">
<input name="attr_boj_tvt"    type="hidden" value="0">
<input name="attr_boj_bez"    type="hidden" value="0">
<input name="attr_boj_h2"     type="hidden" value="0">
<input name="attr_boj_rod"    type="hidden" value="0">
<input name="attr_boj_ocstit" type="hidden" value="0">
<input name="attr_boj_oc"     type="hidden" value="0">

<input name="attr_vaha_vybaveni"  type="hidden" value="0">
<input name="attr_vaha_poklad"  type="hidden" value="0">

<input name="attr_npc_sil_mod" type="hidden" value="-5">
<input name="attr_npc_int_mod" type="hidden" value="-5">
<input name="attr_npc_chr_mod" type="hidden" value="-5">
<input name="attr_npc_odl_mod" type="hidden" value="-5">
<input name="attr_npc_obr_mod" type="hidden" value="-5">

<input name="attr_npcboj1_mod" type="hidden" value="0">
<input name="attr_npcboj2_mod" type="hidden" value="0">
<input name="attr_npcboj3_mod" type="hidden" value="0">

<input name="attr_npcboj_oz"  type="hidden" value="0">
<input name="attr_npcboj_opr"  type="hidden" value="0">
<input name="attr_npcboj_oc"   type="hidden" value="0">
<input name="attr_npcboj_vyrazen"                  type="hidden" value="0">
<input name="attr_npc_bojeschopnost"               type="hidden" value="">
<input name="attr_npc_bojeschopnost_mod"           type="hidden" value="0">
<input name="attr_npc_bojeschopnost_tretina_zivotu"type="hidden" value="0">
<input name="attr_npc_bojeschopnost_mez_vyrazeni"  type="hidden" value="0">
<input name="attr_npc_bojeschopnost_mod_vyrazeni"  type="hidden" value="0">


<div class="rolltemplates">
    
    
<rolltemplate class="sheet-rolltemplate-Hledani">
    <div class="container">
        <div><h1>{{name}}</h1></div>
        <div class="arrow-container"><div class="arrow-right"></div></div>
        <div class="flex-center">
            <div class="tvysledky" > {{Obj}}% <br> {{Mech}}% </div>
            <div class="thlavicka" > <span class="tcat"> - Objekty</span><br><span class="tcat"> - Mechanismy</span></div>
        </div>
    </div>
</rolltemplate>
    
<rolltemplate class="sheet-rolltemplate-Obrana">
    <div class="container">
        <div class="flex-center">
            <h1>
            {{#ozvolba}}{{#rollTotal() ozvolba 0}}střel. {{/rollTotal() ozvolba 0}}{{#^rollTotal() ozvolba 0}}tvt {{/^rollTotal() ozvolba 0}}{{/ozvolba}}
            {{name}}
            </h1>
            {{#ozvolba}}{{#^rollTotal() ozvolba 0}}<span class="nowrap"> - {{zbran}}</span>{{/^rollTotal() ozvolba 0}}{{/ozvolba}}
        </div>
        <div class="flex-center subheader"><div class="big doprava">{{Result}}</div></div>
        <div class="arrow-container"><div class="arrow-right"></div></div>
        {{#ozvolba}}
            {{#rollTotal() ozvolba 0}}<div class="rowsmall"><span class="tcat"> + oprava za úkryt +1 až +4</span>}}</div>{{/rollTotal() ozvolba 0}}
        {{/ozvolba}}
        {{#vyrazeny}}
            {{#^rollTotal() vyrazeny 0}}<div style="background-color:#FAA"><span class="tcat">Vyřazený:<br> výsledné zranění * 
				{{#rollGreater() vyrazeny 9}}<b>9</b>{{/rollGreater() vyrazeny 9}}
				{{#^rollGreater() vyrazeny 9}}{{vyrazeny}}{{/^rollGreater() vyrazeny 9}}
			</span></div>{{/^rollTotal() vyrazeny 0}}
        {{/vyrazeny}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-Utok">
    <div class="container">
        <div class="flex-center">
            <h1>
                {{#tvt}}{{#rollTotal() tvt 0}}střel. {{/rollTotal() tvt 0}}{{#rollTotal() tvt 1}}tvt {{/rollTotal() tvt 1}}{{/tvt}}
                {{name}}
            </h1>
            <span class="nowrap"> - {{zbran}}</span>
        </div>
        <div class="flex-center subheader"><div class="big doprava">{{Result}}</div> +útoč. <div class="big doprava">{{utocnost}}</div></div>
        <div class="arrow-container"><div class="arrow-right"></div></div>
        <div class="rowsmall"><span class="tcat">{{dvel}}</span></div>
        {{#tvt}}{{#rollTotal() tvt 0}}<div class="rowsmall"><span class="tcat">{{dcil}}</span></div>{{/rollTotal() tvt 0}}{{/tvt}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-k10Vlastnost">
    <div class="container flex-center">
        <div class="tvysledky">{{Result}}</div>
        <div class="thlavicka"><h1>{{name}}</h1></div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-Past">
    <div class="container flex-center">
        <div class="tvysledky">{{#vlastnost}}
        {{#rollTotal() vlastnost 1}} {{#hod1}} {{hod1}} {{/hod1}} {{/rollTotal() vlastnost 1}}
        {{#rollTotal() vlastnost 2}} {{#hod2}} {{hod2}} {{/hod2}} {{/rollTotal() vlastnost 2}}
        {{#rollTotal() vlastnost 3}} {{#hod3}} {{hod3}} {{/hod3}} {{/rollTotal() vlastnost 3}}
        {{#rollTotal() vlastnost 4}} {{#hod4}} {{hod4}} {{/hod4}} {{/rollTotal() vlastnost 4}}
        {{#rollTotal() vlastnost 5}} {{#hod5}} {{hod5}} {{/hod5}} {{/rollTotal() vlastnost 5}}
        {{/vlastnost}}</div>
        <div class="thlavicka"><h1>{{name}}</h1> past cca 
        {{#rollTotal() uroven 0}} 14 {{/rollTotal() uroven 0}}
        {{#rollTotal() uroven 1}} 11 {{/rollTotal() uroven 1}}
        {{#rollTotal() uroven 2}} 8 {{/rollTotal() uroven 2}}
        {{#rollTotal() uroven 3}} 5 {{/rollTotal() uroven 3}}
        {{#rollTotal() uroven 4}} 2 {{/rollTotal() uroven 4}}
        {{#rollTotal() uroven 5}} -1 {{/rollTotal() uroven 5}}
        {{#rollTotal() uroven 6}} -4 {{/rollTotal() uroven 6}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-Bojovnost">
    <div class="container flex-center">
	{{#rollLess() int 9}}
        <div class="tvysledky">{{Result}}</div>
        <div class="thlavicka">{{name}}</div>
    </div>
    <div class="container flex-center">
        {{#rollGreater() Result mod}} nechce bojovat {{/rollGreater() Result mod}}
        {{#^rollGreater() Result mod}} útočí {{/^rollGreater() Result mod}}
	{{/rollLess() int 9}}
	{{#^rollLess() int 9}}Bojovnost<br>Nestvůra je moc inteligentní{{/^rollLess() int 9}}
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-NPCUtok">
    <div class="container">
<!--	value="&{template:NPCUtok} {{name=NPC Útok}} {{zbran=@{npcboj1}}} {{utocnost=@{npcboj1_uto}}} {{vyrazen=[[@{npcboj_vyrazen}]]}} {{tvt=[[@{npcboj1_tvt}]]}}  {{Result=[[[[(@{npcboj1_uc}) + (@{npcboj1_mod}) + 1d6! + (@{npcboj_opr})]]]]}}"/ -->
        <div class="flex-center">
            <h1>
                {{#tvt}}{{#rollTotal() tvt 0}}střel. {{/rollTotal() tvt 0}}{{#rollTotal() tvt 1}}tvt {{/rollTotal() tvt 1}}{{/tvt}}
                {{name}}
            </h1>
            <span class="nowrap"> - {{zbran}}</span>
        </div>
        <div class="flex-center subheader"><div class="big doprava">
			{{Result}}</div> +útoč. <div class="big doprava">{{utocnost}}</div>
		{{#rollTotal() vyrazen 1}}
		</div>
        <div class="flex-center subheader"><div class="big doprava">
			Vyřazená postava nemůže útočit
		</div>	
		{{/rollTotal() vyrazen 1}}
		</div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-NPCObrana">
    <div class="container">
<!--	"&{template:NPCObrana} {{name=NPC Obrana}}  {{voz=[[0]]}} {{ozvolba=[[0]]}} {{zbran=@{npcboj1}}} {{vyrazen=[[@{npcboj_vyrazen}*@{npc_zivotasch}]]}} {{Result=[[1d6! + (@{npcboj_oc}) + (@{npc_obr_mod}) + (@{npcboj_opr})]]}}" -->
        <div class="flex-center">
            <h1>{{name}}</h1>
       </div>
        <div class="flex-center subheader"><div class="big doprava">{{Result}}</div></div>
        <div class="arrow-container"><div class="arrow-right"></div></div>
        {{#vyrazeny}}
            {{#^rollTotal() vyrazeny 0}}<div style="background-color:#FAA"><span class="tcat">Vyřazený?:<br> výsledné zranění * {{vyrazeny}}</span></div>{{/^rollTotal() vyrazeny 0}}
        {{/vyrazeny}}
    </div>
</rolltemplate>

</div>        



<script type="text/worker">
const int = score => parseInt(score, 10) || 0;

/* ===== PARAMETERS ==========
destinations = the name of the attribute that stores the total quantity
        can be a single attribute, or an array: ['total_cost', 'total_weight']
        If more than one, the matching fields must be in the same order. 
    section = name of repeating fieldset, without the repeating_
    fields = the name of the attribute field to be summed
          destination and fields both can be a single attribute: 'weight'
          or an array of attributes: ['weight','number','equipped']
*/
const repeatingSum = (destinations, section, fields) => {
    if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
    if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
    getSectionIDs(`repeating_${section}`, idArray => {
        const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
        getAttrs([...attrArray], v => {
            const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
            const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
            const output = {};
            destinations.forEach((destination, index) => {
                output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
            });
            setAttrs(output);
        }); 
    }); 
};




var tab_tvt = {
    "zadna":              { jmeno:"žádná",               uc:0, uto:0,  oz:-3, h2:0 },
    "dyka":               { jmeno:"dýka",                uc:2, uto:0,  oz:-2, h2:0 },
    "tesak":              { jmeno:"tesák",               uc:3, uto:-1, oz:-2, h2:0 },
    "kratky mec":         { jmeno:"krátký meč",          uc:3, uto:-1, oz:-2, h2:0 },
    "obusek":             { jmeno:"obušek",              uc:3, uto:-2, oz:-2, h2:0 },
    "palcat":             { jmeno:"palcát",              uc:3, uto:1,  oz:-1, h2:0 },
    "savle":              { jmeno:"šavle",               uc:4, uto:2,  oz:1,  h2:0 },
    "siroky mec":         { jmeno:"široký meč",          uc:5, uto:0,  oz:0,  h2:0 },
    "sekera":             { jmeno:"sekera",              uc:3, uto:1,  oz:-1, h2:0 },
    "kyj":                { jmeno:"kyj",                 uc:3, uto:2,  oz:-1, h2:0 },
    "mec bastard":        { jmeno:"meč bastard",         uc:6, uto:0,  oz:1,  h2:0 },
    "dlouhy mec":         { jmeno:"dlouhý meč",          uc:7, uto:-1, oz:0,  h2:0 },
    "valecne kladivo":    { jmeno:"válečné kladivo",     uc:5, uto:5,  oz:-1, h2:0 },
    "remnich":            { jmeno:"řemnich",             uc:4, uto:3,  oz:-2, h2:0 },
    "hul okovana":        { jmeno:"hůl okovaná",         uc:5, uto:-1, oz:1,  h2:1 },
    "dve dyky":           { jmeno:"dvě dýky",            uc:3, uto:1,  oz:2,  h2:1 },
    "vidle":              { jmeno:"vidle",               uc:4, uto:0,  oz:1,  h2:1 },
    "kopi":               { jmeno:"kopí",                uc:5, uto:0,  oz:1,  h2:1 },
    "valecna sekera":     { jmeno:"válečná sekera",      uc:4, uto:3,  oz:-1, h2:1 },
    "sudlice":            { jmeno:"sudlice",             uc:5, uto:1,  oz:1,  h2:1 },
    "pika":               { jmeno:"píka",                uc:5, uto:2,  oz:1,  h2:1 },
    "tesak a dyka":       { jmeno:"tesák a dýka",        uc:4, uto:0,  oz:2,  h2:1 },
    "kratky mec a dyka":  { jmeno:"krátký meč a dýka",   uc:5, uto:0,  oz:3,  h2:1 },
    "cep":                { jmeno:"cep",                 uc:5, uto:4,  oz:-1, h2:1 },
    "halapartna":         { jmeno:"halapartna",          uc:4, uto:6,  oz:2,  h2:1 },
    "obourucni mec":      { jmeno:"obouruční meč",       uc:7, uto:1,  oz:-1, h2:1 },
    "tezky kyj":          { jmeno:"těžký kyj",           uc:5, uto:4,  oz:-1, h2:1 },
    "trojzubec":          { jmeno:"trojzubec",           uc:6, uto:2,  oz:2,  h2:1 },
    "dve savle":          { jmeno:"dvě šavle",           uc:8, uto:-2, oz:3,  h2:1 },
    "siroky mec a dyka":  { jmeno:"široký meč a dýka",   uc:5, uto:-1, oz:2,  h2:1 },
    "siroky mec a tesak": { jmeno:"široký meč a tesák",  uc:6, uto:-2, oz:2,  h2:1 }
};
var tab_strel = {
    "kratky luk": { jmeno:"krátký luk", uc:4, uto:0,  maly:10, stredni:20, velky:30, h2:1 },
    "dlouhy luk": { jmeno:"dlouhý luk", uc:5, uto:1,  maly:15, stredni:30, velky:50, h2:1 },
    "lehka kuse": { jmeno:"lehká kuše", uc:4, uto:1,  maly:15, stredni:27, velky:40, h2:1 },
    "tezka kuse": { jmeno:"těžká kuše", uc:6, uto:2,  maly:19, stredni:35, velky:55, h2:1 },
    "prak":       { jmeno:"prak",       uc:4, uto:-1,  maly:9, stredni:16, velky:25, h2:0 },
    "dyka":       { jmeno:"dýka",       uc:2, uto:0,  maly:5, stredni:9, velky:12, h2:0 },
    "hvezdice":   { jmeno:"hvězdice",   uc:3, uto:-1,  maly:3, stredni:7, velky:11, h2:0 },
    "kamen":      { jmeno:"kámen",      uc:1, uto:0,  maly:7, stredni:11, velky:15, h2:0 },
    "flakonek":   { jmeno:"flakónek",   uc:0, uto:0,  maly:5, stredni:9, velky:13, h2:0 },
    "lahev":      { jmeno:"lahev",      uc:0, uto:1,  maly:4, stredni:7, velky:10, h2:0 },
    "pochoden":   { jmeno:"pochodeň",   uc:0, uto:1,  maly:4, stredni:7, velky:10, h2:0 },
    "kopi":       { jmeno:"kopí",       uc:5, uto:0,  maly:5, stredni:10, velky:15, h2:1 },
    "ostep":      { jmeno:"oštěp",      uc:5, uto:1,  maly:6, stredni:14, velky:23, h2:0 },
    "sekera":     { jmeno:"sekera",     uc:3, uto:1,  maly:4, stredni:8, velky:12, h2:0 },
    "vidle":      { jmeno:"vidle",      uc:4, uto:0,  maly:3, stredni:5, velky:7, h2:1 }
};
var tab_zbroj = {
    "stit": { jmeno:"štít", oc:1, stit:1 },
    "bezezbroje": { jmeno:"bezezbroje", oc:1, stit:0 },
    "vycpavane": { jmeno:"vycpávané", oc:2, stit:0 },
    "kozene": { jmeno:"kožené", oc:3, stit:0 },
    "supinove": { jmeno:"šupinové", oc:4, stit:0 },
    "krouzkove": { jmeno:"kroužkové", oc:5, stit:0 },
    "platove": { jmeno:"plátové", oc:6, stit:0 },
    "rytirska zbroj": { jmeno:"rytířská zbroj", oc:7, stit:0 }
};


var stripstring = 
    'AAAAAAACEEEEIIII'+
    'DNOOOOO.OUUUUY..'+
    'aaaaaaaceeeeiiii'+
    'dnooooo.ouuuuy.y'+
    'AaAaAaCcCcCcCcDd'+
    'DdEeEeEeEeEeGgGg'+
    'GgGgHhHhIiIiIiIi'+
    'IiIiJjKkkLlLlLlL'+
    'lJlNnNnNnnNnOoOo'+
    'OoOoRrRrRrSsSsSs'+
    'SsTtTtTtUuUuUuUu'+
    'UuUuWwYyYZzZzZz.';

function removeDia(str){
    var answer='';
    for(var i=0;i<str.length;i++){
        var ch=str[i];
        var chindex=ch.charCodeAt(0)-192;   // Index of character code in the strip string
        if(chindex>=0 && chindex<stripstring.length){
            // Character is within our table, so we can strip the accent...
            var outch=stripstring.charAt(chindex);
            // ...unless it was shown as a '.'
            if(outch!='.')ch=outch;
        }
        answer+=ch;
    }
    return answer;
}


var update_bonus = function (attr) {
    const tab_bonus = [-5,-5,-4,-4,-3,-3,-2,-2,-1,-1,0,0,0,1,1,2,2,3,3,4,4,5];
    getAttrs([attr], function(values) {
        var stat_base = int(values[attr]);
/*        console.log("hodnota "+stat_base);*/
        var _base = Math.min(21, Math.max(1, stat_base));
        var _stat_bonus = tab_bonus[_base];
        var _update = {};
        _update[attr + "_mod"] = _stat_bonus;
        _update[attr] = _base;
        setAttrs(_update);
    });
};

var update_npcbonus = function (attr) {
    const tab_bonus = [-5,-5,-4,-4,-3,-3,-2,-2,-1,-1,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10];
    getAttrs([attr], function(values) {
        var stat_base = int(values[attr]);
/*        console.log("hodnota "+stat_base);*/
        var _base = Math.min(32, Math.max(1, stat_base));
        var _stat_bonus = tab_bonus[_base];
        var _update = {};
        _update[attr + "_mod"] = _stat_bonus;
        _update[attr] = _base;
        setAttrs(_update);
    });
};

var update_nosnost = function () {
    getAttrs(["sil_mod"], function(v) {
        var _nosnost = 210 + 30 * ( int(v.sil_mod) + 5);
        setAttrs({ nosnost: _nosnost });
		
    });
};

var set_nosnost = function (sb) {
    var _nosnost = 210 + 30 * ( int(sb) + 5);
    setAttrs({ nosnost: _nosnost });
    return _nosnost;
};

var update_pohyblivost = function () {
   getAttrs(["sil_mod","obr_mod","rasa"], function(values) {
        const rasova_pohyblivost = { Barbar:12, Elf:12, Člověk:11, Kroll:11, Hobit:10, Kudůk:9, Trpaslík:8 };
        var _nosnost = set_nosnost(int(values.sil_mod));
        console.log("nosnost"+_nosnost);
        var _pohyblivost = rasova_pohyblivost[values.rasa] + int(values.obr_mod) + ( int(values.sil_mod)  * 2 );
        var _update = {};
        _update["poh_0"] = _pohyblivost;
        _update["poh_0_vaha"] = "až "+_nosnost+"mn";
        _update["poh_1"] = Math.ceil(_pohyblivost * 0.75);
        _update["poh_1_vaha"] = "až "+(_nosnost * 2)+"mn";
        _update["poh_2"] = Math.ceil(_pohyblivost * 0.5);
        _update["poh_2_vaha"] = "až "+(_nosnost * 3)+"mn";
        _update["poh_3"] = Math.ceil(_pohyblivost * 0.25);
        _update["poh_3_vaha"] = "až "+(_nosnost * 4)+"mn";
        setAttrs(_update);
    });
};

var setZbran = function(_zbran) {
	if( typeof(_zbran) == "undefined" || _zbran == "-1" ){
			setAttrs({zbran:"tvt1"});
		return null;
	};
	getAttrs([_zbran, _zbran+"_uc", _zbran+"_uto", _zbran+"_oz", _zbran+"_2h",_zbran+"_maly",_zbran+"_stredni",_zbran+"_velky","rasa","velikost",
			"zbroj1_use","zbroj1_stit","zbroj1_oc","zbroj2_use","zbroj2_stit","zbroj2_oc","zbroj3_use","zbroj3_stit","zbroj3_oc"], function(values) {
		var rasa = values["rasa"];
		console.log("aktualizuju zbran");
		var Zbran = [];
		Zbran["id"] = _zbran;
        if( typeof(values[_zbran]) == "undefined") { Zbran["jmeno"] = "Bezejmenná";} else { Zbran["jmeno"] = values[_zbran]; };
        if( typeof(values[_zbran+"_uc"]) == "undefined") { Zbran["uc"] = "";} else { Zbran["uc"] = int(values[_zbran+"_uc"]); };
        if( typeof(values[_zbran+"_uto"]) == "undefined") { Zbran["uto"] = "";} else { Zbran["uto"] = int(values[_zbran+"_uto"]); };
        if( typeof(values[_zbran+"_oz"]) == "undefined") { Zbran["oz"] = "";} else { Zbran["oz"] = int(values[_zbran+"_oz"]); };
        if( typeof(values[_zbran+"_2h"]) == "undefined") { Zbran["h2"] = "";} else { Zbran["h2"] = int(values[_zbran+"_2h"]); };
        if( typeof(values[_zbran+"_maly"]) == "undefined") { Zbran["m"] = "";} else { Zbran["m"] = int(values[_zbran+"_maly"]); };
        if( typeof(values[_zbran+"_stredni"]) == "undefined") { Zbran["s"] = "";} else { Zbran["s"] = int(values[_zbran+"_stredni"]); };
        if( typeof(values[_zbran+"_velky"]) == "undefined") { Zbran["v"] = "";} else { Zbran["v"] = int(values[_zbran+"_velky"]); };


		
		Zbran["bez"] = 1;
		if( Zbran["uc"] != "") { Zbran["bez"] = 0; } else { Zbran["jmeno"] = "bezezbraně"; };
		Zbran["tvt"] = 1;
		if(_zbran.includes("strel") && Zbran["bez"] != 1) Zbran["tvt"] = 0; 
		
		Zbran["rod"] = 0;
		if(Zbran["bez"] == 0) {
			var zjmeno = removeDia(Zbran["jmeno"]).toLowerCase();
//			console.log("jmeno zbrane - " + zjmeno);
			if( rasa=="Barbar"   && Zbran["uc"]==6 && Zbran["uto"]==0 && Zbran["h2"]==0 && Zbran["tvt"]==1 && Zbran["oz"]==1  && zjmeno.includes("mec bastard")) Zbran["rod"] = 1;
			if( rasa=="Elf"      && Zbran["uc"]==5 && Zbran["uto"]==1 && Zbran["h2"]==1 && Zbran["tvt"]==0                    && zjmeno.includes("dlouhy luk")  ) Zbran["rod"] = 1;
			if( rasa=="Člověk"   && Zbran["uc"]==5 && Zbran["uto"]==0 && Zbran["h2"]==0 && Zbran["tvt"]==1 && Zbran["oz"]==0  && zjmeno.includes("siroky mec") ) Zbran["rod"] = 1;
			if( rasa=="Kroll"    && Zbran["uc"]==5 && Zbran["uto"]==4 && Zbran["h2"]==1 && Zbran["tvt"]==1 && Zbran["oz"]==-1 && zjmeno.includes("tezky kyj")  ) Zbran["rod"] = 1;
			if( rasa=="Hobit"    && Zbran["uc"]==4 && Zbran["uto"]==1 && Zbran["h2"]==1 && Zbran["tvt"]==0                    && zjmeno.includes("lehka kus")  ) Zbran["rod"] = 1;
			if( rasa=="Kudůk"    && Zbran["uc"]==3 && Zbran["uto"]==1 && Zbran["h2"]==0                                       && zjmeno.includes("sekera")     ) Zbran["rod"] = 1;
			if( rasa=="Trpaslík" && Zbran["uc"]==4 && Zbran["uto"]==3 && Zbran["h2"]==1 && Zbran["tvt"]==1 && Zbran["oz"]==-1 && zjmeno.includes("valecna sekera")) Zbran["rod"] = 1;
		};
		
		Zbran["oc"] = 0;
		if(values["zbroj1_use"] == 1 && values["zbroj1_stit"] != 1 && typeof(values["zbroj1_oc"]) != "undefined" ) Zbran["oc"] = Zbran["oc"] + int(values["zbroj1_oc"]);
		if(values["zbroj2_use"] == 1 && values["zbroj2_stit"] != 1 && typeof(values["zbroj2_oc"]) != "undefined" ) Zbran["oc"] = Zbran["oc"] + int(values["zbroj2_oc"]);
		if(values["zbroj3_use"] == 1 && values["zbroj3_stit"] != 1 && typeof(values["zbroj3_oc"]) != "undefined" ) Zbran["oc"] = Zbran["oc"] + int(values["zbroj3_oc"]);
		Zbran["oc"] = Math.max(1, Zbran["oc"]);

		Zbran["ocstit"] = 0;
		if( Zbran["h2"] != 1 ) {
			if(values["zbroj1_use"] == 1 && values["zbroj1_stit"] == 1 && typeof(values["zbroj1_oc"]) != "undefined" ) Zbran["ocstit"] = Zbran["ocstit"] + int(values["zbroj1_oc"]);
			if(values["zbroj2_use"] == 1 && values["zbroj2_stit"] == 1 && typeof(values["zbroj2_oc"]) != "undefined" ) Zbran["ocstit"] = Zbran["ocstit"] + int(values["zbroj2_oc"]);
			if(values["zbroj3_use"] == 1 && values["zbroj3_stit"] == 1 && typeof(values["zbroj3_oc"]) != "undefined" ) Zbran["ocstit"] = Zbran["ocstit"] + int(values["zbroj3_oc"]);
		};
		
		if( Zbran["bez"] == 1 ){
			Zbran["oz"] = -3;
			if( Zbran["ocstit"] > 0) Zbran["oz"] = 0;
		};
		

		if( Zbran["tvt"] == 1 ){
		    var tabOpravVelikossti = ["A-2,B-3,C-4,D-5,E-7","A0+2,B-1,C-2,D-3,E-4","A0+3,A+1,C-1,D-2,E-3","A0+4,A+2,B+1,D-1,E-2","B+2,C+1,E-1","A0-2,A-1,C+2,D+1"];
		    Zbran["rozdilvelikosti"] = "+ rozdil velikosti: " + tabOpravVelikossti[int(values.velikost)];
		} else {
		    Zbran["rozdilvelikosti"] = "+ velikost cíle (A0: -1 až -2)(D,E: +1)";
		    Zbran["vzdalenostcile"] = "+ vzdalenost cíle až: "+Zbran["m"]+"s(+1),"+Zbran["s"]+"s,"+Zbran["v"]+"s(-1)";
		};



		aktZbran = {};
		for(var key in Zbran) {
			aktZbran["boj_"+key] = Zbran[key];
		};

		setAttrs(aktZbran);
	});
};

var findTvToz = function(jmeno) {
    var oz = -2;
    var zbrane = { kopi:1, vidle:1, sekera:-1};
    switch (removeDia(jmeno)){
       case "kopi":
            oz = 1;break;
       case "vidle":
            oz = 1;break;
       case "sekera":
            oz = -1;break;
       default:
            oz = -2;break;
    };
    return oz;
};
 
var setZbranFromTemp = function(jmeno, pozice) {

    
    if(pozice.includes("tvt")==true){
        var aktZbran = {};
        var zbran = tab_tvt[jmeno];
        aktZbran[pozice+"_oz"] = zbran.oz;
        aktZbran[pozice+"_uc"] = zbran.uc;
        aktZbran[pozice+"_uto"] = zbran.uto;
        aktZbran[pozice+"_2h"] = zbran.h2;
        aktZbran[pozice] = zbran.jmeno;
        aktZbran["zbran"] = pozice;
        
    	setAttrs(aktZbran);
    };
    if(pozice.includes("strel")==true){
        var aktZbran = {};
        var zbran = tab_strel[jmeno];
        aktZbran[pozice+"_maly"] = zbran.maly;
        aktZbran[pozice+"_stredni"] = zbran.stredni;
        aktZbran[pozice+"_velky"] = zbran.velky;
        aktZbran[pozice+"_uc"] = zbran.uc;
        aktZbran[pozice+"_uto"] = zbran.uto;
        aktZbran[pozice+"_2h"] = zbran.h2;
        aktZbran[pozice] = zbran.jmeno;
        aktZbran["zbran"] = pozice;
        
    	setAttrs(aktZbran);
    };
    
    
    if(pozice.includes("zbroj")==true){
        var aktZbroj = {};
        var zbroj = tab_zbroj[jmeno];
        aktZbroj[pozice+"_oc"] = zbroj.oc;
        aktZbroj[pozice+"_stit"] = zbroj.stit;
        aktZbroj[pozice] = zbroj.jmeno;
        aktZbroj[pozice+"_use"] = 0;
    	setAttrs(aktZbroj);
    	aktZbroj[pozice+"_use"] = 1;
    	setAttrs(aktZbroj);
    };
    
};

/*---------------------------Výpočet POSTREHU ----------------- */

 on("change:int change:level change:obr_mod change:rasa change:povolani", function() {
    getAttrs(["int","int_mod","rasa","povolani","level","obr_mod"], function(values) {
        var intel = int(values.int);
        var intelb = int(values.int_mod);
        var rasa = values.rasa;
        var obj_rasa = 0;
        var mech_rasa = 0;
        if( rasa == "Barbar" || rasa == "Kroll" || rasa == "Trpaslík" ) obj_rasa = 5;
        if( rasa == "Elf" || rasa == "Hobit" || rasa == "Kudůk" ) mech_rasa = 5;
        
        var lvl = int(values.level);
        var obr = int(values.obr_mod);
        var pov = values.povolani;
        var obj_zlodej = 0;
        var mech_zlodej = 0;
        var nobj_zlodej = 0;
        var nmech_zlodej = 0;
       if( pov.includes("Zloděj") ) {
            obj_zlodej = (lvl * 5) + 10 + (3 * obr);
            nobj_zlodej = obr;
            mech_zlodej = (lvl * 5) + 5 + (2 * obr);
            nmech_zlodej = obr + Math.ceil(lvl/2);
        }
        var tabobj = [39,43,47,50,54,59,63,66,70,74];
        if(pov == "Zloděj-Sicco" && lvl > 5 && lvl < 16) {
            obj_zlodej = tabobj[(lvl-6)] + (3 * obr);
            mech_zlodej = ((lvl-5) * 4) + 30 + (2 * obr);
        }
       
        setAttrs({ postreh_mech: intelb + nmech_zlodej });
        setAttrs({ postreh_obj: intelb + nobj_zlodej});
        setAttrs({ postreh_mech_hledani: Math.floor(intel/2) + mech_rasa + mech_zlodej });
        setAttrs({ postreh_obj_hledani: intel + obj_rasa + obj_zlodej });
    });
});







on("clicked:showpc", function(eventinfo) {
    setAttrs({npc: "0"});
});
on("clicked:shownpc", function(eventinfo) {
    setAttrs({npc: "1"});
});

on("clicked:showpc_main", function(eventinfo) {
    console.log("values 0");
    setAttrs({pc_page: "0"});
});
on("clicked:showpc_schopnosti", function(eventinfo) {
    console.log("values 1");
    setAttrs({pc_page: "1"});
});
on("clicked:showpc_vybava", function(eventinfo) {
    console.log("values 2");
    setAttrs({pc_page: "2"});
});
on("clicked:showpc_pozn", function(eventinfo) {
    console.log("values 3");
    setAttrs({pc_page: "3"});
});

on("clicked:npc_hp", function(eventinfo) {
//    console.log("počítám životaschopnost");
    getAttrs(["npc_zivotasch","npc_odl_mod"], function(values) {
		var ziv = int(values.npc_zivotasch);
		var mod = int(values.npc_odl_mod);
		var celkem = 0;
		var i;
		for (i = 0; i < ziv; i++) {
			var hod = Math.max(1,Math.ceil(Math.random() * 8) + mod);
			celkem = celkem + hod;
		};
		setAttrs({npc_hit_points_max: celkem});
		setAttrs({npc_hit_points: celkem});
		var min = Math.max(1,1 + mod)*ziv;
		var max = (8 + mod)*ziv;
		var proc = Math.ceil((celkem - min)/(max-min) * 100);
		console.log(""+ celkem +" -> "+min+" až "+max+" -> "+ proc+"%");
	});
});



["sil", "int", "chr", "odl", "obr","poh","poh_0","poh_1","poh_2","poh_3"].forEach(stat => {
    on(`change:${stat}`, () => {
        update_bonus(stat);
    });
});

["npc_sil", "npc_int", "npc_chr", "npc_odl", "npc_obr"].forEach(stat => {
    on(`change:${stat}`, () => {
        update_npcbonus(stat);
    });
});

/*---------------------------Výpočet POHYBLIVOSTI ----------------- */

on("change:sil_mod change:obr_mod change:rasa change:nosnost", function() {
    update_pohyblivost();
});

on("change:poh_0 change:poh_1 change:poh_2 change:poh_3 change:nosnost", function() {
    getAttrs(["nalozeni"], function(values) {
		if(values.nalozeni == "-1") setAttrs({ nalozeni: 0 });
	});
});
	

/*--------- Presunuti výberu nalozeni do Statu Pohyblivosti----------------- */

on("change:nalozeni", function() {
    getAttrs(["nalozeni"], function(values) {
        var nalozeni = values.nalozeni;
        var co = "poh_" + values.nalozeni;
        getAttrs([co], function(values) {
            setAttrs({ poh: int(values[co]) });
        });
        
        if(nalozeni == 3){
            setAttrs({ pretizeni: "Naložen (-1)"});
            setAttrs({ pretizeni_mod: "-1"});
        } else {
            setAttrs({ pretizeni: ""});
            setAttrs({ pretizeni_mod: "0"});
        }
    });
});

/*---------------------------Výpočet BOJESCHOPNOSTI ----------------- */

on("change:hit_points change:odl", function() {
    getAttrs(["odl","hit_points","hit_points_max"], function(values) {
        const odolnost = int(values.odl);
        var zivotu_max = int(values.hit_points_max);
        var tretina = Math.floor(zivotu_max/3);
        var _bojeschopnost_mod = "-3";
        var vyrazeni =  Math.floor(zivotu_max/4);
        if (odolnost >= 17) {
            _bojeschopnost_mod = "0";
            vyrazeni =  1;
        } else if (odolnost >= 12) { 
            _bojeschopnost_mod = "-1";
            vyrazeni =  Math.floor(zivotu_max/8);
        } else if (odolnost >= 6) { 
            _bojeschopnost_mod = "-2";
            vyrazeni =  Math.floor(zivotu_max/6);
        }
        
        var bojeschopnost = "Mrtev (X)";
        var bojeschopnost_mod = "X";
        var zivotu = int(values.hit_points);
        if(zivotu <= 0) {
        } else if (zivotu <= vyrazeni) {
          bojeschopnost = "Vyřazen (X)";  
        } else if (zivotu <= tretina) { 
            bojeschopnost = "Zraněn ("+_bojeschopnost_mod+")";
            bojeschopnost_mod = _bojeschopnost_mod;
        } else {
            bojeschopnost = "";
            bojeschopnost_mod = "0";
        } 
        
        setAttrs({ "bojeschopnost": bojeschopnost });
        setAttrs({ "bojeschopnost_mod": bojeschopnost_mod });
        setAttrs({ "bojeschopnost_tretina_zivotu": tretina });
        setAttrs({ "bojeschopnost_mez_vyrazeni": vyrazeni });
        setAttrs({ "bojeschopnost_mod_vyrazeni": _bojeschopnost_mod });

    });
});

on("change:bojeschopnost_mod", function() {
    getAttrs(["bojeschopnost_mod","nehybny_volba","vyrazeny_volba"], function(values) {
        if(values.bojeschopnost_mod.includes("X")){
            setAttrs({ "nehybny_volba": 0 }); 
            setAttrs({ "vyrazeny_volba": 1 }); 
        } else if(values.vyrazeny_volba == 1) setAttrs({ "vyrazeny_volba": 0 });
    });
});

on("change:vyrazeny_volba", function() {
    getAttrs(["nehybny_volba","vyrazeny_volba"], function(values) {
        if(values.vyrazeny_volba == 1) setAttrs({ "nehybny_volba": 0 });
    });
});

on("change:nehybny_volba", function() {
    getAttrs(["nehybny_volba","vyrazeny_volba"], function(values) {
        if(values.nehybny_volba == 1) setAttrs({ "vyrazeny_volba": 0 });
    });
});


/* ********* zmena zbrane ******* */
on("change:zbran change:zbroj1_use change:zbroj2_use change:zbroj3_use change:velikost", function() {
    getAttrs(["zbran"], function(values) {
		setZbran(values["zbran"]);
    });
});

["tvt1_oz", "tvt1_uc", "tvt1_uto", "tvt1_2h","tvt2_oz", "tvt2_uc", "tvt2_uto", "tvt2_2h","tvt3_oz", "tvt3_uc", "tvt3_uto", "tvt3_2h","tvt4_oz", "tvt4_uc", "tvt4_uto", "tvt4_2h","tvt5_oz", "tvt5_uc", "tvt5_uto", "tvt5_2h",
"strel1_uc", "strel1_uto", "strel1_2h","strel1_maly","strel1_stredni","strel1_velky","strel2_uc", "strel2_uto", "strel2_2h","strel2_maly","strel2_stredni","strel2_velky",
"strel3_uc", "strel3_uto", "strel3_2h","strel3_maly","strel3_stredni","strel3_velky","strel4_uc", "strel4_uto", "strel4_2h","strel4_maly","strel4_stredni","strel4_velky",].forEach(stat => {
    on(`change:${stat}`, () => {
        console.log("zmena parametru zbrane");
        getAttrs(["zbran"], function(values) {
            setZbran(values.zbran);
        });
    });
});


 /******* OČ a UČ **********************************/

on("change:sil_mod change:obr_mod change:pretizeni_mod change:bojeschopnost_mod change:boj_id change:boj_uc change:boj_uto change:boj_oz change:boj_oc change:boj_ocstit change:nehybny_volba change:vyrazeny_volba change:oz_volba", function() {
	var ids = ["boj_id","boj_jmeno","boj_uc","boj_uto","boj_oz","boj_tvt","boj_bez","boj_h2","boj_rod","boj_ocstit","boj_oc"];
	getAttrs(["sil_mod","obr_mod","pretizeni_mod","bojeschopnost_mod","rasa","oz_volba","nehybny_volba","vyrazeny_volba",
	        "boj_id","boj_jmeno","boj_uc","boj_uto","boj_oz","boj_tvt","boj_bez","boj_h2","boj_rod","boj_ocstit","boj_oc"], function(values) {
//            console.log("values " + values[_zbran+"_OZ"]);

		if( values.boj_id == "-1" ){
				setAttrs({zbran:"tvt1"});
			return null;
		};
		var UC = 0;
		var OC = 0;
		var UCopr = 0;
		var OCopr = 0;
		var OCoz = -3;
		
		var Boj = [];
		for(var key in ids) Boj[ids[key]] = values[ids[key]];

		var pretizeni = int(values.pretizeni_mod);
		var OZv = int(values.oz_volba);
		var Nehybny = 0;
		if(( values.nehybny_volba == 1) || ( values.bojeschopnost_mod.includes("X") &&  values.vyrazeny_volba != 1)) Nehybny = 1;
		var Vyrazeny = 0;
		if(( values.vyrazeny_volba == 1) || ( values.bojeschopnost_mod.includes("X") &&  values.nehybny_volba != 1)) Vyrazeny = 1;
		var bojeschopen = 1;
		
		if ( values.bojeschopnost_mod.includes("X") || Nehybny == 1 || Vyrazeny == 1 ) bojeschopen = 0;
//		console.log(values.bojeschopnost_mod.includes("X") + " | " + Nehybny + " | " + Vyrazeny + " -> " + bojeschopen);
			

		
//              Zakladni OC/UC ***********************************
		OC = Boj["boj_oc"];
		OC = Math.max(0,int(values.obr_mod) + OC )
		setAttrs({ "oc": OC });
		
		if(Boj["boj_tvt"] == 1) UC = Math.max(0,int(values.sil_mod) + Boj["boj_uc"] + Boj["boj_rod"]);
		if(Boj["boj_tvt"] != 1) UC = Math.max(0,int(values.obr_mod) + Boj["boj_uc"] + Boj["boj_rod"]);
			
		if(bojeschopen == 0) UC = "X";
		setAttrs({ "uc": UC });
	  
		
//           Opravy ******************************************		
		
		if(bojeschopen != 1) {
		    OCopr = OCopr - int(values["obr_mod"]) - 5;
			OCoz = -3;
		};
		
		if(bojeschopen == 1){
			OCopr = OCopr +	Boj["boj_ocstit"]
			OCopr = OCopr + int(values["pretizeni_mod"]) + int(values["bojeschopnost_mod"]);
			
			if(Boj["boj_bez"] == 1 && Boj["boj_ocstit"] > 0) {
			    // bezezbrane se stitem
				OCoz = 0;
			} else if( Boj["boj_tvt"] == 1 ){
			    // tvt
				OCoz = int(Boj["boj_oz"]);
			} else if( Boj["boj_tvt"] != 1){
				// strelecka zbran a jeji eqivalent v tvt
				OCoz = findTvToz(Boj["boj_jmeno"]);
			};
		};
		
		setAttrs({ "ocoz_base": OCoz });
		
		if(bojeschopen == 1 && OZv < 1) OCoz = OZv;
		
		setAttrs({ "ocopr": OCopr });
		setAttrs({ "ocoz": OCoz });
		
		if(bojeschopen == 1){
			UCopr = UCopr + int(values["pretizeni_mod"]) + int(values["bojeschopnost_mod"]); 
		};
		setAttrs({ "ucopr": UCopr });
		setAttrs({ "ucutoc": Boj["boj_uto"] });
	});
});

on("clicked:pc_addtvt", function() {
	getAttrs(["pc_bojaddtvt"], function(values) {
	    //console.log("clik na add  boj");
	    var val = values.pc_bojaddtvt;
	    if(val == "0") {val = "1";} else {val = "0";};
	    setAttrs({ "pc_bojaddtvt": val });
	});
});
on("clicked:pc_addstrel", function() {
	getAttrs(["pc_bojaddstrel"], function(values) {
	    //console.log("clik na add  boj");
	    var val = values.pc_bojaddstrel;
	    if(val == "0") {val = "1";} else {val = "0";};
	    setAttrs({ "pc_bojaddstrel": val });
	});
});

on("clicked:pc_addzbroj", function() {
	getAttrs(["pc_bojaddzbroj"], function(values) {
	    //console.log("clik na add  boj");
	    var val = values.pc_bojaddzbroj;
	    if(val == "0") {val = "1";} else {val = "0";};
	    setAttrs({ "pc_bojaddzbroj": val });
	});
});


on("change:add_zbran_tvt", function() {
	getAttrs(["add_zbran_tvt","zbran","tvt1","tvt2","tvt3","tvt4","tvt5"], function(values) {
	    console.log("vybrana zbran je "+values.add_zbran_tvt+" na pozici "+ values.zbran);
	    var zbran = values.zbran;
	    if(values.zbran.includes("tvt") == false ){
	        if(values.tvt1 == "") { zbran = "tvt1"; 
	        } else if(values.tvt2 == "") { zbran = "tvt2";  
	        } else if(values.tvt3 == "") { zbran = "tvt3";  
	        } else if(values.tvt4 == "") { zbran = "tvt4";  
	        } else if(values.tvt5 == "") { zbran = "tvt5";
	        } else return null;
	    };
	    setZbranFromTemp(values.add_zbran_tvt, zbran);
	});
});
on("change:add_zbran_strel", function() {
	getAttrs(["add_zbran_strel","zbran","strel1","strel2","strel3","strel4"], function(values) {
	    console.log("vybrana zbran je "+values.add_zbran_strel+" na pozici "+ values.zbran);
	    var zbran = values.zbran;
	    if(values.zbran.includes("strel") == false ){
	        if(values.strel1 == "") { zbran = "strel1"; 
	        } else if(values.strel2 == "") { zbran = "strel2";  
	        } else if(values.strel3 == "") { zbran = "strel3";  
	        } else if(values.strel4 == "") { zbran = "strel4";  
	        } else return null;
	    };
	    setZbranFromTemp(values.add_zbran_strel, zbran);
	});
});

on("change:add_zbran_zbroj", function() {
	getAttrs(["add_zbran_zbroj","zbroj1_use","zbroj2_use","zbroj3_use","zbroj1_stit","zbroj2_stit","zbroj3_stit"], function(values) {
//	    console.log("vybrana zbran je "+values.add_zbran_zbroj);
	    var zbroj = "";
	    if(values["zbroj1_use"] == 1) { zbroj = "zbroj1"; 
        } else if(values["zbroj2_use"] == 1) { zbroj = "zbroj2";  
        } else if(values["zbroj3_use"] == 1) { zbroj = "zbroj3";  
        } else return null;
        
	    console.log(" na pozici "+ zbroj);
	    setZbranFromTemp(values.add_zbran_zbroj, zbroj);
	});
});


on('change:repeating_vybaveni remove:repeating_vybaveni', function() {
	repeatingSum("vaha_vybaveni","vybaveni",["vybaveni_vaha","vybaveni_pocet"]);
});

on('change:repeating_poklad remove:repeating_poklad', function() {
	repeatingSum("vaha_poklad","poklad",["poklad_vaha","poklad_pocet"]);
});

on('change:vaha_vybaveni change:vaha_poklad change:mince_zl change:mince_st change:mince_med', function() {
    getAttrs(["vaha_vybaveni","vaha_poklad","mince_zl","mince_st","mince_med"], v => {
        var celkem = 0;
        celkem = celkem + int(v.vaha_vybaveni) + int(v.vaha_poklad) + int(v.mince_zl) + int(v.mince_st) + int(v.mince_med);
        setAttrs({"vaha_celkem": celkem});
    });	
});

on('change:vaha_celkem', function() {
    getAttrs(["vaha_celkem","nosnost"], v => {
        var celkem = Math.ceil(int(v.vaha_celkem)/int(v.nosnost))-1;
        setAttrs({"nalozeni": celkem});
    });	
});



on('change:npc_obr_mod change:npcboj1_ozv change:npcboj1_oz change:npcboj2_ozv change:npcboj2_oz change:npcboj3_ozv change:npcboj3_oz change:npczbroj1_use change:npczbroj1_oc change:npczbroj2_use change:npczbroj2_oc change:npczbroj3_use change:npczbroj3_oc change:npcboj_vyrazen change:npc_bojeschopnost_mod', function() {
    getAttrs(["npc_obr_mod","npcboj1_ozv","npcboj1_oz","npcboj2_ozv","npcboj2_oz","npcboj3_ozv","npcboj3_oz","npczbroj1_use","npczbroj1_oc","npczbroj2_use","npczbroj2_oc","npczbroj3_use","npczbroj3_oc","npc_bojeschopnost_mod","npcboj_vyrazen"], v => {
		var oc = Math.max(int(v.npczbroj1_use)*int(v.npczbroj1_oc),int(v.npczbroj3_use)*int(v.npczbroj3_oc));
		var stit = int(v.npczbroj2_use)*int(v.npczbroj2_oc);
		var oz = 0;
		var opr = 0;
		
		if(int(v.npcboj_vyrazen) == 1){
			opr = opr - (5 + int(v.npc_obr_mod));
		} else {
			opr = int(v.npc_bojeschopnost_mod) + stit;
		};
		
		if(int(v.npcboj1_ozv) == 1) { oz = int(v.npcboj1_oz);
		} else if(int(v.npcboj2_ozv) == 1) { oz = int(v.npcboj2_oz);
		} else if(int(v.npcboj3_ozv) == 1) { oz = int(v.npcboj3_oz);};
		
		setAttrs({"npcboj_oc": oc});
		setAttrs({"npcboj_opr": opr});
		setAttrs({"npcboj_oz": oz});
    });	
});

on("change:npc_hit_points change:npc_odl", function() {
    getAttrs(["npc_odl","npc_hit_points","npc_hit_points_max"], function(values) {
        const odolnost = int(values.npc_odl);
        var zivotu_max = int(values.npc_hit_points_max);
        var tretina = Math.floor(zivotu_max/3);
        var _bojeschopnost_mod = "-3";
        var vyrazeni =  Math.floor(zivotu_max/4);
        if (odolnost >= 17) {
            _bojeschopnost_mod = "0";
            vyrazeni =  1;
        } else if (odolnost >= 12) { 
            _bojeschopnost_mod = "-1";
            vyrazeni =  Math.floor(zivotu_max/8);
        } else if (odolnost >= 6) { 
            _bojeschopnost_mod = "-2";
            vyrazeni =  Math.floor(zivotu_max/6);
        }
        
        var bojeschopnost = "Mrtev (X)";
        var bojeschopnost_mod = "X";
		var outof = 0;
        var zivotu = int(values.npc_hit_points);
        if(zivotu <= 0) {
			outof = 1;
        } else if (zivotu <= vyrazeni) {
			outof = 1;
			bojeschopnost = "Vyřazen (X)";  
        } else if (zivotu <= tretina) { 
			outof = 0;
            bojeschopnost = "Zraněn ("+_bojeschopnost_mod+")";
            bojeschopnost_mod = _bojeschopnost_mod;
        } else {
			outof = 0;
            bojeschopnost = "";
            bojeschopnost_mod = 0;
        } 
        
		setAttrs({ "npcboj_vyrazen": outof});
        setAttrs({ "npc_bojeschopnost": bojeschopnost });
        setAttrs({ "npc_bojeschopnost_mod": bojeschopnost_mod });
        setAttrs({ "npc_bojeschopnost_tretina_zivotu": tretina });
        setAttrs({ "npc_bojeschopnost_mez_vyrazeni": vyrazeni });
        setAttrs({ "npc_bojeschopnost_mod_vyrazeni": _bojeschopnost_mod });

    });
});

on('change:npcboj1_tvt change:npcboj2_tvt change:npcboj3_tvt change:npc_sil_mod change:npc_obr_mod', function() {
    getAttrs(["npcboj1_tvt","npcboj2_tvt","npcboj3_tvt","npc_sil_mod","npc_obr_mod"], v => {
		if(int(v.npcboj1_tvt) == 0) {setAttrs({"npcboj1_mod": int(v.npc_obr_mod)});} else {setAttrs({"npcboj1_mod": int(v.npc_sil_mod)});};
		if(int(v.npcboj2_tvt) == 0) {setAttrs({"npcboj2_mod": int(v.npc_obr_mod)});} else {setAttrs({"npcboj2_mod": int(v.npc_sil_mod)});};
		if(int(v.npcboj3_tvt) == 0) {setAttrs({"npcboj3_mod": int(v.npc_obr_mod)});} else {setAttrs({"npcboj3_mod": int(v.npc_sil_mod)});};
    });	
});





</script>




