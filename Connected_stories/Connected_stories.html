<div class="sheet-story-wrap">
	<div class="sheet-top">
		<div class="sheet-charactername-box">
			<div class="sheet-logo">
				<img src="https://i.imgur.com/ierzOWC.png" alt="logo" />
			</div>
			<div class="sheet-charactername">
				<input type="text" name="attr_character_name" id="attr_character_name" placeholder="캐릭터 이름"/>
			</div>
			<div class="sheet-ownername">
				<input type="text" name="attr_player" id="attr_player" placeholder="오너이름"/>
			</div>
		</div>

		<div class="sheet-characterpfofile-box">
			<div class="sheet-left">
				<div class="sheet-inpbox">
					<label for="attr_age">나이</label>
					<input type="text" name="attr_age" id="attr_age" class="sheet-input"/>
				</div>
				<div class="sheet-inpbox">
					<label for="attr_job">직업</label>
					<input type="text" name="attr_job" id="attr_job" class="sheet-input"/>
				</div>
				<div class="sheet-inpbox">
					<label for="attr_gender">성별</label>
					<input type="text" name="attr_gender" id="attr_gender" class="sheet-input"/>
				</div>
				<div class="sheet-inpbox">
					<label for="attr_floor">층수</label>
					<input type="text" name="attr_floor" id="attr_floor" class="sheet-input"/>
				</div>
				<div class="sheet-inpbox">
					<label for="attr_height">신장</label>
					<input type="text" name="attr_height" id="attr_height" class="sheet-input"/>
				</div>
				<div class="sheet-inpbox">
					<label for="attr_condition">상태</label>
					<input type="text" name="attr_condition" id="attr_condition" class="sheet-input"/>
				</div>
			</div>
			<div class="sheet-right">
				<textarea name="attr_basic" id="attr_basic" placeholder="캐릭터 설정"></textarea>
			</div>
		</div>
	</div>
	<div class="sheet-copyright">
		Rule by.@DEAREST<br />
		made by.@tateck_trpg
	</div>

	<div class="sheet-statusbox">
		<div class="sheet-hp-box">
			<span>체력</span>
			<input type="text" name="attr_hp" id="attr_exp" value="0"/>
			<input type="text" name="attr_hp_max" id="attr_exp_max" value="20"/>
		</div>

		<div class="sheet-exp">
			<div class="sheet-col">
				<span>경험치</span>
				<input type="text" name="attr_exp" id="attr_exp" class="sheet-input" value="0"/>
			</div>
			<div class="sheet-col">
				<span>기능치</span>
				<input type="text" name="attr_exp_use" id="attr_exp_use" value="60" class="sheet-input-none" readonly/>
				/
				<input type="text" name="attr_exp_result" id="attr_exp_result" value="60" class="sheet-input-none" readonly/>
			</div>
		</div>

		<div class="sheet-status">
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_H_minus" id="attr_stat_H_minus" value="0" />
				<input type="checkbox" name="attr_stat_H_m" id="attr_stat_H_m" value="1" />
				<label for="attr_stat_H_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=직관}}{{roll=[[1d100+@{stat_H}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_H_minus}]]}}">직관</button>
					<input type="text" name="attr_stat_H" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_A_minus" id="attr_stat_A_minus" value="0" />
				<input type="checkbox" name="attr_stat_A_m" id="attr_stat_A_m" value="1" />
				<label for="attr_stat_A_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=통찰}}{{roll=[[1d100+@{stat_A}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_A_minus}]]}}">통찰</button>
					<input type="text" name="attr_stat_A" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_B_minus" id="attr_stat_B_minus" value="0" />
				<input type="checkbox" name="attr_stat_B_m" id="attr_stat_B_m" value="1" />
				<label for="attr_stat_B_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=상호}}{{roll=[[1d100+@{stat_B}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_B_minus}]]}}">상호</button>
					<input type="text" name="attr_stat_B" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_C_minus" id="attr_stat_C_minus" value="0" />
				<input type="checkbox" name="attr_stat_C_m" id="attr_stat_C_m" value="1" />
				<label for="attr_stat_C_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=무력}}{{roll=[[1d100+@{stat_C}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_C_minus}]]}}">무력</button>
					<input type="text" name="attr_stat_C" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_D_minus" id="attr_stat_D_minus" value="0" />
				<input type="checkbox" name="attr_stat_D_m" id="attr_stat_D_m" value="1" />
				<label for="attr_stat_D_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=총력}}{{roll=[[1d100+@{stat_D}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_D_minus}]]}}">총력</button>
					<input type="text" name="attr_stat_D" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<input type="hidden" name="attr_stat_E_minus" id="attr_stat_E_minus" value="0" />
				<input type="checkbox" name="attr_stat_E_m" id="attr_stat_E_m" value="1" />
				<label for="attr_stat_E_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=행운}}{{roll=[[1d100+@{stat_E}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_E_minus}]]}}">행운</button>
					<input type="text" name="attr_stat_E" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<div class="sheet-side"><input type="text" name="attr_stat_F_name" id="attr_stat_F_name" class="sheet-input" value="고유명"/></div>
				<input type="hidden" name="attr_stat_F_minus" id="attr_stat_F_minus" value="0" />
				<input type="checkbox" name="attr_stat_F_m" id="attr_stat_F_m" value="1" />
				<label for="attr_stat_F_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=@{stat_F_name}}}{{roll=[[1d100+@{stat_F}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_F_minus}]]}}">고유</button>
					<input type="text" name="attr_stat_F" value="0" />
				</div>
			</div>
			<div class="sheet-col">
				<div class="sheet-side"><input type="text" name="attr_stat_G_name" id="attr_stat_G_name" class="sheet-input" value="특성명"/></div>
				<input type="hidden" name="attr_stat_G_minus" id="attr_stat_G_minus" value="0" />
				<input type="checkbox" name="attr_stat_G_m" id="attr_stat_G_m" value="1" />
				<label for="attr_stat_G_m">불리한 판정</label>
				<div class="sheet-stat">
					<button type='roll' value="&{template:StoryState} {{name=@{character_name}}}{{statname=@{stat_G_name}}}{{roll=[[1d100+@{stat_G}]]}}{{roll2=[[1d2]]}}{{minus=[[@{stat_G_minus}]]}}">특성</button>
					<input type="text" name="attr_stat_G" value="0" />
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-detailbox">
		<div class="sheet-skill">
			<p>엔틱 및 능력</p>
			<textarea name="attr_skill" id="attr_skill"></textarea>
		</div>
		<div class="sheet-wepon">
			<p>무기</p>
			<div class="sheet-list">
				<div>
					<strong>무기명</strong>
					<span>다이스</span>
				</div>
				<div>
					<strong><input type="text" name="attr_W1_name" id="attr_W1_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W1" id="attr_W1" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W1_name}}}{{roll=[[@{W1}]]}}" class="old-roll"></button></span>
				</div>

				<div>
					<strong><input type="text" name="attr_W2_name" id="attr_W2_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W2" id="attr_W2" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W2_name}}}{{roll=[[@{W2}]]}}" class="old-roll"></button></span>
				</div>
				<div>
					<strong><input type="text" name="attr_W3_name" id="attr_W3_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W3" id="attr_W3" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W3_name}}}{{roll=[[@{W3}]]}}" class="old-roll"></button></span>
				</div>
				<div>
					<strong><input type="text" name="attr_W4_name" id="attr_W4_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W4" id="attr_W4" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W4_name}}}{{roll=[[@{W4}]]}}" class="old-roll"></button></span>
				</div>
				<div>
					<strong><input type="text" name="attr_W5_name" id="attr_W5_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W5" id="attr_W5" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W5_name}}}{{roll=[[@{W5}]]}}" class="old-roll"></button></span>
				</div>
				<div>
					<strong><input type="text" name="attr_W6_name" id="attr_W6_name" class="sheet-input"/></strong>
					<span><input type="text" name="attr_W6" id="attr_W6" value="" class="sheet-input"/></span>
					<span><button type='roll' value="&{template:StoryDamage} {{name=@{character_name}}}{{statname=@{W6_name}}}{{roll=[[@{W6}]]}}" class="old-roll"></button></span>
				</div>
			</div>
		</div>
	</div>

	<div class="sheet-relationbox">
		<p>관계 및 호감도</p>
		<div>
			<strong>이름</strong>
			<span>관계</span>
			<span>호감도</span>
		</div>
		<div>
			<strong><input type="text" name="attr_R1_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R1_txt" id="attr_R1_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R1_val" id="attr_R1_val" value="0" class="sheet-input"/></span>
		</div>
		<div>
			<strong><input type="text" name="attr_R2_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R2_txt" id="attr_R2_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R2_val" id="attr_R2_val" value="0" class="sheet-input"/></span>
		</div>
		<div>
			<strong><input type="text" name="attr_R3_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R3_txt" id="attr_R3_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R3_val" id="attr_R3_val" value="0" class="sheet-input"/></span>
		</div>
		<div>
			<strong><input type="text" name="attr_R4_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R4_txt" id="attr_R4_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R4_val" id="attr_R4_val" value="0" class="sheet-input"/></span>
		</div>
		<div>
			<strong><input type="text" name="attr_R5_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R5_txt" id="attr_R5_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R5_val" id="attr_R5_val" value="0" class="sheet-input"/></span>
		</div>
		<div>
			<strong><input type="text" name="attr_R6_name" id="attr_W1_name" class="sheet-input"/></strong>
			<span><input type="text" name="attr_R6_txt" id="attr_R6_txt" value="" class="sheet-input"/></span>
			<span><input type="text" name="attr_R6_val" id="attr_R6_val" value="0" class="sheet-input"/></span>
		</div>
	</div>

	<div class="sheet-inventory">
		<p>소지품</p>
		<textarea name="attr_inventory" id="attr_inventory" class="sheet-input"></textarea>
	</div>

	<div class="sheet-otherstory">
		<textarea name="attr_otherstory" id="attr_otherstory"></textarea>
	</div>
</div>


<script type="text/worker">
on("change:exp change:stat_A change:stat_A_m change:stat_B change:stat_B_m change:stat_C change:stat_C_m change:stat_D change:stat_D_m change:stat_E change:stat_E_m change:stat_F change:stat_F_m change:stat_G change:stat_G_m change:stat_H change:stat_H_m", function() {
	counter();
});

function counter() {
	getAttrs(
		["exp", "stat_A_m", "stat_A", "stat_B_m", "stat_B", "stat_C_m", "stat_C", "stat_D_m", "stat_D", "stat_E_m", "stat_E", "stat_F_m", "stat_F", "stat_G_m", "stat_G", "stat_H_m", "stat_H"], function(values) {
			var total_point = 60;
			var exp = parseInt(values.exp);
			var use_point = 0;

			var i_a = parseInt(values.stat_A);
			var m_a = parseInt(values.stat_A_m);

			var i_b = parseInt(values.stat_B);
			var m_b = parseInt(values.stat_B_m);

			var i_c = parseInt(values.stat_C);
			var m_c = parseInt(values.stat_C_m);

			var i_d = parseInt(values.stat_D);
			var m_d = parseInt(values.stat_D_m);

			var i_e = parseInt(values.stat_E);
			var m_e = parseInt(values.stat_E_m);

			var i_f = parseInt(values.stat_F);
			var m_f = parseInt(values.stat_F_m);

			var i_g = parseInt(values.stat_G);
			var m_g = parseInt(values.stat_G_m);

			var i_h = parseInt(values.stat_H);
			var m_h = parseInt(values.stat_H_m);

			total_point = total_point + exp;
			use_point = i_a + i_b + i_c + i_d + i_e + i_f + i_g + i_h;

			if(m_a == 1) {
				setAttrs({stat_A_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_A_minus: "0"});
			}
			if(m_b == 1) {
				setAttrs({stat_B_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_B_minus: "0"});
			}
			if(m_c == 1) {
				setAttrs({stat_C_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_C_minus: "0"});
			}
			if(m_d == 1) {
				setAttrs({stat_D_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_D_minus: "0"});
			}
			if(m_e == 1) {
				setAttrs({stat_E_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_E_minus: "0"});
			}
			if(m_f == 1) {
				setAttrs({stat_F_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_F_minus: "0"});
			}
			if(m_g == 1) {
				setAttrs({stat_G_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_G_minus: "0"});
			}
			if(m_h == 1) {
				setAttrs({stat_H_minus: "10"});
				total_point = total_point + 10;
			} else {
				setAttrs({stat_H_minus: "0"});
			}

			setAttrs({exp_result: total_point});

			var drop_point = total_point - use_point;
			setAttrs({exp_use: drop_point});

		}
	);
}

</script>

<!-- ROLL TEMPLATES -->
<rolltemplate class="sheet-rolltemplate-StoryState">
	<div class="sheet-dice-box">
		<div class="sheet-dice-inner">
			<div class="sheet-name">
				<span>{{name}}</span>
				<strong>{{statname}} 판정</strong>
			</div>
			<div class="sheet-dice">
				{{roll}}
			</div>
			<div class="sheet-cont">
				<!-- 불리한 판정 일 경우 결과 출력 -->
				{{#rollGreater() minus 5}}
					<!-- 20 이하 -->
					{{#rollLess() roll 20}}
						<strong class="sheet-fail">대실패</strong>
						<p>불리한 판정이 적용됩니다.<br />완전히 실패했습니다. 재시도가 불가능하며, 패널티 또한 부과됩니다.</p>
					{{/rollLess() roll 20}}

					<!-- 21 ~ 50 -->
					{{#rollBetween() roll 20 50}}
						<strong class="sheet-fail2">실패</strong>
						<p>불리한 판정이 적용됩니다.<br />실패했습니다. 패널티는 부과되지 않습니다.</p>
					{{/rollBetween() roll 20 50}}

					<!-- 51 ~ 84 -->
					{{#rollBetween() roll 50 84}}
						<strong class="sheet-fail2">실패</strong>
						{{#rollTotal() roll2 1}}
							<p>불리한 판정이 적용됩니다.<br />아쉽지만 실패했습니다. 만회할 수 없습니다.</p>
						{{/rollTotal() roll2 1}}
						{{#rollTotal() roll2 2}}
							<p>불리한 판정이 적용됩니다.<br />아쉽지만 실패했습니다. 하지만 아슬하게 만회가 가능합니다.</p>
						{{/rollTotal() roll2 2}}
					{{/rollBetween() roll 50 84}}

					<!-- 85 ~ 90 -->
					{{#rollBetween() roll 84 90}}
						<strong class="sheet-sucess">성공</strong>
						<p>불리한 판정이 적용됩니다.<br />성공했습니다. 당신이 원하는 행동이 가능합니다.</p>
					{{/rollBetween() roll 84 90}}

					<!-- 91~ -->
					{{#rollGreater() roll 90}}
						<strong class="sheet-ciri">대성공</strong>
						<p>불리한 판정이 적용됩니다.<br />완벽한 성공입니다. 경우에 따라 추가로 이득을 얻을 수도 있습니다.</p>
					{{/rollGreater() roll 90}}
				{{/rollGreater() minus 5}}

				<!-- 일반 판정 일 경우 결과 출력 -->
				{{#rollLess() minus 5}}
					<!-- 20 이하 -->
					{{#rollLess() roll 20}}
						<strong class="sheet-fail">대실패</strong>
						<p>완전히 실패했습니다. 재시도가 불가능하며, 패널티 또한 부과됩니다.</p>
					{{/rollLess() roll 20}}

					<!-- 21 ~ 50 -->
					{{#rollBetween() roll 20 50}}
						<strong class="sheet-fail2">실패</strong>
						<p>실패했습니다. 패널티는 부과되지 않습니다.</p>
					{{/rollBetween() roll 20 50}}

					<!-- 51 ~ 70 -->
					{{#rollBetween() roll 50 70}}
						<strong class="sheet-fail2">실패</strong>
						{{#rollTotal() roll2 1}}
							<p>아쉽지만 실패했습니다. 만회할 수 없습니다.</p>
						{{/rollTotal() roll2 1}}
						{{#rollTotal() roll2 2}}
							<p>아쉽지만 실패했습니다. 하지만 아슬하게 만회가 가능합니다.</p>
						{{/rollTotal() roll2 2}}
					{{/rollBetween() roll 50 70}}

					<!-- 71 ~ 90 -->
					{{#rollBetween() roll 70 90}}
						<strong class="sheet-sucess">성공</strong>
						<p>성공했습니다. 당신이 원하는 행동이 가능합니다.</p>
					{{/rollBetween() roll 70 90}}

					<!-- 91~ -->
					{{#rollGreater() roll 90}}
						<strong class="sheet-ciri">대성공</strong>
						<p>완벽한 성공입니다. 경우에 따라 추가로 이득을 얻을 수도 있습니다.</p>
					{{/rollGreater() roll 90}}
				{{/rollLess() minus 5}}
			</div>
		</div>
	</div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-StoryDamage">
	<div class="sheet-dice-box">
		<div class="sheet-dice-inner">
			<div class="sheet-name">
				<span>{{name}}</span>
				<strong>{{statname}} 대미지 판정</strong>
			</div>
			<div class="sheet-dice">
				{{roll}}
			</div>
		</div>
	</div>
</rolltemplate>
<!-- // ROLL TEMPLATES -->