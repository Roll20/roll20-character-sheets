<!-- HIDDEN FIELDS -->
<input type="hidden" name="attr_foomaxfield" value="0" />
<input type="hidden" name="attr_foocurrentinjurylevel" value="" />
<input type="hidden" class='gmroll' name="attr_gmroll" value=""/>
<!-- CHARACTER SHEET -->
<div class="global">
    <div class='row header no-wrap'>
        <div class='cell cell-3 cell-logo'>
            <img class="logo" src="https://lh3.googleusercontent.com/pw/ACtC-3dFnMd-D89BItvaSBqsBHEbzZu3I4YxxX4bOxzyLkwcgR7JacQqX1e4z_1w1BM4eo5ExKNHqL5EkpjUQKYGfFH4CKTbFjsZXRZG17QJZUuudk5B1yIlBy5jrztiulTyW7EaU3xLoDidd6KhTQRJdKjn=w746-h317-no?authuser=0">
        </div>
        <div class='cell cell-header'>
            <div class='row header-carac'>
                <div class='cell cell-6'>
                    <p><span class='title'>Nom :</span> <input disabled name="attr_character_name" type="text" /></p>
                </div>
                <div class='cell cell-6'>
                    <p><span class='title'>Origines :</span> <input name="attr_character_origine" type="text" /></p>
                </div>
                <div class="cell cell-7">
                    <p><span class='title'>Concept :</span> <input name="attr_character_concept" type="text" /></p>
                </div>
                <div class="cell cell-2 text-center"> 
                    <span class="title">XP :</span> <span class='number-wrapper'><input type="number" placeholder="0" name="attr_xp" /></span>
                </div>
                <div class="cell cell-1 text-center"> 
                    <button type="roll" value="@{gmroll}&{template:sakura} {{check=[[2d6cs0cf0]]}} {{mincheck=[[2]]}} {{maxcheck=[[12]]}} {{currentinjury=@{foocurrentinjurylevel}}}" name="roll_standard"></button>
                </div>
                <div class="cell cell-2 text-center"> 
                    <p class="switch mt-1">
                        <label class="switch">
                          <input type="checkbox" name="attr_gmrollcheck" value="1">
                          <span class="slider round">
                              <span class="gm-text"> GM </span>
                              <span class="all-text"> ALL </span>
                          </span>
                        </label>
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <div class='top-body row nowrap'>
        <div class="cell cell-1">
            <img class="sakura-left" src="https://lh3.googleusercontent.com/pw/ACtC-3dnT-jL4nDIODl9_IYBpK5ym4afxqKJ-iDgdMxySys7tymlQNdxAYJRp_JywBdIZ2DD6lRFRlywM79AWh99BJlmyaxaci4v8SRpSmccHztq2ZjmXeV_5GYuXwfDHTwQqSNQAwNmfIfN3EblulltB9DA=w229-h836-no?authuser=0">
        </div>
        <div class="cell cell-4">
            <h2 class='title'>Combat</h2>
            <div class='underligne underligne-1'>
                <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
            </div>
            <div class="row">
                <div class="cell cell-8">
                    <p>Nombre d'action par tour: </p>
                    <p class="initiative-p">Défense: </p>
                    <p class="initiative-p">Initiative: </p>
                    <p class="initiative-p">Résistance mentale: </p>
                </div>
                <div class="cell cell-4 text-center">
                    <p><span class='number-wrapper'><input type="hidden" name="attr_fooattackperturn" value="1"/><input type="number" disabled name="attr_attackperturn" value="@{fooattackperturn}" /></span></p>
                    <p><span class='number-wrapper'><input type="hidden" name="attr_foodefence" value="0"/><input type="number" disabled name="attr_defence" value="@{foodefence}"/></span></p>
                    <p class="initiative-button nowrap"><span><input type="hidden" name="attr_fooinitbonus" value="0"/><input type="hidden" name="attr_fooinitmalus" value="0"/><span class='number-wrapper'><input type="number" value="0" name="attr_initmod"/></span><button type="roll" value="&{template:sakura} {{rollname=Initiative}} {{check=[[2d6cs0cf0 + @{fooinitbonus} + @{fooinitmalus} + (@{initmod}) &{tracker}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{note=Penser à ajouter les modificateurs d'arme.}}" name="roll_init"></button></span></p>
                    <p class="resiste-button"><button type="roll" value="@{gmroll}&{template:sakura} {{rollname=Résistance mentale}} {{check=[[2d6cs0cf0 + @{pathlvl} + @{foomaxfield}]]}} {{mincheck=[[2+@{pathlvl}+@{foomaxfield}]]}} {{maxcheck=[[12+@{pathlvl}+@{foomaxfield}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{note=Penser à ajouter le score d'aspect approprié.}}" name="roll_resmentale"></button></p>
                </div>
            </div>
        </div>
        <div class="cell cell-7 injury">
            <h2 class='title'>Blessures</h2>
            <div class='underligne underligne-2'>
                <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
            </div>
            <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='cont-5' type='radio' value='5' name='attr_injury_contusions'><label for='cont-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='cont-4' type='radio' value='4' name='attr_injury_contusions'><label for='cont-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='cont-3' type='radio' value='3' name='attr_injury_contusions'><label for='cont-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='cont-2' type='radio' value='2' name='attr_injury_contusions'><label for='cont-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='cont-1' type='radio' value='1' name='attr_injury_contusions'><label for='cont-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>

                    <input id='cont-0' type='radio' value='0' name='attr_injury_contusions'><label for='cont-0'><span class='cancel'>&times;</span></label>
                </div>
                <div class='cell cell-5'>
                    <p>Contusions</p>
                </div>
                <div class='cell cell-2'></div>
            </div>
            
             <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='meu-5' type='radio' value='5' name='attr_injury_meurtrissures'><label for='meu-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='meu-4' type='radio' value='4' name='attr_injury_meurtrissures'><label for='meu-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='meu-3' type='radio' value='3' name='attr_injury_meurtrissures'><label for='meu-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='meu-2' type='radio' value='2' name='attr_injury_meurtrissures'><label for='meu-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='meu-1' type='radio' value='1' name='attr_injury_meurtrissures'><label for='meu-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    
                    <input id='meu-0' type='radio' value='0' name='attr_injury_meurtrissures'><label for='meu-0'><span class='cancel'>&times;</span></label>

                </div>
                <div class='cell cell-5'>
                    <p>Meurtrissures</p>
                </div>
                <div class='cell cell-2'>-1</div>
            </div>
                         <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='leg-5' type='radio' value='5' name='attr_injury_legeres'><label for='leg-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='leg-4' type='radio' value='4' name='attr_injury_legeres'><label for='leg-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='leg-3' type='radio' value='3' name='attr_injury_legeres'><label for='leg-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='leg-2' type='radio' value='2' name='attr_injury_legeres'><label for='leg-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='leg-1' type='radio' value='1' name='attr_injury_legeres'><label for='leg-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>

                    <input id='leg-0' type='radio' value='0' name='attr_injury_legeres'><label for='leg-0'><span class='cancel'>&times;</span></label>
                    
                </div>
                <div class='cell cell-5'>
                    <p>Blessures Légères</p>
                </div>
                <div class='cell cell-2'>-3</div>
            </div>
            <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='mod-5' type='radio' value='5' name='attr_injury_moderes'><label for='mod-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mod-4' type='radio' value='4' name='attr_injury_moderes'><label for='mod-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mod-3' type='radio' value='3' name='attr_injury_moderes'><label for='mod-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mod-2' type='radio' value='2' name='attr_injury_moderes'><label for='mod-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mod-1' type='radio' value='1' name='attr_injury_moderes'><label for='mod-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>

                    <input id='mod-0' type='radio' value='0' name='attr_injury_moderes'><label for='mod-0'><span class='cancel'>&times;</span></label>
                    
                </div>
                <div class='cell cell-5'>
                    <p>Blessures modérées</p>
                </div>
                <div class='cell cell-2'>-5</div>
            </div>
                 <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='gra-5' type='radio' value='5' name='attr_injury_graves'><label for='gra-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='gra-4' type='radio' value='4' name='attr_injury_graves'><label for='gra-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='gra-3' type='radio' value='3' name='attr_injury_graves'><label for='gra-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='gra-2' type='radio' value='2' name='attr_injury_graves'><label for='gra-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='gra-1' type='radio' value='1' name='attr_injury_graves'><label for='gra-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>

                    <input id='gra-0' type='radio' value='0' name='attr_injury_graves'><label for='gra-0'><span class='cancel'>&times;</span></label>
                    
                </div>
                <div class='cell cell-5'>
                    <p>Blessures graves</p>
                </div>
                <div class='cell cell-2'>-7</div>
            </div>
            <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='mort-5' type='radio' value='5' name='attr_injury_mort'><label for='mort-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mort-4' type='radio' value='4' name='attr_injury_mort'><label for='mort-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mort-3' type='radio' value='3' name='attr_injury_mort'><label for='mort-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mort-2' type='radio' value='2' name='attr_injury_mort'><label for='mort-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='mort-1' type='radio' value='1' name='attr_injury_mort'><label for='mort-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    
                    <input id='mort-0' type='radio' value='0' name='attr_injury_mort'><label for='mort-0'><span class='cancel'>&times;</span></label>
                    
                </div>
                <div class='cell cell-5'>
                    <p>Aux portes de la mort</p>
                </div>
                <div class='cell cell-2'>+3/-9</div>
            </div>
            <div class='row'>
                <div class='cell cell-5 radios-injury'>
                    <input id='inc-5' type='radio' value='5' name='attr_injury_inconscient'><label for='inc-5'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='inc-4' type='radio' value='4' name='attr_injury_inconscient'><label for='inc-4'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='inc-3' type='radio' value='3' name='attr_injury_inconscient'><label for='inc-3'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='inc-2' type='radio' value='2' name='attr_injury_inconscient'><label for='inc-2'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    <input id='inc-1' type='radio' value='1' name='attr_injury_inconscient'><label for='inc-1'><span><img src="https://lh3.googleusercontent.com/pw/ACtC-3dbbSwfnjFXz3X8bOJdZA-sDfVFCF318vKo9uL3809Y8vEr5BjIKzuNXZebFyV29b-c-BuGbpqQhyLfOjwGTyDcMe1I0N5SJe9bIWIm8lmtLW70oR3Gx6NZIikTk-Am3240cA3A-ze4dtG-zPeob5mI=s38-no?authuser=0"></span></label>
                    
                    <input id='inc-0' type='radio' value='0' name='attr_injury_inconscient'><label for='inc-0'><span class='cancel'>&times;</span></label>
                    
                </div>
                <div class='cell cell-5'>
                    <p>Inconscient/ Incapacité</p>
                </div>
                <div class='cell cell-2'> X </div>
            </div>            
        </div>
    </div>

    <div class='tabs-container'>
        <input type='hidden' class='sheet-tabstoggle' name='attr_sheettab' value='character' />
        <div class="text-center">
            <button class='tabs-button' type="action" name="act_field" >Champs <span></span><span></span><span></span></button>
            <button class='tabs-button' type="action" name="act_advantage" >Avantages  <span></span><span></span><span></span></button>
            <button class='tabs-button' type="action" name="act_path" >Voie  <span></span><span></span><span></span></button>
            <button class='tabs-button' type="action" name="act_magie" >Rituels  <span></span><span></span><span></span></button>
            <button class='tabs-button' type="action" name="act_stuff" >Équipement  <span></span><span></span><span></span></button>
            <button class='tabs-button' type="action" name="act_info" >Divers  <span></span><span></span><span></span></button>
        </div>
        
        <div class='sheet-field'>
            <div class="row nowrap">
                <div class="cell cell-6 field-cell">
                    <h2 class="title"> Champs </h2>
                    <div class='underligne underligne-2'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
                    </div>     
                    <fieldset class="repeating_field">
                        <div class='row field-row'>
                            <div class="cell cell-8">
                                    <div class='underligne underligne-1'>
                                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                                    </div>            
                                  <p class='field-name'>Nom du champ:<input name="attr_fieldname" type="text"/></p>
                                  <p class="mt-1">Description:</p>
                                  <textarea name='attr_fielddesc' rows="2"></textarea>
                             </div>
    
                            <div class="cell cell-4 text-center">
                                <p><span class="number-wrapper field-number-wrapper"><input type="number" name="attr_fieldlvl" value="0"/></span></p>
                                <div class="tooltip">
                                    <p>Bonus:</p>
                                    <p><span class="number-wrapper-small"><span class="number-wrapper"><input type="number" name="attr_fieldmod" value="0"/></span></span></p>
                                    <span class="tooltiptext">Ce bonus n'est pas pris en compte lors des tests de spécialisation</span>
                                </div>
                            </div>
                            <div class="cell cell-6">
                                <p class="checkbox text-center mt-1">Initiative:
                                    <label>
                                        <input type="checkbox" name="attr_fieldiscombatrelated" value="1"/>
                                        <span>
                                            <img src="https://lh3.googleusercontent.com/pw/ACtC-3cEcDQYsPArDv3lAC7zEA2vWSlNmXF3qFgOiVx9Fn15Ylmub6JNp3LX0-3DRdW7akaA_bTCDQQIULpsnsn_kMDIoQiduWIjXopdsyZp-dZupAkGXxGoF_lv6Ku7wjeBPDUQ6wvmaVQIaQewHQwlrtjwVA=s79-no?authuser=0">
                                        </span>
                                    </label>
                                </p>
                            </div>
                            <div class="cell cell-6">
                                <button class="roll-field" type="roll" name="roll_fieldcheck" value="@{gmroll}&{template:sakura} {{subtitle=Champ :}} {{rollname=@{fieldname}}} {{check=[[2d6cs0cf0 + @{fieldlvl} + @{fieldmod}]]}} {{mincheck=[[2+@{fieldlvl}+@{fieldmod}]]}} {{maxcheck=[[12+@{fieldlvl}+@{fieldmod}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{desc=@{fielddesc}}}"/>
                            </div>
                        </div>
                    </fieldset>
                </div>
                
                <div class="cell cell-6 spe-cell">
                    <h2 class="title"> Spécialisations </h2>
                    <div class='underligne underligne-2'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
                    </div>
                    
                    <fieldset class="repeating_spec">
                        <div class="row spe-row slider">
                        
                            <div class='underligne underligne-1'>
                                <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                            </div>
                              
                            <div class="cell cell-2">
                                <p> Champ: </p>
                            </div>
        
                            <div class="cell cell-1"> 
                                <button class="right" type="action" name="act_prevfield">
                                    <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                                </button>
                            </div>
                            <div class="cell cell-6 text-center">
                                <input type="hidden" name="attr_foospecassociatedfield" value=""/>
                                <input type="text" disabled name="attr_specassociatedfield" value="@{foospecassociatedfield}"/>
                                <input type="hidden" name="attr_foospecassociatedfieldlvl"/>
                                <input type="hidden" name="attr_fooindexfield" value="-1" />
                            </div>
                            <div class="cell cell-1"> 
                                <button class="left" type="action" name="act_nextfield">
                                    <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                                </button>
                            </div>
                            </div>
                        <div class="nowrap">
                                <div class="cell cell-6 nowrap">
                                    <p class="mt-1"> Nom: </p>
                                    <input class="spe-name" name="attr_specname" type="text" value=""/> 
                                </div>
                                <div class="cell cell-2 nowrap">
                                    <p class="mt-1">Niveau:</p>
                                    <span class="number-wrapper"><input type="number" name="attr_speclvl" placeholder="0"/></span>
                                </div>
                                <div class="cell cell-2 nowrap">
                                    <p class="mt-1"> Bonus: </p>
                                    <div class="text-center">
                                        <span class="number-wrapper"><input  name="attr_specmodif" type="number" value="0" placeholder="0"/></span>
                                    </div>
                                </div>
                                <div class="cell cell-2 text-center">
                                    <input type="hidden" name="attr_foototalspelvl" value="[[@{foospecassociatedfieldlvl} + @{speclvl} + @{specmodif}]]"/>
                                    <button class="roll-spe" type="roll" name="roll_speccheck" value="@{gmroll}&{template:sakura} {{subtitle=Spécialisation :}} {{rollname=@{specname}}} {{check=[[2d6cs0cf0 + @{foototalspelvl}]]}} {{mincheck=[[2+@{foototalspelvl}]]}} {{maxcheck=[[12+@{foototalspelvl}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{desc=@{specdesc}}}"/>
                                </div>
                            </div>
                        <div class="cell cell-12">
                          <p class="mt-1">Description:</p>
                          <textarea name='attr_specdesc' rows="2"></textarea>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
        <div class='sheet-advantage'>
            <div class="row">
                <div class="cell cell-6">
                    <h2 class="title"> Avantages </h2>
                    <div class='underligne underligne-1'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                    </div>
                    <fieldset class="repeating_advantage">
                        <div class= "row no-wrap" >
                            <div class="cell cell-8">
                                <p><input type="text" name="attr_advname" placeholder="Nom"/></p>
                            </div>
                            <div class="cell cell-4 text-center">
                                <p><span class="number-wrapper"><input type="number" name="attr_advlvl" placeholder="0"/></span></p>
                            </div>
                        </div>
                        <textarea type="text" name="attr_advdesc" rows="5"></textarea>
                    </fieldset>
                </div>
                <div class="cell cell-6">
                    <h2 class="title"> Désavantages </h2>
                    <div class='underligne underligne-1'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                    </div>
                    <fieldset class="repeating_disadvantage">
                        <div class= "row no-wrap" >
                            <div class="cell cell-8">
                                <p><input type="text" name="attr_disadvname" placeholder="Nom" /></p>
                            </div>
                            <div class="cell cell-4 text-center">
                                <p><span class="number-wrapper"><input type="number" name="attr_advlvl" placeholder="0" /></span></p>
                            </div>
                        </div>
                        <textarea type="text" name="attr_disadvdesc" rows="5"></textarea>
                    </fieldset>
                </div>
            </div>
        </div>     
        <div class='sheet-path'>
    
            <div class="row ">
                <div class="cell cell-6">
                    <h2 class="title"> Voie </h2>
                    <div class='underligne underligne-1'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                    </div>
                    <input type='text' name='attr_path' placeholder="Nom de la voie">
                    <span class="number-wrapper path-wrapper"><input type="number" name="attr_pathlvl" placeholder="0"></span>
                </div>
                <div class="cell cell-6">
                    <h2 class='title'>Aspects</h2>
                    <div class='underligne underligne-1'>
                         <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                     </div>
                     
                     <fieldset class="repeating_aspect">
                         <input type="text"class="aspect-input" name="attr_aspectname">
                         <span class="number-wrapper path-wrapper"><input type="number" name="attr_aspectlvl" placeholder="0"></span>
                      </fieldset>
                     
                 </div>
    
            </div>
            <div class="row">
                <div class="cell cell-12 text-center">
                    <h2 class='title mt-2'>Techniques et enseignements</h2>
                    <div class='underligne underligne-1'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                    </div>
                    <button type="action" name="act_modaltrue" >Calculer une technique</button>
                </div>
                <div class="techniques slider">
                <fieldset class="repeating_skill">
                    <div class="row">
                        <div class="cell cell-3"><p>Technique :</p></div>
                        <div class="cell cell-8"><input type="text" name="attr_skillname"/></div>
                        <div class="cell cell-3 mt-1">
                            <p>Aspect:</p>
                        </div>
                        <div class="cell cell-1 "> 
                            <button class="right" type="action" name="act_prevaspect">
                                <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                            </button>
                        </div>
                        <div class="cell cell-6 text-center">
                            <input type="hidden" name="attr_fooskillassociatedaspect"/>
                            <input type="text" disabled name="attr_skillassociatedaspect" value="@{fooskillassociatedaspect}"/>
                            <input type="hidden" name="attr_fooskillassociatedaspectlvl"/>
                            <input type="hidden" name="attr_fooindexaspect" value="-1" />
                        </div>
                        <div class="cell cell-1"> 
                            <button class="left" type="action" name="act_nextaspect">
                                <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                            </button>
                        </div>
                        <div class="cell cell-9 mt-1"><p>Puissance: <span class="tech-power number-wrapper"><input type="number" name="attr_skillpwr" placeholder="0"></span></p></div>
                        <div class="cell cell-3">
                            <input type="hidden" name="attr_foototalskilllvl" value="[[@{pathlvl} + @{fooskillassociatedaspectlvl}]]"/>
                            <button class="roll-tech" type="roll" name="roll_skill" value="@{gmroll}&{template:sakura} {{subtitle=Technique :}} {{rollname=@{skillname}}} {{check=[[2d6cs0cf0 + @{foototalskilllvl}]]}} {{mincheck=[[2+ @{foototalskilllvl}]]}} {{maxcheck=[[12+ @{foototalskilllvl}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{note=Difficulté : @{skillpwr}}} {{desc=@{skilleffect}}}"/>
                        </div>
                        <textarea type="text" name="attr_skilleffect" rows="5"></textarea>
                    </div>
                </fieldset>
                </div>
            </div>
        </div>   
        <div class='sheet-magie'>
            <div class="row ">
                <div class="cell cell-12 text-center">
                    <h2 class="title"> Rituels </h2>
                    <div class='underligne underligne-1'>
                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm=w662-h53-no?authuser=0">
                        <div class="cell cell-12 text-center mt-1">
                            <button type="action" name="act_modalritualtrue" >Calculer une difficulté</button>
                        </div>
                    </div>
                
                    <div class="magies slider">
                        <fieldset class="repeating_magic">
                            <div class="row">
                                <div class="cell cell-3"><p>Nom :</p></div>
                                <div class="cell cell-8"><input type="text" name="attr_magicname"/></div>
                                <div class="cell cell-3 mt-1">
                                <p>Champ:</p>
                                </div>
                                <div class="cell cell-1 "> 
                                    <button class="right" type="action" name="act_prevfieldmagic">
                                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                                    </button>
                                </div>
                                <div class="cell cell-6 text-center">
                                    <input type="hidden" name="attr_foomagicassociatedfield"/>
                                    <input type="text" disabled name="attr_magicassociatedfield" value="@{foomagicassociatedfield}"/>
                                    <input type="hidden" name="attr_foomagicassociatedfieldlvl"/>
                                    <input type="hidden" name="attr_fooindexfield" value="-1" />
                                </div>
                                <div class="cell cell-1"> 
                                    <button class="left" type="action" name="act_nextfieldmagic">
                                        <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                                    </button>
                                </div>
                                <div class="cell cell-3 mt-1">
                                <p>Spécialisation:</p>
                                </div>
                                <div class="cell cell-1 "> 
                                    <button class="right" type="action" name="act_prevspemagic">
                                        <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                                    </button>
                                </div>
                                <div class="cell cell-6 text-center">
                                    <input type="hidden" name="attr_foomagicassociatedspe"/>
                                    <input type="text" disabled name="attr_magicassociatedspe" value="@{foomagicassociatedspe}"/>
                                    <input type="hidden" name="attr_foomagicassociatedspelvl"/>
                                    <input type="hidden" name="attr_fooindexspe" value="-1" />
                                </div>
                                <div class="cell cell-1"> 
                                    <button class="left" type="action" name="act_nextspemagic">
                                        <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                                    </button>
                                </div>
                                <div class="cell cell-4 mt-1">
                                    <p>Bonus: <span class="number-wrapper"><input type="number" name="attr_magicbonus" value="0" placeholder="0"></span></p>
                                </div>
        
                                <div class="cell cell-6 mt-1"><p>Majoration: <span class="tech-power number-wrapper"><input type="number" name="attr_magicdiff" placeholder="0"></span></p></div>
                                <div class="cell cell-2 mt-1">
                                    <input type="hidden" name="attr_foototalmagiclvl" value="[[@{foomagicassociatedfieldlvl} + @{foomagicassociatedspelvl}]]"/>
                                    <button class="roll-tech" type="roll" name="roll_magie" value="@{gmroll}&{template:sakura} {{subtitle=Magie :}} {{rollname=@{magicname}}} {{check=[[2d6cs0cf0 + @{magicbonus} + @{foototalmagiclvl}]]}} {{mincheck=[[2 + @{magicbonus} + @{foototalmagiclvl}]]}} {{maxcheck=[[12 + @{magicbonus} + @{foototalmagiclvl}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{note=Difficulté : [[8 + @{magicdiff}]]}} {{desc=@{magiceffect}}}"/>
                                </div>
                                <textarea type="text" name="attr_magiceffect" rows="5"></textarea>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>   
        </div> 
        <div class='sheet-stuff'>
            <div class="text-center">
                <div class="row">
                    <div class="cell cell-12">
                        <h2 class="title"> Défensif </h2>
                        <div class='underligne underligne-2'>
                            <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
                        </div>
                        <div class="text-left armor">
                            <div class="row no-wrap">
                                    <div class="cell cell-4">
                                         <p class="mt-2">Nom</p>
                                    </div>
                                    <div class="cell cell-2">
                                        <p class="mt-2">Défense</p>
                                    </div>
                                    <div class="cell cell-2">
                                        <p class="mt-2">Bonus</p>
                                    </div>
                                    <div class="cell cell-2">
                                         <p class="mt-2">Mod Initiative</p>
                                    </div>
                                    <div class="cell cell-2">
                                        <p class="checkbox mt-1">Equipé :</p>
                                    </div>
                                </div>
                            <fieldset class="repeating_armor">
                                <div class="row no-wrap">
                                    <div class="cell cell-4">
                                        <input type="text" name="attr_armorname" placeholder="Nom">
                                    </div>
                                    <div class="cell cell-2">
                                        <input class="stuff-number" type="number" name="attr_armordefence" placeholder="0">
                                    </div>
                                    <div class="cell cell-2">
                                        <input class="stuff-number" type="number" name="attr_armordefencebonus" placeholder="0">
                                    </div>
                                    <div class="cell cell-2">
                                         <input class="stuff-number" type="number" name="attr_armormalus" placeholder="0">
                                    </div>
                                    <div class="cell cell-2">
                                        <p class="checkbox mt-1">
                                            <label>
                                                <input type="checkbox" name="attr_armorequiped" value="1" checked="false"/>
                                                <span>
                                                    <img src="https://lh3.googleusercontent.com/pw/ACtC-3cEcDQYsPArDv3lAC7zEA2vWSlNmXF3qFgOiVx9Fn15Ylmub6JNp3LX0-3DRdW7akaA_bTCDQQIULpsnsn_kMDIoQiduWIjXopdsyZp-dZupAkGXxGoF_lv6Ku7wjeBPDUQ6wvmaVQIaQewHQwlrtjwVA=s79-no?authuser=0">
                                                </span>
                                            </label>
                                        </p>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                        
                        <h2 class="title mt-2"> Offensif </h2>
                        <div class='underligne underligne-2'>
                            <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
                        </div>
                        <div class=" text-left weapon">
                                <fieldset class="repeating_weapon">
                                <div class="row nowrap weapon-wrapper">
                                    <div class='separator'>
                                        <img src="https://imgsrv.roll20.net?src=https%3A//lh3.googleusercontent.com/pw/ACtC-3c3ENhJzSMnALDWpDDtlFtx7B4Rqhn8LR5YGlZlabABgw_YSAdXHPcVEtAPomSFhKimZgugjGQ2ABvkpKQLj91_JJOSMYyyTyPnNoPsQc9WoJk8a4dycAzb8eefo70c_71KzCVldfiyXvrO0-gcdwPm%3Dw662-h53-no%3Fauthuser%3D0">
                                    </div>
                                    <div class='cell cell-9'>
                                        <div class="row nowrap weapon-wrapper mt-1">
                                            <div class="cell cell-6">
                                            </div>
                                            <div class="cell cell-2">
                                                <p class="dgt-p">Dégats </p>
                                            </div>
                                            <div class="cell cell-2">
                                                <p> Bonus toucher  </p>
                                            </div>
                                            <div class="cell cell-2">
                                                <p> Bonus dégâts </p>
                                            </div>
                                        </div>
                                        <div class="row nowrap"> 
                                            <div class="cell cell-6">
                                               <span><input type="text" name="attr_weaponname"></span>
                                            </div>
                                            <div class="cell cell-2">
                                                <span class="dgt-p"><input class="stuff-number" type="number" name="attr_dgt" placeholder="0" /></span>
                                            </div>
                                            <div class="cell cell-2">
                                                <span><input class="stuff-number" type="number" name="attr_atkbonus" placeholder="0"/></span>
                                            </div>
                                            <div class="cell cell-2">
                                                <span><input class="stuff-number" type="number" name="attr_dmgbonus" placeholder="0"/></span>
                                            </div>
                                        </div>
                                        <div class="row nowrap">
                                            <div class="cell cell-6 text-center">
                                                <p class="mt-1"> Champ </p>
                                            </div>
                                            <div class="cell cell-6 text-center">
                                                <p class="mt-1"> Spécialité </p>
                                            </div>
                                        </div>
                                        <div class="row nowrap slider">
                                           <div class="cell cell-1 "> 
                                            <button class="right" type="action" name="act_prevfieldweapon">
                                                    <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                                                </button>
                                            </div>
                                            <div class="cell cell-4 text-center">
                                                <input type="hidden" name="attr_fooweaponassociatedfield"/>
                                                <input type="text" disabled name="attr_weaponassociatedfield" value="@{fooweaponassociatedfield}"/>
                                                <input type="hidden" name="attr_fooweaponassociatedfieldlvl" value="0"/>
                                                <input type="hidden" name="attr_fooindexfield" value="-1" />
                                            </div>
                                            <div class="cell cell-1"> 
                                                <button class="left" type="action" name="act_nextfieldweapon">
                                                    <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                                                </button>
                                            </div> 
                                           <div class="cell cell-1 "> 
                                            <button class="right" type="action" name="act_prevspeweapon">
                                                    <img src="https://lh3.googleusercontent.com/pw/ACtC-3dTW1t8u643KKvBvpgrnwblWKviIJ_o5ljMMCxBG204LOaj4iW9tE6VEE4BA3fobyOKKdr9Xqmevz4_ViNAJZdEjka_asiITjtiyLZciFs4X-o0UZ3h9BqGlcFcG1_9CY7HdlUu-HKMZ9aF3tHmN4fO=w128-h176-no?authuser=0">
                                                </button>
                                            </div>
                                            <div class="cell cell-4 text-center">
                                                <input type="hidden" name="attr_fooweaponassociatedspe"/>
                                                <input type="text" disabled name="attr_weaponassociatedspe" value="@{fooweaponassociatedspe}"/>
                                                <input type="hidden" name="attr_fooweaponassociatedspelvl" value="0"/>
                                                <input type="hidden" name="attr_fooweaponassociatedspelvlbonus" value="0"/>
                                                <input type="hidden" name="attr_fooindexspe" value="-1" />
                                            </div>
                                            <div class="cell cell-1"> 
                                                <button class="left" type="action" name="act_nextspeweapon">
                                                    <img src='https://lh3.googleusercontent.com/pw/ACtC-3dM3amrbq3K0od0-KjZvqPKXBV9o6cdk4Xwh8H7nXnBPqDveu2pNRJIfbQtST4LQ_GDdS-9S6hHxBxG6ar9uW6UqJt9POJwzhSylh1z_Oi603dRv0dgZmY9VxfzbKpsvuWfJzegxGgsC4SctWeSjQj9=w128-h176-no?authuser=0'>
                                                </button>
                                            </div> 
                                        </div>
    
                                    </div>
                                    <div class="cell cell-2 mt-1"> 
                                            <p> Notes </p>
                                          <textarea name='attr_weaponnotes' rows="5"></textarea>
                                    </div>
                                    <div class='cell cell-1'>
                                        <input type="hidden" name="attr_foototalweaponrollbonus" value="[[@{atkbonus}+@{fooweaponassociatedfieldlvl}+@{fooweaponassociatedspelvl}+@{fooweaponassociatedspelvlbonus}]]"/>
                                        <input type="hidden" name="attr_foototalweapondmg" value="@{dgt} + @{dmgbonus}" />
                                        <button class="roll-tech" type="roll" name="roll_tech" value="@{gmroll}&{template:sakura} {{subtitle= @{character_name} attaque avec @{weaponname} :}} {{check=[[2d6cs0cf0 + @{foototalweaponrollbonus}]]}} {{mincheck=[[2+@{foototalweaponrollbonus}]]}} {{maxcheck=[[12+@{foototalweaponrollbonus}]]}} {{currentinjury=@{foocurrentinjurylevel}}} {{desc=@{weaponnotes}}} {{note=Dégats de l'arme : @{foototalweapondmg}}}"/>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class='sheet-info'>
            <div class="text-center">
                <h2 class="title"> Divers </h2>
                <div class='underligne underligne-2'>
                    <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
                </div>
                <p class="mt-1"> Argent :</p>
                        
                <div class="row nowrap slider">
                    <div class="cell cell-3 text-center">
                        <p class="tooltip">Ryu : 
                        <span class="tooltiptext">1 Ryu = 4 Koku</span></p>
                        <span class="number-wrapper"><input type="number" name="attr_ryu" placeholder="0"/></span> 
                    </div>
                    <div class=" cell cell-3 text-center">
                        <p class="tooltip">Koku :
                        <span class="tooltiptext">1 Koku = 10 gin</span></p>
                        <span class="number-wrapper"><input type="number" name="attr_koku" placeholder="0"/></span>
                    </div>
                    <div class=" cell cell-3 text-center">  
                     <p class="tooltip">Gin :
                        <span class="tooltiptext">1 Gin = 100 mon</span></p>
                         <span class="number-wrapper"><input type="number" name="attr_gin" placeholder="0"/></span>
                    </div>
                    <div class="cell cell-3 text-center">                    
                         <span>Mon :</span>
                        <span class="number-wrapper"><input type="number" name="attr_mon" placeholder="0"/></span>
                    </div>

                </div>
                <p class="mt-1"> Equipements :</p>
                 <textarea name='attr_stuff' rows="6"></textarea>
                 
                <p class="mt-1"> Notes :</p>
                 <textarea name='attr_notes' rows="6"></textarea>
                 
                <p class="mt-1"> Historique :</p>
                 <textarea name='attr_background' rows="6"></textarea>
    
            </div>
        </div>
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-sakura">
    <div class="sheet-template-container">
    {{#subtitle}}
    <div class="sheet-template-row">{{subtitle}}</div>
    {{/subtitle}}
	<div class="sheet-template-header">
	    <h3>{{rollname}}</h3>
    </div>
    <div class="sheet-template-row">
        <!-- critical success -->
        {{#rollTotal() check maxcheck}}
        <span class="roll-result fullcrit">
        {{/rollTotal() check maxcheck}}
        <!-- critical fail -->
        {{#rollTotal() check mincheck}}
        <span class="roll-result fullfail">
        {{/rollTotal() check mincheck}}
        <!-- other where cs & cf can happen -->
        {{#^rollTotal() check maxcheck}}
        {{#^rollTotal() check mincheck}}
        <span class="roll-result">
        {{/^rollTotal() check mincheck}}
        {{/^rollTotal() check maxcheck}}
        {{^maxcheck}}{{^mincheck}}
        <span class="roll-result">
        {{/mincheck}}{{/maxcheck}}
        {{check}}</span>
    </div>
    {{#currentinjury}}
    <div class="sheet-template-row sheet-roll-injury">Malus de blessures: {{currentinjury}}</div>
    {{/currentinjury}}
    {{#desc}}
	<div class="sheet-template-row">
	    <span class="sheet-template-desc">{{desc}}</span>
    </div>
    {{/desc}}
    {{#note}}
	<div class="sheet-template-row">
	    <p class="sheet-template-note"><small>{{note}}</small></p>
    </div>
    {{/note}}
    </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-sakura-chatmenu">
    {{content}}
</rolltemplate>



<!--------------------------------------------------------------------------->
<!----------------------------- MODAL SKILL --------------------------------->
<!--------------------------------------------------------------------------->

<input type="hidden" class="modalvalue" name="attr_modal" value="modalfalse" />


<div class="modal">
    <button type="action" name="act_modalfalse" class="close-button" >
        <img src='https://lh3.googleusercontent.com/pw/ACtC-3eTbiQ8E8mWTtrCnoXLPuu8PoB50_PtbO330J-pFQ9nxva1M5hcJgqNIay_Xb2Ss45b0D4aamWFTG-ECjSdZ06exYXZrxK3kTEDYrA8nPC7KJ6CrNPnsV4ka8a8lLalvNa0dmXReqaEYqZKZjLAPNN_vg=w55-h54-no?authuser=0'>
    </button>
    
    <div class="row mt-1">
        <div class="cell cell-8">
            <h2 class="title mt-1">Calcul de Technique</h2>
            <div class='text-center underligne underligne-2'>
                <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
            </div>
        </div>
        <div class="cell cell-4 score">
            <span class="number-wrapper path-wrapper"><input type='hidden' name='attr_modalpower' value="0" ><input type="number" name="attr_modalpowerFake" placeholder="0" value="@{modalpower}" disabled></span>
        </div>
    </div>

    
    <div class="row">
        
        <div class='cell cell-2 mt-1'>
            <p>Portée de la Technique</p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modalrange" value="-1" checked> <span class="reset"> &times; </span></label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="0"> <span> Contact </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="1"> <span> 3 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="2"> <span> 10 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="3"> <span> 30 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="4"> <span> 50 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="5"> <span> 100 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrange" value="6"> <span> À vue </span></label>
                </div>
            </div>
         </div>
          <div class='cell cell-2 mt-1'>
            <p>Durée de la Technique</p>
        </div>
        <div class="cell cell-1 mt-1">
            <label><input type="radio" name="attr_modaltime" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row ">
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="0"> <span> Instantatée/1 action </span></label>
                </div>
                <div class="cell">
                     <label><input type="radio" name="attr_modaltime" value="1"> <span> 1 tour </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="2"> <span> 3 tours </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="3"> <span> 5 tours </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="4"> <span> 1 scène </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="5"> <span> 1 jour </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modaltime" value="6"> <span> 1 semaine </span></label>
                </div>
            </div>
        </div>
         <div class='cell cell-2 mt-1'>
            <p>Dégâts/soin</p>
        </div>
        <div class="cell cell-1 mt-1">
            <label><input type="radio" name="attr_modalvalue" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modalvalue" value="0"> <span> 1  </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalvalue" value="1"> <span> 2 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalvalue" value="2"> <span> 3  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalvalue" value="3"> <span> 5  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalvalue" value="4"> <span> 7 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalvalue" value="5"> <span> 10  </span></label>
                </div>
                <div class="cell">                
                  <label><input type="radio" name="attr_modalvalue" value="6"> <span> 15 </span></label>
               </div>
            </div>
        </div>
         <div class='cell cell-2 mt-1'>
            <p>Cibles</p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modaltarget" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modaltarget" value="0"> <span> Soi-même  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modaltarget" value="1"> <span> 1 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modaltarget" value="2"> <span> 2  </span></label>
                </div>
                <div class="cell">            
                    <label><input type="radio" name="attr_modaltarget" value="3"> <span> 3  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modaltarget" value="4"> <span> 4 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modaltarget" value="5"> <span> 5  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modaltarget" value="6"> <span> 6 </span></label>
                </div>
            </div>
        </div>
        
         <div class='cell cell-2 mt-1'>
            <p>Bonus/ Malus </p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modalbonus" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">            
                     <label><input type="radio" name="attr_modalbonus" value="0"> <span> 1  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="1"> <span> 2 </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="2"> <span> 3  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="3"> <span> 4  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="4"> <span> 5 </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="5"> <span> 6  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalbonus" value="6"> <span> 7 </span></label>
                </div>
            </div>
        </div>    
        
        <div class='cell cell-2 mt-1'>
            <p>Invocation</p>
        </div>
        <div class='cell cell-10 mt-1'>
            <div class="row">
                <div class='cell cell-1 mt-1'>
                    <label><input type="radio" name="attr_modalinvoc" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class='cell cell-9 mt-1'>
                    <div class="row">
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvoc" value="0"> <span> Figurant  </span></label>
                        </div>
                        <div class="cell">                
                            <label><input type="radio" name="attr_modalinvoc" value="2"> <span> Second rôle  </span></label>
                        </div>
                        <div class="cell">                
                             <label><input type="radio" name="attr_modalinvoc" value="5"> <span> Premier rôle  </span></label>
                        </div>
                    </div>
                </div> 
            </div>
            <div class="row">
                <div class='cell cell-1 mt-1'>
                    <label><input type="radio" name="attr_modalinvocp" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class='cell cell-10 mt-1'>
                    <div class="row">
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="0"> <span> 1 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="1"> <span> 2 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="2"> <span> 3 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="3"> <span> 4 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="4"> <span> 5 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="5"> <span> 6 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalinvocp" value="6"> <span> 7 niveau de champ  </span></label>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
        <div class='cell cell-2 mt-1'>
            <p>Spécial</p>
        </div>
        <div class='cell cell-10 mt-1'>
            <div class="row">
                <div class="cell cell-1">
                    <label><input type="radio" name="attr_modaltransformationt" value="-1" checked> <span class="reset"> &times; </span> </label>
                </div>
                <div class= 'cell cell-10'>
                    <h3 class="title  mt-2"> Transformation Technique </h3>
                    <div class='row'>
                        <div class="cell">
                            <label><input type="radio" name="attr_modaltransformationt" value="2"> <span> transformation simple</span></label>
                        </div>   
                        <div class="cell">
                            <label><input type="radio" name="attr_modaltransformationt" value="5"> <span> transformation importante</span></label>
                        </div>           
                        <div class="cell">
                            <label><input type="radio" name="attr_modaltransformationt" value="7"> <span> transformation complète</span></label>
                        </div> 
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="cell cell-1">
                   <label><input type="radio" name="attr_modalpurif" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class="cell cell-10">
                     <h3 class="title mt-2"> Autres </h3>
                    <label><input type="radio" name="attr_modalpurif" value="2"> <span> Purification </span></label>
                </div> 
            </div>
        </div>
        
    </div>
    
</div>


<!--------------------------- End MODAL ------------------------------------>

<!--------------------------------- -------------------------------------->
<!--------------------------- MODAL RITUAL ------------------------------->
<!------------------------------------------------------------------------>

<input type="hidden" class="modalritualvalue" name="attr_modalritual" value="modalritualfalse" />


<div class="modalritual">
    <button type="action" name="act_modalritualfalse" class="close-button" >
        <img src='https://lh3.googleusercontent.com/pw/ACtC-3eTbiQ8E8mWTtrCnoXLPuu8PoB50_PtbO330J-pFQ9nxva1M5hcJgqNIay_Xb2Ss45b0D4aamWFTG-ECjSdZ06exYXZrxK3kTEDYrA8nPC7KJ6CrNPnsV4ka8a8lLalvNa0dmXReqaEYqZKZjLAPNN_vg=w55-h54-no?authuser=0'>
    </button>
    
    <div class="row mt-1">
        <div class="cell cell-8">
            <h2 class="title mt-1">Calcul de Rituel</h2>
            <div class='text-center underligne underligne-2'>
                <img src="https://lh3.googleusercontent.com/pw/ACtC-3f7VjhCW6tyHGIHg6hcPZQTXN_sPyjTbtaaETRxtZNKb1ONEJgdc9gtatciDX93ZQTzCjae8G6H1R_aCw-FzPIvbFmV7OhphmNDlyXw-PIWOG5vw7q3K3OJyjwqLWZ6TwePB0aNK8PFdDeMXF904XVs=w851-h83-no?authuser=0">
            </div>
        </div>
        <div class="cell cell-4 score">
            <span class="number-wrapper path-wrapper"><input type='hidden' name='attr_modalrpower' value="0" ><input type="number" name="attr_foomodalrpower" placeholder="0" value="@{modalrpower}" disabled></span>
        </div>
    </div>

    
    <div class="row">
        
        <div class='cell cell-2 mt-1'>
            <p>Portée du rituel</p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modalrrange" value="-1" checked> <span class="reset"> &times; </span></label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="0"> <span> Contact </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="1"> <span> 3 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="2"> <span> 10 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="3"> <span> 30 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="4"> <span> 50 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="5"> <span> 100 mètres </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrrange" value="6"> <span> À vue </span></label>
                </div>
            </div>
         </div>
          <div class='cell cell-2 mt-1'>
            <p>Durée du rituel</p>
        </div>
        <div class="cell cell-1 mt-1">
            <label><input type="radio" name="attr_modalrtime" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row ">
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="0"> <span> Instantatée/1 action </span></label>
                </div>
                <div class="cell">
                     <label><input type="radio" name="attr_modalrtime" value="1"> <span> 1 tour </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="2"> <span> 3 tours </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="3"> <span> 5 tours </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="4"> <span> 1 scène </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="5"> <span> 1 jour </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtime" value="6"> <span> 1 semaine </span></label>
                </div>
            </div>
        </div>
         <div class='cell cell-2 mt-1'>
            <p>Dégâts/soin</p>
        </div>
        <div class="cell cell-1 mt-1">
            <label><input type="radio" name="attr_modalrvalue" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modalrvalue" value="0"> <span> 1  </span></label>
                </div>
                <div class="cell">
                    <label><input type="radio" name="attr_modalrvalue" value="1"> <span> 2 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrvalue" value="2"> <span> 3  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrvalue" value="3"> <span> 5  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrvalue" value="4"> <span> 7 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrvalue" value="5"> <span> 10  </span></label>
                </div>
                <div class="cell">                
                  <label><input type="radio" name="attr_modalrvalue" value="6"> <span> 15 </span></label>
               </div>
            </div>
        </div>
         <div class='cell cell-2 mt-1'>
            <p>Cibles</p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modalrtarget" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">
                    <label><input type="radio" name="attr_modalrtarget" value="0"> <span> Soi-même  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrtarget" value="1"> <span> 1 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrtarget" value="2"> <span> 2  </span></label>
                </div>
                <div class="cell">            
                    <label><input type="radio" name="attr_modalrtarget" value="3"> <span> 3  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrtarget" value="4"> <span> 4 </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrtarget" value="5"> <span> 5  </span></label>
                </div>
                <div class="cell">                
                    <label><input type="radio" name="attr_modalrtarget" value="6"> <span> 6 </span></label>
                </div>
            </div>
        </div>
        
         <div class='cell cell-2 mt-1'>
            <p>Bonus/ Malus </p>
        </div>
        <div class='cell cell-1 mt-1'>
            <label><input type="radio" name="attr_modalrbonus" value="-1" checked>  <span class="reset"> &times; </span> </label>
        </div>
        <div class='cell cell-9 mt-1'>
            <div class="row">
                <div class="cell">            
                     <label><input type="radio" name="attr_modalrbonus" value="0"> <span> 1  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="1"> <span> 2 </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="2"> <span> 3  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="3"> <span> 4  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="4"> <span> 5 </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="5"> <span> 6  </span></label>
                </div>
                <div class="cell">                 
                     <label><input type="radio" name="attr_modalrbonus" value="6"> <span> 7 </span></label>
                </div>
            </div>
        </div>    
        
        <div class='cell cell-2 mt-1'>
            <p>Invocation</p>
        </div>
        <div class='cell cell-10 mt-1'>
            <div class="row">
                <div class='cell cell-1 mt-1'>
                    <label><input type="radio" name="attr_modalrinvoc" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class='cell cell-9 mt-1'>
                    <div class="row">
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvoc" value="0"> <span> Figurant  </span></label>
                        </div>
                        <div class="cell">                
                            <label><input type="radio" name="attr_modalrinvoc" value="2"> <span> Second rôle  </span></label>
                        </div>
                        <div class="cell">                
                             <label><input type="radio" name="attr_modalrinvoc" value="5"> <span> Premier rôle  </span></label>
                        </div>
                    </div>
                </div> 
            </div>
            <div class="row">
                <div class='cell cell-1 mt-1'>
                    <label><input type="radio" name="attr_modalrinvocp" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class='cell cell-10 mt-1'>
                    <div class="row">
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="0"> <span> 1 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="1"> <span> 2 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="2"> <span> 3 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="3"> <span> 4 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="4"> <span> 5 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="5"> <span> 6 niveau de champ  </span></label>
                        </div>
                        <div class="cell"> 
                             <label><input type="radio" name="attr_modalrinvocp" value="6"> <span> 7 niveau de champ  </span></label>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
        <div class='cell cell-2 mt-1'>
            <p>Spécial</p>
        </div>
        <div class='cell cell-10 mt-1'>
            <div class="row">
                <div class="cell cell-1">
                    <label><input type="radio" name="attr_modalrtransformationm" value="-1" checked> <span class="reset"> &times; </span> </label>
                </div>
                <div class= 'cell cell-10'>
                    <h3 class="title mt-2"> Transformation </h3>
                    <div class='row'>
                        <div class="cell">
                            <label><input type="radio" name="attr_modalrtransformationm" value="2"> <span> transformation simple</span></label>
                        </div>   
                        <div class="cell">
                            <label><input type="radio" name="attr_modalrtransformationm" value="6"> <span> transformation importante</span></label>
                        </div>           
                        <div class="cell">
                            <label><input type="radio" name="attr_modalrtransformationm" value="10"> <span> transformation complète</span></label>
                        </div> 
                    </div>
                </div>
                  
            </div>
            <div class="row">

                <div class="cell cell-1">
                   <label><input type="radio" name="attr_modalrpurif" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class="cell cell-10">
                     <h3 class="title mt-2"> Autres </h3>
                    <label><input type="radio" name="attr_modalrpurif" value="2"> <span> Purification </span></label>
                </div> 
            </div>
            
            <div class="row">
                <div class="cell cell-1">
                   <label><input type="radio" name="attr_modalrdiff" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class="cell cell-10">
                    <label><input type="radio" name="attr_modalrdiff" value="2"> <span> Effet différé </span></label>
                </div> 
            </div>
            <div class="row">
                <div class="cell cell-1">
                   <label><input type="radio" name="attr_modalrench" value="-1" checked>  <span class="reset"> &times; </span> </label>
                </div>
                <div class="cell cell-10">
                    <label><input type="radio" name="attr_modalrench" value="10"> <span> Enchantement </span></label>
                </div> 
            </div>
                        
        </div>
        
    </div>
    
</div>


<!--------------------------- End MODAL ------------------------------------>

<script type="text/worker">

// TABS
    
    const buttonlist = ["field","advantage","path", "info", "stuff", "magie"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheettab: button
            });
        });
    });
    
    const buttonlist2 = ["modalfalse","modaltrue"];
    buttonlist2.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                modal: button
            });
        });
    });
    
    const modalritualarray = ["modalritualfalse","modalritualtrue"];
    modalritualarray.forEach(act => {
        on(`clicked:${act}`, function() {
            setAttrs({
                modalritual: act
            });
        });
    });
    
    function negArray(arr) {
        var dup = arr;
        
        return new Proxy(dup, {
            get(target, prop) {
                if (!isNaN(prop)) {
                    prop = parseInt(prop, 10);
                    if (prop < 0) {
                        prop += target.length;
                    }
                }
                return target[prop];
            }
        });
    }

// TABS END
    function updateRepeatingRelatedAttrFromRepeating(monitoredSectionName, targetSectionName, attrCorrelationName, id, targetProp, value){
        getSectionIDs(monitoredSectionName, function(idarray){
            let index = -1;
            for(const i in idarray)
            {
                if(idarray[i]==id)
                {
                    getSectionIDs(targetSectionName, function(specidarray){
                        for(const j in specidarray)
                        {
                            getAttrs(["repeating_"+targetSectionName+"_"+specidarray[j]+"_"+attrCorrelationName],
                            function(x){
                                if(x["repeating_"+targetSectionName+"_"+specidarray[j]+"_"+attrCorrelationName]==i)
                                {
                                    setObj = {};
                                    setObj["repeating_"+targetSectionName+"_"+specidarray[j]+"_"+targetProp] = value;
                                    setAttrs(setObj);
                                }
                            });
                        }
                    });
                    break;
                }
            }
        });
    }
    
    function getRepeatingValue(targetRepeatingIndexName, sourceRepeatingName, directionalcheck){
        getSectionIDs(sourceRepeatingName, function(idarray){
            var setObj = {};
            if(idarray.length==0)return;
            if(idarray.length>1){
                var newIndex = directionalcheck(idarray);
                setObj[targetRepeatingIndexName] = newIndex;
            }
            else
            {
                setObj[targetRepeatingIndexName] = 0;
            }
            setAttrs(setObj);
        });
    }
    
    function getNextRepeatingValue(targetRepeatingIndexName, sourceRepeatingName)    {
        getAttrs([targetRepeatingIndexName], function(values){
            let valIndex = values[targetRepeatingIndexName];
            getRepeatingValue(targetRepeatingIndexName, sourceRepeatingName, function(sourceArray){
                let val = parseInt(valIndex,10);
                if(val>=(sourceArray.length-1)){val=-1;}
                else { val=val+1; }
                return val;
            });
        });
    }
    
    function getPrevRepeatingValue(targetRepeatingIndexName, sourceRepeatingName)    {
        getAttrs([targetRepeatingIndexName], function(values){
            let valIndex = values[targetRepeatingIndexName];
            getRepeatingValue(targetRepeatingIndexName, sourceRepeatingName, function(sourceArray){
                let val = parseInt(valIndex,10);;
                if(val<0){val=sourceArray.length-1;}
                else { val=val-1;}
                return val;
            });
        });
    }
    
    function getPrevRepeatingCorrelatedValue(containingSectionName,changingIndexName,fixedIndexName,browsedSectionName)    {
        getAttrs(["repeating_"+containingSectionName+"_"+changingIndexName,"repeating_"+containingSectionName+"_"+fixedIndexName], function(values){
            let speIndex = values["repeating_"+containingSectionName+"_"+changingIndexName];
            let fieldIndex = values["repeating_"+containingSectionName+"_"+fixedIndexName];
            getSectionIDs(browsedSectionName, function(idarray){
                if(idarray.length==0)return;
                var currentval = parseInt(speIndex,10);
                let correlation = fieldIndex;
                getAttrs(idarray.map(elt=>"repeating_"+browsedSectionName+"_"+elt+"_"+fixedIndexName),function(x){
                    let length = idarray.length;
                    let val=-1;
                    for(let i=(currentval==-1?length:currentval-1);i>=0;i--){
                        if(x["repeating_"+browsedSectionName+"_"+idarray[i]+"_"+fixedIndexName]==correlation)
                        {
                            val=i;
                            break;
                        }
                    }
                    var setObj = {};
                    setObj["repeating_"+containingSectionName+"_"+changingIndexName] = val<0?-1:val;//<0?val+length:val;
                    setAttrs(setObj);
                });
            });
        });
    }
    function getNextRepeatingCorrelatedValue(containingSectionName,changingIndexName,fixedIndexName,browsedSectionName){
        getAttrs(["repeating_"+containingSectionName+"_"+changingIndexName,"repeating_"+containingSectionName+"_"+fixedIndexName], function(values){
            let speIndex = values["repeating_"+containingSectionName+"_"+changingIndexName];
            let fieldIndex = values["repeating_"+containingSectionName+"_"+fixedIndexName];
            getSectionIDs(browsedSectionName, function(idarray){
                if(idarray.length==0)return;
                if(idarray.length>1){
                    var val = parseInt(speIndex,10);
                    let correlation = fieldIndex;
                    getAttrs(idarray.map(elt=>"repeating_"+browsedSectionName+"_"+elt+"_"+fixedIndexName),function(x){
                        let length = idarray.length;
                        for(let i=0;i<length;i++){
                            var nIndex = speIndex+i+1;
                            if(nIndex>=length) nIndex = speIndex-length+i+1;
                            if(x["repeating_"+browsedSectionName+"_"+idarray[nIndex]+"_"+fixedIndexName]==correlation)
                            {
                                if(nIndex<=val)
                                {
                                    val=-1;
                                }
                                else
                                {
                                    val = parseInt(nIndex,10);
                                }
                                break;
                            }
                        }
                        var setObj = {};
                        setObj["repeating_"+containingSectionName+"_"+changingIndexName] = val;
                        setAttrs(setObj);
                    });
                }
                else
                {
                    var setObj = {};
                    setObj["repeating_"+containingSectionName+"_"+changingIndexName] = 0;
                    setAttrs(setObj);
                }
            });
        });
    }
    
    function fooRepeatingRelatedIndexChangeCallback(index, targetRepeatingIndexName, 
    sourceRepeatingName, 
    sourceSuffixList, 
    targetAttrList)    {
        if(sourceSuffixList.length!==targetAttrList.length)
        {
            console.log("Lists doesn't have the same length.");
            return;
        }
        getSectionIDs(sourceRepeatingName, function(idarray){
            getAttrs(sourceSuffixList.map(elt=>`repeating_${sourceRepeatingName}_${idarray[index]}_${elt}`), function(values){
                setObj = {};
                for(let i=0;i<sourceSuffixList.length;i++){
                    setObj[targetAttrList[i]] = values[`repeating_${sourceRepeatingName}_${idarray[index]}_${sourceSuffixList[i]}`];
                }
                setAttrs(setObj);
            });
        });  
    }
    
    
    on("clicked:repeating_weapon:nextspeweapon", function(e){
        getNextRepeatingCorrelatedValue("weapon","fooindexspe","fooindexfield","spec");
    });
    on("clicked:repeating_weapon:prevspeweapon", function(e){
        getPrevRepeatingCorrelatedValue("weapon","fooindexspe","fooindexfield","spec");
    });
    on("clicked:repeating_magic:nextspemagic", function(e){
        getNextRepeatingCorrelatedValue("magic","fooindexspe","fooindexfield","spec");
    });
    on("clicked:repeating_magic:prevspemagic", function(e){
        getPrevRepeatingCorrelatedValue("magic","fooindexspe","fooindexfield","spec");
    });
    
    on("change:repeating_field:fieldname", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("field", "spec", "fooindexfield", changedID, "foospecassociatedfield", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("field", "weapon", "fooindexfield", changedID, "fooweaponassociatedfield", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("field", "magic", "fooindexfield", changedID, "foomagicassociatedfield", e.newValue);
    });
    // update spec, weapon and magic roll en field level change
    on("change:repeating_field:fieldlvl", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("field", "spec", "fooindexfield", changedID, "foospecassociatedfieldlvl", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("field", "weapon", "fooindexfield", changedID, "fooweaponassociatedfieldlvl", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("field", "magic", "fooindexfield", changedID, "foomagicassociatedfieldlvl", e.newValue);
    });
    // update max field level on field level change
    on("change:repeating_field:fieldlvl", function() {
        getSectionIDs("field", function(idarray) {
            let max = 0;
            let attridarray = [];
            for(var i=0; i < idarray.length; i++) {
                attridarray.push("repeating_field_"+idarray[i]+"_fieldlvl");
            }
            getAttrs(attridarray, function(x){
                for(var val in x){
                    let value = x[val];
                    if(max<value){
                        max = value;
                    }
                }
                setAttrs({foomaxfield: max});
            });
        });
    });
    
    on("change:foomaxfield", function(e){
        setAttrs({fooattackperturn : Math.ceil(e.newValue/2)});
    });
    
    on("change:repeating_spec:specname", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("spec", "weapon", "fooindexspe", changedID, "fooweaponassociatedspe", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("spec", "magic", "fooindexspe", changedID, "foomagicassociatedspe", e.newValue);
    });
    
    on("change:repeating_spec:speclvl", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("spec", "weapon", "fooindexspe", changedID, "fooweaponassociatedspelvl", e.newValue);
        updateRepeatingRelatedAttrFromRepeating("spec", "magic", "fooindexspe", changedID, "foomagicassociatedspelvl", e.newValue);
    });
    
    on("change:repeating_spec:specmodif", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("spec", "weapon", "fooindexspe", changedID, "fooweaponassociatedspelvlbonus", e.newValue);
    });
    
    on("clicked:repeating_spec:nextfield", function(eventInfo) {
        getNextRepeatingValue("repeating_spec_fooindexfield", "field");
    });
    
    on("clicked:repeating_spec:prevfield", function(eventInfo) {
        getPrevRepeatingValue("repeating_spec_fooindexfield", "field");
    });
    
    on("clicked:repeating_skill:nextaspect", function(eventInfo) {
        getNextRepeatingValue("repeating_skill_fooindexaspect", "aspect");
    });
    
    on("clicked:repeating_skill:prevaspect", function(eventInfo) {
        getPrevRepeatingValue("repeating_skill_fooindexaspect", "aspect");
    });
    
    on("change:repeating_aspect:aspectlvl", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("aspect", "skill", "fooindexaspect", changedID, "fooskillassociatedaspectlvl", e.newValue);
    });
    
    on("change:repeating_aspect:aspectname", function(e){
        let changedID = e.sourceAttribute.split('_')[2];
        updateRepeatingRelatedAttrFromRepeating("aspect", "skill", "fooindexaspect", changedID, "fooskillassociatedaspect", e.newValue);
    });
    
    on("change:repeating_spec:fooindexfield", function(e){
        evtValueChangedRepeatingRelatedCallback(e.newValue,
            function(v){
                fooRepeatingRelatedIndexChangeCallback(v, "repeating_spec_fooindexfield", "field", ["fieldname", "fieldlvl"], ["repeating_spec_foospecassociatedfield", "repeating_spec_foospecassociatedfieldlvl"]);
            }, 
            function(){
                setObj = {};
                setObj["repeating_spec_foospecassociatedfield"] = "";
                setObj["repeating_spec_foospecassociatedfieldlvl"] = 0;
                setAttrs(setObj);
            });
    });
    
    on("change:repeating_skill:fooindexaspect", function(e){
        evtValueChangedRepeatingRelatedCallback(e.newValue,
            function(v){
                fooRepeatingRelatedIndexChangeCallback(v, "repeating_skill_fooindexaspect", "aspect", ["aspectname", "aspectlvl"], ["repeating_skill_fooskillassociatedaspect", "repeating_tech_fooskillassociatedaspectlvl"]);
            }, 
            function(){
                setObj = {};
                setObj["repeating_skill_fooskillassociatedaspect"] = "";
                setObj["repeating_tech_fooskillassociatedaspectlvl"] = 0;
                setAttrs(setObj);
            });
    });
    
    // update init bonus on check and on field level change
    on("change:repeating_field:fieldiscombatrelated change:repeating_field:fieldlvl", function(){
        getSectionIDs("field", function(idarray){
            let fieldidarray = [];
            for(var i = 0; i < idarray.length; i++)
            {
                fieldidarray.push("repeating_field_"+idarray[i]+"_fieldiscombatrelated");
            }
            getAttrs(fieldidarray, function(x){
                let combatfieldarray = [];
                for(var val in x){
                    let isChecked = x[val]=="1";
                    let id = val.split('_')[2];
                    if(isChecked==true)
                    {
                        combatfieldarray.push("repeating_field_"+id+"_fieldlvl");
                    }
                }
                getAttrs(combatfieldarray, function(xLvl){
                    let initBonus = 0;
                    for(var val in xLvl)
                    {
                        initBonus = initBonus + parseInt(xLvl[val],10);
                    }
                    setAttrs({fooinitbonus: initBonus}); 
                });
            });
        });
    });
    
    on([
    "change:repeating_armor:armorequiped",
    "change:repeating_armor:armormalus",
    "change:repeating_armor:armordefence",
    "change:repeating_armor:armordefencebonus"
    ].join(' '), function(e){
        getSectionIDs("armor", function(idarray){
            let armorfieldarray = [];
            for(var i = 0; i<idarray.length; i++)
            {
                armorfieldarray.push("repeating_armor_"+idarray[i]+"_armorequiped");
                armorfieldarray.push("repeating_armor_"+idarray[i]+"_armordefence");
                armorfieldarray.push("repeating_armor_"+idarray[i]+"_armordefencebonus");
                armorfieldarray.push("repeating_armor_"+idarray[i]+"_armormalus");
            }
            getAttrs(armorfieldarray, function(data){
                let initmalus = 0;
                let armorbonus = 0;
                console.log(data);
                for(var j = 0;j<idarray.length; j++)
                {
                    if(parseInt(data["repeating_armor_"+idarray[j]+"_armorequiped"] || "0",10) == 1)
                    {
                        initmalus += parseInt(data["repeating_armor_"+idarray[j]+"_armormalus"] || "0",10);
                        armorbonus += parseInt(data["repeating_armor_"+idarray[j]+"_armordefence"] || "0",10)+parseInt(data["repeating_armor_"+idarray[j]+"_armordefencebonus"] || "0",10);
                        console.log("armor " + idarray[j] + " imalus: " + initmalus);
                    }
                }
                console.log("foodefence: " + armorbonus);
                console.log("fooinitmalus: " + initmalus);
                setAttrs({foodefence: armorbonus, fooinitmalus: initmalus}); 
            });
        });
    });
    
    on("change:injury_contusions change:injury_meurtrissures change:injury_legeres change:injury_moderes change:injury_graves change:injury_mort change:injury_inconscient", function(e){
        if(e.sourceType=="player"){
            let injuryArray = ["injury_contusions","injury_meurtrissures","injury_legeres","injury_moderes","injury_graves","injury_mort","injury_inconscient"];
            let injuryLevel = ["","-1","-3","-5","-7","+3/-9","Inconscient"];
            let changedLevel = injuryArray.indexOf(e.sourceAttribute);
            let maxed = injuryArray.slice(0, changedLevel);
            if(maxed.length>0)
            {
                setMaxed = {};
                for(var m in maxed)
                {
                    setMaxed[maxed[m]]=5;
                }
                setAttrs(setMaxed);
            }
            if(changedLevel+1<=injuryArray.length){
                let minied = injuryArray.slice(changedLevel+1,injuryArray.length);
                setMinied = {};
                for(var m in minied)
                {
                    setMinied[minied[m]]=0;
                }
                setAttrs(setMinied);
            }
            setAttrs({foocurrentinjurylevel: injuryLevel[changedLevel]});
        }
    });
    
    on("clicked:repeating_weapon:nextfieldweapon", function(eventInfo) {
        getNextRepeatingValue("repeating_weapon_fooindexfield", "field");
    });
    
    on("clicked:repeating_weapon:prevfieldweapon", function(eventInfo) {
        getPrevRepeatingValue("repeating_weapon_fooindexfield", "field");
    });
    
    on("clicked:repeating_magic:nextfieldmagic", function(eventInfo) {
        getNextRepeatingValue("repeating_magic_fooindexfield", "field");
    });
    
    on("clicked:repeating_magic:prevfieldmagic", function(eventInfo) {
        getPrevRepeatingValue("repeating_magic_fooindexfield", "field");
    });
    
    function evtValueChangedRepeatingRelatedCallback(value, okCallback, nOkCallback)
    {
        let newVal = 0;
        if(value!=undefined)
        {
            newVal = value;
        }
        if(newVal!=-1){
            okCallback(newVal);
        }
        else
        {
            nOkCallback();
        }
    }
    
    
    on("change:repeating_weapon:fooindexfield", function(e){
        setAttrs({"repeating_weapon_fooindexspe": -1},function(){
            evtValueChangedRepeatingRelatedCallback(e.newValue,
                function(v){
                    fooRepeatingRelatedIndexChangeCallback(v, "repeating_weapon_fooindexfield", "field", ["fieldname", "fieldlvl"], ["repeating_weapon_fooweaponassociatedfield", "repeating_weapon_fooweaponassociatedfieldlvl"]);
                }, 
                function(){
                    setObj = {};
                    setObj["repeating_weapon_fooweaponassociatedfield"] = "";
                    setObj["repeating_weapon_fooweaponassociatedfieldlvl"] = 0;
                    setAttrs(setObj);
                });
        });
    });
    
    on("change:repeating_weapon:fooindexspe", function(e){
        evtValueChangedRepeatingRelatedCallback(e.newValue,
            function(v){
                fooRepeatingRelatedIndexChangeCallback(v, "repeating_weapon_fooindexspe", "spec", ["specname", "speclvl", "specmodif"], ["repeating_weapon_fooweaponassociatedspe", "repeating_weapon_fooweaponassociatedspelvl", "repeating_weapon_fooweaponassociatedspelvlbonus"]);
            }, 
            function(){
                setObj = {};
                setObj["repeating_weapon_fooweaponassociatedspe"] = "";
                setObj["repeating_weapon_fooweaponassociatedspelvl"] = 0;
                setObj["repeating_weapon_fooweaponassociatedspelvlbonus"] = 0;
                setAttrs(setObj);
            });
    });
    
    on("change:repeating_magic:fooindexfield", function(e){
        setAttrs({"repeating_magic_fooindexspe": -1},function(){
            evtValueChangedRepeatingRelatedCallback(e.newValue,
                function(v){
                    fooRepeatingRelatedIndexChangeCallback(v, "repeating_magic_fooindexfield", "field", ["fieldname", "fieldlvl"], ["repeating_magic_foomagicassociatedfield", "repeating_magic_foomagicassociatedfieldlvl"]);
                }, 
                function(){
                    setObj = {};
                    setObj["repeating_magic_foomagicassociatedfield"] = "";
                    setObj["repeating_magic_foomagicassociatedfieldlvl"] = 0;
                    setAttrs(setObj);
                });
        });
    });
    
    on("change:repeating_magic:fooindexspe", function(e){
        evtValueChangedRepeatingRelatedCallback(e.newValue,
            function(v){
                fooRepeatingRelatedIndexChangeCallback(v, "repeating_magic_fooindexspe", "spec", ["specname", "speclvl", "specmodif"], ["repeating_magic_foomagicassociatedspe", "repeating_magic_foomagicassociatedspelvl", "repeating_magic_foomagicassociatedspelvlbonus"]);
            }, 
            function(){
                setObj = {};
                setObj["repeating_magic_foomagicassociatedspe"] = "";
                setObj["repeating_magic_foomagicassociatedspelvl"] = 0;
                setObj["repeating_magic_foomagicassociatedspelvlbonus"] = 0;
                setAttrs(setObj);
            });
    });
    
    on("change:gmrollcheck",function(e){
        setAttrs({gmroll: e.newValue==1?"/w gm ":""});
    });
    
    // -- Modal handling -- //
    const skillOptionArray = ["modalrange","modaltime","modalvalue","modaltarget","modalbonus","modalinvoc","modalinvocp", "modalpurif", "modaltransformationt"];
    on("change:modal", function() {
        setOption = {};
        for(var m in skillOptionArray)
        {
            setOption[skillOptionArray[m]]=-1;
        }
        setAttrs(setOption);
    });
    
    skillOptionArray.forEach(skillOption => {
        on(`change:${skillOption}`, function() {
            getAttrs(skillOptionArray,function(x){
            
            let modalvalue = 0;
            
            for(var option in x)
            {
                modalvalue += Math.max(parseInt(x[option]),0);
            };            
            
            setAttrs({
                modalpower: modalvalue
            });
        });
        });
    });
    
    const ritualOptionArray = ["modalrrange","modalrtime","modalrvalue","modalrench","modalrdiff", "modalrtarget","modalrbonus","modalrinvoc","modalrinvocp", "modalrpurif", "modalrtransformationm"];
    on("change:modalritual", function() {
        setOption = {};
        for(var m in ritualOptionArray)
        {
            setOption[ritualOptionArray[m]]=-1;
        }
        setAttrs(setOption);
    });
    
    ritualOptionArray.forEach(ritualOption => {
        on(`change:${ritualOption}`, function() {
            getAttrs(ritualOptionArray,function(x){
            
            let modalvalue = 0;
            
            for(var option in x)
            {
                modalvalue += Math.max(parseInt(x[option]),0);
            };            
            
            setAttrs({
                modalrpower: modalvalue
            });
        });
        });
    });
</script>
