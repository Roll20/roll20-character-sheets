<input type="checkbox" name="attr_styleset0" class="color-setting color-setting-0" ></input> <!-- Used to activate the color setting rule, add one to add a new style, mind the numbering-->
<input type="checkbox" name="attr_styleset1" class="color-setting color-setting-1" ></input>
<input type="checkbox" name="attr_styleset2" class="color-setting color-setting-2" ></input>
<input type="checkbox" name="attr_styleset3" class="color-setting color-setting-3" ></input>
<input type="checkbox" name="attr_styleset4" class="color-setting color-setting-4" ></input>
<input type="checkbox" name="attr_styleset5" class="color-setting color-setting-5" ></input>
<input type="checkbox" name="attr_styleset6" class="color-setting color-setting-6" ></input>
<input type="checkbox" name="attr_styleset7" class="color-setting color-setting-7" ></input>
<input type="checkbox" name="attr_styleset8" class="color-setting color-setting-8" ></input>

<div class="wrapper">
	
	<input type="hidden" name="attr_show_roll_modifiers" value="0" />
	<input type="hidden" name="attr_roll_modifier_types" value="" />
	<input type="hidden" name="attr_roll_modifier_summary" value="" />
	<input type="hidden" name="attr_roll_trait_summary" value="" />
	<input type="hidden" name="attr_roll_hit_location" value="" />
	<input type="hidden" name="attr_roll_maneuver" value=""  />
	<input type="hidden" name="attr_roll_allout_attack" value=""  />
	<input type="hidden" name="attr_roll" value="" />
	<input type="hidden" name="attr_modifier" value="[[?{Modifier|0}]]" />
	<input type="hidden" name="attr_popup_modifier" value="@{Modifier}" />
	<div class="modal">
		<div class="modal-dialog">
			<div class="modal-header">
				<div class="close-button">
					<button type="action" name="act_close_roll_modifiers" class="btn close" title="Close">X</button>
				</div>
				<h2>
					<span data-i18n="roll-modifiers-heading">Roll Modifiers Toolbox</span>
				</h2>
			</div>
			<div class="modal-body">
				
				<div class="modal-sub-header">
					<!-- GRID Layout X (see css) items per row -->
					<div class="container">

						<!-- row 1 -->
						<div class="item item1">

							<div class="block add-min-height">
								<input type="number" readonly="readonly" value="0" name="attr_roll_modifier" title="Macro: @{NAME|roll_modifier}" />
								<span data-i18n="total-roll-modifier-label">Total Modifier</span>
							</div>

							<div class="block">
								<div class="item item1">
									<label>
										<select name="attr_shock_penalty" class="number-only-width" title="Macro: @{NAME|shock_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
										</select>
										<span data-i18n="shock-label">Shock</span>
									</label>
								</div>
							</div>

						</div>

						<div class="item item2">

							<div class="block add-min-height">
								<label>
									<div>
										<input type="checkbox" name="attr_max_skill_nine" value="1" title="Macro: @{NAME|max_skill_nine}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="max-skill-9-label">Max skill of 9</span>
											<span class="tooltiptext">
												<span data-i18n="max-skill-9-tooltip">The effective skill cannot exceed 9.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="block">
								<label>
									<input type="number" value="0" step="1" name="attr_dialog_custom_roll_modifier" title="Macro: @{NAME|dialog_custom_roll_modifier}" />
									<span data-i18n="custom-modifier-label">Custom Modifier</span>
								</label>
							</div>

						</div>

						<div class="item item3-5">
							<div class="block reason-for-mod">
								<div>
									<span data-i18n="reason-for-mod-label">Reason for Mod:</span>
								</div>	
								
								<div>
									<textarea name="attr_dialog_custom_roll_modifier_reason" title="Macro: @{NAME|dialog_custom_roll_modifier_reason}"></textarea>
								</div>

							</div>
						</div>

					</div>

					<div class="container">

						<!-- Row 1 -->
						<div class="item item1-5 full-width">
							<div class="tooltip">
								<h4 class="font-color-red">
									<span data-i18n="traits-label">Traits</span>
								</h4>
								<span class="tooltiptext">
									<span data-i18n="roll-modifier-traits-tooltip">These refer to character traits that rarely change, they will not be cleared when the reset button is used.</span>
								</span>
							</div>
						</div>

						<!-- Row 2 -->
						<div class="item item1">
							<label>
								<div>
									<select name="attr_night_vision" class="number-only-width" title="Macro: @{NAME|night_vision}">
										<option>0</option>
										<option>1</option>
										<option>2</option>
										<option>3</option>
										<option>4</option>
										<option>5</option>
										<option>6</option>
										<option>7</option>
										<option>8</option>
										<option>9</option>
									</select>
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="night-vision-label">Night Vision</span>
										<span class="tooltiptext">
											<span data-i18n="night-vision-tooltip">This value negates darkness penalties, except for total darkness. See B71.</span>
										</span>
									</div>
								</div>
							</label>
						</div>

						<div class="item item2">
							<label>
								<div>
									<input type="checkbox" name="attr_has_dark_vision" value="1" title="Macro: @{NAME|has_dark_vision}" />
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="dark-vision-label">Dark Vision</span>
										<span class="tooltiptext">
											<span data-i18n="dark-vision-tooltip">If checked, Dark Vision negates all darkness penalties. Can see using some other means than light, radar, or sonar. See B47.</span>
										</span>
									</div>
								</div>
							</label>
						</div>

						<div class="item item3">
							<label>
								<div>
									<input type="checkbox" name="attr_is_used_to_blindness" value="1" title="Macro: @{NAME|is_used_to_blindness}" />
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="used-to-blindness-label">Used to blindess</span>
										<span class="tooltiptext">
											<span data-i18n="used-to-blindness-tooltip">If used to blindess, the max Visibility penalty is -6. See B124 and B394.</span>
										</span>
									</div>
								</div>
							</label>
						</div>
						
						<div class="item item4">
							<label>
								<div>
									<input type="checkbox" name="attr_has_high_pain_threshold" value="1" title="Macro: @{NAME|has_high_pain_threshold}" />
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="high-pain-threshold-label">High Pain Threshold</span>
										<span class="tooltiptext">
											<span data-i18n="high-pain-threshold-tooltip">If checked, High Pain Threshold negates all shock penalties and reduces pain penalties. See B59.</span>
										</span>
									</div>
								</div>
							</label>
						</div>

						<div class="item item5">
							<label>
								<div>
									<input type="checkbox" name="attr_has_low_pain_threshold" value="1" title="Macro: @{NAME|has_low_pain_threshold}" />
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="low-pain-threshold-label">Low Pain Threshold</span>
										<span class="tooltiptext">
											<span data-i18n="low-pain-threshold-tooltip">If checked, Low Pain Threshold doubles shock and pain penalties. See B142.</span>
										</span>
									</div>
								</div>
							</label>
						</div>

					</div>

					<div class="container">

						<!-- Row 1 -->
						<div class="item item1-5 full-width">
							<div class="tooltip">
								<h4 class="font-color-red">
									<span data-i18n="temporary-traits-label">Temporary Traits</span>
								</h4>
								<span class="tooltiptext">
									<span data-i18n="roll-modifier-temporary-traits-tooltip">These refer to temporary traits that affect the character for a short, such as magic spells, potions, goggles, etc. They will be cleared when the reset button is used.</span>
								</span>
							</div>
						</div>

						<!-- Row 2 -->
						<div class="item item1">
							<label>
								<div>
									<select name="attr_temporary_night_vision" class="number-only-width" title="Macro: @{NAME|temporary_night_vision}">
										<option>0</option>
										<option>1</option>
										<option>2</option>
										<option>3</option>
										<option>4</option>
										<option>5</option>
										<option>6</option>
										<option>7</option>
										<option>8</option>
										<option>9</option>
									</select>
								</div>
								<div>
									<div class="tooltip">
										<span data-i18n="night-vision-label">Night Vision</span>
										<span class="tooltiptext">
											<span data-i18n="temporary-night-vision-tooltip">This value negates darkness penalties and is ADDED to the night vision listed above, except for total darkness. See B71.</span>
										</span>
									</div>
								</div>
							</label>
						</div>

					</div>

				</div><!-- end .modal-sub-header -->
				
				<hr />
				
				<div class="modal-main-content">

					<input type="hidden" name="attr_display_ranged_maneuvers_section" value="0" />
					<div class="ranged-maneuvers section">

						<div class="container aiming-stats">
							<!-- Row 1 -->
							<div class="item item1-5">
								<h4>
									<span data-i18n="aiming-stats-label">Aiming Stats</span>
								</h4>
							</div>

							<div class="item item6-9">
								<h4>
									<span data-i18n="targeting-systems-title">Targeting Systems</span>
								</h4>
							</div>

							<!-- Row 2 -->
							<div class="item item10">
								<div>
									<div class="tooltip">
										<span data-i18n="abbreviation-accuracy-label">Acc</span>
										<span class="tooltiptext">
											<span data-i18n="accuracy-tooltip">Accuracy B260. Your combined bonus from all targeting systems (scopes, sights, computers, etc.) cannot exceed the weapon's base Accuracy, see Aim B354.</span>
										</span>
									</div>
								</div>
								<div>
									<input type="number" name="attr_ranged_accuracy_bonus" value="0" min="0" step="1" title="Macro: @{NAME|ranged_accuracy_bonus}" />
								</div>
							</div>

							<div class="item item12">
								<div>
									<div class="tooltip">
										<span data-i18n="elevation-label">Elevation</span>
										<span class="tooltiptext">
											<span data-i18n="ranged-elevation-label">Elevation. If you're above the target, enter a positive number of hexes. If you're below the target, enter a negative number of hexes. See B407.</span>
										</span>
									</div>
								</div>
								<div>
									<input type="number" name="attr_ranged_elevation" value="0" step="1" title="Macro: @{NAME|ranged_elevation}" />
								</div>
							</div>
							
							<div class="item item11">
								<div>
									<div class="tooltip">
										<span data-i18n="range-speed-label">Range/Speed</span>
										<span class="tooltiptext">
											<span data-i18n="range-speed-tooltip">Enter the range of target and factor in relative speed if target crosses path of shooter. See B372.</span>
										</span>
									</div>
								</div>
								<div>
									<input type="number" name="attr_ranged_range_speed" value="0" min="0" step="1" title="Macro: @{NAME|ranged_range_speed}" />
									<input type="hidden" name="attr_ranged_range_speed_modifier" value="0" />
									<span name="attr_ranged_range_speed_modifier"></span>
								</div>
							</div>

							<div class="item item13">

								<div>
									<div class="tooltip">
										<span data-i18n="aim-bonus-label">Aim Bonus</span>
										<span class="tooltiptext">
											<span data-i18n="aiming-bonus-tooltip">Each turn <b>after</b> the initial aim, you get an additional bonus. See B364</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_ranged_aiming_bonus" title="Macro: @{NAME|ranged_aiming_bonus}">
										<option value="0" selected="selected">+0</option>
										<option value="1">2 turns: +1</option>
										<option value="2">3+ turns: +2</option>
									</select>
								</div>
								
							</div>

							<div class="item item14">
								<div>
									<div class="tooltip">
										<span data-i18n="shots-fired-label">Shots</span>
										<span class="tooltiptext">
											<span data-i18n="shots-fired-tooltip">
												Shots Fired<br>The number of shots fired in a single round. This should not exceed the <b>RoF</b> for the weapon.
											</span>
										</span>
									</div>
								</div>
								<div>
									<input type="number" name="attr_ranged_rof" value="1" min="1" step="1" title="Macro: @{NAME|ranged_rof}" />
									<input type="hidden" name="attr_ranged_rof_modifier" value="0" />
									<span name="attr_ranged_rof_modifier"></span>
								</div>
							</div>

							<div class="item item15 border-left">
								<div>
									<div class="tooltip">
										<span data-i18n="scope-label">Scope</span>
										<span class="tooltiptext">
											<span data-i18n="scope-bonus-tooltip">Each turn <b>after</b> the initial aim, you get an additional bonus up to the scope's bonus.<br />Fixed scopes, aim at least as many turns as the scope's bonus.<br />See B412</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_ranged_scope_bonus" title="Macro: @{NAME|ranged_scope_bonus}">
										<option value="0">+0</option>
										<option value="1">+1</option>
										<option value="2">+2</option>
										<option value="3">+3</option>
										<option value="4">+4</option>
									</select>
								</div>
							</div>

							<div class="item item16">
								<div>
									<div class="tooltip">
										<span data-i18n="vehicle-targeting-label">Vehicle Targeting</span>
										<span class="tooltiptext">
											<span data-i18n="vehicle-targeting-tooltip">Vehicle targeting system bonus if shooter took time to aim. See B469</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_ranged_vehicle_targeting_bonus" title="Macro: @{NAME|ranged_vehicle_targeting_bonus}">
										<option value="0">+0</option>
										<option value="1">+1</option>
										<option value="2">+2</option>
										<option value="3">+3</option>
									</select>
								</div>
							</div>

							<div class="item item17">
								<div>
									<div class="tooltip">
										<span data-i18n="laser-sight-label">Laser Sight: +1</span>
										<span class="tooltiptext move-left">
											<span data-i18n="laser-sight-tooltip">Laser sight gives +1 to hit.<b>NOTE:</b> If target can see aiming dot, they got +1 dodge! See B412</span>
										</span>
									</div>
								</div>
								<div>
									<input type="checkbox" name="attr_ranged_laser_sight" value="1" title="Macro: @{NAME|ranged_laser_sight}" />
								</div>
							</div>

							<div class="item item18">
								<div>
									<div class="tooltip">
										<span data-i18n="total-label">Total</span>
										<span class="tooltiptext move-left">
											<span data-i18n="targeting-systems-description">Combined totals from all targeting systems can't exceed weapon's base Accuracy. See B364</span>
										</span>
									</div>
								</div>
								<div>
									<input type="hidden" name="attr_ranged_targeting_system_modifier" value="0" title="Macro: @{NAME|ranged_targeting_system_modifier}" />
									<span name="attr_ranged_targeting_system_modifier"></span>
								</div>
							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_attack_section" value="0" />
					<div class="attack section">

						<div class="container">

							<!-- Row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="hit-location-label">Hit Location</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">
								<div>
									<div class="tooltip">
										<span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span>
										<input type="hidden" name="attr_display_ranged_maneuvers_section" value="0" />
										<span class="tooltiptext ranged">
											<span data-i18n="target-ranged-size-modifier-tooltip">Size Modifier of target. The modifier is applied AFTER location, grapple, shield, chinks in armor have been applied.</span>
										</span>
										<input type="hidden" name="attr_display_melee_maneuvers_section" value="0" />
										<span class="tooltiptext melee">
											<span data-i18n="target-melee-size-modifier-tooltip">Size Modifier of target, which will then be substracted by your size modifier to get a final <b>Relative Size Modifier</b>.<br />The modifier is applied AFTER location, grapple, shield, chinks in armor have been applied.<br />For information on Relative SM see http://www.sjgames.com/gurps/faq/FAQ4-3.html#SS3.4.2.23</span>
										</span>
									</div>
								</div>
								<div>
									<input type="number" name="attr_target_size_modifier" step="0" value="0" />
								</div>
							</div>
							
							<div class="item item7">
								<div>
									<div class="tooltip">
										<span data-i18n="type-label">Type</span>
										<span class="tooltiptext">
											<span data-i18n="hit-location-type-tooltip">Use the drop-downs to select a hit location or enter a value manually. See B552-555.<br />Humanoid Low Tech, see LT100-103.<br />Martial Arts, see MA137</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_hit_location_type" title="Macro: @{NAME|hit_location_type}">
										<option>Select</option>
										<option value="arachnoid">Arachnoid (spider)</option>
										<option value="avian">Avian</option>
										<option value="cancroid">Cancroid (crab)</option>
										<option value="centaur">Centaur</option>
										<option value="hexapod">Hexapod</option>
										<option value="humanoid">Humanoid</option>
										<option value="humanoid_low_tech">Humanoid Low-tech</option>
										<option value="humanoid_martial_arts">Humanoid Martial Arts</option>
										<option value="ichthyoid">Ichthyoid (fish)</option>
										<option value="octopod">Octopod (octopus)</option>
										<option value="quadruped">Quadruped</option>
										<option value="vehicle">Vehicle</option>
										<option value="vermiform">Vermiform (snake)</option>
									</select>
								</div>
							</div>
							
							<div class="item item8">
								<div>
									<div class="tooltip">
										<span data-i18n="location-label">Location</span>
										<span class="tooltiptext">
											<span data-i18n="location-tooltip">Select a location.</span>
										</span>
									</div>
								</div>
								<div class="select-hit-location">
									<input type="hidden" name="attr_hit_location_type" />
									<select name="attr_humanoid_location" title="Macro: @{NAME|humanoid_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-arm-2">-2 : Left Arm</option>
										<option value="left-hand-4">-4 : Left Hand</option>
										<option value="right-arm-2">-2 : Right Arm</option>
										<option value="right-hand-4">-4 : Right Hand</option>
										<option value="left-leg-2">-2 : Left Leg</option>
										<option value="left-foot-4">-4 : Left Foot</option>
										<option value="right-leg-2">-2 : Right Leg</option>
										<option value="right-foot-4">-4 : Right Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_humanoid_low_tech_location" title="Macro: @{NAME|humanoid_low_tech_location}" class="hit-location">
										<option value="chest-0">0 : Chest</option>
										<option value="abdomen-1">-1 : Abdomen</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-arm-2">-2 : Left Arm</option>
										<option value="left-hand-4">-4 : Left Hand</option>
										<option value="right-arm-2">-2 : Right Arm</option>
										<option value="right-hand-4">-4 : Right Hand</option>
										<option value="left-leg-2">-2 : Left Leg</option>
										<option value="left-foot-4">-4 : Left Foot</option>
										<option value="right-leg-2">-2 : Right Leg</option>
										<option value="right-foot-4">-4 : Right Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_humanoid_martial_arts_location" title="Macro: @{NAME|humanoid_martial_arts_location}" class="hit-location">
										<option value="chest-0">0 : Chest</option>
										<option value="abdomen-1">-1 : Abdomen</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="neck-veins-8">-8 : Neck Veins</option>
										<option value="jaw-6">-6 : Jaw</option>
										<option value="nose-7">-7 : Nose</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="spine-8">-8 : Spine</option>
										<option value="left-ear-7">-7 : Left ear</option>
										<option value="right-ear-7">-7 : Right ear</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-arm-2">-2 : Left Arm</option>
										<option value="left-arm-joint-5">-5 : Left Arm Joint</option>
										<option value="left-arm-veins-5">-5 : Left Arm Veins</option>
										<option value="left-hand-4">-4 : Left Hand</option>
										<option value="left-hand-joint-7">-7 : Left Hand Joint</option>
										<option value="right-arm-2">-2 : Right Arm</option>
										<option value="right-arm-joint-5">-5 : Right Arm Joint</option>
										<option value="right-arm-veins-5">-5 : Right Arm Veins</option>
										<option value="right-hand-4">-4 : Right Hand</option>
										<option value="right-hand-joint-7">-7 : Right Hand Joint</option>
										<option value="left-leg-2">-2 : Left Leg</option>
										<option value="left-leg-joint-5">-5 : Left Leg Joint</option>
										<option value="left-leg-veins-5">-5 : Left Leg Veins</option>
										<option value="left-foot-4">-4 : Left Foot</option>
										<option value="left-foot-joint-7">-7 : Left Foot Joint</option>
										<option value="right-leg-2">-2 : Right Leg</option>
										<option value="right-leg-joint-5">-5 : Right Leg Joint</option>
										<option value="right-leg-veins-5">-5 : Right Leg Veins</option>
										<option value="right-foot-4">-4 : Right Foot</option>
										<option value="right-foot-joint-4">-7 : Right Foot Joint</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_arachnoid_location" title="Macro: @{NAME|arachnoid_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="brain-7">-7 : Brain</option>
										<option value="eye-#1-9">-9 : Eye #1</option>
										<option value="eye-#2-9">-9 : Eye #2</option>
										<option value="eye-#3-9">-9 : Eye #3</option>
										<option value="eye-#4-9">-9 : Eye #4</option>
										<option value="eye-#5-9">-9 : Eye #5</option>
										<option value="eye-#6-9">-9 : Eye #6</option>
										<option value="leg-#1-2">-2 : Leg #1</option>
										<option value="leg-#2-2">-2 : Leg #2</option>
										<option value="leg-#3-2">-2 : Leg #3</option>
										<option value="leg-#4-2">-2 : Leg #4</option>
										<option value="leg-#5-2">-2 : Leg #5</option>
										<option value="leg-#6-2">-2 : Leg #6</option>
										<option value="leg-#7-2">-2 : Leg #7</option>
										<option value="leg-#8-2">-2 : Leg #8</option>
									</select>

									<select name="attr_avian_location" title="Macro: @{NAME|avian_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-wing-2">-2 : Left Wing</option>
										<option value="right-wing-2">-2 : Right Wing</option>
										<option value="left-leg-2">-2 : Left Leg</option>
										<option value="left-foot-4">-4 : Left Foot</option>
										<option value="right-leg-2">-2 : Right Leg</option>
										<option value="right-foot-4">-4 : Right Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_cancroid_location" title="Macro: @{NAME|cancroid_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-pincer-2">-2 : Left Pincer</option>
										<option value="right-pincer-2">-2 : Right Pincer</option>
										<option value="leg-#1-2">-2 : Leg #1</option>
										<option value="leg-#2-2">-2 : Leg #2</option>
										<option value="leg-#3-2">-2 : Leg #3</option>
										<option value="leg-#4-2">-2 : Leg #4</option>
										<option value="leg-#5-2">-2 : Leg #5</option>
										<option value="leg-#6-2">-2 : Leg #6</option>
										<option value="leg-#7-2">-2 : Leg #7</option>
										<option value="leg-#8-2">-2 : Leg #8</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_centaur_location" title="Macro: @{NAME|centaur_location}" class="hit-location">
										<option value="human-torso-0">0 : Torso</option>
										<option value="animal-torso-0">0 : Animal Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-arm-2">-2 : Left Arm</option>
										<option value="left-hand-4">-4 : Left Hand</option>
										<option value="right-arm-2">-2 : Right Arm</option>
										<option value="right-hand-4">-4 : Right Hand</option>
										<option value="left-foreleg-2">-2 : Left Foreleg</option>
										<option value="left-foreleg-foot-4">-4 : Left Foreleg Foot</option>
										<option value="right-foreleg-2">-2 : Right Foreleg</option>
										<option value="right-foreleg-foot-4">-4 : Right Fore Foot</option>
										<option value="left-hind-leg-2">-2 : Left Hind Leg</option>
										<option value="left-hind-foot-4">-4 : Left Hind Foot</option>
										<option value="right-hind-leg-2">-2 : Right Hind Leg</option>
										<option value="right-hind-foot-4">-4 : Right Hind Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_hexapod_location" title="Macro: @{NAME|hexapod_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-wing-2">-2 : Left Wing</option>
										<option value="right-wing-2">-2 : Right Wing</option>
										<option value="left-foreleg-2">-2 : Left Foreleg</option>
										<option value="left-foreleg-foot-4">-4 : Left Foreleg Foot</option>
										<option value="right-foreleg-2">-2 : Right Foreleg</option>
										<option value="right-foreleg-foot-4">-4 : Right Foreleg Foot</option>
										<option value="left-mid-leg-2">-2 : Left Mid leg</option>
										<option value="left-mid-foot-4">-4 : Left Mid Foot</option>
										<option value="right-mid-leg-2">-2 : Right Mid Leg</option>
										<option value="right-mid-foot-4">-4 : Right Mid Foot</option>
										<option value="left-hind-leg-2">-2 : Left Hind Leg</option>
										<option value="left-hind-foot-4">-4 : Left Hind Foot</option>
										<option value="right-hind-leg-2">-2 : Right Hind Leg</option>
										<option value="right-hind-foot-4">-4 : Right Hind Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_ichthyoid_location" title="Macro: @{NAME|ichthyoid_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-8">-8 : Left Eye</option>
										<option value="right-eye-8">-8 : Right Eye</option>
										<option value="left-fin-2">-2 : Left Fin</option>
										<option value="right-fin-2">-2 : Right Fin</option>
										<option value="top-fin-4">-4 : Top Fin</option>
										<option value="bottom-fin-2">-2 : Bottom Fin</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_octopod_location" title="Macro: @{NAME|octopod_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="brain-7">-7 : brain</option>
										<option value="left-eye-8">-8 : Left Eye</option>
										<option value="right-eye-8">-8 : Right Eye</option>
										<option value="arm-#1-2">-2 : Arm #1</option>
										<option value="arm-#2-2">-2 : Arm #2</option>
										<option value="arm-#3-2">-2 : Arm #3</option>
										<option value="arm-#4-2">-2 : Arm #4</option>
										<option value="arm-#5-2">-2 : Arm #5</option>
										<option value="arm-#6-2">-2 : Arm #6</option>
										<option value="arm-#7-2">-2 : Arm #7</option>
										<option value="arm-#8-2">-2 : Arm #8</option>
									</select>

									<select name="attr_quadruped_location" title="Macro: @{NAME|quadruped_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-9">-9 : Left Eye</option>
										<option value="right-eye-9">-9 : Right Eye</option>
										<option value="left-wing-2">-2 : Left Wing</option>
										<option value="right-wing-2">-2 : Right Wing</option>
										<option value="left-foreleg-2">-2 : Left Foreleg</option>
										<option value="left-foreleg-foot-4">-4 : Left Foreleg Foot</option>
										<option value="right-foreleg-2">-2 : Right Foreleg</option>
										<option value="right-foreleg-foot-4">-4 : Right Foreleg Foot</option>
										<option value="left-hind-leg-2">-2 : Left Hind Leg</option>
										<option value="left-hind-foot-4">-4 : Left Hind Foot</option>
										<option value="right-hind-leg-2">-2 : Right Hind Leg</option>
										<option value="right-hind-foot-4">-4 : Right Hind Foot</option>
										<option value="tail-3">-3 : Tail</option>
									</select>

									<select name="attr_vehicle_location" title="Macro: @{NAME|vehicle_location}" class="hit-location">
										<option value="body-0">0 : Body. Check occupant hit.</option>
										<option value="open-cabin-3">-3 : Open Cabin. Check occupant hit.</option>
										<option value="small-window-7">-7 : Small Window (1/2 DR). Check occupant hit.</option>
										<option value="large-window-3">-3 : Large Window (1/2 DR). Check occupant hit.</option>
										<option value="exposed-weapon-mount-7">-7 : Exposed Weapon Mount (HP/5)</option>
										<option value="small-superstructure-5">-5 : Small Superstructure (HP/3)</option>
										<option value="independent-turret-5">-5 : Independent Turrent (HP/3)</option>
										<option value="caterpillar-track-2">-2 : Caterpillar Track (HP/2)</option>
										<option value="helicopter-rotor-2">-2 : Helicoptor Rotor (HP/3)</option>
										<option value="wing-2">-2 : Wing (HP/2)</option>
										<option value="mast-2">-2 : Mast (HP/2 times # of masts)</option>
										<option value="arm-2">-2 : Arm (HP/2)</option>
										<option value="large-superstructure-2">-2 : Large Superstructure. Check occupant hit.</option>
										<option value="main-turret-2">-2 : Main Turret. Check occupant hit.</option>
										<option value="runner-skid-4">-4 : Runner or Skid (HP/3)</option>
										<option value="wheel-4">-4 : Wheel (HP/2 times # of wheels)</option>
										<option value="vital-area-3">-3 : Vital Area (extra damage)</option>
									</select>

									<select name="attr_vermiform_location" title="Macro: @{NAME|vermiform_location}" class="hit-location">
										<option value="torso-0">0 : Torso</option>
										<option value="vitals-3">-3 : Vitals</option>
										<option value="groin-3">-3 : Groin</option>
										<option value="face-5">-5 : Face</option>
										<option value="neck-5">-5 : Neck</option>
										<option value="skull-7">-7 : Skull</option>
										<option value="left-eye-8">-8 : Left Eye</option>
										<option value="right-eye-8">-8 : Right Eye</option>
									</select>

									<select name="attr_weapon_location" title="Macro: @{NAME|weapon_location}" class="hit-location">
										<option value="damage-reach-c-5">-5 : Damage Reach C (knife/pistol)</option>
										<option value="damage-reach-1-4">-4 : Damage Reach 1 (broadsword)</option>
										<option value="damage-reach-2+-4">-3 : Damage Reach 2+ (spear)</option>
										<option value="disarm-reach-c-5">-5 : Disarm Reach C (using non-fencing)</option>
										<option value="disarm-reach-1-4">-4 : Disarm Reach 1 (using non-fencing)</option>
										<option value="disarm-reach-2+-4">-3 : Disarm Reach 2+ (using non-fencing)</option>
										<option value="fencing-disarm-reach-c-5">-5 : Disarm Reach C (using fencing)</option>
										<option value="fencing-disarm-reach-1-4">-4 : Disarm Reach 1 (using fencing)</option>
										<option value="fencing-disarm-reach-2+-4">-3 : Disarm Reach 2+ (using fencing)</option>
									</select>

								</div>
							</div>

							<!-- only for melee attacks -->
							<input type="hidden" name="attr_display_melee_maneuvers_section" value="0" />
							<div class="item item9 melee-maneuvers">
								<div>
									<div class="tooltip">
										<span data-i18n="grapple-label">Grapple</span>
										<span class="tooltiptext">
											<span data-i18n="grapple-tooltip">Grapple halves to-hit penalty. See B370 for more information.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_grapple_modifier">
										<option value="-1"></option>
										<option value="0">0 : 1 or 2 limbs</option>
										<option value="2">+2 : 3 limbs</option>
										<option value="4">+4 : 4 limbs</option>
										<option value="6">+6 : 5 limbs</option>
										<option value="8">+8 : 6 limbs</option>
										<option value="10">+10 : 7 limbs</option>
										<option value="12">+12 : 8 limbs</option>
										<option value="14">+14 : 9 limbs</option>
										<option value="16">+16 : 10 limbs</option>
										<option value="18">+18 : 11 limbs</option>
										<option value="20">+20 : 12 limbs</option>
									</select>
								</div>
							</div>

							<div class="item item10">
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_has_shield" value="1" title="Macro: @{NAME|has_shield}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="has-shield-label">Has Shield</span>
												<span class="tooltiptext move-left">
													<span data-i18n="has-shield-tooltip">Apply additional penalty to limb for carrying a shield. Can be applied to arm, leg, foot, pincer, wing, or tail.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_target_chink_in_armor" value="1" title="Macro: @{NAME|target_chink_in_armor}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="chinks-in-armor-label">Chinks in armor</span>
												<span class="tooltiptext move-left">
													<span data-i18n="chinks-in-armor-tooltip">Target chinks in the armor for the hit location. -8 to torso, -10 to other locations. DR is halved. See B400.</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
							</div>
						</div>
						
						<!-- only for ranged attacks -->
						<input type="hidden" name="attr_display_ranged_maneuvers_section" value="0" />
						<div class="container ranged-maneuvers">
							 
							<!-- Row 1 -->
							<div class="item item1">

								<h5>
									<span data-i18n="cover-title">Cover</span>
								</h5>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_target_light_cover" value="1" title="Macro: @{NAME|target_light_cover}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="light-cover-label">Light Cover: -2</span>
												<span class="tooltiptext">
													<span data-i18n="light-cover-tooltip">Shooting through light cover is -2 to hit. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item2">

								<h5>&nbsp;</h5>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_target_down" value="1" title="Macro: @{NAME|target_down}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="target-prone-label">Target Prone: -2</span>
												<span class="tooltiptext">
													<span data-i18n="target-prone-tooltip">If target is crouching, kneeling, sitting, or lying down, apply -2 to hit torso, groin, or legs.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item2">
								
								<h5>&nbsp;</h5>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_target_partly_exposed" value="1" title="Macro: @{NAME|target_partly_exposed}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="partly-exposed-label">Partly Exposed: -2</span>
												<span class="tooltiptext">
													<span data-i18n="partly-exposed-tooltip">Target or hit location is partly exposed, add an additional -2 to hit. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item2">

								<h5>&nbsp;</h5>

								<div class="block">
									<label>
										<div>
											<input type="number" name="attr_target_intervening_figures" value="0" min="0" step="1" title="Macro: @{NAME|target_intervening_figures}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="intervening-figures-label">Intervening figures: -4 each</span>
												<span class="tooltiptext move-left">
													<span data-i18n="intervening-figures-tooltip">Enter the number of intervening figures between you and your target, penalty is -4 per figure. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>


						</div>

						<div class="container">
							
							<!-- row #1 -->
							<div class="item item1">
								<div>Mod</div>
								<div>
									<input type="number" step="1" value="0" name="attr_hit_location_modifier" title="Macro: @{NAME|hit_location_modifier}" />
								</div>
							</div>
							
							<div class="item item2-5">
								<div>Description</div>
								<div>
									<input type="text" name="attr_hit_location" title="Macro: @{NAME|hit_location}" />
								</div>
							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_melee_maneuvers_section" value="0" />
					<div class="melee-maneuvers section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="maneuvers-posture-title">Maneuvers and Posture</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">

								<h5>
									<span data-i18n="maneuver-title">Maneuver</span>
								</h5>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="step-attack" checked="checked" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="step-attack-label">Step/Attack: +0</span>
												<span class="tooltiptext">
													<span data-i18n="step-attack-tooltip">Melee Attack. Movement: Step. Active Defense: Any. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="step-feint" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="step-feint-label">Feint: +0</span>
												<span class="tooltiptext">
													<span data-i18n="step-feint-tooltip">Feint. Contest of melee weapon skills, defender is at -1 defense per point you win by. Lasts one second! Movement: Step. Active Defense: Any, but if you parry with unbalanced, you may not attack. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="move-attack" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="move-attack-label">Move/Attack: -4 *</span>
												<span class="tooltiptext">
													<span data-i18n="move-attack-tooltip">During or after your move, make a single, poorly aimed attack – either unarmed or with a ready weapon. Max skill of 9. Movement: normal, but -2 to avoid obstacles. Active Defense: Dodge or Block. See B365-366</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="move-wild-swing" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="move-wild-label">Move/Wild: -5 *</span>
												<span class="tooltiptext">
													<span data-i18n="move-wild-tooltip">Move and Wild Swing! During or after your move, make a single, wild swing/thrust – either unarmed or with a ready weapon.<br />Max skill of 9.<br />Melee attack to your side, back, or unseen target. If visibility penalty is higher, use that penalty instead, do not use this one. Roll hit location randomly! See B388-389<br />Movement: normal, but -2 to avoid obstacles<br />Active Defense: Dodge or Block<br />See B365-366</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="move-slam" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="move-slam-label">Move and Slam: +0</span>
												<span class="tooltiptext">
													<span data-i18n="move-slam-tooltip">End your move with a slam. If using shield, add your shield's Defense Bonus to your damage roll. Movement: normal, but -2 to avoid obstacles. Active Defense: Dodge or Block. B371-372</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="flying-tackle" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="flying-tackle-label">Flying Tackle: +4</span>
												<span class="tooltiptext">
													<span data-i18n="flying-tackle-tooltip">End your move with a flying tackle, get 1 yard of extra movement and you become prone. At least two legs and one free arm. Can use Jumping to hit target. Movement: normal, but -2 to avoid obstacles. Active Defense: Dodge or Block. See B371-372</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_maneuver" value="pounce" title="Macro: @{NAME|melee_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="pounce-label">Pounce: +4</span>
												<span class="tooltiptext">
													<span data-i18n="pounce-tooltip">As slam, get 1 yard of extra movement. Roll DX, Acrobatics, or Jumping to avoid falling prone. If a mount, rider must roll Riding-4 or fall off! Must have four or more legs. Movement: normal, but -2 to avoid obstacles. Active Defense: Dodge or Block. See B371-372</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item7">

								<h5>
									<span data-i18n="all-out-attack-title">All-Out Attack</span>
								</h5>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_all_out_attack" value="0" checked="checked" title="Macro: @{NAME|melee_all_out_attack}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="none-label">None</span>
												<span class="tooltiptext">
													<span data-i18n="no-all-out-attack-tooltip">No All-Out Attack, select this to clear all-out attack option.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_all_out_attack" value="determined" title="Macro: @{NAME|melee_all_out_attack}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-attack-determined-label">Determined: +4</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-attack-determined-tooltip">Determined: Make a single attack at +4 to hit! Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_all_out_attack" value="double" title="Macro: @{NAME|melee_all_out_attack}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-attack-double-label">Double: +0</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-attack-double-tooltip">Two attacks against a single foe! Two ready weapons or one weapon that doesn't need to be readied after an attack. Apply handedness for 2nd weapon. Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_all_out_attack" value="feint" title="Macro: @{NAME|melee_all_out_attack}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-attack-feint-label">Feint: +0</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-attack-feint-tooltip">Feint and attack a single foe! Contest of melee weapon skills, defender is at -1 defense per point you win by. Lasts one second! Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_melee_all_out_attack" value="strong" title="Macro: @{NAME|melee_all_out_attack}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-attack-strong-label">Strong: +0</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-attack-strong-tooltip">Single attack with +2 to damage or +1 damage per die for ST-based weapons! Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item8-9">

								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="deceptive-strike-label">Deceptive Strike</span>
											<span class="tooltiptext">
												<span data-i18n="deceptive-strike-tooltip">Deceptive strike, effective skill can't go below <b>10</b>! See B369-370.</span>
											</span>
										</div>
									</div>
									
									<div>
										<select name="attr_deceptive_strike" title="Macro: @{NAME|deceptive_strike}">
											<option value="0" selected="selected">None</option>
											<option value="-2">-2 hit, -1 defense</option>
											<option value="-4">-4 hit, -2 defense</option>
											<option value="-6">-6 hit, -3 defense</option>
											<option value="-8">-8 hit, -4 defense</option>
											<option value="-10">-10 hit, -5 defense</option>
											<option value="-12">-12 hit, -6 defense</option>
											<option value="-14">-14 hit, -7 defense</option>
											<option value="-16">-16 hit, -8 defense</option>
											<option value="-18">-18 hit, -9 defense</option>
											<option value="-20">-20 hit, -10 defense</option>
										</select>
									</div>
									
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_evaluate" title="Macro: @{NAME|evaluate}">
												<option value="0" selected="selected">0</option>
												<option value="1">+1</option>
												<option value="2">+2</option>
												<option value="3">+3</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="evaluate-label">Evaluate</span>
												<span class="tooltiptext">
													<span data-i18n="evaluate-tooltip">Evaluate a visible target that you can melee attack. Movement: Any. Defense: Any, doesn't spoil evaluate. See B364-365.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_wild_swing" value="1" title="Macro: @{NAME|wild_swing}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="wild-swing-label">Wild Swing: -5 *</span>
												<span class="tooltiptext">
													<span data-i18n="wild-swing-tooltip">Melee attack to your side, back, or unseen target. If visibility penalty is higher, use that penalty instead, do not use this one. Max skill of 9. Roll hit location randomly! See B388-389</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_rapid_strike" value="1" title="Macro: @{NAME|rapid_strike}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="rapid-strike-label">Rapid Strike: -6</span>
												<span class="tooltiptext">
													<span data-i18n="rapid-strike-tooltip">Make two attacks at -6 each, you <b>may</b> attack multiple opponents. You must have a ready weapon. If you have more than one attack, like all-out attack double, you can replace <b>one</b> of the attacks with rapid strike. See B370</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_flurry_of_blows" value="1" title="Macro: @{NAME|flurry_of_blows}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="flurry-of-blows-label">Flurry of Blows (1 FP/attack): -3</span>
												<span class="tooltiptext">
													<span data-i18n="flurry-of-blows-tooltip">Flurry of Blows for 1 FP per attack. Similar to Rapid Strike, you make two attacks at -3 each, you <b>may</b> attack multiple opponents. You must have a ready weapon. If you have more than one attack, like all-out attack double, you can replace <b>one</b> of the attacks with rapid strike. <b>Can't</b> be combined with <b>Mighty Blow</b>. See B357</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_rapid_strike_master" value="1" title="Macro: @{NAME|rapid_strike_master}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="rapid-strike-master-label">Rapid Strike <i>Master</i>: -3</span>
												<span class="tooltiptext">
													<span data-i18n="rapid-strike-master-tooltip">Trained by a Master or Weapon Master. Make two attacks at -3 each, you <b>may</b> attack multiple opponents. You must have a ready weapon. If you have more than one attack, like all-out attack double, you can replace <b>one</b> of the attacks with rapid strike. See B370 and B547</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_attack_from_above" value="1" title="Macro: @{NAME|attack_from_above}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="attack-from-above-label">Attack from above: -2</span>
												<span class="tooltiptext">
													<span data-i18n="attack-from-above-tooltip">Roll contest of Stealth vs Vision (-2 if not looking up). If you win, target is surprised and gets <b>No defense</b> and may <i>freeze</i>. If you lose, target is at -2 defense. If target is <i>aware</i> they could use <i>stop-thrust</i>. You suffer falling damage. <b>Optional</b> do falling damage to target. See B400</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_mighty_blow" value="1" title="Macro: @{NAME|might_blow}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="mighty-blow-label">Mighty Blow (1 FP)</span>
												<span class="tooltiptext">
													<span data-i18n="mighty-blow-tooltip">Mighty Blow does extra damage for 1 FP per attack. <b>Can't</b> be combined with <b>Flurry of Blows</b>. See B357.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

							</div>

							<div class="item item10">

								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="posture-label">Posture</span>
											<span class="tooltiptext">
												<span data-i18n="posture-tooltip">Your posture when attack was made. See B547.</span>
											</span>
										</div>
									</div>
									<div>
										<select name="attr_posture" title="Macro: @{NAME|posture}">
											<option value="0" selected="selected">Upright: +0</option>
											<option value="crawling">Crawling: -4</option>
											<option value="prone">Prone: -4</option>
											<option value="crouching">Crouching: -2</option>
											<option value="kneeling">Kneeling: -2</option>
											<option value="sitting">Sitting: -2</option>
										</select>
									</div>
								</div>

								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="height-difference-label">Height Difference</span>
											<span class="tooltiptext">
												<span data-i18n="height-difference-tooltip">If you and your foe are at different levels, the vertical distance affects combat. See B402</span>
											</span>
										</div>
									</div>
								
									<div>
										<select name="attr_melee_height_difference" title="Macro: @{NAME|melee_height_difference}">
											<option value="0" selected="selected">0-1 feet: +0</option>
											<option value="2-higher-legs-feet">Higher, 1-2 feet, Legs/feet: -2</option>
											<option value="2-higher-head-neck">Higher, 1-2 feet, Head/Neck: +2</option>
											<option value="3-higher-legs-feet">Higher, 2-3 feet, Legs/feet: -2</option>
											<option value="3-higher-head-neck">Higher, 2-3 feet, Head/Neck: +2</option>
											<option value="4-higher-legs-feet">Higher, 3-4 feet, Can't hit Legs/feet!: -20</option>
											<option value="4-higher-head-neck">Higher, 3-4 feet, Head/Neck: +2</option>
											<option value="5-higher-legs-feet">Higher, 4-5 feet, Can't hit Legs/feet!: -20</option>
											<option value="5-higher-head-neck">Higher, 4-5 feet, Head/Neck: +2</option>
											<option value="6-higher-legs-feet">Higher, 5-6 feet, Can't hit Legs/feet!: -20</option>
											<option value="6-higher-head-neck">Higher, 5-6 feet, Head/Neck: +2</option>
											<option value="2-lower-legs-feet">Lower, 1-2 feet, Legs/feet: +2</option>
											<option value="2-lower-head-neck">Lower, 1-2 feet, Head/Neck: -2</option>
											<option value="3-lower-legs-feet">Lower, 2-3 feet, Legs/feet: +2</option>
											<option value="3-lower-head-neck">Lower, 2-3 feet, Head/Neck: -2</option>
											<option value="4-lower-legs-feet">Lower, 3-4 feet, Legs/feet: +2</option>
											<option value="4-lower-head-neck">Lower, 3-4 feet, Head/Neck: -2</option>
											<option value="5-lower-legs-feet">Lower, 4-5 feet, Legs/feet: +2</option>
											<option value="5-lower-head-neck">Lower, 4-5 feet, Can't hit Head/Neck!: -20</option>
											<option value="6-lower-legs-feet">Lower, 5-6 feet, Legs/feet: +2</option>
											<option value="6-lower-head-neck">Lower, 5-6 feet, Can't hit Head/Neck!: -20</option>
										</select>
									</div>
									
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_improvised_weapon" title="Macro: @{NAME|improvised_weapon}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="improvised-weapon-label">Improvised Weapon</span>
												<span class="tooltiptext move-left">
													<span data-i18n="improvised-weapon-tooltip">Improvised weapon, See B404.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_tactics" title="Macro: @{NAME|tactics}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>-1</option>
												<option>-2</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="tactics-label">Tactics</span>
												<span class="tooltiptext move-left">
													<span data-i18n="tactics-tooltip"><b>NOTE!</b> from Dungeon Fantasy. A teammate spends turn to observe and advise you. If accepted, roll friends tactics. Success: +1 hit. Critical Success: +2. Fail: -1 hit. Critical Fail: -2 hit. See DF Exploits 57.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_unfriendly_hex" value="1" title="Macro: @{NAME|unfriendly_hex}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="unfriendly-hex-label">Unfriendly Hex: -4</span>
												<span class="tooltiptext move-left">
													<span data-i18n="unfriendly-hex-tooltip">Attacking through an unfriendly hex is -4. </span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_backstab" value="1" title="Macro: @{NAME|backstab}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="backstab-label">Backstab: +4</span>
												<span class="tooltiptext move-left">
													<span data-i18n="backstab-tooltip"><b>NOTE!</b> from Dungeon Fantasy. At start of combat, make Stealth roll. If successful, get backstab bonus. See DF Exploits 57-58</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

						</div>

						<div class="container">

							<!-- row 1 -->
							<div class="item item1">

								
								<h5>
									<span data-i18n="handedness-title">Handedness</span>		
								</h5>
								
								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="single-dual-weapon-label">Single/Dual Weapon</span>
											<span class="tooltiptext">
												<span data-i18n="single-dual-weapon-tooltip">Select your hand and if you're using a dual weapon attack. <b>NOTE:</b> Don't use off-hand of you have ambidexterity.</span>
											</span>
										</div>
									</div>
									<div>
										<select name="attr_weapon_hand" title="Macro: @{NAME|weapon_hand}">
											<option value="0" selected="selected">Primary hand: +0</option>
											<option value="off-hand">Off-hand: -4</option>
											<option value="dual-weapon-primary-hand">Dual-Weapon Primary Hand: -4</option>
											<option value="dual-weapon-off-hand">Dual-Weapon Off-hand: -8</option>
										</select>
									</div>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_off_hand_training" title="Macro: @{NAME|off_hand_training}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>+3</option>
												<option>+4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="off-hand-training-label">Off-Hand training</span>
												<span class="tooltiptext">
													<span data-i18n="off-hand-training-tooltip">Off-Hand weapon training. Negates the penalty for using an off-hand weapon. <b>NOTE:</b> A better approach is adding an off-hand attack to your combat table. See B232</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_dual_weapon_training" title="Macro: @{NAME|dual_weapon_training}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>+3</option>
												<option>+4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="dual-weapon-training-label">Dual-Weapon training</span>
												<span class="tooltiptext">
													<span data-i18n="dual-weapon-training-tooltip">Dual-Weapon training. Negates the penalty for using a dual-weapon. <b>NOTE:</b> A better approach is adding an dual-weapon attacks to your combat table. See B230</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item2">

								<h5>
									<span data-i18n="mounted-title">Mounted</span>		
								</h5>

								<div>
									<p>
										<span data-i18n="mounted-description">When mounted, use lower value of Weapon or Riding Skill. See B397</span>
									</p>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_mounted_skill_difference" title="Macro: @{NAME|mounted_skill_difference}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
												<option>-9</option>
												<option>-10</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="skill-difference-label">Skill Difference</span>
												<span class="tooltiptext">
													<span data-i18n="riding-skill-difference-tooltip">The difference between your riding skill and weapon skill.<br /><b>NOTE:</b> You could place an attack on the melee table and use riding skill instead of melee weapon skill.</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_mount_attacked" value="1" title="Macro: @{NAME|mount_attacked}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="mount-attacked-label">Mount attacked: -2</span>
												<span class="tooltiptext">
													<span data-i18n="mount-attacked-tooltip">If mount attacked on its last turn, you're at -2 to hit. See B397</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_mount_has_velocity" value="1" title="Macro: @{NAME|mount_has_velocity" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="mount-velocity-label">Mount Velocity 7+, +1 damage: -1</span>
												<span class="tooltiptext">
													<span data-i18n="mount-velocity-tooltip">If mount's relative velocity to target is 7, apply +1 damage, -1 to hit.<br /><b>NOTE:</b> Lances have special damage rules.<br />See B397</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_ranged_maneuvers_section" value="0" />
					<div class="ranged-maneuvers section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="maneuvers-posture-title">Maneuvers and Posture</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">

								<h5>
									<span data-i18n="maneuver-title">Maneuver</span>
								</h5>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_ranged_maneuver" value="step-attack" checked="checked" title="Macro: @{NAME|ranged_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="step-attack-label">Step/Attack: +0</span>
												<span class="tooltiptext">
													<span data-i18n="step-attack-tooltip">Melee Attack. Movement: Step. Active Defense: Any. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_ranged_maneuver" value="move-attack-ranged" title="Macro: @{NAME|ranged_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="ranged-move-attack-label">Move/Attack: -2 or Bulk</span>
												<span class="tooltiptext">
													<span data-i18n="ranged-move-attack-tooltip">Attack with a ranged weapon while moving, <b>aiming</b> is not possible and you lose previous aiming. -2 to hit or bulk penalty, whichever is worse. Movement: normal, but -2 to avoid obstacles. Active Defense: Dodge or Block. See B365-366</span>
												</span>
											</div>
										</div>
									</label>
									<div>
										<input type="number" name="attr_ranged_bulk" step="1" max="0" value="-2" title="Macro: @{NAME|ranged_bulk}" />
										<input type="hidden" name="attr_ranged_move_default_or_bulk" value="0" title="Macro: @{NAME|ranged_move_default_or_bulk}" />
										<span data-i18n="bulk-label">Bulk</span>
									</div>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_ranged_maneuver" value="all-out-determined" title="Macro: @{NAME|ranged_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="ranged-all-out-attack-determined-label">All-Out Attack Determined: +1</span>
												<span class="tooltiptext">
													<span data-i18n="ranged-all-out-attack-determined-tooltip">Determined: Make a single attack at +1 to hit! Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_ranged_maneuver" value="all-out-suppression" title="Macro: @{NAME|ranged_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="ranged-all-out-attack-suppression-fire-label">All-Out Attack Suppression Fire</span>
												<span class="tooltiptext">
													<span data-i18n="ranged-all-out-attack-suppression-fire-tooltip">Take entire turn to spray an area with automatic fire <b>RoF 5+</b>, see Suppression Fire B409! Movement: half-move, forward only. Defense: None. See B365</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item7">

								<h5>
									<span data-i18n="other-actions-title">Other Actions</span>
								</h5>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_ranged_braced" value="1" title="Macro: @{NAME|ranged_braced}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="braced-label">Braced: +1</span>
												<span class="tooltiptext">
													<span data-i18n="braced-tooltip">If you haven't moved and aimed a turn, you may get the braced bonus.<br />Firearm/crossbow must rest on a sandbag, low wall, car, etc.<br />One-handed firearm is braced if using two hands.<br />Two-handed is braced if you're prone and using a bipod. See B364.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_ranged_popup" value="1" title="Macro: @{NAME|ranged_popup}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="pop-up-label">Pop-up: -2</span>
												<span class="tooltiptext">
													<span data-i18n="pop-up-tooltip">Allows you to emerge from cover, move no more than one hex, make a ranged attack, and return cover.<br />Possible with thrown weapon, firearm, or crossbow.<br />You are susceptible to oppertunity fire, only dodge is allowed. See B390.</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_in_close_combat" title="Macro: @{NAME|ranged_in_close_combat}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
												<option>-9</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="in-close-combat-label">Close Combat</span>
												<span class="tooltiptext">
													<span data-i18n="in-close-combat-tooltip">If using ranged weapon in close combat, apply a penalty equal to the weapon's bulk rating. See B391</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_damaged_weapon" title="Macro: @{NAME|ranged_damaged_weapon}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="damaged-weapon-label">Damaged Weapon</span>
												<span class="tooltiptext">
													<span data-i18n="damaged-weapon-tooltip">-HP of damage done to weapon last turn. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_strength_difference" title="Macro: @{NAME|ranged_strength_difference}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
												<option>-9</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="strength-difference-label">Strength Difference</span>
												<span class="tooltiptext">
													<span data-i18n="strength-difference-tooltip">Strength is below that required for weapon, -1 per point of deficit. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="watch-area-label">Watch Area</span>
											<span class="tooltiptext move-left">
												<span data-i18n="watch-area-tooltip">Area or line being covered that is within your arc of vision.<br /><b>NOTE:</b> You only Aim and wait on a single hex!<br /> See B548</span>
											</span>
										</div>
									</div>
									<div>
										<select name="attr_ranged_opportunity_fire_watched" title="Macro: @{NAME|ranged_opportunity_fire_watched}">
											<option value="0" selected>0 or 1 hex: +0</option>
											<option value="-1">2 hexes: -1</option>
											<option value="-2">3-4 hexes or straight line: -2</option>
											<option value="-3">5-6 hexes: -3</option>
											<option value="-4">7-10 hexes: -4</option>
											<option value="-5">11+ hexes: -5</option>
										</select>
									</div>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_ranged_opportunity_fire_target" value="1" title="Macro: @{NAME|ranged_opportunity_fire_target}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="check-target-label">Check Target: -2</span>
												<span class="tooltiptext">
													<span data-i18n="check-target-tooltip">Opportunity Fire check target before shooting. See B390.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item10">
								
								<h5>
									<span data-i18n="handedness-title">Handedness</span>		
								</h5>
								
								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="single-dual-weapon-label">Single/Dual Weapon</span>
											<span class="tooltiptext">
												<span data-i18n="single-dual-weapon-tooltip">Select your hand and if you're using a dual weapon attack. <b>NOTE:</b> Don't use off-hand of you have ambidexterity.</span>
											</span>
										</div>
									</div>
									<div>
										<select name="attr_ranged_weapon_hand" title="Macro: @{NAME|ranged_weapon_hand}">
											<option value="0" selected="selected">Primary hand: +0</option>
											<option value="off-hand">Off-hand: -4</option>
											<option value="dual-weapon-primary-hand">Dual-Weapon Primary Hand: -4</option>
											<option value="dual-weapon-off-hand">Dual-Weapon Off-hand: -8</option>
										</select>
									</div>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_off_hand_training" title="Macro: @{NAME|ranged_off_hand_training}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>+3</option>
												<option>+4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="abbreviated-off-hand-training-label">Off-Hand train.</span>
												<span class="tooltiptext">
													<span data-i18n="off-hand-training-tooltip">Off-Hand weapon training. Negates the penalty for using an off-hand weapon. <b>NOTE:</b> A better approach is adding an off-hand attack to your combat table. See B232</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_dual_weapon_training" title="Macro: @{NAME|dual_weapon_training}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>+3</option>
												<option>+4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="dual-training-label">Dual training</span>
												<span class="tooltiptext">
													<span data-i18n="dual-weapon-training-tooltip">Dual-Weapon training. Negates the penalty for using a dual-weapon. <b>NOTE:</b> A better approach is adding an dual-weapon attacks to your combat table. See B230</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_tactics" title="Macro: @{NAME|ranged_tactics}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>-1</option>
												<option>-2</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="tactics-label">Tactics</span>
												<span class="tooltiptext move-left">
													<span data-i18n="tactics-tooltip"><b>NOTE!</b> from Dungeon Fantasy. A teammate spends turn to observe and advise you. If accepted, roll friends tactics. Success: +1 hit. Critical Success: +2. Fail: -1 hit. Critical Fail: -2 hit. See DF Exploits 57.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_ranged_backstab" value="1" title="Macro: @{NAME|ranged_backstab}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="backstab-label">Backstab: +4</span>
												<span class="tooltiptext move-left">
													<span data-i18n="backstab-tooltip"><b>NOTE!</b> from Dungeon Fantasy. At start of combat, make Stealth roll. If successful, get backstab bonus. See DF Exploits 57-58</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item8-9">

								<div class="block">
									<div>
										<div class="tooltip">
											<b><span data-i18n="moving-mount-vehicle-label">Moving Mount/Vehicle</span></b>
											<span class="tooltiptext move-left">
												<span data-i18n="moving-mount-vehicle-tooltip">Attacking from moving mount or vehicle.<br /><b>NOTE:</b>If <i>not</i> stabilized, the total of Accuracy, Aim, Bracing, and Targeting systems can't exceed vehicle's stability rating (SR). See B469 and B548</span>
											</span>
										</div>
									</div>
								</div>

								<div class="block">

									<label>
										<div>
											<input type="number" name="attr_vehicle_stability_rating" value="0" min="0" step="1" title="Macro: @{NAME|vehicle_stability_rating}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="abbreviation-stability-rating-label">SR</span>
												<span class="tooltiptext move-left">
													<span data-i18n="stability-rating-tooltip">Vehicle's stability rating. Affects Targeting systems.</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_vehicle_weapon_unstabilized" value="1" title="Macro: @{NAME|vehicle_weapon_unstabilized}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="unstabilized-label">Unstabilized</span>
												<span class="tooltiptext move-left">
													<span data-i18n="unstabilized-tooltip">The vehicle's weapon is not stabilized. The max bonus from Targeting Systems can't exceed Stability Rating of the vehicle. See B469</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="conditions-label">Conditions</span>
											<span class="tooltiptext move-left">
												<span data-i18n="vehicle-conditions-tooltip">What conditions is the vehicle experiencing. See B548.</span>
											</span>
										</div>
									</div>
									<div>
										<select name="attr_ranged_vehicle_conditions" title="Macro: @{NAME|ranged_vehicle_conditions}">
											<option value="0" selected="selected">Select</option>
											<option value="air-handheld">-1 : Air vehicle. Using handheld weapon.</option>
											<option value="ground-good-road-handheld">-1 : Ground vehicle, good road. Using handheld weapon.</option>
											<option value="ground-bad-road-fixed">-1 : Ground vehicle, bad road. Weapon in fixed mount/hardpoint/carriage.</option>
											<option value="ground-bad-road-external">-2 : Ground vehicle, bad road. Weapon in external open mount.</option>
											<option value="ground-bad-road-handheld">-3 : Ground vehicle, bad road. Using handheld weapon.</option>
											<option value="ground-off-road-stabilized-turret">-1 : Ground vehicle, off-road. Weapon in stabalized turret/open mount.</option>
											<option value="ground-off-road-fixed">-2 : Ground vehicle, off-road. Weapon in fixed mount/hardpoint/carriage.</option>
											<option value="ground-off-road-external">-3 : Ground vehicle, off-road. Weapon in external open mount.</option>
											<option value="ground-off-road-handheld">-4 : Ground vehicle, off-road. Using handheld weapon.</option>
											<option value="water-calm-fixed">-1 : Water vehicle, calm. Weapon in fixed mount/hardpoint/carriage.</option>
											<option value="water-calm-external">-2 : Water vehicle, calm. Weapon in external mount.</option>
											<option value="water-calm-handheld">-3 : Water vehicle, calm. Using handheld weapon.</option>
											<option value="water-rough-stabilized-turret">-1 : Water vehicle, rough. Weapon in stabilized turret/open mount.</option>
											<option value="water-rough-fixed">-2 : Water vehicle, rough. Weapon in fixed mount/hardpoint/carriage.</option>
											<option value="water-rough-external">-3 : Water vehicle, rough. Weapon in external mount.</option>
											<option value="water-rough-handheld">-4 : Water vehicle, rough. Using handheld weapon.</option>
										</select>
									</div>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_ranged_controll_roll" title="Macro: @{NAME|ranged_ranged_controll_roll}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
												<option>-9</option>
												<option>-10</option>
												<option>-11</option>
												<option>-12</option>
												<option>-13</option>
												<option>-14</option>
												<option>-15</option>
												<option>-16</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="failed-control-roll-label">Failed Control Roll</span>
												<span class="tooltiptext move-left">
													<span data-i18n="failed-control-roll-tooltip">Vehicle/mount failed control last turn. Penalty equal to margin of failure. See B548</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_ranged_over_under_mount" value="1" title="Macro: @{NAME|ranged_over_under_mount}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="over-under-mount-label">Over/Under Mount: -6</span>
												<span class="tooltiptext move-left">
													<span data-i18n="over-under-mount-tooltip">If you're an exposed rider hanging from side of mount/vehicle, penalty to hit is -6 to shoot over or under the mount.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_ranged_vehicle_dodge" value="1" title="Macro: @{NAME|ranged_vehicle_dodge}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="vehicle-dodged-label">Vehicle Dodged Last Turn: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="vehicle-dodged-tooltip">Vehicle/mount dodged last turn and you're <b>not</b> the operator.</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_ranged_air_vehicle_dodge" value="1" title="Macro: @{NAME|ranged_air_vehicle_dodge}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="air-vehicle-dodged-label">Air Vehicle Dodged Last Turn: -4</span>
												<span class="tooltiptext move-left">
													<span data-i18n="vehicle-dodged-tooltip">Vehicle/mount dodged last turn and you're <b>not</b> the operator.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_defense_maneuvers_section" value="0" />
					<div class="defense-maneuvers section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="maneuvers-posture-title">Maneuvers and Posture</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">

								<div class="block">
									<h5>
										<span data-i18n="maneuver-title">Maneuver</span>
									</h5>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_defense_maneuver" value="step-attack" checked="checked" title="Macro: @{NAME|defense_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="normal-defense-label">Normal Defense</span>
												<span class="tooltiptext">
													<span data-i18n="normal-defense-tooltip">Using a normal active defense.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_defense_maneuver" value="all-out-defense-increased" title="Macro: @{NAME|defense_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-defense-increased-label">All-Out Defense: +2</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-defense-increased-tooltip">On your turn, you chose to do an all-out defense. Get +2 <b>one</b> active defense.</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_defense_maneuver" value="all-out-defense-double" title="Macro: @{NAME|defense_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="all-out-defense-double-label">All-Out Defense: Double</span>
												<span class="tooltiptext">
													<span data-i18n="all-out-defense-double-tooltip">Apply <b>two</b> different active defenses against the same attack. If you fail your defense, you may try a second, different defense against that attack. See B366</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="radio" name="attr_defense_maneuver" value="moved-attack" title="Macro: @{NAME|defense_maneuver}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="moved-attacked-label">Moved and Attacked</span>
												<span class="tooltiptext">
													<span data-i18n="moved-attacked-tooltip">If you moved and attacked on your last turn, you can only dodge or block, parry is not allowed. See B366</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<h5>
										<span data-i18n="defenders-posture-title">Defender's Posture</span>
									</h5>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_crawling" value="1" title="Macro: @{NAME|defense_crawling}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="defense-crawling-label">Crawling/Lying: -3</span>
												<span class="tooltiptext">
													<span data-i18n="defense-crawling-tooltip">If you're crawling or lying down, -3 to defense. See B549</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_kneeling" value="1" title="Macro: @{NAME|defense_kneeling}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="defense-kneeling-label">Kneeling/Sitting: -2</span>
												<span class="tooltiptext">
													<span data-i18n="defense-kneeling-tooltip">If you're kneeling or sitting, -2 to defense. See B549</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<h5>
										<span data-i18n="attackers-action-title">Attacker's Action</span>
									</h5>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_from_side" value="1" title="Macro: @{NAME|defense_from_side}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="attack-from-side-label">Attack From Side: -2</span>
												<span class="tooltiptext">
													<span data-i18n="attack-from-side-tooltip">Attacks from your side hex defend at -2, unless you have <i>Peripheral Vision</i> or <i>360° Vision</i>. If you have a shield, you can't block amn that comes from your weapon side. One-handed melee can't parry an attack from the opposite side. B390.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_from_behind" value="1" title="Macro: @{NAME|defense_from_behind}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="attack-from-behind-label">Attack From Behind <i>Peripheral</i>: -2</span>
												<span class="tooltiptext">
													<span data-i18n="attack-from-behind-tooltip">Normally, if attacked from behind, you have no defense. However, if you have Peripheral Vision you can defend at -2. See B391</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_runaround" value="1" title="Macro: @{NAME|defense_runaround}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="runaround-attack-label">Runaround Attack: -2</span>
												<span class="tooltiptext">
													<span data-i18n="runaround-attack-tooltip">Your foe starts in front of you and runs behind you and attacks from behind. You can defend at -2. See B391</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<h5>
										<span data-i18n="defense-bonus-label">Defense Bonus</span>
									</h5>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_shield_db" title="Macro: @{NAME|shield_db}">
												<option>0</option>
												<option>1</option>
												<option>2</option>
												<option>3</option>
												<option>4</option>
												<option>5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="shield-abbreviate-defense-bonus-label">Shield DB</span>
												<span class="tooltiptext">
													<span data-i18n="shield-defense-bonus-tooltip">Apply defense bonus for a shield if attack came the front or from your shield side. See B374.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_magic_db" title="Macro: @{NAME|magic_db}">
												<option>0</option>
												<option>1</option>
												<option>2</option>
												<option>3</option>
												<option>4</option>
												<option>5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="magic-abbreviate-defense-bonus-label">Magic DB</span>
												<span class="tooltiptext">
													<span data-i18n="magic-defense-bonus-tooltip">Magical Defense Bonus, such as the Shield spell, which protects from <i>frontal</i> attacks. See B252.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_general_db" title="Macro: @{NAME|general_db}">
												<option>0</option>
												<option>1</option>
												<option>2</option>
												<option>3</option>
												<option>4</option>
												<option>5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="general-abbreviate-defense-bonus-label">General DB</span>
												<span class="tooltiptext">
													<span data-i18n="general-defense-bonus-tooltip">A general defense bonus, such as the Supers Meta-trait (see Supers B34), force field, etc.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item7">

								<div class="block">
									<h5>
										<span data-i18n="other-actions-title">Other Actions</span>
									</h5>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_retreat_dodge" value="1" title="Macro: @{NAME|defense_retreat_dodge}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="retreating-dodge-label">Retreating Dodge: +3</span>
												<span class="tooltiptext">
													<span data-i18n="retreating-dodge-tooltip">Move away from attacker, at least one yard or up to your <b>step</b>. See B377</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_retreat_parry" value="1" title="Macro: @{NAME|defense_retreat_parry}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="retreating-block-parry-label">Retreating Block/Parry: +1</span>
												<span class="tooltiptext">
													<span data-i18n="retreating-block-parry-tooltip">Retreating block or parry. Move away from attacker, at least one yard or up to your <b>step</b>. See B377</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_retreat_parry_fence" value="1" title="Macro: @{NAME|defense_retreat_parry_fence}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="retreating-parry-label">Retreating Parry: +3</span>
												<span class="tooltiptext">
													<span data-i18n="retreating-parry-tooltip">If using Boxing, Judo, Karate, or any fencing skill, you can get a +3 retreating bonus.<br />Move away from attacker, at least one yard or up to your <b>step</b>. See B377</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_retreating_flight" value="1" title="Macro: @{NAME|defense_retreating_flight}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="retreating-flight-label">Retreating Flight</span><span>: +1</span>
												<span class="tooltiptext">
													<span data-i18n="retreating-flight-tooltip">If flyer can <b>hover</b>, add +1 to defense to retreating defense <i>if</i> you can move 1 hex up or down. See B398</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_acrobatic_dodge_success" value="1" title="Macro: @{NAME|defense_acrobatic_dodge_success}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="acrobatic-dodge-label">Acrobatic Dodge</span><span>: +2</span>
												<span class="tooltiptext">
													<span data-i18n="acrobatic-dodge-success-tooltip">If you made a successful acrobatic/aerobatic roll, get +2 to dodge. See B375</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_acrobatic_dodge_failed" value="1" title="Macro: @{NAME|defense_acrobatic_dodge_failed}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="acrobatic-dodge-label">Acrobatic Dodge</span><span>: -2</span>
												<span class="tooltiptext">
													<span data-i18n="acrobatic-dodge-failed-tooltip">If you failed your acrobatic/aerobatic roll, you're at -2 to dodge. See B375</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_dodge_drop" value="1" title="Macro: @{NAME|defense_dodge_drop}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="dodge-drop-label">Dodge & Drop: +3</span>
												<span class="tooltiptext">
													<span data-i18n="dodge-drop-tooltip">Only against <b>ranged attacks</b>, drop to the ground and become prone.<br />Any cover you get does <i>not</i> count against the initial attack.<br /><b>NOTE:</b> Flying or Swimming is possible but only if a step would take you below concealing terrain. See B377</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_feverish" value="1" title="Macro: @{NAME|defense_feverish}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="feverish-defense-label">Feverish Defense (1 FP): +2</span>
												<span class="tooltiptext">
													<span data-i18n="feverish-defense-tooltip">Spend <b>1 FP</b> to increase active defense by 2.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_offhand_parry" value="1" title="Macro: @{NAME|defense_offhand_parry}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="offhand-parry-label">Off-Hand Parry: -2</span>
												<span class="tooltiptext">
													<span data-i18n="offhand-parry-tooltip">Off-Hand weapon parry is at -2. See B549</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_parries" title="Macro: @{NAME|defense_parries}">
												<option value="0">1</option>
												<option value="-4">2</option>
												<option value="-8">3</option>
												<option value="-12">4</option>
												<option value="-16">5</option>
												<option value="-20">6</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="number-of-parries-label"># of Parries</span>
												<span class="tooltiptext">
													<span data-i18n="number-of-parries-tooltip">You can more parry more than once per turn, but each additional parry is at a -4 penalty. See B376</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_parries_master" title="Macro: @{NAME|defense_parries_master}">
												<option value="0">1</option>
												<option value="-2">2</option>
												<option value="-4">3</option>
												<option value="-6">4</option>
												<option value="-8">5</option>
												<option value="-10">6</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="number-of-parries-master-label"># of Parries <i>Master</i></span>
												<span class="tooltiptext">
													<span data-i18n="number-of-parries-master-tooltip">If you're <b>Trained by a Master</b> or a <b>Weapon Master</b>, penalties are halved. See B376</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_improvised_weapon" title="Macro: @{NAME|defense_improvised_weapon}">
												<option>0</option>
												<option>-1</option>
												<option>-2</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="defense-improvised-abbreviate-weapon-label">Improvised Wpn</span>
												<span class="tooltiptext">
													<span data-i18n="defense-improvised-weapon-tooltip"><b>NOTE:</b> <i>Dungeon Fantasy:</i> if parrying with an improvised weapon, apply a penalty. See DF Exploits-37</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item10">
								
								<div class="block">
									<h5>
										<span data-i18n="situation-title">Situation</span>		
									</h5>
								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_laser_sight" value="1" title="Macro: @{NAME|defense_laser_sight}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="laser-sight-label">Laser Sight: +1</span>
												<span class="tooltiptext move-left">
													<span data-i18n="defense-laser-sight-tooltip">If you can see the laser sight, you get +1 to <b>Dodge</b>. See B548</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<select name="attr_defense_deceptive_attack" title="Macro: @{NAME|defense_deceptive_attack}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="against-deceptive-attack-label">Against Deceptive Attack</span>
												<span class="tooltiptext move-left">
													<span data-i18n="against-deceptive-attack-tooltip">You're at -1 to defense for every -2 the attacker took to their to hit modifier. See B369</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<select name="attr_defense_feint" title="Macro: @{NAME|defense_feint}">
												<option selected>0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
												<option>-7</option>
												<option>-8</option>
												<option>-9</option>
												<option>-10</option>
												<option>-11</option>
												<option>-12</option>
												<option>-13</option>
												<option>-14</option>
												<option>-15</option>
												<option>-16</option>
												<option>-17</option>
												<option>-18</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="feint-attack-label">Feint Attack</span>
												<span class="tooltiptext move-left">
													<span data-i18n="feint-attack-tooltip">You're at a penalty equal to the attacker's margin of victory. See B365</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">
									<div>
										<div class="tooltip">
											<span data-i18n="height-difference-label">Height Difference</span>
											<span class="tooltiptext">
												<span data-i18n="height-difference-tooltip">If you and your foe are at different levels, the vertical distance affects combat. See B402</span>
											</span>
										</div>
									</div>
								
									<div>
										<select name="attr_defense_height_difference" title="Macro: @{NAME|defense_height_difference}">
											<option value="0" selected="selected">0-2 feet: +0</option>
											<option value="2-3-higher">Above, 2-3 feet: +1</option>
											<option value="3-4-higher">Above, 3-4 feet: +2</option>
											<option value="4-6-higher">Above, 4-6 feet: +3</option>
											<option value="2-3-below">Below, 2-3 feet: -1</option>
											<option value="3-4-below">Below, 3-4 feet: -2</option>
											<option value="4-6-below">Below, 4-6 feet: -3</option>
										</select>
									</div>
									
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_mounted" title="Macro: @{NAME|defense_mounted}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="mounted-label">Mounted</span>
												<span class="tooltiptext">
													<span data-i18n="defense-mounted-tooltip">If mounted, defensive penalty is equal to difference between 12 and Riding skill. See B388</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<select name="attr_defense_tactics" title="Macro: @{NAME|defense_tactics}">
												<option value="0" selected="selected">0</option>
												<option>+1</option>
												<option>+2</option>
												<option>-1</option>
												<option>-2</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="tactics-label">Tactics</span>
												<span class="tooltiptext">
													<span data-i18n="tactics-tooltip"><b>NOTE!</b> from Dungeon Fantasy. A teammate spends turn to observe and advise you. If accepted, roll friends tactics. Success: +1 hit. Critical Success: +2. Fail: -1 hit. Critical Fail: -2 hit. See DF Exploits 57.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_hidden_weapon" value="1" title="Macro: @{NAME|defense_hidden_weapon}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="hidden-weapon-label">Hidden Weapon: -2</span>
												<span class="tooltiptext">
													<span data-i18n="defense-hidden-weapon-tooltip"><b>NOTE:</b> From <i>Dungeon Fantasy</i>. If attacked by a hidden weapon, you're at -2 to your first defense. See DF Exploits-58</span>
												</span>
											</div>
										</div>
									</label>

								</div>

							</div>

							<div class="item item8-9">

								<div class="block">
									<h5>
										<span data-i18n="defenders-equipment-label">Defender's Equipment</span>
									</h5>
								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_parry_knife" value="1" title="Macro: @{NAME|defense_parry_knife}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parrying-knife-label">Parrying with Knife/Dagger: -1</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parrying-knife-tooltip">If parrying with a knife or dagger is -1. See B548<br /><b>Suggestion:</b> Add the modifier to your defense skill instead of using checkbox.</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_parry_kusari" value="1" title="Macro: @{NAME|defense_parry_kusari}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parrying-kusari-label">Parrying with Kusari/Whip: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parrying-kusari-tooltip">If parrying with a kusari or whip is -2. See B548<br /><b>Suggestion:</b> Add the modifier to your defense skill instead of using checkbox.</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_unarmed_parry" value="1" title="Macro: @{NAME|defense_unarmed_parry}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="unarmed-parry-label">Unarmed Parry: -3</span>
												<span class="tooltiptext move-left">
													<span data-i18n="unarmed-parry-tooltip">Unarmed parry vesus a weapon is -3, unless it's a thrust or you are using Judo or Karate parry. See B548</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">
									<h5>
										<span data-i18n="attackers-equipment-label">Attacker's Equipment</span>
									</h5>
								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_dual_weapon" value="1" title="Macro: @{NAME|defense_dual_weapon}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="against-dual-weapon-label">Against Dual-Weapon: -1</span>
												<span class="tooltiptext move-left">
													<span data-i18n="against-dual-weapon-tooltip">If both attacks hit you, you're at -1 to defend. See B548.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_parry_flail" value="1" title="Macro: @{NAME|defense_parry_flail}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parry-flail-label">Parry against Flail: -4</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parry-flail-tooltip">If parrying against a flail, you're at -4 to defend. See B405.<br /><b>NOTE:</b> You can't parry flails with a <i>fencing</i> weapon.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_parry_nunchaku" value="1" title="Macro: @{NAME|defense_parry_nunchaku}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parry-nunchaku-label">Parry against Nunchaku: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parry-nunchaku-tooltip">If parrying against a nunchaku, you're at -2 to defend. See B405.<br /><b>NOTE:</b> You can't parry nunchaku with a <i>fencing</i> weapon.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_block_flail" value="1" title="Macro: @{NAME|defense_block_flail}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="block-flail-label">Block against Flail: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="block-flail-tooltip">If blocking against a flail, you're at -2 to defend. See B405.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_block_nunchaku" value="1" title="Macro: @{NAME|defense_block_nunchaku}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="block-nunchaku-label">Block against Nunchaku: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="block-nunchaku-tooltip">If blocking against a nunchaku, you're at -1 to defend. See B405.</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_thrown_weapon" value="1" title="Macro: @{NAME|defense_thrown_weapon}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parry-thrown-weapon-label">Parry thrown weapon: -1</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parry-thrown-weapon-tooltip">Parry -1 against thrown weapon. See B549</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_thrown_small_weapon" value="1" title="Macro: @{NAME|defense_thrown_small_weapon}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="parry-thrown-small-weapon-label">Parry thrown small weapon: -2</span>
												<span class="tooltiptext move-left">
													<span data-i18n="parry-thrown-small-weapon-tooltip">If the weapon is 1 pound or less, parry is -2. See B549</span>
												</span>
											</div>
										</div>
									</label>

								</div>

								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_trident_dodge" value="1" title="Macro: @{NAME|defense_trident_dodge}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="trident-dodge-label">Trident: -1 Dodge</span>
												<span class="tooltiptext move-left">
													<span data-i18n="trident-dodge-tooltip"><b>NOTE:</b> From <i>Dungeon Fantasy</i>. -1 to dodge a trident. See DF Exploits-97</span>
												</span>
											</div>
										</div>
									</label>

								</div>
								
								<div class="block">

									<label>
										<div>
											<input type="checkbox" name="attr_defense_trident_block" value="1" title="Macro: @{NAME|defense_trident_block}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="trident-block-label">Trident: +1 Block</span>
												<span class="tooltiptext move-left">
													<span data-i18n="trident-block-tooltip"><b>NOTE:</b> From <i>Dungeon Fantasy</i>. +1 to <b>block</b> or <b>parry</b> a trident. See DF Exploits-97</span>
												</span>
											</div>
										</div>
									</label>

								</div>

							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_spell_modifiers_section" value="0" />
					<div class="spell-modifiers section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="spell-modifiers-title">Spell Modifiers</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_spells_low_mana" value="1" title="Macro: @{NAME|spells_low_mana}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="low-mana-label">Low Mana: -5</span>
												<span class="tooltiptext">
													<span data-i18n="low-mana-tooltip">Only <i>mages</i> can cast spells and all spells are at -5. Critical failures have mild effects or no effect at all. See B235.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item7">

								<div class="block">
									<label>
										<div>
											<input type="number" value="0" max="0" step="1" name="attr_spell_burn_hit_points" title="Macro: @{NAME|spell_burn_hit_points}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="burn-abbreviate-hit-points-label">Burn HP</span>
												<span class="tooltiptext">
													<span data-i18n="burn-hit-points-tooltip">Burn Hit Points instead of FP, but you're -1 to skill per HP. <b>High Pain Threshold</b> has no effect. See B237.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="number" value="0" min="0" step="1" name="attr_spell_ceremonial_bonus" title="Macro: @{NAME|spell_ceremonial_bonus}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="ceremonial-bonus-label">Ceremonial Bonus</span>
												<span class="tooltiptext">
													<span data-i18n="ceremonial-bonus-tooltip">Ceremonial Magic involves a group of <i>willing</i> assistants. Receive a skill bonus based on how much extra energy you receive.<ul><li>20% : +1 skill</li><li>40% : +2 skill</li><li>60% : +3 skill</li><li>100% : +4 skill</li></ul>Add another +1 per additional 100% of required energy.<br />See B238.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item8">
								
								<div class="block">
									<label>
										<div>
											<input type="number" value="0" max="0" step="1" name="attr_regular_spell_modifier" title="Macro: @{NAME|regular_spell_modifier}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="spell-range-label">Spell Range</span>
												<span class="tooltiptext move-left">
													<span data-i18n="regular-spell-range-tooltip">For regular and area spells apply a penalty of -1 per yard of distance. See B239.</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_regular_spell_cant_see_touch" value="1" title="Macro: @{NAME|regular_spell_cant_see_touch}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="cant-see-touch-label">Can't See/Touch: -5</span>
												<span class="tooltiptext move-left">
													<span data-i18n="spell-cant-see-touch-tooltip">For regular spells, if you can't see or touch your subject, you're at -5 to skill. See B239.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									
									<div>
										<div class="tooltip">
											<span data-i18n="long-distance-label">Long-Distance</span>
											<span class="tooltiptext">
												<span data-i18n="long-distance-tooltip">Use these modifiers for <i>Information</i> spells that work over long distances, such as <b>Seek</b> spells. Certain advantages use these ranges. If the distance falls between two values, use the <i>higher</i> value. See B241.</span>
											</span>
										</div>
									</div>
								
									<div>
										<select name="attr_spell_long_distance" title="Macro: @{NAME|spell_long_distance}">
											<option value="0" selected="selected">UP to 200 yards : 0</option>
											<option value="-1">1/2 mile : -1</option>
											<option value="-2">1 mile : -2</option>
											<option value="-3">3 miles : -3</option>
											<option value="-4">10 miles : -4</option>
											<option value="-5">30 miles : -5</option>
											<option value="-6">100 miles : -6</option>
											<option value="-7">300 miles : -7</option>
											<option value="-8">1,000 miles : -8</option>
											<option value="-9">10,000 miles : -9</option>
										</select>
									</div>
									
								</div>

							</div>

							<div class="item item9">

								<div class="block">
	
									<div>
										<div class="tooltip">
											<span data-i18n="natures-strength-title">Nature's Strength</span>
											<span class="tooltiptext">
												<span data-i18n="natures-strength-description"><b>NOTE:</b> From Dungeon Fantasy. Modifiers to <b>druidic</b> spells. See  2.</span>
											</span>
										</div>
									</div>
								
									<div>
										<select name="attr_spell_natures_strength" title="Macro: @{NAME|spell_natures_strength}">
											<option value="0" selected>Select</option>
											<option value="wilderness-1">Primeval Wilderness : +1</option>
											<option value="wilderness-2">Primeval Wilderness : +2</option>
											<option value="wilderness-3">Primeval Wilderness : +3</option>
											<option value="wilderness-4">Primeval Wilderness : +4</option>
											<option value="wilderness-5">Primeval Wilderness : +5</option>
											<option value="not-pristine-wilderness-1">Not Pristine Wilderness : -1</option>
											<option value="structures-2">Artificial Structures : -2</option>
											<option value="structures-3">Artificial Structures : -3</option>
											<option value="structures-4">Artificial Structures : -4</option>
											<option value="defiled-5">Nature Defiled : -5</option>
											<option value="defiled-6">Nature Defiled : -6</option>
											<option value="defiled-7">Nature Defiled : -7</option>
											<option value="defiled-8">Nature Defiled : -8</option>
											<option value="defiled-9">Nature Defiled : -9</option>
											<option value="supernatural-defiled-10">Supernaturally Defiled : -10</option>
										</select>
									</div>
	
								</div>
	
							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_defense_maneuvers_section" value="0" />
					<div class="defense-maneuvers section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="afflictions-conditions-title">Afflictions & Conditions</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item2">

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_stunned" value="1" title="Macro: @{NAME|defense_stunned}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="stunned-label">Stunned: -4</span>
												<span class="tooltiptext">
													<span data-i18n="stunned-tooltip">If you're stunned, defend at -4. See B420</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_nauseated" value="1" title="Macro: @{NAME|defense_nauseated}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="defense-nauseated-label">Nauseated: -1</span>
												<span class="tooltiptext">
													<span data-i18n="defense-nauseated-tooltip">If nauseated, you're at -1 to defend. See B428</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_encumbered" title="Macro: @{NAME|defense_encumbered}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="encumbered-label">Encumbered</span>
												<span class="tooltiptext">
													<span data-i18n="encumbered-tooltip">Penalty equal to your encumbrance is applied to Dodge, Judo, Karate, or any fencing Parry. See B549</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item3">

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_cant_see_attacker" value="1" title="Macro: @{NAME|defense_cant_see_attacker}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="cant-see-attacker-label">Can't See Attacker: -4</span>
												<span class="tooltiptext">
													<span data-i18n="cant-see-attacker-tooltip">If you can't see the target you're at -4. A <b>block</b> or <b>parry</b> requires Hearing-2. See B549</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item4">

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_bad_footing" title="Macro: @{NAME|defense_bad_footing}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="bad-footing-label">Bad Footing</span>
												<span class="tooltiptext">
													<span data-i18n="defense-bad-footing-tooltip">Defensive penalty for bad footing. See B547-B549.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_defense_distraction" title="Macro: @{NAME|defense_distraction}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="distraction-label">Distraction</span>
												<span class="tooltiptext">
													<span data-i18n="distraction-tooltip">-1 for Bees in your face, -2 for part clothes on fire, -3 all clothes on fire, etc. See B548.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item5">
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_grappled_dodge" value="1" title="Macro: @{NAME|defense_grappled_dodge}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="grappled-dodge-label">Grappled: -1 Dodge</span>
												<span class="tooltiptext move-left">
													<span data-i18n="grappled-dodge-tooltip"><b>NOTE!</b> from Dungeon Fantasy. If grappled, you're at -1 to dodge. See DF Exploits 41</span>
												</span>
											</div>
										</div>
									</label>
								</div>
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_defense_grappled_block" value="1" title="Macro: @{NAME|defense_grappled_block}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="grappled-block-label">Grappled: -2 Block/Parry</span>
												<span class="tooltiptext move-left">
													<span data-i18n="grappled-block-tooltip"><b>NOTE!</b> from Dungeon Fantasy. If grappled, you're at -2 to block/parry. A grappled limb can't use block/parry. See DF Exploits 41</span>
												</span>
											</div>
										</div>
									</label>
								</div>
							</div>

						</div>
						
					</div>

					<input type="hidden" name="attr_display_visibility_section" value="0" />
					<div class="visiblity section">

						<div class="container">

							<!-- Row 1 -->
							<div class="item item1">
								<h4>Visibility</h4>
							</div>

							<div class="item item2">
								<label>
									<div>
										<input type="number" name="attr_visibility_modifier" value="0" readonly="readonly" title="Macro: @{NAME|visibility_modifier}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="roll-modifier-label">Roll modifier</span>
											<span class="tooltiptext">
												<span data-i18n="visibility-roll-modifier-tooltip">Combined total can't exceed -10 or -6 if used to blindness.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

						</div>

						<div class="container">

							<!-- Row 1 -->
							<div class="item item1">
								<label>
									<div>
										<input type="radio" checked="checked" name="attr_visiblity_condition" value="0" title="Macro: @{NAME|visiblity_condition}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="no-visiblity-condition-label">No special effect</span>
											<span class="tooltiptext">
												<span data-i18n="no-visiblity-condition-tooltip">Only affected by darkness, smoke, fog, blur, or other.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item2">
								<label>
									<div>
										<input type="radio" name="attr_visiblity_condition" value="1" title="Macro: @{NAME|attr_visiblity_condition}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="cannot-see-anything-label">Can't see anything: -10 or -6 *</span>
											<span class="tooltiptext">
												<span data-i18n="cannot-see-anything-tooltip">If used to blindess, penalty is -6 and Max Skill is 9. See B124 and B394.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item3">
								<label>
									<div>
										<input type="radio" name="attr_visiblity_condition" value="2" title="Macro: @{NAME|attr_visiblity_condition}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="cannot-see-target-label">Cannot see target: -6 *</span>
											<span class="tooltiptext">
												<span data-i18n="cannot-see-target-tooltip">Max Skill is 9. B394.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item4">
								<label>
									<div>
										<input type="radio" name="attr_visiblity_condition" value="3" title="Macro: @{NAME|attr_visiblity_condition}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="know-location-label">Know location in 1 yard: -4 *</span>
											<span class="tooltiptext move-left">
												<span data-i18n="know-location-tooltip">If the foe is in a single smoke-filled hex or the like, no Hearing roll is required and the attack penalty is only -4. Roll for random hit location. Max Skill is 9. B394.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

						</div>

						<div class="container">

							<!-- row 1 -->
							<div class="item item1">
								<label>
									<div>
										<select name="attr_darkness_penalty" class="number-only-width" title="Macro: @{NAME|darkness_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
											<option>-5</option>
											<option>-6</option>
											<option>-7</option>
											<option>-8</option>
											<option>-9</option>
										</select>
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="darkness-label">Darkness</span>
											<span class="tooltiptext">
												<span data-i18n="darkness-tooltip">-10 is considered total darkness, no light available. See B394.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item2">
								<label>
									<div>
										<select name="attr_smoke_penalty" class="number-only-width" title="Macro: @{NAME|smoke_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
											<option>-5</option>
											<option>-6</option>
											<option>-7</option>
											<option>-8</option>
											<option>-9</option>
											<option>-10</option>
										</select>
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="smoke-label">Smoke</span>
											<span class="tooltiptext">
												<span data-i18n="obscure-vision-tooltip">-10 totally obscures vision. See Obscure B72.</span>
											</span>
										</div>
									</div>
								</label>
							</div>
							
							<div class="item item3">
								<label>
									<div>
										<select name="attr_fog_penalty" class="number-only-width" title="Macro: @{NAME|fog_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
											<option>-5</option>
											<option>-6</option>
											<option>-7</option>
											<option>-8</option>
											<option>-9</option>
											<option>-10</option>
										</select>
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="fog-label">Fog</span>
											<span class="tooltiptext">
												<span data-i18n="obscure-vision-tooltip">-10 totally obscures vision. See Obscure B72.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item4">
								<label>
									<div>
										<select name="attr_blur_penalty" class="number-only-width" title="Macro: @{NAME|blur_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
											<option>-5</option>
											<option>-6</option>
											<option>-7</option>
											<option>-8</option>
											<option>-9</option>
											<option>-10</option>
										</select>
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="blur-label">Blur</span>
											<span class="tooltiptext">
												<span data-i18n="obscure-vision-tooltip">-10 totally obscures vision. See Obscure B72.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item5">
								<label>
									<div>
										<select name="attr_other_vision_penalty" class="number-only-width" title="Macro: @{NAME|other_vision_penalty}">
											<option>0</option>
											<option>-1</option>
											<option>-2</option>
											<option>-3</option>
											<option>-4</option>
											<option>-5</option>
											<option>-6</option>
											<option>-7</option>
											<option>-8</option>
											<option>-9</option>
											<option>-10</option>
										</select>
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="other-label">Other</span>
											<span class="tooltiptext move-left">
												<span data-i18n="obscure-vision-tooltip">-10 totally obscures vision. See Obscure B72.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_afflictions_section" value="0" />
					<div class="afflictions section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="afflictions-conditions-title">Afflictions & Conditions</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">
								
								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_coughing_sneezing_iq" value="1" title="Macro: @{NAME|coughing_sneezing_iq}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="coughing-sneezing-iq-label">Coughing/Sneezing: -1 IQ</span>
												<span class="tooltiptext">
													<span data-i18n="coughing-sneezing-iq-tooltip">-1 to IQ and IQ-based skills. Can't use Stealth. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_coughing_sneezing_dx" value="1" title="Macro: @{NAME|coughing_sneezing_dx}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="coughing-sneezing-dx-label">Coughing/Sneezing: -3 DX</span>
												<span class="tooltiptext">
													<span data-i18n="coughing-sneezing-dx-tooltip">-3 to DX and DX-based skills. Can't use Stealth. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_drowsy" value="1" title="Macro: @{NAME|drowsy}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="drowsy-label">drowsy: -2</span>
												<span class="tooltiptext">
													<span data-i18n="drowsy-tooltip">-2 to DX, IQ, and self-control rolls. Make a Will roll every two hours you're inactive to avoid falling asleep. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_tipsy" value="1" title="Macro: @{NAME|tipsy}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="tipsy-label">Tipsy: -1</span>
												<span class="tooltiptext">
													<span data-i18n="tipsy-tooltip">-2 to DX and IQ and -2 self-control rolls except to resist Cowardice. Reduce Shyness by one level. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_drunk" value="1" title="Macro: @{NAME|drunk}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="drunk-label">Drunk: -2</span>
												<span class="tooltiptext">
													<span data-i18n="drunk-tooltip">-2 to DX and IQ and -4 self-control rolls except to resist Cowardice. Reduce Shyness by <i>two</i> levels. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_euphoria" value="1" title="Macro: @{NAME|euphoria}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="euphoria-label">Euphoria: -3</span>
												<span class="tooltiptext">
													<span data-i18n="euphoria-tooltip">-3 to DX, IQ, and self-control rolls. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item2">

								<div class="block">
									<label>
										<div>
											<select name="attr_distraction" title="Macro: @{NAME|distraction}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="distraction-label">Distraction</span>
												<span class="tooltiptext">
													<span data-i18n="distraction-tooltip">-1 for Bees in your face, -2 for part clothes on fire, -3 all clothes on fire, etc. See B548.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_pain_level" title="Macro: @{NAME|pain_level}">
												<option value="0" selected="selected">No Pain</option>
												<option value="-2">-2 : Moderate</option>
												<option value="-4">-4 : Severe</option>
												<option value="-6">-6 : Terrible</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="pain-level-label">Pain Level</span>
												<span class="tooltiptext">
													<span data-i18n="pain-level-tooltip">Penalty to DX, IQ, and self-control rolls. Hight Pain Threshold halves penalty while Low Pain Threshold doubles the penalty. See B428.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_skill_encumbered" title="Macro: @{NAME|skill_encumbered}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="encumbered-label">Encumbered</span>
												<span class="tooltiptext">
													<span data-i18n="skill-encumbered-tooltip">Penalty equal to your encumbrance is applied to your skill.<br />Example: Climbing, Judo, Karate, Fencing Weapons, Stealth.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

							<div class="item item3">

								<div class="block">
									<label>
										<div>
											<select name="attr_bad_footing" title="Macro: @{NAME|bad_footing}">
												<option value="0" selected="selected">0</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
												<option>-6</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="bad-footing-label">Bad Footing</span>
												<span class="tooltiptext">
													<span data-i18n="bad-footing-tooltip">If defense, -1 or more. If attacking/skill, -2 or more. See B547-B549.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<select name="attr_shield_close_combat_penalty" title="Macro: @{NAME|shield_close_combat_penalty}">
												<option value="0" selected="selected">0</option>
												<option>-1</option>
												<option>-2</option>
												<option>-3</option>
												<option>-4</option>
												<option>-5</option>
											</select>
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="shield-close-combat-penalty-label">Close combat with shield: -1 per DB</span>
												<span class="tooltiptext">
													<span data-i18n="shield-close-combat-penalty-tooltip">See B547.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_grappled" value="1" title="Macro: @{NAME|grappled}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="grappled-label">You're grappled: -4</span>
												<span class="tooltiptext">
													<span data-i18n="grappled-tooltip">See Actions after being grappled for more information. See B371.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

								<div class="block">
									<label>
										<div>
											<input type="checkbox" name="attr_holding_large_shield" value="1" title="Macro: @{NAME|holding_large_shield}" />
										</div>
										<div>
											<div class="tooltip">
												<span data-i18n="holding-large-shield-label">Holding Large Shield: -2</span>
												<span class="tooltiptext">
													<span data-i18n="holding-large-shield-tooltip">See B547.</span>
												</span>
											</div>
										</div>
									</label>
								</div>

							</div>

						</div>

					</div>
					
					<input type="hidden" name="attr_display_tasks_section" value="0" />
					<div class="tasks section">

						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="task-modifiers-title">Task Modifiers</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">
								<div>
									<div class="tooltip">
										<span data-i18n="task-difficulty-label">Task Difficulty</span>
										<span class="tooltiptext">
											<span data-i18n="task-difficulty-tooltip">See B345 for full description.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_difficulty" class="medium-width" title="Macro: @{NAME|task_difficulty}">
										<option value="10">+10 : Automatic (start car)</option>
										<option value="9">+9 : Trivial (drive empty lot)</option>
										<option value="8">+8 : Trivial (drive empty lot)</option>
										<option value="7">+7 : Very Easy (drive empty street)</option>
										<option value="6">+6 : Very Easy (drive empty street)</option>
										<option value="5">+5 : Easy (drive small town)</option>
										<option value="4">+4 : Easy (drive small town)</option>
										<option value="3">+3 : Very Favorable (drive city)</option>
										<option value="2">+2 : Very Favorable (drive city)</option>
										<option value="1">+1 : Favorable (road rally)</option>
										<option value="0" selected="selected">0 : Average (Car chase)</option>
										<option value="-1">-1 : Unfavorable (High-speed chase)</option>
										<option value="-2">-2 : Very Unfavorable (Busy freeway chase)</option>
										<option value="-3">-3 : Very Unfavorable (Busy freeway chase)</option>
										<option value="-4">-4 : Hard (High-speed chase and shooting)</option>
										<option value="-5">-5 : Hard (High-speed chase and shooting)</option>
										<option value="-6">-6 : Very Hard (High-speed chase in blizzard)</option>
										<option value="-7">-7 : Very Hard (High-speed chase in blizzard)</option>
										<option value="-8">-8 : Dangerous (High-speed chase, blizzard, and shooting)</option>
										<option value="-9">-9 : Dangerous (High-speed chase, blizzard, and shooting)</option>
										<option value="-10">-10 : Impossible (Drive with knees, blizzard, shoot bazooka)</option>
									</select>
								</div>
							</div>

							<div class="item item7">
								<div>
									<div class="tooltip">
										<span data-i18n="extra-time-label">Extra Time</span>
										<span class="tooltiptext">
											<span data-i18n="extra-time-tooltip">Working slowly and deliberately on a noncombat task. See B346.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_extra_time" class="" title="Macro: @{NAME|task_extra_time}">
										<option value="0" selected="selected">0 : Normal Time</option>
										<option value="1">+1 : Time x 2</option>
										<option value="2">+2 : Time x 4</option>
										<option value="3">+3 : Time x 8</option>
										<option value="4">+4 : Time x 15</option>
										<option value="5">+5 : Time x 30</option>
									</select>
								</div>
							</div>

							<div class="item item8">
								<div>
									<div class="tooltip">
										<span data-i18n="haste-label">Haste</span>
										<span class="tooltiptext">
											<span data-i18n="haste-tooltip">Hurrying the noncombat task. See B346.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_haste" class="" title="Macro: @{NAME|task_haste}">
										<option value="0" selected="selected">0 : Normal Time</option>
										<option value="-1">-1 : Time x 90%</option>
										<option value="-2">-2 : Time x 80%</option>
										<option value="-3">-3 : Time x 70%</option>
										<option value="-4">-4 : Time x 60%</option>
										<option value="-5">-5 : Time x 50%</option>
										<option value="-6">-6 : Time x 40%</option>
										<option value="-7">-7 : Time x 30%</option>
										<option value="-8">-8 : Time x 20%</option>
										<option value="-9">-9 : Time x 10%</option>
										<option value="-10">-10 : Instant (cinematic)</option>
									</select>
								</div>
							</div>

						</div>

						<div class="container">

							<!-- row 1 -->
							<div class="item item1">
								<label>
									<div>
										<input type="checkbox" name="attr_unfamiliar_culture" value="1" title="Macro: @{NAME|unfamiliar_culture}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="unfamiliar-culture-label">Unfamiliar Culture: -3</span>
											<span class="tooltiptext">
												<span data-i18n="unfamiliar-culture-tooltip">-3 to skill with a significant cultural component; Carousing, Connoisseur, Criminology, Dancing, Detect Lies, Diplomacy, Fast-Talk, Games, Gesture, etc. See B23.</span>
											</span>
										</div>
									</div>
								</label>
							</div>

							<div class="item item2">
								<div>
									<div class="tooltip">
										<span data-i18n="language-modifier-label">Language Modifier</span>
										<span class="tooltiptext">
											<span data-i18n="language-modifier-tooltip">Based on comprehension, use Task Difficulty for additional modifiers like bad phone connection. See B24.<br />Language skills: Fast-Talk, Public Speaking, Research, Speed-Reading, teaching, and Writing.<br />Artistic Skills: Poetry, Singing, etc.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_language_modifier" class="" title="Macro: @{NAME|language_modifier}">
										<option value="0" selected="selected">0 : Native</option>
										<option value="-1">-1 : Accented (language skills)</option>
										<option value="-2">-2 : Accented (artistic skills)</option>
										<option value="-3">-3 : Broken (language skills)</option>
										<option value="-6">-6 : Broken (artisitc skills)</option>
									</select>
								</div>
							</div>

							<div class="item item3">
								<div>
									<div class="tooltip">
										<span data-i18n="iq-tech-level-modifier-label">IQ Tech Level Modifier</span>
										<span class="tooltiptext">
											<span data-i18n="iq-tech-level-modifier-tooltip">IQ-Based skills. When you work with equipment or concepts of a TL different from your own skill, you suffer a penalty. See B168.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_iq_tech_level_modifier" class="" title="Macro: @{NAME|iq_tech_level_modifier}">
										<option value="-100">Impossible : Your TL + 4</option>
										<option value="-15">-15 : Your TL + 3</option>
										<option value="-10">-10 : Your TL + 2</option>
										<option value="-5">-5 : Your TL + 1</option>
										<option value="0" selected="selected">0 : Your TL</option>
										<option value="-1">-1 : Your TL - 1</option>
										<option value="-3">-3 : Your TL - 2</option>
										<option value="-5">-5 : Your TL - 3</option>
										<option value="-7">-7 : Your TL - 4</option>
										<option value="-8">-8 : Your TL - 5</option>
										<option value="-9">-9 : Your TL - 6</option>
										<option value="-10">-10 : Your TL - 7</option>
										<option value="-11">-11 : Your TL - 8</option>
										<option value="-12">-12 : Your TL - 9</option>
										<option value="-13">-13 : Your TL - 10</option>
										<option value="-14">-14 : Your TL - 11</option>
										<option value="-15">-15 : Your TL - 12</option>
									</select>
								</div>
							</div>

							<div class="item item4">
								<div>
									<div class="tooltip">
										<span data-i18n="non-iq-tech-level-modifier-label">Non IQ TL Modifier</span>
										<span class="tooltiptext move-left">
											<span data-i18n="non-iq-tech-level-modifier-tooltip">Non IQ-Based skills. Flat penalty of -1 per TL difference. See B168.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_non_iq_tech_level_modifier" class="number-only-width" title="Macro: @{NAME|non_iq_tech_level_modifier}">
										<option selected="selected">0</option>
										<option>-1</option>
										<option>-2</option>
										<option>-3</option>
										<option>-4</option>
										<option>-5</option>
										<option>-6</option>
										<option>-7</option>
										<option>-8</option>
										<option>-9</option>
										<option>-10</option>
										<option>-11</option>
										<option>-12</option>
									</select>
								</div>
							</div>

						</div>

					</div>

					<input type="hidden" name="attr_display_equipment_section" value="0" />
					<div class="equipment section">
					
						<div class="container">

							<!-- row 1 -->
							<div class="item item1-5 full-width">
								<h4>
									<span data-i18n="equipment-modifiers-title">Equipment Modifiers</span>
								</h4>
							</div>

							<!-- row 2 -->
							<div class="item item6">
								<div>
									<div class="tooltip">
										<span data-i18n="available-equipment-label">Available Equipment</span>
										<span class="tooltiptext">
											<span data-i18n="available-equipment-tooltip">Equipment modifiers for skills. See B345.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_equipment_modifier" class="medium-width" title="Macro: @{task_equipment_modifier}">
										<option value="6">+6 : Best for equipment Tech Level 12</option>
										<option value="5">+5 : Best for equipment Tech Level 10 or 11</option>
										<option value="4">+4 : Best for equipment Tech Level 8 or 9</option>
										<option value="3">+3 : Best for equipment Tech Level 6 or 7</option>
										<option value="2">+2 : Fine-quality equipment</option>
										<option value="1">+1 : Good-quality equipment</option>
										<option value="0" selected="selected">0 : Base Equipment</option>
										<option value="-2">-2 : Improvised equipment for non-technological skill</option>
										<option value="-5">-5 : No equipment for non-technological skill</option>
										<option value="-5">-5 : Improvised equipment for technological skill</option>
										<option value="-10">-10 : No equipment for technological skill</option>
									</select>
								</div>
							</div>

							<div class="item item7">
								<div>
									<div class="tooltip">
										<span data-i18n="missing-items-label">Missing Items</span>
										<span class="tooltiptext">
											<span data-i18n="missing-items-tooltip">-1 per item missing. See B346.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_missing_items" class="" title="Macro: @{NAME|task_missing_items}">
										<option value="0" selected="selected">0</option>
										<option value="-1">-1</option>
										<option value="-2">-2</option>
										<option value="-3">-3</option>
										<option value="-4">-4</option>
										<option value="-5">-5</option>
										<option value="-6">-6</option>
										<option value="-7">-7</option>
										<option value="-8">-8</option>
										<option value="-9">-9</option>
										<option value="-10">-10</option>
									</select>
								</div>
							</div>

							<div class="item item8">
								<div>
									<div class="tooltip">
										<span data-i18n="damaged-equipment-label">Damaged Equipment</span>
										<span class="tooltiptext">
											<span data-i18n="damaged-equipment-tooltip">Damaged equipment modifier, such as -1 for first-aid kit salvaged from a wreck. See B346.</span>
										</span>
									</div>
								</div>
								<div>
									<select name="attr_task_damaged_equipment" class="" title="Macro: @{NAME|task_damaged_equipment}">
										<option value="0" selected="selected">0</option>
										<option value="-1">-1</option>
										<option value="-2">-2</option>
										<option value="-3">-3</option>
									</select>
								</div>
							</div>

							<div class="item item9">
								<label>
									<div>
										<input type="checkbox" name="attr_unfamiliar_equipment" value="1" title="Macro: @{NAME|unfamiliar_equipment}" />
									</div>
									<div>
										<div class="tooltip">
											<span data-i18n="unfamiliar-equipment-label">Unfamiliar Equipment: -2</span>
											<span class="tooltiptext move-left">
												<span data-i18n="unfamiliar-equipment-tooltip">Any skill used to operate equipment like Driving/TL7 (Autommobile) takes a penalty when faced with an unfamiliar type of item. For instance, you're used to a compact car but you need to drive a van. See B169</span>
											</span>
										</div>
									</div>
								</label>
							</div>

						</div>

					</div>

				</div>
			</div><!-- end .modal-main-content -->

			<div class="modal-footer">
				<button type="action" name="act_apply_roll_modifiers" class="btn" title="Apply modifiers and close"><span data-i18n="apply-label">Apply</span></button>
				<button type="action" name="act_reset_roll_modifiers" class="btn" title="Reset all values on dialog box."><span data-i18n="reset-label">Reset</span></button>
			</div>
		</div>
	</div>

	<!-- HIDDEN FIELDS -->
	<input type="hidden" name="attr_10" value="10" />
	<input type="hidden" name="attr_VS" value="vs:" />
	<input type="hidden" name="attr_attribute_positive_total" value="0" />
	<input type="hidden" name="attr_attribute_negative_total" value="0" />
	<input type="hidden" name="attr_racial_points_advantage" value="0" />
	<input type="hidden" name="attr_racial_points_disadvantage" value="0" />
	<input type="hidden" name="attr_tech_level_points_advantage" value="0" />
	<input type="hidden" name="attr_tech_level_points_disadvantage" value="0" />
	<input type="hidden" name="attr_language_points_advantage" value="0" />
	<input type="hidden" name="attr_language_points_disadvantage" value="0" />
	<input type="hidden" name="attr_languages_points" value="0" />
	<input type="hidden" name="attr_cf_points" value="0" />
	<input type="hidden" name="attr_advantages_points" value="0" />
	<input type="hidden" name="attr_advantages_perks" value="0" />
	<input type="hidden" name="attr_disadvantages_points" value="0" />
	<input type="hidden" name="attr_disadvantages_quirks" value="0" />
	<input type="hidden" name="attr_racial_points" value="0" />
	<input type="hidden" name="attr_skills_points" value="0" />
	<input type="hidden" name="attr_techniques_points" value="0" />
	<input type="hidden" name="attr_techniques_revised_points" value="0" />
	<input type="hidden" name="attr_spells_points" value="0" />
	<input type="hidden" name="attr_announcements_hide" value="0" />
	<input type="hidden" name="attr_inventory_fixed_digits" value="0" />
	<input type="hidden" name="attr_base_attribute_level" value="10" />
	<!-- /HIDDEN FIELDS -->

	<div class="heading-character-name">
		
		<div style="float:right; margin-left: 15px;">

			<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
			<input type="hidden" name="attr_display_roll_modifiers_header" />
			<div class="roll-options roll-modifiers-prompt">
				
				<label>
					<input type="radio" name="attr_modifier_option_header" value="0" />
					<span data-i18n="no-prompt-label">No Prompt</span>
				</label>
				<label>
					<input type="radio" name="attr_modifier_option_header" value="1" />
					<span data-i18n="single-prompt-label">Single Prompt</span>
				</label>
				<label>
					<input type="radio" name="attr_modifier_option_header" value="2" />
					<span data-i18n="extended-prompt-label">Extended Prompts</span>
				</label>

			</div>
			
		</div>

		<div style="float:right;">

			<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
			<input type="hidden" name="attr_display_roll_option_header" />
			<div class="roll-options">
				
				<label>
					<input type="radio" name="attr_roll_option_header" value="public" />
					<span data-i18n="public-rolls-label">Public Rolls</span>
				</label>
				<label>
					<input type="radio" name="attr_roll_option_header" value="private" />
					<span data-i18n="private-rolls-label">Private Rolls</span>
				</label>

				<input type="hidden" name="attr_display_custom_roll_option_header" />
				<label class="custom-roll-button">
					<input type="radio" name="attr_roll_option_header" value="custom" />
					<span name="attr_custom_roll_macro_label"></span>
				</label>

			</div>
			
		</div>

		<div style="float:left;">
			<h3><span name="attr_character_name"></span></h3>
		</div>
			
	</div>

	<div class="update-alert">
		<div class="container">
			<input type="checkbox" class="showarrow ack-button" name="attr_announcements_show" value="1" title="Click to view announcements" />
			<label class="show-content">
				<span data-i18n="announcements">Announcements</span> <span name="attr_latest_changes"></span>
			</label>
			<div class="content">
				<h4>
					<span data-i18n="sheet-version-title">GURPS Character Sheet Version:</span>
					<input type="text" name="attr_announcement_version" readonly="readonly" value="0" title="GURPS Character Sheet Version" />
				</h4>

				<!-- current version notes: 2.24.0 -->
				<ul>
					<li><b>BUGFIX:</b> A couple of translation updates and fixing a page reference for Aim. Suggested by Spriteanon and Uncle Mojo.</li>
					<li><b>BUGFIX:</b> When adding a brand new spell, not all of the modifiers were correctly added. This has now been fixed.</li>
				</ul>
				
				<label class="check"><input type="checkbox" name="attr_announcements_hide" value="1">&nbsp;<b><span data-i18n="hide-until-next-update">Hide until next update</span></b></label>
				<button type="action" name="act_view_updates_tab" class="reset" style="width:105px"><span data-i18n="view-all-updates">View All Updates</span></button>
			</div>
		</div>
	</div>
	

	<!-- ===== ===== ===== ===== TABS ===== ===== ===== ===== -->
	<input type="hidden" name="attr_gurps_sheet_type" value="character" />
	<input type="radio" name="attr_tab" value="1" class="tab tab1" checked="checked" /><span data-i18n="tab-general">General</span>
	<input type="radio" name="attr_tab" value="2" class="tab tab2" title="Languages, Advantages, Disadvantages, and Cultural Familiarities" /><span data-i18n="tab-traits">Traits</span>
	<input type="radio" name="attr_tab" value="1a" class="tab tab-misc" title="Miscellaneous box, Bio Notes, General Notes" /><span data-i18n="tab-bio-misc">Bio\Misc</span>
	<input type="radio" name="attr_tab" value="3" class="tab tab3" title="Skills and Techniques" /><span data-i18n="tab-skills">Skills</span>
	<input type="radio" name="attr_tab" value="4" class="tab tab4" /><span data-i18n="tab-combat">Combat</span>
	<input type="radio" name="attr_tab" value="5" class="tab tab5" /><span data-i18n="tab-inventory">Inventory</span>
	<input type="radio" name="attr_tab" value="6" class="tab tab6" /><span data-i18n="tab-grimoire">Grimoire</span>
	<input type="radio" name="attr_tab" value="chase" class="tab tab-chase" /><span data-i18n="tab-chase">Chases</span>
	<input type="radio" name="attr_tab" value="vehicle" class="tab tab-vehicle" /><span data-i18n="tab-vehicle">Vehicle</span>
	<input type="radio" name="attr_tab" value="vehicle-locations" class="tab tab-vehicle-locations" /><span data-i18n="tab-locations">Locations</span>
	<input type="radio" name="attr_tab" value="vehicle-crew" class="tab tab-vehicle-crew" /><span data-i18n="tab-crew">Crew</span>
	<input type="radio" name="attr_tab" value="vehicle-loadout" class="tab tab-vehicle-loadout" /><span data-i18n="tab-loadout">Loadout</span>
	<input type="radio" name="attr_tab" value="tools" class="tab tab-tools" /><span data-i18n="tools-label">Tools</span>
	<input type="radio" name="attr_tab" value="7" class="tab tab7" /><span data-i18n="tab-updates">Updates</span>
	<input type="radio" name="attr_tab" value="8" class="tab tab8" title="Help" /><span data-i18n="tab-help">Help</span>
	<input type="radio" name="attr_tab" value="0" class="tab tab0 gear" title="Sheet Options" /><span class="gear">y</span>
	<div class="tab-br"></div>

	<!-- ===== ===== ===== ===== GENERAL TAB ===== ===== ===== ===== -->
	<div class="tab1">

		<div class="warning-messages">

			<input type="hidden" name="attr_show_size_modifier_strength_message" value="0" />
			<input type="hidden" name="attr_size_modifier_cp_strength_adjustment" value="0" />
			<div class="message-box size-modifier-strength-message">
				<span data-i18n="size-modifier-strength-warning-message"><b style="color: red;">Warning!</b> Due to your Size Modifier <span name="attr_size"></span> you only need to spend <span name="attr_size_modifier_cp_strength_adjustment"></span> character points (<span name="attr_strength_points_per_level"></span> pts/level) for Strength <span name="attr_strength_display"></span>.</span>
			</div>

			<input type="hidden" name="attr_show_size_modifier_hit_point_message" value="0" />
			<input type="hidden" name="attr_size_modifier_cp_hit_point_adjustment" value="0" />
			<div class="message-box size-modifier-hit-point-message">
				<span data-i18n="size-modifier-hit-point-warning-message"><b style="color: red;">Warning!</b> Due to your Size Modifier <span name="attr_size"></span> you only need to spend <span name="attr_size_modifier_cp_hit_point_adjustment"></span> character points for Extra Hit Points (<span name="attr_extra_hit_points_per_level"></span> pts/level) <span name="attr_hit_points_max"></span>.</span>
			</div>

			<input type="hidden" name="attr_show_size_modifier_lifting_st_message" value="0" />
			<input type="hidden" name="attr_size_modifier_cp_lifting_st_adjustment" value="0" />
			<div class="message-box size-modifier-lifting-st-message">
				<span data-i18n="size-modifier-lifting-st-warning-message"><b style="color: red;">Warning!</b> Due to your Size Modifier <span name="attr_size"></span> you only need to spend <span name="attr_size_modifier_cp_lifting_st_adjustment"></span> character points (<span name="attr_lifting_points_per_level"></span> pts/level) for Lifting ST <span name="attr_lift_st"></span>.</span>
			</div>

			<input type="hidden" name="attr_show_size_modifier_striking_st_message" value="0" />
			<input type="hidden" name="attr_size_modifier_cp_striking_st_adjustment" value="0" />
			<div class="message-box size-modifier-striking-st-message">
				<span data-i18n="size-modifier-striking-st-warning-message"><b style="color: red;">Warning!</b> Due to your Size Modifier <span name="attr_size"></span> you only need to spend <span name="attr_size_modifier_cp_striking_st_adjustment"></span> character points (<span name="attr_striking_points_per_level"></span> pts/level) for Striking ST <span name="attr_striking_st"></span>.</span>
			</div>

		</div>

		<div class="tab1-container">

		<!-- _____ _____ ATTRIBUTE BOX _____ _____ -->
		<div class="box attribute" style="float: left;">
			<div class="table">
				<div class="header">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0">
						<span data-i18n="attributes-label">Attributes</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-modifier-label">Mod</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attributes-modifier-tooltip">
A modifier that will be applied to your <br />
attribute. All derived attributes draw their<br />
base from your  unmodified attributes.<br />
Therefore this MOD will generally only<br /> 
affect direct attribute rolls and skill rolls.
							</span>
						</span>
					</div>
					<div class="cell col2">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
				</div> <!-- .header -->
				<div class="main-attribute">

					<div class="row row-strength">
						<div class="cell col-button">
							<input type="checkbox" name="attr_toggle_strength_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
							<span class="checkbox checkbox-attribute-reason"></span>
						</div>
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-strength">ST</span>
							</div>
							<span class="tooltip">
								<input type="hidden" name="attr_strength_points_per_level" value="10" />
								<span data-i18n="attributes-strength-tooltip">
Strength <span name="attr_strength_points_per_level"></span> pts/level - Unmodified <span name="attr_strength_base"></span><br />
Cost reduced by -10% (Max -80%) per SM+1 (B15)
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="number" name="attr_strength_display" value="10" readonly="readonly" title="Macro: @{NAME|strength_display}" />
							<input type="hidden" name="attr_strength_halved" value="0" title="Macro: @{NAME|strength_halved}" />
							<input type="hidden" name="attr_strength" value="10" title="Macro: @{NAME|strength}" />
						</div>
						<div class="cell col2">
							<input type="number" name="attr_strength_mod" value="0" step="1" title="Macro: @{NAME|strength_mod}" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_strength_points" value="0" step="10" title="Macro: @{NAME|strength_points}" />
						</div>
						<div class="cell col4">
							<button type="action" name="act_roll_attribute_strength" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Strength Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{strength_display} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
						</div>
					</div> <!-- .row -->

					<input type="hidden" name="attr_toggle_strength_reason_modifier" value="0" />
					<div class="display-attribute-reasons">
						<div class="row row-strength strength-reasons">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="reason-label">Reason</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
								</span>
							</div>
							<div class="cell">
								<input type="text" class="inline width-125 text-left" name="attr_strength_modifier_reason" value="" />
							</div>
						</div>
					</div>

					<div class="row row-dexterity">
						<div class="cell col-button">
							<input type="checkbox" name="attr_toggle_dex_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
							<span class="checkbox checkbox-attribute-reason"></span>
						</div>
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-dexterity">DX</span>
							</div>
							<span class="tooltip">
								<span data-i18n="attributes-dexterity-tooltip">Dexterity 20pts/level - Unmodified:</span>
								<span name="attr_dexterity_base"></span>
							</span>
						</div>
						<div class="cell col1">
							<input type="number" name="attr_dexterity" value="10" readonly="readonly" title="Macro: @{NAME|dexterity}" >
						</div>
						<div class="cell col2">
							<input type="number" name="attr_dexterity_mod" value="0" step="1" title="Macro: @{NAME|dexterity_mod}" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_dexterity_points" value="0" step="20" title="Macro: @{NAME|dexterity_points}" />
						</div>
						<div class="cell col4">
							<button type="action" name="act_roll_attribute_dexterity" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Dexterity Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{dexterity} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
						</div>
					</div> <!-- .row -->

					<input type="hidden" name="attr_toggle_dex_reason_modifier" value="0" />
					<div class="display-attribute-reasons">
						<div class="row row-dexterity dexterity-reasons">
							<div class="cell label font-size-12">
								<div class="popup">
									<span data-i18n="reason-label">Reason</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
								</span>
							</div>
							<div class="cell">
								<input type="text" class="inline width-125 text-left" name="attr_dexterity_modifier_reason" value="" />
							</div>
						</div>
					</div>

					<div class="row row-intelligence">
						<div class="cell col-button">
							<input type="checkbox" name="attr_toggle_int_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
							<span class="checkbox checkbox-attribute-reason"></span>
						</div>
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-intelligence">IQ</span>
							</div>
							<span class="tooltip">
								<span data-i18n="attributes-intelligence-tooltip">Intelligence 20pts/level -Unmodified:</span> 
								<span name="attr_intelligence_base"></span>	
							</span>
						</div>
						<div class="cell col1">
							<input type="number" name="attr_intelligence" value="10" readonly="readonly" title="Macro: @{NAME|intelligence}" >
						</div>
						<div class="cell col2">
							<input type="number" name="attr_intelligence_mod" value="0" step="1" title="Macro: @{NAME|intelligence_mod}" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_intelligence_points" value="0" step="20" title="Macro: @{NAME|intelligence_points}" />
						</div>
						<div class="cell col4">
							<button type="action" name="act_roll_attribute_intelligence" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Intelligence Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{intelligence} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
						</div>
					</div> <!-- .row -->

					<input type="hidden" name="attr_toggle_int_reason_modifier" value="0" />
					<div class="display-attribute-reasons">
						<div class="row row-intelligence intelligence-reasons">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="reason-label">Reason</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
								</span>
							</div>
							<div class="cell">
								<input type="text" class="inline width-125 text-left" name="attr_int_modifier_reason" value="" />
							</div>
						</div>
					</div>					

					<div class="row row-health">
						<div class="cell col-button">
							<input type="checkbox" name="attr_toggle_health_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
							<span class="checkbox checkbox-attribute-reason"></span>
						</div>
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-health">HT</span>
							</div>
							<span class="tooltip">
								<span data-i18n="attributes-health-tooltip">Health 10pts/level - Unmodified:</span> 
								<span name="attr_health_base"></span><br />
								<span data-i18n="attributes-health-detailed-tooltip"></span>

							</span>
						</div>
						<div class="cell col1">
							<input type="number" name="attr_health" value="10" readonly="readonly" title="Macro: @{NAME|health}" >
						</div>
						<div class="cell col2">
							<input type="number" name="attr_health_mod" value="0" step="1" title="Macro: @{NAME|health_mod}" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_health_points" value="0" step="10" title="Macro: @{NAME|health_points}" />
						</div>
						<div class="cell col4">
							<button type="action" name="act_roll_attribute_health" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Health Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{health} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
						</div>
					</div> <!-- .row -->

					<input type="hidden" name="attr_toggle_health_reason_modifier" value="0" />
					<div class="display-attribute-reasons">
						<div class="row row-health health-reasons">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="reason-label">Reason</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
								</span>
							</div>
							<div class="cell">
								<input type="text" class="inline width-125 text-left" name="attr_health_modifier_reason" value="" />
							</div>
						</div>
					</div>
					
				</div>

				<div class="row row-perception hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_perception_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason"></span>
					</div>
					<div class="cell col0 label">
						<div class="whisper-box">
							<div class="whisper-title">
								<div class="popup">
									<span data-i18n="abbreviation-perception">Per</span>
								</div>
								<span class="tooltip">
									<span data-i18n="attributes-perception-tooltip">
Perception: Based on Intelligence<br />
5pts/level<br />
Check the box to whisper perception roll to GM.<br />
Unmodified: <span name="attr_perception_base"></span>
									</span>
								</span>
							</div>
						</div>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_perception" value="10" readonly="readonly" title="Macro: @{NAME|perception}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_perception_mod" value="0" step="1" title="Macro: @{NAME|perception_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_perception_points" value="0" step="5" title="Macro: @{NAME|perception_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_perception" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Perception Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{perception} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_perception_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-perception perception-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_perception_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row row-vision">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_vision_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-vision">Vision</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attributes-vision-tooltip">
Visual Perception<br />
Based on Perception<br />
2pts/level<br />
Unmodified: <span name="attr_vision_base"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_vision" value="10" readonly="readonly" title="Macro: @{NAME|vision}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_vision_mod" value="0" step="1" title="Macro: @{NAME|vision_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_vision_points" value="0" step="2" title="Macro: @{NAME|vision_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_vision" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Vision Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{vision} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_vision_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-vision vision-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_vision_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row row-hearing">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_hearing_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-hearing">Hearing</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-hearing-tooltip">
Audio Perception<br />
Based on Perception<br />
2pts/level<br />
Unmodified: <span name="attr_hearing_base"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_hearing" value="10" readonly="readonly" title="Macro: @{NAME|hearing}" >
					</div>
					<div class="cell col2">
						<input type="number" name="attr_hearing_mod" value="0" step="1" title="Macro: @{NAME|hearing_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_hearing_points" value="0" step="2" title="Macro: @{NAME|hearing_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_hearing" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Hearing Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{hearing} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_hearing_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-hearing hearing-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_hearing_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row row-taste-smell">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_smell_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-smell">Smell</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-smell-tooltip">
Smell & Taste Perception (B35)<br />
Based on Perception<br />
2pts/level<br />
Unmodified: <span name="attr_taste_smell_base"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_taste_smell" value="10" readonly="readonly" title="Macro: @{NAME|taste_smell}" >
					</div>
					<div class="cell col2">
						<input type="number" name="attr_taste_smell_mod" value="0" step="1" title="Macro: @{NAME|taste_smell_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_taste_smell_points" value="0" step="2" title="Macro: @{NAME|taste_smell_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_smell" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Taste/Smell Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{taste_smell} + @{modifier}]]}} {{useCriticalPlusTen=[[0]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_smell_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-smell smell-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_smell_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row margin-bottom row-touch">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_touch_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-touch">Touch</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-touch-tooltip">
Touch Perception<br />
Based on Perception<br />
2pts/level<br />
Unmodified: <span name="attr_touch_base"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_touch" value="10" readonly="readonly" title="Macro: @{NAME|touch}" >
					</div>
					<div class="cell col2">
						<input type="number" name="attr_touch_mod" value="0" step="1" title="Macro: @{NAME|touch_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_touch_points" value="0" step="2" title="Macro: @{NAME|touch_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_touch" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Touch Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{touch} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_touch_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-touch touch-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_touch_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-willpower hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_will_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-will">Will</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-will-tooltip">
Willpower<br />
Based on Intelligence<br />
5pts/level<br />
Unmodified: <span name="attr_willpower_base"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_willpower" value="10" readonly="readonly" title="Macro: @{NAME|willpower}" >
					</div>
					<div class="cell col2">
						<input type="number" name="attr_willpower_mod" value="0" step="1" title="Macro: @{NAME|willpower_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_willpower_points" value="0" step="5" title="Macro: @{NAME|willpower_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_willpower" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Will Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{willpower} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_will_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-will will-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_will_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row margin-bottom row-fear">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_fright_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-fright">Fright</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-fright-tooltip">
Fright Check (B360)<br />
Based on Willpower<br />
2pts/level<br />
Unmodified: <span name="attr_fear_check_base"></span><br/>
Combat Reflexes Modifier: <span name="attr_combat_reflexes_fear_check_mod"></span><br />
See extensive list of Modifiers B360 & GURPS Horror p139-142.
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_fear_check" value="10" readonly="readonly" title="Macro: @{NAME|fear_check}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_fear_check_mod" value="0" step="1" title="Macro: @{NAME|fear_check_mod}" />
						<input type="hidden" name="attr_combat_reflexes_fear_check_mod" value="0" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_fear_check_points" value="0" step="2" title="Macro: @{NAME|fear_check_points}" />
					</div>
					<div class="cell col4">
						<!-- For Fright Check, use "kl1" = Keep Lowest One. [[1d8 ( { 16 , 13 }kl1) ]] = 1d6 + 13 -->
						<!-- see: https://wiki.roll20.net/Macros_-_Pathfinder_Examples : Calculated Dice Roll -->
						<button type="action" name="act_roll_attribute_fright_check" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Attribute Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Fright Check}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[ ( {@{fear_check} + @{modifier}, @{fright_check_threshold}}kl1) ]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{useFrightLabel=[[1]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{fright_check_success_notes}}} {{rawCriticalSuccessNote=@{fright_check_critical_success_notes}}} {{rawFailNote=@{fright_check_fail_notes}}} {{rawCriticalFailNote=@{fright_check_critical_failure_notes}}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_fright_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-fright fright-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_fright_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row margin-bottom row-fear">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_fright_threshold_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-threshold">Thresh</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-fright-check-threshold-tooltip">
Fright Check Threshold - Uses <strong>Rule of 14</strong> (B360). By default this value is 13.<br />
This means that a roll of 14 or more is automatically a failure.<br />
This Threshold can be modifier by the Perks of Brave (Dungeon Fantasy 11, p11) or Rule of 15 <br />
(Power Ups 2, p13).<br />
Will and/or Fright plus bonuses (like Fearlessness or Combat Reflexes) must total 14+ for this<br />
to be useful, of course!<br />
Note: A Fright Check can be used for Awe and Confusion. (Powers p84 under Terror) and the Awe and<br />
Confusion Check Table for failures. (Powers p85).
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_fright_check_threshold" value="13" readonly="readonly" title="Macro: @{NAME|fright_check_threshold}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_fright_check_threshold_mod" value="0" step="1" title="Macro: @{NAME|fright_check_threshold_mod}" />
					</div>
					<div class="cell col3-fright-label">
						<i><span data-i18n="fright-check-label">Fright Check</span></i>
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_fright_threshold_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-fright-threshold fright-threshold-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_fright_threshold_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_unstun_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-unstun">Unstun</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-unstun-tooltip">
Recover from physical stun, based on Health.<br />
Roll at the end of your turn after Do Nothing 
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_stun_check" value="10" readonly="readonly" title="Macro: @{NAME|stun_check}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_stun_check_mod" value="0" step="1" title="Macro: @{NAME|stun_check_mod}" />
					</div>
					<div class="cell col3">
						&nbsp;
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_stun_check" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Condition Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Unstun Check (Recovering from Stun)}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{stun_check} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{unstun_check_success_notes}}} {{rawCriticalSuccessNote=@{unstun_check_critical_success_notes}}} {{rawFailNote=@{unstun_check_fail_notes}}} {{rawCriticalFailNote=@{unstun_check_critical_failure_notes}}}" />
					</div>	
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_unstun_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-unstun unstun-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_unstun_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row row-condition-knockdown">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_knockdown_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-knock-down">K Down</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-knock-down-tooltip">
Knockdown and Stunning check (B420), based on HT (Health).<br />
Roll <span style="font-style: italic; font-weight: bold; text-decoration: underline;">immediately</span> whenever the following happens:<br />
<ul>
	<li>You suffer a Major Wound (B420) - This is any <span style="font-style: italic; font-weight: bold; text-decoration: underline;">single injury</span> that inflicts a wound in excess of ½ your HP.</li>
	<li>You suffer any Crippling Injury (B420-421).</li>
	<li>Whenever you are struck in the Head (Skull, Face, or Eye) or Vitals for enough injury to cause a Shock (B419) penalty.</li>
</ul>
<span style="font-style: italic;">Modifiers:</span><br />
<ul>
	<li>- 5 for a Major Wound (B420) to the Face or Vitals (or to the Groin on a humanoid male).</li>
	<li>- 10 for a Major Wound (B420) to the Skull or Eye.</li>
</ul>		
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_knockdown_check" value="10" readonly="readonly" title="Macro: @{NAME|knockdown_check}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_knockdown_check_mod" value="0" step="1" title="Macro: @{NAME|knockdown_check_mod}" />
					</div>
					<div class="cell col3">
						&nbsp;
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_knockdown_check" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Condition Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Knockdown & Stunning Check - B420}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{knockdown_check} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{knockdown_check_success_notes}}} {{rawCriticalSuccessNote=@{knockdown_check_critical_success_notes}}} {{rawFailNote=@{knockdown_check_fail_notes}}} {{rawCriticalFailNote=@{knockdown_check_critical_failure_notes}}}" />
					</div>

				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_knockdown_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-knockdown knockdown-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_knockdown_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row row-unconscious">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_unconscious_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-unconscious">Unc.</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-unconscious-check-tooltip">
Unconscious Check, based on Health<br />
If HP zero or less, roll per turn to take an Active Action.<br />
-1 per full multiple of HP below zero.<br />
Hard/Easy to Subdue: Gives +/- per level to Unconscious Check<br />
Fit +1 to Unc. Check . Very Fit +2 to Unc. Check
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_unconscious_check" value="10" readonly="readonly" title="Macro: @{NAME|unconscious_check}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_unconscious_check_mod" value="0" step="1" title="Macro: @{NAME|unconscious_check_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_unconscious_check_points" value="0" step="2" title="Macro: @{NAME|unconscious_check_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_unconscious_check" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Condition Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Unconscious Check}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{unconscious_check} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{unconscious_check_success_notes}}} {{rawCriticalSuccessNote=@{unconscious_check_critical_success_notes}}} {{rawFailNote=@{unconscious_check_fail_notes}}} {{rawCriticalFailNote=@{unconscious_check_critical_failure_notes}}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_unconscious_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-unconscious unconscious-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_unconscious_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row sub-row margin-bottom row-death">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_death_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-death-check">Death</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-death-check-tooltip">
Death Check, based on Health.<br />
On damage taken: Immediately Roll a Death Check if you are<br />
at-1xHP or more.<br />
Roll again each time you suffer injury equal to a further<br />
multiple of your HP. (-2xHP, -3xHP, -4xHP) <br />
Immediate Death at -5xHP<br />
Hard/Easy to Kill: Gives +/- per level to a Death Check<br />
Fit +1 to Death Check . Very Fit +2 to Death Check
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_death_check" value="10" readonly="readonly" title="Macro: @{NAME|death_check}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_death_check_mod" value="0" step="1" title="Macro: @{NAME|death_check_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_death_check_points" value="0" step="2" title="Macro: @{NAME|death_check_points}" />
					</div>
					<div class="cell col4">
						<button type="action" name="act_roll_attribute_death_check" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Condition Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Death Check}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{death_check} + @{modifier}]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{death_check_success_notes}}} {{rawCriticalSuccessNote=@{death_check_critical_success_notes}}} {{rawFailNote=@{death_check_fail_notes}}} {{rawCriticalFailNote=@{death_check_critical_failure_notes}}}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_death_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-death death-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_death_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-basic-speed hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_speed_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="speed-label">Speed</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-speed-tooltip">
Basic Speed<br />
Based on Health and Dexterity<br />
5pts/0.25<br />
Unmodified: <span name="attr_basic_speed_base" value="10"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_basic_speed" value="" step="0.25" readonly="readonly" title="Macro: @{NAME|basic_speed}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_basic_speed_mod" value="0" step="0.25" title="Macro: @{NAME|basic_speed_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_basic_speed_points" value="0" step="5" title="Macro: @{NAME|basic_speed_points}" />
					</div>
					<div class="cell col4">
						<button title="Reminder: You must select your Token first.&#013;This will add the Token's Speed plus DX&#013;as a single number in the Turn Order.&#013;DX was added to Speed to help break ties. (B363)" class="roll-tracker" type="roll" value="@{speed_tracker} [[[[@{selected|Basic_Speed}]]+[[(@{selected|dexterity}/100)]] &{tracker:=}]] &{template:addToTracker} {{characterName=@{character_name}}} {{skillName=Added to the Turn Order as [[ [[@{selected|Basic_Speed}]]+[[(@{selected|dexterity}/100)]] ]]}} {{basicSpeed=Speed: @{selected|Basic_Speed} &nbsp;&nbsp; DX: @{selected|dexterity}}}" name="roll_init" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_speed_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-speed speed-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_speed_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-basic-move">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_move_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-move">Move</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-move-tooltip">
Basic Move - Based on Basic Speed - 5pts/level - Unmodified: <span name="attr_basic_move_base" value="0"></span><br />
Note: The Move score automatically adjusts for Encumbrance and for HP and/or FP loss below 1/3. (B419, B426)
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_basic_move" value="" readonly="readonly" title="Macro: @{NAME|basic_move}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_basic_move_mod" value="0" step="1" title="Macro: @{NAME|basic_move_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_basic_move_points" value="0" step="5" title="Macro: @{NAME|basic_move_points}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_move_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-move move-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_move_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-basic-move">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_enhanced_ground_move_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-enhanced">Enhncd</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-enhanced-ground-move-tooltip">
Enhanced ground move. 
<br />
10pts per half level. Can use up|down arrow keys
<br />
Level: <span name="attr_enhanced_ground_move_multiple" value="0"></span>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_enhanced_ground_move" value="0" readonly="readonly" title="Macro: @{NAME|enhanced_ground_move}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_enhanced_ground_move_mod" value="0" step=".5" class="editable" title="Macro: @{NAME|enhanced_ground_move_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_enhanced_ground_move_points" value="0" step="10" class="editable" title="Macro: @{NAME|enhanced_ground_move_points}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_enhanced_ground_move_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-enhanced-ground-move enhanced-ground-move-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_enhanced_ground_move_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row margin-bottom row-dodge">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_dodge_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-dodge">Dodge</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-dodge-tooltip">
Dodge - Based on Basic Speed - Unmodified: <span name="attr_dodge_base" value="0"></span><br />
Combat Reflexes Modifier: <span name="attr_combat_reflexes_dodge_mod"></span><br />
Note: The Dodge score automatically adjusts for HP and/or FP loss below 1/3. (B419, B426)<br />
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_dodge" value="" readonly="readonly" title="Macro: @{NAME|dodge}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_dodge_mod" value="0" step="1" title="Macro: @{NAME|dodge_mod}" />
						<input type="hidden" name="attr_combat_reflexes_dodge_mod" value="-1" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_dodge_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-dodge dodge-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_dodge_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-lift-st hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_lifting_strength_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-lifting-strength">Lift ST</span>
						</div>
						<span class="tooltip">
							<input type="hidden" name="attr_lifting_points_per_level" value="3"/>
							<span data-i18n="attribute-lifting-strength-tooltip">
Lifting Strength (B65)<br />
Based on Strength <span name="attr_lifting_points_per_level"></span> pts/level<br />
Unmodified: <input class="sheet-inline" type="number" name="attr_lift_st_base" readonly="readonly" >
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_lift_st" value="0" readonly="readonly" title="Macro: @{NAME|lift_st}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_lift_st_mod" value="0" step="1" title="Macro: @{NAME|lift_st_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_lift_st_points" value="0" step="3" title="Macro: @{NAME|lift_st_points}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_lifting_strength_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-lifting-strength lifting-strength-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_lifting_strength_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row margin-bottom row-basic-lift">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-lift">Lift</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-basic-lift-tooltip">Basic Lift Table B17, in <span name="attr_weight_system"></span>. (B15)</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_basic_lift" value="0" readonly="readonly" title="Macro: @{NAME|basic_lift}" />
						<input type="hidden" name="attr_basic_lift_x2" value="0" />
					</div>
				</div> <!-- .row -->

				<div class="row row-strike-st hr">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_striking_strength_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-striking">Striking</span>
						</div>
						<span class="tooltip">
							<input type="hidden" name="attr_striking_points_per_level" value="5" />
							<span data-i18n="attribute-striking-strength-tooltip">
Striking Strength<br />
Based on Strength<br />
<span name="attr_striking_points_per_level"></span> pts/level<br />
Unmodified: <input class="sheet-inline" type="number" name="attr_striking_st_base" readonly="readonly" />
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_striking_st" value="0" readonly="readonly" title="Macro: @{NAME|striking_st}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_striking_st_mod" value="0" step="1" title="Macro: @{NAME|striking_st_mod}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_striking_st_points" value="0" step="5" title="Macro: @{NAME|striking_st_points}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_striking_strength_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-striking-strength striking-strength-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_striking_strength_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-thrust-damage">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-thrust">Thrust</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-thrust-damage-table">
								Thrust Damage<br />
								<div>See B16 for the complete table.</div>
								<table>
									<thead><tr><th>Strength</th><th>Thrust</th></tr></thead>
									<tbody>
										<tr><td>1</td><td>1d6-6</td></tr>
										<tr><td>2</td><td>1d6-6</td></tr>
										<tr><td>3</td><td>1d6-5</td></tr>
										<tr><td>4</td><td>1d6-5</td></tr>
										<tr><td>5</td><td>1d6-4</td></tr>
										<tr><td>6</td><td>1d6-4</td></tr>
										<tr><td>7</td><td>1d6-3</td></tr>
										<tr><td>8</td><td>1d6-3</td></tr>
										<tr><td>9</td><td>1d6-2</td></tr>
										<tr><td>10</td><td>1d6-2</td></tr>
										<tr><td>11</td><td>1d6-1</td></tr>
										<tr><td>12</td><td>1d6-1</td></tr>
										<tr><td>13</td><td>1d6</td></tr>
									</tbody>
								</table>
								<table>
									<thead><tr><th>Strength</th><th>Thrust</th></tr></thead>
									<tbody>
										<tr><td>14</td><td>1d6</td></tr>
										<tr><td>15</td><td>1d6+1</td></tr>
										<tr><td>16</td><td>1d6+1</td></tr>
										<tr><td>17</td><td>1d6+2</td></tr>
										<tr><td>18</td><td>1d6+2</td></tr>
										<tr><td>19</td><td>2d6-1</td></tr>
										<tr><td>20</td><td>2d6-1</td></tr>
										<tr><td>21</td><td>2d6</td></tr>
										<tr><td>22</td><td>2d6</td></tr>
										<tr><td>23</td><td>2d6+1</td></tr>
										<tr><td>24</td><td>2d6+1</td></tr>
										<tr><td>25</td><td>2d6+2</td></tr>
										<tr><td>26</td><td>2d6+2</td></tr>
									</tbody>
								</table>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_thrust" value="1d6-2" />
					</div>
					<div class="cell col4">
						<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
						<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Thrust Damage}} {{damageRoll=[[{@{thrust}, {0}}kh1]]}} {{damageType=Crushing (cr)}}" name="roll_dmgThrust" class="roll_damage" />
					</div>
				</div> <!-- .row -->

				<div class="row margin-bottom row-swing-damage">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-swing">Swing</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-swing-damage-table">
								Swing Damage<br />
								<div>See B16 for the complete table.</div>
								<table>
									<thead><tr><th>Strength</th><th>Swing</th></tr></thead>
									<tbody>
										<tr><td>1</td><td>1d6-5</td></tr>
										<tr><td>2</td><td>1d6-5</td></tr>
										<tr><td>3</td><td>1d6-4</td></tr>
										<tr><td>4</td><td>1d6-4</td></tr>
										<tr><td>5</td><td>1d6-3</td></tr>
										<tr><td>6</td><td>1d6-3</td></tr>
										<tr><td>7</td><td>1d6-2</td></tr>
										<tr><td>8</td><td>1d6-2</td></tr>
										<tr><td>9</td><td>1d6-1</td></tr>
										<tr><td>10</td><td>1d6</td></tr>
										<tr><td>11</td><td>1d6+1</td></tr>
										<tr><td>12</td><td>1d6+2</td></tr>
										<tr><td>13</td><td>2d6-1</td></tr>
									</tbody>
								</table>
								<table>
									<thead><tr><th>Strength</th><th>Swing</th></tr></thead>
									<tbody>
										<tr><td>14</td><td>2d6</td></tr>
										<tr><td>15</td><td>2d6+1</td></tr>
										<tr><td>16</td><td>2d6+2</td></tr>
										<tr><td>17</td><td>3d6-1</td></tr>
										<tr><td>18</td><td>3d6</td></tr>
										<tr><td>19</td><td>3d6+1</td></tr>
										<tr><td>20</td><td>3d6+2</td></tr>
										<tr><td>21</td><td>4d6-1</td></tr>
										<tr><td>22</td><td>4d6</td></tr>
										<tr><td>23</td><td>4d6+1</td></tr>
										<tr><td>24</td><td>4d6+2</td></tr>
										<tr><td>25</td><td>5d6-1</td></tr>
										<tr><td>26</td><td>5d6</td></tr>
									</tbody>
								</table>
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_swing" value="1d6" />
					</div>
					<div class="cell col4">
						<input type="hidden" name="attr_swing_damage_dice_icon" class="swing-damage-dice-icon" value="explode" />
						<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Swing Damage}} {{damageRoll=[[{@{swing}, {0}}kh1]]}} {{damageType=Crushing (cr)}}" name="roll_dmgSwing" class="roll_damage" />
					</div>
				</div> <!-- .row -->

				<div class="header">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell">
						<div class="popup">
							<span data-i18n="stress-derangement-label">Stress & Derangement</span>
						</div>
						<span class="tooltip">
							<span data-i18n="stress-derangement-tooltip">If using GURPS Horror, Stress and Derange (Derangement) affect Fright Checks. This is auto calculated depending on the values entered into MOD and Current.</span>
						</span>
					</div>
				</div>

				<div class="row row-stress">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
						&nbsp;
					</div>
					<div class="cell col1 label">
						<div class="popup">
							<span data-i18n="abbreviation-maximum-label">Max</span>
						</div>
						<span class="tooltip">
							<span data-i18n="maximum-stress-tooltip">The maximum value, which is auto calculated, is based on Will. Horror 142.</span>
						</span>
					</div>
					<div class="cell col2 label">
						<span data-i18n="abbreviation-modifier-label">Mod</span>
					</div>
					<div class="cell col3 label">
						<div class="popup">
							<span data-i18n="current-label">Current</span>
						</div>
						<span class="tooltip">
							<span data-i18n="current-stress-tooltip">Only enter negative values as per Horror 141-142. Additional negative values also come from failed Fright Checks.</span>
						</span>
					</div>
				</div> <!-- .row -->

				<div class="row row-stress">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_stress_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="attribute-stress">Stress</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-stress-tooltip">
Stress level from GURPS Horror Fourth Edition Edition.pdf page 141-142. When failing a Fright Check or other conditions the GM has exposed the character to.
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_stress_level_max" value="0" readonly="readonly" title="Macro: @{NAME|stress_level_max}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_stress_level_modifier" value="0" step="1" title="Macro: @{NAME|stress_level_modifier}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_stress_level" value="0" max="0" step="1" title="Macro: @{NAME|stress_level}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_stress_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-stress stress-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_stress_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-derangement">
					<div class="cell col-button">
						<input type="checkbox" name="attr_toggle_derangement_reason_modifier" class="toggle toggle-attribute-reason" title="View reason modifiers" value="1" />
						<span class="checkbox checkbox-attribute-reason small-font"></span>
					</div>
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="abbreviation-derangement">Derange</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-derangement-tooltip">
Derangement level from GURPS Fourth Edition Edition.pdf page 141-142. When going over the max level of Stress or failing a Sanity-Blasting Fright Check. 
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_derangement_level_max" value="0" readonly="readonly" title="Macro: @{NAME|derangement_level_max}" />
					</div>
					<div class="cell col2">
						<input type="number" name="attr_derangement_level_modifier" value="0" step="1" title="Macro: @{NAME|derangement_level_modifier}" />
					</div>
					<div class="cell col3">
						<input type="number" name="attr_derangement_level" value="0" max="0" step="1" title="Macro: @{NAME|derangement_level}" />
					</div>
				</div> <!-- .row -->

				<input type="hidden" name="attr_toggle_derangement_reason_modifier" value="0" />
				<div class="display-attribute-reasons">
					<div class="row row-derangement derangement-reasons">
						<div class="cell label">
							<div class="popup">
								<span data-i18n="reason-label">Reason</span>:
							</div>
							<span class="tooltip">
								<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
							</span>
						</div>
						<div class="cell">
							<input type="text" class="inline width-125 text-left" name="attr_derangement_modifier_reason" value="" />
						</div>
					</div>
				</div>

				<div class="row row-stress-derangement-penalty">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
					    <div class="popup">
							<span data-i18n="abbreviation-penalty-label">Pen</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-stress-derangement-penalty-tooltip">
The Fright Check Penalty, which is (Stess + Derangement)/2. This will automatically be applied to Fright Check.
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_stress_derangement_fright_check_penalty" value="0" readonly="readonly" title="Macro: @{NAME|stress_derangement_fright_check_penalty}" />
					</div>
					<div class="cell col2">
						&nbsp;
					</div>
					<div class="cell col3">
						&nbsp;
					</div>
				</div> <!-- .row -->

				<div class="row row-stress-derangement-penalty">
					<div class="cell col-button">&nbsp;</div>
					<div class="cell col0 label">
					    <div class="popup">
							<span data-i18n="abbreviation-disadvantages-label">Disadv.</span>
						</div>
						<span class="tooltip">
							<span data-i18n="attribute-stress-derangement-disadvantage-points-tooltip">
The amount of disadvantage points acrued due to derangement. At a certain point, these points should be converted to permanent mental disadvantages!
							</span>
						</span>
					</div>
					<div class="cell col1">
						<input type="number" name="attr_stress_derangement_disadvantage_points" value="0" max="0" step="1" title="Macro: @{NAME|stress_derangement_disadvantage_points}" />
					</div>
					<div class="cell col2">
						&nbsp;
					</div>
					<div class="cell col3">
						&nbsp;
					</div>
				</div> <!-- .row -->

			</div> <!-- .table -->
		</div> <!-- .box .attributes -->

		<div class="tab1-column2">

			<div class="hp-lift-container">

				<!-- HP, FP, ER, and Custom Pools -->
				<div class="box stats">
					<div class="table">
						<div class="header">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0">
								<span data-i18n="stats-title">Stats</span>
							</div>
							<div class="cell col1">
								<span data-i18n="value-title">Value</span>
							</div>
							<div class="cell col2">
								<span data-i18n="abbreviation-modifier-label">Mod</span>
							</div>
							<div class="cell col3">
								<span data-i18n="abbreviation-character-points-label">Pts</span>
							</div>
						</div> <!-- .header -->

						<div class="row row-hit-points">
							<div class="cell col-button">
								<input type="checkbox" name="attr_toggle_hit_points_reason_modifier" class="toggle toggle-attribute-reason shift-over" title="View reason modifiers" value="1" />
								<span class="checkbox checkbox-attribute-reason"></span>
							</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-maximum-hit-points">Max HP</span>
								</div>
								<span class="tooltip">
									<input type="hidden" name="attr_extra_hit_points_per_level" value="2" />
									<span data-i18n="maximum-hit-poits-tooltip">
Hit Points - Based on Strength - <span name="attr_extra_hit_points_per_level"></span> pts/level<br />
Cost reduced by -10% per SM+1 (B15)
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_hit_points_max" value="10" readonly="readonly" title="Macro: @{NAME|hit_points|max}" />
							</div>
							<div class="cell col2">
								<input type="number" name="attr_hit_points_mod" value="0" step="1" title="Macro: @{NAME|hit_points_mod}" />
							</div>
							<div class="cell col3">
								<input type="number" name="attr_hit_points_points" value="0" step="2" title="Macro: @{NAME|hit_points_points}" />
							</div>
						</div> <!-- .row -->

						<input type="hidden" name="attr_toggle_hit_points_reason_modifier" value="0" />
						<div class="display-attribute-reasons">
							<div class="row row-hit-points hit-points-reasons">
								<div class="cell label">
									<div class="popup">
										<span data-i18n="reason-label">Reason</span>:
									</div>
									<span class="tooltip">
										<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
									</span>
								</div>
								<div class="cell">
									<input type="text" class="inline width-125 text-left" name="attr_hit_points_modifier_reason" value="" />
								</div>
							</div>
						</div>

						<div class="row sub-row row-current-points">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-current-hit-points">Current HP</span>
								</div>
								<span class="tooltip">
									<span data-i18n="current-hit-points-tooltip">
Current Hit Points<br />
When your HP is low, you take penalties. (B419)
									</span>
									<table>
										<tbody>
										<tbody>
											<tr>
												<td class="label">
													<span data-i18n="current-hit-points-reeling">Reeling: If your HP is less than</span>
												</td>
												<td><input type="text" name="attr_hp_reeling" value="4" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="current-hit-points-reeling-description">
- Halve Move and Dodge (round up) (B419)<br />
- These effects are cumulative with FP loss. See GURPS FAQ: 3.4.5.7<br />												
- Note: This sheet automatically calculates that for you and adjusts those values.
													</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="current-hit-points-collapse">Verge of Collapse</span>
												</td>
												<td><input type="text" value="At 0 HP or less" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="current-hit-points-collaps-description">
- Roll every turn @{VS} HT or fall unconscious.<br />
- Your HT roll is at -1 for every 1xHP you are below 0.<br />
- If you do nothing, and don't defend, you don't have to roll.
													</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="current-hit-points-verge-of-death">Verge of Death</span>
												</td>
												<td><input type="text" name="attr_hp_verge" value="-10" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="current-hit-points-verge-of-death-description">
- Roll once @{VS} HT to stay alive.<br />
- If you fail by 1 or 2 you are mortally wounded, but not dead. (B423)<br />
- Roll again every time you take injury that puts you below<br />
another multiple of your max HP.
													</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="current-hit-points-death">Death</span>
												</td>
												<td><input type="text" name="attr_hp_death" value="-50" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="current-hit-points-death-description">- You are dead.</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="current-hit-points-total-destruction">Total Destruction</span>
												</td>
												<td><input type="text" name="attr_hp_destruction" value="-100" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="current-hit-points-total-destruction-description">- Your body has been destroyed beyond recognition or resurrection.</span>
												</td>
											</tr>
										</tbody>
									</table>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_hit_points" value="10" title="Macro: @{NAME|hit_points}" />
							</div>
							<div class="cell col2">
								<input type="hidden" class="hit-points-notes" name="attr_hit_points_notes" value="0" />
								<div class="hit-points-halved-dodge">
									<div class="popup">
										<b style="color:red;">½ <span data-i18n="attribute-move">Move</span></b>
									</div>
									<span class="tooltip">
										<span data-i18n="hit-points-half-move-tooltip">Move and Dodge is halved due to hit point loss. See B419.
										</span>
									</span>
								</div>
								<div class="hit-points-quartered-dodge">
									<div class="popup"><b style="color:red;">¼ <span data-i18n="attribute-move">Move</span></div>
									<span class="tooltip">
										<span data-i18n="hit-points-fatigue-quartered-move">Move and Dodge is quartered due to hit point and fatigue loss. See B419.</span>
									</span>
								</div>
							</div>
						</div> <!-- .row -->

						<div class="row row-fatigue-points">
							<div class="cell col-button">
								<input type="checkbox" name="attr_toggle_fatigue_points_reason_modifier" class="toggle toggle-attribute-reason shift-over" title="View reason modifiers" value="1" />
								<span class="checkbox checkbox-attribute-reason"></span>
							</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-maximum-fatigue-points">Max FP</span>
								</div>
								<span class="tooltip">
									<span data-i18n="maximum-fatigue-points-tooltip">
	Fatigue Points<br />
	Based on Health<br />
	3pts/level
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_fatigue_points_max" value="10" readonly="readonly" title="Macro: @{NAME|fatigue_points|max}" />
							</div>
							<div class="cell col2">
								<input type="number" name="attr_fatigue_points_mod" value="0" step="1" title="Macro: @{NAME|fatigue_points_mod}" />
							</div>
							<div class="cell col3">
								<input type="number" name="attr_fatigue_points_points" value="0" step="3" title="Macro: @{NAME|fatigue_points_points}" />
							</div>
						</div> <!-- .row -->

						<input type="hidden" name="attr_toggle_fatigue_points_reason_modifier" value="0" />
						<div class="display-attribute-reasons">
							<div class="row row-fatigue-points fatigue-points-reasons">
								<div class="cell label font-size-12">
									<div class="popup">
										<span data-i18n="reason-label">Reason</span>:
									</div>
									<span class="tooltip">
										<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
									</span>
								</div>
								<div class="cell">
									<input type="text" class="inline width-125 text-left" name="attr_fatigue_points_modifier_reason" value="" />
								</div>
							</div>
						</div>

						<div class="row sub-row row-current-points">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-current-fatigue-points">Current FP</span>
								</div>
								<span class="tooltip">
									<span data-i18n="current-fatigue-points-tool-tip">
Current Fatigue Points<br />
When your FP is low you take penalties. (B426)
									</span>
									<table>
										<tbody>
											<tr>
												<td class="label">
													<span data-i18n="fatigue-points-tired-label">Tired: If your FP is less than</span>
												</td>
												<td><input type="text" name="attr_fp_tired" value="4" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="fatigue-points-tired-description">
- Halve your Move, Dodge, and ST (round up) (B426)<br />
- These effects are cumulative with HP loss. See GURPS FAQ: 3.4.5.7<br />
- Note: This sheet automatically calculates that for you and adjusts<br />
those values – This does not affect ST-based quantities,<br />
such as HP and damage. (B426)
													</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="verge-of-collapse-label">Verge of Collapse</span>
												</td>
												<td><input type="text" value="At 0 FP or less" disabled="disabled"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="verge-of-collapse-description">
														- If you suffer further fatigue, each FP you lose also causes 1 HP of injury. (B426)<br />
														- Roll against Will to do anything besides rest or talk.<br />
														- If you fail your Will roll, you fall unconscious.<br />
														- On a critical failure, roll @{VS} HT or suffer a heart attack.
													</span>
												</td>
											</tr>
											<tr>
												<td class="label">
													<span data-i18n="unconscious-label">Unconscious: When your FP is</span>
												</td>
												<td><input type="text" name="attr_fp_unconscious" value="-10" readonly="readonly"></td>
											</tr>
											<tr>
												<td colspan="2">
													<span data-i18n="unconscious-description">
- Immediately fall unconscious<br />
- FP can't drop any lower, but you still lose HP.<br />
- You regain consciousness at 0 FP
													</span>
												</td>
											</tr>
										</tbody>
									</table>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_fatigue_points" value="10" title="Macro: @{NAME|fatigue_points}" />
							</div>
							<div class="cell col2">
								<input type="hidden" class="fatigue-points-notes" name="attr_fatigue_points_notes" value="0" />
								<div class="fatigue-points-halved-dodge">
									<div class="popup">
										<b style="color:red;">½ <span data-i18n="abbreviation-move-strength">MV/ST</span></b>
									</div>
									<span class="tooltip">
										<span data-i18n="half-move-strength-tooltip">
Move, Dodge, and ST are halved due to fatigue loss. See B426.<br />
Affects ST roll and using weapons with minimum ST.
										</span>
									</span>
								</div>
								<div class="fatigue-points-quartered-dodge">
									<div class="popup">
										<b style="color:red;">½ <span data-i18n="abbreviation-strength">ST</span></b>
									</div>
									<span class="tooltip">
										<span data-i18n="half-strength-tooltip">
ST is halved due to fatigue loss. See B426.<br />
Affects ST roll and using weapons with minimum ST.
										</span>
									</span>
								</div>
							</div>
						</div> <!-- .row -->

						<div class="row row-energy-points">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-maximum-energy-reserve">Max ER</span>
								</div>
								<span class="tooltip">
									<span data-i18n="maximum-energy-reserve-tooltip">
Energy Reserve<br />
See  Dungeon Fantasy 3, pg39 - Introduced<br />
See Powers, pg119 – More detailed<br />
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_energy_points_max" title="Macro: @{NAME|energy_points|max}" />
							</div>
							<div class="cell col2"></div>
							<div class="cell col3">
								<input type="number" name="attr_energy_points_points" value="0" step="3" title="Macro: @{NAME|energy_points_points}" />
							</div>
						</div> <!-- .row -->

						<div class="row sub-row row-current-points">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-current-energy-reserve">Current ER</span>
								</div>
								<span class="tooltip">
									<span data-i18n="current-energy-reserve-tooltip">
Current Energy Reserve<br />
See  Dungeon Fantasy 3, pg39 - Introduced<br />
See Powers, pg119 – More detailed
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_energy_points" value="0" title="Macro: @{NAME|energy_points}" />
							</div>
						</div> <!-- .row -->

						<div class="row hr">
							<div class="title custom-pools">
								<div class="popup">
									<span data-i18n="custom-pools-heading">Custom Pools</span>
								</div>
								<span class="tooltip">
									<span data-i18n="custom-pools-tooltip">
Add additional energy pools. Enter a name of the pool, max number points, cost in character points, and the current points of pool.<br />
Examples include:<br />
<strong>RP</strong> (Radiation Threshold Points), see After the End 1, p24. (ST + HT)/2, round down.<br />
<strong>LFP</strong> (Long Term Fatigue Points), see After the End 1, p24.
									</span>
								</span>
							</div>
							<div class="cell col0-custom-pool label">
								<input type="text" name="attr_user_pool1_name" title="Macro: @{NAME|user_pool1_name}" />
							</div>
							<div class="cell col1">
								<input type="number" name="attr_user_pool1_max" title="Macro: @{NAME|user_pool1|max}" />
							</div>
							<div class="cell col2"></div>
							<div class="cell col3">
								<input type="number" name="attr_user_pool1_points" value=0 title="Macro: @{NAME|user_pool1_points}" />
							</div>
						</div> <!-- .row -->

						<div class="row sub-row row-current-points">
							<div class="cell col-button">&nbsp;</div>
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="custom-pool-current-points-label">Current</span>
								</div>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_user_pool1" value="0" title="Macro: @{NAME|user_pool1}" />
							</div>
						</div> <!-- .row -->
						<div class="row">
							<div class="cell col0-custom-pool label">
								<input type="text" name="attr_user_pool2_name" title="Macro: @{NAME|user_pool2_name}" />
							</div>
							<div class="cell col1">
								<input type="number" name="attr_user_pool2_max" title="Macro: @{NAME|user_pool2|max}" />
							</div>
							<div class="cell col2"></div>
							<div class="cell col3">
								<input type="number" name="attr_user_pool2_points" value=0 title="Macro: @{NAME|user_pool2_points}" />
							</div>
						</div> <!-- .row -->
						<div class="row sub-row row-current-points padding-bottom">
							<div class="cell col0-custom-pool label">
								<div class="popup">
									<span data-i18n="custom-pool-current-points-label">Current</span>
								</div>
							</div>
							<div class="cell col1">
								<input type="number" name="attr_user_pool2" value="0" title="Macro: @{NAME|user_pool2}" />
							</div>
						</div> <!-- .row -->
					</div>
				</div>
				<!-- HP, FP, ER, and Custom Pools: end -->

				<!-- _____ _____ LIFTING BOX _____ _____ -->
				<div class="box lift">
					<div class="table">
						<div class="header">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="lifting-moving-label">Lifting & Moving</span>
								</div>
								<span class="tooltip">
									<span data-i18n="lifting-moving-tooltip">For more information see B14.</span>
								</span>
							</div>
							<div class="cell col1">
								<span name="attr_weight_system"></span>
							</div>
						</div> <!-- .header -->
						<div class="row row-simple-lift">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="simple-lift-label">Simple Lift</span>
								</div>
								<span class="tooltip">
									<span data-i18n="simple-lift-heading-tooltip">
The weight the character can lift overhead<br />
with one hand in one second.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_simple_lift" value="round(@{basic_lift})" disabled="disabled" title="Macro: @{NAME|simple_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row row-one-handed-lift">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="one-handed-lift-label">One-Handed Lift</span>
								</div>
								<span class="tooltip">
									<span data-i18n="one-handed-lift-tooltip">
The weight the character can lift overhead<br />
with one hand in two seconds.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_one_hand_lift" value="round(2 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|one_hand_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row row-two-handed-lift">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="two-handed-lift-label">Two-Handed Lift</span>
								</div>
								<span class="tooltip">
									<span data-i18n="two-handed-lift-tooltip">
The weight the character can lift overhead<br />
with both hands in four seconds.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_two_hand_lift" value="round(8 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|two_hand_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row row-shove-knock-over">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="shove-and-knock-over-label">Shove &amp; Knock Over</span>
								</div>
								<span class="tooltip">
									<span data-i18n="shove-and-knock-over-tooltip">
The weight of an object the character can<br />
shove and knock over.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_shove_lift" value="round(12 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|shove_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row row-running-shove-knock-over">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="abbreviation-running-shove-knock-over">Running Shove &amp; KO</span>
								</div>
								<span class="tooltip">
									<span data-i18n="running-shove-knock-over-tooltip">
The weight of an object the character can<br />
shove and knock over with a running start.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_run_shove_lift" value="round(24 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|run_shove_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row row-carry-on-back">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="carry-on-back-label">Carry On Back</span>
								</div>
								<span class="tooltip">
									<span data-i18n="carry-on-back-tooltip">
The weight the character can carry slung<br />
over his/her back.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_carry_back_lift" value="round(15 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|carry_back_lift}" />
							</div>
						</div> <!-- .row -->
						<div class="row margin-bottom row-shift-slightly">
							<div class="cell col0 label">
								<div class="popup">
									<span data-i18n="shift-slightly-label">Shift Slightly</span>
								</div>
								<span class="tooltip">
									<span data-i18n="shift-slightly-tooltip">
The weight of an object that the character<br />
can shift slightly on a floor.
									</span>
								</span>
							</div>
							<div class="cell col1">
								<input type="text" name="attr_shift_lift" value="round(50 * @{basic_lift})" disabled="disabled" title="Macro: @{NAME|shift_lift}" />
							</div>
						</div> <!-- .row -->
					</div> <!-- .table -->
				</div> <!-- .box .lift -->

			</div>

			<!-- _____ _____ GENERAL NOTES BOX _____ _____ -->
			<div class="box general-notes-box">
				
				<div class="table">
					
					<div class="header">
						<div class="cell">
							<span data-i18n="notes-label">Notes</span>
						</div>
					</div>
					
					<div class="notes">
						<div class="cell-col-100">
							<textarea name="attr_general_tab_notes"></textarea>
						</div>
					</div>
				</div>
			</div><!-- box general-notes-box -->

			<div class="container-encumbrance-move-feats">

			<!-- _____ _____ ENCUMBERANCE BOX - Original author(s) misspelled this throughout the file_____ _____ -->
			<!-- Note: Many of the Move and Dodge calculations were complicated, this was to allow for a Minimum Move of 1 and a Minimum Dodge of 1 -->
				<div class="box encumberance">
					<div class="table">
						<input type="checkbox" name="attr_toggle_encumbrance" class="toggle toggle-encumbrance" />
						<div class="header">
							<div class="cell col0">
								<div class="colToggle">
									<input type="checkbox" name="attr_toggle_encumbrance" class="toggle toggle-encumbrance" title="View encumbrance table." />
									<span class="checkbox checkbox-encumbrance"></span>
								</div>
								<span data-i18n="encumbrance-label">Encumbrance</span>
							</div>
							<div class="cell colAll">
								<span data-i18n="load-label">Load</span>
							</div>
							<div class="cell colAll">
								<div class="popup">
									<span data-i18n="attribute-move">Move</span>
								</div>
								<span class="tooltip">
									<span data-i18n="encumbrance-move-score-tooltip">
Note: The Move score automatically adjusts for Encumbrance<br />
and for HP and/or FP loss below 1/3. (B419, B426)					
									</span>
								</span>
							</div>
							<div class="cell colAll">
								<div class="popup">
									<span data-i18n="abbreviation-enhanced-move-label">ENH MOVE</span>
								</div>
								<span class="tooltip">
									<span data-i18n="enhanced-move-tooltip">Enhanced ground move.<br /><b>STEP:</b> The number in parentheses is the step distance.</span>
								</span>
							</div>
							<div class="cell colAll">
								<div class="popup">
									<span data-i18n="air-label">Air</span>
								</div>
								<span class="tooltip">
									<span data-i18n="air-tooltip">Air/Flying move.<br><b>STEP:</b> The number in parentheses is the step distance.</span>
								</span>
							</div>
							<div class="cell colAll">
								<div class="popup">
									<span data-i18n="water-label">Water</span>
								</div>
								<span class="tooltip">
									<span data-i18n="water-tooltip">Water/Swimming move.<br /><b>STEP:</b> The number in parentheses is the step distance.</span>
								</span>
							</div>
							<div class="cell colAll">
								<div class="popup">
									<span data-i18n="attribute-dodge">Dodge</span>
								</div>
								<span class="tooltip">
									<span data-i18n="encumbrance-dodge-tooltip">
Note: The Dodge score automatically adjusts for Encumbrance<br />
and for HP and/or FP loss below 1/3. (B419, B426)					
									</span>
								</span>
							</div>
						</div>
						<div class="encumbrance-table-body">
							<input type="hidden" name="attr_encumbrance_level" value="" />
							<div class="row row-encumberance-0">
								<div class="cell col0 label">
									<span data-i18n="encumbrance-none-0-label">None (0)</span>
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_lift_0" value="@{basic_lift}" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_0" value="@{basic_move}" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_0" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_0" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_0" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_0" value="@{dodge}" disabled="disabled" />
								</div>
							</div> <!-- .row -->
							<div class="row row-encumberance-1">
								<div class="cell col0 label">
									<span data-i18n="encumbrance-light-1-label">Light (1)</span>
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_lift_1" value="2 * @{basic_lift}" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_1" value="[[((1 + floor((@{basic_move} * 0.8))) + abs(1 - floor((@{basic_move} * 0.8)))) / 2]]" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_1" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_1" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_1" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_1" value="[[((1 + (@{dodge} - 1)) + abs(1 - (@{dodge} - 1))) / 2]]" disabled="disabled" />
								</div>
							</div> <!-- .row -->
							<div class="row row-encumberance-2">
								<div class="cell col0 label">
									<span data-i18n="encumbrance-medium-2-label">Medium (2)</span>
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_lift_2" value="floor(3 * @{basic_lift}*100)/100" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_2" value="[[((1 + floor((@{basic_move} * 0.6))) + abs(1 - floor((@{basic_move} * 0.6)))) / 2]]"  disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_2" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_2" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_2" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_2" value="[[((1 + (@{dodge} - 2)) + abs(1 - (@{dodge} -2))) / 2]]" disabled="disabled" />
								</div>
							</div> <!-- .row -->
							<div class="row row-encumberance-3">
								<div class="cell col0 label">
									<span data-i18n="encumbrance-heavy-3-label">Heavy (3)</span>
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_lift_3" value="floor(6 * @{basic_lift}*100)/100" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_3" value="[[((1 + floor((@{basic_move} * 0.4))) + abs(1 - floor((@{basic_move} * 0.4)))) / 2]]" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_3" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_3" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_3" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_3" value="[[((1 + (@{dodge} - 3)) + abs(1 - (@{dodge} -3))) / 2]]" disabled="disabled" />
								</div>
							</div> <!-- .row -->
							<div class="row row-encumberance-4">
								<div class="cell col0 label">
									<span data-i18n="encumbrance-extra-heavy-4-label">X-Heavy (4)</span>
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_lift_4" value="10 * @{basic_lift}" disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_4" value="[[((1 + floor((@{basic_move} * 0.2))) + abs(1 - floor((@{basic_move} * 0.2)))) / 2]]"  disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_4" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_4" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_4" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_4" value="[[((1 + (@{dodge} -4)) + abs(1 - (@{dodge} - 4))) / 2]]" disabled="disabled" />
								</div>
							</div> <!-- .row -->
							<!-- Yes I realize encumbrance is spelled wrong here but the original authors misspelled it throughout the file so I did the same to stay backwards compatible. -->	
							<div class="row margin-bottom row-encumberance-MAX">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="encumbrance-maximum-load-label">MAX Load*</span>
									</div>
									<span class="tooltip">
										<span data-i18n="encumbrance-maximum-load-tooltip">
Carry on Back (B353) 15xBL. Thus, you can carry<br />
more than you can lift by yourself . . . but<br />
every second that your encumbrance is over 10xBL<br />
(that is Extra-Heavy encumbrance), you lose 1 FP.<br />
										</span>
									</span>
								</div>
			
								<div class="cell colAll">
									<input type="text" name="attr_lift_5" value="15 * @{basic_lift}"  disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_move_5" value="[[((1 + floor((@{basic_move} * 0.2))) + abs(1 - floor((@{basic_move} * 0.2)))) / 2]]"  disabled="disabled" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_enhanced_move_5" value="" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_air_5" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_water_5" value="0" readonly="readonly" />
								</div>
								<div class="cell colAll">
									<input type="text" name="attr_dodge_5" value="[[((1 + (@{dodge} -4)) + abs(1 - (@{dodge} - 4))) / 2]]"disabled="disabled" />
								</div>
							</div> <!-- .row -->
						</div>
						<input type="checkbox" name="attr_toggle_turn_deceleration" class="toggle toggle-encumbrance" />
						<div class="row row-load hr">
							<div class="cell col0 current-label">
								<span data-i18n="current-label">Current</span> (<span name="attr_encumbrance_level" value=""></span>)
							</div>
							<div class="cell colAll">
								<input type="hidden" name="attr_total_weight" value="" />
								<input type="text" name="attr_total_weight_gravity" value="" readonly="readonly" title="Macro: @{NAME|total_weight_gravity}" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_current_move" value="" readonly="readonly" title="Macro: @{NAME|current_move}" />
								<input type="hidden" name="attr_current_ground_step" value="1" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_enhanced_move_current" value="0" readonly="readonly" title="Macro: @{NAME|enhanced_move_current}" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_current_air" value="0" readonly="readonly" title="Macro: @{NAME|current_air}" />
								<input type="hidden" name="attr_current_air_step" value="1" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_current_water" value="0" readonly="readonly" title="Macro: @{NAME|current_wate}" />
								<input type="hidden" name="attr_current_water_step" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_current_dodge" value="0" readonly="readonly" title="Macro: @{NAME|current_dodge}" />
							</div>
						</div> <!-- .row -->
						
					</div> <!-- .table -->
				</div><!-- box encumberance -->
				
				<!-- _____ _____ MOVEMENT FEATS _____ _____ -->		
				<div class="box movement-feats">
					
					<div class="turn-decelerate-container">
							
						<div class="row header">
							<div class="title">
								<span data-i18n="turning-and-velocity-modifiers-label">Turning and Velocity Modifiers</span>
							</div>
						</div>
						
						<div class="row">
							<div class="cell colAll label">
								<div class="popup" style="text-align:left;">
									<span data-i18n="movement-label">Movement</span>
								</div>
								<span class="tooltip">
									<span data-i18n="turning-velocity-movement-tooltip">Select movement type to determine turning radius and/or deceleration penalty.</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="abbreviation-start-velocity-label">Start Vel.</span>
								</div>
								<span class="tooltip">
									<span data-i18n="start-velocity-tooltip">Enter velocity (yards/second) for current turn.<br /><b>Important:</b> Be sure to check your max allowed velocity based on movement type.</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="change-in-velocity-label">Change</span>
								</div>
								<span class="tooltip">
									<span data-i18n="change-in-velocity-tooltip">Amount to accelerate or decelerate for the turn.</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="abbreviation-final-velocity-label">Final Vel.</span>
								</div>
								<span class="tooltip">
									<span data-i18n="final-velocity-tooltip">Final velocity. Current Velocity - Deceleration.<br />The final velocity is how you start the turn and is used to<br />calculate the deceleration penalty, turn radius, and tight turn penalty.</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="abbreviation-deceleration-penalty-label">Decel. Pen.</span>
								</div>
								<span class="tooltip">
									<span data-i18n="deceleration-penalty-tooltip">
Deceleration Skill penalty to DX roll or operation skill.<br />
<i>Example:</i> Moving 12/second, need to slow to 5/second, deceleration = 12 - 5 = 7.<br /> 
Can safely decelerate up to base move, no roll needed.<br />
If over safe deceleration, then make DX+3. If in vehicle, use operation skill + handling statistic.<br />
Apply the appropriate skill penalty from the input forms to the right.<br />
<b>How it works:</b> -1 per two full yards/second beyond Basic Move by which you cut your speed.<br />
<b>NOTE:</b> make an additional roll if you're also turning.<br />
<b>Example:</b> Car with move 3/57 traveling at 16 yards/second, needs to decelerate to 6 yards/second.<br />
Driving Skill: 12, Handling: 0.<br />
Total Deceleration = 16 - 6 = 10.<br />
Can safely decelerate to 16 - 3 (base move) = 13.<br />
Penalty = 13 - 6 (goal speed) / 2 = -3.<br />
Making Driving Skill 12 - 3 to succeed.<br />
see B395.
									</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="turn-radius-label">Turn Radius</span>
								</div>
								<span class="tooltip">
									<span data-i18n="turn-radius-tooltip">
Turn Radius. Minimum number of hexes to move before making a 60° facing change.<br />
Turn Radius = (Final Velocity / Base Move Score) rounded down.<br />
Example: Super Run = 6/24. Final Velocity = 18. Turn Radius = 18/6 = 3.<br />
See B394.
									</span>
								</span>
							</div>
							<div class="cell colAll label">
								<div class="popup" style="text-align:center;">
									<span data-i18n="tight-turn-label">Tight Turn</span>
								</div>
								<span class="tooltip">
									<span data-i18n="tight-turn-tooltip">
Tight Turn Skill Penalty. Allows you to make an additional facing change.<br />
120° facing change instead of 60°.<br />
Penalty = -1 per full increment of base move which your velocity exceeds your Basic Move.<br />
See B395.
									</span>
								</span>
							</div>
						</div> <!-- end row-->
						
						<div class="row">
							<div class="cell colAll">
								<select name="attr_turning_move_type" title="Field name: turning_move_type">
									<option value="Select" data-i18n="option-select">--Select--</option>
									<option value="Ground" data-i18n="option-ground">Ground</option>
									<option value="Air" data-i18n="option-air">Air</option>
									<option value="Water" data-i18n="option-water">Water</option>
								</select>
							</div>
							<div class="cell colAll">
								<input type="number" step="1" name="attr_start_velocity" value="0" title="Macro: @{NAME|start_velocity}" />
							</div>
							<div class="cell colAll">
								<input type="number" step="1" name="attr_change_velocity" value="0" title="Macro: @{NAME|change_velocity}" />
							</div>
							<div class="cell colAll">
							<input type="text" name="attr_final_velocity" value="0" title="Macro: @{NAME|final_velocity}" readonly="readonly" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_deceleration_penalty" value="0" title="Macro: @{NAME|deceleration_penalty}" readonly="readonly" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_turn_radius" value="0" title="Macro: @{NAME|turn_radius}" readonly="readonly" />
							</div>
							<div class="cell colAll">
								<input type="text" name="attr_tight_turn_penalty" value="0" title="Macro: @{NAME|tight_turn_penalty}" readonly="readonly" />
							</div>
						</div> <!-- end row-->
						
					</div> <!-- .end turning deceleration section -->
					
					<div class="table">
						<div class="header">
							<div class="title">
								<span data-i18n="movement-feats-label">Movement Feats</span>
							</div>
						</div>
					</div>
					<div class="container-feats">
						
						<!-- Flying Feat -->
						<div class="container-flying feats-child">
							<div class="row row-flight-advantage">
								<div class="column-header">
									<span data-i18n="flying-label">Flying</span>
								</div>
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="flight-label">Flight</span>
									</div>
									<div class="tooltip">
										<span data-i18n="flight-tooltip">
Check the box to add Flight (B56) to the character. <br />
This will update the Air movement column for the encumbrance table.<br />
Use the text box to enter the number of character points used for Flight
										</span>
									</div>
								</div>
								<div class="cell col1">
									<input type="checkbox" name="attr_flight_checked" value="1" class="boolean" title="Macro: @{NAME|flight_checked}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									<input type="number" name="attr_flight_points" value="0" class="editable" title="Macro: @{NAME|flight_points}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-air-move-label">Air Mv</span>
									</div>
									<span class="tooltip">
										<span data-i18n="air-move-tooltip">
Base Air Move = Basic Speed * 2 = <input class="sheet-inline" type="number" name="attr_basic_air_move_unmodified" readonly="readonly"><br />
2pts/level, you can use up and down arrows
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" name="attr_basic_air_move" value="0" readonly="readonly" title="Macro: @{NAME|basic_air_move}" />
								</div>
								<div class="cell col2">
									<input type="number" name="attr_basic_air_move_mod" value="0" step="1" class="editable" title="Macro: @{NAME|basic_air_move_mod}" />
								</div>
								<div class="cell col3">
									<input type="number" name="attr_basic_air_move_points" value="0" step="2" class="editable" title="Macro: @{NAME|basic_air_move_points}" />
								</div>
							</div> <!-- .row -->
							<div class="row margin-bottom row-enhanced-air">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-enhanced">Enhncd</span>
									</div>
									<span class="tooltip">
										<span data-i18n="enhanced-air-move-tooltip">
Enhanced Air Move<br />
Modifier box: steps of .5, you can use up and down arrows.<br />
Points box: 10 points per half-level, you can use up and down arrows.<br />
Each level doubles top air move. Half-level is a multiple of 1.5.<br />
Level: <span name="attr_enhanced_air_move_level" value="0"></span>
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" name="attr_enhanced_air_move" value="0" readonly="readonly" title="Macro: @{NAME|enhanced_air_move}" />
								</div>
								<div class="cell col2">
									<input type="number" name="attr_enhanced_air_level" value="0" step=".5" min="0" class="editable" title="Macro: @{NAME|enhanced_air_level}" />
								</div>
								<div class="cell col3">
									<input type="number" name="attr_enhanced_air_move_points" value="0" step="10" min="0" class="editable" title="Macro: @{NAME|enhanced_air_move_points}" />
								</div>
							</div> <!-- .row -->
						</div> <!-- .container-swimming -->
						
						<!-- Swimming Feat -->
						<div class="container-swimming feats-child">
							<div class="row row-flight-advantage">
								<div class="column-header">
									<span data-i18n="swimming-label">Swimming</span>
								</div>
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-amphibious-label">Amphib</span>
									</div>
									<div class="tooltip">
										<span data-i18n="amphibious-tooltip">
Amphibious: Check the box to apply Amphibious (B40) to character<br />
This will update the swimming movement on the encumbrance table.
										</span>
									</div>
								</div>
								<div class="cell col1">
									<input type="checkbox" name="attr_amphibious_checked" value="1" class="boolean" title="Macro: @{NAME|amphibious_checked}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									<input type="number" name="attr_amphibious_points" value="0" class="editable" title="Macro: @{NAME|amphibious_points}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-water-move-label">Wtr Mv</span>
									</div>
									<span class="tooltip">
										<span data-i18n="water-move-tooltip">
Basic Move = <input class="sheet-inline" type="number" name="attr_basic_water_move_unmodified" readonly="readonly" /><br />
Formula = Basic Move / 5 or Basic Move if amphibious.<br />
5pts/level, you can use up and down arrows.<br />
NOTE: Max +2 water move if you have swimming skill.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" name="attr_basic_water_move" value="0" readonly="readonly" title="Macro: @{NAME|basic_water_move}" />
								</div>
								<div class="cell col2">
									<input type="number" name="attr_basic_water_move_mod" value="0" step="1" class="editable" title="Macro: @{NAME|basic_water_move_mod}" />
								</div>
								<div class="cell col3">
									<input type="number" name="attr_basic_water_move_points" value="0" step="5" class="editable" title="Macro: @{NAME|basic_water_move_points}" />
								</div>
							</div> <!-- .row -->
							<div class="row margin-bottom row-enhanced-water">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-enhanced">Enhncd</span>
									</div>
									<span class="tooltip">
										<span data-i18n="enhanced-water-move-tooltip">
Enhanced Water Move<br />
Modifier box: steps of .5, you can use up and down arrows.<br />
Points box: 10 points per half-level, you can use up and down arrows.<br />
Each level doubles top water move. Half-level is a multiple of 1.5.<br />
Level: <span name="attr_enhanced_water_move_level" value="0"></span>
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" name="attr_enhanced_water_move" value="0" readonly="readonly" title="Macro: @{NAME|enhanced_water_move}" />
								</div>
								<div class="cell col2">
									<input type="number" name="attr_enhanced_water_level" value="0" step=".5" min="0" class="editable" title="Macro: @{NAME|enhanced_water_level}" />
								</div>
								<div class="cell col3">
									<input type="number" name="attr_enhanced_water_move_points" value="0" step="10" min="0" class="editable" title="Macro: @{NAME|enhanced_water_move_points}" />
								</div>
							</div> <!-- .row -->
						</div> <!-- .container-swimming -->
						
						<!-- Jumping Feat -->
						<div class="container-jumping feats-child">
							
							<div class="row row-flight-advantage">
								<div class="column-header">
									<span data-i18n="jumping-label">Jumping</span>
								</div>
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="skill-label">Skill</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jump-skill-tooltip">
Jump Skill: If entered, automatically calculates using Jump Skill/2 (rounded down)
instead of Basic Move to calculate jumping distances. B352
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_jump_skill" value="" class="editable" title="Macro: @{NAME|jump_skill}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									&nbsp;
								</div>
							</div> <!-- .row -->
							<div class="row row-flight-advantage">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="gravity-label">Gravity</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jump-gravity-tooltip">Affects jumping distance. See B350.</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" value="1" min="0" step=".01" name="attr_gravity" class="editable" title="Macro: @{NAME|gravity}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									&nbsp;
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-use-strength">Use ST</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jumping-use-strength-tooltip">
Check this box if using this <strong>Optional Rule</strong> B352.<br />
If Basic Lift (<input type="text" name="attr_display_jump_basic_lift" value="@{simple_lift}" disabled="disabled" class="sheet-textInline" />) 
> body weight, use ST/4 instead of Move or Jump skill.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="checkbox" name="attr_use_st_for_jump" value="1" class="boolean" title="Macro: @{NAME|use_st_for_jump}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									&nbsp;
								</div>
							</div> <!-- .row -->
							<div class="row row-enhanced-air">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="super-label">Super</span>
									</div>
									<span class="tooltip">
										<span data-i18n="super-jump-tooltip">
Super Jump: use this if you have the Super Jump as an Advantage. B89<br />
<strong>1st column</strong> will show your modifier based on the entries for the 2nd and 3rd columns. <br />
<strong>2nd column</strong> is the Modifier box: steps of 1, you can use the up and down arrows to change the value. <br />
<strong>3rd column</strong> is the Points box: 10points per level, you can use the up and down arrows to change the value. Each level doubles the jump distance.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" name="attr_super_jump_level" value="0" readonly="readonly" title="Macro: @{NAME|super_jump_level}" />
								</div>
								<div class="cell col2">
									<input type="number" name="attr_super_jump_entered_level" value="0" step="1" min="0" class="editable" title="Macro: @{NAME|super_jump_entered_level}" />
								</div>
								<div class="cell col3">
									<input type="number" name="attr_super_jump_points" value="0" step="10" min="0" class="editable" title="Macro: @{NAME|super_jump_points}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-encumbrance-label">Enc</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jump-encumbrance-penalty-tooltip">
Apply encumbrance penalty. See B352<br />
1 for None, 0.8 for Light, 0.6 for Medium, 0.4 for Heavy, and 0.2 for Extra-Heavy.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="checkbox" name="attr_jump_encumbrance" value="1" class="boolean" checked="checked" />
								</div>
								<div class="cell col2 title">&nbsp;</div>
								<div class="cell col3 title">&nbsp;</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-preparation">Prep</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jump-preparation-tooltip">
Check this box if you took 2 consecutive Concentration maneuvers to prepare. <br />
Leave unchecked otherwise, in which case you will halve all jump distances. B352
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="checkbox" name="attr_jump_concentration" value="1" class="boolean" title="Macro: @{NAME|jump_concentration}" />
								</div>
								<div class="cell col2 title">
									<span data-i18n="feet-measurement-label">feet</span>
								</div>
								<div class="cell col3 title">
									<span data-i18n="yards-measurement-label">yards</span>
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="standing-broad-jump-label">Broad</span>
									</div>
									<span class="tooltip">
										<span data-i18n="standing-broad-jump-tooltip">
Standing Broad Jump Distance. B352<br />
<strong>1st column</strong> will either show be (2 x Stat to use) – 3 feet or your Jump Skill/2 (rounded down). <br />
<strong>2nd column</strong> shows you how many feet you may jump. <br />
<strong>3rd column</strong> shows you how many yards you jump. <br />
Formula = (2 x Stat To use) - 3 feet<br />
Stat to use: <input type="text" name="attr_standing_broad_jump_stat_to_use" value="" readonly="readonly" class="sheet-textInline sheet-width-wide" />
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_broad_jump_base" value="0" readonly="readonly" title="Macro: @{NAME|broad_jump_base}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_broad_jump_distance_feet" value="0" readonly="readonly" title="Macro: @{NAME|broad_jump_distance_feet}" />
								</div>
								<div class="cell col3">
									<input type="text" name="attr_broad_jump_distance_yards" value="0" readonly="readonly" title="Macro: @{NAME|broad_jump_distance_yards}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="running-broad-jump-label">Run</span>
									</div>
									<span class="tooltip">
										<span data-i18n="running-broad-jump-tooltip">
Running Broad Jump Distance, under Broad Jump decryption. B352 <br />
<strong>1st column</strong> entery how may yards you ran this turn. <br />
<strong>2nd column</strong> shows you how many feet you may jump. <br />
<strong>3rd column</strong> shows you how many yard you jump. <br />
Formula = (2 x Stat To use) - 3 feet<br />
Stat to use: <input type="text" name="attr_running_broad_jump_stat_to_use" value="" readonly="readonly" class="sheet-textInline sheet-width-wide" /><br />
Max running broad jump distance is twice standing broad jump distance.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" step="1" name="attr_running_jump_yards_moved" value="0" class="editable" title="Macro: @{NAME|running_jump_yards_moved}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_running_jump_distance_feet" value="0" readonly="readonly" title="Macro: @{NAME|running_jump_distance_feet}" />
								</div>
								<div class="cell col3">
									<input type="text" name="attr_running_jump_distance_yards" value="0" readonly="readonly" title="Macro: @{NAME|running_jump_distance_yards}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="high-jump-label">High</span>
									</div>
									<span class="tooltip">
										<span data-i18n="high-jump-tooltip">
High Jump Distance. B352<br />
<strong>1st column</strong> will either be (6 x Stat to use) – 10 inches or your Jump Skill/2 (rounded down). <br />
<strong>2nd column</strong> shows you how many feet you may jump. <br />
<strong>3rd column</strong> shows you how many yard you jump. <br />
Formula = (6 x Stat To use) - 10 inches<br />
Stat to use: <input type="text" name="attr_standing_high_jump_stat_to_use" value="" readonly="readonly" class="sheet-textInline sheet-width-wide" />
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_high_jump_base" value="0" readonly="readonly" title="Macro: @{NAME|high_jump_base}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_high_jump_distance_feet" value="0" readonly="readonly" title="Macro: @{NAME|high_jump_distance_feet}" />
								</div>
								<div class="cell col3">
									<input type="text" name="attr_high_jump_distance_yards" value="0" readonly="readonly" title="Macro: @{NAME|high_jump_distance_yards}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-basic-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="run-high-jump-label">Run</span>
									</div>
									<span class="tooltip">
										<span data-i18n="running-high-jump-tooltip">
Running High Jump Distance, under High Jump. B352.<br />
<strong>1st column</strong> enter in your (6 x Stat To use) plus how may yards you ran this turn. <br />
<strong>2nd column</strong> shows how many feet you may jump straight up. <br />
<strong>3rd column</strong> shows how many yards you jump straight up. <br />
Formula = (6 x Stat To use) - 10 inches<br />
Stat to use: <input type="text" name="attr_running_high_jump_stat_to_use" value="" readonly="readonly" class="sheet-textInline sheet-width-wide" /><br />
Max running high jump distance is twice standing high jump distance.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="number" step="1" name="attr_running_high_jump_yards_moved" value="0" class="editable" title="Macro: @{NAME|running_high_jump_yards_moved}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_running_high_jump_distance_feet" value="0" readonly="readonly" title="Macro: @{NAME|running_high_jump_distance_feet}" />
								</div>
								<div class="cell col3">
									<input type="text" name="attr_running_high_jump_distance_yards" value="0" readonly="readonly" title="Macro: @{NAME|running_high_jump_distance_yards}" />
								</div>
							</div> <!-- .row -->
							<div class="row margin-bottom row-jump-move">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="abbreviation-jump-move-label">JMP MV</span>
									</div>
									<span class="tooltip">
										<span data-i18n="jump-move-tooltip">
Jump move. This is actually the ‘Super Jump’ value for that Advantage. See B89<br />
Greater of Broad Jump Yards / 5 OR Normal Ground Move.<br />
										</span>
									</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_jump_move_speed" value="0" readonly="readonly" title="Macro: @{NAME|jump_move_speed}" />
								</div>
								<div class="cell col2">
									&nbsp;
								</div>
								<div class="cell col3">
									&nbsp;
								</div>
							</div> <!-- .row -->
							
						</div> <!-- .container-jumping -->
						
					</div>
				</div><!-- box movement-feats -->

			</div><!-- container-encumbrance-move-feats -->

		</div><!-- tab1-column2 -->

		<!-- _____ _____ POINT SUMMARY BOX _____ _____ -->
		<div class="box points" style="float: left;">
			<div class="table">
				<input type="hidden" name="attr_toggle_unspent_points" class="toggle-unspoint-points" value="0" />
				<div class="header">
					<div class="popup">
						<span data-i18n="abbreviation-point-summary-label">Point Sum</span>
					</div>
					<span class="tooltip">
						<span data-i18n="point-summary-tooltip">
<strong>Total</strong>: Manual input: Represents total value of the<br />
PC in Character Points (spent & unspent combined).<br />
<strong>Spent</strong>: Automatic total of Spent points: <br />
Attributes + Traits + Skills + Other.<br/>
<strong>Unspent</strong>: Has the option of being Manual or<br/>
Automatic, depending on an option selected on the<br/>
Settings page entitled ‘Enter Unspent Points’.<br/>
Manual Mode (Blue color): You manually enter your<br/>
Unspent points.<br/>
Automatic mode (Black color): It calculates the<br/>
point total difference between Total and Spent.
						</span>
					</span>
				</div> <!-- .header -->

				<div class="row margin-bottom row-other">
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="total-label">Total</span>
						</div>
						<span class="tooltip">
							<span data-i18n="point-total-tooltip">
<strong>Total</strong>: Manual input: Represents total value of the<br/>
PC in Character Points (spent and unspent combined).
							</span>
						</span>	
					</div>
					<div class="cell col1">
						<input type="text" name="attr_total_points" value="150" title="Macro: @{NAME|total_points}" />
					</div>
				</div> <!-- .row -->

				<div class="row margin-bottom row-spent hr">
					<div class="cell col0 label">
						<span data-i18n="spent-label">Spent</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_point_summary" disabled="disabled" value="@{attribute_positive_total} + @{attribute_negative_total} + @{languages_points} + @{tl_pts} + @{cf_points} + @{racial_points} + @{advantages_points} + @{advantages_perks} + @{disadvantages_points} + @{disadvantages_quirks} + @{skills_points} + @{techniques_points} + @{techniques_revised_points} + @{spells_points} + @{misc_points_detailed}" title="Macro: @{NAME|point_summary}" />
					</div>
				</div> <!-- .row -->

				<div class="row margin-bottom row-total hr">
					<div class="cell col0 label">
						<span data-i18n="unspent-label">Unspent</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_point_diff" value="@{total_points} - (@{attribute_positive_total} + @{attribute_negative_total} + @{languages_points} + @{tl_pts} + @{cf_points} + @{racial_points} +  @{advantages_points} + @{advantages_perks} + @{disadvantages_points} + @{disadvantages_quirks} + @{skills_points} + @{techniques_points} + @{techniques_revised_points} + @{spells_points} + @{misc_points_detailed})" disabled="disabled" title="Macro: @{NAME|point_diff}" />
					</div>
				</div> <!-- .row -->

				<div class="row margin-bottom row-unspent hr">
					<div class="cell col0 label unspent-points-label">
						<span data-i18n="unspent-label">Unspent</span>
					</div>
					<div class="cell col1 unspent-points">
						<input type="text" name="attr_unspent_points" value="0" title="Macro: @{NAME|unspent_points}" />
					</div>
				</div> <!-- .row -->
				
				<input type="hidden" class="point-summary-layout" name="attr_point_summary_layout" value="4" />

				<!-- Point Summary GCA5 Format -->
				<div class="point-summary-gca5">

					<div class="row row-traits hr">
						<div class="cell title">
							<div class="popup">
								<span data-i18n="gca5-format-label">GCA5 Format</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gca5-format-tooltip">
	GURPS Character Assistant (GCA5) Format<br />
	To change to GCS or Detailed go to options tab<br />
	and change the radio button for <b>Point Summary Layout</b>
								</span>
							</span>
						</div>
					</div> <!-- .row -->

					<div class="row row-attributes">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="attributes-label">Attributes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="points-summary-for-attributes-tooltip">
	Point Summary for: <br />
	ST, DX, IQ, HT,<br />
	HP, FP, Energy Reserve One, Two, and Three,<br />
	Per, Vision, Hearing, Smell, Touch,<br />
	Will, Fright, Unconsciousness, Death,<br />
	Speed, Move, Lift ST, Striking ST,<br />
	Flying, Air Move, Enhanced Air Move, Super Jump
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_attribute_total_gca5" value="@{attribute_positive_total}" disabled="disabled" title="Macro: @{NAME|attribute_total_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-languages-label">Lang.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-languages-tooltip">Languages Point Summary</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_language_points_gca5" disabled="disabled" value="@{languages_points}" title="Macro: @{NAME|trait_advantages_language_points_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-cultural-familiarity">Culture</span>
							</div>
							<span class="tooltip">
								<span data-i18n="cultural-familiarities-label">Cultural Familiarities</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_cultural_familiarities_points_gca5" disabled="disabled" value="@{cf_points}" title="Macro: @{NAME|trait_advantages_language_points_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-advantages-label">Adv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gca5-point-summary-for-advantages-tooltip">
	Point Summary for the following trais with <b>Positive values</b>: <br />
	Tech Level,	Advantages, and Racial traits.
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_points_gca5" disabled="disabled" value="@{tech_level_points_advantage} + @{racial_points_advantage} + @{advantages_points}" title="Macro: @{NAME|trait_advantages_points_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="perks-label">Perks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_advantages_perks_display_gca5" disabled="disabled" value="@{advantages_perks}" title="Macro: @{NAME|advantages_perks_display_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-disadvantages-label">Disadv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-disadvantages-no-language-tooltip">Point Summary for Disadvantages, <b>NOT</b> including traits with negative values.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_disadvantages_points_gca5" disabled="disabled" value="@{disadvantages_points} + @{racial_points_disadvantage} + @{attribute_negative_total} + @{tech_level_points_disadvantage}" title="Macro: @{NAME|trait_disadvantages_points_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="quirks-label">Quirks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_disadvantages_quirks_display_gca5" disabled="disabled" value="@{disadvantages_quirks}" title="Macro: @{NAME|disadvantages_quirks_display_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="skills-label">Skills</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_skill_technique_points_gca5" disabled="disabled" value="@{skills_points} + @{techniques_points} + @{techniques_revised_points}" title="Macro: @{NAME|skill_technique_points_gca5}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="spells-label">Spells</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_spells_total_points_gca5" disabled="disabled" value="@{spells_points}" title="Macro: @{NAME|spell_total_points_gca5}" />
						</div>
					</div> <!-- .row -->

				</div><!-- End Point Summary GCA5 Format -->
				
				<!-- Point Summary GCA4 Format -->
				<div class="point-summary-gca4">

					<div class="row row-traits hr">
						<div class="cell title">
							<div class="popup">
								<span data-i18n="gca-format-label">GCA4 Format</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gca-format-tooltip">
	GURPS Character Assistant (GCA4) Format<br />
	To change to GCS or Detailed go to options tab<br />
	and change the radio button for <b>Point Summary Layout</b>
								</span>
							</span>
						</div>
					</div> <!-- .row -->

					<div class="row row-attributes">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="attributes-label">Attributes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="points-summary-for-attributes-tooltip">
	Point Summary for: <br />
	ST, DX, IQ, HT,<br />
	HP, FP, Energy Reserve One, Two, and Three,<br />
	Per, Vision, Hearing, Smell, Touch,<br />
	Will, Fright, Unconsciousness, Death,<br />
	Speed, Move, Lift ST, Striking ST,<br />
	Flying, Air Move, Enhanced Air Move, Super Jump
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_attribute_total_gca4" value="@{attribute_positive_total}" disabled="disabled" title="Macro: @{NAME|attribute_total_gca4}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-advantages-label">Adv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gca-point-summary-for-advantages-tooltip">
	Point Summary for: <br />
	Languages, Tech Level, Cultural Familiarities,<br />
	Advantages, and Racial traits.
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_points_gca4" disabled="disabled" value="@{language_points_advantage} + @{tech_level_points_advantage} + @{cf_points} + @{racial_points_advantage} + @{advantages_points}" title="Macro: @{NAME|trait_advantages_points_gca4}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="perks-label">Perks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_advantages_perks_display" disabled="disabled" value="@{advantages_perks}" title="Macro: @{NAME|advantages_perks_display}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-disadvantages-label">Disadv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-disadvantages-tooltip">Point Summary for Disadvantages, <b>NOT</b> including traits with negative values.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_disadvantages_points_gca4" disabled="disabled" value="@{disadvantages_points} + @{racial_points_disadvantage} + @{attribute_negative_total} + @{tech_level_points_disadvantage} + @{language_points_disadvantage}" title="Macro: @{NAME|trait_disadvantages_points_gca4}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="quirks-label">Quirks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_disadvantages_quirks_display_gca4" disabled="disabled" value="@{disadvantages_quirks}" title="Macro: @{NAME|disadvantages_quirks_display_gca4}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="skills-label">Skills</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_skill_technique_points_gca4" disabled="disabled" value="@{skills_points} + @{techniques_points} + @{techniques_revised_points}" title="Macro: @{NAME|skill_technique_points_gca4}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="spells-label">Spells</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_spells_total_points_gca4" disabled="disabled" value="@{spells_points}" title="Macro: @{NAME|spell_total_points_gca4}" />
						</div>
					</div> <!-- .row -->

				</div><!-- End Point Summary GCA4 Format -->
				
				<!-- Point Summary GCS Format -->
				<div class="point-summary-gcs">

					<div class="row row-traits hr">
						<div class="cell title">
							<div class="popup">
								<span data-i18n="gcs-format-label">GCS Format</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gcs-format-format-tooltip">
	GURPS Character Sheet (GCS) format<br />
	To change to GCA or Detailed go to options tab<br />
	and change the radio button for <b>Point Summary Layout</b>
								</span>
							</span>
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="race-label">Race</span>
							</div>
							<span class="tooltip">
								<span data-i18n="race-point-summary-tooltip">Point Summary for Racial Traits.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_racial_points_gcs" disabled="disabled" value="@{racial_points}" title="Macro: @{NAME|trait_racial_points_gcs}">
						</div>
					</div> <!-- .row -->

					<div class="row row-attributes">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="attributes-label">Attributes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="points-summary-for-attributes-tooltip">
	Point Summary for: <br />
	ST, DX, IQ, HT,<br />
	HP, FP, Energy Reserve One, Two, and Three,<br />
	Per, Vision, Hearing, Smell, Touch,<br />
	Will, Fright, Unconsciousness, Death,<br />
	Speed, Move, Lift ST, Striking ST,<br />
	Flying, Air Move, Enhanced Air Move, Super Jump
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_attribute_total_gcs" value="@{attribute_positive_total}" disabled="disabled" title="Macro: @{NAME|attribute_total_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-advantages-label">Adv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="gcs-point-summary-for-advantages-tooltip">
	Point Summary for: <br />
	Languages, Tech Level, Cultural Familiarities,<br />
	Advantages, and Perks.
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_points_gcs" disabled="disabled" value="@{language_points_advantage} + @{tech_level_points_advantage} + @{cf_points} + @{advantages_points} + @{advantages_perks}" title="Macro: @{NAME|trait_advantages_points_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-disadvantages-label">Disadv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-disadvantages-no-racial-cost-tooltip">Point Summary for Disadvantages, <b>NOT</b> including traits with negative values.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_disadvantages_points_gcs" disabled="disabled" value="@{disadvantages_points} + @{attribute_negative_total} + @{tech_level_points_disadvantage} + @{language_points_disadvantage}" title="Macro: @{NAME|trait_disadvantages_points_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="quirks-label">Quirks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_disadvantages_quirks_display_gcs" disabled="disabled" value="@{disadvantages_quirks}" title="Macro: @{NAME|disadvantages_quirks_display_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="skills-label">Skills</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_skill_technique_points_gcs" disabled="disabled" value="@{skills_points} + @{techniques_points} + @{techniques_revised_points}" title="Macro: @{NAME|skill_technique_points_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="spells-label">Spells</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_spells_total_points_gcs" disabled="disabled" value="@{spells_points}" title="Macro: @{NAME|spell_total_points_gcs}" />
						</div>
					</div> <!-- .row -->

				</div><!-- End Point Summary GCS Format -->

				<!-- Point Summary Detailed Format -->
				<div class="point-summary-detailed">

					<div class="row row-traits hr">
						<div class="cell title">
							<div class="popup">
								<span data-i18n="detailed-format-label">Detailed Format</span>
							</div>
							<span class="tooltip">
								<span data-i18n="detailed-format-tooltip">
	To change to GCA4 or GCS go to options tab<br />
	and change the radio button for <b>Point Summary Layout</b>
								</span>
							</span>
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="race-label">Race</span>
							</div>
							<span class="tooltip">
								<span data-i18n="race-point-summary-tooltip">Point Summary for Racial Traits.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_racial_points_detailed" disabled="disabled" value="@{racial_points}" title="Macro: @{NAME|trait_racial_points_detailed}">
						</div>
					</div> <!-- .row -->

					<div class="row row-attributes">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="attributes-label">Attributes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="points-summary-for-attributes-tooltip">
	Point Summary for: <br />
	ST, DX, IQ, HT,<br />
	HP, FP, Energy Reserve One, Two, and Three,<br />
	Per, Vision, Hearing, Smell, Touch,<br />
	Will, Fright, Unconsciousness, Death,<br />
	Speed, Move, Lift ST, Striking ST,<br />
	Flying, Air Move, Enhanced Air Move, Super Jump
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_attribute_total_detailed" value="@{attribute_positive_total}" disabled="disabled" title="Macro: @{NAME|attribute_total_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-advantages-label">Adv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="detailed-point-summary-for-advantages-tooltip">
	Point Summary for: <br />
	Languages, Tech Level, Cultural Familiarities,<br />
	and Advantages.
								</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_advantages_points_all_detailed" disabled="disabled" value="@{language_points_advantage} + @{tech_level_points_advantage} + @{cf_points} + @{advantages_points}" title="Macro: @{NAME|trait_advantages_points_all_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="perks-label">Perks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_advantages_perks_display_detailed" disabled="disabled" value="@{advantages_perks}" title="Macro: @{NAME|advantages_perks_display_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-disadvantages-label">Disadv.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-disadvantages-no-racial-cost-tooltip">Point Summary for Disadvantages, <b>NOT</b> including traits with negative values.</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_trait_disadvantages_points_detailed_detailed" disabled="disabled" value="@{disadvantages_points} + @{attribute_negative_total} + @{tech_level_points_disadvantage} + @{language_points_disadvantage}" title="Macro: @{NAME|trait_disadvantages_points_detailed_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-traits">
						<div class="cell col0 label">
							<span data-i18n="quirks-label">Quirks</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_disadvantages_quirks_display_detailed" disabled="disabled" value="@{disadvantages_quirks}" title="Macro: @{NAME|disadvantages_quirks_display_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="skills-label">Skills</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_skill_points_detailed" disabled="disabled" value="@{skills_points}" title="Macro: @{NAME|skill_points_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-techniques-label">Tech.</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-techniques-tooltip">Techniques</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_techniques_total_points_detailed" disabled="disabled" value="@{techniques_points}" title="Macro: @{NAME|techniques_total_points_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<div class="popup">
								<span data-i18n="abbreviation-techniques-revised-label">Tech. (r)</span>
							</div>
							<span class="tooltip">
								<span data-i18n="point-summary-for-techniques-revised-tooltip">Techniques Revised</span>
							</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_techniques_total_points_detailed" disabled="disabled" value="@{techniques_revised_points}" title="Macro: @{NAME|techniques_total_points_detailed}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-skills">
						<div class="cell col0 label">
							<span data-i18n="spells-label">Spells</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_spells_total_points_gcs" disabled="disabled" value="@{spells_points}" title="Macro: @{NAME|spell_total_points_gcs}" />
						</div>
					</div> <!-- .row -->

					<div class="row row-other">
						<div class="cell col0 label">
							<span data-i18n="other-label">Other</span>
						</div>
						<div class="cell col1">
							<input type="text" name="attr_misc_points_detailed" value="0" title="Macro: @{NAME|misc_points_detailed}" />
						</div>
					</div> <!-- .row -->

				</div><!-- End Point Summary Detailed Format -->
				
			</div> <!-- .table -->
		</div> <!-- box points -->

		</div>
	</div> <!-- tab1 -->

	<!-- ===== ===== ===== ===== TRAITS TAB ===== ===== ===== ===== -->
	<div class="tab2">

		<!-- _____ _____ LANGUAGE BOX _____ _____ -->

		<div class="box language">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<span data-i18n="native-language-label">Native Language</span>
					</div>
					<div class="cell col1">
						<span data-i18n="spoken-label">Spoken</span>
					</div>
					<div class="cell col1-pts">
						<div class="popup">
							<span data-i18n="modifier-abbreviation-label">Mod</span>
						</div>
						<span class="tooltip">
							<span data-i18n="language-cost-modifier-tooltip">Use this input box to modifier the number of Character Points for the selected language option.</span>
						</span>
					</div>
					<div class="cell col2">
						<span data-i18n="written-label">Written</span>
					</div>
					<div class="cell col2-pts">
						<div class="popup">
							<span data-i18n="modifier-abbreviation-label">Mod</span>
						</div>
						<span class="tooltip">
							<span data-i18n="language-cost-modifier-tooltip">Use this input box to modifier the number of Character Points for the selected language option.</span>
						</span>
					</div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
				</div> <!-- .header -->
				
				<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_toggle_native_language_notes" style="left: 30px;" />
				<span class="checkbox"></span>
					
				<div class="row row-native-language">
					<div class="cell col0 label">
						<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
						<input type="hidden" name="attr_native_language_idkey" />
						<input type="text" style="font-weight:bold;" name="attr_name_native_language" placeholder="-Enter Native Language here" title="Macro: @{NAME|name_native_language}" />
					</div>
					<div class="cell col1">
						<select name="attr_native_language_spoken" title="Macro: @{NAME|native_language_spoken}">
							<option value="0" selected><span data-i18n="option-native">Native</span><span> 0 CP</span></option>
							<option value="-1"><span  data-i18n="option-accented">Accented</span><span> -1 CP</span></option>
							<option value="-2"><span data-i18n="option-broken">Broken</span><span> -2 CP</span></option>
							<option value="-3"><span data-i18n="option-none">None</span><span> -3 CP</span></option>
						</select>
					</div>
					<div class="cell col1-pts">
						<input type="number" step="1" name="attr_native_language_spoken_mod_points" value="0" title="Macro: @{NAME|native_language_spoken_mod_points}" />
					</div>
					<div class="cell col2">
						<select name="attr_native_language_written" title="Macro: @{NAME|native_language_written}">
							<option value="0" selected><span data-i18n="option-native">Native</span><span> 0 CP</span></option>
							<option value="-1"><span data-i18n="option-literate">Literate</span><span> -1 CP</span></option>
							<option value="-2"><span data-i18n="option-semi-literate">Semi-literate</span><span> -2 CP</span></option>
							<option value="-3"><span data-i18n="option-none">None</span><span> -3 CP</span></option>
						</select>
					</div>
					<div class="cell col1-pts">
						<input type="number" step="1" name="attr_native_language_written_mod_points" value="0" title="Macro: @{NAME|native_language_written_mod_points}" />
					</div>
					<div class="cell col3">
						<input type="text" name="attr_native_language_points" value="@{native_language_spoken} + @{native_language_spoken_mod_points} + @{native_language_written} + @{native_language_written_mod_points}" disabled="disabled" title="Macro: @{NAME|native_language_points}" />
					</div>
				</div> <!-- .row -->

				<div class="melee-notebox">
						
					<div class="row">
						<div class="cell">
							<div>
								<span data-i18n="reason-for-mod-label">Reason for mod:</span><br />
								<textarea class="text-left reason-notes" name="attr_native_language_reason_mod" title="Macro: @{NAME|native_language_reason_mod}"></textarea>
							</div>
							<div>
								<span data-i18n="description-label">Description</span>:<br />
								<textarea class="text-left notes" name="attr_native_language_notes" title="Macro: @{NAME|native_language_notes}"></textarea>
							</div>
						</div>
					</div> <!-- .row -->
				</div>

				<div class="row">
					<div class="cell" style="width: 100%;">
						<label style="margin-bottom: 0px;">
							<input type="checkbox" class="talent-checkbox" name="attr_has_language_talent" value="1" />
							<div class="popup">
								<span style="font-size: 12px;" data-i18n="language-talent-label">Language Talent</span>
							</div>
							<div class="tooltip">
								<span data-i18n="language-talent-tooltip">If checked, you can learn languages at the next-highest level, if you spend 2 points on a langauge, instead of broken, you know the language at Accented level. This changes the available options in the drop-down and related costs. See B65.</span>
							</div>
						</label>
					</div>
				</div>
				<div class="header">
					<div class="cell col0">
						<span data-i18n="learned-language-label">Learned Languages</span>
					</div>
					<div class="cell col1">
						<span data-i18n="spoken-label">Spoken</span>
					</div>
					<div class="cell col1-pts">
						<div class="popup">
							<span data-i18n="modifier-abbreviation-label">Mod</span>
						</div>
						<span class="tooltip">
							<span data-i18n="language-cost-modifier-tooltip">Use this input box to modifier the number of Character Points for the selected language option.</span>
						</span>
					</div>
					<div class="cell col2">
						<span data-i18n="written-label">Written</span>
					</div>
					<div class="cell col2-pts">
						<div class="popup">
							<span data-i18n="modifier-abbreviation-label">Mod</span>
						</div>
						<span class="tooltip">
							<span data-i18n="language-cost-modifier-tooltip">Use this input box to modifier the number of Character Points for the selected language option.</span>
						</span>
					</div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
				</div> <!-- .header -->
				<input type="hidden" name="attr_has_language_talent" value="0" />
				<fieldset class="repeating_languages">
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_languages_$[row #]_name}" />
						</div>
						<div class="cell col1 language-select">
							<input type="hidden" name="attr_spoken_points" value="0" />
							<select name="attr_spoken" title="Macro: @{NAME|repeating_languages_$[row #]_spoken}">
								<option value="3"><span data-i18n="option-native">Native</span><span> 3 CP</span></option>
								<option value="2"><span data-i18n="option-accented">Accented</span><span> 2 CP</span></option>
								<option value="1"><span data-i18n="option-broken">Broken</span><span> 1 CP</span></option>
								<option value="0" selected><span data-i18n="option-none">None</span><span> 0 CP</span></option>
							</select>
							<select name="attr_spoken_talent" title="Macro: @{NAME|repeating_languages_$[row #]_spoken_talent}">
								<option value="2"><span data-i18n="option-native">Native</span><span> 2 CP</span></option>
								<option value="1"><span data-i18n="option-accented">Accented</span><span> 1 CP</span></option>
								<option value="0" selected><span data-i18n="option-none">None</span><span> 0 CP</span></option>
							</select>
						</div>
						<div class="cell col1-pts">
							<input type="number" step="1" name="attr_spoken_mod_points" value="0" title="Macro: @{NAME|repeating_languages_$[row #]_spoken_mod_points}" />
						</div>
						<div class="cell col2 language-select">
							<input type="hidden" name="attr_written_points" value="0" />
							<select name="attr_written" title="Macro: @{NAME|repeating_languages_$[row #]_written}">
								<option value="3"><span data-i18n="option-native">Native</span><span> 3 CP</span></option>
								<option value="2"><span data-i18n="option-literate">Literate</span><span> 2 CP</span></option>
								<option value="1"><span data-i18n="option-semi-literate">Semi-literate</span><span> 1 CP</span></option>
								<option value="0" selected><span data-i18n="option-none">None</span><span> 0 CP</span></option>
							</select>
							<select name="attr_written_talent" title="Macro: @{NAME|repeating_languages_$[row #]_written_talent}">
								<option value="2"><span data-i18n="option-native">Native</span><span> 2 CP</span></option>
								<option value="1"><span data-i18n="option-literate">Literate</span><span> 1 CP</span></option>
								<option value="0" selected><span data-i18n="option-none">None</span><span> 0 CP</span></option>
							</select>
						</div>
						<div class="cell col1-pts">
							<input type="number" step="1" name="attr_written_mod_points" value="0" title="Macro: @{NAME|repeating_languages_$[row #]_written_mod_points}" />
						</div>
						<div class="cell col3">
							<input type="text" name="attr_points" value="@{spoken_points} + @{written_points}" disabled="disabled" title="Macro: @{NAME|repeating_languages_$[row #]_points}" />
						</div>
					</div> <!-- .row -->
					
					<div class="melee-notebox">		
						<div class="row">
							<div class="cell">
								<div>
									<span data-i18n="reason-for-mod-label">Reason for mod:</span><br />
									<textarea class="text-left reason-notes" name="attr_reason_notes" title="Macro: @{NAME|repeating_languages_$[row #]_reason_notes}"></textarea>
								</div>
								<div>
									<span data-i18n="description-label">Description</span>:<br />
									<textarea class="text-left notes" name="attr_notes" title="Macro: @{NAME|repeating_languages_$[row #]_notes}"></textarea>
								</div>
							</div>
						</div> <!-- .row -->
					</div>
	
				</fieldset> <!-- .repeating_languages -->
			</div> <!-- .table -->
		</div> <!-- .box .language -->

		<!-- _____ _____ MISCELLENEOUS BOX _____ _____ -->
		<div class="box miscelleneous">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<div class="popup">
							<span data-i18n="technology-level-label">Tech Level</span>
						</div>
						<span class="tooltip">
							<span data-i18n="technology-level-tooltip">Tech Level Modifiers (B168), Tech Levels (B511-514)</span>
						</span>
					</div>
					<div class="cell col1">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
				</div> <!-- .header -->
				<div class="row row-tech-level">
					<div class="cell col0 label">
						<span data-i18n="campaign-technology-level-label">Campaign Tech Level</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_campaign_tl" title="Macro: @{NAME|campaign_tl}" />
					</div>
					<div class="cell col2">
						&nbsp;
					</div>
				</div> <!-- .row -->
				<div class="row row-tech-level">
					<div class="cell col0 label">
						<span data-i18n="your-technology-level-label">Your Tech Level</span>
					</div>
					<div class="cell col1">
						<input type="text" name="attr_tl" title="Macro: @{NAME|tl}" />
					</div>
					<div class="cell col2">
						<input type="number" step="5" name="attr_tl_pts" value="0" title="Macro: @{NAME|tl_pts}" />
					</div>
				</div> <!-- .row -->
			</div> <!-- .table -->
		</div> <!-- .box .miscelleneous -->

		<!-- _____ _____ CULTURE BOX _____ _____ -->

		<div class="box culture">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<div class="popup">
							<span data-i18n="cultural-familiarities-label">Cultural Familiarities</span>
						</div>
						<span class="tooltip">
							<span data-i18n="cultural-familiarities-tooltip">When dealing with an <i>unfamiliar</i> culture, you may suffer -3 to skill that a cultural component, such as Carousing, Detect Lies. (B23).</span>
						</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-character-points-label">Pts</span>
						</div>
						<span class="tooltip tooltip-skills-ref">
							<span data-i18n="cultural-point-cost">Native culture cost is 0. Otherwise cost is 1 or 2 (Consult with GM). (B23)</span>
						</span>
					</div>
				</div> <!-- .header -->

				<fieldset class="repeating_cultures">
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_culture_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_cultures_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" name="attr_points" title="Macro: @{NAME|repeating_cultures_$[row #]_points}" />
						</div>
					</div> <!-- .row -->

					<div class="melee-notebox">
						
						<div class="row">
							<div class="cell label">
								<textarea class="text-left notes" name="attr_notes" title="Macro: @{NAME|repeating_cultures_$[row #]_notes}"></textarea>
							</div>
						</div> <!-- .row -->
					</div>

				</fieldset> <!-- .repeating_cultures -->

			</div> <!-- .table -->
		</div> <!-- .box .culture -->

		<div class="clearfix"> </div>


		<!-- _____ _____ ADVANTAGES BOX _____ _____ -->
		<!-- this box uses the identifier "traits" for backwards compatibility -->

		<div class="box traits">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<span data-i18n="advantages-label">Advantages</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-level-label">LVL</span>
						</div>
						<span class="tooltip">
							<span data-i18n="trait-level-tooltip">Level of the trait.</span>
						</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-frequency-of-appearance-label">FOA</span>
						</div>
						<span class="tooltip">
							<span data-i18n="frequency-of-appearance-tooltip">
Frequency of Appearance<br />
<table>
	<tbody>
		<tr><td>15 or less><td></td>
		<tr><td>12 or less><td></td>
		<tr><td>9 or less><td></td>
		<tr><td>6 or less><td></td>
	</tbody>
</table>
							</span>
						</span>
					</div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->
				<fieldset class="repeating_traits">
					<input type="hidden" name="attr_foa" />
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_trait_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_traits_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" name="attr_trait_level" step="1" title="Macro: @{NAME|repeating_traits_$[row #]_trait_level}" />
						</div>
						<div class="cell col1">
							<input type="number" name="attr_foa" min="3" max="18" step="1" title="Macro: @{NAME|repeating_traits_$[row #]_foa}" />
						</div>
						<div class="cell col2">
							<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Frequency of Appearance Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=@{name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{foa} + @{modifier}]]}} {{notes=@{notes}}} {{showNotes=[[@{show_notes}]]}} {{bookReference=@{ref}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{customSuccessNote=@{success_notes}}} {{customCriticalSuccessNote=@{critical_success_notes}}} {{customFailNote=@{fail_notes}}} {{customCriticalFailNote=@{critical_fail_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsAFOA" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_points" title="Macro: @{NAME|repeating_traits_$[row #]_points}" />
						</div>
						<div class="cell col4">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_traits_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->

					<div class="melee-notebox">
						
						<div class="row">
							<div class="cell label full-width-margin-right-sm">
								<div class="show-notes">
									<input type="checkbox" name="attr_show_notes" value="1" />
									<span class="label">
										<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
									</span> 	
								</div>
								<textarea class="text-left full-width-margin-zero texbox-height-medium" name="attr_notes" title="Macro: @{NAME|repeating_traits_$[row #]_notes}"></textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="success-note-label">Success Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
	Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_success_notes" title="Macro: @{NAME|repeating_traits_$[row #]_success_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-success-note-label">Critical Success Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results.<br />
	Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_success_notes" title="Macro: @{NAME|repeating_traits_$[row #]_critical_success_notes}">The GM determines what happens to you. It is always something good! The lower the roll, the better **bonus** they give you. (B347)</textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="fail-note-label">Fail Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_fail_notes" title="Macro: @{NAME|repeating_traits_$[row #]_fail_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-fail-note-label">Critical Fail Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results.<br />
Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_fail_notes" title="Macro: @{NAME|repeating_traits_$[row #]_critical_fail_notes}">The GM determines what happens to you. It is always something bad - the higher the roll, the worse the result. (B348)</textarea>
							</div>
						</div> <!-- .row -->

					</div> <!-- .row -->

				</fieldset> <!-- .repeating_traits -->
			</div> <!-- .table -->
		</div> <!-- .box .traits -->


		<!-- _____ _____ PERKS BOX _____ _____ -->
		<!-- this box uses the identifier "traits" for backwards compatibility -->

		<div class="box traits perks-disadvantages">

			<!-- PERKS AREA -->
			<div class="table half-size border perks-area">

				<div class="header">
					<div class="cell col0">
						<span data-i18n="perks-label">Perks</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-frequency-of-appearance-label">FOA</span>
						</div>
						<span class="tooltip">
							<span data-i18n="frequency-of-appearance-tooltip">
Frequency of Appearance<br />
<table>
	<tbody>
		<tr><td>15 or less><td></td>
		<tr><td>12 or less><td></td>
		<tr><td>9 or less><td></td>
		<tr><td>6 or less><td></td>
	</tbody>
</table>
							</span>
						</span>
					</div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-spell-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->
				<fieldset class="repeating_perks">
					<input type="hidden" name="attr_foa" />
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_perks_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_perks_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" min="3" max="18" step="1" name="attr_foa" title="Macro: @{NAME|repeating_perks_$[row #]_foa}" />
						</div>
						<div class="cell col2">
							<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Frequency of Appearance Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=@{name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{foa} + @{modifier}]]}} {{notes=@{notes}}} {{showNotes=[[@{show_notes}]]}} {{bookReference=@{ref}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsAFOA" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_points" value="1" title="Macro: @{NAME|repeating_perks_$[row #]_points}" />
						</div>
						<div class="cell col4">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_perks_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					<div class="row row-details notebox">
						<div class="cell col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_perks_$[row #]_notes}"></textarea>
						</div>
					</div> <!-- .row -->
				</fieldset> <!-- .repeating_perks -->
			</div> <!-- .table -->
			<!-- END PERKS AREA -->
			
			<!-- QUIRKS AREA -->
			<div class="table half-size quirks-area">
				<div class="header">
					<div class="cell col0">
						<span data-i18n="quirks-label">Quirks</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-self-control-number-label">SCN</span>
						</div>
						<span class="tooltip">
							<span data-i18n="self-control-number-tooltip">
Self-control Number OR<br />
Frequency of Appearance<br />							
<table>
	<tbody>
		<tr><td>15 or less</td></tr>
		<tr><td>12 or less</td></tr>
		<tr><td>9 or less</td></tr>
		<tr><td>6 or less</td></tr>
	</tbody>
</table>
							</span>
						</span>
					</div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>	
				</div> <!-- .header -->
				<fieldset class="repeating_quirks">
					<input type="hidden" name="attr_control_rating" />
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_quirks_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_quirks_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" name="attr_control_rating" title="Macro: @{NAME|repeating_quirks_$[row #]_control_rating}" />
						</div>
						<div class="cell col2">
							<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Self-control Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=@{name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{control_rating} + @{modifier}]]}} {{notes=@{notes}}} {{showNotes=[[@{show_notes}]]}} {{bookReference=@{ref}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsDSCR" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_points" value="-1" title="Macro: @{NAME|repeating_quirks_$[row #]_points}" />
						</div>
						<div class="cell col4">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_quirks_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					<div class="row row-details notebox">
						<div class="cell col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_quirks_$[row #]_notes}"></textarea>
						</div>
					</div> <!-- .row -->
				</fieldset> <!-- .repeating_perks -->
			</div> <!-- .table -->
			<!-- END QUIRKS AREA -->

		</div> <!-- .box .traits -->


		<!-- _____ _____ DISADVANTAGES BOX _____ _____ -->

		<div class="box disadvantages perks-disadvantages">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<span data-i18n="disadvantages-label">Disadvantages</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-level-label">LVL</span>
						</div>
						<span class="tooltip">
							<span data-i18n="trait-level-tooltip">Level of the trait.</span>
						</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-self-control-number-label">SCN</span>
						</div>
						<span class="tooltip">
							<span data-i18n="self-control-number-tooltip">
Self-control Number OR<br />
Frequency of Appearance<br />							
<table>
	<tbody>
		<tr><td>15 or less</td></tr>
		<tr><td>12 or less</td></tr>
		<tr><td>9 or less</td></tr>
		<tr><td>6 or less</td></tr>
	</tbody>
</table>
							</span>
						</span>
					</div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>	
				</div> <!-- .header -->
				<fieldset class="repeating_disadvantages">
					<input type="hidden" name="attr_control_rating" />
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_disadvantage_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_disadvantages_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" step="1" name="attr_trait_level" title="Macro: @{NAME|repeating_disadvantages_$[row #]_trait_level}" />
						</div>
						<div class="cell col1">
							<input type="number" min="0" step="1" name="attr_control_rating" title="Macro: @{NAME|repeating_disadvantages_$[row #]_control_rating}" />
						</div>
						<div class="cell col2">
							<input type="hidden" name="attr_disadvantage_roll" value="@{roll}" />
							<button type="roll" value="@{disadvantage_roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Self-control Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=@{name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{control_rating} + @{modifier}]]}} {{notes=@{notes}}} {{showNotes=[[@{show_notes}]]}} {{bookReference=@{ref}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{customSuccessNote=@{success_notes}}} {{customCriticalSuccessNote=@{critical_success_notes}}} {{customFailNote=@{fail_notes}}} {{customCriticalFailNote=@{critical_fail_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsDSCR" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_points" title="Macro: @{NAME|repeating_disadvantages_$[row #]_points}" />
						</div>
						<div class="cell col4">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_disadvantages_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->

					<div class="melee-notebox">
						
						<div class="row">
							<div class="cell label full-width-margin-right-sm">
								<div>
									<div class="show-notes">
										<input type="checkbox" name="attr_show_notes" value="1" />
										<span class="label">
											<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
										</span> 	
									</div>
									<div class="show-notes">
										<input type="checkbox" name="attr_whisper_mode" value="1" />
										<span class="label">
											<span data-i18n="whisper-mode-label">Check to make the results a whisper to GM only.</span>
										</span> 	
									</div>
								</div>
								<textarea class="text-left full-width-margin-zero texbox-height-medium" name="attr_notes" title="Macro: @{NAME|repeating_disadvantages_$[row #]_notes}"></textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="success-note-label">Success Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
	Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_success_notes" title="Macro: @{NAME|repeating_disadvantages_$[row #]_success_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-success-note-label">Critical Success Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results.<br />
	Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_success_notes" title="Macro: @{NAME|repeating_disadvantages_$[row #]_critical_success_notes}">The GM determines what happens to you. It is always something good! The lower the roll, the better **bonus** they give you. (B347)</textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="fail-note-label">Fail Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_fail_notes" title="Macro: @{NAME|repeating_disadvantages_$[row #]_fail_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-fail-note-label">Critical Fail Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results.<br />
Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_fail_notes" title="Macro: @{NAME|repeating_disadvantages_$[row #]_critical_fail_notes}">The GM determines what happens to you. It is always something bad - the higher the roll, the worse the result. (B348)</textarea>
							</div>
						</div> <!-- .row -->

					</div> <!-- .row -->

				</fieldset> <!-- .repeating_disadvantages -->
			</div> <!-- .table -->
		</div> <!-- .box .disadvantages -->

		<!-- _____ _____ RACIAL Traits BOX _____ _____ -->

		<div class="box racial">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<span data-i18n="racial-traits-label">Racial Traits</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-level-label">LVL</span>
						</div>
						<span class="tooltip">
							<span data-i18n="trait-level-tooltip">Level of the trait.</span>
						</span>
					</div>
					<div class="cell col1">
						<div class="popup">
							<span data-i18n="abbreviation-self-control-number-label">SCN</span>
						</div>
						<span class="tooltip">
							<span data-i18n="self-control-number-tooltip">
Self-control Number OR<br />
Frequency of Appearance<br />							
<table>
	<tbody>
		<tr><td>15 or less</td></tr>
		<tr><td>12 or less</td></tr>
		<tr><td>9 or less</td></tr>
		<tr><td>6 or less</td></tr>
	</tbody>
</table>
							</span>
						</span>
					</div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->
				<div class="row">
					<div class="cell col-race">
						 <b><span data-i18n="race-label">Race</span>:</b> <input type="text" name="attr_race" title="Macro: @{NAME|race}" />
					</div>
					<div class="cell col1"></div>
					<div class="cell col1"></div>
					<div class="cell col2"></div>
					<div class="cell col3">
						<input type="text" name="attr_trait_racial_points" disabled="disabled" value="@{racial_points}" title="Macro: @{NAME|trait_racial_points}" />
					</div>
					<div class="cell col4">
						<input type="text" name="attr_race_ref" title="Macro: @{NAME|race_ref}" />
					</div>
				</div> 
				<div class="row">
					<div class="cell col-template">
						 <b><span data-i18n="templates-label">Templates</span>:</b> <input type="text" name="attr_template_names" title="Macro: @{NAME|templates_names}" />
					</div>
					<div class="cell col1"></div>
					<div class="cell col1"></div>
					<div class="cell col2"></div>
					<div class="cell col3"></div>
					<div class="cell col4"></div>
				</div> <!-- .header -->
				<fieldset class="repeating_racial">
					<input type="hidden" name="attr_control_rating" />
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_racial_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
							<input type="hidden" name="attr_idkey" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_racial_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="number" step="1" name="attr_trait_level" title="Macro: @{NAME|repeating_racial_$[row #]_trait_level}" />
						</div>
						<div class="cell col1">
							<input type="number" min="1" step="1" name="attr_control_rating" title="Macro: @{NAME|repeating_racial_$[row #]_control_rating}" />
						</div>
						<div class="cell col2">
							<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Self-control Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=@{name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{control_rating} + @{modifier}]]}} {{notes=@{notes}}} {{showNotes=[[@{show_notes}]]}} {{bookReference=@{ref}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{customSuccessNote=@{success_notes}}} {{customCriticalSuccessNote=@{critical_success_notes}}} {{customFailNote=@{fail_notes}}} {{customCriticalFailNote=@{critical_fail_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsRSCR" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_points" title="Macro: @{NAME|repeating_racial_$[row #]_points}" />
						</div>
						<div class="cell col4">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_racial_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					
					<div class="melee-notebox">
						
						<div class="row">
							<div class="cell label full-width-margin-right-sm">
								<div class="show-notes">
									<input type="checkbox" name="attr_show_notes" value="1" />
									<span class="label">
										<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
									</span> 	
								</div>
								<textarea class="text-left full-width-margin-zero texbox-height-medium" name="attr_notes" title="Macro: @{NAME|repeating_racial_$[row #]_notes}"></textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="success-note-label">Success Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
	Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_success_notes" title="Macro: @{NAME|repeating_racial_$[row #]_success_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-success-note-label">Critical Success Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-success-notes-tooltip">
	<strong>Hint:</strong> Enter inline rolls for additional results.<br />
	Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_success_notes" title="Macro: @{NAME|repeating_racial_$[row #]_critical_success_notes}"></textarea>
							</div>
						</div> <!-- .row -->

						<div class="row success-fail-notes">
							<div class="cell">
								<div class="popup">
									<span data-i18n="fail-note-label">Fail Note</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
Example: Select Location: ?{Location|Head|Torso}
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_fail_notes" title="Macro: @{NAME|repeating_racial_$[row #]_fail_notes}"></textarea>
							</div>
							<div class="cell">
								<div class="popup">
									<span data-i18n="critical-fail-note-label">Critical Fail Notes</span>
								</div>
								<span class="tooltip">
									<span data-i18n="advantage-critical-fail-notes-tooltip">
<strong>Hint:</strong> Enter inline rolls for additional results.<br />
Example: Does an additional [[1d6]] fire damage.
									</span>
								</span>
								<textarea class="text-left chat-size" name="attr_critical_fail_notes" title="Macro: @{NAME|repeating_racial_$[row #]_critical_fail_notes}"></textarea>
							</div>
						</div> <!-- .row -->

				</fieldset> <!-- .repeating_racial -->
			</div> <!-- .table -->
		</div> <!-- .box .racial -->

	</div> <!-- .tab2 -->

	<!-- ===== ===== ===== ===== MISCELLANEOUS TAB ===== ===== ===== ===== -->
	<div class="tab-misc">

		<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
		<div class="tabbed">
				
			<!-- tabs -->
			<label>
				<input type="radio" name="attr_bio_tabs" value="bio" class="tab-control" checked />
				<span data-i18n="abbrevation-biography-label">Bio</span>
			</label>
			<label>
				<input type="radio" name="attr_bio_tabs" value="reactions" class="tab-control" />
				<span data-i18n="reactions-label">Reactions</span>
			</label>
			<label>
				<input type="radio" name="attr_bio_tabs" value="training" class="tab-control" />
				<span data-i18n="training-label">Training</span>
			</label>
			<label>
				<input type="radio" name="attr_bio_tabs" value="campaign" class="tab-control" />
				<span data-i18n="campaign-label">Campaign</span>
			</label>

			<!-- tabbed section to display | value changes based on selected radio button -->
			<input type="hidden" name="attr_bio_tabs" value="bio" />
			<div class="tabs">

				<div class="bio">
										
					<!-- _____ _____ GENERAL BIO BOX _____ _____ -->
					<div class="box general-bio">

						<div class="table">
							<div class="header">
								<div class="cell col0">
									<span data-i18n="general-information-label">General Information</span>
								</div>
							</div> <!-- .header -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="full-name-label">Full name</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_fullname" title="Macro: @{NAME|fullname}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="player-name-label">Player name</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_playername" title="Macro: @{NAME|playername}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="nickname-label">Nickname</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_nickname" title="Macro: @{NAME|nickname}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="race-label">Race</span>
								</div>
								<div class="cell col0">
									<input type="text" name="attr_race" title="Macro: @{NAME|race}" />
								</div>
								<div class="cell col-label label">
									<span data-i18n="gender-label">Gender</span>
								</div>
								<div class="cell col0">
									<input type="text" name="attr_gender" title="Macro: @{NAME|gender}" />
								</div>
								<div class="cell col-main-hand label">
									<span data-i18n="main-hand-label">Main Hand</span>
								</div>
								<div class="cell col-label">
									<input type="text" name="attr_hand" title="Macro: @{NAME|hand}" />
								</div>
							</div> <!-- .row -->
							
							<div class="row">
								
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="size-modifier-label">Size Modifier</span>
									</div>
									<span class="tooltip">
										<span data-i18n="size-modifier-tooltip">For more information see B15, B16, <strong>B19</strong>. <b>Note:</b> use the <i>Apply</i> checkbox to use Size Modify limitations to Strength and Extra Hit Points.</span>
									</span>
								</div>
								<div class="cell col-half">
									<input type="number" name="attr_size" value="0" title="Macro: @{NAME|size}" />
								</div>

								<div class="cell col-apply-size-modifier label">
									<div class="popup">
										<span data-i18n="apply-label">Apply</span>
									</div>
									<span class="tooltip">
										<span data-i18n="apply-size-modifier-tooltip">If checked, character point costs for Strength and Hit Points will be modified.<br />See B15, B16, <strong>B19</strong></span>
									</span>
								</div>
								<div class="cell col-input">
									<input type="checkbox" name="attr_apply_size_modifier" value="1" title="Macro: @{NAME|apply_size_modifier}" />
								</div>

								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="reach-modifier-label">Reach Mod</span>
									</div>
									<span class="tooltip">
										<span data-i18n="reach-modifier-tooltip">Reach Modifier.<br />See Size Modifier and Reach, B402<br />When grappling, you get +1 To Hit per size modifier difference.</span>
									</span>
								</div>
								<div class="cell col-input">
									<input type="number" name="attr_reach" value="0" readonly="readonly" title="Macro: @{NAME|reach}" />
								</div>

								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="close-reach-label">Has <span class="sheet-emphatic">C</span> Reach</span>
									</div>
									<span class="tooltip">
										<span data-i18n="close-reach-tooltip">If checked, a reach <span class="sheet-emphatic">C</span> weapon increases to reach 1, but no other effects.<br />See Size Modifier and Reach, B402</span>
									</span>
								</div>
								<div class="cell col-input">
									<input type="checkbox" name="attr_is_close_reach" title="Macro: @{NAME|is_close_reach}" />
								</div>

							</div> <!-- .row -->

							<div class="row row-textarea-reactions">
								<div class="cell col0 label">
									<span data-i18n="notes-label">Notes</span>
								</div>
								<div class="cell col1">
									<textarea name="attr_general_information_notes" title="Macro: @{NAME|general_information_notes}"></textarea>
								</div>
							</div> <!-- .row -->
							
						</div> <!-- .table -->
					</div> <!-- .box .general-bio -->
					
					<!-- _____ _____ DESCRIPTION BOX _____ _____ -->
					<div class="box bio-description">
						<div class="table">
							<div class="header">
								<div class="cell col0">
									<span data-i18n="physical-description-label">Physical Description</span>
								</div>
							</div> <!-- .header -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="age-label">Age</span>
								</div>
								<div class="cell col-input">
									<input type="text" name="attr_age" title="Macro: @{NAME|age}" />
								</div>
								<div class="cell col-small label">
									<span data-i18n="height-label">Height</span>
								</div>
								<div class="cell col-height">
									<input type="text" name="attr_height" title="Macro: @{NAME|height}" />
								</div>
								<div class="cell col-small label">
									<div class="popup">
										<span data-i18n="weight-heading">Weight</span>
									</div>
									<span class="tooltip">
										<span data-i18n="character-weight-tooltip">
			Enter a <strong>Numerical Value</strong> only.<br/>
			Do not enter any type of indicator like lbs, pounds, kilos, etc.<br/>
			This is because the weight is added to your Inventory’s Grand Total<br/>
			Weight and thus needs to be numerical.
										</span>
									</span>
								</div>
								<div class="cell col-height">
									<input type="number" name="attr_weight" title="Macro: @{NAME|weight}" />
								</div>
								<div class="cell col-small">
									<input type="hidden" name="attr_use_metric" />
									<span class="pounds" data-i18n="abbrevation-pounds-label">lbs</span>
									<span class="kilagrams" data-i18n="abbrevation-kilagrams-label">kg</span>
								</div>
							</div> <!-- .row -->

							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="build-label">Build</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_build" title="Macro: @{NAME|build}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="hair-label">Hair</span>
									</div>
									<span class="tooltip">
										<span data-i18n="physical-color-tooltip">Enter the Color(s)</span>
									</span>
								</div>
								<div class="cell col-large">
									<input type="text" name="attr_hair" title="Macro: @{NAME|hair}" />
								</div>
								<div class="cell col-small label">
									<div class="popup">
										<span data-i18n="eyes-label">Eyes</span>
									</div>
									<span class="tooltip">
										<span data-i18n="physical-color-tooltip">Enter the Color(s)</span>
									</span>
								</div>
								<div class="cell col-med-small">
									<input type="text" name="attr_eyes" title="Macro: @{NAME|eyes}" />
								</div>
								<div class="cell col-small label">
									<div class="popup">
										<span data-i18n="skin-label">Skin</span>
									</div>
									<span class="tooltip">
										<span data-i18n="physical-color-tooltip">Enter the Color(s)</span>
									</span>
								</div>
								<div class="cell col-med-small">
									<input type="text" name="attr_skin" title="Macro: @{NAME|skin}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-textarea">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="physical-appearance-label">Appearance</span>
									</div>
									<span class="tooltip">
										<span data-i18n="physical-appearance-tooltip">
			The appearance drop-down is for reference. If 
			there's a point cost, please enter your appearance and cost on
			the Traits tab under Advantages or Disadvantages.
										</span>
									</span>
								</div>
								<div class="cell col1">
									<select name="attr_appearance" title="Macro: @{NAME|appearance}">
										<option value="-24" data-i18n="option-horrific">Horrific (-6)</option>
										<option value="-20" data-i18n="option-monstrous">Monstrous (-5)</option>
										<option value="-16" data-i18n="option-hideous">Hideous (-4)</option>
										<option value="-8" data-i18n="option-ugly">Ugly (-2)</option>
										<option value="-4" data-i18n="option-unattractive">Unattractive (-1)</option>
										<option value="0" data-i18n="option-average" selected="selected">Average</option>
										<option value="4" data-i18n="option-attractive">Attractive (+1)</option>
										<option value="12" data-i18n="option-handsome-beautiful">Handsome/Beautiful (+4/2)</option>
										<option value="16" data-i18n="option-very-handsome-beautiful">Very Handsome/Beautiful (+6/2)</option>
										<option value="20" data-i18n="option-transcendent">Transcendent (+8/2)</option>
									</select>
									<textarea name="attr_general_appearance" title="Macro: @{NAME|general_appearance}"></textarea>
								</div>
							</div> <!-- .row -->
							<div class="row row-textarea-features">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="tattoos-scars-etc-label">Tattoos, scars, etc.</span>
									</div>
									<span class="tooltip">
										<span data-i18n="scars-tattooe-etc-tooltip">Scars, tattoos, distinguishing marks or features.</span>
									</span>
								</div>
								<div class="cell col1 textarea-container">
									<textarea name="attr_distinguishing_features" title="Macro: @{NAME|distinguishing_features}"></textarea>
								</div>
							</div> <!-- .row -->
						</div> <!-- .table -->
					</div> <!-- .box .bio-description -->
					
					<!-- _____ _____ BACKGROUND INFO BOX _____ _____ -->
					<div class="box background-info">
						<div class="table">
							<div class="header">
								<div class="cell col0">
									<span data-i18n="background-information-label">Background Information</span>
								</div>
							</div> <!-- .header -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="birth-date-label">Birth Date</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_birth_date" title="Macro: @{NAME|birth_date}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="birth-place-label">Birth Place</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_birth_place" title="Macro: @{NAME|birth_place}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="homeworld-label">Homeworld</span>
								</div>
								<div class="cell col2">
									<input type="text" name="attr_homeworld" title="Macro: @{NAME|homeworld}" />
								</div>
								<div class="cell col-label label">
									<div class="popup">
										<span data-i18n="gravity-rating-label">G Rating</span>
									</div>
									<span class="tooltip">
										<span data-i18n="gravity-rating-tooltip">Enter the Surface Gravity of your Homeworld. SPACE 84 and B350.</span>
									</span>
								</div>
								<div class="cell col-main-hand">
									<input type="number" name="attr_homeworld_gravity_rating" title="Macro: @{NAME|homeworld_gravity_rating}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="status-label">Status</span>
								</div>
								<div class="cell col-input">
									<input type="text" name="attr_status" title="Macro: @{NAME|status}" />
								</div>
								<div class="cell col-small label">
									<span data-i18n="wealth-label">Wealth</span>
								</div>
								<div class="cell col-med">
									<input type="text" name="attr_wealth" title="Macro: @{NAME|wealth}" />
								</div>
								<div class="cell col-med label">
									<span data-i18n="cost-of-living">Cost of Living</span>
								</div>
								<div class="cell col-main-hand">
									<input type="text" name="attr_cost_of_living" title="Macro: @{NAME|cost_of_living}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="income-label">Income</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_income" title="Macro: @{NAME|income}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="stash-money-location-label">Stash</span>
									</div>
									<span class="tooltip">
										<span data-i18n="stash-money-location-tooltip">Total available cash stashed in banks, vaults, mattresses, etc.</span> 
									</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_stash" title="Macro: @{NAME|stash}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="affiliations">Affiliations</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_affiliations" value="" title="Macro: @{NAME|affiliations}" />
								</div>
							</div> <!-- .row -->
							<div class="row">
								<div class="cell col0 label">
									<span data-i18n="home-base-label">Home Base</span>
								</div>
								<div class="cell col1">
									<input type="text" name="attr_home_base" title="Macro: @{NAME|home_base}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-textarea-family">
								<div class="cell col0 label">
									<span data-i18n="family-label">Family</span>
								</div>
								<div class="cell col1">
									<textarea name="attr_family" title="Macro: @{NAME|family}"></textarea>
								</div>
							</div> <!-- .row -->
						</div> <!-- .table -->
					</div> <!-- .box .background-info -->
					
					<!-- _____ _____ Background history & Notes INFO BOX _____ _____ -->
					<div class="box misc-notes">
						<div class="table">
							<div class="header">
								<div class="cell col0">
									<span data-i18n="background-history-label">Background History & Notes</span>
								</div>
							</div> <!-- .header -->
							<div class="row row-textarea">
								<div class="cell col0">
									<textarea name="attr_misc_notes" title="Macro: @{NAME|misc_notes}"></textarea>
								</div>
							</div> <!-- .row -->
						</div> <!-- .table -->
					</div> <!-- .box .misc-notes -->
					

				</div>

				<div class="reactions">
					
					<!-- _____ _____ TRAINING INFO BOX _____ _____ -->
					<div class="box reaction-notes">
						<div class="table">
							<div class="header">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="notes-label">Notes</span>
									</div>
									<span class="tooltip">
										<span data-i18n="reaction-notes-tooltip">Reference: B8, B494, NPC Reactions B559, and the Reaction Table B560.</span>
									</span>
								</div>
							</div> <!-- .header -->
							<div class="row row-textarea">
								<div class="cell col0">
									<textarea name="attr_reactions" title="Macro: @{NAME|reactions}"></textarea>
								</div>
							</div> <!-- .row -->
						</div> <!-- .table -->
					</div> <!-- .box .misc-notes -->

				</div>

				<div class="training">
					
					<!-- _____ _____ TRAINING INFO BOX _____ _____ -->
					<div class="box training-notes">
						<div class="table">
							<div class="header">
								<div class="cell col0 label">
									<div class="popup">
										<span data-i18n="notes-label">Notes</span>
									</div>
									<span class="tooltip">
										<span data-i18n="training-tooltip">
			Training rules can be found at ‘Improvement <br />
			Through Study’ B292.<br />
			Advanced rules can be found in Social<br />
			Engineering: Back to School.
										</span>
									</span>
								</div>
							</div> <!-- .header -->
							<div class="row row-textarea">
								<div class="cell col0">
									<textarea name="attr_training_notes" title="Macro: @{NAME|training_notes}"></textarea>
								</div>
							</div> <!-- .row -->
						</div> <!-- .table -->
					</div> <!-- .box .misc-notes -->
					
				</div>

				<div class="campaign">
					<p>Placeholder for Future enhancement</p>
				</div>

			</div>
		
		</div>
		
		
	</div> <!-- .tab-misc -->

	<!-- ===== ===== ===== ===== SKILLS TAB ===== ===== ===== ===== -->
	<div class="tab3">

		<div class="box skills">

			<div class="table table-generic-notes">

				<div class="header">
					<div class="cell">
						<div class="item">
							<input type="checkbox" value="1" name="attr_toggle_skills_notes" class="arrow-toggle margin-left-sm" title="View notes for skills." />
						</div>
					</div>
					<div class="cell">
						<span data-i18n="notes-label">Notes</span>
					</div>
				</div>
				
				<input type="hidden" name="attr_toggle_skills_notes" class="hidden-generic-notes-toggle" />
				<div class="row wrapper-generic-textarea-notes tall-row">
					<div class="cell full-width">
						<textarea name="attr_skills_notes" class="generic-textrea-notes"></textarea>
					</div>
				</div>
				
			</div>
		</div>
		<!-- _____ _____ SKILLS BOX _____ _____ -->

		<div class="box skills">

			<div class="roll-modifiers-table">

				<div class="modifier-caption header">
					<div class="popup">
						<span data-i18n="skill-modifiers-label">Skill Roll Modifiers</span>
					</div>
					<div class="tooltip">
						<span data-i18n="skill-modifiers-tooltip">These modifiers affect all skill rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
					</div>
				</div>

				<div class="modifier-row">

					<div class="modifier-cell modifier-align-top">
						<button type="action" name="act_show_roll_modifiers_for_skill" class="btn modifier-line-height-fix" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="summary-group">
							<div class="icon"><span data-i18n="notes-label">Notes</span></div>
							<div class="summary" style="width:250px">
								<div class="roll-traits">
									<b>Traits:</b>
									<div>
										<textarea name="attr_skill_roll_trait_summary" class="trait-summary" readonly></textarea>
									</div>
								</div>
								<div class="roll-summary">
									<b>Summary:</b>
									<div>
										<textarea name="attr_skill_roll_modifier_summary" class="roll-summary" readonly></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="modifier-label">Modifier:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<input type="number" value="0" step="1" name="attr_skill_custom_roll_modifier" />	
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="reason-label">Reason</span>:
						</div>
						<div class="tooltip">
							<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<textarea class="reason-textarea" name="attr_skill_custom_roll_modifier_reason"></textarea>
					</div>

					<div class="modifier-cell">
						<input type="checkbox" name="attr_skill_roll_max_nine" value="1" title="Macro: @{NAME|skill_roll_max_nine}" />
						<input type="hidden" name="attr_skill_roll_max_nine_value" value="100" />
					</div>	

					<div class="modifier-cell modifier-align-top">
						<div class="popup">
							<b><span data-i18n="max-skill-9-label">Max skill of 9</span></b>
						</div>
						<div class="tooltip max-skill-9">
							<span data-i18n="max-skill-9-tooltip">The effective skill cannot exceed 9.</span>
						</div>
					</div>

					<div class="modifier-cell">
						<input type="checkbox" name="attr_skill_roll_apply_encumbrance" value="1" title="Macro: @{NAME|skill_roll_apply_encumbrance}" />
					</div>	

					<div class="modifier-cell modifier-align-top">
						<div class="popup">
							<b><span data-i18n="encumbrance-label">Encumbrance</span></b>
						</div>
						<div class="tooltip max-skill-9">
							<span data-i18n="apply-encumbrance-tooltip">Apply encumbrance penalty.</span>
							<b style="color:red;"><span name="attr_encumbrance_level"></span></b>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="final-modifier-label">Final Modifier</span>:
						</div>
						<div class="tooltip">
							<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="number-input">
							<input type="hidden" name="attr_skill_roll_modifier_status" value="neutral" class="modifier-status" />
							<input type="number" value="0" step="1" name="attr_skill_roll_modifier" class="final-modifier" readonly />
							<input type="hidden" value="" name="attr_skill_roll_modifier_summary" />
							<input type="hidden" value="" name="attr_skill_roll_trait_summary" />
							<input type="hidden" value="" name="attr_skill_roll_hit_location" />
							<input type="hidden" value="" name="attr_skill_roll_maneuver" />
							<input type="hidden" value="" name="attr_skill_roll_allout_attack" />
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<button type="action" name="act_skill_roll_reset" class="btn tool-modifier-reset modifier-line-height-fix" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
					</div>

					<div class="modifier-cell modifier-fill-cell-10">&nbsp;</div>

				</div><!-- end row -->

			</div>

			<div class="table">
				
				<div class="header">
					<div class="cell col0">
						<div class="popup">
							<span data-i18n="skills-label">Skills</span>	
						</div>
						<span class="tooltip">
							<span data-i18n="skill-roll-modifier-tooltip">You can use the <b>Roll Modifiers Bar</b> or the <b>Roll Modifiers Tool Box</b> to modifier the effective skill.</span>
						</span>	
					</div>
					<div class="cell col1"></div>
					<div class="cell col2">
						<span data-i18n="abbreviation-technology-level-label">TL</span>
					</div>
					<div class="cell col3">
						<span data-i18n="skill-level-label">Level</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-attribute-label">Attr</span>
						</div>
						<span class="tooltip">
							<span data-i18n="skill-attribute-tooltip">
If the <b>10</b> was selected, it will be highlighted red. This could have happened during the import if the skill has an attribute not identified by the system. Check the attribute on your chosen <i>Character Creation App</i> to see if the attribute exists on Roll20.
							</span>
						</span>
					</div>
					<div class="cell col5">
						<div class="popup">
							<span data-i18n="abbreviation-difficulty-label">Diff</span>
						</div>
						<span class="tooltip">
							<span data-i18n="skill-difficulty-tooltip">
WC = Wildcard Skill.<br />
PTS = 3, 6, 12, 24, 36, etc.
							</span>
						</span>
					</div>
					<div class="cell col6">
						<div class="popup">
							<span data-i18n="abbreviation-modifier-label">Mod</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="skill-modifier-tooltip">
Modifier applied to skill level.<br />
Can be a positive or a negative number.<br />
Examples include a bonus from a Talent,<br />
default from another Skill or Technique,<br />
a piece of equipment, or a Perk.
							</span>
						</div>
					</div>
					<div class="cell col7">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col8">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-skills-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->

				<fieldset class="repeating_skills">
					<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
					<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_skill_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<input type="hidden" name="attr_skill_conditional_notes" value="" />
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_skills_$[row #]_name}" />
							<input type="hidden" name="attr_sync" value="0" />
							<input type="hidden" name="attr_idkey" />
							<span class="wrapper-conditional-marker">
								<span class="conditional-marker" title="Has Conditional notes">i</span>
							</span>
						</div>
						<div class="cell col1">
							<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{isRepeatingSkill=[[1]]}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{noteBoxOneLabel=Skill Modifiers}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{popupModifier=@{popup_modifier}}} {{rollModifier=[[@{skill_roll_modifier}]]}} {{rollModifierSummary=@{skill_roll_modifier_summary}}}" />
						</div>
						<div class="cell col2">
							<input type="text" name="attr_tl" title="Macro: @{NAME|repeating_skills_$[row #]_tl}" />
						</div>
						<div class="cell col3">
							<input type="text" name="attr_level" title="Macro: @{NAME|repeating_skills_$[row #]_level}" readonly="readonly" value="10"/>
						</div>
						<div class="cell col4">
							<input type="hidden" class="option-alert" name="attr_base" />
							<select name="attr_base" title="Macro: @{NAME|repeating_skills_$[row #]_base}">
								<option value="@{strength}" data-i18n="option-strength">ST</option>
								<option value="@{dexterity}" data-i18n="option-dexterity" selected>DX</option>
								<option value="@{intelligence}" data-i18n="option-intelligence">IQ</option>
								<option value="@{health}" data-i18n="option-health">HT</option>
								<option value="@{willpower}" data-i18n="option-will">Will</option>
								<option value="@{perception}" data-i18n="option-perception">Per</option>
								<option value="10">10</option>
							</select>
						</div>
						<div class="cell col5">
							<select name="attr_difficulty" title="Macro: @{NAME|repeating_skills_$[row #]_difficulty}">
								<option value="-1" data-i18n="abbreviation-option-easy">E</option>
								<option value="-2" data-i18n="abbreviation-option-average" selected>A</option>
								<option value="-3" data-i18n="abbreviation-option-hard">H</option>
								<option value="-4" data-i18n="abbreviation-option-very-hard">VH</option>
								<option value="-5 + 1" data-i18n="abbreviation-option-wildcard">WC</option>
							</select>
						</div>
						<div class="cell col6">
							<input type="number" name="attr_bonus" value="0" title="Macro: @{NAME|repeating_skills_$[row #]_bonus}" />
						</div>
						<div class="cell col7">
							<input type="hidden" name="attr_use_wildcard_points" value="0" />
							<input type="hidden" name="attr_use_normal_points" value="1" />
							<input type="hidden" name="attr_wildcard_skill_points" value="0" />
							<input type="number" name="attr_points" value="0" title="Macro: @{NAME|repeating_skills_$[row #]_points}" />
						</div>
						<div class="cell col8">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_skills_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					
					<div class="row row-details notebox">

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="row-id-label">Row ID:</span>
								</div>
								<span class="tooltip">
									<span data-i18n="row-id-tooltip">
The row id can be used with macros.<br />
NOTE: Future use for linking to techniques<br />
and combat skills.<br />
Example field name: repeating_skills_[the row id]_level<br />
This example would represent the skill level on that row.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" readonly="readonly" name="attr_row_id" value="" />
							</div>
							<div class="cell label">
								<span data-i18n="abbrevation-miscellaneous-label">Misc:</span>
							</div>
							<div class="cell">
								<input type="text" name="attr_skill_misc" title="Macro: @{NAME|repeating_skills_$[row #]_skill_misc}" />
							</div>
						</div> <!-- .row -->

						<div class="row">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
								</div>
									<span class="tooltip">
										<span data-i18n="reason-for-modifiers-skills-tooltip">
Examples:<br />
+1 from Talent...<br />
+1 from Default Skill...<br />
+1 from Enchanted Item with...
										</span>
									</span>
							</div>
							<div class="cell reason-for-mod">
								<input type="text" name="attr_skill_mod_notes" title="Macro: @{NAME|repeating_skills_$[row #]_skill_mod_notes}" />
							</div>
						</div>

						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_skills_$[row #]_notes}"></textarea>
						</div>

						<div class="col-notebox" style="margin-bottom: 5px;">
							<div class="grid-2-column-auto grid__align_center grid__gap_medium">
								<label class="toggle-button">
									<input type="checkbox" name="attr_familiarities_show" value="1">
									<span></span>
								</label>
								<div>
									<div class="popup">
										<span data-i18n="familiarities-label">Familiarities</span>
									</div>
									<span class="tooltip">
										<span data-i18n="skill-familiarities-tooltip">Any skill used to operate equipment, for example - Guns (Pistol), Driving (Automobile), and Electronics Operation (Communications), take a penalty when you are faced with an unfamiliar type of item. Starting characters may specify two familiarities per point spent on a skill. For instance, if you have four points in Guns (Pistol), you can be familiar with up to eight handguns. List all equipment Familiarities below. (See Familiarity B169)</span>
									</span>
								</div>
							</div>
							<input type="hidden" name="attr_familiarities_show" value="0" />
							<div class="familiarities">
								<textarea name="attr_familiarities" title="Macro: @{NAME|repeating_skills_$[row #]_familiarities}"></textarea>
							</div>
						</div>

						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_skill_mod_notes" value="1" />
								<div class="popup inline-block">
									<span data-i18n="show-skill-mod-notes-below-label">Show Skill Modifier notes (refer to the actual skill description)</span>
								</div>
								<span class="tooltip" style="margin: 20px 0 0 -323px;width: 75%;">
									<span data-i18n="show-skill-mod-notes-below-tooltip">Only modifiers entered in the Text Box below will show up in the Roll Template when this checkbox is checked. Familiarity modifiers, if any, not embedded in this sheet and should be manually entered as a Modifier when the skill is rolled.</span>
								</span>
							</div>
							<textarea name="attr_skill_mod_description_notes" title="Macro: @{NAME|repeating_skills_$[row #]_skill_mod_description_notes}"></textarea>
						</div>

						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_skill_conditionals" value="1" />
								<span class="label">
									<span data-i18n="show-skill-conditional-below-label">Show Skill Conditionals notes</span>
								</span>
							</div>
							<textarea name="attr_skill_conditional_notes" title="Macro: @{NAME|repeating_skills_$[row #]_skill_conditional_notes}"></textarea>
						</div>

						<div class="header">
							<div class="popup">
								<span data-i18n="notes-label">Notes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="custom-success-fail-notes-tooltip">
Success, critical success, fail, and critical fail<br />
notes will be added to roll results.<br />
You can add macros to these notes.<br />
The width of these note boxes are set to help you<br />
visualize what it will look like in chat.
								</span>
							</span>
						</div>
						
						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title">
									<span data-i18n="success-note-label">Success Note:</span>
								</div>
								<textarea name="attr_skill_success_note" title="Macro: @{NAME|repeating_skills_$[row #]_skill_success_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title"><span data-i18n="critical-success-note-label">Critical Success Note:</span></div>
								<textarea name="attr_skill_critical_success_note" title="Macro: @{NAME|repeating_skills_$[row #]_skill_critical_success_note}"></textarea>
							</div>
						</div>
						
						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title"><div data-i18n="fail-note-label">Fail Note:</div></div>
								<textarea name="attr_skill_fail_note" title="Macro: @{NAME|repeating_skills_$[row #]_skill_fail_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title"><span data-i18n="critical-fail-note-label">Critical Fail Note:</span></div>
								<textarea name="attr_skill_critical_fail_note" title="Macro: @{NAME|repeating_skills_$[row #]_skill_critical_fail_note}"></textarea>
							</div>
							
						</div>

						<div class="header">
							<div class="popup">
								<span data-i18n="custom-macros-label">Custom Macros</span>
							</div>
							<span class="tooltip">
								<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
							</span>
						</div>

						<div class="grid-standard grid-custom-skills-macros">
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
										<input type="hidden" name="attr_macro_one_name" value="Skill" />
										<input type="hidden" name="attr_macro_one" value="" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_one_name"></span>
									</span>
								</div>
							</div>	
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_two_name" value="Defense" />
										<input type="hidden" name="attr_macro_two" value="" />
										<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_two_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_three_name" value="Melee" />
										<input type="hidden" name="attr_macro_three" value="" />
										<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_three_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_four_name" value="Ranged" />
										<input type="hidden" name="attr_macro_four" value="" />
										<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_four_name"></span>
									</span>
								</div>
							</div>
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_five_name" value="Spell" />
										<input type="hidden" name="attr_macro_five" value="" />
										<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_five_name"></span>
									</span>
								</div>
							</div>

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
										<input type="hidden" name="attr_macro_six" value="" />
										<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_six_name"></span>
									</span>
								</div>
							</div>
							
						</div>
						
					</div> <!-- .row -->
					
				</fieldset> <!-- .repeating_skills -->
			</div> <!-- .table -->
		</div> <!-- .box .skills -->


		<!-- _____ _____ TECHNIQUES BOX _____ _____ -->

		<input type="hidden" class="box-techniques-old" name="attr_show_old_techniques" value="0" />
		<div class="box techniques">
			<div class="table">
				<div class="header">
					<div class="cell col0 label">
						<div class="popup">
							<span data-i18n="techniques-legacy-label">TECHNIQUES (LEGACY).</span>
						</div>
						<span class="tooltip">
							<span data-i18n="techniques-legacy-tooltip">
<b>New Optional Feature Available.</b><br /> 
A revised techniques table is available by setting the options on the character sheet.<br />
This revised techniques is not final, we'll make adjustments based upon feedback.<br />
<b>New Legacy and Revised Technique Tables.</b> Options to show/hide the Legacy<br />
Techniques table and the new Revised Techniques table.<br />
Show both tables if you want to transfer your current techniques to the new table.<br />
If old technique table has no rows, then hide old table, show new table.<br />
							</span>
						</span>
					</div>					
					<div class="cell col1">
						<span data-i18n="parent-label">Parent</span>
					</div>
					<div class="cell col2">
						<span data-i18n="abbreviation-minimum-label">Min</span>
					</div>
					<div class="cell col3">
						<span data-i18n="abbreviation-maximum-label">Max</span>
					</div>
					<div class="cell col4">
						<span data-i18n="skill-level-label">Level</span>
					</div>
					<div class="cell col5">
						<span data-i18n="cost-label">Cost</span>
					</div>
					<div class="cell col6">
						<span data-i18n="abbreviation-modifier-label">Mod</span>
					</div>
					<div class="cell col7">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col8">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->
				<fieldset class="repeating_techniques">
					<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_technique_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_techniques_$[row #]_name}" />
						</div>
						<div class="cell col1">
							<input type="text" name="attr_parent" title="Macro: @{NAME|repeating_techniques_$[row #]_parent}" />
						</div>
						<div class="cell col2">
							<input type="number" name="attr_min" value="0" title="Macro: @{NAME|repeating_techniques_$[row #]_min}" />
						</div>
						<div class="cell col3">
							---
						</div>
						<div class="cell col4">
							<input type="text" name="attr_level" disabled="disabled" title="Macro: @{NAME|repeating_techniques_$[row #]_level}" value="@{min} + floor(@{points} / @{points_per_level}) + @{bonus}"/>
						</div>
						<div class="cell col5">
							<input type="number" name="attr_points_per_level" value="1" title="Macro: @{NAME|repeating_techniques_$[row #]_points_per_level}" />
						</div>
						<div class="cell col6">
							<input type="number" name="attr_bonus" value="0" title="Macro: @{NAME|repeating_techniques_$[row #]_bonus}" />
						</div>
						<div class="cell col7">
							<input type="number" name="attr_points" value="0" title="Macro: @{NAME|repeating_techniques_$[row #]_points}" />
						</div>
						<div class="cell col8">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_techniques_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					<div class="row row-details notebox">
						<div class="cell col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_techniques_$[row #]_notes}"></textarea>
						</div>
					</div> <!-- .row -->
				</fieldset> <!-- .repeating_techniques -->
			</div> <!-- .table -->
		</div> <!-- .box .techniques -->

		<!-- _____ _____ TECHNIQUES REVISED BOX _____ _____ -->

		
		<input type="hidden" class="box-techniques-new" name="attr_show_new_techniques" value="1" />
		<div class="box techniques-revised">
			<div class="table">
				<div class="header">
					<div class="cell col0">
						<div class="popup">
							<span data-i18n="techniques-revised-label">Techniques (Revised)</span></div>
						<span class="tooltip">
							<span data-i18n="techniques-roll-modifier-tooltip">You can use the <b>Roll Modifiers Bar</b> or the <b>Roll Modifiers Tool Box</b> to modifier the effective skill.</span>
						</span>	
					</div>
					<div class="cell col1">
						<span data-i18n="parent-label">Parent</span>
					</div>
					<div class="cell col2">
						<div class="popup">
							<span data-i18n="base-level-label">Base</span>
						</div>
						<span class="tooltip">
							<span data-i18n="base-skill-level-tooltip">
Base skill level of technique, usually<br />
based on Parent Skill.<br />
see Techniques B229
							</span>
						</span>
					</div>
					<div class="cell col3">
						<div class="popup">
							<span data-i18n="abbreviation-default-label">DFLT</span>
						</div>
						<span class="tooltip">
							<span data-i18n="techniques-revised-default-tooltip">
Default modifier to apply to the base skill.<br />
For example, Kicking is -2 from Brawling or Karate Skill.<br />
Enter 0 if there is no modifier.<br />
see Techniques B229
							</span>
						</span>
					</div>
					<div class="cell col4">
						<div class="popup">
							<span data-i18n="abbreviation-maximum-label">Max</span>
						</div>
						<span class="tooltip">
							<span data-i18n="techniques-revised-maximum-modifier-tooltip">
Maximum modifier allowed for the technique.<br />
This is relative to the parent skill.<br />
For example, Kicking cannot exceed Brawling + 0<br />
or Karate + 0.<br />
see Techniques B229
							</span>
						</span>
					</div>
					<div class="cell col5">
						<div class="popup">
							<span data-i18n="abbreviation-difficulty-label">Diff</span>
						</div>
						<span class="tooltip">
							<span data-i18n="technique-difficulty-tooltip">
Difficulty of technique.<br />
Feats with severe consequences on a failure<br />
or allow only one attempt are Hard.<br />
see Techniques B229
							</span>
						</span>
					</div>
					<div class="cell col6">
						<div class="popup">
							<span data-i18n="abbreviation-modifier-label">Mod</span>
						</div>
						<div class="tooltip tooltip-tech-ref">
Modifier applied to skill level.<br />
Can be a positive or a negative number.<br />
Examples include a bonus from a Talent,<br />
default from another Skill or Technique,<br />
a piece of equipment, or a Perk.
						</div>
					</div>
					<div class="cell col7">
						<span data-i18n="abbreviation-character-points-label">Pts</span>
					</div>
					<div class="cell col8">
						<span data-i18n="skill-level-label">Level</span>
					</div>
					<div class="cell col9"></div>
					<div class="cell col10">
						<div class="popup">
							<span data-i18n="abbreviation-book-reference-label">Ref</span>
						</div>
						<div class="tooltip tooltip-tech-ref">
							<span data-i18n="book-reference-tooltip">
Reference to book and page numbers.<br />
Examples:<br />
B238 = GURPS Basic, Page 238<br />
PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
				</div> <!-- .header -->

				<div class="row roll-modifiers">
					<div class="cell">
						<button type="action" name="act_show_roll_modifiers_for_technique" class="btn" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
					</div>
					<div class="cell">
						<div class="summary-group">
							<div class="icon"><span data-i18n="notes-label">Notes</span></div>
							<div class="summary" style="width:250px">
								<div class="roll-traits">
									<b>Traits:</b>
									<div>
										<textarea name="attr_technique_roll_trait_summary" class="trait-summary" readonly></textarea>
									</div>
								</div>
								<div class="roll-summary">
									<b>Summary:</b>
									<div>
										<textarea name="attr_technique_roll_modifier_summary" class="roll-summary" readonly></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="cell label">
						<div class="popup">
							<span data-i18n="modifier-label">Modifier:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
						</div>
					</div>
					<div  class="cell number-input">
						<input type="number" value="0" step="1" name="attr_technique_custom_roll_modifier" />
					</div>
					<div class="cell">
						<span>Reason:</span>
					</div>
					<div class="cell">
						<textarea style="height: 36px;width:150px;" name="attr_technique_custom_roll_modifier_reason"></textarea>
					</div>
					<div class="cell cell-popup">
						<div>
							<input type="checkbox" name="attr_technique_roll_max_nine" value="1" title="Macro: @{NAME|technique_roll_max_nine}" />
							<input type="hidden" name="attr_technique_roll_max_nine_value" value="100" />
						</div>
						<div>
							<div class="popup">
								<span data-i18n="max-skill-9-label">Max skill of 9</span>
							</div>
							<div class="tooltip max-skill-9">
								<span data-i18n="max-skill-9-tooltip">The effective skill cannot exceed 9.</span>
							</div>
						</div>
					</div>
					<div class="cell cell-popup" style="margin-left:5px;">
						<div>
							<input type="checkbox" name="attr_technique_roll_apply_encumbrance" value="1" title="Macro: @{NAME|technique_roll_apply_encumbrance}" />
						</div>
						<div>
							<div class="popup">
								<span data-i18n="encumbrance-label">Encumbrance</span>
							</div>
							<div class="tooltip max-skill-9">
								<span data-i18n="apply-encumbrance-tooltip">Apply encumbrance penalty.</span>
								<b style="color:red;"><span name="attr_encumbrance_level"></span></b>
							</div>
						</div>
					</div>
					<div class="cell" style="margin-left: 5px;">
						<div class="popup">
							<span data-i18n="final-modifier-label">Final Modifier</span>:
						</div>
						<div class="tooltip">
							<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
						</div>
					</div>
					<div class="cell number-input">
						<input type="hidden" name="attr_technique_roll_modifier_status" value="neutral" class="modifier-status" />
						<input type="number" value="0" step="1" name="attr_technique_roll_modifier" class="final-modifier" readonly />
						<input type="hidden" value="" name="attr_technique_roll_modifier_summary" />
						<input type="hidden" value="" name="attr_technique_roll_trait_summary" />
						<input type="hidden" value="" name="attr_technique_roll_hit_location" />
						<input type="hidden" value="" name="attr_technique_roll_maneuver" />
						<input type="hidden" value="" name="attr_technique_roll_allout_attack" />
					</div>
					<div class="cell">
						<button type="action" name="act_technique_roll_reset" class="btn tool-modifier-reset" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
					</div>
				</div>
				
				<fieldset class="repeating_techniquesrevised">
					<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
					<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_technique_revised_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<input type="text" name="attr_name" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_name}" />
							<input type="hidden" name="attr_idkey" />
						</div>
						<div class="cell col1">
							<input type="text" name="attr_parent" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_parent}" />
						</div>
						<div class="cell col2">
							<input type="number" name="attr_base_level" value="0" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_base_level}" />
						</div>
						<div class="cell col3">
							<input type="number" name="attr_default" value="0" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_default}" />
						</div>
						<div class="cell col4">
							<input type="number" name="attr_max_modifier" value="0" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_max_modifier}" />
						</div>
						<div class="cell col5">
							<select name="attr_difficulty" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_difficulty}">
								<option value="Average" data-i18n="option-average">Average</option>
								<option value="Hard" data-i18n="option-hard">Hard</option>
							</select>
						</div>
						<div class="cell col6">
							<input type="number" name="attr_skill_modifier" value="0" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_modifier}" />
						</div>
						<div class="cell col7">
							<input type="number" name="attr_points" value="0" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_points}" />
						</div>
						<div class="cell col8">
							<input type="text" name="attr_level" readonly="readonly" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_level}" value="10"/>
						</div>
						<div class="cell col9">
							<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Technique Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{useModTool=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{rollModifier=[[@{technique_roll_modifier}]]}} {{rollModifierSummary=@{technique_roll_modifier_summary}}} {{popupModifier=@{popup_modifier}}}" />
						</div>
						<div class="cell col10">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_ref}" />
						</div>
					</div> <!-- .row -->
					
					<div class="row row-details notebox">
					
						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="row-id-label">Row ID:</span>
								</div>
								<span class="tooltip">
									<span data-i18n="row-id-repeating-tooltip">
The row id can be used with macros.<br />
Example field name: repeating_techniquesrevised_[the row id]_level<br />
This example would represent the skill level on that row.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" readonly="readonly" name="attr_row_id" value="" />
							</div>
							<div class="cell label">
								<span data-i18n="abbrevation-miscellaneous-label">Misc:</span>
							</div>
							<div class="cell">
								<input type="text" name="attr_skill_misc" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_misc}" />
							</div>
							<div class="cell label">
								<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
							</div>
							<div class="cell">
								<input type="text" name="attr_skill_mod_notes" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_mod_notes}" />
							</div>
						</div> <!-- .row -->
						
						<div class="row technique-notebox">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="link-label">Link:</span>
								</div>
								<span class="tooltip">
									<span data-i18n="link-to-row-id-tooltip">Link this row to another row item.</span>
								</span> 
							</div>
							<input type="hidden" name="attr_technique_row_type" value="Skill" />
							<div class="cell">
								<select name="attr_technique_row_type">
									<option value="Skill" data-i18n="option-skill">Skill</option>
									<option value="Spell" data-i18n="option-spell">Spell</option>
									<option value="Technique" data-i18n="option-technique">Technique</option>
									<option value="ST" data-i18n="option-strength">ST</option>
									<option value="STRIKING" data-i18n="option-striking-strength">Striking ST</option>
									<option value="DX" data-i18n="option-dexterity">DX</option>
									<option value="IQ" data-i18n="option-intelligence">IQ</option>
									<option value="WILL" data-i18n="option-will">WILL</option>
									<option value="HT" data-i18n="option-health">HT</option>
									<option value="10">10</option>
								</select>
							</div>
							<div class="cell col-row-id label show-hide-row-id">
								<div class="popup">
									<span data-i18n="row-id-label">Row ID:</span>
								</div>
								<span class="tooltip">
									<span data-i18n="copy-paste-row-id-tooltip">
Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
When the skill/spell is updated, the technique's parent name and base skill level<br />
will be updated.<br />
Once entered, this will change the Skill/Spell for this particular attack to match<br />
the skill/spell level of the Base Skill. Do not change this skill Level number manually.
									</span>
								</span>	
							</div>
							<div class="cell col-input-medium show-hide-row-id">
								<input type="hidden" name="attr_technique_skill_row_id_toggle" value="0" />
								<input type="text" name="attr_technique_skill_row_id" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_technique_skill_row_id}" />
							</div>
							<div class="cell col-wide">
								<input type="hidden" name="attr_skill" value="" />
								<input type="hidden" name="attr_technique_skill_row_id_modifier" value="0" />
								<input type="hidden" name="attr_technique_skill_row_id_message" value="" />
								<b><span data-i18n="name-label">Name:</span></b><span name="attr_technique_skill_row_id_message"></span>
								<input type="hidden" name="attr_technique_skill_row_id_level" value="" />
								<b><span data-i18n="skill-level-label">Level</span>:</b><span name="attr_technique_skill_row_id_level"></span>
							</div>
						</div> <!-- .row -->

						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes_revised" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_notes}" style="height: 50px"></textarea>
						</div>
					
						<div class="header">
							<div class="popup">
								<span data-i18n="notes-label">Notes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="custom-success-fail-notes-tooltip">
Success, critical success, fail, and critical fail<br />
notes will be added to roll results.<br />
You can add macros to these notes.<br />
The width of these note boxes are set to help you<br />
visualize what it will look like in chat.
								</span>
							</span>
						</div>

						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title">
									<span data-i18n="success-note-label">Success Note:</span>
								</div>
								<textarea name="attr_skill_success_note" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_success_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title"><span data-i18n="critical-success-note-label">Critical Success Note:</span></div>
								<textarea name="attr_skill_critical_success_note" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_critical_success_note}"></textarea>
							</div>
						</div>
						
						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title">
									<div data-i18n="fail-note-label">Fail Note:</div>
								</div>
								<textarea name="attr_skill_fail_note" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_fail_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title">
									<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
								</div>
								<textarea name="attr_skill_critical_fail_note" title="Macro: @{NAME|repeating_techniquesrevised_$[row #]_skill_critical_fail_note}"></textarea>
							</div>
							
						</div>

						<div class="header">
							<div class="popup">
								<span data-i18n="custom-macros-label">Custom Macros</span>
							</div>
							<span class="tooltip">
								<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
							</span>
						</div>

						<div class="grid-standard grid-custom-skills-macros">
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
										<input type="hidden" name="attr_macro_one_name" value="Skill" />
										<input type="hidden" name="attr_macro_one" value="" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_one_name"></span>
									</span>
								</div>
							</div>	
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_two_name" value="Defense" />
										<input type="hidden" name="attr_macro_two" value="" />
										<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_two_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_three_name" value="Melee" />
										<input type="hidden" name="attr_macro_three" value="" />
										<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_three_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_four_name" value="Ranged" />
										<input type="hidden" name="attr_macro_four" value="" />
										<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_four_name"></span>
									</span>
								</div>
							</div>
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_five_name" value="Spell" />
										<input type="hidden" name="attr_macro_five" value="" />
										<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_five_name"></span>
									</span>
								</div>
							</div>

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
										<input type="hidden" name="attr_macro_six" value="" />
										<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_six_name"></span>
									</span>
								</div>
							</div>
							
						</div>
						
					</div> <!-- .row -->
					
				</fieldset> <!-- .repeating_techniques -->
			</div> <!-- .table -->
		</div> <!-- .box .techniques -->

	</div> <!-- .tab3 -->


	<!-- ===== ===== ===== ===== COMBAT TAB ===== ===== ===== ===== -->
	<div class="tab4">

		<div class="box skills" style="margin-bottom:6px;">
			<div class="table table-generic-notes">
				
				<div class="header">
					<div class="cell">
						<div class="item">
							<input type="checkbox" value="1" name="attr_toggle_combat_notes" class="arrow-toggle margin-left-sm" title="View notes for combat." />
						</div>
					</div>
					<div class="cell">
						<span data-i18n="notes-label">Notes</span>
					</div>
				</div>
				
				<input type="hidden" name="attr_toggle_combat_notes" class="hidden-generic-notes-toggle" />
				<div class="row wrapper-generic-textarea-notes tall-row">
					<div class="cell full-width">
						<textarea name="attr_combat_notes" class="generic-textrea-notes"></textarea>
					</div>
				</div>

			</div>
		</div>

		<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
		<div class="tabbed">
			
			<!-- tabs -->
			<label>
				<input type="radio" name="attr_combat_tabs" value="damage" class="tab-control" checked />
				<span data-i18n="hit-locations-label">Hit Locations</span>
			</label>
			<label>
				<input type="radio" name="attr_combat_tabs" value="defense" class="tab-control" />
				<span data-i18n="defense-label">Defense</span>
			</label>
			<label>
				<input type="radio" name="attr_combat_tabs" value="melee" class="tab-control" />
				<span data-i18n="melee-label">Melee</span>
			</label>
			<label>
				<input type="radio" name="attr_combat_tabs" value="ranged" class="tab-control" />
				<span data-i18n="ranged-label">Ranged</span>
			</label>
			<label>
				<input type="radio" name="attr_combat_tabs" value="tools" class="tab-control" />
				<span data-i18n="tools-label">Tools</span>
			</label>

			<!-- tabbed section to display | value changes based on selected radio button -->
			<input type="hidden" name="attr_combat_tabs" value="damage" />
			<div class="tabs">

				<div class="tabbed-header">
					
					<div class="container">

						<div class="item item1">

							<div class="hit-points">

								<!-- row 1 -->
								<div class="item item1">
									<div class="popup">
										<span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span>
									</div>
									<span class="tooltip">
										<span data-i18n="size-modifier-tooltip">Your size modifier.</span>
									</span>
								</div>
								
								<div class="item item2">
									<div class="popup">
										<span data-i18n="abbreviation-hit-points">HP</span>
									</div>
									<span class="tooltip">
										<span data-i18n="current-hit-points-tooltip">Current Hit Points<br />When your HP is low, you take penalties. (B419)</span>
										<table>
											<tbody>
											<tbody>
												<tr>
													<td class="label">
														<span data-i18n="current-hit-points-reeling">Reeling: If your HP is less than</span>
													</td>
													<td><input type="text" name="attr_hp_reeling" value="4" readonly="readonly"></td>
												</tr>
												<tr>
													<td colspan="2">
														<span data-i18n="current-hit-points-reeling-description">
	- Halve Move and Dodge (round up) (B419)<br />
	- These effects are cumulative with FP loss. See GURPS FAQ: 3.4.5.7<br />												
	- Note: This sheet automatically calculates that for you and adjusts those values.
														</span>
													</td>
												</tr>
												<tr>
													<td class="label">
														<span data-i18n="current-hit-points-collapse">Verge of Collapse</span>
													</td>
													<td><input type="text" value="At 0 HP or less" readonly="readonly"></td>
												</tr>
												<tr>
													<td colspan="2">
														<span data-i18n="current-hit-points-collaps-description">
	- Roll every turn @{VS} HT or fall unconscious.<br />
	- Your HT roll is at -1 for every 1xHP you are below 0.<br />
	- If you do nothing, and don't defend, you don't have to roll.
														</span>
													</td>
												</tr>
												<tr>
													<td class="label">
														<span data-i18n="current-hit-points-verge-of-death">Verge of Death</span>
													</td>
													<td><input type="text" name="attr_hp_verge" value="-10" readonly="readonly"></td>
												</tr>
												<tr>
													<td colspan="2">
														<span data-i18n="current-hit-points-verge-of-death-description">
	- Roll once @{VS} HT to stay alive.<br />
	- If you fail by 1 or 2 you are mortally wounded, but not dead. (B423)<br />
	- Roll again every time you take injury that puts you below<br />
	another multiple of your max HP.
														</span>
													</td>
												</tr>
												<tr>
													<td class="label">
														<span data-i18n="current-hit-points-death">Death</span>
													</td>
													<td><input type="text" name="attr_hp_death" value="-50" readonly="readonly"></td>
												</tr>
												<tr>
													<td colspan="2">
														<span data-i18n="current-hit-points-death-description">- You are dead.</span>
													</td>
												</tr>
												<tr>
													<td class="label">
														<span data-i18n="current-hit-points-total-destruction">Total Destruction</span>
													</td>
													<td><input type="text" name="attr_hp_destruction" value="-100" readonly="readonly"></td>
												</tr>
												<tr>
													<td colspan="2">
														<span data-i18n="current-hit-points-total-destruction-description">- Your body has been destroyed beyond recognition or resurrection.</span>
													</td>
												</tr>
											</tbody>
										</table>
									</span>
								</div>

								<div class="item item3">
									<div class="popup">
										<span data-i18n="abbreviation-maximum-hit-points">Max HP</span>
									</div>
									<span class="tooltip">
										<span data-i18n="maximum-hit-poits-tooltip">Hit Points - Based on Strength - 2pts/level<br />Cost reduced by -10% per SM+1 (B15)</span>
									</span>
								</div>

								<div class="item item4">
									<div class="popup">
										<span data-i18n="abbreviation-major-label">MAJ</span>
									</div>
									<span class="tooltip">
										<span data-i18n="major-wounds-tooltip">Major wound threshold. <i>Any</i> single injury of greater than 1/2 your HP. If using hit location, any injury that disables a limb is a <b>Major Wound</b>.<br />Roll HT to avoid Knockdown and Stunning or use the <b>K Down</b> trait on the general tab. See B420.</span>
									</span>
								</div>

								<!-- row 2 -->
								<div class="item item5">
									<input type="number" name="attr_size" value="0" title="Macro: @{NAME|size}" />
								</div>
								
								<div class="item item6">
									<input type="number" name="attr_hit_points" value="10" title="Macro: @{NAME|hit_points}" />
								</div>
								
								<div class="item item7">
									<input type="number" name="attr_hit_points_max" value="10" readonly="readonly" title="Macro: @{NAME|hit_points|max}" />
								</div>

								<div class="item item8">
									<input type="number" name="attr_major_wound_threshold" value="10" readonly="readonly" title="Macro: @{NAME|major_wound_threshold}" />
								</div>

							</div>

						</div>

						<div class="item item2">
							<div class="movement-table">

								<!-- row 1 -->
								<div class="item item1">
									<div class="popup">
										<span data-i18n="abbreviation-encumbrance-label">Enc</span>
									</div>
									<span class="tooltip">
										<span data-i18n="encumbrance-tooltip">Current encumbrance level. Penalty equal to your encumbrance is applied to Dodge, Judo, Karate, or any fencing Parry. See B549</span>
									</span>
								</div>
								<div class="item item2">
									<div class="popup">
										<span data-i18n="load-label">Load</span>
									</div>
									<span class="tooltip">
										<span data-i18n="load-tooltip">Amount of weight you're currently carrying.</span>
									</span>
								</div>
								<div class="item item3">
									<div class="popup">
										<span data-i18n="attribute-move">Move</span>
									</div>
									<span class="tooltip">
										<span data-i18n="encumbrance-move-score-tooltip">Note: The Move score automatically adjusts for Encumbrance<br />and for HP and/or FP loss below 1/3. (B419, B426)</span>
									</span>
								</div>
								<div class="item item4">
									<div class="popup">
										<span data-i18n="abbreviation-enhanced-move-label">ENH MOVE</span>
									</div>
									<span class="tooltip">
										<span data-i18n="enhanced-move-tooltip">Enhanced ground move.<br /><b>STEP:</b> The number in parentheses is the step distance.</span>
									</span>
								</div>
								<div class="item item5">
									<div class="popup">
										<span data-i18n="air-label">Air</span>
									</div>
									<span class="tooltip">
										<span data-i18n="air-tooltip">Air/Flying move.<br><b>STEP:</b> The number in parentheses is the step distance.</span>
									</span>
								</div>
								<div class="item item6">
									<div class="popup">
										<span data-i18n="water-label">Water</span>
									</div>
									<span class="tooltip">
										<span data-i18n="water-tooltip">Water/Swimming move.<br /><b>STEP:</b> The number in parentheses is the step distance.</span>
									</span>
								</div>
								<div class="item item7">
									<div class="popup">
										<span data-i18n="attribute-dodge">Dodge</span>
									</div>
									<span class="tooltip">
										<span data-i18n="encumbrance-dodge-tooltip">Note: The Dodge score automatically adjusts for Encumbrance<br />and for HP and/or FP loss below 1/3. (B419, B426)</span>
									</span>
								</div>
							
								<!-- row 2 -->
								<div class="item item8">
									<input type="number" name="attr_encumbrance_level" value="" readonly="readonly" title="Macro: @{NAME|encumbrance_level}" />
								</div>
								<div class="item item9 load">
									<input type="hidden" name="attr_total_weight" value="" />
									<input type="text" name="attr_total_weight_gravity" value="" readonly="readonly" title="Macro: @{NAME|total_weight_gravity}" />
								</div>
								<div class="item item10">
									<input type="text" name="attr_current_move" value="" readonly="readonly" title="Macro: @{NAME|current_move}" />
								</div>
								<div class="item item11">
									<input type="text" name="attr_enhanced_move_current" value="0" readonly="readonly" title="Macro: @{NAME|enhanced_move_current}" />
								</div>
								<div class="item item12">
									<input type="text" name="attr_current_air" value="0" readonly="readonly" title="Macro: @{NAME|current_air}" />
								</div>
								<div class="item item13">
									<input type="text" name="attr_current_water" value="0" readonly="readonly" title="Macro: @{NAME|current_water}" />
								</div>
								<div class="item item14">
									<input type="text" name="attr_current_dodge" value="0" readonly="readonly" title="Macro: @{NAME|current_dodge}" />
								</div>
							
							</div>
						</div>

						<div class="item item3">

							<div class="thrust-swing-damage">

								<!-- row 1 -->
								<div class="item item1">
									<div class="popup">
										<span data-i18n="attribute-thrust">Thrust</span>
									</div>
									<span class="tooltip">
										<span data-i18n="melee-thrust-tooltip">Thrust damage based on Striking ST. You can use the macro name in a weapons damage column and apply basic math. <b>Example:</b> Damage = @{thrust}+1</span>
									</span>
								</div>
								
								<div class="item item2">
									<div class="popup">
										<span data-i18n="attribute-swing">Swing</span>
									</div>
									<span class="tooltip">
										<span data-i18n="melee-swing-tooltip">Swing damage based on Striking ST. You can use the macro name in a weapons damage column and apply basic math. <b>Example:</b> Damage = @{swing}+1</span>
									</span>
								</div>

								<!-- row 2 -->
								<div class="item item3">
									<input type="text" name="attr_thrust" value="1d6-2" title="Macro: @{NAME|thrust}">
								</div>
								
								<div class="item item4">
									<input type="text" name="attr_swing" value="1d6" title="Macro: @{NAME|swing}">
								</div>
								
							</div>

						</div>

					</div>
					
				</div>

				<div class="damage">
					
					<h3>
						<span data-i18n="hit-location-armor-title">Your Hit Location</span>
					</h3>
					
					<div class="armor-layer-controller-grid">

						<!-- row1 -->
						<div class="item heading">
							<div class="popup">
								<span data-i18n="template-label">Template</span>:
							</div>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="character-armor-type-tooltip">Select the hit location type and click the <b>Apply</b> button.<br /><b>ALERT:</b> This will delete the current hit locations!</span>
							</span>
						</div>
						<div class="item">
							<select name="attr_armor_hit_location_type" title="Macro: @{NAME|armor_hit_location_type}">
								<option selected>Select</option>
								<option value="arachnoid">Arachnoid (spider)</option>
								<option value="avian">Avian</option>
								<option value="cancroid">Cancroid (crab)</option>
								<option value="centaur">Centaur</option>
								<option value="hexapod">Hexapod</option>
								<option value="humanoid">Humanoid</option>
								<option value="humanoid_low_tech">Humanoid Low-tech</option>
								<option value="humanoid_martial_arts">Humanoid Martial Arts</option>
								<option value="ichthyoid">Ichthyoid (fish)</option>
								<option value="octopod">Octopod (octopus)</option>
								<option value="quadruped">Quadruped</option>
								<option value="vermiform">Vermiform (snake)</option>
								<option value="wagon">Wagon</option>
								<option value="automobile">Automobile</option>
								<option value="rowboat">Rowboat</option>
								<option value="speedboat">Speedboat</option>
								<option value="biplane">Biplane</option>
								<option value="monoplane">Monoplane</option>
								<option value="helicopter">Helicopter</option>
								<option value="tank">Tank</option>
							</select>
						</div>
						<div class="item">
							<button type="action" name="act_armor_apply" class="reset" title="Apply the selected hit location type"><span data-i18n="apply-label">Apply</span></button>
						</div>
						<div class="item">&nbsp;</div>
						<div class="item heading">
							<div class="popup">
								<span data-i18n="layers-label">Layers</span>:
							</div>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="armor-layers-tooltip">Select the number of armor layers to display.</span>
							</span>
						</div>
						<div class="item">
							<select name="attr_armor_layers" title="Macro: @{NAME|armor_layers}">
								<option selected>1</option>
								<option>2</option>
								<option>3</option>
								<option>4</option>
							</select>
						</div>
						<div class="item">
							<label>
								<div>
									<input type="checkbox" name="attr_armor_show_back" title="Macro: @{NAME|armor_show_back}" />
								</div>
								<div>
									<div class="popup">
										<span data-i18n="back-armor-label">Back</span>
									</div>
									<span class="tooltip" style="margin-left: 0;">
										<span data-i18n="back-armor-tooltip">Show back armor for each layer.</span>
									</span>
									
								</div>
							</label>
						</div>
						<div class="item heading">
							<div class="popup">
								<span data-i18n="notes-label">Notes</span>:
							</div>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="hit-location-notes-tooltip">Enter notes and traits here.<br />Example include adding damage ntoes for <i>Unliving</i>, <i>Homogenous</i>, <i>Diffuse</i>, <i>Unbreakable Bones (Powers 52)</i>, <i>Damage Reduction (Powers 52).</i> see B380.</span>
							</span>
						</div>
						<div class="item">
							<textarea class="hit-location-notes" name="attr_hit_location_notes"></textarea>
						</div>

					</div>

					<div>
						<button type="action" name="act_hit_location_open" class="link" title="Expand all hit location notes">
							<span data-i18n="open-all-label">Open All</span>
						</button>
						<span>|</span>
						<button type="action" name="act_hit_location_close" class="link" title="Close all hit location notes">
							<span data-i18n="close-all-label">Close All</span>
						</button>
						<span>|</span>
						<div style="display: inline-block;">
							<div class="popup">
								<i><span data-i18n="large-area-injury-label">Large-Area Injury</span></i>
							</div>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="large-area-injury-tooltip"><b>Large-Area Injury</b> Attacks that affect most of the body; dragon's breath, bomb blast, huge fire, acid pit, or attacher that has Size Modifier Difference of 7 or higher compared to defennder. If DR varies by hit location, determine <b>effective DR</b> using <i>average</i> of torsor DR and the DR of least protected hit location <b>exposed</b> to the attack. If DR varies by damage type, use the <i>least protected</i> value. A location protected by cover or masked by the body does not count as <b>exposed to the attack.</b> For example, if you're back is turned to a cone attack by a dragon, your face is not exposed to the attack. Ignore special hit-location efects. B400.</span>
							</span>
						</div>
						<span>|</span>
						<div style="display: inline-block;">							
							<div class="popup">
								<i><span data-i18n="flexible-armor-label">Flexible Armor</span></i>
							</div>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="flexible-armor-tooltip"><b>Flexible Armor</b> If damage fails to penetrate DR, victim suffers <i>blunt trauma</i>.<br />Cutting, impaling, piercing does 1 HP per <i>full</i> 10 HP damage.<br />Crushing damage does 5 HP per <i>full</i> 5 HP damage.<br />If layered armor, only damage that penetrates outer layer inflicts blunt trauma. B379</span>
							</span>
						</div>
											
					</div>
					<div class="hit-location-container">

						<input type="hidden" name="attr_armor_show_back" />
						<input type="hidden" name="attr_armor_layers" />
						<input type="hidden" name="attr_hit_location_modifiers_upgraded" value="false" />
						<div class="hit-location-grid">

							<!-- header row -->
							<div class="item grid-header">&nbsp;</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="location-label">Location</span>
								</div>
								<span class="tooltip">
									<span data-i18n="hit-location-header-tooltip">Hit location; torso, arm, head, etc.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="abbreviation-penalty-label">PEN</span>
								</div>
								<span class="tooltip">
									<span data-i18n="armor-penalty-tooltip">Penalty to hit this location.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="modifier-abbreviation-label">MOD</span>
								</div>
								<span class="tooltip">
									<span data-i18n="armor-modifier-tooltip">The final <b>To Hit</b> modifier, the <b>Hit Location Penalty</b> plus the character's <b>Size Modifier</b>.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="abbreviation-defense-bonus-label">DB</span>
								</div>
								<span class="tooltip">
									<span data-i18n="defense-bonus-tooltip">Apply the defense bonus of a shield, cloak, spell (B252), or Meta-trait (Supers34). See B374<br /><b>Shield/Cloak:</b> Used against attacks from front or from your shield side. Can't be used against firearms <b>unless</b> you're using the <i>Damage to Shields</i> option.<br /><b>Shield Spell:</b> Protects from <i>frontal</i> attacks and is cumulative with a normal shield.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="abbreviation-damage-label">DMG</span>
								</div>
								<span class="tooltip">
									<span data-i18n="hitlocation-damage-tooltip">Enter the amount of damage this location has taken.<br /><b>NOTE:</b> The damage will <i>note</i> affect the current Hit Points.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="abbreviation-divisor-label">Div</span>
								</div>
								<span class="tooltip">
									<span data-i18n="hitlocation-divisor-tooltip">Hit Point Divisor. If the number is 2 or higher, that means the location can be disabled and a value will be updated in the next column. See B421.</span>
								</span>
							</div>
							<div class="item grid-header">
								<h4 class="spacer">&nbsp;</h4>
								<div class="popup">
									<span data-i18n="abbreviation-disabled-label">DIS</span>
								</div>
								<span class="tooltip">
									<span data-i18n="hitlocation-disabled-tooltip">Disabled/Crippled Threshold.<br />If a <b>single</b> injury meets or exceeds this value, the extremity or structure is disabled.<br /><b>NOTE:</b> In most cases, if disabled/crippled in one injury, the excess damage is lost, except where noted, such as the <b>eyes.</b><br /><b>Dismemberment:</b> If injury is <i>twice</i> the threshold, then extremity is destroyed. <i>Cutting</i> or <i>Explosion</i> will sever the limb.<br />See B421</span>
								</span>
							</div>
							<input type="hidden" name="attr_hit_location_layer_use_custom_labels" value="0" />
							
							<div class="item grid-header layer layer-1">								
								<div class="popup layer-label">
									<span data-i18n="layer-1-label" class="default">Layer 1</span>
									<span class="custom" name="attr_hit_location_layer_one_label"></span>
									<input type="hidden" name="attr_hit_location_layer_1_on"  value="1" />
									<input type="checkbox" name="attr_hit_location_layer_1_on" value="1" checked title="Turn DR on/off" />
								</div>
								<span class="tooltip">
									<span data-i18n="armor-on-toggle-tooltip">Turn armor on/off using checkbox.</span>
									<span data-i18n="armor-layor-tooltip">Enter DR for this location.<br />* = flexible<br />You can split the DR using with these suggested abbreviations.<br />cr = crush<br />pi = pierce<br />cut = cutting<br />imp = impaling<br />bu = burning<br /><b>Alert:</b> To enter a split DR, the first number must be the primary DR, while the second number are the exceptions, this is required in order to know how to split the armor.</span>
									<div>
										<span data-i18n="armor-layor1-tooltip">"Layer 1 <i>(Inner most)</i> is good for natural DR or concealable armor, such as cloth armor under a breastplate.</span>
									</div>
								</span>
								<div class="front">
									<span data-i18n="front-label">Front</span>
								</div>
								<div class="back">
									<span data-i18n="back-label">Back</span>
								</div>
							</div>

							<div class="item grid-header layer layer-2">
								<div class="popup layer-label">
									<span data-i18n="layer-2-label" class="default">Layer 2</span>
									<span class="custom" name="attr_hit_location_layer_two_label"></span>
									<input type="hidden" name="attr_hit_location_layer_2_on"  value="1" />
									<input type="checkbox" name="attr_hit_location_layer_2_on" value="1" checked title="Turn DR on/off" />
								</div>
								<span class="tooltip">
									<span data-i18n="armor-layor-tooltip">Enter DR for this location.<br />* = flexible<br />You can split the DR using with these suggested abbreviations.<br />cr = crush<br />pi = pierce<br />cut = cutting<br />imp = impaling<br />bu = burning<br /><b>Alert:</b> To enter a split DR, the first number must be the primary DR, while the second number are the exceptions, this is required in order to know how to split the armor.</span>
									<div>
										<span data-i18n="armor-layor2-tooltip">Layer 2 is good for your primary armor, like helmet, leather armor, gloves, etc.</span>
									</div>
								</span>
								<div class="front">
									<span data-i18n="front-label">Front</span>
								</div>
								<div class="back">
									<span data-i18n="back-label">Back</span>
								</div>
							</div>

							<div class="item grid-header layer layer-3">
								<div class="popup layer-label">
									<span data-i18n="layer-3-label" class="default">Layer 3</span>
									<span class="custom" name="attr_hit_location_layer_three_label"></span>
									<input type="hidden" name="attr_hit_location_layer_3_on"  value="1" />
									<input type="checkbox" name="attr_hit_location_layer_3_on" value="1" checked title="Turn DR on/off" />
								</div>
								<span class="tooltip">
									<span data-i18n="armor-layor-tooltip">Enter DR for this location.<br />* = flexible<br />You can split the DR using with these suggested abbreviations.<br />cr = crush<br />pi = pierce<br />cut = cutting<br />imp = impaling<br />bu = burning<br /><b>Alert:</b> To enter a split DR, the first number must be the primary DR, while the second number are the exceptions, this is required in order to know how to split the armor.</span>
									<div>
										<span data-i18n="armor-layor3-tooltip">Layer 3 is good for force shields, magic DR, etc.</span>
									</div>
								</span>
								<div class="front">
									<span data-i18n="front-label">Front</span>
								</div>
								<div class="back">
									<span data-i18n="back-label">Back</span>
								</div>
							</div>

							<div class="item grid-header layer layer-4">
								<div class="popup layer-label">
									<span data-i18n="layer-4-label" class="default">Layer 4</span>
									<span class="custom" name="attr_hit_location_layer_four_label"></span>
									<input type="hidden" name="attr_hit_location_layer_4_on"  value="1" />
									<input type="checkbox" name="attr_hit_location_layer_4_on" value="1" checked title="Turn DR on/off" />
								</div>
								<span class="tooltip">
									<span data-i18n="armor-layor-tooltip">Enter DR for this location.<br />* = flexible<br />You can split the DR using with these suggested abbreviations.<br />cr = crush<br />pi = pierce<br />cut = cutting<br />imp = impaling<br />bu = burning<br /><b>Alert:</b> To enter a split DR, the first number must be the primary DR, while the second number are the exceptions, this is required in order to know how to split the armor.</span>
									<div>
										<span data-i18n="armor-layor4-tooltip">Layer 4 <i>(Outer most)</i> is also good for force shields, magic DR, etc.</span>
									</div>
								</span>
								<div class="back">
									<span data-i18n="back-label">Back</span>
								</div>
							</div>
							<div class="item grid-header layer summary">
								<div class="popup">
									<span data-i18n="summary-label">Summary</span>
								</div>
								<span class="tooltip" style="margin-left: -50px">
									<span data-i18n="armor-summary-tooltip">This sums up each layer, from layer 1 <i>(inner)</i> to layer 4 <i>(outer)</i>.<br />* = flexible armor.<br /><b>Alert: </b> Only <b>one</b> layer per row may have split armor.</span>
								</span>
								<div class="front">
									<span data-i18n="front-label">Front</span>
								</div>
								<div class="back">
									<span data-i18n="back-label">Back</span>
								</div>
							</div>							
						</div>

						<fieldset class="repeating_hitlocation">

							<div class="hit-location-grid grid-standard">
								<div class="item">
									<label class="sheet-toggle-button">
										<input type="checkbox" name="attr_toggle_notes" value="1">
										<span></span>
									</label>
								</div>
								<div class="item">																
									<input type="text" name="attr_where" title="Macro: @{NAME|repeating_hitlocation_$[row #]_where}" />
									<input type="hidden" name="attr_key" />
								</div>
								<div class="item">
									<input type="number" step="1" value="0" name="attr_penalty" title="Macro: @{NAME|repeating_hitlocation_$[row #]_penalty}" />
								</div>
								<div class="item">
									<input type="number" value="@{penalty} + @{size}" disabled="disabled" name="attr_final_modifier" title="Macro: @{NAME|repeating_hitlocation_$[row #]_final_modifier}" />
								</div>
								<div class="item">
									<input type="number" value="0" step="1" min="0" name="attr_defense_bonus" title="Macro: @{NAME|repeating_hitlocation_$[row #]_defense_bonus}" />
								</div>
								<div class="item">
									<input type="number" value="0" step="1" max="0" name="attr_damage" class="highlight-input" title="Macro: @{NAME|repeating_hitlocation_$[row #]_damage}" />
								</div>
								<div class="item">
									<input type="number" value="1" step="1" min="1" name="attr_divisor" title="Macro: @{NAME|repeating_hitlocation_$[row #]_divisor}" />
								</div>
								<div class="item">
									<input type="text" name="attr_crippled" value="0" readonly="readonly" title="Macro: @{NAME|repeating_hitlocation_$[row #]_crippled}" />
								</div>
								<div class="item layer layer-1">
									<div class="front">
										<input type="text" value="0" name="attr_layer_1_front" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_1_front}" />
									</div>
									<div class="back">
										<input type="text" value="0" name="attr_layer_1_back" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_1_back}" />
									</div>
								</div>
								<div class="item layer layer-2">
									<div class="front">
										<input type="text" name="attr_layer_2_front" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_2_front}" />
									</div>
									<div class="back">
										<input type="text" name="attr_layer_2_back" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_2_back}" />
									</div>
								</div>
								<div class="item layer layer-3">
									<div class="front">
										<input type="text" name="attr_layer_3_front" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_3_front}" />
									</div>
									<div class="back">
										<input type="text" name="attr_layer_3_back" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_3_back}" />
									</div>
								</div>
								<div class="item layer layer-4">
									<div class="front">
										<input type="text" name="attr_layer_4_front" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_4_front}" />
									</div>
									<div class="back">
										<input type="text" name="attr_layer_4_back" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_4_back}" />
									</div>
								</div>
								<div class="item layer summary">
									<div class="front">
										<input type="text" name="attr_layer_summary_front" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_summary_front}" />
									</div>
									<div class="back">
										<input type="text" name="attr_layer_summary_back" title="Macro: @{NAME|repeating_hitlocation_$[row #]_layer_summary_back}" />
									</div>
								</div>
								
							</div>

							<input type="hidden" name="attr_toggle_notes">
							<div class="expandable-section">
								<div class="hit-location-notes-grid">
									<div class="item grid-header">
										<div class="popup left-align text-right-align">
											<span data-i18n="wounds-label">Wounds</span>
										</div>
										<span class="tooltip tooltip-margin-medium">
											<span data-i18n="hitlocation-wounds-tooltip">Enter individual wounds here, if limb is crippled, bleeding, etc.<br />Example: -6 pi (major wound), -2 burn.</span>
										</span>
									</div>
									<div class="item">
										<input type="text" name="attr_wounds" class="textbox-full-width" title="Macro: @{NAME|repeating_hitlocation_$[row #]_wounds}" />
									</div>
									<div class="item text-right-align">
										<div class="popup left-align text-right-align">
											<span data-i18n="notes-label">Notes</span>
										</div>
										<span class="tooltip tooltip-margin-medium">
											<span data-i18n="hitlocation-notes-tooltip">Enter individual wounds here, if limb is crippled, bleeding, etc.<br />Example: -6 pi (major wound), -2 burn.</span>
										</span>
									</div>
									<div class="item">
										<input type="text" name="attr_notes" class="textbox-full-width" title="Macro: @{NAME|repeating_hitlocation_$[row #]_notes}" />
									</div>
								</div>
							</div>
							
						</fieldset>

					</div>

				</div>

				<div class="defense">
						
					<!-- tables -->
					<div class="box damage-reduction">
						
						<div class="table">
							<div class="header row-title">
				
								<div class="title hit-location">
									<div class="popup">
										<span data-i18n="hit-location-label">Hit Location</span>
									</div>
									<span class="tooltip">
										<span data-i18n="hit-location-tooltip">
			Basic Table B552.<br/>
			<strong>Optinal:</strong> Rules<br/> 
			New Hit Locations<br/>
			LT100-103, MA137
										</span>
									</span>
								</div>	
								
							</div>

							<div class="header">
								<div class="cell col0">
									<span data-i18n="where-label">Where</span>
								</div>
								<div class="cell col1">
									<div class="popup">
										<span data-i18n="penalty-label">Pen</span>
									</div>
									<span class="tooltip">
										<span data-i18n="hit-location-penalty-tooltip">
			This is the <strong>Penalty</strong> <br />
			applied to attack the <br />
			specific location.
										</span>
									</span>
								</div>
								
								<div class="cell col2">
									<div class="popup">
										<span data-i18n="abbreviation-damage-resistance-label">DR</span>
									</div>
									<span class="tooltip">
										<span data-i18n="damage-resistance-tooltip">
			<strong>Low-Tech</strong> #/# usually means All Attack Types / Except<br />
			this specific Type of attack.<br />
			Example: Enter as 3/2cr* means DR3 vs all attacks<br />
			except cr which uses DR2. * means it is Flexible<br />
			armor (B379).<br />
			<strong>High-Tech and Ultra-Tech</strong> #/# usually mean against<br />
			these Type Attacks / All other Attack Types.<br />
			Example: Enter as 5imp, cr /2 means DR5 vs imp and<br />
			cr type of attacks and DR2 against all other types<br />
			of attacks.
										</span>
									</span>
								</div>
								
							</div> <!-- .row -->

							<div class="row row-skull">
								<div class="cell col0 label">
									<input type="text" name="attr_name_skull" value="Skull" title="Macro: @{NAME|name_skull}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_skull" value="-7" title="Macro: @{NAME|hit_penalty_skull}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_skull_dr_max" value="2" title="Macro: @{NAME|skull_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-face">
								<div class="cell col0 label">
									<input type="text" name="attr_name_face" value="Face" title="Macro: @{NAME|name_face}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_face" value="-5" title="Macro: @{NAME|hit_penalty_face}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_face_dr_max" value="0" title="Macro: @{NAME|face_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-eyes">
								<div class="cell col0 label">
									<input type="text" name="attr_name_eyes" value="Eyes" title="Macro: @{NAME|name_eyes}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_eyes" value="-9" title="Macro: @{NAME|hit_penalty_eyes}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_eyes_dr_max" value="0" title="Macro: @{NAME|eyes_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-neck">
								<div class="cell col0 label">
									<input type="text" name="attr_name_neck" value="Neck" title="Macro: @{NAME|name_neck}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_neck" value="-5" title="Macro: @{NAME|hit_penalty_neck}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_neck_dr_max" value="0" title="Macro: @{NAME|neck_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-arms">
								<div class="cell col0 label">
									<input type="text" name="attr_name_arms" value="Arms" title="Macro: @{NAME|name_arms}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_arms" value="-2" title="Macro: @{NAME|hit_penalty_arms}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_arms_dr_max" value="0" title="Macro: @{NAME|arms_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-hands">
								<div class="cell col0 label">
									<input type="text" name="attr_name_hands" value="Hands" title="Macro: @{NAME|name_hands}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_hands" value="-4" title="Macro: @{NAME|hit_penalty_hands}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_hands_dr_max" value="0" title="Macro: @{NAME|hands_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-torso">
								<div class="cell col0 label">
									<input type="text" name="attr_name_torso" value="Torso" title="Macro: @{NAME|name_torso}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_torso" value="0" title="Macro: @{NAME|hit_penalty_torso}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_torso_dr_max" value="0" title="Macro: @{NAME|torso_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-vitals">
								<div class="cell col0 label">
									<input type="text" name="attr_name_vitals" value="Vitals" title="Macro: @{NAME|name_vitals}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_vitals" value="-3" title="Macro: @{NAME|hit_penalty_vitals}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_vitals_dr_max" value="See Torso" title="Macro: @{NAME|vitals_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-groin">
								<div class="cell col0 label">
									<input type="text" name="attr_name_groin" value="Groin" title="Macro: @{NAME|name_groin}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_groin" value="-3" title="Macro: @{NAME|hit_penalty_groin}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_groind_dr_max" value="0" title="Macro: @{NAME|groind_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-legs">
								<div class="cell col0 label">
									<input type="text" name="attr_name_legs" value="Legs" title="Macro: @{NAME|name_legs}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_legs" value="-2" title="Macro: @{NAME|hit_penalty_legs}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_legs_dr_max" value="0" title="Macro: @{NAME|legs_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-feet">
								<div class="cell col0 label">
									<input type="text" name="attr_name_feet" value="Feet" title="Macro: @{NAME|name_feet}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_feet" value="-4" title="Macro: @{NAME|hit_penalty_feet}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_feet_dr_max" value="0" title="Macro: @{NAME|feet_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-area">
								<div class="cell col0 label">
									<input type="text" name="attr_name_area" value="Area" title="Macro: @{NAME|name_area}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_hit_penalty_area" value="n/a" title="Macro: @{NAME|hit_penalty_area}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_area_dr_max" value="0" title="Macro: @{NAME|area_dr_max}" />
								</div>
							</div> <!-- .row -->
							<div class="header row-title">
								<div class="cell col0">
									<span data-i18n="user-created-label">User Created</span>
								</div>
							</div> <!-- .header -->
							<fieldset class="repeating_location">
								<div class="row row-stats">
									<div class="cell col0 label">
										<input type="text" name="attr_name" title="Macro: @{NAME|repeating_location_$[row #]_name}" />
									</div>
									<div class="cell col1">
										<input type="text" name="attr_hit_penalty" value="0" title="Macro: @{NAME|repeating_location_$[row #]_hit_penalty}" />
									</div>
									<div class="cell col2">
										<input type="text" name="attr_dr_max" value="0" title="Macro: @{NAME|repeating_location_$[row #]_dr_max}" />
									</div>
								</div> <!-- .row -->
							</fieldset>
						</div> <!-- .table -->

					</div>

					<!-- _____ _____ ACTIVE DEFENSE BOX _____ _____ -->
					<div class="box active-defense overflow-normal">
						
						<div class="roll-modifiers-table">

							<div class="modifier-caption header">
								<div class="popup">
									<span data-i18n="active-defense-modifiers-label">Active Defense Modifiers</span>
								</div>
								<div class="tooltip">
									<span data-i18n="active-defense-modifiers-tooltip">These modifiers affect all active defense rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
								</div>
							</div>

							<div class="modifier-row">

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_show_roll_modifiers_for_defense" class="btn modifier-line-height-fix" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="summary-group">
										<div class="icon"><span data-i18n="notes-label">Notes</span></div>
										<div class="summary" style="width:250px">
											<div class="roll-maneuver">
												<b>Maneuver:</b>
												<div>
													<textarea name="attr_defense_roll_maneuver" class="maneuver-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-traits">
												<b>Traits:</b>
												<div>
													<textarea name="attr_defense_roll_trait_summary" class="trait-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-summary">
												<b>Summary:</b>
												<div>
													<textarea name="attr_defense_roll_modifier_summary" class="roll-summary" readonly></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								<div class="modifier-cell modifier-align-top">
									<div class="standard-tooltip">
										<b><span data-i18n="modifier-label">Modifier</span></b>
										<span class="tooltiptext">
											<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
										</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<input type="number" value="0" step="1" name="attr_defense_custom_roll_modifier" />
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="standard-tooltip">
										<b><span data-i18n="reason-label">Reason</span>:</b>
										<span class="tooltiptext">
											<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
										</span>
									</div>
								</div>
								<div class="modifier-cell modifier-align-top">
									<textarea class="reason-textarea" name="attr_defense_custom_roll_modifier_reason"></textarea>
								</div>

								<div class="modifier-cell modifier-align-top">

									<div class="container-label-input margin-bottom-small">
										<input type="checkbox" name="attr_defense_roll_apply_encumbrance" value="1" title="Macro: @{NAME|defense_roll_apply_encumbrance}" />
										<div class="standard-tooltip">
											<b><span data-i18n="encumbrance-label">Encumbrance</span></b>
											<span class="tooltiptext">
												<span data-i18n="apply-encumbrance-tooltip">Apply encumbrance penalty.</span>
												<b style="color:red;"><span name="attr_encumbrance_level"></span></b><br />
												<span data-i18n="apply-encumbrance-dodge-note-tooltip"><b>NOTE:</b> The predefined <i>dodges</i> already of encumbrance applied!</span>
											</span>
										</div>
									</div>

									<div class="container-label-input">
										<select name="attr_defense_apply_shield_db" class="single-digit">
											<option>0</option>
											<option>1</option>
											<option>2</option>
											<option>3</option>
											<option>4</option>
											<option>5</option>
										</select>
										<div class="standard-tooltip">
											<b><span data-i18n="shield-abbreviate-defense-bonus-label">Shield DB</span></b>
											<span class="tooltiptext">
												<span data-i18n="shield-defense-bonus-tooltip">Apply defense bonus for a shield if attack came the front or from your shield side. See B374.</span>
											</span>
										</div>
									</div>

								</div>

								<div class="modifier-cell modifier-align-top">

									<input type="hidden" name="attr_defense_roll_modifier_status" value="neutral" class="modifier-status" />
									<input type="hidden" value="" name="attr_defense_roll_modifier_summary" />
									<input type="hidden" value="" name="attr_defense_roll_trait_summary" />
									<input type="hidden" value="" name="attr_defense_roll_hit_location" />
									<input type="hidden" value="" name="attr_defense_roll_maneuver" />
									<input type="hidden" value="" name="attr_defense_roll_allout_attack" />
	
									<!-- not used for defense -->
									<input type="hidden" name="attr_defense_roll_max_nine" value="0" />
									<input type="hidden" name="attr_defense_roll_max_nine_value" value="100" />	
									
									<div class="container-label-input margin-bottom-small height-standard">
										<div class="standard-tooltip">
											<b><span data-i18n="final-label">Final</span>:</b>
											<span class="tooltiptext">
												<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
											</span>
										</div>
										<input type="number" value="0" step="1" name="attr_defense_roll_modifier" class="final-modifier" readonly />	
									</div>

									<div class="container-label-input">
										<select name="attr_defense_apply_magic_db" class="single-digit">
											<option>0</option>
											<option>1</option>
											<option>2</option>
											<option>3</option>
											<option>4</option>
											<option>5</option>
										</select>
										<div class="standard-tooltip">
											<b><span data-i18n="magic-abbreviate-defense-bonus-label">Magic DB</span></b>
											<span class="tooltiptext">
												<span data-i18n="magic-defense-bonus-tooltip">Magical Defense Bonus, such as the Shield spell, which protects from <i>frontal</i> attacks. See B252.</span>
											</span>
										</div>
									</div>

								</div>

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_defense_roll_reset" class="btn tool-modifier-reset modifier-line-height-fix" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
								</div>

							</div>

						</div>
					</div>

					<div class="box active-defense">
						<div class="table">

							<div class="header margin-left">
								<div class="cell col0">
									<div class="popup">
										<span data-i18n="active-defenses-label">Active Defenses</span>	
									</div>
									<span class="tooltip">
										<span data-i18n="active-defense-roll-modifier-tooltip">You can use the <b>Roll Modifiers Bar</b> or the <b>Roll Modifiers Tool Box</b> to modifier the effective skill.</span>
									</span>	
								</div>
								<div class="cell col1">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<span class="tooltip">
										<span data-i18n="active-defense-type-tooltip">
			Changing the Type will also update success/fail notes<br />
			for that active defense.<br />
			Parry, Block, and Block have default notes that can be<br />
			changed on the options page.<br />
			<b>NOTE</b> Changing the Type will clear any previous notes<br />
			you entered.
										</span>
									</span>
								</div>
								<div class="cell col2">
									<div class="popup">
										<span data-i18n="abbreviation-information-label">Info</span>
									</div>
									<span class="tooltip">
										<span data-i18n="active-defense-information-tooltip">
			<strong>F</strong>: this is a fencing weapon.<br />
			<strong>U</strong>: the weapon is unbalanced. You cannot use it to<br />
			parry if you've already attacked with it this turn<br />
			(and vice versa).
										</span>
									</span>
								</div>
								<div class="cell col2">
									<div class="popup">
										<span data-i18n="base-level-label">Base</span>
									</div>
									<span class="tooltip">
										<span data-i18n="base-defense-skill-tooltip">Base defense skill.</span>
									</span>
								</div>
								<div class="cell col2">
									<div class="popup">
										<span data-i18n="abbreviation-modifier-label">Mod</span>
									</div>
									<span class="tooltip">
										<span data-i18n="defense-modifiers-tooltip">Modifiers to the defense skill.</span>
									</span>
								</div>
								<div class="cell col3">
									<span style="background-color: #87CEFA">| <span data-i18n="skill-label">Skill</span> |</span>
								</div>
							</div> <!-- .header -->

							<div class="row-static-defense">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight_dodge" />
								<input class="toggle toggle-notes static-defense" type="checkbox" title="Click to show/hide more information." name="attr_defense_dodge_toggle_notes" />
								<span class="checkbox static-defense"></span>	
								<div class="row row-stats row-standard static-defense-width">
									<div class="cell col-dodge-label">
										<span data-i18n="attribute-dodge">Dodge</span>
									</div>
									<div class="cell col1">
										<input type="hidden" name="attr_dodge_reduced_notes" value="0" />
										<span class="defense-note halved-dodge">
											<div class="popup">
												<b style="color:red;">½</b>
											</div>
											<span class="tooltip">
												<span data-i18n="half-dodge-tooltip">Dodge is halved due to hit points or fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span class="defense-note quartered-dodge">
											<div class="popup">
												<b style="color:red;">¼</b>
											</div>
											<span class="tooltip">
												<span data-i18n="quarter-dodge-tooltip">Dodge is quartered due to hit points and fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span data-i18n="attribute-dodge">Dodge</span>
										<input type="hidden" name="attr_encumbrance_level" />
										<span class="defense-encumbrance-notes">
											<div class="popup">
												<span data-i18n="abbreviation-encumbrance-label">Enc</span> <span name="attr_encumbrance_level"></span>
											</div>
											<span class="tooltip">
												<span data-i18n="defense-encumbrance-notes">Dodge was reduced due to encumbrance.</span>
											</span>
										</span>
									</div>
									<div class="cell col2"></div>
									<div class="cell col2"><input type="text" name="attr_ad_dodge_skill" value="@{current_dodge}" disabled="disabled" title="Macro: @{NAME|ad_dodge_skill}" /></div>
									<div class="cell col2"><input type="number" step="1" name="attr_ad_dodge_skill_mod" value="0" title="Macro: @{NAME|ad_dodge_skill_mod}" /></div>
									<div class="cell col3"><input type="text" name="attr_ad_dodge_skill_final" value="@{current_dodge} + @{ad_dodge_skill_mod}" disabled="disabled" title="Macro: @{NAME|ad_dodge_skill_final}" /></div>
									<div class="cell col4">
										<input type="hidden" name="attr_raw_dodge_success_notes" />
										<input type="hidden" name="attr_raw_dodge_critical_success_notes" />
										<input type="hidden" name="attr_raw_dodge_fail_notes" />
										<input type="hidden" name="attr_raw_dodge_critical_fail_notes" />
										<button type="action" name="act_roll_active_defense_dodge" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Defense Roll}} {{defenseType=[[1]]}} {{activeDefense=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Dodge}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[{@{ad_dodge_skill_final} + @{modifier} + @{defense_roll_modifier}, @{defense_roll_max_nine_value} }kl1]]}} {{isSkillRoll=[[1]]}} {{showDodgeNotes=[[1]]}} {{dodgeReducedNotes=[[@{dodge_reduced_notes}]]}} {{dodgeEncumbrancePenalty=@{encumbrance_level}}} {{useModTool=[[1]]}} {{maxNine=[[@{defense_roll_max_nine}]]}} {{rollModifier=[[@{defense_roll_modifier}]]}} {{rollModifierSummary=@{defense_roll_modifier_summary}}} {{rollTraitSummary=@{defense_roll_trait_summary}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{showNotes=[[@{defense_dodge_show_notes}]]}} {{notes=@{defense_dodge_notes}}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{raw_dodge_success_notes}}} {{rawCriticalSuccessNote=@{raw_dodge_critical_success_notes}}} {{rawFailNote=@{raw_dodge_fail_notes}}} {{rawCriticalFailNote=@{raw_dodge_critical_fail_notes}}} {{customSuccessNote=@{defense_dodge_success_note}}} {{customCriticalSuccessNote=@{defense_dodge_critical_success_note}}} {{customFailNote=@{defense_dodge_fail_note}}} {{customCriticalFailNote=@{defense_dodge_critical_fail_note}}} {{showDBNotes=[[@{show_db_notes}]]}} {{DBNotes=@{defense_bonus_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showCustomMacroOne=[[@{defense_dodge_macro_one_checked}]]}} {{customMacroOne=@{defense_dodge_macro_one}}} {{showCustomMacroTwo=[[@{defense_dodge_macro_two_checked}]]}} {{customMacroTwo=@{defense_dodge_macro_two}}} {{showCustomMacroThree=[[@{defense_dodge_macro_three_checked}]]}} {{customMacroThree=@{defense_dodge_macro_three}}} {{showCustomMacroFour=[[@{defense_dodge_macro_four_checked}]]}} {{customMacroFour=@{defense_dodge_macro_four}}} {{showCustomMacroFive=[[@{defense_dodge_macro_five_checked}]]}} {{customMacroFive=@{defense_dodge_macro_five}}} {{showCustomMacroSix=[[@{defense_dodge_macro_six_checked}]]}} {{customMacroSix=@{defense_dodge_macro_six}}}" />
									</div>
								</div> <!-- .row -->

								<div class="row row-details notebox">
								
									<div class="row hide-row"></div> <!-- .row needed to cause note to have background: todo: fix css -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="text" name="attr_defense_dodge_mod_reason" title="Field name: defense_dodge_mod_reason" />
										</div>
									</div>
									<div class="header">
										<div class="title">
											<div class="popup">
												<span data-i18n="notes-label">Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="custom-success-fail-notes-tooltip">
			Success, critical success, fail, and critical fail<br />
			notes will be added to roll results.<br />
			You can add macros to these notes.<br />
			The width of these note boxes are set to help you<br />
			visualize what it will look like in chat.
												</span>
											</span>
										</div>
									</div>
									<div class="row">
										
										<div class="show-notes">
											<input type="checkbox" name="attr_defense_dodge_show_notes" value="1" style="float:left; margin-right: 5px;" />
											<div class="popup" style="float:left;">
												<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
											</div>
											<span class="tooltip">
												<span data-i18n="displayed-on-rolltemplate-tooltip">Displayed on the rolltemplate.</span>
											</span>
										</div>

									</div>
								
									<div class="rolltable-result-notes">
										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="custom-notes-label">Custom Notes:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="custom-notes-active-defense-tooltip">Add custom notes for this active defense.</span>
												</span>
											</div>
											<textarea name="attr_defense_dodge_notes" value="@{dodge_success_notes}" title="Field name: defense_dodge_notes" style="height: 50px"></textarea>
										</div>
										
									</div>
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="success-note-label">Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_success_note" title="Field name: defense_dodge_success_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-success-note-label">Critical Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_critical_success_note" title="Field name: defense_dodge_critical_success_note"></textarea>
										</div>
										
									</div>
									
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="fail-note-label">Fail Note:</span>
											</div>
											<textarea name="attr_defense_dodge_fail_note" title="Field name: defense_dodge_fail_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
											</div>
											<textarea name="attr_defense_dodge_critical_fail_note" title="Field name: defense_dodge_critical_fail_note"></textarea>
										</div>
										
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_defense_dodge_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_defense_dodge_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_defense_dodge_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_defense_dodge_macro_two" value="" />
													<input type="checkbox" name="attr_defense_dodge_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_defense_dodge_macro_three" value="" />
													<input type="checkbox" name="attr_defense_dodge_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_defense_dodge_macro_four" value="" />
													<input type="checkbox" name="attr_defense_dodge_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_defense_dodge_macro_five" value="" />
													<input type="checkbox" name="attr_defense_dodge_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_defense_dodge_macro_six" value="" />
													<input type="checkbox" name="attr_defense_dodge_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .row -->

							</div>

							<div class="row-static-defense">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight_dodge_retreat" />
								<input class="toggle toggle-notes static-defense" type="checkbox" title="Click to show/hide more information." name="attr_defense_dodge_retreat_toggle_notes" />
								<span class="checkbox static-defense"></span>		
								<div class="row row-stats row-standard static-defense-width">

									<div class="cell col-dodge-label">
										<div class="popup">
											<span data-i18n="dodge-retreat-versus-melee-label">Dodge and Retreat (vs. Melee Attacks Only)</span>
										</div>
										<span class="tooltip">
											<span data-i18n="dodge-retreat-versus-melee-tooltip">
			Against a <strong>Melee Attack</strong> ONLY. (B377). It cannot be used against Ranged Attacks.<br/>
			Optional Rules for Retreat can be found in MA123.
											</span>
										</span>
									</div>

									<div class="cell col1">
										<input type="hidden" name="attr_dodge_reduced_notes" value="0" />
										<span class="defense-note halved-dodge">
											<div class="popup">
												<b style="color:red;">½</b>
											</div>
											<span class="tooltip">
												<span data-i18n="half-dodge-tooltip">Dodge is halved due to hit points or fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span class="defense-note quartered-dodge">
											<div class="popup">
												<b style="color:red;">¼</b>
											</div>
											<span class="tooltip">
												<span data-i18n="quarter-dodge-tooltip">Dodge is quartered due to hit points and fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span data-i18n="attribute-dodge">Dodge</span>
										<input type="hidden" name="attr_encumbrance_level" />
										<span class="defense-encumbrance-notes">
											<div class="popup">
												<span data-i18n="abbreviation-encumbrance-label">Enc</span> <span name="attr_encumbrance_level"></span>
											</div>
											<span class="tooltip">
												<span data-i18n="defense-encumbrance-notes">Dodge was reduced due to encumbrance.</span>
											</span>
										</span>
									</div>

									<div class="cell col2"></div>
									<div class="cell col2"><input type="text" name="attr_ad_dodge_retreat_skill" value="@{current_dodge} + 3" disabled="disabled" title="Macro: @{NAME|ad_dodge_retreat_skill}" /></div>
									<div class="cell col2"><input type="number" step="1" name="attr_ad_dodge_retreat_skill_mod" value="0" title="Macro: @{NAME|ad_dodge_retreat_skill_mod}" /></div>
									<div class="cell col3"><input type="text" name="attr_ad_dodge_retreat_skill_final" value="@{current_dodge} + 3 + @{ad_dodge_retreat_skill_mod}" disabled="disabled" title="Macro: @{NAME|ad_dodge_retreat_skill_final}" /></div>
									<div class="cell col4">
										<input type="hidden" name="attr_raw_dodge_retreat_success_notes" />
										<input type="hidden" name="attr_raw_dodge_retreat_critical_success_notes" />
										<input type="hidden" name="attr_raw_dodge_retreat_fail_notes" />
										<input type="hidden" name="attr_raw_dodge_retreat_critical_fail_notes" />
										<button type="action" name="act_roll_active_defense_dodge_retreat" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Defense Roll}} {{defenseType=[[1]]}} {{activeDefense=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Dodge and Retreat}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[{@{ad_dodge_retreat_skill_final} + @{modifier} + @{defense_roll_modifier}, @{defense_roll_max_nine_value} }kl1]]}} {{isSkillRoll=[[1]]}} {{showDodgeNotes=[[1]]}} {{dodgeReducedNotes=[[@{dodge_reduced_notes}]]}} {{dodgeEncumbrancePenalty=@{encumbrance_level}}} {{useModTool=[[1]]}} {{maxNine=[[@{defense_roll_max_nine}]]}} {{rollModifier=[[@{defense_roll_modifier}]]}} {{rollModifierSummary=@{defense_roll_modifier_summary}}} {{rollTraitSummary=@{defense_roll_trait_summary}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{showNotes=[[@{defense_dodge_retreat_show_notes}]]}} {{notes=@{defense_dodge_retreat_notes}}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{raw_dodge_retreat_success_notes}}} {{rawCriticalSuccessNote=@{raw_dodge_retreat_critical_success_notes}}} {{rawFailNote=@{raw_dodge_retreat_fail_notes}}} {{rawCriticalFailNote=@{raw_dodge_retreat_critical_fail_notes}}} {{customSuccessNote=@{defense_dodge_retreat_success_note}}} {{customCriticalSuccessNote=@{defense_dodge_retreat_critical_success_note}}} {{customFailNote=@{defense_dodge_retreat_fail_note}}} {{customCriticalFailNote=@{defense_dodge_retreat_critical_fail_note}}} {{showDBNotes=[[@{show_db_notes}]]}} {{DBNotes=@{defense_bonus_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showCustomMacroOne=[[@{defense_dodge_retreat_macro_one_checked}]]}} {{customMacroOne=@{defense_dodge_retreat_macro_one}}} {{showCustomMacroTwo=[[@{defense_dodge_retreat_macro_two_checked}]]}} {{customMacroTwo=@{defense_dodge_retreat_macro_two}}} {{showCustomMacroThree=[[@{defense_dodge_retreat_macro_three_checked}]]}} {{customMacroThree=@{defense_dodge_retreat_macro_three}}} {{showCustomMacroFour=[[@{defense_dodge_retreat_macro_four_checked}]]}} {{customMacroFour=@{defense_dodge_retreat_macro_four}}} {{showCustomMacroFive=[[@{defense_dodge_retreat_macro_five_checked}]]}} {{customMacroFive=@{defense_dodge_retreat_macro_five}}} {{showCustomMacroSix=[[@{defense_dodge_retreat_macro_six_checked}]]}} {{customMacroSix=@{defense_dodge_retreat_macro_six}}}" />
									</div>
								</div> <!-- .row -->

								<div class="row row-details notebox">
								
									<div class="row hide-row"></div> <!-- .row needed to cause note to have background: todo: fix css -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="text" name="attr_defense_dodge_retreat_mod_reason" title="Field name: defense_dodge_retreat_mod_reason" />
										</div>
									</div>
									<div class="header">
										<div class="title">
											<div class="popup">
												<span data-i18n="notes-label">Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="custom-success-fail-notes-tooltip">
			Success, critical success, fail, and critical fail<br />
			notes will be added to roll results.<br />
			You can add macros to these notes.<br />
			The width of these note boxes are set to help you<br />
			visualize what it will look like in chat.
												</span>
											</span>
										</div>
									</div>
									<div class="row">
										
										<div class="show-notes">
											<input type="checkbox" name="attr_defense_dodge_retreat_show_notes" value="1" style="float:left; margin-right: 5px;" />
											<div class="popup" style="float:left;">
												<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
											</div>
											<span class="tooltip">
												<span data-i18n="displayed-on-rolltemplate-tooltip">Displayed on the rolltemplate.</span>
											</span>
										</div>

									</div>
								
									<div class="rolltable-result-notes">
										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="custom-notes-label">Custom Notes:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="custom-notes-active-defense-tooltip">Add custom notes for this active defense.</span>
												</span>
											</div>
											<textarea name="attr_defense_dodge_retreat_notes" title="Field name: defense_dodge_notes" style="height: 50px"></textarea>
										</div>
										
									</div>

									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="success-note-label">Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_retreat_success_note" title="Field name: defense_dodge_retreat_success_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-success-note-label">Critical Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_retreat_critical_success_note" title="Field name: defense_dodge_retreat_critical_success_note"></textarea>
										</div>
										
									</div>
									
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div data-i18n="fail-note-label">Fail Note:</div>
											</div>
											<textarea name="attr_defense_dodge_retreat_fail_note" title="Field name: defense_dodge_retreat_fail_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
											</div>
											<textarea name="attr_defense_dodge_retreat_critical_fail_note" title="Field name: defense_dodge_retreat_critical_fail_note"></textarea>
										</div>
										
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_retreat_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_two" value="" />
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_retreat_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_three" value="" />
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_retreat_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_four" value="" />
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_retreat_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_five" value="" />
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_retreat_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_defense_dodge_retreat_macro_six" value="" />
													<input type="checkbox" name="attr_defense_dodge_retreat_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_retreat_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .row -->

							</div>

							<div class="row-static-defense">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight_dodge_drop" />
								<input class="toggle toggle-notes static-defense" type="checkbox" title="Click to show/hide more information." name="attr_defense_dodge_drop_toggle_notes" />
								<span class="checkbox static-defense"></span>
								<div class="row row-stats row-standard static-defense-width">
									<div class="cell col-dodge-label">
										<div class="popup">
											<span data-i18n="dodge-drop-ranged-label">Dodge and Drop (vs. Ranged Attacks only)</span>
										</div>
										<span class="tooltip">
											<span data-i18n="dodge-drop-ranged-tooltip">
			Dodge and Drop (Also 'Sacrificial Dodge and Drop', and 'Diving for Cover').<br/>
			It is similar to a Dodge and Retreat, but only effective against <strong>Ranged Attacks</strong>. (B377)
											</span>
										</span>
									</div>
									<div class="cell col1">
										<input type="hidden" name="attr_dodge_reduced_notes" value="0" />
										<span class="defense-note halved-dodge">
											<div class="popup">
												<b style="color:red;">½</b>
											</div>
											<span class="tooltip">
												<span data-i18n="half-dodge-tooltip">Dodge is halved due to hit points or fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span class="defense-note quartered-dodge">
											<div class="popup">
												<b style="color:red;">¼</b>
											</div>
											<span class="tooltip">
												<span data-i18n="quarter-dodge-tooltip">Dodge is quartered due to hit points and fatigue loss. See B418 or B426.</span>
											</span>
										</span>
										<span data-i18n="attribute-dodge">Dodge</span>
										<input type="hidden" name="attr_encumbrance_level" />
										<span class="defense-encumbrance-notes">
											<div class="popup">
												<span data-i18n="abbreviation-encumbrance-label">Enc</span> <span name="attr_encumbrance_level"></span>
											</div>
											<span class="tooltip">
												<span data-i18n="defense-encumbrance-notes">Dodge was reduced due to encumbrance.</span>
											</span>
										</span>
									</div>
									<div class="cell col2"></div>
									<div class="cell col2"><input type="text" name="attr_ad_dodge_drop_skill" value="@{current_dodge} + 3" disabled="disabled" title="Macro: @{NAME|ad_dodge_drop_skill}" /></div>
									<div class="cell col2"><input type="number" step="1" name="attr_ad_dodge_drop_skill_mod" value="0" title="Macro: @{NAME|ad_dodge_drop_skill_mod}" /></div>
									<div class="cell col3"><input type="text" name="attr_ad_dodge_drop_skill_final" value="@{current_dodge} + 3 + @{ad_dodge_drop_skill_mod}" disabled="disabled" title="Macro: @{NAME|ad_dodge_drop_skill_final}" /></div>
									<div class="cell col4">
										<input type="hidden" name="attr_raw_dodge_drop_success_notes" />
										<input type="hidden" name="attr_raw_dodge_drop_critical_success_notes" />
										<input type="hidden" name="attr_raw_dodge_drop_fail_notes" />
										<input type="hidden" name="attr_raw_dodge_drop_critical_fail_notes" />
										<button type="action" name="act_roll_active_defense_dodge_drop" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Defense Roll}} {{defenseType=[[1]]}} {{activeDefense=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Dodge and Drop}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[{@{ad_dodge_drop_skill_final} + @{modifier} + @{defense_roll_modifier}, @{defense_roll_max_nine_value} }kl1]]}} {{isSkillRoll=[[1]]}}{{showDodgeNotes=[[1]]}} {{dodgeReducedNotes=[[@{dodge_reduced_notes}]]}} {{dodgeEncumbrancePenalty=@{encumbrance_level}}} {{useModTool=[[1]]}} {{maxNine=[[@{defense_roll_max_nine}]]}} {{rollModifier=[[@{defense_roll_modifier}]]}} {{rollModifierSummary=@{defense_roll_modifier_summary}}} {{rollTraitSummary=@{defense_roll_trait_summary}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{showNotes=[[@{defense_dodge_drop_show_notes}]]}} {{notes=@{defense_dodge_drop_notes}}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{raw_dodge_drop_success_notes}}} {{rawCriticalSuccessNote=@{raw_dodge_drop_critical_success_notes}}} {{rawFailNote=@{raw_dodge_drop_fail_notes}}} {{rawCriticalFailNote=@{raw_dodge_drop_critical_fail_notes}}} {{customSuccessNote=@{defense_dodge_drop_success_note}}} {{customCriticalSuccessNote=@{defense_dodge_drop_critical_success_note}}} {{customFailNote=@{defense_dodge_drop_fail_note}}} {{customCriticalFailNote=@{defense_dodge_drop_critical_fail_note}}} {{showDBNotes=[[@{show_db_notes}]]}} {{DBNotes=@{defense_bonus_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showCustomMacroOne=[[@{defense_dodge_drop_macro_one_checked}]]}} {{customMacroOne=@{defense_dodge_drop_macro_one}}} {{showCustomMacroTwo=[[@{defense_dodge_drop_macro_two_checked}]]}} {{customMacroTwo=@{defense_dodge_drop_macro_two}}} {{showCustomMacroThree=[[@{defense_dodge_drop_macro_three_checked}]]}} {{customMacroThree=@{defense_dodge_drop_macro_three}}} {{showCustomMacroFour=[[@{defense_dodge_drop_macro_four_checked}]]}} {{customMacroFour=@{defense_dodge_drop_macro_four}}} {{showCustomMacroFive=[[@{defense_dodge_drop_macro_five_checked}]]}} {{customMacroFive=@{defense_dodge_drop_macro_five}}} {{showCustomMacroSix=[[@{defense_dodge_drop_macro_six_checked}]]}} {{customMacroSix=@{defense_dodge_drop_macro_six}}}" />
									</div>
								</div> <!-- .row -->

								<div class="row row-details notebox">
								
									<div class="row hide-row"></div> <!-- .row needed to cause note to have background: todo: fix css -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="text" name="attr_defense_dodge_drop_mod_reason" title="Field name: defense_dodge_drop_mod_reason" />
										</div>
									</div>
									<div class="header">
										<div class="title">
											<div class="popup">
												<span data-i18n="notes-label">Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="custom-success-fail-notes-tooltip">
			Success, critical success, fail, and critical fail<br />
			notes will be added to roll results.<br />
			You can add macros to these notes.<br />
			The width of these note boxes are set to help you<br />
			visualize what it will look like in chat.
												</span>
											</span>
										</div>
									</div>
									<div class="row">
										
										<div class="show-notes">
											<input type="checkbox" name="attr_defense_dodge_drop_show_notes" value="1" style="float:left; margin-right: 5px;" />
											<div class="popup" style="float:left;">
												<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
											</div>
											<span class="tooltip">
												<span data-i18n="displayed-on-rolltemplate-tooltip">Displayed on the rolltemplate.</span>
											</span>
										</div>

									</div>
								
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="custom-notes-label">Custom Notes:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="custom-notes-active-defense-tooltip">Add custom notes for this active defense.</span>
												</span>
											</div>
											<textarea name="attr_defense_dodge_drop_notes" title="Field name: defense_dodge_drop_notes" style="height: 50px"></textarea>
										</div>
										
									</div>

									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="success-note-label">Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_drop_success_note" title="Field name: defense_dodge_drop_success_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-success-note-label">Critical Success Note:</span>
											</div>
											<textarea name="attr_defense_dodge_drop_critical_success_note" title="Field name: defense_dodge_drop_critical_success_note"></textarea>
										</div>
										
									</div>
									
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div data-i18n="fail-note-label">Fail Note:</div>
											</div>
											<textarea name="attr_defense_dodge_drop_fail_note" title="Field name: defense_dodge_drop_fail_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
											</div>
											<textarea name="attr_defense_dodge_drop_critical_fail_note" title="Field name: defense_dodge_drop_critical_fail_note"></textarea>
										</div>
										
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_defense_dodge_drop_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_drop_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_two" value="" />
													<input type="checkbox" name="attr_defense_dodge_drop_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_drop_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_three" value="" />
													<input type="checkbox" name="attr_defense_dodge_drop_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_drop_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_four" value="" />
													<input type="checkbox" name="attr_defense_dodge_drop_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_drop_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_five" value="" />
													<input type="checkbox" name="attr_defense_dodge_drop_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_dodge_drop_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_defense_dodge_drop_macro_six" value="" />
													<input type="checkbox" name="attr_defense_dodge_drop_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_dodge_drop_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .row -->

							</div>
							
							<div class="row-static-defense">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight_knockback" />
								<input class="toggle toggle-notes static-defense" type="checkbox" title="Click to show/hide more information." name="attr_defense_knockback_toggle_notes" />
								<span class="checkbox static-defense"></span>
								<div class="row row-stats row-standard static-defense-width">
									<div class="cell col-dodge-label">
										<div class="popup">
											<span data-i18n="knockback-save-label">Knockback save vs crushing or cutting attacks</span>
										</div>
										<span class="tooltip">
											<span data-i18n="knockback-tooltip">
			A <b>crushing</b> attack can cause knockback regardless of whether it penetrates DR.<br />
			A <b>cutting</b> attack can cause knockback only if it fails to penetrate DR.<br />
			For every full ST-2 damage (<b>BEFORE</b> subtracting DR) target is moved yard <i>away</i> from attacker.<br />
			<i>NOTE:</i> If target has no ST score (like a wall) or is not resisting, use HP instead.<br /><br />
			<b>If knocked back</b>, Roll against DX, Acrobatics, or Judo.<br />
			-1 per yard of knockback <b>AFTER</b> the first yard.<br />
			+4 for Perfect Balance. see B378.<br />
			If target collides with an object, use yards knocked back to calculate <i>Collisions and Falls</i> (see Combat Tools).
										</span>
									</div>
									<div class="cell col-dodge"></div>
									<div class="cell col1-plus-col2">
										<input type="hidden" name="attr_knockback_points" value="" />
										<span data-i18n="knockback-calculation-description">1 yard per <b><span name="attr_knockback_points"></span></b> points</span> 
									</div>
									<div class="cell col2"><input type="text" name="attr_ad_knockback_skill" value="10" title="Macro: @{NAME|ad_knockback_skill}" /></div>
									<div class="cell col2"><input type="number" step="1" name="attr_ad_knockback_skill_mod" value="0" title="Macro: @{NAME|ad_knockback_skill_skill_mod}" /></div>
									<div class="cell col3"><input type="text" name="attr_ad_knockback_skill_final" value="@{ad_knockback_skill} + @{ad_knockback_skill_mod}" disabled="disabled" title="Macro: @{NAME|ad_knockback_skill_final}" /></div>
									<div class="cell col4">
										<input type="hidden" name="attr_raw_knockback_success_notes" value="Avoided falling prone, but check for collision." />
										<input type="hidden" name="attr_raw_knockback_critical_success_notes" value="Avoided falling prone, but check for collision." />
										<input type="hidden" name="attr_raw_knockback_fail_notes" value="Fall prone, but check for collision." />
										<input type="hidden" name="attr_raw_knockback_critical_fail_notes" value="Fall prone, but check for collision." />
										<button type="action" name="act_roll_active_defense_knockback" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Defense Roll}} {{defenseType=[[1]]}} {{activeDefense=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Avoid Knockback}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[{@{ad_knockback_skill_final} + @{modifier} + @{defense_roll_modifier}, @{defense_roll_max_nine_value} }kl1]]}} {{isSkillRoll=[[1]]}} {{useModTool=[[1]]}} {{maxNine=[[@{defense_roll_max_nine}]]}} {{rollModifier=[[@{defense_roll_modifier}]]}} {{rollModifierSummary=@{defense_roll_modifier_summary}}} {{rollTraitSummary=@{defense_roll_trait_summary}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{showNotes=[[@{defense_knockback_show_notes}]]}} {{notes=@{defense_knockback_notes}}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rawSuccessNote=@{raw_knockback_success_notes}}} {{rawCriticalSuccessNote=@{raw_knockback_critical_success_notes}}} {{rawFailNote=@{raw_knockback_fail_notes}}} {{rawCriticalFailNote=@{raw_knockback_critical_fail_notes}}} {{customSuccessNote=@{defense_knockback_success_note}}} {{customCriticalSuccessNote=@{defense_knockback_critical_success_note}}} {{customFailNote=@{defense_knockback_fail_note}}} {{customCriticalFailNote=@{defense_knockback_critical_fail_note}}} {{showDBNotes=[[@{show_db_notes}]]}} {{DBNotes=@{defense_bonus_notes}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showCustomMacroOne=[[@{defense_knockback_macro_one_checked}]]}} {{customMacroOne=@{defense_knockback_macro_one}}} {{showCustomMacroTwo=[[@{defense_knockback_macro_two_checked}]]}} {{customMacroTwo=@{defense_knockback_macro_two}}} {{showCustomMacroThree=[[@{defense_knockback_macro_three_checked}]]}} {{customMacroThree=@{defense_knockback_macro_three}}} {{showCustomMacroFour=[[@{defense_knockback_macro_four_checked}]]}} {{customMacroFour=@{defense_knockback_macro_four}}} {{showCustomMacroFive=[[@{defense_knockback_macro_five_checked}]]}} {{customMacroFive=@{defense_knockback_macro_five}}} {{showCustomMacroSix=[[@{defense_knockback_macro_six_checked}]]}} {{customMacroSix=@{defense_knockback_macro_six}}}" />
									</div>
								</div> <!-- .row -->

								<div class="row row-details notebox">
								
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="link-label">Link:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="link-to-row-id-tooltip">Link this row to another row item.</span>
											</span> 
										</div>
										<input type="hidden" name="attr_knockback_defense_row_type" value="Skill" />
										<div class="cell">
											<select name="attr_knockback_defense_row_type">
												<option value="" data-i18n="option-select">--Select--</option>
												<option value="Skill" data-i18n="option-skill">Skill</option>
												<option value="Technique" data-i18n="option-technique">Technique</option>
												<option value="Spell" data-i18n="option-spell">Spell</option>
												<option value="ST" data-i18n="option-strength">ST</option>
												<option value="STRIKING" data-i18n="option-striking-strength">Striking ST</option>
												<option value="DX" data-i18n="option-dexterity" selected>DX</option>
												<option value="IQ" data-i18n="option-intelligence">IQ</option>
												<option value="WILL" data-i18n="option-will">WILL</option>
												<option value="HT" data-i18n="option-health">HT</option>
												<option value="10">10</option>
											</select>
										</div>
										<div class="cell col-row-id label show-hide-row-id">
											<div class="popup">
												<span data-i18n="row-id-label">Row ID:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="copy-paste-row-id-tooltip">
			Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
			When the skill/spell is updated, the technique's parent name and base skill level<br />
			will be updated.<br />
			Once entered, this will change the Skill/Spell for this particular attack to match<br />
			the skill/spell level of the Base Skill. Do not change this skill Level number manually.
												</span>
											</span>	
										</div>
										<div class="cell col-input-medium show-hide-row-id">
											<input type="text" name="attr_defense_knockback_skill_row_id" title="Field name: defense_knockback_skill_row_id" />
										</div>
										<div class="cell col-wide">
										
											<b><span data-i18n="name-label">Name:</span></b>
											<input type="hidden" name="attr_defense_knockback_skill_row_id_message" value="" />
											<span name="attr_defense_knockback_skill_row_id_message"></span>
											
											<b><span data-i18n="skill-level-label">Level</span>:</b>
											<input type="hidden" name="attr_defense_knockback_skill_row_id_level" value="" />
											<span name="attr_defense_knockback_skill_row_id_level"></span>
										
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="number" value="0" step="1" name="attr_defense_knockback_mod_reason" title="Field name: defense_knockback_mod_reason" />
										</div>
									</div>
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="knockback-hitpoints-modifier-label">HP per yard Modifier:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="knockback-hitpoints-modifier-tooltip">Modify the number of hit points required for knockback.<br />For skinny, special rules, etc.</span>
											</span> 
										</div>
										<div class="cell col-input-number">
											<input type="text" name="attr_defense_knockback_hitpoints_mod" title="Field name: defense_knockback_hitpoints_mod" />
										</div>
									</div>

									<div class="header">
										<div class="title">
											<div class="popup">
												<span data-i18n="notes-label">Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="custom-success-fail-notes-tooltip">
			Success, critical success, fail, and critical fail<br />
			notes will be added to roll results.<br />
			You can add macros to these notes.<br />
			The width of these note boxes are set to help you<br />
			visualize what it will look like in chat.
												</span>
											</span>
										</div>
									</div>
									<div class="row">
										
										<div class="show-notes">
											<input type="checkbox" name="attr_defense_knockback_show_notes" value="1" style="float:left; margin-right: 5px;" />
											<div class="popup" style="float:left;">
												<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
											</div>
											<span class="tooltip">
												<span data-i18n="displayed-on-rolltemplate-tooltip">Displayed on the rolltemplate.</span>
											</span>
										</div>

									</div>
								
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="custom-notes-label">Custom Notes:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="custom-notes-active-defense-tooltip">Add custom notes for this active defense.</span>
												</span>
											</div>
											<textarea name="attr_defense_knockback_notes" title="Field name: defense_knockback_notes" style="height: 50px"></textarea>
										</div>
										
									</div>

									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="success-note-label">Success Note:</span>
											</div>
											<textarea name="attr_defense_knockback_success_note" title="Field name: defense_knockback_success_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-success-note-label">Critical Success Note:</span>
											</div>
											<textarea name="attr_defense_knockback_critical_success_note" title="Field name: defense_knockback_critical_success_note"></textarea>
										</div>
										
									</div>
									
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div data-i18n="fail-note-label">Fail Note:</div>
											</div>
											<textarea name="attr_defense_knockback_fail_note" title="Field name: defense_knockback_fail_note"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
											</div>
											<textarea name="attr_defense_knockback_critical_fail_note" title="Field name: defense_knockback_critical_fail_note"></textarea>
										</div>
										
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_defense_knockback_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_defense_knockback_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_defense_knockback_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_knockback_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_defense_knockback_macro_two" value="" />
													<input type="checkbox" name="attr_defense_knockback_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_knockback_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_defense_knockback_macro_three" value="" />
													<input type="checkbox" name="attr_defense_knockback_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_knockback_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_defense_knockback_macro_four" value="" />
													<input type="checkbox" name="attr_defense_knockback_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_knockback_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_defense_knockback_macro_five" value="" />
													<input type="checkbox" name="attr_defense_knockback_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_defense_knockback_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_defense_knockback_macro_six" value="" />
													<input type="checkbox" name="attr_defense_knockback_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_defense_knockback_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .row -->

							</div>

							<fieldset class="repeating_defense">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
								<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_defense_toggle_notes" />
								<span class="checkbox"></span>
								<div class="row row-stats">
									<div class="cell col0">
										<input type="text" name="attr_name" title="Macro: @{NAME|repeating_defense_$[row #]_name}" />
										<input type="hidden" name="attr_idkey" />
										<input type="hidden" name="attr_new" value="1" />
									</div>
									<div class="cell col1">
										<input type="hidden" name="attr_defense_type" value="0" />
										<select name="attr_type" title="Macro: @{NAME|repeating_defense_$[row #]_type}">
											<option value="Dodge" data-i18n="option-dodge">Dodge</option>
											<option value="Parry" data-i18n="option-parry">Parry</option>
											<option value="Unarmed Parry" data-i18n="option-unarmed-parry">Unarmed Parry</option>
											<option value="Block" data-i18n="option-block">Block</option>
											<option value="Magic" data-i18n="option-magic">Magic</option>
											<option value="Power Dodge" data-i18n="option-power-dodge">Power Dodge</option>
											<option value="Power Parry" data-i18n="option-power-parry">Power Parry</option>
											<option value="Power Block" data-i18n="option-power-block-physical">Power Block - Physical</option>
											<option value="Power Block Mental" data-i18n="option-power-block-mental">Power Block - Mental</option>
											<option value="Other" data-i18n="option-other">Other</option>
										</select>
									</div>
									<div class="cell col2">
										<input type="text" name="attr_info" title="Macro: @{NAME|repeating_defense_$[row #]_info}" />
									</div>
									<div class="cell col2">
										<input type="number" step="1" value="10" name="attr_skill" title="Macro: @{NAME|repeating_defense_$[row #]_skill}" />
									</div>
									<div class="cell col2">
										<input type="number" step="1" value="0" name="attr_skill_mod" title="Macro: @{NAME|repeating_defense_$[row #]_skill_mod}" />
									</div>
									<div class="cell col3">
										<input type="text" name="attr_skill_final" value="@{skill} + @{skill_mod} + @{defense_combat_reflexes_bonus}" disabled="disabled" title="Macro: @{NAME|repeating_defense_$[row #]_skill_final}" />
									</div>
									<div class="cell col4">
										<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{useModTool=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{popupModifier=@{popup_modifier}}} {{showDBNotes=[[@{show_db_notes}]]}} {{DBNotes=@{defense_bonus_notes}}} {{rollModifier=[[@{defense_roll_modifier}]]}} {{rollModifierSummary=@{defense_roll_modifier_summary}}}" />
									</div>
								</div> <!-- .row -->
								
								<div class="row row-details notebox">
								
									<input type="hidden" name="attr_type" />
									<input type="hidden" name="attr_defense_row_type" />
									<div class="row active-defense-formula">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="formula-label">Formula:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="active-defense-formula-tooltip">Formula is based upon the active defense type.</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<div class="formula formula-as-is">
												<span data-i18n="formula-as-is-description">Enter a value or use the linked item value as is.</span>
											</div>
											<div class="formula formula-parry">
												<span data-i18n="formula-parry-description">3 + (Skill or DX)/2, rounded down</span>
											</div>
											<div class="formula formula-block">
												<span data-i18n="formula-block-description">3 + (Shield or Cloak skill)/2, rounded down.</span>
											</div>
											<div class="formula formula-power-dodge">
												<span data-i18n="power-dodge-description">Basic Speed + 3 + Talent/2, rounded down.</span>
											</div>
											<div class="formula formula-power-parry">
												<span data-i18n="power-parry-description">3 + (Innate Attack Skill + Talent)/2, rounded down.</span>
											</div>
											<div class="formula formula-power-block-physical">
												<span data-i18n="power-block-physical-description">3 + (HT + Talent)/2, rounded down.</span>
											</div>
											<div class="formula formula-power-block-mental">
												<span data-i18n="power-block-mental-description">3 + (WILL + Talent)/2, rounded down.</span>
											</div>
											<div class="formula formula-base-dodge">
												<span data-i18n="formula-base-dodge-description">Base Dodge attribute.</span>
											</div>
											<div class="formula formula-current-dodge">
												<span data-i18n="formula-current-dodge-description">Current Dodge affected by current conditions. Combat Reflexes checkbox to the right is not used.</span>
											</div>
										</div>
										<div class="cell formula-combat-reflexes">
											<b><span data-i18n="combat-reflexes-label">Combat Reflexes:</span></b>
											<input type="checkbox" value="1" name="attr_defense_combat_reflexes" />
											<input type="hidden" value="0" name="attr_defense_combat_reflexes_bonus" />
										</div>

									</div>

									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="link-label">Link:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="link-to-row-id-tooltip">Link this row to another row item.</span>
											</span> 
										</div>
										<div class="cell">
											<select name="attr_defense_row_type">
												<option value="" data-i18n="option-select">--Select--</option>
												<option value="Skill" data-i18n="option-skill">Skill</option>
												<option value="Technique" data-i18n="option-technique">Technique</option>
												<option value="Spell" data-i18n="option-spell">Spell</option>
												<option value="Melee" data-i18n="option-melee-weapon">Melee Weapon</option>
												<option value="ST" data-i18n="option-strength">ST</option>
												<option value="STRIKING" data-i18n="option-striking-strength">Striking ST</option>
												<option value="DX" data-i18n="option-dexterity">DX</option>
												<option value="IQ" data-i18n="option-intelligence">IQ</option>
												<option value="WILL" data-i18n="option-will">WILL</option>
												<option value="HT" data-i18n="option-health">HT</option>
												<option value="SPEED" data-i18n="option-basic-speed">Basic Speed</option>
												<option value="DODGE" data-i18n="option-dodge">Dodge</option>
												<option value="CURRENT_DODGE" data-i18n="option-current-dodge">Current Dodge</option>
												<option value="10">10</option>
											</select>
										</div>
										<div class="cell col-row-id label show-hide-row-id">
											<div class="popup">
												<span data-i18n="row-id-label">Row ID:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="copy-paste-row-id-tooltip">
			Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
			When the skill/spell is updated, the technique's parent name and base skill level<br />
			will be updated.<br />
			Once entered, this will change the Skill/Spell for this particular attack to match<br />
			the skill/spell level of the Base Skill. Do not change this skill Level number manually.
												</span>
											</span>	
										</div>
										<div class="cell col-input-medium show-hide-row-id">
											<input type="hidden" name="attr_defense_skill_row_id_toggle" value="0" />
											<input type="text" name="attr_defense_skill_row_id" title="Macro: @{NAME|repeating_defense_$[row #]_defense_skill_row_id}" />
										</div>
										
									</div> <!-- .row -->

									<div class="row linked-stats">

										<div class="cell">
											<input type="hidden" name="attr_skill" value="" />
											<b><span data-i18n="name-label">Name:</span></b>
											<input type="hidden" name="attr_defense_skill_row_id_message" value="" />
											<span name="attr_defense_skill_row_id_message"></span>
										</div>		
										
										<div class="cell">
											<b><span data-i18n="skill-level-label">Level</span>:</b>
											<input type="hidden" name="attr_defense_skill_row_id_level" value="" />
											<span name="attr_defense_skill_row_id_level"></span>
										</div>

										<div class="cell formula-talent" style="margin-right:2px;">
											<div class="popup">	
												<b><span data-i18n="talent-level-label">Talent Level:</span></b>
											</div>
											<span class="tooltip">
												<span data-i18n="talent-level-tooltip">For use with Power Dodge, Power Parry, and Power Blocks formulas.</span>
											</span> 
										</div>

										<div class="cell" style="width: 25px;">
											<input type="number" value="0" step="1" min="0" name="attr_defense_talent_level" />
										</div>

										<div class="cell">
											<b><span data-i18n="formula-level-label">Formula Level:</span></b>
											<input type="hidden" name="attr_defense_formula_level" value="" />
											<span name="attr_defense_formula_level"></span>
										</div>
											
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="text" name="attr_defense_mod_reason" title="Macro: @{NAME|repeating_defense_$[row #]_defense_mod_reason}" />
										</div>
									</div>

									<div class="row weapon-parry">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="weapon-weight-label">Weapon Weight</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="weapon-weight-tooltip">Enter the weight of the weapon. Used to calculate the maximum weight the weapon can parry before it must check for breakage. B376.</span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<input type="text" name="attr_weapon_weight" value="1" class="medium-width" title="Macro: @{NAME|repeating_defense_$[row #]_weapon_weight}" />
											<input type="hidden" name="attr_attacking_weapon_weight_x3" value="3"/>
											<input type="hidden" name="attr_attacking_weapon_weight_x4" value="4"/>
											<input type="hidden" name="attr_attacking_weapon_weight_x5" value="5"/>
											<input type="hidden" name="attr_attacking_weapon_weight_x6" value="6"/>
											<input type="hidden" name="attr_attacking_weapon_weight_x7" value="7"/>
											<input type="hidden" name="attr_attacking_weapon_basic_lift" value="39"/>
											<input type="hidden" name="attr_attacking_weapon_basic_lift_x2" value="78"/>
											<input type="hidden" name="attr_weapon_weight_system" value="lbs"/>
										</div>
									</div>

									<div class="row weapon-parry weapon-parry-summary">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="parry-heavy-weapon-label">Parry Heavy Weapon</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="parry-heavy-weapon-tooltip">If the attacking weapon is three times heavier or more, your weapon may break.<br /> If weapon breaks, parry <i>counts</i> <b>unless</b> the odds of breakage exceeds 6 in 6. B376.<br />Modifiers: <ul><li>+2 cheap weapon</li><li>-1 fine weapon</li><li>-2 very fine weapon</li></ul></span>
											</span> 
										</div>
										<div class="cell col-input-wide">
											<span name="attr_attacking_weapon_weight_x3"></span> up to <span name="attr_attacking_weapon_weight_x4"></span> <span name="attr_weapon_weight_system"></span>: <b class="alert">1-2</b> on d6 | 
											<span name="attr_attacking_weapon_weight_x4"></span> up to <span name="attr_attacking_weapon_weight_x5"></span> <span name="attr_weapon_weight_system"></span>: <b class="alert">1-3</b> on d6 <br />
											<span name="attr_attacking_weapon_weight_x5"></span> up to <span name="attr_attacking_weapon_weight_x6"></span> <span name="attr_weapon_weight_system"></span>: <b class="alert">1-4</b> on d6 |
											<span name="attr_attacking_weapon_weight_x6"></span> up to <span name="attr_attacking_weapon_weight_x7"></span> <span name="attr_weapon_weight_system"></span>: <b class="alert">1-5</b> on d6 <br />
											<span name="attr_attacking_weapon_weight_x7"></span> <span name="attr_weapon_weight_system"></span> or more: <b class="alert">1-6</b> on d6<br />
											Unarmed/1-handed can't parry <b class="alert"><span name="attr_attacking_weapon_basic_lift"></span></b>+ <span name="attr_weapon_weight_system"></span>. | 
											2-handed can't parry <b class="alert"><span name="attr_attacking_weapon_basic_lift_x2"></span></b>+ <span name="attr_weapon_weight_system"></span>.
										</div>
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="notes-label">Notes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-success-fail-notes-tooltip">
			Success, critical success, fail, and critical fail<br />
			notes will be added to roll results.<br />
			You can add macros to these notes.<br />
			The width of these note boxes are set to help you<br />
			visualize what it will look like in chat.
											</span>
										</span>
									</div>
									<div class="row">
										
										<div class="show-notes">
											<input type="checkbox" name="attr_show_notes" value="1" style="float:left; margin-right: 5px;" />
											<div class="popup" style="float:left;">
												<span data-i18n="show-notes-below-label">Show notes below in roll template</span>	
											</div>
											<span class="tooltip">
												<span data-i18n="displayed-on-rolltemplate-tooltip">Displayed on the rolltemplate.</span>
											</span>
										</div>

									</div>
								
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="abbreviation-information-notes">INFO Notes</span>
												</div>
												<span class="tooltip">
													<span data-i18n="fencing-unbalanced-tooltip">
			If you enter F or U under the <b>INFO</b> column, the notes <br />
			below will be <b>replaced</b> with appropriate notes. <br />
			Any other value, and the text box will get <b>cleared</b> out.<br />
													</span>
												</span>
											</div>
											<textarea name="attr_info_description" title="Macro: @{NAME|repeating_defense_$[row #]_info_description}" style="height: 50px"></textarea>
										</div>

										<div class="note-input">
											<div class="note-title">
												<div class="popup">
													<span data-i18n="custom-notes-label">Custom Notes:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="custom-notes-active-defense-tooltip">Add custom notes for this active defense.</span>
												</span>
											</div>
											<textarea name="attr_notes" title="Macro: @{NAME|repeating_defense_$[row #]_notes}" style="height: 50px"></textarea>
										</div>
										
									</div>

									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="success-note-label">Success Note:</span>
											</div>
											<input type="hidden" name="attr_raw_success_note" />
											<textarea name="attr_defense_success_note" title="Macro: @{NAME|repeating_defense_$[row #]_defense_success_note}"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-success-note-label">Critical Success Note:</span>
											</div>
											<input type="hidden" name="attr_raw_critical_success_note" />
											<textarea name="attr_defense_critical_success_note" title="Macro: @{NAME|repeating_defense_$[row #]_defense_critical_success_note}"></textarea>
										</div>
										
									</div>
									
									<div class="rolltable-result-notes">
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="fail-note-label">Fail Note:</span>
											</div>
											<input type="hidden" name="attr_raw_fail_note" />
											<textarea name="attr_defense_fail_note" title="Macro: @{NAME|repeating_defense_$[row #]_defense_fail_note}"></textarea>
										</div>
										
										<div class="note-input">
											<div class="note-title">
												<span data-i18n="critical-fail-note-label">Critical Fail Note:</span>
											</div>
											<input type="hidden" name="attr_raw_critical_fail_note" />
											<textarea name="attr_defense_critical_fail_note" title="Macro: @{NAME|repeating_defense_$[row #]_defense_critical_fail_note}"></textarea>
										</div>
										
									</div>

									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_macro_two" value="" />
													<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_macro_three" value="" />
													<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_macro_four" value="" />
													<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_macro_five" value="" />
													<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_macro_six" value="" />
													<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .row -->
								
							</fieldset> <!-- .repeating_defense -->

							<!-- _____ _____ DEFENSE BONUS BOX _____ _____ -->
							<div class="box defense-bonus-notes textarea">
								
								<div class="combat-reflexes">
									
									<div style="float: left;">
										<input type="hidden" name="attr_reflexes_converted_to_base_skill" value="0" />
										<input type="hidden" name="attr_reflex_mods_added" value="0" />
										<input type="checkbox" class="boolean combat-reflex-check" name="attr_combat_reflexes" value="1" />
										<div class="popup">
											<span data-i18n="apply-combat-reflexes-label">Apply Combat Reflexes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="apply-combat-reflexes-tooltip">Quickly add +1 Dodge modifier and +2 Fright modifier on the General page. (B43)</span>
										</span>
									</div>

									<div style="float: left;"   >
										<input type="checkbox" class="boolean combat-reflex-check" name="attr_show_db_notes" value="1" />
										<div class="popup">
											<span data-i18n="show-defense-bonus-label">Show DB Notes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="show-defense-bonus-tooltip">Show Defense Bonus Notes in roll results.</span>
										</span>
									</div>

								</div> <!-- .row -->
								
								<div class="header">
									<div>
										<div class="popup">
											<span data-i18n="defense-bonus-notes-label">Defense Bonus (DB) Notes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="defense-bonus-notes-tooltip">
				<strong>Examples:</strong><br/>
				+2 DB for Torso (Front Only), Skull, Neck, Hands, Head (1/6 Face), and Feet. Armor Enchantment: Deflect.<br/>
				+1 DB SHIELD SIDE (Left): from Small Shield.<br/>
				+1 DB for Rear only - (All but head unless hood is up). From Heavy Cloak.
											</span>
										</span>
									</div>
								</div>
								<div class="defense-bonus-notes-textarea">
									<textarea name="attr_defense_bonus_notes" title="Macro: @{NAME|defense_bonus_notes}"></textarea>
								</div>
							</div>
							
						</div> <!-- .table -->
					</div> <!-- .box .active-defense -->

					
				</div>

				<div class="melee">

					<div class="box speed-range-images">
						
						<div class="group">
							<div class="custom-checkbox">
								<label class="switch">
									<!-- if checked, user has option to select token before rolling -->
									<input type="hidden" name="attr_selected_token_macro" />
									<input type="checkbox" name="attr_selected_token" />
									<span class="icon select"></span>
								</label>
							</div>
							<div class="select-popup">
								<div class="popup">
									<span>Select</span>
								</div>
								<span class="tooltip">
									<span data-i18n="select-token-tooltip">Click the button to turn on <b>select a token</b> before the skill roll.<br />The token name will appear in the results.</span>
								</span>
							</div>
							<div class="custom-checkbox target">
								<label class="switch">
									<!-- if checked, user has option to target token before rolling -->
									<input type="hidden" name="attr_target_token_macro" />
									<input type="checkbox" name="attr_target_token" />
									<span class="icon target"></span>
								</label>
							</div>
							<div>
								<div class="popup">
									<span>Target</span>
								</div>
								<span class="tooltip">
									<span data-i18n="target-token-tooltip">Click the button to turn on <b>target a token</b> before the skill roll.<br />The token name will appear in the results.</span>
								</span>
							</div>
						</div>
						
					</div>

					<!-- MELEE MODIFIERS BOX -->
					<div class="box melee-modifiers">

						<div class="roll-modifiers-table">

							<div class="modifier-caption header">
								<div class="popup">
									<span data-i18n="melee-attack-modifiers-label">Melee Attack Modifiers</span>
								</div>
								<div class="tooltip">
									<span data-i18n="melee-attack-modifiers-tooltip">These modifiers affect all melee attack rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
								</div>
							</div>

							<div class="modifier-row">

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_show_roll_modifiers_for_melee" class="btn modifier-line-height-fix" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="summary-group">
										<div class="icon"><span data-i18n="notes-label">Notes</span></div>
										<div class="summary">
											<div class="roll-maneuver">
												<b>Maneuver:</b>
												<div>
													<textarea name="attr_melee_roll_maneuver" class="maneuver-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-all-out-attack">
												<b>All-Out Attack:</b>
												<div>
													<textarea name="attr_melee_roll_allout_attack" class="all-out-attack-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-hit-location">
												<b>Hit Location:</b>
												<div>
													<textarea name="attr_melee_roll_hit_location" class="hit-location-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-traits">
												<b>Traits:</b>
												<div>
													<textarea name="attr_melee_roll_trait_summary" class="trait-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-summary">
												<b>Summary:</b>
												<div>
													<textarea name="attr_melee_roll_modifier_summary" class="roll-summary" readonly></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="modifier-label">Modifier:</span>
									</div>
									<div class="tooltip">
										<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<input type="number" value="0" step="1" name="attr_melee_custom_roll_modifier" />	
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="reason-label">Reason</span>:
									</div>
									<div class="tooltip">
										<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<textarea class="reason-textarea" name="attr_melee_custom_roll_modifier_reason"></textarea>
								</div>

								<div class="modifier-cell">
									<input type="checkbox" name="attr_melee_roll_max_nine" value="1" title="Macro: @{NAME|melee_roll_max_nine}" />
									<input type="hidden" name="attr_melee_roll_max_nine_value" value="100" />
								</div>	

								<div class="modifier-cell modifier-align-top">
									<div class="popup">
										<b><span data-i18n="max-skill-9-label">Max skill of 9</span></b>
									</div>
									<div class="tooltip max-skill-9">
										<span data-i18n="max-skill-9-tooltip">The effective skill cannot exceed 9.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="final-modifier-label">Final Modifier</span>:
									</div>
									<div class="tooltip">
										<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="number-input">
										<input type="hidden" name="attr_melee_roll_modifier_status" value="neutral" class="modifier-status" />
										<input type="number" value="0" step="1" name="attr_melee_roll_modifier" class="final-modifier" readonly />
										<input type="hidden" value="" name="attr_melee_roll_modifier_summary" />
										<input type="hidden" value="" name="attr_melee_roll_trait_summary" />
										<input type="hidden" value="" name="attr_melee_roll_hit_location" />
										<input type="hidden" value="" name="attr_melee_roll_maneuver" />
										<input type="hidden" value="" name="attr_melee_roll_allout_attack" />
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_melee_roll_reset" class="btn tool-modifier-reset modifier-line-height-fix" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
								</div>

							</div><!-- end row -->

						</div>

					</div>

					<!-- MELEE QUICK MODIFIERS BOX -->
					<input type="hidden" name="attr_melee_quick_mod_show" value="0" />
					<div class="box melee-modifiers melee-quick-modifiers-block" style="overflow: hidden;">
						
						<div class="modifier-caption header">
							<div class="popup">
								<span data-i18n="quick-modifiers-label">Quick Modifiers</span>
							</div>
							<div class="tooltip">
								<span data-i18n="quick-modifiers-tooltip">Use the table below to create a set of custom modifiers that can be applied to your next your roll. If the modifier is checked, it will automatically be applied to the roll, but you must remember to uncheck the quick modifier if you don't want to use it.</span>
							</div>
						</div>

						<!-- #Quick Modifiers Table -->
						<div class="melee-quick-modifiers">
							<div class="grid-standard grid-melee-quick-modifier-header">
								<div class="grid-cell">&nbsp;</div>
								<div class="grid-cell">
									<span data-i18n="apply-label">Apply</span>
								</div>
								<div class="grid-cell">
									<div class="standard-tooltip">
										<span data-i18n="description-label">Description</span>
										<span class="tooltiptext">
											<span data-i18n="quick-mod-description-tooltip">Enter a useful description of the modifier.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<div class="standard-tooltip">
										<span data-i18n="modifier-no-colon-label">Modifier</span>
										<span class="tooltiptext move-far-left">
											<span data-i18n="quick-mod-tooltip">Enter an interger for the quick modifier.</span>
										</span>
									</div>
								</div>
							</div>

							<input type="hidden" name="attr_melee_quick_mod_show_in_roll" value="0" />
							<input type="hidden" name="attr_melee_quick_mod_total" value="0" />
							<input type="hidden" name="attr_melee_quick_mod_summary" value="" />
							<fieldset class="repeating_melee-quick-modifier">
								<div class="grid-standard grid-melee-quick-modifiers">
									<div class="grid-cell">
										<label class="toggle-button">
											<input type="checkbox" name="attr_toggle_notes" value="1" />
											<span></span>
										</label>
									</div>
									<div class="grid-cell">
										<input type="checkbox" name="attr_apply" value="1" title="Macro: @{NAME|repeating_melee-quick-modifier_$[row #]_apply}" />
									</div>
									<div class="grid-cell">
										<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_melee-quick-modifier_$[row #]_name}" />
									</div>
									<div class="grid-cell">
										<input type="number" name="attr_modifier" value="0" step="1" class="medium-width" title="Macro: @{NAME|repeating_melee-quick-modifier_$[row #]_percent}" />
									</div>
									<input type="hidden" name="attr_toggle_notes" />
									<div class="expandable-section">
										<h4><span data-i18n="notes-label">Notes</span></h4>
										<textarea name="attr_notes"></textarea>
									</div>
								</div>
							</fieldset>
						</div>								

					</div>

					<!-- _____ _____ MELEE ATTACKS BOX _____ _____ -->
					<div class="box melee-attacks">
						<div class="table">
							<div class="header">
								<div class="cell col-mod-tool">
									<!-- <input class="toggle-mod-tool" disabled="disabled" value="1" type="checkbox" title="Click to show/hide attack modifiers." name="attr_toggle_melee_mod_tool" /> -->
									<span class="icon">y</span>
								</div>
								<div class="cell col0">
									<div class="popup">
										<span data-i18n="melee-attacks-label">Melee Attacks</span>	
									</div>
									<span class="tooltip">
										<span data-i18n="melee-roll-modifier-tooltip">You can use the <b>Roll Modifiers Bar</b> or the <b>Roll Modifiers Tool Box</b> to modifier the effective skill.</span>
									</span>
								</div>
								<div class="cell col1">
									<div class="popup"><span data-i18n="damage-label">Damage</span></div>
									<span class="tooltip">
										<span data-i18n="melee-attack-damage-tooltip">For an <strong>Armor Divisor</strong>: A number in parenthesis after<br />the damage - eg. (2) - is an armor divisor.<br />Enter this number in the <strong>Damage Notes</strong> as AD(#)  or as<br />Armor Divisor(#).<br /><strong>ex</strong>: indicates the attack causes an explosion.<br />See B269. Enter in the <strong>Damage Notes</strong></span>
									</span>
								</div>
								<div class="cell col2"> </div>
								<div class="cell col3">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<span class="tooltip">
										<span data-i18n="damage-type-tooltip">
			<table>
				<thead>
					<tr>
						<th>Abbr</th>
						<th>Name</th>
					</tr>
				</thead>
				<tbody>
					<tr><td>aff</td> <td>Affliction</td></tr>
					<tr><td>burn</td><td>Burning</td></tr>
					<tr><td>cor</td> <td>Corrosion</td></tr>
					<tr><td>cr</td>  <td>Crushing</td></tr>
					<tr><td>cut</td> <td>Cutting</td></tr>
					<tr><td>fat</td> <td>Fatigue</td></tr>
					<tr><td>imp</td> <td>Impaling</td></tr>
					<tr><td>pi-</td> <td>Small Piercing</td></tr>
					<tr><td>pi</td>  <td>Piercing</td></tr>
					<tr><td>pi+</td> <td>Large Piercing</td></tr>
					<tr><td>pi++</td><td>Huge Piercing</td></tr>
					<tr><td>spec</td><td>Special</td></tr>
					<tr><td>tox</td> <td>Toxic</td></tr>
				</tbody>
			</table>
										</span>
									</span>
								</div>
								<div class="cell col4">
									<div class="popup">
										<span data-i18n="reach-label">Reach</span>
									</div>
									<span class="tooltip">
										<span data-i18n="melee-reach-tooltip">
			The distance in yards that the weapon can reach.<br />
			<strong>C</strong>: this weapon can be used in close combat.<br />
			<strong>*</strong>: the weapon is awkward, and requires a Ready<br />
			maneuver to switch between different reaches.
										</span>
									</span>
								</div>
								<div class="cell col5">
									<span style="background-color: #87CEFA">| <span data-i18n="skill-label">Skill</span> |</span>
								</div>

							</div> <!-- .header -->

							<!-- RAW notes for melee and ranged attacked -->
							<input type="hidden" name="attr_raw_critical_hit_notes" value="" />
							<input type="hidden" name="attr_raw_hit_notes" value="" />
							<input type="hidden" name="attr_raw_miss_notes" value="" />
							<input type="hidden" name="attr_raw_critical_miss_notes" value="" />

							<fieldset class="repeating_melee">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
								<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_melee_toggle_notes" />
								<span class="checkbox"></span>
								<div class="row row-stats">
									<div class="cell col0">
										<!-- idkey is the key used by either GCA or GCS. Can be used to update and advantage instead of just adding -->
										<input type="hidden" name="attr_idkey" />
										<input type="text" name="attr_name" title="Macro: @{NAME|repeating_melee_$[row #]_name}" />
									</div>
									<div class="cell col1">
										<input type="text" name="attr_damage" title="Macro: @{NAME|repeating_melee_$[row #]_damage}" />
									</div>
									<div class="cell col2">
										<input type="hidden" name="attr_damage_dice_icon" class="melee-damage-dice-icon" value="explode" />
										<button type="action" name="act_rolldamage" class="roll_damage" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Melee Damage}} {{characterName=@{character_name}}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}}"></button>
									</div>
									<div class="cell col3">
										<select name="attr_type" title="Macro: @{NAME|repeating_melee_$[row #]_type}">
											<option value="Affliction (aff)" data-i18n="abbreviation-option-affliction">aff</option>
											<option value="Burning (burn)" data-i18n="abbreviation-option-burning">burn</option>
											<option value="Corrosion (cor)" data-i18n="abbreviation-option-corrosion">cor</option>
											<option value="Crushing (cr)" data-i18n="abbreviation-option-crushing">cr</option>
											<option value="Cutting (cut)" data-i18n="abbreviation-option-cutting">cut</option>
											<option value="Fatigue (fat)" data-i18n="abbreviation-option-fatigue">fat</option>
											<option value="Impaling (imp)" data-i18n="abbreviation-option-impaling">imp</option>
											<option value="Small Piercing (pi-)" data-i18n="abbreviation-option-piercing-minus">pi-</option>
											<option value="Piercing (pi)" data-i18n="abbreviation-option-piercing">pi</option>
											<option value="Large Piercing (pi+)" data-i18n="abbreviation-option-piercing-plus">pi+</option>
											<option value="Huge Piercing (pi++)" data-i18n="abbreviation-option-piercing-plus-plus">pi++</option>
											<option value="Special (spec)" data-i18n="abbreviation-option-special">spec</option>
											<option value="Knockback (knock)" data-i18n="abbreviation-option-knockback">knock</option>
											<option value="Toxic (tox)" data-i18n="abbreviation-option-toxic">tox</option>
										</select>
										<input type="hidden" name="attr_damage_type_note" value="@{damage_type_note_aff}" />
										<input type="hidden" name="attr_minimum_damage_note" value="Min 1" />
										<input type="hidden" name="attr_minimum_damage" value="0" />
									</div>
									<div class="cell col4">
										<input type="text" name="attr_reach" title="Macro: @{NAME|repeating_melee_$[row #]_reach}" />
									</div>
									<div class="cell col5">
										<input type="text" name="attr_skill" title="Macro: @{NAME|repeating_melee_$[row #]_skill}" />
									</div>
									<div class="cell col6">
										<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Melee Attack}} {{selected=@{selected_token_macro}}} {{target1=@{target_token_macro}}} {{characterName=@{character_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{useModTool=[[1]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[1]]}} {{notesTitlePrefix=Weapon}} {{showRawDefenseNotes=[[@{show_raw_defensive_notes}]]}} {{rollModifier=[[@{melee_roll_modifier}]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{rollModifierSummary=@{melee_roll_modifier_summary}}} {{quickModShow=[[@{melee_quick_mod_show_in_roll}]]}} {{quickModTotal=[[@{melee_quick_mod_total}]]}} {{quickModSummary=@{melee_quick_mod_summary}}} {{weightSystem=@{weight_system}}}" />
									</div>
								</div> <!-- .row -->

								<div class="melee-notebox">

									<div class="row">
										<div class="cell">
											<button type="action" name="act_duplicate" class="btn positive-action" title="Clicking the Duplicate button will copy this weapon's entry and automatically add it to the field set here.">Duplicate</button>
										</div>
									</div>
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="row-id-label">Row ID:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-row-id-tooltip">Use the melee row id to link an active defense to this skill.<br />This allows you to use your enhanced skill with this weapon for parries.</span>
											</span> 
										</div>
										<div class="cell">
											<input type="text" readonly="readonly" name="attr_row_id" value="" />
										</div>
									</div> <!-- .row -->


									<div class="row">
										<!-- hidden input is used to show/hide Row ID: based on selection -->
										<input type="hidden" name="attr_melee_row_type" value="Skill" />
										<div class="cell margin-right">
											<select name="attr_melee_row_type">
												<option value="Skill" data-i18n="option-skill">Skill</option>
												<option value="Spell" data-i18n="option-spell">Spell</option>
												<option value="Technique" data-i18n="option-technique">Technique</option>
												<option value="ST" data-i18n="option-strength">ST</option>
												<option value="STRIKING" data-i18n="option-striking-strength">Striking ST</option>
												<option value="DX" data-i18n="option-dexterity">DX</option>
												<option value="IQ" data-i18n="option-intelligence">IQ</option>
												<option value="WILL" data-i18n="option-will">WILL</option>
												<option value="HT" data-i18n="option-health">HT</option>
												<option value="10">10</option>
											</select>
										</div>
										<div class="cell col-row-id label show-hide-row-id">
											<div class="popup">
												<span data-i18n="row-id-label">Row ID:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="copy-paste-row-id-tooltip">
			Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
			When the skill/spell is updated, the technique's parent name and base skill level<br />
			will be updated.<br />
			Once entered, this will change the Skill/Spell for this particular attack to match<br />
			the skill/spell level of the Base Skill. Do not change this skill Level number manually.
												</span>
											</span>	
										</div>
										<div class="cell col-input-medium show-hide-row-id">
											<input type="hidden" name="attr_melee_skill_row_id_toggle" value="0" />
											<input type="text" name="attr_melee_skill_row_id" title="Macro: @{NAME|repeating_melee_$[row #]_melee_skill_row_id}" />
										</div>
										
										<div class="cell">
											<div class="popup">
												<span data-i18n="abbreviation-modifier-label">Mod</span>
											</div>
											<div class="tooltip tooltip-skills-ref">
												<span data-i18n="modifier-tooltip">
			Enter the net value of all modifiers combined.<br />
			Can be a positive or a negative number.<br />
			Example: Enter 2 for Weapon’s Bond (+1) plus Magic (Accuracy: +1).<br />
			Once entered, this will change the Skill/Spell Level for this <b>particular</b><br />
			weapon to match the Base Skill/Spell level plus this MOD (Modifier).<br />
			Do not change this level number manually.
												</span>
											</div>
										</div>
										<div class="cell">
											<input type="number" value="0" name="attr_melee_skill_row_id_modifier" class="inline" title="Macro: @{NAME|repeating_melee_$[row #]_melee_skill_row_id_modifier}" />
										</div>
								
										<div class="cell col-wide">
											<input type="hidden" name="attr_melee_skill_row_id_message" value="" />
											<b><span data-i18n="name-label">Name:</span></b>
											<span name="attr_melee_skill_row_id_message"></span>
											<input type="hidden" name="attr_melee_skill_row_id_level" value="" />
											<b><span data-i18n="skill-level-label">Level</span>:</b>
											<span name="attr_melee_skill_row_id_level"></span>
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span>
										</div>
									
										<div class="cell reason-for-mod">
											<input type="text" name="attr_reason_for_mod" title="Macro: @{NAME|repeating_melee_$[row #]_reason_for_mod}" />
										</div>

									</div><!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="armor-divisor-label">Armor Divisor</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="armor-divisor-tooltip">Divide the target's armor DR by this number before subtracting damage<br />or (adding it adding it to the HT roll for an affliction). See B268.<br /><b>Explosive</b> attacks (optional house rule: area effect attacks) only apply divisor to target of direct hit. See B269.<br /><b>Afflictions</b> divide the armor DR <i>before</i> determining bonus to HT roll. See B269</span>
											</span>	
										</div>
										<div class="cell">
											<input type="number" class="inline" name="attr_armor_divisor" value="1" min="1" step="1" title="Macro: @{NAME|repeating_melee_$[row #]_armor_divisor}" />
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reference-abbreviation-label">Reference</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="reference-label-tooltip">Book abbreviation and page reference or any other appropriate reference.</span>
											</span>	
										</div>
										<div class="cell" style="width:89%;">
											<input type="text" style="text-align: left;" name="attr_ref" value="" title="Macro: @{NAME|repeating_melee_$[row #]_ref}" />
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="weapon-weight-label">Weapon Weight</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="melee-weapon-weight-tooltip">Enter the weight of the weapon. If the parrying weapon's weight is one third of this weapon, then parrying weapon must check for breakage. B376.</span>
											</span>	
										</div>
										<div class="cell">
											<input type="number" class="inline" name="attr_weapon_weight" value="3" title="Macro: @{NAME|repeating_melee_$[row #]_weapon_weight}" />
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="parrying-weapon-weight-label">Parrying Weapon Weight</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="parrying-melee-weapon-weight-tooltip">If the parrying weapon's weight is equal to or less than this value, then check for breakage. B376.</span>
											</span>	
										</div>
										<div class="cell">
											<input type="number" class="inline" name="attr_parrying_weapon_weight" readonly value="1" title="Macro: @{NAME|repeating_melee_$[row #]_parrying_weapon_weight}" />
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<h4>Damage Tool</h4>

											<div class="grid-standard grid-5-column-auto-repeat grid__align_center grid__gap_large">

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="method-label">Method</span>:
																<span class="tooltiptext">
																	<span data-i18n="damage-tool-method-tooltip">Select a method to help calculate weapon damage. If you select Thrust or Swing, the tool will automatically update your damage with the weapon.</span>
																</span>
															</div>
														</label>
														<select name="attr_damage_method">
															<option value="none" data-i18n="option-none">None</option>
															<option value="thrust" data-i18n="option-thrust">Thrust</option>
															<option value="swing" data-i18n="option-swing">Swing</option>
														</select>
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="abbreviation-modifier-label">Mod</span>:
																<span class="tooltiptext">
																	<span data-i18n="damage-modifier-tooltip">A flat modifier to the damage roll. Doesn't apply to each die. Typically used for weapons.<br />Examples: <ul><li>Broadsword (Thrust) is Thrust+2.</li></ul></span>
																</span>
															</div>
														</label>
														<input type="number" name="attr_damage_modifier" class="inline text-left" value="0" step="1" title="Macro: @{NAME|repeating_melee_$[row #]_damage_modifier}" />
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="die-modifier-abbreviated-label">Die Mod</span>:
																<span class="tooltiptext">
																	<span data-i18n="die-modifier-tooltip">Select a modifier to apply to each dice.<br />Examples: <ul><li>If you know Brawling at DX+2 or higher, you can add +1 damage per die.</li><li>If Boxing is DX+1, add +1 per die.</li><li>If Boxing is DX+2 or higher, add +2 per die.</li><li>If Karate is DX, add +1 per die.</li><li>If Boxing is DX+1 or higher, add +2 per die.</li><li>If Weapon Master and skill is DX+1, add +1 per die.</li><li>If Weapon Master and skill is DX+2 or higher, add +2 per die.</li><li>Mighty blow or All-Out Attack (Strong). +1 per die.</li><li>Shove is -1 per die.</li></ul></span>
																</span>
															</div>
														</label>
														<!-- set default value -->
														<input type="hidden" name="attr_damage_die_modifier" value="0" />
														<select name="attr_damage_die_modifier" title="Macro: @{NAME|repeating_melee_$[row #]_damage_die_modifier}">
															<option value="-2" data-i18n="option-negative-two">-2</option>
															<option value="-1" data-i18n="option-negative-one">-1</option>
															<option value="0" data-i18n="option-zero" selected>0</option>
															<option value="1" data-i18n="option-one">+1</option>
															<option value="2" data-i18n="option-two">+2</option>
															<option value="3" data-i18n="option-three">+3</option>
															<option value="4" data-i18n="option-four">+4</option>
															<option value="5" data-i18n="option-four">+5</option>
														</select>
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="modify-label">Modify</span>:
																<span class="tooltiptext">
																	<span data-i18n="apply-modifier-dice-plus-add-tooltip">Apply the optional rule <b>Modify Dice + Adds</b>. Any +4 becomes +1d6, any +7 becomes +2d6. B269</span>
																</span>
															</div>
														</label>
														<input type="checkbox" name="attr_apply_dice_adds" value="1" title="Macro: @{NAME|repeating_melee_$[row #]_apply_dice_adds}" />
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<input type="text" name="attr_calculated_damage_roll" readonly="readonly" value="" title="Macro: @{NAME|repeating_melee_$[row #]_apply_dice_adds}" />
													</div>
												</div>

											</div>

										</div>

									</div>

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="private-notes-label">Private Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="private-notes-tooltip">These notes do not appear in any Roll Template; they are just here for your reference.</span>
											</span>
											<textarea class="text-left full-size" name="attr_private_notes" title="Macro: @{NAME|repeating_melee_$[row #]_private_notes}"></textarea>
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="weapon-notes-label">Weapon Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-weapon-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Select Location: ?{Location|Head|Torso}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_notes" title="Macro: @{NAME|repeating_melee_$[row #]_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="damage-notes-label">Damage Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-damage-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_damage_notes" title="Macro: @{NAME|repeating_melee_$[row #]_damage_notes}"></textarea>
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="hit-note-label">Hit Note</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-success-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Select Location: ?{Location|Head|Torso}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_success_notes" title="Macro: @{NAME|repeating_melee_$[row #]_success_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="critical-hit-note-label">Critical Hit Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-critical-success-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_critical_success_notes" title="Macro: @{NAME|repeating_melee_$[row #]_critical_success_notes}"></textarea>
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="miss-note-label">Miss Note</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-fail-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Select Location: ?{Location|Head|Torso}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_fail_notes" title="Macro: @{NAME|repeating_melee_$[row #]_fail_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="critical-miss-note-label">Critical MIss Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="melee-critical-fail-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_critical_fail_notes" title="Macro: @{NAME|repeating_melee_$[row #]_critical_fail_notes}"></textarea>
										</div>
									</div> <!-- .row -->
									
									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_macro_two" value="" />
													<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_macro_three" value="" />
													<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_macro_four" value="" />
													<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_macro_five" value="" />
													<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_macro_six" value="" />
													<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>
									
								</div> <!-- .ranged-notebox -->
							</fieldset> <!-- .repeating_melee -->
						</div> <!-- .table -->
					</div> <!-- .box .melee-attacks -->

				</div><!-- end melee -->

				<div class="ranged">

					<!-- tables -->
					<div class="box speed-range-images">

						<div class="group">
							<div class="custom-checkbox">
								<label class="switch">
									<!-- if checked, user has option to select token before rolling -->
									<input type="hidden" name="attr_selected_token_macro" />
									<input type="checkbox" name="attr_selected_token" />
									<span class="icon select"></span>
								</label>
							</div>
							<div class="select-popup">
								<div class="popup">
									<span>Select</span>
								</div>
								<span class="tooltip">
									<span data-i18n="select-token-tooltip">Click the button to turn on <b>select a token</b> before the skill roll.<br />The token name will appear in the results.</span>
								</span>
							</div>
							<div class="custom-checkbox target">
								<label class="switch">
									<!-- if checked, user has option to target token before rolling -->
									<input type="hidden" name="attr_target_token_macro" />
									<input type="checkbox" name="attr_target_token" />
									<span class="icon target"></span>
								</label>
							</div>
							<div>
								<div class="popup">
									<span>Target</span>
								</div>
								<span class="tooltip">
									<span data-i18n="target-token-tooltip">Click the button to turn on <b>target a token</b> before the skill roll.<br />The token name will appear in the results.</span>
								</span>
							</div>
						</div>
						
						<div class="rapid-fire-table">
							<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/GURPS/Images/Rapid_Fire_Table.png" title="Rapid Fire Table: B373. Additional Rules B408." alt="Rapid Fire Table" />
						</div>
						<div class="speed-range-table"> <!-- .speed-range-table image-->
							<img src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/GURPS/Images/Speed_Range_Table.PNG"  title="Speed/Range Table: B550" alt="GURPS Speed/Range Table" /> 
						</div> <!-- .speed-range-table image-->

					</div>

					<!-- RANGE MODIFIERS BOX -->
					<div class="box range-modifiers">
						<div class="roll-modifiers-table">

							<div class="modifier-caption header">
								<div class="popup">
									<span data-i18n="ranged-attack-modifiers-label">Ranged Attack Modifiers</span>
								</div>
								<div class="tooltip">
									<span data-i18n="ranged-attack-modifiers-tooltip">These modifiers affect all ranged attack rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
								</div>
							</div>

							<div class="modifier-row">

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_show_roll_modifiers_for_ranged" class="btn modifier-line-height-fix" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="summary-group">
										<div class="icon"><span data-i18n="notes-label">Notes</span></div>
										<div class="summary">
											<div class="roll-maneuver">
												<b>Maneuver:</b>
												<div>
													<textarea name="attr_ranged_roll_maneuver" class="maneuver-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-maneuver">
												<b>Hit Location:</b>
												<div>
													<textarea name="attr_ranged_roll_hit_location" class="hit-location-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-traits">
												<b>Traits:</b>
												<div>
													<textarea name="attr_ranged_roll_trait_summary" class="trait-summary" readonly></textarea>
												</div>
											</div>
											<div class="roll-summary">
												<b>Summary:</b>
												<div>
													<textarea name="attr_ranged_roll_modifier_summary" class="roll-summary" readonly></textarea>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="modifier-label">Modifier:</span>
									</div>
									<div class="tooltip">
										<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<input type="number" value="0" step="1" name="attr_ranged_custom_roll_modifier" />
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="reason-label">Reason</span>:
									</div>
									<div class="tooltip">
										<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<textarea class="reason-textarea" name="attr_ranged_custom_roll_modifier_reason"></textarea>
								</div>

								<div class="modifier-cell">
									<input type="checkbox" name="attr_ranged_roll_max_nine" value="1" title="Macro: @{NAME|ranged_roll_max_nine}" />
									<input type="hidden" name="attr_ranged_roll_max_nine_value" value="100" />
								</div>	

								<div class="modifier-cell modifier-align-top">
									<div class="popup">
										<b><span data-i18n="max-skill-9-label">Max skill of 9</span></b>
									</div>
									<div class="tooltip max-skill-9">
										<span data-i18n="max-skill-9-tooltip">The effective skill cannot exceed 9.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="popup label">
										<span data-i18n="final-modifier-label">Final Modifier</span>:
									</div>
									<div class="tooltip">
										<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<div class="number-input">
										<input type="hidden" name="attr_ranged_roll_modifier_status" value="neutral" class="modifier-status" />
										<input type="number" value="0" step="1" name="attr_ranged_roll_modifier" class="final-modifier" readonly />
										<input type="hidden" value="" name="attr_ranged_roll_modifier_summary" />
										<input type="hidden" value="" name="attr_ranged_roll_trait_summary" />
										<input type="hidden" value="" name="attr_ranged_roll_hit_location" />
										<input type="hidden" value="" name="attr_ranged_roll_maneuver" />
										<input type="hidden" value="" name="attr_ranged_roll_allout_attack" />
									</div>
								</div>

								<div class="modifier-cell modifier-align-top">
									<button type="action" name="act_ranged_roll_reset" class="btn tool-modifier-reset modifier-line-height-fix" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
								</div>

							</div><!-- end row -->

						</div> <!-- .roll-modifiers-table -->
					</div>

					<!-- RANGE QUICK MODIFIERS BOX -->
					<input type="hidden" name="attr_range_quick_mod_show" value="0" />
					<div class="box range-modifiers range-quick-modifiers-block" style="overflow: hidden;">
						
						<div class="modifier-caption header">
							<div class="popup">
								<span data-i18n="quick-modifiers-label">Quick Modifiers</span>
							</div>
							<div class="tooltip">
								<span data-i18n="quick-modifiers-tooltip">Use the table below to create a set of custom modifiers that can be applied to your next your roll. If the modifier is checked, it will automatically be applied to the roll, but you must remember to uncheck the quick modifier if you don't want to use it.</span>
							</div>
						</div>

						<!-- #Quick Modifiers Table -->
						<div class="range-quick-modifiers">
							<div class="grid-standard grid-range-quick-modifier-header">
								<div class="grid-cell">&nbsp;</div>
								<div class="grid-cell">
									<span data-i18n="apply-label">Apply</span>
								</div>
								<div class="grid-cell">
									<div class="standard-tooltip">
										<span data-i18n="description-label">Description</span>
										<span class="tooltiptext">
											<span data-i18n="quick-mod-description-tooltip">Enter a useful description of the modifier.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<div class="standard-tooltip">
										<span data-i18n="modifier-no-colon-label">Modifier</span>
										<span class="tooltiptext move-far-left">
											<span data-i18n="quick-mod-tooltip">Enter an interger for the quick modifier.</span>
										</span>
									</div>
								</div>
							</div>

							<input type="hidden" name="attr_range_quick_mod_show_in_roll" value="0" />
							<input type="hidden" name="attr_range_quick_mod_total" value="0" />
							<input type="hidden" name="attr_range_quick_mod_summary" value="" />
							<fieldset class="repeating_range-quick-modifier">
								<div class="grid-standard grid-range-quick-modifiers">
									<div class="grid-cell">
										<label class="toggle-button">
											<input type="checkbox" name="attr_toggle_notes" value="1" />
											<span></span>
										</label>
									</div>
									<div class="grid-cell">
										<input type="checkbox" name="attr_apply" value="1" title="Macro: @{NAME|repeating_range-quick-modifier_$[row #]_apply}" />
									</div>
									<div class="grid-cell">
										<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_range-quick-modifier_$[row #]_name}" />
									</div>
									<div class="grid-cell">
										<input type="number" name="attr_modifier" value="0" step="1" class="medium-width" title="Macro: @{NAME|repeating_range-quick-modifier_$[row #]_percent}" />
									</div>
									<input type="hidden" name="attr_toggle_notes" />
									<div class="expandable-section">
										<h4><span data-i18n="notes-label">Notes</span></h4>
										<textarea name="attr_notes"></textarea>
									</div>
								</div>
							</fieldset>
						</div>								

					</div>
					
					<!-- _____ _____ RANGED ATTACKS BOX _____ _____ -->
					<div class="box ranged-attacks">
						<div class="table">
							<div class="header">
								<div class="cell col0">
									<div class="popup">
										<span data-i18n="ranged-attacks-label">Ranged Attacks</span>
									</div>
									<span class="tooltip">
										<span data-i18n="ranged-attack-tooltip">Please use either the <b>Range Calculator</b> or the <b>Roll Modifiers</b> dialog tool to enter at least the range of the attack.</span>
									</span>
								</div>
								<div class="cell col1">
									<div class="popup">
										<span data-i18n="damage-label">Damage</span>
									</div>
									<span class="tooltip">
										<span data-i18n="ranged-damage-tooltip">
			For an <strong>Armor Divisor</strong>: A number in parenthesis after<br />
			the damage - eg. (2) - is an armor divisor.<br />
			Enter this number in the <strong>Damage Notes</strong> as AD(#) or as<br />
			Armor Divisor(#).<br />
			<strong>ex</strong>: indicates the attack causes an explosion.<br />
			<strong>[#d]</strong>: indicates the attack causes fragmentation.<br />
			See B269. Enter in the <strong>Damage Notes</strong>
										</span>
									</span>
								</div>
								<div class="cell col2"></div>
								<div class="cell col3">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<span class="tooltip">
										<span data-i18n="damage-type-tooltip">
			<table>
				<thead>
					<tr>
						<th>Abbr</th>
						<th>Name</th>
					</tr>
				</thead>
				<tbody>
					<tr><td>aff</td> <td>Affliction</td></tr>
					<tr><td>burn</td><td>Burning</td></tr>
					<tr><td>cor</td> <td>Corrosion</td></tr>
					<tr><td>cr</td>  <td>Crushing</td></tr>
					<tr><td>cut</td> <td>Cutting</td></tr>
					<tr><td>fat</td> <td>Fatigue</td></tr>
					<tr><td>imp</td> <td>Impaling</td></tr>
					<tr><td>pi-</td> <td>Small Piercing</td></tr>
					<tr><td>pi</td>  <td>Piercing</td></tr>
					<tr><td>pi+</td> <td>Large Piercing</td></tr>
					<tr><td>pi++</td><td>Huge Piercing</td></tr>
					<tr><td>spec</td><td>Special</td></tr>
					<tr><td>tox</td> <td>Toxic</td></tr>
				</tbody>
			</table>
										</span>
									</span>
								</div>					
								<div class="cell col4">
									<div class="popup">
										<span data-i18n="abbreviation-accuracy-label">Acc</span>
									</div>
									<span class="tooltip">
										<span data-i18n="accuracy-tooltip">Accuracy B260. Your combined bonus from all targeting systems (scopes, sights, computers, etc.) cannot exceed the weapon's base Accuracy, see Aim B354.</span>
									</span>
								</div>
								<div class="cell col5">
									<div class="popup">
										<span data-i18n="abbreviation-range-label">RNG</span>
									</div>
									<span class="tooltip">
										<span data-i18n="range-tooltip">Range. See B269.</span>
									</span>
								</div>					
								<div class="cell col6">
									<div class="popup">
										<span data-i18n="abbreviation-rate-of-fire-label">RoF</span>
									</div>
									<span class="tooltip">
										<span data-i18n="rate-of-fire-tooltip">
											Rate of Fire<br>
											The maximum number of shots that can be fired in <br>
											one turn (by a regular person).<br>
											The minimum number of shots is 1.<br><br>
											<strong>!</strong>: minimum RoF is 1/4 of the maximum, rounded up.<br>
											<strong>mxn</strong>: fires the first number of shots, which each then<br>
											split into the second number (eg. shotguns)<br>
											<strong>Jet</strong>: shoots a continuous stream of fluid. See page 106.
										</span>
									</span>
								</div>
								<div class="cell col7">
									<div class="popup">
										<span data-i18n="shots-label">Shots</span>
									</div>
									<span class="tooltip">
										<span data-i18n="shots-tooltip">
			The number of shots that can be fired before the<br />
			weapon must be reloaded.<br />
			The parenthetical number indicates the number of 1<br />
			second ready maneuvers required to reload the<br />
			weapon.<br />
			<strong>T</strong>: the weapon is thrown. To "reload" it, pick it up.<br />
			<strong>i</strong>: you must load the shots individually. the listed<br />
			time is for each shot.
										</span>
									</span>
								</div>
								<div class="cell col8">
									<div class="popup">
										<span data-i18n="bulk-label">Bulk</span>
									</div>
									<span class="tooltip">
										<span data-i18n="bulk-tooltip">
			<strong>Move and Attack</strong>: If you are making a ranged attack,<br />
			you have a penalty of -2 or the weapon’s Bulk rating,<br />
			whichever is worse (B365, B469, B548).<br />
			<strong>Close Combat</strong>: If using a ranged weapon, ignore the usual<br />
			speed/range penalty and apply the weapon’s Bulk<br />
			statistic as a penalty to hit. B391<br />
			It also serves as a penalty to <strong>Holdout</strong> skill when you<br />
			attempt to conceal the weapon. B370<br />
										</span>
									</span>
								</div>
								<div class="cell col9">
									<div class="popup">
										<span data-i18n="abbreviation-recoil-label">RCL</span>
									</div>
									<span class="tooltip">
										<span data-i18n="recoil-tooltip">
			When firing at RoF 2+, every full multiple of Rcl<br />
			by which you make your attack roll means you score<br />
			one extra hit, to a maximum number of hits equal<br />
			to total shots fired. See page 373.
										</span>
									</span>
								</div>
								<div class="cell col10">
									<span style="background-color: #87CEFA">| <span data-i18n="skill-label">Skill</span> |</span>
								</div>
							</div> <!-- .header -->

							<input type="hidden" name="attr_use_malfunction" />
							<fieldset class="repeating_ranged">
								<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
								<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_ranged_toggle_notes" />
								<span class="checkbox"></span>
								<div class="row row-stats">
									<div class="cell col0">
										<input type="text" name="attr_name" title="Macro: @{NAME|repeating_ranged_$[row #]_name}" />
										<input type="hidden" name="attr_idkey" />
									</div>
									<div class="cell col1">
										<input type="text" name="attr_damage" title="Macro: @{NAME|repeating_ranged_$[row #]_damage}" />
									</div>
									<div class="cell col2">
										<input type="hidden" name="attr_damage_dice_icon" class="range-damage-dice-icon" value="explode" />
										<button type="action" name="act_rolldamage" class="roll_damage" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Damage}} {{characterName=@{character_name}}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}}" />
									</div>
									<div class="cell col3">
										<select name="attr_type" title="Macro: @{NAME|repeating_ranged_$[row #]_type}">
											<option value="Affliction (aff)"><span data-i18n="abbreviation-option-affliction">aff</span></option>
											<option value="Burning (burn)"><span data-i18n="abbreviation-option-burning">burn</span></option>
											<option value="Corrosion (cor)"><span data-i18n="abbreviation-option-corrosion">cor</span></option>
											<option value="Crushing (cr)"><span data-i18n="abbreviation-option-crushing">cr</span></option>
											<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
											<option value="Fatigue (fat)"><span data-i18n="abbreviation-option-fatigue">fat</span></option>
											<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
											<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
											<option value="Piercing (pi)"><span data-i18n="abbreviation-option-piercing">pi</span></option>
											<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
											<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
											<option value="Special (spec)"><span data-i18n="abbreviation-option-special">spec</span></option>
											<option value="Knockback (knock)"><span data-i18n="abbreviation-option-knockback">knock</span></option>
											<option value="Toxic (tox)"><span data-i18n="abbreviation-option-toxic">tox</span></option>
										</select>
										<input type="hidden" name="attr_damage_type_note" value="@{damage_type_note_aff}" />
										<input type="hidden" name="attr_minimum_damage_note" value="Min 1" />
										<input type="hidden" name="attr_minimum_damage" value="1" />
									</div>
									<div class="cell col4">
										<input type="text" name="attr_acc" title="Macro: @{NAME|repeating_ranged_$[row #]_acc}" />
									</div>
									<div class="cell col5">
										<input type="text" name="attr_range" title="Macro: @{NAME|repeating_ranged_$[row #]_range}" />
									</div>
									<div class="cell col6">
										<input type="text" name="attr_rof" title="Macro: @{NAME|repeating_ranged_$[row #]_rof}" />
										<input type="hidden" name="attr_shots_fired_macro" value="" />
									</div>
									<div class="cell col7">
										<input type="text" name="attr_shots" title="Macro: @{NAME|repeating_ranged_$[row #]_shots}" />
									</div>
									<div class="cell col8">
										<input type="text" name="attr_bulk" title="Macro: @{NAME|repeating_ranged_$[row #]_bulk}" />
									</div>
									<div class="cell col9">
										<input type="text" name="attr_recoil" title="Macro: @{NAME|repeating_ranged_$[row #]_recoil}" />
									</div>
									<div class="cell col10">
										<input type="text" name="attr_skill" title="Macro: @{NAME|repeating_ranged_$[row #]_skill}" />
									</div>
									<div class="cell col11">
										<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Attack}} {{rangedAttack=[[1]]}} {{characterName=@{character_name}}} {{selected=@{selected_token_macro}}} {{target1=@{target_token_macro}}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[1]]}} {{rollResult=[[3d6cs<1cf>6]]}} {{useModTool=[[1]]}} {{showNotes=[[1]]}} {{notesTitlePrefix=Weapon}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{useMalfunction=[[@{use_malfunction}]]}} {{popupModifier=@{popup_modifier}}} {{rawSuccessNote=@{raw_hit_notes}}} {{rollModifier=[[@{ranged_roll_modifier}]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{rollModifierSummary=@{ranged_roll_modifier_summary}}} {{quickModShow=[[@{range_quick_mod_show_in_roll}]]}} {{quickModTotal=[[@{range_quick_mod_total}]]}} {{quickModSummary=@{range_quick_mod_summary}}} {{useMalfunction=[[@{use_malfunction}]]}}" />
									</div>
								</div> <!-- .row -->
								
								<div class="ranged-notebox">

									<div class="row">
										<div class="cell">
											<button type="action" name="act_duplicate" class="btn positive-action" title="Clicking the Duplicate button will copy this weapon's entry and automatically add it to the field set here.">Duplicate</button>
										</div>
									</div>
									
									<div class="row">
										<input type="hidden" name="attr_ranged_row_type" value="Skill" />
										<div class="cell">
											<select name="attr_ranged_row_type">
												<option value="" data-i18n="option-select">--Select--</option>
												<option value="Skill" data-i18n="option-skill">Skill</option>
												<option value="Spell" data-i18n="option-spell">Spell</option>
												<option value="Technique" data-i18n="option-technique">Technique</option>
												<option value="ST" data-i18n="option-strength">ST</option>
												<option value="STRIKING" data-i18n="option-striking-strength">Striking ST</option>
												<option value="DX" data-i18n="option-dexterity">DX</option>
												<option value="IQ" data-i18n="option-intelligence">IQ</option>
												<option value="WILL" data-i18n="option-will">WILL</option>
												<option value="HT" data-i18n="option-health">HT</option>
												<option value="10">10</option>
											</select>
										</div>
										<div class="cell col-row-id label show-hide-row-id">
											<div class="popup">
												<span data-i18n="row-id-label">Row ID:</span>
											</div>
											<span class="tooltip">
												<span data-i18n="copy-paste-row-id-tooltip">
			Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
			When the skill/spell is updated, the technique's parent name and base skill level<br />
			will be updated.<br />
			Once entered, this will change the Skill/Spell for this particular attack to match<br />
			the skill/spell level of the Base Skill. Do not change this skill Level number manually.
												</span>
											</span>	
										</div>
										<div class="cell col-input-medium show-hide-row-id">
											<input type="hidden" name="attr_ranged_skill_row_id_toggle" value="0" />
											<input type="text" name="attr_ranged_skill_row_id" title="Macro: @{NAME|repeating_ranged_$[row #]_ranged_skill_row_id}" />
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="abbreviation-modifier-label">Mod</span>
											</div>
											<div class="tooltip tooltip-skills-ref">
												<span data-i18n="modifier-tooltip">
			Enter the net value of all modifiers combined.<br />
			Can be a positive or a negative number.<br />
			Example: Enter 2 for Weapon’s Bond (+1) plus Magic (Accuracy: +1).<br />
			Once entered, this will change the Skill/Spell Level for this <b>particular</b><br />
			weapon to match the Base Skill/Spell level plus this MOD (Modifier).<br />
			Do not change this level number manually.
												</span>
											</div>
										</div>
										<div class="cell">
											<input type="number" value="0" name="attr_ranged_skill_row_id_modifier" class="inline" title="Macro: @{NAME|repeating_ranged_$[row #]_ranged_skill_row_id_modifier}" />
										</div>
										<div class="cell col-wide">
											<input type="hidden" name="attr_ranged_skill_row_id_message" value="" />
											<b><span data-i18n="name-label">Name:</span></b>
											<span name="attr_ranged_skill_row_id_message"></span>
											<input type="hidden" name="attr_ranged_skill_row_id_level" value="" />
											<b><span data-i18n="skill-level-label">Level</span>:</b>
											<span name="attr_ranged_skill_row_id_level"></span>
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
											</div>
											<span class="tooltip">
												<span data-i18n="reason-for-modifiers-skills-tooltip">
			Examples:<br />
			+1 from Talent...<br />
			+1 from Default Skill...<br />
			+1 from Enchanted Item with...
												</span>
											</span>
										</div>
										<div class="cell reason-for-mod">
											<input type="text" name="attr_reason_for_mod" title="Macro: @{NAME|repeating_ranged_$[row #]_reason_for_mod}" />
										</div>
									</div><!-- .row -->
									
									<div class="row malfunction-row">

										<div class="cell label">
											<div class="popup">
												<span data-i18n="malfunction-label">Malfunction</span>
											</div>
											<span class="tooltip">
												<span data-i18n="malfunction-tooltip">
			Malfunction is an <strong>Optional Rule</strong>. B278, <strong>B279</strong>, B382, tables <strong>B407</strong> & HT179, with more detailed info HT79-81. If the option <i>Use Malfunction</i> is<br />
			checked [see Sheet Options page], and if the # entered here is greater than 0, then the roll result will check for weapon malfunction.<br />
			<b style="color:red;">Malfunction has "priority" over a critical miss: if both would occur, only the malfunction takes place. See Critical Misses B382.
												</span>
											</span>	
										</div>
										
										<div class="cell col-input">
											<input type="number" default="0" name="attr_malfunction" value="0" title="Macro: @{NAME|repeating_ranged_$[row #]_malfunction}" />
											<input type="hidden" name="attr_malf_max_value" value="100" />
										</div>
										
										<div class="cell custom-checkbox">
											<div class="popup">
												<strong>...<span data-i18n="verify-label">Verify</span></strong>
											</div>
											<span class="tooltip">
												<span data-i18n="verify-malfunction-tooltip">If Verify is checked, then roll again to verify the malfunction. see HT79</span>
											</span>	
										</div>
										
										<div class="cell col-verifycheck custom-checkbox">
											<input type="checkbox" name="attr_malfunction_verify" value="1" class="inline" title="Macro: @{NAME|repeating_ranged_$[row #]_malfunction_verify}" />
										</div>
										
										<div class="cell custom-checkbox">
											<div class="popup">
												<strong><span data-i18n="very-reliable-label">Very Reliable</span></strong>
											</div>
											<span class="tooltip">
												<span data-i18n="very-reliable-tooltip">Some weapons, according to High Tech (HT101, 121, 157) are Very Reliable. Check this box if this weapon is.</span>
											</span>	
										</div>
										<div class="cell col-verifycheck custom-checkbox">
											<input type="checkbox" name="attr_malfunction_very_reliable" value="1" class="inline" title="Macro: @{NAME|repeating_ranged_$[row #]_malfunction_very_reliable}" />
										</div>

										<div class="col-setting-text cell">
											
											<span class="show-enabled-label">
												[<span data-i18n="label-enabled">Enabled</span>]
											</span>
											<span class="show-disabled-label">
												[<span data-i18n="label-disabled">Disabled</span>]
											</span>
											
											<i>
												(<span data-i18n="optional-malfunction-description">See Settings TAB, <b>Use Malfunction</b></span>)
											</i>
										</div>
									
									</div> <!-- .row -->

									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="armor-divisor-label">Armor Divisor</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="armor-divisor-tooltip">Divide the target's armor DR by this number before subtracting damage<br />or (adding it adding it to the HT roll for an affliction). See B268.<br /><b>Explosive</b> attacks (optional house rule: area effect attacks) only apply divisor to target of direct hit. See B269.<br /><b>Afflictions</b> divide the armor DR <i>before</i> determining bonus to HT roll. See B269</span>
											</span>	
										</div>
										<div class="cell">
											<input type="number" class="inline" name="attr_armor_divisor" value="1" min="1" step="1" title="Macro: @{NAME|repeating_ranged_$[row #]_armor_divisor}" />
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell label">
											<div class="popup">
												<span data-i18n="reference-abbreviation-label">Reference</span>:
											</div>
											<span class="tooltip">
												<span data-i18n="reference-label-tooltip">Book abbreviation and page reference or any other appropriate reference.</span>
											</span>	
										</div>
										<div class="cell" style="width:89%;">
											<input type="text" style="width: 75px;text-align: left;" name="attr_ref" value="" title="Macro: @{NAME|repeating_ranged_$[row #]_ref}" />
										</div>
									</div> <!-- .row -->
									
									<div class="row">
										<div class="cell">
											<h4>Damage Tool</h4>

											<div class="grid-standard grid-5-column-auto-repeat grid__align_center grid__gap_large">

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="method-label">Method</span>:
																<span class="tooltiptext">
																	<span data-i18n="damage-tool-method-tooltip">Select a method to help calculate weapon damage. If you select Thrust or Swing, the tool will automatically update your damage with the weapon.</span>
																</span>
															</div>
														</label>
														<select name="attr_damage_method">
															<option value="none" data-i18n="option-none">None</option>
															<option value="thrust" data-i18n="option-thrust">Thrust</option>
															<option value="swing" data-i18n="option-swing">Swing</option>
														</select>
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="abbreviation-modifier-label">Mod</span>:
																<span class="tooltiptext">
																	<span data-i18n="damage-modifier-tooltip">A flat modifier to the damage roll. Doesn't apply to each die. Typically used for weapons.<br />Examples: <ul><li>Broadsword (Thrust) is Thrust+2.</li></ul></span>
																</span>
															</div>
														</label>
														<input type="number" name="attr_damage_modifier" class="inline text-left" value="0" step="1" title="Macro: @{NAME|repeating_melee_$[row #]_damage_modifier}" />
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="die-modifier-abbreviated-label">Die Mod</span>:
																<span class="tooltiptext">
																	<span data-i18n="die-modifier-tooltip">Select a modifier to apply to each dice.<br />Examples: <ul><li>If you know Brawling at DX+2 or higher, you can add +1 damage per die.</li><li>If Boxing is DX+1, add +1 per die.</li><li>If Boxing is DX+2 or higher, add +2 per die.</li><li>If Karate is DX, add +1 per die.</li><li>If Boxing is DX+1 or higher, add +2 per die.</li><li>If Weapon Master and skill is DX+1, add +1 per die.</li><li>If Weapon Master and skill is DX+2 or higher, add +2 per die.</li><li>Mighty blow or All-Out Attack (Strong). +1 per die.</li><li>Shove is -1 per die.</li></ul></span>
																</span>
															</div>
														</label>
														<!-- set default value -->
														<input type="hidden" name="attr_damage_die_modifier" value="0" />
														<select name="attr_damage_die_modifier" title="Macro: @{NAME|repeating_melee_$[row #]_damage_die_modifier}">
															<option value="-2" data-i18n="option-negative-two">-2</option>
															<option value="-1" data-i18n="option-negative-one">-1</option>
															<option value="0" data-i18n="option-zero" selected>0</option>
															<option value="1" data-i18n="option-one">+1</option>
															<option value="2" data-i18n="option-two">+2</option>
															<option value="3" data-i18n="option-three">+3</option>
															<option value="4" data-i18n="option-four">+4</option>
															<option value="5" data-i18n="option-four">+5</option>
														</select>
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<label>
															<div class="standard-tooltip">
																<span data-i18n="modify-label">Modify</span>:
																<span class="tooltiptext">
																	<span data-i18n="apply-modifier-dice-plus-add-tooltip">Apply the optional rule <b>Modify Dice + Adds</b>. Any +4 becomes +1d6, any +7 becomes +2d6. B269</span>
																</span>
															</div>
														</label>
														<input type="checkbox" name="attr_apply_dice_adds" value="1" title="Macro: @{NAME|repeating_melee_$[row #]_apply_dice_adds}" />
													</div>
												</div>

												<div class="grid-item">
													<div class="container-label-input grid__gap_small grid__align_center">
														<input type="text" name="attr_calculated_damage_roll" readonly="readonly" value="" title="Macro: @{NAME|repeating_melee_$[row #]_apply_dice_adds}" />
													</div>
												</div>

											</div>

										</div>

									</div>
									
									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="private-notes-label">Private Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="private-notes-tooltip">These notes do not appear in any Roll Template; they are just here for your reference.</span>
											</span>
											<textarea class="text-left full-size" name="attr_private_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_private_notes}"></textarea>
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="weapon-notes-label">Weapon Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-weapon-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Arrow: ?{Arrow Type|Bodkin|Normal}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="damage-notes-label">Damage Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-damage-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_damage_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_damage_notes}"></textarea>
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="hit-note-label">Hit Note</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-success-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Select Location: ?{Location|Head|Torso}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_success_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_success_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="critical-hit-note-label">Critical Hit Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-critical-success-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_critical_success_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_critical_success_notes}"></textarea>
										</div>
									</div> <!-- .row -->

									<div class="row">
										<div class="cell">
											<div class="popup">
												<span data-i18n="miss-note-label">Miss Note</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-fail-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
			Example: Select Location: ?{Location|Head|Torso}
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_fail_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_fail_notes}"></textarea>
										</div>
										<div class="cell">
											<div class="popup">
												<span data-i18n="critical-miss-note-label">Critical Miss Notes</span>
											</div>
											<span class="tooltip">
												<span data-i18n="ranged-critical-fail-notes-tooltip">
			<strong>Hint:</strong> Enter inline rolls for additional results.<br />
			Example: Does an additional [[1d6]] fire damage.
												</span>
											</span>
											<textarea class="text-left chat-size" name="attr_critical_fail_notes" title="Macro: @{NAME|repeating_ranged_$[row #]_critical_fail_notes}"></textarea>
										</div>
									</div> <!-- .row -->
									
									<div class="header">
										<div class="popup">
											<span data-i18n="custom-macros-label">Custom Macros</span>
										</div>
										<span class="tooltip">
											<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
										</span>
									</div>
			
									<div class="grid-standard grid-custom-skills-macros">
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
													<input type="hidden" name="attr_macro_one_name" value="Skill" />
													<input type="hidden" name="attr_macro_one" value="" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_one_name"></span>
												</span>
											</div>
										</div>	
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_two_name" value="Defense" />
													<input type="hidden" name="attr_macro_two" value="" />
													<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_two_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_three_name" value="Melee" />
													<input type="hidden" name="attr_macro_three" value="" />
													<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_three_name"></span>
												</span>
											</div>
										</div>	
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_four_name" value="Ranged" />
													<input type="hidden" name="attr_macro_four" value="" />
													<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_four_name"></span>
												</span>
											</div>
										</div>
										
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_five_name" value="Spell" />
													<input type="hidden" name="attr_macro_five" value="" />
													<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_five_name"></span>
												</span>
											</div>
										</div>
			
										<div class="grid-cell">
											<div class="container-label-input">
												<span>
													<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
													<input type="hidden" name="attr_macro_six" value="" />
													<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
												</span>
												<span>
													<b><span data-i18n="macro-label">Macro</span>:</b>
													<span name="attr_macro_six_name"></span>
												</span>
											</div>
										</div>
										
									</div>

								</div> <!-- .note-box -->
								
							</fieldset> <!-- .repeating_ranged -->
						</div> <!-- .table -->
					</div> <!-- .box .ranged-attacks -->

					<!-- _____ _____ THROWING _____ _____ -->
					<div class="box ranged-attacks thrown-object">
						<div class="table">
							<div class="header">
								<div class="cell col0-st">
									<div class="popup">
										<span data-i18n="abbreviation-thrown-pounds-label">Thrown (<span name="attr_weight_system"></span>)</span>
									</div>
									<div class="tooltip" style="margin-left: -36px;">
										<span data-i18n="thrown-tooltip">This is the ability to throw any small, relatively smooth object that fits in the palm of your hand.  See the Throwing skill (B226). Also see Throwing rules (B355).</span>
									</div>
								</div>
								<div class="cell col8">
									<div class="popup">
										<span data-i18n="abbreviation-strength">ST</span>
									</div>
									<div class="tooltip">
										<span data-i18n="thrown-strength-tooltip">
			Based on Striking ST<br />
			<i>Note:</i> future versions will add ability to choose ST source or enter ST.
										</span>
									</div>
								</div>
								<div class="cell col8">
									<div class="popup">
										<span data-i18n="abbreviation-modifier-label">Mod</span>
									</div>
									<div class="tooltip">
										<span data-i18n="thrown-strength-modifier-tooltip">
			Strength Modifier to distance only<br />
			Throwing or Throwing Art at DX Level = +1 ST<br />
			Throwing or Throwing Art at DX+1 Level = +2 ST
										</span>
									</div>
								</div>
								<div class="cell col8">
									<div class="popup">
										<span data-i18n="super-label">Super</span>
									</div>
									<div class="tooltip">
										<span data-i18n="thrown-super-tooltip">
			Super Throw Level<br />
			Each level of Super Throw, double range.<br />
			Each level of Super Throw increases damage by +2 per die.
										</span>
									</div>
								</div>
								<div class="cell col1">
									<div class="popup">
										<span data-i18n="damage-label">Damage</span>
									</div>
									<div class="tooltip">
										<span data-i18n="thrown-damage-tooltip">Final damage based on ST, super throw, and damage modifier.</span>
									</div>
								</div>
								<div class="cell col8">
									<div class="popup">
										<span data-i18n="abbreviation-modifier-label">Mod</span>
									</div>
									<div class="tooltip">
										<span data-i18n="thrown-damage-modifier-tooltip">
			Bonus or penalty per die<br />
			Throwing Art at DX Level = +1 per die<br />
			Throwing Art at DX+1 Level = +2 per die
										</span>
									</div>
								</div>
								<div class="cell col2"> </div>
								<div class="cell col3">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<span class="tooltip">
										<span data-i18n="damage-type-tooltip">
			<table>
				<thead>
					<tr>
						<th>Abbr</th>
						<th>Name</th>
					</tr>
				</thead>
				<tbody>
					<tr><td>aff</td> <td>Affliction</td></tr>
					<tr><td>burn</td><td>Burning</td></tr>
					<tr><td>cor</td> <td>Corrosion</td></tr>
					<tr><td>cr</td>  <td>Crushing</td></tr>
					<tr><td>cut</td> <td>Cutting</td></tr>
					<tr><td>fat</td> <td>Fatigue</td></tr>
					<tr><td>imp</td> <td>Impaling</td></tr>
					<tr><td>pi-</td> <td>Small Piercing</td></tr>
					<tr><td>pi</td>  <td>Piercing</td></tr>
					<tr><td>pi+</td> <td>Large Piercing</td></tr>
					<tr><td>pi++</td><td>Huge Piercing</td></tr>
					<tr><td>spec</td><td>Special</td></tr>
					<tr><td>tox</td> <td>Toxic</td></tr>
				</tbody>
			</table>
										</span>
									</span>
								</div>					
								<div class="cell col4">
									<div class="popup">
										<span data-i18n="abbreviation-accuracy-label">Acc</span>
									</div>
									<span class="tooltip">
										<span data-i18n="accuracy-tooltip">Accuracy B260. Your combined bonus from all targeting systems (scopes, sights, computers, etc.) cannot exceed the weapon's base Accuracy, see Aim B354.</span>
									</span>
								</div>
								<div class="cell col5-thrown">
									<div class="popup">
										<span data-i18n="abbreviation-gravity-label">GRAV</span>
									</div>
									<span class="tooltip">
										<span data-i18n="gravity-thrown-tooltip">Gravity, affects throwing distance. See B350.<br /></span>
									</span>
								</div>					
								<div class="cell col5-thrown">
									<div class="popup">
										<span data-i18n="abbreviation-range-label">RNG</span>
									</div>
									<span class="tooltip">
										<span data-i18n="throwing-range-tooltip">See GURPS Campaigns Page 355 for formula</span>
									</span>
								</div>					
								<div class="cell col6">
									<div class="popup">
										<span data-i18n="abbreviation-rate-of-fire-label">RoF</span>
									</div>
									<span class="tooltip">
										<span data-i18n="rate-of-fire-tooltip">
											Rate of Fire<br />
											The maximum number of shots that can be fired in <br />
											one turn (by a regular person).<br />
											The minimum number of shots is 1.<br /><br />
											<strong>!</strong>: minimum RoF is 1/4 of the maximum, rounded up.<br />
											<strong>mxn</strong>: fires the first number of shots, which each then<br />
											split into the second number (eg. shotguns)<br />
											<strong>Jet</strong>: shoots a continuous stream of fluid. See page 106.
										</span>
									</span>
								</div>
								<div class="cell col5-thrown">
									<div class="popup">
										<span data-i18n="shots-label">Shots</span>
									</div>
									<span class="tooltip">
										<span data-i18n="shots-tooltip">
			The number of shots that can be fired before the<br />
			weapon must be reloaded.<br />
			The parenthetical number indicates the number of 1<br />
			second ready maneuvers required to reload the<br />
			weapon.<br />
			<strong>T</strong>: the weapon is thrown. To "reload" it, pick it up.<br />
			<strong>i</strong>: you must load the shots individually. the listed<br />
			time is for each shot.
										</span>
									</span>
								</div>
								<div class="cell col9">
									<div class="popup">
										<span data-i18n="abbreviation-recoil-label">RCL</span>
									</div>
									<span class="tooltip">
										<span data-i18n="recoil-tooltip">
			When firing at RoF 2+, every full multiple of Rcl<br />
			by which you make your attack roll means you score<br />
			one extra hit, to a maximum number of hits equal<br />
			to total shots fired. See page 373.
										</span>
									</span>
								</div>
								<div class="cell col10">
									<span style="background-color: #87CEFA">| <span data-i18n="skill-label">Skill</span> |</span>
								</div>
							</div> <!-- .header -->
							
							<div class="repcontainer">
								<div class="repitem">
									
									<input class="toggle" type="checkbox" title="Click to show/hide more information." name="attr_thrown_toggle_notes" />
									<span class="checkbox"></span>
									
									<div class="row row-stats row-thrown-object">
										<div class="cell col0-st">
											<input type="number" step="1" value="1" min="1" name="attr_thrown_object_weight" title="Macro: @{NAME|thrown_object_weight}" />
										</div>
										<div class="cell col8">
											<input type="text" name="attr_thrown_object_strength" readonly="readonly" value="10" title="Macro: @{NAME|thrown_object_strength}" />
										</div>
										<div class="cell col8">
											<input type="number" name="attr_thrown_object_strength_mod" value="0" step="1" title="Macro: @{NAME|thrown_object_strength_mod}" />
										</div>
										<div class="cell col8">
											<input type="number" name="attr_super_throw_level" value="0" step="1" title="Macro: @{NAME|super_throw_level}" />
										</div>
										<div class="cell col1">
											<input type="text" name="attr_thrown_object_damage" readonly="readonly" value="@{thrust}" title="Macro: @{NAME|thrown_object_damage}" />
										</div>
										<div class="cell col8">
											<input type="number" step="1" name="attr_thrown_object_damage_mod" value="0" title="Macro: @{NAME|thrown_object_damage_mod}" />
										</div>
										<div class="cell col2">
											<input type="hidden" name="attr_damage_dice_icon" class="range-damage-dice-icon" value="explode" />
											<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Damage}} {{selected=@{selected_token_macro}}} {{target1=@{target_token_macro}}} {{characterName=@{character_name}}} {{skillName=Thrown Object @{thrown_object_weight} @{weight_system}.}} {{damageRoll=[[ { @{thrown_object_damage}, {@{thrown_minimum_damage}} }kh1 ]]}} {{damageType=@{thrown_object_damage_type}}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{thrown_object_damage_type_note}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}} {{notes=@{thrown_object_damage_notes}}}" name="roll_damage" class="roll_damage" />
										</div>
										<div class="cell col3">
											<select name="attr_thrown_object_damage_type" title="Macro: @{NAME|thrown_object_damage_type}">
												<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
												<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
												<option value="Crushing (cr)" selected><span data-i18n="abbreviation-option-crushing">cr</span></option>
												<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
												<option value="Piercing (pi)"><span data-i18n="abbreviation-option-piercing">pi</span></option>
												<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
												<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
												<option value="Affliction (aff)"><span data-i18n="abbreviation-option-affliction">aff</span></option>
												<option value="Burning (burn)"><span data-i18n="abbreviation-option-burning">burn</span></option>
												<option value="Corrosion (cor)"><span data-i18n="abbreviation-option-corrosion">cor</span></option>
												<option value="Fatigue (fat)"><span data-i18n="abbreviation-option-fatigue">fat</span></option>
												<option value="Toxic (tox)"><span data-i18n="abbreviation-option-toxic">tox</span></option>
												<option value="Knockback (knock)"><span data-i18n="abbreviation-option-knockback">knock</span></option>
												<option value="Special (spec)"><span data-i18n="abbreviation-option-special">spec</span></option>
											</select>
											<input type="hidden" name="attr_thrown_object_damage_type_note" value="@{damage_type_note_cr}" />
											<input type="hidden" name="attr_thrown_minimum_damage_note" value="Min 0" />
											<input type="hidden" name="attr_thrown_minimum_damage" value="0" />
										</div>
										<div class="cell col4">
											<input type="number" step="1" name="attr_thrown_object_acc" value="0" title="Macro: @{NAME|thrown_object_acc}" />
										</div>
										<div class="cell col5-thrown thrown-object-input">
											<input type="number" name="attr_gravity" value="1" min="0" step=".01" title="Macro: @{NAME|gravity}" />
										</div>
										<div class="cell col5-thrown thrown-object-input">
											<input type="text" name="attr_thrown_object_range" readonly="readonly" value="10" title="Macro: @{NAME|thrown_object_range}" />
										</div>
										<div class="cell col6">
											<input type="text" name="attr_thrown_object_rof" value="1" title="Macro: @{NAME|thrown_object_rof}" />
										</div>
										<div class="cell col5-thrown">
											<input type="text" name="attr_thrown_object_shots" value="1" title="Macro: @{NAME|thrown_object_shots}" />
										</div>
										<div class="cell col9">
											<input type="text" name="attr_thrown_object_recoil" value="-1" title="Macro: @{NAME|thrown_object_recoil}" />
										</div>
										<div class="cell col10">
											<input type="text" name="attr_thrown_object_skill" value="10" title="Macro: @{NAME|thrown_object_skill}" />
										</div>
										<div class="cell col11">
											<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Attack}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Thrown Object @{thrown_object_weight} @{weight_system}.}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[{@{thrown_object_skill} + @{modifier} + @{ranged_roll_modifier}, @{ranged_roll_max_nine_value} }kl1]]}} {{useModTool=[[1]]}} {{maxNine=[[@{ranged_roll_max_nine}]]}} {{rollModifier=[[@{ranged_roll_modifier}]]}} {{rollModifierSummary=@{ranged_roll_modifier_summary}}} {{rollTraitSummary=@{ranged_roll_trait_summary}}} {{hitLocation=@{ranged_roll_hit_location}}} {{maneuver=@{ranged_roll_maneuver}}} {{allOutAttack=@{ranged_roll_allout_attack}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Thrown}} {{notes=@{thrown_object_notes}}} {{rof=@{thrown_object_rof}}} {{recoil=@{thrown_object_recoil}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" name="roll_vsSL" />
										</div>
									</div> <!-- .row -->

									<div class="melee-notebox">

										<div class="row">

											<!-- hidden input is used to show/hide Row ID: based on selection -->
											<input type="hidden" name="attr_thrown_link_type" value="DX" />
											<div class="cell margin-right">
												<div class="popup">
													<span data-i18n="link-to-label">Link To</span>:
												</div>
												<span class="tooltip">
													<span data-i18n="thrown-link-to-note"></span>
												</span>
											</div>
											<div class="cell margin-right">
												<select name="attr_thrown_link_type" title="Macro: @{NAME|thrown_link_type}">
													<option value="nothing" data-i18n="option-nothing">Nothing</option>
													<option value="DX" selected data-i18n="option-dexterity">DX</option>
													<option value="Skill" data-i18n="option-skill">Skill</option>
													<option value="Technique" data-i18n="option-technique">Technique</option>
												</select>
											</div>
											<div class="cell col-row-id label show-hide-row-id">
												<div class="popup">
													<span data-i18n="row-id-label">Row ID:</span>
												</div>
												<span class="tooltip">
													<span data-i18n="copy-paste-row-id-tooltip">
				Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
				When the skill/spell is updated, the technique's parent name and base skill level<br />
				will be updated.<br />
				Once entered, this will change the Skill/Spell for this particular attack to match<br />
				the skill/spell level of the Base Skill. Do not change this skill Level number manually.
													</span>
												</span>	
											</div>
											<div class="cell col-input-medium show-hide-row-id">
												<input type="hidden" name="attr_thrown_skill_row_id_toggle" value="0" />
												<input type="text" name="attr_thrown_skill_row_id" class="align-left" title="Macro: @{NAME|thrown_skill_row_id}" />
											</div>
											<div class="cell">
												<span data-i18n="skill-modifier-label">Skill Mod</span><span>:</span>
												<input type="number" value="0" step="1" name="attr_thrown_skill_modifier" />
											</div>
		
											<div class="cell col-wide">
												<input type="hidden" name="attr_thrown_skill_row_id_message" value="DX" />
												<b><span data-i18n="name-label">Name:</span></b>
												<span name="attr_thrown_skill_row_id_message"></span>
												<input type="hidden" name="attr_thrown_skill_row_id_level" value="" />
												<b><span data-i18n="skill-level-label">Level</span>:</b>
												<span name="attr_thrown_skill_row_id_level"></span>
											</div>
		
										</div> <!-- .row -->
		
										<div class="row">
											<div class="cell">
												<span data-i18n="thrown-reason-for-modifiers-label">Reason for all modifiers (ST, Damage, Skill)</span><br />
												<textarea class="text-left notes" name="attr_thrown_object_reason_for_mod" title="Macro: @{NAME|attr_thrown_object_reason_for_mod}"></textarea>
											</div>
										</div>
						
										<div class="row">
											<div class="cell">
												<span data-i18n="weapon-notes-label">Weapon Notes</span><br />
												<textarea class="text-left notes" name="attr_thrown_object_notes" title="Macro: @{NAME|attr_thrown_object_notes}"></textarea>
											</div>
											<div class="cell">
												<div>
													<div class="popup">
														<span data-i18n="damage-notes-label">Damage Notes</span>
													</div>
													<span class="tooltip">
														<span data-i18n="ranged-damage-notes-tooltip"><strong>Hint:</strong> Enter inline rolls for additional results.<br />Example: Does an additional [[1d6]] fire damage.</span>
													</span>
												</div>
												<textarea class="text-left notes" name="attr_thrown_object_damage_notes" title="Macro: @{NAME|attr_thrown_object_damage_notes}"></textarea>
											</div>
										</div> <!-- .row -->
									</div>

								</div> <!-- .row -->
							</div>
							<!-- .end repcontainer -->
							
						</div> <!-- .table -->
					</div> <!-- .box .ranged-attacks -->
					
					<!-- _____ _____ Firing Up or Down _____ _____ -->
					<div class="box firing-up-down">
						<div class="table">
							<div class="row title">
								
								<div class="cell range-calculator-title">
									<span data-i18n="range-calculator-label">Range Calculator</span>
								</div>
								<div class="cell reset range-calculator-reset">
									<button type="action" name="act_range_calc_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
								</div>
							</div>
							<div class="header">
								<div class="cell linear-range">
									<div class="popup">
										<span data-i18n="range-label">Range</span>
									</div>
									<div class="tooltip">
										<span data-i18n="firing-up-down-range-tooltip">
			Distance between shooter and target.<br />
			See B372-373
										</span>
									</div>
								</div>
								<div class="cell speed">
									<div class="popup">
										<span data-i18n="speed-label">Speed</span>
									</div>
									<div class="tooltip">
										<span data-i18n="firing-up-down-speed-tooltip">
			(2 mph = 1 yard/second).<br />
			Ignore if human like target moving 10 yards or less.<br />
			See B372-373
										</span>
									</div>
								</div>
								<div class="cell fire-up-dwn-distance">
									<div class="popup">
										<span data-i18n="abbreviation-elevation-label">Elev</span>
									</div>
									<div class="tooltip">
										<span data-i18n="ranged-elevation-label">Elevation. If you're above the target, enter a positive number of hexes. If you're below the target, enter a negative number of hexes. See B407.</span>
									</div>
								</div>
								<div class="cell new-range">
									<div class="popup">
										<span data-i18n="abbreviation-effective-label">EFF</span>
									</div>
									<div class="tooltip">
										<span data-i18n="effective-speed-range-tooltip">Effective speed/range based on range, speed, and elevation.</span>
									</div>
								</div>
								<div class="cell speed">
									<div class="popup">
										<span data-i18n="abbreviation-accuracy-label">Acc</span>
									</div>
									<div class="tooltip">
										<span data-i18n="accuracy-bonus-tooltip">Accuracy</span>
									</div>
								</div>
								<div class="cell aiming">
									<div class="popup">
										<span data-i18n="aim-bonus-label">Aim Bonus</span>
									</div>
									<div class="tooltip">
										<span data-i18n="aiming-bonus-tooltip">Each turn <b>after</b> the initial aim, you get an additional bonus. See B364</span>
									</div>
								</div>
								<div class="cell rof">
									<div class="popup">
										<span data-i18n="shots-fired-label">Fired</span>
									</div>
									<div class="tooltip">
										<span data-i18n="shots-fired-tooltip">
											Shots Fired<br>The number of shots fired in a single round. This should not exceed the <b>RoF</b> for the weapon.
										</span>
									</div>
								</div>
								<div class="cell size">
									<div class="popup">
										<span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span>
									</div>
									<span class="tooltip">
										<span data-i18n="target-size-modifier-tooltip">Size Modifier of target.</span>
									</span>
								</div>
								<div class="cell hit-mod">
									<span data-i18n="abbreviation-hit-modifier-label">Hit Mod</span>
								</div>
								<div class="cell braced">
									<div class="popup">
										<span data-i18n="braced-title">Braced</span>
									</div>
									<span class="tooltip">
										<span data-i18n="braced-title-tooltip">If you brace a firearm or crossbow, you get an extra +1 to Acc. See B364.</span>
									</span>
								</div>
								<div class="cell braced apply-button">
									<div class="popup">
										<span data-i18n="help-label">Help</span>
									</div>
									<div class="tooltip">
										<span data-i18n="apply-firing-tooltip">Apply this modifier to the ranged <b>Modifier</b> box and <b>Roll Modifiers</b> tool.</span>
									</div>
								</div>
							</div> <!-- .header -->
							
							<div class="container">
								
								<div class="row">
									<div class="cell linear-range">
										<input type="number" step="1" value="0" min="0" name="attr_firing_distance" title="Macro: @{NAME|firing_distance}" />
									</div>
									<div class="cell speed">
										<input type="number" step="1" value="0" min="0" name="attr_firing_speed_difference" title="Macro: @{NAME|firing_speed_difference}" />
									</div>
									<div class="cell fire-up-dwn-distance">
										<input type="number" step="1" value="0" name="attr_firing_elevation" title="Macro: @{NAME|firing_elevation}" />
									</div>
									<div class="cell new-range">
										<input type="number" step="1" value="0" min="0" name="attr_firing_new_range" readonly="readonly" title="Macro: @{NAME|firing_new_range}" />
									</div>
									<div class="cell speed">
										<input type="number" step="1" value="0" min="0" name="attr_firing_acc" title="Macro: @{NAME|firing_acc}" />
									</div>
									<div class="cell aiming">
										<select name="attr_firing_aiming_bonus" title="Macro: @{NAME|firing_aiming_bonus}">
											<option value="0" selected="selected">+0</option>
											<option value="1">2 turns: +1</option>
											<option value="2">3+ turns: +2</option>
										</select>
									</div>
									<div class="cell rof">
										<input type="number" step="1" value="1" min="1" name="attr_firing_rof" title="Macro: @{NAME|firing_rof}" />
									</div>
									<div class="cell size">
										<input type="number" step="1" value="0" name="attr_firing_size_mod" title="Macro: @{NAME|firing_size_mod}" />
									</div>
									<div class="cell hit-mod">
										<input type="number" step="1" value="0" name="attr_firing_hit_mod" readonly="readonly" title="Macro: @{NAME|firing_hit_mod}" />
									</div>
									<div class="cell braced roll-modifiers centered">
										<input type="checkbox" name="attr_firing_braced" value="1" title="Macro: @{NAME|firing_braced}">
									</div>
									<div class="cell braced reset apply-button">
										<button type="action" name="act_apply_firing_modifiers" class="reset"><span data-i18n="apply-label">Apply</span></button>
									</div>
								</div>
							</div> <!-- .container -->
							
						</div> <!-- .table -->
					</div> <!-- .box .ranged-attacks firing-up-or-down -->
					
					<!-- _____ _____ Shotgun Tool _____ _____ -->
					<div class="box shotgun-tool">
						<div class="table">
							
							<div class="row title">
								<div class="cell">
									<div class="popup">
										<span data-i18n="close-range-shotgun-label">Close Range Shotgun & Multiple Projectile Damage Tool</span></div>
									<div class="tooltip">
										<span data-i18n="close-range-shotgun-label-tooltip">Used for extremely close combat at a range of 10% of the ½D Range or less. See Shotguns and Multiple Projectiles for more details.</span>
									</div>
								</div>
							</div>
							
							<div class="header">
								<div class="cell damage">
									<span data-i18n="abbreviation-damage-label">DMG</span>
								</div>
								<div class="cell rof">
									<span data-i18n="abbreviation-rate-of-fire-label">RoF</span>
								</div>
								<div class="cell damage-type">
									<span data-i18n="type-label">Type</span>
								</div>
								<div class="cell range">
									<div class="popup">
										<span class="one-half">1/2</span> <span data-i18n="range-label">Range</span>
									</div>
									<div class="tooltip">
										<span data-i18n="shotgun-half-damage-tooltip">Enter half-damage range of shotgun.</span>
									</div>
								</div>
								<div class="cell close-range">
									<div class="popup">
										<span data-i18n="close-label">Close</span>
									</div>
									<div class="tooltip">
										<span data-i18n="shotgun-close-range-tooltip">This value is 10% of the ½D Range of the weapon. This is the maximum range this tool is used for.</span>
									</div>
								</div>
								<div class="cell close-rof">
									<div class="popup">
										<span data-i18n="abbreviation-rate-of-fire-label">RoF</span>
									</div>
									<span class="tooltip">
										<span data-i18n="shotgun-new-rate-of-fire-tooltip">New Rate of Fire</span>
									</span>
								</div>
								<div class="cell close-damage">
									<div class="popup">
										<span data-i18n="abbreviation-damage-label">DMG</span>
									</div>
									<div class="tooltip">
										<span data-i18n="shotgun-new-damage-tooltip">New Damage</span>
									</div>
								</div>
								<div class="cell close-damage">
									<div class="popup">
										<span data-i18n="abbreviation-damage-resistance-multiplier-label">DR Mult.</span>
									</div>
									<div class="tooltip">
										<div data-i18n="shotgun-damage-resistance-multiplier-tooltip">Damage Resistance Multiplier.</div>
									</div>
								</div>
								<div class="cell roll-damage">
									&nbsp;
								</div>
								<div class="cell reset">
									&nbsp;
								</div>
							</div> <!-- .header -->
							
							<div class="container">
								
								<div class="row">
									<div class="cell damage">
										<input type="text" value="1d6+1" name="attr_shotgun_damage" title="Macro: @{NAME|shotgun_damage}" />
									</div>
									<div class="cell rof">
										<input type="text" value="2x9" name="attr_shotgun_rof" title="Macro: @{NAME|shotgun_rof}" />
									</div>
									<div class="cell type">
										<select name="attr_shotgun_damage_type" title="Macro: @{NAME|shotgun_damage_type}">
											<option value="Affliction (aff)"><span data-i18n="abbreviation-option-affliction">aff</span></option>
											<option value="Burning (burn)"><span data-i18n="abbreviation-option-burning">burn</span></option>
											<option value="Corrosion (cor)"><span data-i18n="abbreviation-option-corrosion">cor</span></option>
											<option value="Crushing (cr)"><span data-i18n="abbreviation-option-crushing">cr</span></option>
											<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
											<option value="Fatigue (fat)"><span data-i18n="abbreviation-option-fatigue">fat</span></option>
											<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
											<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
											<option value="Piercing (pi)" selected="selected"><span data-i18n="abbreviation-option-piercing">pi</span></option>
											<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
											<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
											<option value="Special (spec)"><span data-i18n="abbreviation-option-special">spec</span></option>
											<option value="Knockback (knock)"><span data-i18n="abbreviation-option-knockback">knock</span></option>
											<option value="Toxic (tox)"><span data-i18n="abbreviation-option-toxic">tox</span></option>
										</select>
									</div>
									<div class="cell range">
										<input type="number" value="50" step="1" min="0" name="attr_shotgun_half_range" title="Macro: @{NAME|shotgun_half_range}" />
									</div>
									<div class="cell close-range">
										<input type="text" value="5" name="attr_shotgun_close_range" readonly="readonly" title="Macro: @{NAME|shotgun_close_range}" />
									</div>
									<div class="cell close-rof">
										<input type="text" value="2" name="attr_shotgun_close_rof" readonly="readonly" title="Macro: @{NAME|shotgun_close_row}" />
									</div>
									<div class="cell close-damage">
										<input type="text" value="4d6+4" name="attr_shotgun_close_damage" readonly="readonly" title="Macro: @{NAME|shotgun_close_damage}" />
									</div>
									<div class="cell close-damage">
										<input type="text" value="DR x 4" name="attr_shotgun_dr_multiplier" readonly="readonly" title="Macro: @{NAME|shotgun_dr_multiplier}" />
										<input type="hidden" name="attr_shotgun_dr_multiplier_notes" value="Multiply targets DR by 4." />
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<input type="hidden" name="attr_shotgun_damage_type_note" value="PIERCING
			Damage x1
			Vitals Damage x3
			Skull Damage x4" />
										<input type="hidden" name="attr_shotgun_minimum_damage_note" value="Min 1" />
										<input type="hidden" name="attr_shotgun_minimum_damage" value="1" />
										<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{damageRoll=[[@{shotgun_close_damage}]]}} {{drMultiplier=@{shotgun_dr_multiplier}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Close Shotgun Damage}} {{damageType=@{shotgun_damage_type}}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{shotgun_damage_type_note}}}" name="roll_dmgCloseShotgunDamage" class="roll_damage" />
									</div>
									<div class="cell reset">
										<button type="action" name="act_shotgun_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
									</div>
								</div>
								
								<div class="row shotgun-notes">
									<span data-i18n="shotgun-notes-description">
			Enter the stats of the shotgun, be sure to use half-damage range. The tool will calculate how 
			close you need to be with the shotgun, the RoF, close range damage, and DR multiplier.
			For more information, see B409.
									</span>
								</div>
							</div> <!-- .container -->
							
						</div> <!-- .table -->
					</div> <!-- .box .shotgun tool -->
					
				</div>

				<div class="tools">

					<!-- _____ _____ Slam Attack _____ _____ -->
					<div class="box slam-attack-tool">

						<input type="hidden" name="attr_is_slam_attack_new" value="1" />
						<div class="slam-attack-table">
							<!-- title row -->
							<div class="item title">
								<span data-i18n="slam-attack-label">Slam Attack</span>
							</div>

							<!-- header row -->
							<div class="item slam-toggle">&nbsp;</div>
							<div class="item slam-name">&nbsp;</div>
							<div class="item header">
								<div class="popup">
									<span data-i18n="velocity-label">Velocity</span>
								</div>
								<span class="tooltip">
									<span data-i18n="slam-velocity-tooltip">Your movement rate (yards/meters/hexes per second) for the current round.</span>
								</span>
							</div>
							<div class="item header">
								<div class="popup">
									<span data-i18n="abbreviation-hit-points-label">HP</span>
								</div>
								<div class="tooltip">
									<span data-i18n="slam-hit-points-tooltip">Your Hit Points</span>
								</div>
							</div>
							<div class="item header">
								<span data-i18n="damage-label">Damage</span>
							</div>
							<div class="item"><!-- damage die --></div>
							<div class="item header">
								<span data-i18n="type-label">Type</span>
							</div>
							<div class="item header">
								<span data-i18n="abbreviation-modifier-label">Mod</span>
							</div>
							<div class="item header skill-level">
								<span data-i18n="skill-label">Skill</span>
							</div>
							<div class="item"><!-- skill die --></div>

							<!-- slam data row -->
							<input type="hidden" name="attr_toggle_slam_options" />
							<div class="item">
								<input type="checkbox" name="attr_toggle_slam_options" class="arrow-toggle margin-left-sm" title="View slam options." />
							</div>
							<div class="item subtitle">
								<div class="popup">
									<span data-i18n="slam-label">Slam</span>
								</div>
								<span class="tooltip">
									<span data-i18n="slam-attack-tooltip">
Slam requires an Attack, All-out Attack, or Move and Attack maneuver. Your foe may block, dodge, or parry (but your body counts as a heavy weapon; see Parrying Heavy Weapons B376). If your foe dodges, you must move at least two yards past him if you have enough movement. If you would hit someone else, see Hitting the Wrong Target (B389). You can use All-Out Attack (Strong), +2 to Damage (B365), to increase your damage! (B371)
									</span>
								</span>
							</div>
							<div class="item">
								<input type="number" value="1" min="1" step="1" name="attr_slam_velocity" title="Macro: @{NAME|slam_velocity}" />
							</div>
							<div class="item">
								<input type="number" step="1" value="" min="1" name="attr_slam_hit_points" title="Macro: @{NAME|slam_hit_points}" />
							</div>
							<div class="item">
								<input type="text" value="1d6" name="attr_slam_damage" readonly title="Macro: @{NAME|slam_damage}" />
							</div>
							<div class="item">
								<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
								<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Slam Damage}} {{damageRoll=[[ { @{slam_damage}, {@{slam_minimum_damage}} }kh1 ]]}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{slam_damage_type_note}}} {{notesTitlePrefix=Damage}} {{notes=@{raw_slam_damage_notes}}}" name="roll_dmgSlam" class="roll_damage" />
							</div>
							<div class="item">
								<select name="attr_slam_damage_type" title="Macro: @{NAME|slam_damage_type}">
									<option value="Crushing (cr)" selected><span data-i18n="abbreviation-option-crushing">cr</span></option>
									<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
									<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
									<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
									<option value="Piercing (pi)"><span data-i18n="abbreviation-option-piercing">pi</span></option>
									<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
									<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
									<option value="Affliction (aff)"><span data-i18n="abbreviation-option-affliction">aff</span></option>
									<option value="Burning (burn)"><span data-i18n="abbreviation-option-burning">burn</span></option>
									<option value="Corrosion (cor)"><span data-i18n="abbreviation-option-corrosion">cor</span></option>
									<option value="Fatigue (fat)"><span data-i18n="abbreviation-option-fatigue">fat</span></option>
									<option value="Toxic (tox)"><span data-i18n="abbreviation-option-toxic">tox</span></option>
									<option value="Knockback (knock)"><span data-i18n="abbreviation-option-knockback">knock</span></option>
									<option value="Special (spec)"><span data-i18n="abbreviation-option-special">spec</span></option>
								</select>
								<input type="hidden" name="attr_slam_damage_type_note" value="@{damage_type_note_cr}" />
								<input type="hidden" name="attr_slam_minimum_damage_note" value="Min 0" />
								<input type="hidden" name="attr_slam_minimum_damage" value="0" />
								<input type="hidden" name="attr_slam_damage_divisor" value="1" />
							</div>
							<div class="item">
								<input type="number" step="1" value="0" name="attr_slam_skill_modifier" title="Macro: @{NAME|skill_modifier}" />
							</div>
							<div class="item">
								<input type="text" value="10" name="attr_slam_skill_level" title="Macro: @{NAME|slam_skill_level}" />
							</div>
							<div class="item">
								<input type="hidden" name="attr_slam_option_modifier_value" value="0" />
								<input type="hidden" name="attr_slam_option_modifier_description" value="" />
								<button type="action" name="act_roll_attack_melee_slam" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Melee Attack}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Slam Attack}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{slam_skill_level} + @{slam_option_modifier_value}]]}} {{notes=@{raw_slam_attack_notes}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Slam}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{customSuccessNote=@{slam_success_notes}}} {{customCriticalSuccessNote=@{slam_critical_success_notes}}} {{customFailNote=@{slam_fail_notes}}} {{customCriticalFailNote=@{slam_critical_fail_notes}}} {{useModTool=[[1]]}} {{rollModifier=@{slam_option_modifier_value}}} {{rollModifierSummary=@{slam_option_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}" />
							</div>
							
							<!-- slam options row -->
							<div class="item slam-options-box melee-notebox">
								
								<div class="row">

									<!-- hidden input is used to show/hide Row ID: based on selection -->
									<input type="hidden" name="attr_slam_link_type" value="DX" />
									<div class="cell margin-right">
										<div class="popup">
											<span data-i18n="link-to-label">Link To</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="slam-link-to-note">
Slam uses either DX, Brawling, or Sumo Wrestling. Note that the -4 to hit and effective skill cap of 9 for a Move and Attack do not apply to slams. (B371)
											</span>
										</span>
									</div>
									<div class="cell margin-right">
										<select name="attr_slam_link_type" title="Macro: @{NAME|slam_link_type}">
											<option value="nothing" data-i18n="option-nothing">Nothing</option>
											<option value="DX" selected data-i18n="option-dexterity">DX</option>
											<option value="Skill" data-i18n="option-skill">Skill</option>
											<option value="Technique" data-i18n="option-technique">Technique</option>
										</select>
									</div>
									<div class="cell col-row-id label show-hide-row-id">
										<div class="popup">
											<span data-i18n="row-id-label">Row ID:</span>
										</div>
										<span class="tooltip">
											<span data-i18n="copy-paste-row-id-tooltip">
		Copy/paste the Skill or Spell Row ID to link that skill to this technique.<br />
		When the skill/spell is updated, the technique's parent name and base skill level<br />
		will be updated.<br />
		Once entered, this will change the Skill/Spell for this particular attack to match<br />
		the skill/spell level of the Base Skill. Do not change this skill Level number manually.
											</span>
										</span>	
									</div>
									<div class="cell col-input-medium show-hide-row-id">
										<input type="hidden" name="attr_slam_skill_row_id_toggle" value="0" />
										<input type="text" name="attr_slam_skill_row_id" class="align-left" title="Macro: @{NAME|slam_skill_row_id}" />
									</div>

									<div class="cell col-wide">
										<input type="hidden" name="attr_slam_skill_row_id_message" value="DX" />
										<b><span data-i18n="name-label">Name:</span></b>
										<span name="attr_slam_skill_row_id_message"></span>
										<input type="hidden" name="attr_slam_skill_row_id_level" value="" />
										<b><span data-i18n="skill-level-label">Level</span>:</b>
										<span name="attr_slam_skill_row_id_level"></span>
									</div>

								</div> <!-- .row -->

								<div class="row">
									<div class="cell label">
										<div class="popup">
											<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
										</div>
										<span class="tooltip">
											<span data-i18n="reason-for-modifiers-skills-tooltip">
		Examples:<br />
		+1 from Talent...<br />
		+1 from Default Skill...<br />
		+1 from Enchanted Item with...
											</span>
										</span>
									</div>
								
									<div class="cell reason-for-mod">
										<input type="text" name="attr_slam_reason_for_mod" class="align-left" title="Macro: @{NAME|slam_reason_for_mod}" />
									</div>

								</div><!-- .row -->

								<div class="row">
									<div class="cell label" style="width: 85px">
										<div class="popup">
											<span data-i18n="slam-flying-tackle-label">Flying Tackle</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="slam-flying-tackle-tooltip">+4 to hit and +1 to Reach, may use Jumping Skill for attack. You end up lying prone in the same hex as target. B372</span>
										</span>
									</div>
								
									<div class="cell roll-modifiers">
										<input type="hidden" name="attr_slam_flying_tackle_modifier" value="0" />
										<input type="checkbox" name="attr_slam_flying_tackle" value="1" />
									</div>

								</div><!-- .row -->

								<div class="row">
									<div class="cell label" style="width: 85px">
										<div class="popup">
											<span data-i18n="slam-pounce-label">Pounce</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="slam-pounce-tooltip">If you have four or more legs, you may pounce. After you attack, make a DX, Acrobatics, or Jumping roll. On a success, you stay on your feet! If a mount tries this, the rider must roll vs. Riding-4 or fall off! B372</span>
										</span>
									</div>
								
									<div class="cell roll-modifiers">
										<input type="hidden" name="attr_slam_pounce_modifier" value="0" />
										<input type="checkbox" name="attr_slam_pounce" value="1" />
									</div>

								</div><!-- .row -->

								<div class="row">
									<div class="cell label" style="width: 85px">
										<div class="popup">
											<span data-i18n="slam-shield-rush-label">Shield Rush</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="slam-shield-rush-tooltip">Roll against Shield skill to hit, and add your shield's Defense Bonus to your damage roll. Your shield takes damage instead of you. B372</span>
										</span>
									</div>
								
									<div class="cell roll-modifiers">
										<input type="number" value="0" min="0" step="1" name="attr_slam_shield_db" class="slam-db-width inline" /> 
										<span data-i18n="slam-shield-rush-db-label">DB (added to damage!)</span>
									</div>
								</div><!-- .row -->

								<div class="row">
									<div class="cell label" style="width: 85px">
										<div class="popup">
											<span data-i18n="slam-overrun-label">Overrun</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="slam-overrun-tooltip">If your SM is 2 or more than the target, apply overrun damage. This inflicts additional crushing damage based on ST = Your HP/2. B432</span>
										</span>
									</div>
								
									<div class="cell roll-modifiers">
										<input type="checkbox" name="attr_slam_overrun" value="1" />
										
									</div>

									<div class="cell roll-modifiers" style="margin-left: 4px;">
										Effective ST: <input type="number" name="attr_slam_overrun_st" class="slam-db-width inline" readonly value="" />
									</div>

									<div class="cell roll-modifiers" style="margin-left: 4px;">
										Damage: <input type="text" name="attr_slam_overrun_damage" class="slam-damage-width inline" readonly value="" />
									</div>

									<div class="cell roll-modifiers" style="margin-left: 4px;">
										<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Overrun Damage}} {{damageRoll=[[ { @{slam_overrun_damage}, {@{slam_minimum_damage}} }kh1 ]]}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{slam_damage_type_note}}}" name="roll_dmgOverrun" class="roll_damage" />
									</div>
								</div><!-- .row -->

								<div class="row">
									<div class="cell">
										<div class="popup">
											<span data-i18n="success-note-label">Success Note</span>
										</div>
										<span class="tooltip">
											<span data-i18n="melee-success-notes-tooltip">
		<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
		Example: Select Location: ?{Location|Head|Torso}
											</span>
										</span>
										<textarea class="text-left chat-size" name="attr_slam_success_notes" title="Macro: @{NAME|slam_success_notes}"></textarea>
									</div>
									<div class="cell">
										<div class="popup">
											<span data-i18n="critical-success-note-label">Critical Success Notes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="melee-critical-success-notes-tooltip">
		<strong>Hint:</strong> Enter inline rolls for additional results.<br />
		Example: Does an additional [[1d6]] fire damage.
											</span>
										</span>
										<textarea class="text-left chat-size" name="attr_slam_critical_success_notes" title="Macro: @{NAME|slam_critical_success_notes}"></textarea>
									</div>
								</div> <!-- .row -->

								<div class="row">
									<div class="cell">
										<div class="popup">
											<span data-i18n="fail-note-label">Fail Note</span>
										</div>
										<span class="tooltip">
											<span data-i18n="melee-fail-notes-tooltip">
		<strong>Hint:</strong> Enter inline rolls for additional results. To show the selected arrow.<br />
		Example: Select Location: ?{Location|Head|Torso}
											</span>
										</span>
										<textarea class="text-left chat-size" name="attr_slam_fail_notes" title="Macro: @{NAME|slam_fail_notes}"></textarea>
									</div>
									<div class="cell">
										<div class="popup">
											<span data-i18n="critical-fail-note-label">Critical Fail Notes</span>
										</div>
										<span class="tooltip">
											<span data-i18n="melee-critical-fail-notes-tooltip">
		<strong>Hint:</strong> Enter inline rolls for additional results.<br />
		Example: Does an additional [[1d6]] fire damage.
											</span>
										</span>
										<textarea class="text-left chat-size" name="attr_slam_critical_fail_notes" title="Macro: @{NAME|slam_critical_fail_notes}"></textarea>
									</div>
								</div> <!-- .row -->
								
							</div>

						</div>

					</div>
					
					<!-- _____ _____ Falling and Collision _____ _____ -->
					<div class="box falling-collision">
						<div class="table">
							
							<div class="row title">
								<div class="cell">
									<span data-i18n="falling-collision-label">Falling and Collision</span>
								</div>
							</div>
							
							<div class="header">
								<div class="cell row-title">
									&nbsp;
								</div>
								<div class="cell yards-fallen">
									<div class="popup">
										<span data-i18n="abbreviation-yards-fallen-label">Yds Fallen</span>
									</div>
									<div class="tooltip">
										<span data-i18n="yards-fallen-tooltip">Atmosphere</span>
									</div>
								</div>
								<div class="cell gravity">
									<span data-i18n="gravity-label">Gravity</span>
								</div>
								<div class="cell atmosphere">
									<div class="popup">
										<span data-i18n="abbreviation-atmosphere-label">Atm.</span>
									</div>
									<div class="tooltip">
										<span data-i18n="atmosphere-tooltip">Atmosphere</span>
									</div>
								</div>
								<div class="cell velocity">
									<div class="popup">
										<span data-i18n="velocity-label">Velocity</span>
									</div>
									<span class="tooltip">
										<span data-i18n="falling-velocity-tooltip"><b>Terminal Velocity Multiplier</b><br /><i>Terminal Velocity</i> On Earth, human-shaped 60 (spread-eagle) to 100 (dive) yards/second. Dense objects can be up to 200 yards/second or more. (B431).<br />Use the <b>multiplier</b> below to determine the new terminal velocity.</span>
									</span>
								</div>
								<div class="cell terminal-velocity">
									<div class="popup">
										<span data-i18n="terminal-label">Terminal</span>
									</div>
									<span class="tooltip">
										<span data-i18n="terminal-velocity-tooltip">
			If collision, use relative velocity.<br />
			Head-on collision = Add velocity of both objects<br />
			Rearend collision = Faster object - slower object<br />
			Side collision = Speed of object causing collision<br />
										</span>
									</span>
								</div>
								<div class="cell hit-points">
									<div class="popup">
										<span data-i18n="abbreviation-hit-points-label">HP</span>
									</div>
									<div class="tooltip">
										<span data-i18n="falling-hit-points-tooltip">
			Hit Points of falling object or object initiating <br />
			collision.<br />
			If hitting immovable object, use HP*2<br />
			NOTE: If collision, if the other object is moving<br />
			it will inflict its own damage to object that initiated<br />
			the collision.<br />
			See B430
										</span>
									</div>
								</div>
								<div class="cell hard-object">
									<div class="popup">
										<span data-i18n="hard-label">Hard</span>
									</div>
									<div class="tooltip">
										<span data-i18n="hard-object-tooltip">If hitting a hard object (clay, concrete, soil, sand, etc.), check the box to double the HP. B431</span>
									</div>
								</div>
								<div class="cell damage">
									<span data-i18n="damage-label">Damage</span>
								</div>
								<div class="cell damage-type">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<div class="tooltip">
										<span data-i18n="falling-damage-type-tooltip">Normal objects are crushing. If bullet-shaped, sharp, or spiked select appropriate damage type, but damage is halved. B430</span>
									</div>
								</div>
								<div class="cell roll-damage">
									&nbsp;
								</div>
								<div class="cell reset">
									&nbsp;
								</div>
							</div> <!-- .header -->
							
							<div class="container">
								
								<div class="row">
									<div class="cell row-title">
										<span data-i18n="falling-label">Falling</span>
									</div>
									<div class="cell yards-fallen">
										<input type="number" step="1" value="1" min="1" name="attr_yards_fallen" title="Macro: @{NAME|yards_fallen}" />
									</div>
									<div class="cell gravity">
										<input type="number" value="1" min="0" step=".01" name="attr_gravity" title="Macro: @{NAME|gravity}" />
									</div>
									<div class="cell atmosphere">
										<input type="number" value="1" min="0" name="attr_atmosphere" title="Macro: @{NAME|atmosphere}" />
									</div>
									<div class="cell velocity">
										<input type="number" value="5" readonly="readonly" name="attr_falling_velocity" title="Macro: @{NAME|falling_velocity}" />
									</div>									
									<div class="cell terminal-velocity">
										<input type="number" value="1" readonly="readonly" name="attr_terminal_velocity_multiplier" title="Macro: @{NAME|terminal_velocity_multiplier}" />
									</div>
									<div class="cell hit-points">
										<input type="number" step="1" value="10" min="1" name="attr_falling_hit_points" title="Macro: @{NAME|falling_hit_points}" />
									</div>
									<div class="cell hard-object">
										<input type="checkbox" name="attr_falling_hard_object" value="1" title="Macro: @{NAME|falling_hard_object}" />
									</div>
									<div class="cell damage">
										<input type="text" value="1d6-2" name="attr_falling_damage" readonly="readonly" title="Macro: @{NAME|falling_damage}" />
									</div>
									<div class="cell damage-type">
										<select name="attr_falling_damage_type" title="Macro: @{NAME|falling_damage_type}">
											<option value="Crushing (cr)" selected><span data-i18n="abbreviation-option-crushing">cr</span></option>
											<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
											<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
											<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
											<option value="Piercing (pi)"><span data-i18n="abbreviation-option-piercing">pi</span></option>
											<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
											<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
										</select>
										<input type="hidden" name="attr_falling_damage_type_note" value="@{damage_type_note_cr}" />
										<input type="hidden" name="attr_falling_minimum_damage_note" value="Min 0" />
										<input type="hidden" name="attr_falling_minimum_damage" value="0" />
										<input type="hidden" name="attr_falling_damage_divisor" value="1" />
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Falling Damage}} {{damageRoll=[[ { @{falling_damage}, {@{falling_minimum_damage}} }kh1 ]]}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{falling_damage_type_note}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Falling}} {{notes=@{falling_damage_notes}}}" name="roll_dmgFalling" class="roll_damage" />
									</div>
									<div class="cell reset">
										<button type="action" name="act_falling_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
									</div>
								</div>
								
								<div class="row">
									<div class="cell row-title">
										<span data-i18n="collision-label">Collision</span>
									</div>
									<div class="cell yards-fallen">
										&nbsp;
									</div>
									<div class="cell gravity">
										&nbsp;
									</div>
									<div class="cell atmosphere">
										&nbsp;
									</div>
									<div class="cell velocity">
										<input type="number" value="1" step="1" min="1" name="attr_collision_velocity" title="Macro: @{NAME|collision_velocity}" />
									</div>
									<div class="cell terminal-velocity">
										&nbsp;
									</div>
									<div class="cell hit-points">
										<input type="number" step="1" value="10" min="1" name="attr_collision_hit_points" title="Macro: @{NAME|collision_hit_points}" />
									</div>
									<div class="cell hard-object">
										<input type="checkbox" name="attr_collision_hard_object" value="1" title="Macro: @{NAME|collision_hard_object}" />
									</div>
									<div class="cell damage">
										<input type="text" value="1d6-3" name="attr_collision_damage" readonly="readonly" title="Macro: @{NAME|collision_damage}" />
									</div>
									<div class="cell damage-type">
										<select name="attr_collision_damage_type" title="Macro: @{NAME|collision_damage_type}">
											<option value="Crushing (cr)" selected><span data-i18n="abbreviation-option-crushing">cr</span></option>
											<option value="Cutting (cut)"><span data-i18n="abbreviation-option-cutting">cut</span></option>
											<option value="Impaling (imp)"><span data-i18n="abbreviation-option-impaling">imp</span></option>
											<option value="Small Piercing (pi-)"><span data-i18n="abbreviation-option-piercing-minus">pi-</span></option>
											<option value="Piercing (pi)"><span data-i18n="abbreviation-option-piercing">pi</span></option>
											<option value="Large Piercing (pi+)"><span data-i18n="abbreviation-option-piercing-plus">pi+</span></option>
											<option value="Huge Piercing (pi++)"><span data-i18n="abbreviation-option-piercing-plus-plus">pi++</span></option>
										</select>
										<input type="hidden" name="attr_collision_damage_type_note" value="@{damage_type_note_cr}" />
										<input type="hidden" name="attr_collision_minimum_damage_note" value="Min 0" />
										<input type="hidden" name="attr_collision_minimum_damage" value="0" />
										<input type="hidden" name="attr_collision_damage_divisor" value="1" />
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_thrust_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Damage Roll}} {{characterName=@{character_name}}} {{skillName=Collision Damage}} {{damageRoll=[[ { @{collision_damage}, {@{collision_minimum_damage}} }kh1 ]]}} {{useDamageTypeNotes=[[@{use_damage_type_notes}]]}} {{damageTypeNote=@{collision_damage_type_note}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}} {{notes=@{collision_damage_notes}}}" name="roll_dmgFalling" class="roll_damage" />
									</div>
									<div class="cell reset">
										<button type="action" name="act_collision_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
									</div>
								</div>
								
							</div> <!-- .container -->
							
						</div> <!-- .table -->
					</div> <!-- .box .falling and collision -->
			
			
					<!-- Demolition -->
					<div class="box demolition">
						<div class="table">
							
							<div class="row title">
								<div class="cell">
									<span data-i18n="demolition-label">Demolition</span>
								</div>
							</div>
							
							<div class="header">
								<div class="cell row-title">&nbsp;</div>
								<div class="cell select-box">
									<div class="popup">
										<span data-i18n="select-label">Select</span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-select-tooltip">Select an explosion type to use. This will populate Type and REF fields.</span>
									</span>
								</div>
								<div class="cell text-box">
									<div class="popup">
										<span data-i18n="type-label">Type</span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-type-tooltip"><strong>Type</strong><br />Refer to the REF table B415.</span>
									</span>
								</div>
								<div class="cell input">
									<div class="popup">
										<span data-i18n="abbreviation-relative-explosive-force-label">REF</span>
									</div>
									<span class="tooltip">
										<span data-i18n="relative-explosive-force-tooltip">
			Relative Explosive Force, equivalence in pounds of TNT.<br />
			TNT = 1.0. See B415.
										</span>
									</span>
								</div>
								<div class="cell input">
									<div class="popup">
										<span name="attr_weight_system"></span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-pounds-tooltip">Weight in <span name="attr_weight_system"></span> required by its REF.</span>
									</span>
								</div>
								<div class="cell input">
									<div class="popup">
										<span data-i18n="base-level-label">Base</span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-base-damage-tooltip">Base damage role. Rules as written is 6d6.</span>
									</span>
								</div>
								<div class="cell six-d-spacer">&nbsp;</div>
								<div class="cell damage">
									<div class="popup">
										<span data-i18n="abbreviation-multiplier-label">Multi</span>
									</div>
									<span class="tooltip">
										<span data-i18n="damage-multiplier-tooltip">
			<strong>Damage Multiplier:</strong><br />Enter the number to multiply 6d6 by.<br />
			An explosion doing 6dx<i>n</i> damage takes (<i>n</i>x<i>n</i>)/4 pounds of TNT.<br />
			<b>NOTE:</b> Anyone caught in a blast may attempt an active defense<br />
			roll to dive for cover from the explosion’s collateral damage and<br />
			fragmentation; see Dodge and Drop B377.
										</span>
									</span>
								</div>
								<div class="cell roll-damage">
									<div class="popup">
										<span data-i18n="abbreviation-radius-label">Rad</span>
									</div>
									<span class="tooltip">
										<span data-i18n="radius-collateral-damage-tooltip">
			Radius of collateral damage. See B414<br />
			For instance, if an explosion does 6dx2 damage,<br />
			everyone within 24 yards is vulnerable.<br />
			<br />
			For fragmentation damage, the radius is<br />
			5 x dice of fragmentation damage.
										</span>
									</span>
								</div>
								<div class="cell roll-damage">
									<div class="popup">
										<span data-i18n="abbreviation-divisor-label">Div</span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-armor-devisor-tooltip">
			Divisor. Amount to divide damage by based on<br />
			distance from blast. See B414<br />
			You can enter: <b>3</b> (default), 2, or 1.<br />
			Default: Damage rolled / (3 x distance blast).<br />
			Damage Modifiers Explosion, see B104.<br />
			Exp. +100% = Damage rolled / (2 x distance from blast).<br />
			Exp. +150% = Damage rolled / (1 x distance from blast).<br />
										</span>
									</span>
								</div>
								<div class="cell roll-damage">
									<div class="popup">
										<span data-i18n="abbreviation-target-label">TGT</span>
									</div>
									<span class="tooltip">
										<span data-i18n="demolition-target-tooltip">
			Target's distance from center of blast.<br />
			Damage / (3 x distance from blast). Round down.<br />
			See B414
										</span>
									</span>
								</div>
								<div class="cell roll-damage">
									&nbsp;
								</div>
								<div class="cell reset">
									&nbsp;
								</div>
							</div> <!-- .header -->
							
							<div class="container">
								
								<div class="row">
									<div class="cell row-title">
										<div class="popup">
											<span data-i18n="how-much-label">How Much?</span>
										</div>
										<span class="tooltip">
											<span data-i18n="demolition-how-much-tooltip">
			Determine how much explosive to use based on damage. TNT = 1.0<br />
			See B415.
											</span>
										</span>
									</div>
									<div class="cell select-box">
										<select name="attr_demo_how_much_selected_type">
											<option>TNT</option>
											<option>Serpentine Powder</option>
											<option>Ammonium Nitrate</option>
											<option>TL4 Black Powder</option>
											<option>TL5 Black Powder</option>
											<option>Diesel/Fertilizer</option>
											<option>Dynamite</option>
											<option>Amatol</option>
											<option>Nitroglycerine</option>
											<option>Tetryl</option>
											<option>Composition B</option>
											<option>C4</option>
											<option>Octanitrocubane</option>
											<option>Metallic Hydrogen</option>
										</select>
									</div>
									<div class="cell text-box">
										<input type="text" value="TNT" name="attr_demo_how_much_type" title="Macro: @{NAME|demo_how_much_type}" />
									</div>
									<div class="cell input">
										<input type="number" value="1.0" min="0" step=".01" name="attr_demo_how_much_ref" title="Macro: @{NAME|demo_how_much_ref}" />
									</div>
									<div class="cell input">
										<input type="number" value="1" readonly="readonly" name="attr_demo_how_much_weight" title="Macro: @{NAME|demo_how_much_weight}" />
									</div>
									<div class="cell input">
										<input type="text" value="6d6" name="attr_demo_how_much_base_damage" title="Macro: @{NAME|demo_how_much_base_damage}" />
									</div>
									<div class="cell six-d-spacer">X</div>
									<div class="cell damage">
										<input type="number" value="1" min="1" step="1" name="attr_demo_how_much_damage_multiplier" title="Macro: @{NAME|demo_how_much_damage_multiplier}" />
									</div>
									<div class="cell roll-damage">
										<input type="text" readonly="readonly" value="12" name="attr_demo_how_much_radius" title="Macro: @{NAME|demo_how_much_radius}" />
									</div>
									<div class="cell roll-damage">
										<input type="number" value="3" min="1" step="1" max="3" name="attr_demo_how_much_divisor" title="Macro: @{NAME|demo_how_much_divisor}" />
									</div>
									<div class="cell roll-damage">
										<input type="number" value="0" min="0" step="1" name="attr_demo_how_much_target_distance" title="Macro: @{NAME|demo_how_much_target_distance}" />
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_demo_how_much_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<input type="hidden" name="attr_demo_how_much_damage_divisor" value="1" />
										<button type="roll"  value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type='crush ex' or 'burn ex'}} {{characterName=@{character_name}}} {{skillName=Demolition Damage @{demo_how_much_type}}} {{damageRoll=[[ floor( (@{demo_how_much_base_damage} * @{demo_how_much_damage_multiplier}) / @{demo_how_much_damage_divisor} )]]}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}} {{notes=@{demolition_damage_notes}}}" name="roll_dmgDemo" class="roll_damage" />
									</div>
									<div class="cell reset">
										<button type="action" name="act_demo_how_much_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
									</div>
								</div>
								
								<div class="row">
									<div class="cell row-title">
										<div class="popup">
											<span data-i18n="how-big-label">How Big?</span>
										</div>
										<span class="tooltip">
											<span data-i18n="demolition-how-big-tooltip">
			Determine how big the explosion is based on weight.<br />
			See B415.
											</span>
										</span>
									</div>
									<div class="cell select-box">
										<select name="attr_demo_how_big_selected_type">
											<option>TNT</option>
											<option>Serpentine Powder</option>
											<option>Ammonium Nitrate</option>
											<option>TL4 Black Powder</option>
											<option>TL5 Black Powder</option>
											<option>Diesel/Fertilizer</option>
											<option>Dynamite</option>
											<option>Amatol</option>
											<option>Nitroglycerine</option>
											<option>Tetryl</option>
											<option>Composition B</option>
											<option>C4</option>
											<option>Octanitrocubane</option>
											<option>Metallic Hydrogen</option>
										</select>
									</div>
									<div class="cell text-box">
										<input type="text" value="TNT" name="attr_demo_how_big_type" title="Macro: @{NAME|demo_how_big_type}" />
									</div>
									<div class="cell input">
										<input type="number" value="1.0" min="0" step=".01" name="attr_demo_how_big_ref" title="Macro: @{NAME|demo_how_big_ref}" />
									</div>
									<div class="cell input">
										<input type="number" value="1" min=".01" step=".01" name="attr_demo_how_big_weight" title="Macro: @{NAME|demo_how_big_weight}" />
									</div>
									<div class="cell input">
										<input type="text" value="6d6" name="attr_demo_how_big_base_damage" title="Macro: @{NAME|demo_how_big_base_damage}" />
									</div>
									<div class="cell six-d-spacer">X</div>
									<div class="cell damage">
										<input type="number" value="1" readonly="readonly" name="attr_demo_how_big_damage_multiplier" title="Macro: @{NAME|demo_how_big_damage_multiplier}" />
									</div>
									<div class="cell roll-damage">
										<input type="text" readonly="readonly" value="12" name="attr_demo_how_big_radius" title="Macro: @{NAME|demo_how_big_radius}" />
									</div>
									<div class="cell roll-damage">
										<input type="number" value="3" min="1" step="1" max="3" name="attr_demo_how_big_divisor" title="Macro: @{NAME|demo_how_big_divisor}" />
									</div>
									<div class="cell roll-damage">
										<input type="number" value="0" min="0" step="1" name="attr_demo_how_big_target_distance" title="Macro: @{NAME|demo_how_big_target_distance}" />
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_demo_how_big_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<input type="hidden" name="attr_demo_how_big_damage_divisor" value="1" />
										<button type="roll" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type='crush ex' or 'burn ex'}} {{characterName=@{character_name}}} {{skillName=Demolition Damage @{demo_how_big_type}}} {{damageRoll=[[ floor( (@{demo_how_big_base_damage} * @{demo_how_big_damage_multiplier}) / @{demo_how_big_damage_divisor} )]]}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}} {{notes=@{demolition_damage_notes}}}" name="roll_dmgDemo" class="roll_damage" />
									</div>
									<div class="cell reset">
										<button type="action" name="act_demo_how_big_reset" class="reset"><span data-i18n="reset-label">Reset</span></button>
									</div>
								</div>
								
								<div class="row">
									<div class="cell row-title">
										<div class="popup">
											<span data-i18n="fragmentation-label">Fragmentation</span>
										</div>
										<span class="tooltip">
											<span data-i18n="fragmentation-damage-tooltip">
			Fragmentation damage.<br />
			See B415.
											</span>
										</span>
									</div>
									<div class="cell select-box"></div>
									<div class="cell text-box">
										<div class="popup frag-label">
											<span data-i18n="skill-label">Skill</span>
										</div>
										<span class="tooltip">
											<span data-i18n="fragmentation-skill-tooltip">
			Base skill level for a fragmentation damage to hit a target.<br />
			A hit is <b>automatic</b> if the explosive attack actually strikes the target.<br />
			Only three modifiers apply: the <b>range modifier</b> for the distance from the center<br />
			of the blast to the target, the modifier for the <b>target's posture</b> (prone, etc.),<br />
			and the target's <b>Size Modifier</b>. It is possible for several fragments to hit! For<br />
			every <b>three points</b> by which the attack roll succeeds, one additional fragment
			<br />strikes the target.
											</span>
										</span>
									</div>
									<div class="cell input">
										<input type="number" value="15" step="1" name="attr_fragmentation_skill_final" readonly />
									</div>
									<div class="cell input">
										<input type="hidden" name="attr_fragmentation_modifier_summary" value="" />
										<button type="action" name="act_roll_attack_ranged_fragmentation_damage" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Attack}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[1]]}} {{characterName=@{character_name}}} {{skillName=Fragmentation Damage}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{fragmentation_skill_final} + @{modifier}]]}} {{notes=@{fragmentation_skill_notes}}} {{showNotes=[[1]]}} {{notesTitlePrefix=Fragmentation}} {{recoil=[[ @{fragmentation_recoil}]] }} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{rollModifierSummary=@{fragmentation_modifier_summary}}}" />
									</div>
									<div class="cell input">
										<input type="text" value="1d6" name="attr_fragmentation_damage" title="Macro: @{NAME|fragmentation_damage}" />
									</div>
									<div class="cell six-d-spacer"></div>
									<div class="cell damage">
									</div>
									<div class="cell roll-damage">
										<input type="text" readonly="readonly" value="5" name="attr_fragmentation_radius" title="Macro: @{NAME|fragmentation_radius}" />
									</div>
									<div class="cell roll-damage">
									</div>
									<div class="cell roll-damage">
									</div>
									<div class="cell roll-damage">
										<input type="hidden" name="attr_damage_dice_icon" class="thrust-damage-dice-icon" value="explode" />
										<button type="roll" name="roll_vsSL" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Ranged Damage}} {{characterName=@{character_name}}} {{skillName=Fragmentation Damage}} {{damageRoll=[[{@{fragmentation_damage}, {1}}kh1]]}} {{damageType=Cutting (cut)}} {{showNotes=[[1]]}} {{notesTitlePrefix=Damage}} {{notes=@{fragmentation_damage_notes}}}" name="roll_dmgDemo" class="roll_damage" />
									</div>
									<div class="cell reset">
									</div>
								</div>

								<div style="margin-bottom: 50px;">
									<div class="grid-fragmentation-modifiers grid-standard grid__align_center grid__gap_medium">
										<div class="grid-item">
											<label>
												<span data-i18n="to-hit-modifiers-label">To Hit Modifiers</span>
											</label>
										</div>
										<div class="grid-item container-label-input">
											<label>
												<span data-i18n="base-skill-label">Base Skill</span>:
											</label>
											<input type="number" value="15" step="1" name="attr_fragmentation_skill" title=""Macro: @{NAME|fragmentation_skill}" />
										</div>
										<div class="grid-item container-label-input">
											<label>
												<div class="standard-tooltip">
													<span data-i18n="range-label">Range</span> (<span name="attr_fragmentation_range_modifier">0</span>):
													<span class="tooltiptext">
														<span data-i18n="fragmentation-range-tooltip">Enter the number of yards/hexes from center of explosion to target.</span>
													</span>
												</div>
											</label>
											<input type="hidden" name="attr_fragmentation_range_modifier" value="0" />
											<input type="number" value="0" name="attr_fragmentation_range" title="Macro: @{NAME|fragmentation_range}" />
										</div>
										<div class="grid-item container-label-input">
											<label>
												<div class="standard-tooltip">
													<span data-i18n="posture-label">Posture</span>:
													<span class="tooltiptext">
														<span data-i18n="fragmentation-posture-tooltip">Select the posture of the target.</span>
													</span>
												</div>
											</label>
											<input type="hidden" name="attr_fragmentation_posture_modifier" value="0" />
											<select name="attr_fragmentation_posture" title="Macro: @{NAME|fragmentation_to_hit_modifier}">
												<option value="standing" selected><span data-i18n="option-standing">Standing</span> +0</option>
												<option value="crouching"><span data-i18n="option-crouching">Crouching</span> -2</option>
												<option value="kneeling"><span data-i18n="option-kneeling">Kneeling</span> -2</option>
												<option value="sitting"><span data-i18n="option-sitting">Sitting</span> -2</option>
												<option value="prone"><span data-i18n="option-prone">Prone</span> -2</option>
											</select>
										</div>
										<div class="grid-item container-label-input">
											<label>
												<span data-i18n="size-modifier-label">Size Modifier</span>:
											</label>
											<input type="number" value="0" name="attr_fragmentation_size_modifier" title="Macro: @{NAME|fragmentation_size_modifier}" />
										</div>
									</div>
								</div>
								
							</div> <!-- .container -->
							
						</div> <!-- .table -->
					</div> 
					<!-- end demolition -->
			
				</div>	

			</div>

		</div>

	</div> <!-- .tab4 -->


	<!-- ===== ===== ===== ===== ITEMS TAB ===== ===== ===== ===== -->
	<div class="tab5">

		<!-- _____ _____ QUICK INVENTORY BOX _____ _____ -->

		<div class="box quick-inventory textarea">
			<div class="header"> 
				<div class="cell col0"><span data-i18n="quick-inventory-label">Quick Inventory</span></div>
			</div>
			<div class="quick-inventory-textarea">
				<textarea name="attr_quick_inventory" title="Macro: @{NAME|quick_inventory}"></textarea>
			</div>
		</div>

		<!-- _____ _____ INVENTORY BOX _____ _____ -->

		<div class="box items">
			<div class="table">
				<div class="header">
					<div class="cell col0"><span data-i18n="inventory-label">Inventory</span></div>
					<div class="cell col-location">
						<div class="popup"><span data-i18n="location-label">Location</span></div>
						<div class="tooltip tooltip-spell-ref">
							<span data-i18n="inventory-location-tooltip">
Where is the item located? If you entered a Parent ID in the expanded notes area, this field will be updated with the name of the parent inventory item.<br />
							</span>
						</div>	
					</div>
					<div class="cell col1"><span data-i18n="abbreviation-technology-level-label">TL</span></div>
					<div class="cell col1">
						<div class="popup"><span data-i18n="abbreviation-legality-class-label">LC</span></div>
						<div class="tooltip tooltip-spell-ref">
							<span data-i18n="legality-class-tooltip">
								Legality Class B267.
							</span>
						</div>
					</div>
					<div class="cell col2">
						<div class="popup"><span data-i18n="abbreviation-book-reference-label">Ref</span></div>
						<div class="tooltip tooltip-spell-ref">
							<span data-i18n="book-reference-tooltip">
								Reference to book and page numbers.<br />
								Examples:<br />
								B238 = GURPS Basic, Page 238<br />
								PU2:126 = Power-Ups 2. Page 126
							</span>
						</div>
					</div>
					<div class="cell col3">
						<div class="popup"><span data-i18n="on-label">On</span></div>
						<span class="tooltip">
							<span data-i18n="inventory-carried-tooltip">
								Carried<br />
								Is the item being carried at the moment?
							</span>
						</span>
					</div>
					<div class="cell col4">#</div>
					<div class="cell col5">$</div>
					<div class="cell col6">
						<input type="hidden" name="attr_weight_system" value="lbs" />
						<span name="attr_weight_system"></span>
					</div>
					<div class="cell col7">$+</div>
					<div class="cell col8">W+</div>
				</div>
				<fieldset class="repeating_item">
					<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
					<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_item_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<input type="hidden" class="indent-field" name="attr_indent_level" value="0" />
							<input type="text" class="field-to-indent" name="attr_name" title="Macro: @{NAME|repeating_item_$[row #]_name}" />
							<input type="hidden" name="attr_idkey" />
						</div>
						<div class="cell col-button">
							<button type="roll" name="roll_useitem" class="button-roll-template btn ui-draggable" value="&{template:macro} {{sheetStyle=@{chatstyle}}} {{templateType=dnd5e}} {{title=Use Item}} {{subtitle=@{name}}} {{desc=@{macro_content}}}"></button>
						</div>
						<div class="cell col-location">
							<input type="text" name="attr_location" title="Macro: @{NAME|repeating_item_$[row #]_location}" />
						</div>
						<div class="cell col1">
							<input type="text" name="attr_tl" title="Macro: @{NAME|repeating_item_$[row #]_tl}" />
						</div>
						<div class="cell col1">
							<input type="number" step="1" min="0" max="4" name="attr_legality_class" title="Macro: @{NAME|repeating_item_$[row #]_legality_class}" />
						</div>
						<div class="cell col2">
							<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_item_$[row #]_ref}" />
						</div>
						<div class="cell col3">
							<input class="boolean" type="checkbox" name="attr_carried" value="1" checked title="Macro: @{NAME|repeating_item_$[row #]_carried}" />
						</div>
						<div class="cell col4">
							<input type="number" name="attr_count" value="1" title="Macro: @{NAME|repeating_item_$[row #]_count}" />
						</div>
						<div class="cell col5">
							<input type="number" name="attr_cost" value="0.00" step="0.01" title="Macro: @{NAME|repeating_item_$[row #]_cost}" />
						</div>
						<div class="cell col6">
							<input type="number" name="attr_weight" value="0.000" step="0.001" title="Macro: @{NAME|repeating_item_$[row #]_weight}" />
						</div>
						<div class="cell col7" style="text-align: right;background-color: #c9c9c9;border-bottom: 1px solid white;border-right: 1px solid white;">
							<span name="attr_costtotal" value="0.00" title="Macro: @{NAME|repeating_item_$[row #]_costtotal}" />
						</div>
						<div class="cell col8" style="text-align: right;background-color: #c9c9c9;border-bottom: 1px solid white;border-right: 1px solid white;">
							<input type="hidden" name="attr_carried" />
							<span name="attr_weighttotal" value="0.000" class="item-weight-total" title="Macro: @{NAME|repeating_item_$[row #]_weighttotal}" />
						</div>
					</div> <!-- .row -->
					<div class="row row-details notebox">

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="row-id-label">Row ID:</span>
								</div>
								<span class="tooltip">
									<span data-i18n="inventory-row-id-tooltip">
For inventory, the row id can used to link an inventory item to a parent item.<br />
That means, if you uncheck the <b>ON</b> checkbox, all the child inventory items will also become unchecked.<br />
You can use the row id with macros.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" readonly="readonly" name="attr_row_id" value="" />
							</div>
						</div> <!-- .row -->

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="parent-id-label">Parent ID</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="inventory-parent-id-tooltip">
For inventory, the row id can used to link an inventory item to a parent item.<br />
That means, if you uncheck the <b>ON</b> checkbox, all the child inventory items will also become unchecked.<br />
You can use the row id with macros.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" name="attr_parent_id" value="" />
							</div>
						</div> <!-- .row -->

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="indent-label">Indent</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="inventory-indent-tooltip">
Select the indent level of the inventory item. This is handy to help show the item belongs to a parent item.
									</span>
								</span> 
							</div>
							<div class="cell">
								<select name="attr_indent_level">
									<option>0</option>
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
									<option>6</option>									
								</select>
							</div>
						</div> <!-- .row -->

						<div class="cell col-notebox">
							<div class="show-notes">
								<span class="label">
									<span data-i18n="notes-label">Notes</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_item_$[row #]_notes}"></textarea>
						</div>

						<div class="cell col-notebox" style="display:none;">
							<div class="show-notes">
								<span class="label">
									<span data-i18n="macro-label">Macro</span>
								</span>
							</div>
							<textarea name="attr_macro" title="Macro: @{NAME|repeating_item_$[row #]_macro}">&{template:macro} {{templateType=dnd5e}} {{sheetStyle=4}} {{title=Use Item}} {{desc=@{macro_content}}}</textarea>
						</div>
						
						<div class="cell col-notebox">
							<div class="show-notes">
								<span class="label">
									<span data-i18n="macro-label">Macro Content</span>
								</span>
							</div>
							<textarea name="attr_macro_content" title="Macro: @{NAME|repeating_item_$[row #]_macro_content}"></textarea>
						</div>


					</div> <!-- .row -->
				</fieldset> <!-- .repeating_item -->
				<div class="sort-control">
					<button type="action" name="act_sort_inventory" class="btn sort">Sort & Indent</button>
					<div>
						<i>After sorting, please open/close the notes for one item. This will fix the weirdness caused by the Roll20 sorter.</i>
					</div>
				</div>
				<div class="row row-totals">
					<div class="cell col0">
						<div class="cell" style="width: 50px;">
							<div class="popup" style="font-weight: bold;">
								<span data-i18n="gravity-label">Gravity</span><span>:</span>
							</div>
							<div class="tooltip">
								<span data-i18n="gravity-tooltip">Standard gravity is based on 1G, earth normal.<br />If gravity is over 1G, then add <i>your</i> weight and encumbrance then multiply by Gravity - 1. Add this value to your encumbrance.<br />If gravity is less than 1G, multiply the weight of your gear by the Gravity value, this is your new encumbrance.<br />See B350.</span>
							</div>
						</div>
						<div class="cell" style="width: 35px;">
							<input type="number" value="1" step=".01" min=".01" name="attr_gravity" title="Macro: @{NAME|gravity}" />
						</div>
					</div>
					<div class="cell col1">
						<div style="text-align: right; font-weight: bold;" class="popup">
							<span data-i18n="total-inventory-value-label">Total Inventory Value:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="total-inventory-value-tooltip">
								Total monetary value of all items (carried or not).
							</span>
						</div>
					</div>
					<div class="cell col2">
						<input type="number" style="font-weight: bold;" step=".01" name="attr_total_value" value="0" readonly="readonly" title="Macro: @{NAME|total_value}" />
					</div>
					<div class="cell col3">
						<div style="text-align: right; font-weight: bold;" class="popup">
							<span data-i18n="total-inventory-weight-label">Total Inventory Weight:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="total-inventory-weight-tooltip">
								Total weight of all items carried.
							</span>
						</div>
					</div>
					<div class="cell col4">
						<input type="hidden" name="attr_total_weight" value="" />
						<input type="text" style="font-weight: bold; text-align: center;" name="attr_total_weight_gravity" value="" readonly="readonly" title="Macro: @{NAME|total_weight_gravity}" />
						<span name="attr_weight_system" class="inline"></span>
					</div>
					<div class="cell col5">
						<div style="text-align: right; font-weight: bold;" class="popup">
							<span data-i18n="grand-total-weight-label">Grand Total Weight:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="grand-total-weight-tooltip">
								Grand total of PC's weight: <span style="background-color: white; font-weight: bold; text-decoration: underline;" name="attr_weight" value="0"></span>, and all items carried.
							</span>
						</div>
					</div>
					<div class="cell col6">
						<input type="hidden" name="attr_grand_total_weight" />
						<input type="text" style="font-weight: bold; text-align: center;" name="attr_grand_total_weight_display" value="0" readonly="readonly" title="Macro: @{NAME|grand_total_weight}" />

					</div>					
				</div> <!-- .row -->
			</div> <!-- .table -->
		</div> <!-- .box .items -->

	</div> <!-- .tab5 -->


	<!-- ===== ===== ===== ===== GRIMOIRE TAB ===== ===== ===== ===== -->
	<div class="tab6">

		<div class="box skills" style="margin-bottom:6px;">
			<div class="table table-generic-notes">
				
				<div class="header">
					<div class="cell">
						<div class="item">
							<input type="checkbox" value="1" name="attr_toggle_grimoire_notes" class="arrow-toggle margin-left-sm" title="View notes for grimoire." />
						</div>
					</div>
					<div class="cell">
						<span data-i18n="notes-label">Notes</span>
					</div>
				</div>
				
				<input type="hidden" name="attr_toggle_grimoire_notes" class="hidden-generic-notes-toggle" />
				<div class="row wrapper-generic-textarea-notes tall-row">
					<div class="cell full-width">
						<textarea name="attr_grimoire_notes" class="generic-textrea-notes"></textarea>
					</div>
				</div>

			</div>
		</div>

		<!-- _____ _____ SPELLS SETUP _____ _____ -->
		<div class="box spells spell-stats">
			<div class="table">
				<div class="header spell-stats-header">
					<div class="cell"><span data-i18n="spells-based-on-label">Spells Based on:</span></div>
					<div class="cell margin-right">
						<input type="hidden" class="option-alert" name="attr_spell_base" />
						<select name="attr_spell_base" title="Macro: @{NAME|spell_base}">
							<option value="@{strength}"><span data-i18n="abbreviation-option-strength">ST</span></option>
							<option value="@{dexterity}"><span data-i18n="abbreviation-option-dexterity">DX</span></option>
							<option value="@{intelligence}" selected><span data-i18n="abbreviation-option-intelligence">IQ</span></option>
							<option value="@{health}"><span data-i18n="abbreviation-option-health">HT</span></option>
							<option value="@{willpower}"><span data-i18n="abbreviation-option-will">Will</span></option>
							<option value="@{perception}"><span data-i18n="abbreviation-option-perception">Per</span></option>
							<option value="10">10</option>
						</select>
					</div>
					<div class="cell"><span data-i18n="magery-power-investiture-bonus-label">Magery/PI/Bonus Level:</span></div>
					<div class="cell margin-right">
						<input type="number" name="attr_spell_bonus" value="0" title="Macro: @{NAME|spell_bonus}" />
					</div>
					<div class="cell">
						<div class="popup"><span data-i18n="on-penalty-label">On Penalty</span></div>
						<div class="tooltip">
							<span data-i18n="spell-on-penalty-tooltip">
								Total Spell Skill Penalty based on number of <b>ON</b> spells.<br />
								Penalty will automatically be applied to the spell skill level.<br />
								<input type="hidden" name="attr_spell_on_count" value="0" />
								Number of spells <b>ON:</b> <span name="attr_spell_on_count"></span>.<br />
								<i>NOTE:</i> Use the options tab to adjust the penalty per spell <b>ON</b>.
							</span>
						</div>
					</div>
					<div class="cell margin-right">
						<input type="number" name="attr_spell_on_penalty_total" value="0" title="Macro: @{NAME|spell_on_penalty_total}" readonly="readonly" />
					</div>
					<div class="cell">
						<div class="popup"><span data-i18n="cencentration-penalty-label">Concentration Penalty</span></div>
						<div class="tooltip">
							<span data-i18n="cocentration-penalty-tooltip">
								Total <b>Concentration</b> spell penalty<br>
								<input type="hidden" name="attr_spell_maintained_count" value="0" />
								Number of spells: <span name="attr_spell_maintained_count">0</span>.<br>
								<i>NOTE:</i> Use options tab to adjust the penalty.
							</span>
						</div>
					</div>
					<div class="cell margin-right">
						<input type="number" name="attr_spell_maintained_penalty_total" value="0" title="Macro: @{NAME|spell_maintained_penalty_total}" readonly="readonly" />
					</div>
					<div class="cell">
						<div class="popup"><span data-i18n="abbreviation-modifier-label">Mod</span></div>
						<div class="tooltip">
							<span data-i18n="spell-modifification-tooltip">
								Enter a positive or negative value that affects the Effective Spell level of all spells. For example, you are wearing an enchanted item with Wisdom of 1 level - M135. This increases your IQ by 1. Spell levels are based on IQ, HOWEVER, that particular spell states "Raises the subject's IQ temporarily. This raises his ability with skills, <b>but not with spells!</b>.<br />Use the <i>notes</i> box above to keep track of the reason why there is a modifier." 
							</span>
						</div>
					</div>
					<div class="cell margin-right">
						<input type="number" name="attr_spell_custom_modifier" value="0" title="Macro: @{NAME|spell_custom_modifier}" />
					</div>
				</div>
			</div>
		</div>


		<!-- _____ _____ SPELLS BOX _____ _____ -->

		<div class="box spells">

			<div class="roll-modifiers-table">

				<div class="modifier-caption header">
					<div class="popup">
						<span data-i18n="spell-modifiers-label">Spell Roll Modifiers</span>
					</div>
					<div class="tooltip">
						<span data-i18n="spell-modifiers-tooltip">These modifiers affect all spell rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
					</div>
				</div>

				<div class="modifier-row">

					<div class="modifier-cell modifier-align-top">
						<button type="action" name="act_show_roll_modifiers_for_spell" class="btn modifier-line-height-fix" title="Select Skill Modifiers"><span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span></button>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="summary-group">
							<div class="icon"><span data-i18n="notes-label">Notes</span></div>
							<div class="summary">
								<div class="roll-traits">
									<b>Traits:</b>
									<div>
										<textarea name="attr_spell_roll_trait_summary" class="trait-summary" readonly></textarea>
									</div>
								</div>
								<div class="roll-summary">
									<b>Summary:</b>
									<div>
										<textarea name="attr_spell_roll_modifier_summary" class="roll-summary" readonly></textarea>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="modifier-label">Modifier:</span>
						</div>
						<div class="tooltip">
							<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<input type="number" value="0" step="1" name="attr_spell_custom_roll_modifier" />
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="reason-label">Reason</span>:
						</div>
						<div class="tooltip">
							<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<textarea class="reason-textarea" name="attr_spell_custom_roll_modifier_reason"></textarea>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div>
							<input type="number" min="0" step="1" name="attr_spell_rule_of_16_target_resistance" value="10" />
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div>
							<div class="popup">
								<b><span data-i18n="target-resistance-label">Target Resistance</span></b>
							</div>
							<div class="tooltip max-skill-9">
								<span data-i18n="rule-of-16-target-resistance-tooltip">Enter target's resistance level to use with Rule of 16 B349.<br />To use Rule of 16, the option needs to be turned on and the spell must have a value for the resistance column.</span>
							</div>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="popup label">
							<span data-i18n="final-modifier-label">Final Modifier</span>:
						</div>
						<div class="tooltip">
							<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<div class="number-input">
							<input type="hidden" name="attr_spell_roll_modifier_status" value="neutral" class="modifier-status" />
							<input type="number" value="0" step="1" name="attr_spell_roll_modifier" class="final-modifier" readonly />
							<input type="hidden" value="" name="attr_spell_roll_modifier_summary" />
							<input type="hidden" value="" name="attr_spell_roll_trait_summary" />
							<input type="hidden" value="" name="attr_spell_roll_hit_location" />
							<input type="hidden" value="" name="attr_spell_roll_maneuver" />
							<input type="hidden" value="" name="attr_spell_roll_allout_attack" />
						</div>
					</div>

					<div class="modifier-cell modifier-align-top">
						<button type="action" name="act_spell_roll_reset" class="btn tool-modifier-reset modifier-line-height-fix" title="Reset Skill Modifiers"><span data-i18n="reset-label">Reset</span></button>
					</div>

					<div class="modifier-cell modifier-fill-cell-15">&nbsp;</div>

				</div><!-- end row -->

			</div>

			<div class="table">
				<div class="header">
					<div class="cell col0">
						<div class="popup"><span data-i18n="spell-label">Spell</span></div>
						<div class="tooltip">
							<span data-i18n="spell-roll-modifier-tooltip">You can use the <b>Roll Modifiers Bar</b> or the <b>Roll Modifiers Tool Box</b> to modifier the effective skill.</span>
						</div>
					</div>
					<div class="cell col1"></div>
					<div class="cell col2">
						<div class="popup"><span data-i18n="abbreviation-level-label">LVL</span></div>
						<div class="tooltip">
							<span data-i18n="spell-skill-level-tooltip">
								Skill level with spell
							</span>
						</div>
					</div>
					<div class="cell col3">
						<div class="popup"><span data-i18n="abbreviation-difficulty-label">Diff</span></div>
						<div class="tooltip">
							<span data-i18n="spell-difficulty-tooltip">Difficulty</span>
						</div>
					</div>
					<div class="cell col4">
						<div class="popup"><span data-i18n="abbreviation-modifier-label">Mod</span></div>
						<div class="tooltip">
							<span data-i18n="spell-skill-level-modifier-tooltip">
								Modifier applied to skill level.<br />
								Can be a positive or a negative number.<br />
								Examples include a bonus from a Talent,<br />
								default from another Skill or Technique,<br />
								a piece of equipment, or a Perk.
							</span>
						</div>
					 </div>
					<div class="cell col5">
						<div class="popup"><span data-i18n="abbreviation-character-points-label">Pts</span></div>
						<div class="tooltip">
							<span data-i18n="points-tooltip">Points</span>
						</div>
					</div>
					<div class="cell col12">
						<div class="popup"><span data-i18n="on-label">On</span></div>
						<div class="tooltip">
							<span data-i18n="spell-is-on-tooltip">
								Enter a 1 or more to mark the spell as <b>ON</b><br />
								<b><span name="attr_penalty_per_spell_on"></span></b> skill penalty for each spell that is <b>ON</b>.<br />
								See B238 or M10.<br/>
								Click one at a time, wait until each penalty is applied before clicking the next one.
							</span>
						</div>
					</div>
					<div class="cell col12">
						<div class="popup"><span data-i18n="abbreviation-concentration-label">CT</span></div>
						<div class="tooltip">
							<span data-i18n="spell-concentration-tooltip">
								Enter a 1 or more to mark the spell as <b>Under Concentration</b>.<br />
								<b><span name="attr_penalty_per_spell_maintained"></span></b> skill penalty for each spell.<br />
								See B238 or M10.<br/>
								Click one at a time, wait until each penalty is applied before clicking the next one.
							</span>
						</div>
					</div>
					<div class="cell col7">
						<div class="popup"><span data-i18n="abbreviation-resisted-by-label">RESIST</span></div>
						<div class="tooltip">
							<span data-i18n="spell-resisted-by-tooltip">
								Resisted By
							</span>
						</div>
					</div>
					<div class="cell col8">
						<div class="popup"><span data-i18n="duration-label">Duration</span></div>
						<div class="tooltip">
							<span data-i18n="spell-duration-tooltip">
								Duration of Spell
							</span>
						</div>
					</div>
					<div class="cell col9">
						<div class="popup"><span data-i18n="cost-label">Cost</span></div>
						<div class="tooltip">
							<span data-i18n="spell-energy-cost-tooltip">
								Energy cost for casting the spell.
							</span>
						</div>
					</div>
					<div class="cell col10">
						<div class="popup"><span data-i18n="time-label">Time</span></div>
						<div class="tooltip tooltip-spell-time">
							<span data-i18n="spell-casting-time-tooltip">
								Amount of time to cast the spell.
							</span>
						</div>
					</div>
					<div class="cell col11">
						<div class="popup"><span data-i18n="maintain-label">Maintain</span></div>
						<div class="tooltip">
							<span data-i18n="spell-cost-to-maintain-tooltip">
								Energy cost to maintain the spell.
							</span>
						</div>
					</div>
				</div> <!-- .header -->

				<fieldset class="repeating_spells">
					<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
					<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_spell_toggle_notes" />
					<span class="checkbox"></span>
					<div class="row row-stats">
						<div class="cell col0">
							<input type="hidden" class="indent-field" name="attr_indent_level" value="0" />
							<input type="text" class="field-to-indent" name="attr_name" title="Macro: @{NAME|repeating_spells_$[row #]_name}" />
							<input type="hidden" name="attr_idkey" />
						</div>
						<div class="cell col1">
							<input type="hidden" name="attr_rule_of_16_value" value="100" />
							<button type="action" name="act_skillroll" class="button-roll-template btn ui-draggable" value="@{roll}&{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Spell Skill Roll}} {{spellRoll=true}}  {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=@{character_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{useModTool=[[1]]}} {{rollModifier=[[@{spell_roll_modifier}]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}}  {{rollModifierSummary=@{spell_roll_modifier_summary}}} {{popupModifier=@{popup_modifier}}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{spellCriticalSuccessNote=@{spell_critical_success_notes}}} {{spellFailNote=@{spell_fail_notes}}} {{spellCriticalFailureNote=@{spell_critical_failure_notes}}} {{showCastingDetails=[[@{show_casting_details}]]}}" />
						</div>
						<div class="cell col2">
							<input type="text" name="attr_level" title="Macro: @{NAME|repeating_spells_$[row #]_level}" readonly="readonly" value="10"/>
							<!-- TODO: replace this hidden field with a drop-down instead of using one drop-down for all spells!  -->
							<input type="hidden" name="attr_base" value="new" />
							<input type="hidden" name="attr_sync" value="0" />
						</div>
						<div class="cell col3">
							<select name="attr_difficulty" title="Macro: @{NAME|repeating_spells_$[row #]_difficulty}">
								<option value="-2"><span data-i18n="abbreviation-option-average">A</span></option>
								<option value="-3" selected="selected"><span data-i18n="abbreviation-option-hard">H</span></option>
								<option value="-4"><span data-i18n="abbreviation-option-very-hard">VH</span></option>
								<option value="0"><span data-i18n="abbreviation-option-very-hard">T/H</span></option>
							</select>
						</div>
						<div class="cell col4">
							<!-- TODO: its possible that a character could have different types, maybe add drop-down for spell bonus -->
							<input type="hidden" name="attr_bonus" value="0" title="Synced with attr_spell_bonus, reduces code" />
							<input type="hidden" name="attr_custom_modifier" value="0" title="Synced with attr_spell_custom_modifier, reduces code" />
							<input type="hidden" name="attr_on_penalty" value="0" title="Synced with attr_on_penalty, reduces code" />
							<input type="hidden" name="attr_maintained_penalty" value="0" title="Synced with attr_maintained_penalty, reduces code" />
							<input type="number" name="attr_spell_modifier" value="0" title="Macro: @{NAME|repeating_spells_$[row #]_spell_modifier}" />
						</div>
						<div class="cell col5">
							<input type="number" name="attr_points" value="1" title="Macro: @{NAME|repeating_spells_$[row #]_points}" />
						</div>
						<div class="cell col12">
							<input type="number" value="" min="0" max="20" step="1" title="Adjust to mark spell as on." name="attr_spell_on_checked" />
						</div>
						<div class="cell col12">
							<input type="number" value="" min="0" max="20" step="1" title="Adjust to mark spell as on." name="attr_spell_maintained_checked" />
						</div>
						<div class="cell col7">
							<input type="text" name="attr_spell_resisted_by" placeholder="Resist" title="Macro: @{NAME|repeating_spells_$[row #]_spell_resisted_by}" />
						</div>
						<div class="cell col8">
							<input type="text" name="attr_duration" placeholder="Duration" title="Macro: @{NAME|repeating_spells_$[row #]_duration}" />
						</div>
						<div class="cell col9">
							<input type="text" name="attr_cost" placeholder="Cost to Cast" title="Macro: @{NAME|repeating_spells_$[row #]_cost}" />
						</div>
						<div class="cell col10">
							<input type="text" name="attr_casttime" placeholder="Casting Time" title="Macro: @{NAME|repeating_spells_$[row #]_casttime}" />
						</div>
						<div class="cell col11">
							<input type="text" name="attr_maintain" placeholder="Cost to Maintain" title="Macro: @{NAME|repeating_spells_$[row #]_maintain}" />
						</div>
					</div> <!-- .row -->
					
					<div class="row row-details notebox">
						
						<div class="row-misc row-college">
							<div class="cell label">
								<div class="popup"><span data-i18n="row-id-label">Row ID:</span></div>
								<span class="tooltip">
									<span data-i18n="row-id-tooltip">
										The row id can be used with macros.<br />
										NOTE: Future use for linking to techniques<br />
										and combat skills.<br />
										Example field name: repeating_skills_[the row id]_level<br />
										This example would represent the skill level on that row.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" readonly="readonly" name="attr_row_id" value="" />
							</div>
							<div class="cell align-right col3">
								<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_spells_$[row #]_ref}" />	
							</div>
							<div class="cell align-right ref-label">
								<div class="popup"><span data-i18n="abbreviation-book-reference-label">Ref</span></div>
								<div class="tooltip tooltip-spell-ref">
									<span data-i18n="book-reference-tooltip">
										Reference to book and page numbers.<br />
										Examples:<br />
										B238 = GURPS Basic, Page 238<br />
										PU2:126 = Power-Ups 2. Page 126
									</span>
								</div>
							</div>
						</div> <!-- .row -->

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="parent-id-label">Parent ID</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="spell-parent-id-tooltip">
For spells, the row id can used to link a spell to a parent spell.<br /><b>Tip:</b> You could name the parent a college name or some other group name.
									</span>
								</span> 
							</div>
							<div class="cell">
								<input type="text" name="attr_parent_id" value="" />
							</div>
						</div> <!-- .row -->

						<div class="row-misc">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="indent-label">Indent</span>:
								</div>
								<span class="tooltip">
									<span data-i18n="spell-indent-tooltip">
Select the indent level of the spell. This is handy to help show the spell belongs to a parent spell.
									</span>
								</span> 
							</div>
							<div class="cell">
								<select name="attr_indent_level">
									<option>0</option>
									<option>1</option>
									<option>2</option>
									<option>3</option>
									<option>4</option>
									<option>5</option>
									<option>6</option>									
								</select>
							</div>
						</div> <!-- .row -->

						<div class="row-misc row-college">
							<div class="cell label">
								<span data-i18n="reason-for-modifier-label">Reason for MOD (Modifier):</span>
							</div>
							<div class="cell spell-mod-notes">
								<input type="text" name="attr_spell_mod_notes" title="Macro: @{NAME|repeating_spells_$[row #]_spell_mod_notes}" />
							</div>
						</div> <!-- .row -->
						
						<div class="row-misc row-college">
							<div class="cell label">
								<div class="popup">
									<span data-i18n="class-label">Class</span>
								</div>
								<div class="tooltip">
									<span data-i18n="spell-class-tooltip">
										Spell class; Area, Blocking, Information, Melee,<br />
										Missile, Regular, Regular (Jet), Resisted, Special
									</span>
								</div>
							</div>
							<div class="cell">
								<input type="text" name="attr_spell_class" title="Macro: @{NAME|repeating_spells_$[row #]_spell_class}" />
							</div>
							<div class="cell label">
								<span data-i18n="colleges-label">Primary College:</span>
							</div>
							<div class="cell text-college-width">
								<input type="text" name="attr_spell_college" title="Macro: @{NAME|repeating_spells_$[row #]_spell_college}" />
							</div>
							<div class="cell label">
								<span data-i18n="colleges-secondary-label">Secondary College:</span>
							</div>
							<div class="cell text-college-width">
								<input type="text" name="attr_spell_college_secondary" title="Macro: @{NAME|repeating_spells_$[row #]_spell_college_secondary}" />
							</div>
							
						</div> <!-- .row -->

						<div class="header">
							<div class="popup"><span data-i18n="notes-label">Notes</span></div>
							<span class="tooltip">
								<span data-i18n="custom-success-fail-notes-tooltip">
									Success, critical success, fail, and critical fail<br />
									notes will be added to roll results.<br />
									You can add macros to these notes.<br />
									The width of these note boxes are set to help you<br />
									visualize what it will look like in chat.
								</span>
							</span>
						</div>
						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_notes" value="1" />
								<span class="label">
									<span data-i18n="show-notes-below-label">Show notes below in roll template</span>
								</span>
							</div>
							<textarea name="attr_notes" title="Macro: @{NAME|repeating_spells_$[row #]_notes}"></textarea>
						</div>
						
						<div class="col-notebox">
							<div class="show-notes">
								<input type="checkbox" name="attr_show_spell_notes" value="1" />
								<span class="label">
									<span data-i18n="show-spell-modifier-notes-label">Show Spell Modifier notes (see actual spell description)</span>
								</span>
							</div>
							<textarea name="attr_spell_notes" title="Macro: @{NAME|repeating_spells_$[row #]_spell_notes}"></textarea>
						</div>
						
						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title">
									<span data-i18n="success-note-label">Success Note:</span>
								</div>
								<textarea name="attr_spell_success_note" title="Macro: @{NAME|repeating_spells_$[row #]_spell_success_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title"><span data-i18n="critical-success-note-label">Critical Success Note:</span></div>
								<textarea name="attr_spell_critical_success_note" title="Macro: @{NAME|repeating_spells_$[row #]_spell_critical_success_note}"></textarea>
							</div>
							
						</div>
						
						<div class="rolltable-result-notes">
							
							<div class="note-input">
								<div class="note-title"><div data-i18n="fail-note-label">Fail Note:</div></div>
								<textarea name="attr_spell_fail_note" title="Macro: @{NAME|repeating_spells_$[row #]_spell_fail_note}"></textarea>
							</div>
							
							<div class="note-input">
								<div class="note-title"><span data-i18n="critical-fail-note-label">Critical Fail Note:</span></div>
								<textarea name="attr_spell_critical_fail_note" title="Macro: @{NAME|repeating_spells_$[row #]_spell_critical_fail_note}"></textarea>
							</div>
							
						</div>

						<div class="header">
							<div class="popup">
								<span data-i18n="custom-macros-label">Custom Macros</span>
							</div>
							<span class="tooltip">
								<span data-i18n="custom-macros-tooltip">Select the custom macros that you would like to use with this skill.</span>
							</span>
						</div>

						<div class="grid-standard grid-custom-skills-macros">
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="checkbox" name="attr_macro_one_checked" class="margin_right_small" value="1" />
										<input type="hidden" name="attr_macro_one_name" value="Skill" />
										<input type="hidden" name="attr_macro_one" value="" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_one_name"></span>
									</span>
								</div>
							</div>	
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_two_name" value="Defense" />
										<input type="hidden" name="attr_macro_two" value="" />
										<input type="checkbox" name="attr_macro_two_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_two_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_three_name" value="Melee" />
										<input type="hidden" name="attr_macro_three" value="" />
										<input type="checkbox" name="attr_macro_three_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_three_name"></span>
									</span>
								</div>
							</div>	

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_four_name" value="Ranged" />
										<input type="hidden" name="attr_macro_four" value="" />
										<input type="checkbox" name="attr_macro_four_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_four_name"></span>
									</span>
								</div>
							</div>
							
							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_five_name" value="Spell" />
										<input type="hidden" name="attr_macro_five" value="" />
										<input type="checkbox" name="attr_macro_five_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_five_name"></span>
									</span>
								</div>
							</div>

							<div class="grid-cell">
								<div class="container-label-input">
									<span>
										<input type="hidden" name="attr_macro_six_name" value="Macro Six" />
										<input type="hidden" name="attr_macro_six" value="" />
										<input type="checkbox" name="attr_macro_six_checked" class="margin_right_small" value="1" />
									</span>
									<span>
										<b><span data-i18n="macro-label">Macro</span>:</b>
										<span name="attr_macro_six_name"></span>
									</span>
								</div>
							</div>
							
						</div>
						
					</div> <!-- .row -->
				</fieldset> <!-- .repeating_spells -->
				<div class="sort-control">
					<button type="action" name="act_sort_spells" class="btn sort">Sort & Indent</button>
					<div>
						<i>After sorting, please open/close the notes for one spell. This will fix the weirdness caused by the Roll20 sorter.</i>
					</div>
				</div>
			</div> <!-- .table -->
		</div> <!-- .box .spells -->
	</div> <!-- .tab6 -->

	<!-- ===== ===== ===== ===== CHASE CONTROL SHEET TAB ===== ===== ===== ===== -->
	<div class="tab-chase">

		<div class="chase-grid">
		
			<div class="chase-row div-spacer plain-text">
				<div>
					<span data-i18n="chase-control-sheet-description">Use this sheet to help run chase scenes from GURPS Action 2 Exploits, please refer to pages 31-34. The next iteration will include tooltips and revisions based on input.</span>
				</div>
				<div>
					<span data-i18n="chase-wipeouts-description"><b>Wipeouts:</b> If relevant roll fails by <b>Stability Rating</b> or less, but if on foot, on a regular failure, the result is a <b>Close Call</b>. If roll is over <b>Stability Rating</b>, then result is a <b>Wreck</b>. See GURPS Action 2 page 35.</span>
				</div>
				<div>
					<span data-i18n="chase-collateral-damage-description"><b>Collateral Damage:</b> On crowded streets, any wipeout causes an accident. If the quarry causes an accident, pursuer has -(1d6-1) to their next chase roll. See GURPS Action 2 page 35.</span>
				</div>
				<div>
					<span data-i18n="chase-lucky-break-description"><b>Lucky Break:</b> The use of luck advantages or character points to manipulate the chase to help you perform a maneuver that normally can't. See GURPS Action 2 page 41.</span>
				</div>
			</div>
			
			<div class="chase-row">
				<div class="grid-standard grid-chase-setup">
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<span data-i18n="round-label">Round</span>:
							</label>	
							<input type="number" name="attr_chase_round" min="1" step="1" value="1" />
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="current-sequence-label">Current Sequence</span>:
									<span class="tooltiptext">
										<span data-i18n="current-sequence-tooltip">Use the drop-down to keep track of the current sequence, some options will update the Chase Control Sheet.<br />If it's the quarry's turn, the title will be turned red, same with the pursuer's turn. Selecting <b>Proceed to next round</b> will start the sequence over, increment the round counter, clear some of the fields to prep for the next round.</span>
									</span>
								</div>
							</label>
							<select name="attr_chase_sequence">
								<option value="none" selected>--<span data-i18n="select-label">Select</span>--</option>
								<option value="quarry_chooses"><span data-i18n="chase-sequence-option-quarry-chooses">Quarry chooses maneuver</span></option>
								<option value="pursuer_chooses"><span data-i18n="chase-sequence-option-pursuer-chooses">Pursuer chooses maneuver</span></option>
								<option value="pursuer_rolls"><span data-i18n="chase-sequence-option-pursuer-rolls">Pursuer resolves all rolls</span></option>
								<option value="quarry_rolls"><span data-i18n="chase-sequence-option-quarry-rolls">Quarry resolves all rolls</span></option>
								<option value="quick_contest"><span data-i18n="chase-sequence-option-quick-contest">Quick Contest of Chase Rolls</span></option>
								<option value="adjust_band"><span data-i18n="chase-sequence-option-range-band">Adjust range band</span></option>
								<option value="next_round"><span data-i18n="chase-sequence-option-next-round">Proceed to next round</span></option>
							</select>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<button type="action" name="act_chase_get_result" class="standard-button margin_right_small">
								<span data-i18n="get-results-label">Get Quick Contest Results</span>
							</button>
							<label>
								<div class="standard-tooltip">
									<span data-i18n="help-label">Help</span>
									<span class="tooltiptext">
										<span data-i18n="chase-get-results-help-tooltip">Press this button to Get the Results of the chase.<br /><br />Make sure have selected a maneuver, entered Chase Modifiers, and entered the <b>Roll made by</b> fields.</span>
									</span>
								</div>
							</label>							
						</div>
					</div>
					<div class="grid-cell">
						<button type="action" name="act_chase_reset" class="standard-button margin_right_small">
							<span data-i18n="reset-label">Reset</span>
						</button>
					</div>
				</div>
			</div>

			<div class="chase-row">
				<input type="hidden" name="attr_chase_content_result" />
				<div>
					<span name="attr_chase_content_result"></span>
				</div>
			</div>

			<div class="chase-row">
				<div class="grid-standard grid-2-column-auto grid__gap_large">
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<span data-i18n="range-band-label">Range Band</span>:<br />
								<select name="attr_chase_range_band">
									<option value="none">--<span data-i18n="select-label">Select</span>--</option>
									<option value="close"><span data-i18n="chase-range-band-option-close">Close (0 to 5 hexes)</span></option>
									<option value="short"><span data-i18n="chase-range-band-option-short">Short (6 to 20 hexes)</span></option>
									<option value="medium" selected><span data-i18n="chase-range-band-option-medium">Medium (21 to 100 hexes)</span></option>
									<option value="long"><span data-i18n="chase-range-band-option-long">Long (101 to 500 hexes)</span></option>
									<option value="extreme"><span data-i18n="chase-range-band-option-extreme">Extreme (501+ hexes)</span></option>
									<option value="escape"><span data-i18n="chase-range-band-option-escape">Escape!</span></option>
								</select>
							</label>
						</div>
					</div>
					<div class="grid-cell grid-cell__callout_left">
						<label>Description</label>
						<input type="hidden" name="attr_chase_range_band_description_range" value="" />
						<input type="hidden" name="attr_chase_range_band_description" value="" />
						<div>
							<i>Range Penalty:</i> <span name="attr_chase_range_band_description_range"></span><br />
							<i>Description:</i> <span name="attr_chase_range_band_description"></span>
						</div>
					</div>
				</div>
			</div>


			<!-- Quarry Section -->
			<div class="chase-row section-header">
				<div class="padding__left_small">
					<input type="hidden" name="attr_chase_sequence" value="none" />
					<h3 class="quarry"><span data-i18n="quarry-label">Quarry</span></h3>
				</div>
			</div>

			<div class="chase-row">
				<div class="grid-standard grid-chase-maneuver">
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								
								<div class="standard-tooltip">
									<span data-i18n="maneuver-label">Maneuver</span>:
									<span class="tooltiptext">
										<span data-i18n="chase-maneuver-tooltip">Select a maneuver and use the notes box to explain the chase roll modifier you're using.<br /><br />For example, you selected <b>Stunt</b>, in the notes you could enter, "+3 chase roll for -6 to stunt skill."</span>
									</span>
								</div>
								
								<select name="attr_chase_quarry_maneuver">
									<option value="none">--<span data-i18n="select-label">Select</span>--</option>
									<option value="attack"><span data-i18n="attack-label">Attack</span></option>
									<option value="disembark-embark"><span data-i18n="disembark-embark-label">Disembark/Embark</span></option>
									<option value="take-control"><span data-i18n="take-control-label">Take Control</span></option>
									<option value="emergency-action"><span data-i18n="emergency-action-label">Emergency Action</span></option>
									<option value="force"><span data-i18n="force-label">Force</span></option>
									<option value="hide"><span data-i18n="hide-label">Hide</span></option>
									<option value="mobility-escape"><span data-i18n="mobility-escape-label">Mobility Escape</span></option>
									<option value="move"><span data-i18n="move-label">Move</span></option>
									<option value="move-attack"><span data-i18n="move-and-attack-label">Move and Attack</span></option>
									<option value="reverse"><span data-i18n="reverse-label">Reverse</span></option>
									<option value="stop"><span data-i18n="stop-label">Stop</span></option>
									<option value="stunt"><span data-i18n="stunt-label">Stunt</span></option>
									<option value="stunt-escape"><span data-i18n="stunt-escape-label">Stunt Escape</span></option>
								</select>
								<input type="hidden" name="attr_quarry_maneuver_description" value="Select a maneuver." />
								<input type="hidden" name="attr_quarry_maneuver_conditions" />
								<input type="hidden" name="attr_quarry_maneuver_actions" />
								<input type="hidden" name="attr_quarry_maneuver_chase_rolls" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<input type="text" name="attr_chase_quarry_notes" placeholder="Notes..." title="Macro: @{NAME|chase_quarry_notes}" />
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="chase-modifier-label">Chase Modifier</span>:
									<span class="tooltiptext">
										<span data-i18n="chase-modifier-tooltip">After selecting a maneuver, enter the chase modifier based on the suggestion under the <b>Chase Rolls</b> column.</span>
									</span>
								</div>
								<input type="number" name="attr_chase_quarry_modifier" step="1" value="0" title="Macro: @{NAME|chase_quarry_modifier}" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="final-modifier-label">Final Modifier</span>:
									<span class="tooltiptext small-width">
										<span data-i18n="chase-modifier-label">Chase Modifier</span>: <span name="attr_chase_quarry_modifier"></span><br />
										<span data-i18n="handling-modifier-label">Handling Modifier</span>: <span name="attr_quarry_handling"></span><br />
										<span data-i18n="speed-modifier-label">Speed Modifier</span>: <span name="attr_quarry_speed_chase_mod"></span><br />
										<span data-i18n="chase-modifier-table-label">Chase Modifier Table</span>: <span name="attr_chase_quarry_chase_mod_table_total"></span>
									</span>
								</div>
								<input type="number" name="attr_chase_quarry_final_modifier" readonly="readonly" value="0" class="input-disabled" title="Macro: @{NAME|chase_quarry_final_modifier}" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="roll-made-by-label">Roll made by</span>:
									<span class="tooltiptext move-left">
										<span data-i18n="roll-made-by-tooltip">Enter how much you missed or made your roll by, negative value means you rolled too high, positive value is a successful roll. You can have the player roll against their appropriate skill or use the skill roll button below.</span>
									</span>
								</div>
								<input type="number" name="attr_chase_quarry_made_by" step="1" value="0" title="Macro: @{NAME|chase_quarry_made_by}" />
							</label>
						</div>
					</div>
				</div>
			</div>

			<div class="chase-row">
				<div class="grid-4-column-equal grid__border grid__padding">
					<div class="grid-cell">
						<h4>Description</h4>
						<div class="content"><span name="attr_quarry_maneuver_description"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Conditions</h4>
						<div class="content"><span name="attr_quarry_maneuver_conditions"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Actions</h4>
						<div class="content"><span name="attr_quarry_maneuver_actions"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Chase Rolls</h4>
						<div class="content"><span name="attr_quarry_maneuver_chase_rolls"></span></div>
					</div>					
				</div>

			</div>

			<div class="chase-row">
				<div class="grid-chase-leader-table">

					<!-- row 1 -->
					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="leader-label">Leader</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-leader-tooltip">If it's just one person, enter that character's name. If there's a group of people, select a <b>leader</b> that will make the chase skill roll.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="mode-label">Mode</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-mode-tooltip">A brief description of the mode of travel; land, water, air. You could enter land/water for a hovercraft.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="abbreviation-stability-rating-label">SR</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-stability-rating-tooltip">Stability Rating of vehicle, if applicable. Used when checking for Wipeouts.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="abbreviation-handling-label">Hnd</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-handling-tooltip">Handling of vehicle, if applicable. This value is applied to the Chase's <b>Final Modifier</b>.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="speed-label">Speed</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-speed-tooltip">Speed in yards per second, which is used to get a Chase Speed Modifier and applied to the Chase's <b>Final Modifier</b>.</span><br />
								<span data-i18n="speed-modifier-label">Speed Modifier</span>: <span name="attr_quarry_speed_chase_mod"></span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="static-label">Static</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-static-tooltip">Check if you selected a static maneuver or you forced into a static state.<br />If static...<ul><li>No speed bonus</li><li>If opponent is non-static they get an extra range shift, no matter who wins the contest.</li><li>If both if you are static, the range band doesn't change. </li><li>To remove the <b>static</b> you must change your mobility (if possible) or perform a stunt.</li></ul></span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="notes-label">Notes</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-notes-tooltip">You could use the notes field to show what skill you're using for Chase Quick Contest and additional remember notes.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="chase-skill-label">Chase Skill</span></h4>
							<span class="tooltiptext move-far-left">
								<span data-i18n="chase-skill-tooltip">Enter the level of the skill chosen for the chase. You can either have the player roll their own skill applying the <b>Final Modifier</b> or use the provided skill button.</span>
							</span>
						</div>
					</div>

					<!-- row 2 -->
					<div class="grid-cell">
						<input type="text" name="attr_quarry_leader_name" value="" title="Macro: @{NAME|quarry_leader_name}" />
					</div>

					<div class="grid-cell">
						<input type="text" name="attr_quarry_mobility" value="" title="Macro: @{NAME|quarry_mobility}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_quarry_stability_rating" value="0" title="Macro: @{NAME|quarry_stability_rating}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_quarry_handling" value="0" title="Macro: @{NAME|quarry_handling}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_quarry_speed" value="0" title="Macro: @{NAME|quarry_handling}" />
						<input type="hidden" name="attr_quarry_speed_chase_mod" value="0" title="Macro: @{NAME|quarry_speed_chase_mod}" />
					</div>

					<div class="grid-cell">
						<input type="checkbox" name="attr_quarry_is_static" value="1" title="Macro: @{NAME|quarry_is_static}" />
					</div>

					<div class="grid-cell">
						<textarea name="attr_quarry_condition_notes" title="Macro: @{NAME|quarry_condition_notes}"></textarea>
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_quarry_chase_skill" class="half-width" value="10" title="Macro: @{NAME|quarry_chase_skill}" />
						<input type="hidden" name="attr_chase_quarry_modifier_description" value="" />
						<button type="roll" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Quarry}} {{skillName=Chase Skill Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{quarry_chase_skill} + @{chase_quarry_final_modifier}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{chase_quarry_final_modifier}}} {{rollModifierSummary=@{chase_quarry_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{maneuver=@{chase_quarry_maneuver}}}" class="btn ui-draggable"></button>
					</div>

				</div>
			</div>

			<div class="chase-row">

				<div class="grid-standard grid-2-column-big-small grid__gap_large grid__border_cell grid__padding">

					<div class="grid-cell">
						
						<div class="standard-tooltip">
							<h4 class="header-bg"><span data-i18n="support-actions-label">Support Actions</span></h4>
							<span class="tooltiptext">
								<span data-i18n="support-actions-tooltip">Support actions can be used to list passengers, characters in other vehicles, and then detailing actions and how it can impact the chase rolls.</span>
							</span>
						</div>

						<div class="grid-chase-support-actions-header">
							<div class="grid-cell"><span data-i18n="name-label-no-colon">Name</span></div>
							<div class="grid-cell">
								<div class="standard-tooltip">
									<span data-i18n="action-label">Action</span>
									<span class="tooltiptext">
										<span data-i18n="chase-support-actions-tooltip">Typical passenger actions are Attack, Board, Seize Control, and noncombat tasks like disarming a bomb.<br />Boarding: Round starts at Close Range, roll contest of Acrobatics or Jumping vs opponents operatoring skill. See book for info.<br />Seize Control: Take control of an unmanned vehicle or seize control from a driver. See book for info.<br />GURPS Action 2 page 33.</span>
									</span>
								</div>
							</div>
							<div class="grid-cell">
								<div class="standard-tooltip">
									<span data-i18n="notes-label">Notes</span>
									<span class="tooltiptext">
										<span data-i18n="chase-support-actions-notes-tooltip">Useful for entering information of a how Chase Maneuver may affect an action.<br />For example, you could enter "-2 or weapon's Bulk with ranged attacks."</span>
									</span>
								</div>
							</div>
						</div>

						<fieldset class="repeating_chase-quarry-support-actions">
							<div class="grid-chase-support-actions grid__padding_bottom_small">
								<div class="grid-cell">
									<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_chase-quarry-support-actions_$[row #]_name}" />
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_action" value="" title="Macro: @{NAME|repeating_chase-quarry-support-actions_$[row #]_action}" />
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_notes" value="" title="Macro: @{NAME|repeating_chase-quarry-support-actions_$[row #]_notes}" />
								</div>
							</div>
						</fieldset>

					</div>

					<div class="grid-cell">
						
						<div class="standard-tooltip">
							<h4><span data-i18n="chase-modifiers-label">Chase Modifiers</span></h4>
							<span class="tooltiptext move-left">
								<span data-i18n="chase-modifiers-table-tooltip">Use this table to track various modifiers to the Final Chase Modifier.<br />Examples include Higher Purpose for a +1 to chase rolls or results of a complementary skills.</span>
							</span>
						</div>

						<div class="grid-chase-modifiers-header">
							<div class="grid-cell">Name</div>
							<div class="grid-cell">Mod</div>
						</div>

						<input type="hidden" name="attr_chase_quarry_chase_mod_table_total" value="0" />
						<fieldset class="repeating_chase-quarry-modifiers">
							<div class="grid-chase-modifiers grid__padding_bottom_small">
								<div class="grid-cell">
									<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_chase-quarry-modifiers_$[row #]_name}" />
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_mod" value="0" step="1" title="Macro: @{NAME|repeating_chase-quarry-modifiers_$[row #]_mod}" />
								</div>
							</div>
						</fieldset>

					</div>

				</div>

			</div>

			<!-- Pursuer Section -->
			<div class="chase-row section-header">
				<div class="padding__left_small">
					<input type="hidden" name="attr_chase_sequence" value="none" />
					<h3 class="pursuer"><span data-i18n="pursuer-label">Pursuer</span></h3>
				</div>
			</div>

			<div class="chase-row">
				<div class="grid-standard grid-chase-maneuver">
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								
								<div class="standard-tooltip">
									<span data-i18n="maneuver-label">Maneuver</span>:
									<span class="tooltiptext">
										<span data-i18n="chase-maneuver-tooltip">Select a maneuver and use the notes box to explain the chase roll modifier you're using.<br /><br />For example, you selected <b>Stunt</b>, in the notes you could enter, "+3 chase roll for -6 to stunt skill."</span>
									</span>
								</div>
								
								<select name="attr_chase_pursuer_maneuver">
									<option value="none">--<span data-i18n="select-label">Select</span>--</option>
									<option value="attack"><span data-i18n="attack-label">Attack</span></option>
									<option value="disembark-embark"><span data-i18n="disembark-embark-label">Disembark/Embark</span></option>
									<option value="take-control"><span data-i18n="take-control-label">Take Control</span></option>
									<option value="emergency-action"><span data-i18n="emergency-action-label">Emergency Action</span></option>
									<option value="force"><span data-i18n="force-label">Force</span></option>
									<option value="mobility-pursuit"><span data-i18n="mobiliy-pursuit-label">Mobility Pursuit</span></option>
									<option value="move"><span data-i18n="move-label">Move</span></option>
									<option value="move-attack"><span data-i18n="move-and-attack-label">Move and Attack</span></option>
									<option value="ram"><span data-i18n="ram-label">Ram</span></option>
									<option value="stop"><span data-i18n="stop-label">Stop</span></option>
									<option value="stunt"><span data-i18n="stunt-label">Stunt</span></option>
								</select>								
								<input type="hidden" name="attr_pursuer_maneuver_description" value="Select a maneuver." />
								<input type="hidden" name="attr_pursuer_maneuver_conditions" />
								<input type="hidden" name="attr_pursuer_maneuver_actions" />
								<input type="hidden" name="attr_pursuer_maneuver_chase_rolls" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<input type="text" name="attr_chase_pursuer_notes" placeholder="Notes..." title="Macro: @{NAME|chase_pursuer_notes}" />
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="chase-modifier-label">Chase Modifier</span>:
									<span class="tooltiptext">
										<span data-i18n="chase-modifier-tooltip">After selecting a maneuver, enter the chase modifier based on the suggestion under the <b>Chase Rolls</b> column.</span>
									</span>
								</div>
								<input type="number" name="attr_chase_pursuer_modifier" step="1" value="0" title="Macro: @{NAME|chase_pursuer_modifier}" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="final-modifier-label">Final Modifier</span>:
									<span class="tooltiptext small-width">
										<span data-i18n="chase-modifier-label">Chase Modifier</span>: <span name="attr_chase_pursuer_modifier"></span><br />
										<span data-i18n="handling-modifier-label">Handling Modifier</span>: <span name="attr_pursuer_handling"></span><br />
										<span data-i18n="speed-modifier-label">Speed Modifier</span>: <span name="attr_pursuer_speed_chase_mod"></span><br />
										<span data-i18n="chase-modifier-table-label">Chase Modifier Table</span>: <span name="attr_chase_pursuer_chase_mod_table_total"></span>
									</span>
								</div>
								<input type="number" name="attr_chase_pursuer_final_modifier" readonly="readonly" value="0" class="input-disabled" title="Macro: @{NAME|chase_pursuer_final_modifier}" />
							</label>
						</div>
					</div>
					<div class="grid-cell">
						<div class="container-label-input">
							<label>
								<div class="standard-tooltip">
									<span data-i18n="roll-made-by-label">Roll made by</span>:
									<span class="tooltiptext move-left">
										<span data-i18n="roll-made-by-tooltip">Enter how much you missed or made your roll by, negative value means you rolled too high, positive value is a successful roll. You can have the player roll against their appropriate skill or use the skill roll button below.</span>
									</span>
								</div>
								<input type="number" name="attr_chase_pursuer_made_by" step="1" value="0" title="Macro: @{NAME|chase_pursuer_made_by}" />
							</label>
						</div>
					</div>
				</div>
			</div>

			<div class="chase-row">
				<div class="grid-4-column-equal grid__border grid__padding">
					<div class="grid-cell">
						<h4>Description</h4>
						<div class="content"><span name="attr_pursuer_maneuver_description"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Conditions</h4>
						<div class="content"><span name="attr_pursuer_maneuver_conditions"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Actions</h4>
						<div class="content"><span name="attr_pursuer_maneuver_actions"></span></div>
					</div>
					<div class="grid-cell">
						<h4>Chase Rolls</h4>
						<div class="content"><span name="attr_pursuer_maneuver_chase_rolls"></span></div>
					</div>					
				</div>

			</div>

			<div class="chase-row">
				<div class="grid-chase-leader-table">

					<!-- row 1 -->
					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="leader-label">Leader</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-leader-tooltip">If it's just one person, enter that character's name. If there's a group of people, select a <b>leader</b> that will make the chase skill roll.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="mode-label">Mode</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-mode-tooltip">A brief description of the mode of travel; land, water, air. You could enter land/water for a hovercraft.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="abbreviation-stability-rating-label">SR</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-stability-rating-tooltip">Stability Rating of vehicle, if applicable. Used when checking for Wipeouts.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="abbreviation-handling-label">Hnd</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-handling-tooltip">Handling of vehicle, if applicable. This value is applied to the Chase's <b>Final Modifier</b>.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="speed-label">Speed</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-speed-tooltip">Speed in yards per second, which is used to get a Chase Speed Modifier and applied to the Chase's <b>Final Modifier</b>.</span><br />
								<span data-i18n="speed-modifier-label">Speed Modifier</span>: <span name="attr_quarry_speed_chase_mod"></span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="static-label">Static</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-static-tooltip">Check if you selected a static maneuver or you forced into a static state.<br />If static...<ul><li>No speed bonus</li><li>If opponent is non-static they get an extra range shift, no matter who wins the contest.</li><li>If both if you are static, the range band doesn't change. </li><li>To remove the <b>static</b> you must change your mobility (if possible) or perform a stunt.</li></ul></span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="notes-label">Notes</span></h4>
							<span class="tooltiptext">
								<span data-i18n="chase-notes-tooltip">You could use the notes field to show what skill you're using for Chase Quick Contest and additional remember notes.</span>
							</span>
						</div>
					</div>

					<div class="grid-cell header-bg">
						<div class="standard-tooltip">
							<h4><span data-i18n="chase-skill-label">Chase Skill</span></h4>
							<span class="tooltiptext move-far-left">
								<span data-i18n="chase-skill-tooltip">Enter the level of the skill chosen for the chase. You can either have the player roll their own skill applying the <b>Final Modifier</b> or use the provided skill button.</span>
							</span>
						</div>
					</div>

					<!-- row 2 -->
					<div class="grid-cell">
						<input type="text" name="attr_pursuer_leader_name" value="" title="Macro: @{NAME|pursuer_leader_name}" />
					</div>

					<div class="grid-cell">
						<input type="text" name="attr_pursuer_mobility" value="" title="Macro: @{NAME|pursuer_mobility}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_pursuer_stability_rating" value="0" title="Macro: @{NAME|pursuer_stability_rating}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_pursuer_handling" value="0" title="Macro: @{NAME|pursuer_handling}" />
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_pursuer_speed" value="0" title="Macro: @{NAME|pursuer_handling}" />
						<input type="hidden" name="attr_pursuer_speed_chase_mod" value="0" title="Macro: @{NAME|pursuer_speed_chase_mod}" />
					</div>

					<div class="grid-cell">
						<input type="checkbox" name="attr_pursuer_is_static" value="1" title="Macro: @{NAME|pursuer_is_static}" />
					</div>

					<div class="grid-cell">
						<textarea name="attr_pursuer_condition_notes" title="Macro: @{NAME|pursuer_condition_notes}"></textarea>
					</div>

					<div class="grid-cell">
						<input type="number" step="1" name="attr_pursuer_chase_skill" class="half-width" value="10" title="Macro: @{NAME|pursuer_chase_skill}" />
						<input type="hidden" name="attr_chase_pursuer_modifier_description" value="" />
						<button type="roll" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Pursuer}} {{skillName=Chase Skill Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{pursuer_chase_skill} + @{chase_pursuer_final_modifier}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{chase_pursuer_final_modifier}}} {{rollModifierSummary=@{chase_pursuer_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{maneuver=@{chase_pursuer_maneuver}}}" class="btn ui-draggable"></button>
					</div>

				</div>
			</div>

			<div class="chase-row" style="margin-bottom: 120px;">

				<div class="grid-standard grid-2-column-big-small grid__gap_large grid__border_cell grid__padding">

					<div class="grid-cell">
						
						<div class="standard-tooltip">
							<h4 class="header-bg"><span data-i18n="support-actions-label">Support Actions</span></h4>
							<span class="tooltiptext">
								<span data-i18n="support-actions-tooltip">Support actions can be used to list passengers, characters in other vehicles, and then detailing actions and how it can impact the chase rolls.</span>
							</span>
						</div>

						<div class="grid-chase-support-actions-header">
							<div class="grid-cell">Name</div>
							<div class="grid-cell">
								<div class="standard-tooltip">
									<span data-i18n="action-label">Action</span>
									<span class="tooltiptext">
										<span data-i18n="chase-support-actions-tooltip">Typical passenger actions are Attack, Board, Seize Control, and noncombat tasks like disarming a bomb.<br />Boarding: Round starts at Close Range, roll contest of Acrobatics or Jumping vs opponents operatoring skill. See book for info.<br />Seize Control: Take control of an unmanned vehicle or seize control from a driver. See book for info.<br />GURPS Action 2 page 33.</span>
									</span>
								</div>
							</div>
							<div class="grid-cell">
								<div class="standard-tooltip">
									<span data-i18n="notes-label">Notes</span>
									<span class="tooltiptext">
										<span data-i18n="chase-support-actions-notes-tooltip">Useful for entering information of a how Chase Maneuver may affect an action.<br />For example, you could enter "-2 or weapon's Bulk with ranged attacks."</span>
									</span>
								</div>
							</div>
						</div>

						<fieldset class="repeating_chase-pursuer-support-actions">
							<div class="grid-chase-support-actions grid__padding_bottom_small">
								<div class="grid-cell">
									<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_chase-pursuer-support-actions_$[row #]_name}" />
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_action" value="" title="Macro: @{NAME|repeating_chase-pursuer-support-actions_$[row #]_action}" />
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_notes" value="" title="Macro: @{NAME|repeating_chase-pursuer-support-actions_$[row #]_notes}" />
								</div>
							</div>
						</fieldset>

					</div>

					<div class="grid-cell">
						
						<div class="standard-tooltip">
							<h4><span data-i18n="chase-modifiers-label">Chase Modifiers</span></h4>
							<span class="tooltiptext move-left">
								<span data-i18n="chase-modifiers-table-tooltip">Use this table to track various modifiers to the Final Chase Modifier.<br />Examples include Higher Purpose for a +1 to chase rolls or results of a complementary skills.</span>
							</span>
						</div>

						<div class="grid-chase-modifiers-header">
							<div class="grid-cell">Name</div>
							<div class="grid-cell">Mod</div>
						</div>

						<input type="hidden" name="attr_chase_pursuer_chase_mod_table_total" value="0" />
						<fieldset class="repeating_chase-pursuer-modifiers">
							<div class="grid-chase-modifiers grid__padding_bottom_small">
								<div class="grid-cell">
									<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_chase-pursuer-modifiers_$[row #]_name}" />
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_mod" value="0" step="1" title="Macro: @{NAME|repeating_chase-pursuer-modifiers_$[row #]_mod}" />
								</div>
							</div>
						</fieldset>

					</div>

				</div>

			</div>

		</div>
	</div>

	<!-- ===== ===== ===== ===== VEHICLE SHEET TAB ===== ===== ===== ===== -->
	<div class="tab-vehicle">

		<div class="grid-standard" style="margin-bottom: 150px;">

			<!-- #column 1 -->
			<div class="grid-cell">

				<div class="tools-container bottom-margin-medium">
					<div class="section-header bottom-margin-zero">
						<div class="grid-2-column-auto grid__align_center">
							<label class="sheet-toggle-button">
								<input type="checkbox" name="attr_toggle_vehicle_notes" value="1">
								<span></span>
							</label>
							<div class="standard-tooltip">
								<h4><span data-i18n="notes-label">Notes</span></h4>
								<span class="tooltiptext">
									<span data-i18n="vehicle-notes-tooltip">Enter additional notes about the vehicle. A good example are vehicle options from GURPS Action 6 Tricked Out Rides.</span>
								</span>
							</div>
						</div>
					</div>
					<input type="hidden" name="attr_toggle_vehicle_notes" />
					<div class="container-vehicle-notes">
						<textarea name="attr_vehicle_notes" title="Macro: @{NAME|vehicle_notes}"></textarea>
					</div>
				</div>

				<div class="grid-vehicle-stats-row-one grid__align_center grid__gap_small">
					<!-- Headers -->
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="type-label">Type</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-type-tooltip">Enter a description for the type of vehicle. <ul><li>Ground</li><li>Ground/Road</li><li>Ground/Rail</li><li>Watercraft</li><li>Aircraft</li><li>Spacecraft</li><li>Amphibious</li><li>Etc.</li></ul></span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-technology-level-label">TL</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-tech-level-tooltip">Enter the Tech Level of the vehicle.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-strength">ST</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-strength-tooltip">Enter the Strength of the Vehicle. An unpowered vehicle will have a Strength of zero. B462.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-hit-points">HP</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-hit-points-tooltip">Enter the Hit Points of the Vehicle. B462.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<label>
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-handling-label">Hnd</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-handling-tooltip">Vehicle Handling modifies Control Rolls, B466.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-stability-rating-label">SR</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-stability-rating-tooltip">Vehicle Stability Rating determines if the failed Control Roll is a minor or major failure, B466.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-health">HT</span></b>
							<span class="tooltiptext move-left">
								<span data-i18n="vehicle-health-tooltip">Vehicle's Health. B466. Use the check-boxes to the right to identify fragile features of the vehicle. Unpowered vehicles are Homogenous with HT 12, while machines have HT 10, Damage to Objects, B483.<br />Modifiers: <ul><li>Cheap, temperamental, or poorly maintained, -1 to -3 HT.</li><li>Well-made or rugged, +1 or +2 HT.</li></ul></span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<select name="attr_vehicle_injury_tolerance">
							<option value="machine" data-i18n="machine-option">Machine meta-trait (HT 10)</option>
							<option value="machine" data-i18n="unpowered-option">Unpowered (HT 12)</option>
						</select>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_flammable" value="1">
							<div class="standard-tooltip">
								<span data-i18n="flammable-label">Flammable</span>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-flammable-tooltip">A flammable vehicle will catch fire if it suffers 3 Hit Points of burning damage. If exposed to a flame that can't do 3 or more hit points, roll 3d6 every 10 seconds, on a 6 or less, the vehicle catches fire. Once on fire, vehicle suffers 1d6-1 burning damage per second. B433.</span>
								</span>
							</div>
						</label>
					</div>

					<!-- Data Input -->
					<div class="grid-item">
						<input type="text" name="attr_vehicle_type" value="" title="Macro: @{NAME|vehicle_type}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_tech_level" value="3" min="0" step="1" title="Macro: @{NAME|vehicle_tech_level}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_strength" class="medium-large-width" value="40" min="0" step="1" title="Macro: @{NAME|vehicle_strength}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_hit_points_max" class="medium-large-width" value="40" min="0" step="1" title="Macro: @{NAME|vehicle_hit_points_max}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_handling" value="0" step="1" title="Macro: @{NAME|vehicle_handling}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_stability_rating" value="0" min="0" step="1" title="Macro: @{NAME|vehicle_stability_rating}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_health" value="10" min="0" step="1" title="Macro: @{NAME|vehicle_health}" />
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_combustible" value="1">
							<div class="standard-tooltip">
								<span data-i18n="combustible-label">Combustible</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-combustible-tooltip">A flammable vehicle will catch fire if it suffers 3 Hit Points of burning damage. If exposed to a flame that can't do 3 or more hit points, roll 3d6 every 10 seconds, on a 6 or less, the vehicle catches fire. Once on fire, vehicle suffers 1d6-1 burning damage per second. B433.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_explosive" value="1">
							<div class="standard-tooltip">
								<span data-i18n="explosive-label">Explosive</span>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-explosive-tooltip">A explosive vehicle will catch fire if it suffers 3 Hit Points of burning damage. If exposed to a flame that can't do 3 or more hit points, roll 3d6 every 10 seconds, on a 6 or less, the vehicle catches fire. Once on fire, vehicle suffers 1d6-1 burning damage per second. B433.</span>
								</span>
							</div>
						</label>
					</div>

				</div>

				<div class="grid-vehicle-stats-row-two grid__align_center grid__gap_small">

					<!-- Headers -->
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-acceleration-label">Accel</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-acceleration-tooltip">Enter the vehicle's acceleration in yards (hexes) per second. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="top-label">Top</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-top-tooltip">Enter the vehicle's top speed in yards per second. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-loaded-weight-label">Lwt</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-loaded-weight-tooltip">Enter the vehicle's loaded weight, in tons, of the vehicle. This is the maximum payload and a full load of fuel. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<label>
							<div class="standard-tooltip">
								<b><span data-i18n="load-label">Load</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-load-tooltip">The weight, in tons, of occupants and cargo the vehicle can carry, including the operator. B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-capacity-label">Cap</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-cargo-capacity-tooltip">Vehicle's cargo capacity, uses the formula of Load subtract weight of occupants, where each person is .1 tons. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="curb-label">Curb</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-curb-weight-tooltip">Vehicle's curb weight (with fuel but no other payload), which is Loaded Weight minus Load. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-size-modifier-tooltip">Vehicle's size modifier, B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="crew-label">Crew</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-crew-tooltip">Enter the number of crew members needed to operate the vehicle. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="passengers-label">Passengers</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-passengers-tooltip">Enter the number of crew members needed to operate the vehicle. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_long_term" value="1">
							<div class="standard-tooltip">
								<span data-i18n="a-indicator-long-term-label">A: Long-term</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-long-term-tooltip">The letter "A" indicates the vehicle is built for long-term accommodation, with room to sleep, cook, etc. B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_pressure_support" value="1">
							<div class="standard-tooltip">
								<span data-i18n="p-indicator-pressure-support-label">P: Pressure Support</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-pressure-support-tooltip">The letter "P" indicates the vehicle has Pressure Support (B82). B463.</span>
								</span>
							</div>
						</label>
					</div>

					<!-- Data Input -->
					<div class="grid-item">
						<input type="number" name="attr_vehicle_acceleration" value="0" title="Macro: @{NAME|vehicle_acceleration}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_top_speed" value="0" title="Macro: @{NAME|vehicle_top_speed}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_loaded_weight" value="0" title="Macro: @{NAME|vehicle_loaded_weight}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_load" value="0" title="Macro: @{NAME|vehicle_load}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_cargo_capacity" value="0" title="Macro: @{NAME|vehicle_cargo_capacity}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_curb_weight" value="0" title="Macro: @{NAME|vehicle_curb_weight}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_size_modifier" value="0" title="Macro: @{NAME|vehicle_size_modifier}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_crew" value="1" title="Macro: @{NAME|vehicle_crew}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_passengers" value="0" title="Macro: @{NAME|vehicle_passengers}" class="medium-large-width" />
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_sealed" value="1">
							<div class="standard-tooltip">
								<span data-i18n="s-indicator-sealed-label">S: Sealed</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-sealed-tooltip">The letter "S" indicates the vehicle is sealed (). B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_vacuum_support" value="1">
							<div class="standard-tooltip">
								<span data-i18n="p-indicator-vacuum-support-label">V: Vaccuum Support</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-vacuum-support-tooltip">The letter "V" indicates the vehicle has Vacuum Support (B96). B463.</span>
								</span>
							</div>
						</label>
					</div>

				</div>

				<div class="grid-vehicle-stats-row-three grid__align_center grid__gap_small">
					
					<!-- Headers -->
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-damage-resistance-label">DR</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-damage-resistance-tooltip">Enter the vehicle's Damage Resistance, this can be used as a reference when building hit locations. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="range-label">Range</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-range-tooltip">The travel distance before the vehicle runs of out fuel or provisions. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="cruise-percent-label">Cruise %</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-cruise-percent-tooltip">Enter a percentage to calculate the vehicle's Cruising speed, which is typically about 60 to 70 percent of the top speed. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<label>
							<div class="standard-tooltip">
								<b><span data-i18n="cruising-label">Cruising</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-cruising-speed-tooltip">The vehicle cruising speed, which is Top Speed times Cruise %. B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-endurance-label">End.</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-endurance-tooltip">Vehicle's endurance in hours is the Range divided by Cruising speed. For situations where "Loiter" capability matters more than range. Vehicle must carry provisions in order to take advantage of endurance in excess of one day. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="cost-label">Cost</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-cost-tooltip">Vehicle's cost. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviation-location-label">Loc</span></b>
							<span class="tooltiptext">
								<span data-i18n="vehicle-location-tooltip">Vehicle's hit locations, this can be used to help build the hit locations table. B463. The quantity precedes the abbreviation; e.g., "3M" for a three-masted ship.</span><br />
								<span data-i18n="vehicle-hit-location-abbreviations-tooltip">Hit Location Abbreviations. B463.<ul><li>A: arm</li><li>C: caterpillar tracks</li><li>D: draft animals</li><li>E: exposed rider</li><li>G: large glass windows</li><li>g: small glass windows</li><li>H: helicopter rotors</li><li>L: leg</li><li>M: mast and rigging</li><li>O: open cabin</li><li>R: runners or skids</li><li>r: retractable</li><li>S: large superstructure or gondola</li><li>s: small superstructure</li><li>T: main turret</li><li>t: independent turret</li><li>W: wheel</li><li>Wi: a pair of wings</li><li>X: exposed weapon mount</li></ul></span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="draft-label">Draft</span></b>
							<span class="tooltiptext move-left">
								<span data-i18n="vehicle-draft-tooltip">For a watercraft, the minimum depth of water it can safely operate in. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="stall-label">Stall</span></b>
							<span class="tooltiptext move-left">
								<span data-i18n="vehicle-stall-tooltip">For an aircraft, the minimum speed, in hex (yards)/second, it must maint to take off and stay airborne. "0" means it can hover. B463.</span>
							</span>
						</div>
					</div>
					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_spacecraft" value="1">
							<div class="standard-tooltip">
								<span data-i18n="spacecraft-label">Spacecraft</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-spacecraft-tooltip">The vehicle is capable of space flight. B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="abbreviaion-earth-gravities-label">G</span></b>
							<span class="tooltiptext move-extreme-left">
								<span data-i18n="vehicle-earth-gravities-tooltip">For spacecraft, the accel in Earth gravities (G), calculated as acceleration divided by 10. B463.</span>
							</span>
						</div>
					</div>
					
					<!-- Data Input -->
					<div class="grid-item">
						<input type="text" name="attr_vehicle_damage_resistance" value="4" title="Macro: @{NAME|vehicle_damage_resistance}" class="medium-width" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_range" value="300" title="Macro: @{NAME|vehicle_range}" class="medium-width" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_cruise_percent" value="60" title="Macro: @{NAME|vehicle_cruise_percent}" class="medium-width"/>
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_cruising_speed" value="0" title="Macro: @{NAME|vehicle_cruising_speed}" class="medium-width" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_endurance" value="0" title="Macro: @{NAME|vehicle_endurance}" />
					</div>
					<div class="grid-item">
						<input type="text" name="attr_vehicle_cost" value="" title="Macro: @{NAME|vehicle_cost}" class="large-width" />
					</div>
					<div class="grid-item">
						<input type="text" name="attr_vehicle_hit_locations" value="" title="Macro: @{NAME|vehicle_hit_locations}" class="large-width" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_draft" value="0" title="Macro: @{NAME|vehicle_draft}" />
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_stall" value="0" title="Macro: @{NAME|vehicle_stall}" />
					</div>
					<div class="grid-item">						
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_light_speed" value="1">
							<div class="standard-tooltip">
								<span data-i18n="light-speed-label">Light speed</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-light-speed-tooltip">The vehicle is capable of lightspeed. B463.</span>
								</span>
							</div>
						</label>
					</div>
					<div class="grid-item">
						<input type="number" name="attr_vehicle_earth_gravities" value="0" title="Macro: @{NAME|vehicle_earth_gravities}" />
					</div>
				</div>

				<div class="tools-container">

					<div class="section-header">
						<h3><span data-i18n="vehicle-maneuvering-status-interface-label">Vehicle Maneuvering and Status Interface</span></h3>
					</div>

					<div class="grid-vehicle-maneuvering-base-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="movement-label">Movement</span></b>
								<span class="tooltiptext">
									<span data-i18n="turning-velocity-movement-tooltip">Select movement type to determine turning radius and/or deceleration penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<b><span data-i18n="abbreviation-accuracy-label">Acc</span></b>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-percentage-label">Top %</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-top-speed-modification-percent-tooltip">Enter a percentage to modify the top speed of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-location-percentage-label">Loc %</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-cruising-speed-tooltip">The vehicle cruising speed, which is Top Speed times Cruise %. B463.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="fatigued-label">Fatigued</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-fatigued-tooltip">Check this box if the power souce, such as horses, has become fatigued. This will affect the Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-label">Top</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-calculated-top-speed-tooltip">The calculated Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-start-velocity-label">Start Vel.</span></b>
								<span class="tooltiptext">
									<span data-i18n="start-velocity-tooltip">Enter velocity (yards/second) for current turn.<br /><b>Important:</b> Be sure to check your max allowed velocity based on movement type.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="change-in-velocity-label">Change</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="change-in-velocity-tooltip">Amount to accelerate or decelerate for the turn.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-final-velocity-label">Final Vel.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="final-velocity-tooltip">Final velocity. Current Velocity - Deceleration.<br />The final velocity is how you start the turn and is used to<br />calculate the deceleration penalty, turn radius, and tight turn penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-deceleration-penalty-label">Decel. Pen.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="deceleration-penalty-tooltip">Deceleration Skill penalty to DX roll or operation skill.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="turn-radius-label">Turn Radius</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="turn-radius-tooltip">The minimum distance in yards (hexes) the vehicle must travel to make a 90-degree turn. B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="tight-turn-label">Tight Turn</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="tight-turn-tooltip">Penalty to DX roll or operation skill for tight turns.</span>
								</span>
							</div>
						</div>
						
						<!-- input row -->
						<div class="grid-item">
							<select name="attr_vehicle_movement_type">
								<option value="Select" data-i18n="option-select">--Select--</option>
								<option value="Ground" data-i18n="option-ground">Ground</option>
								<option value="Air" data-i18n="option-air">Air</option>
								<option value="Water" data-i18n="option-water">Water</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_acceleration" value="0" title="Macro: @{NAME|vehicle_acceleration}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_top_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_top_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_location_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_location_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="checkbox" name="attr_vehicle_fatigued" value="1" title="Macro: @{NAME|vehicle_fatigued}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_calculated_top_speed" value="0" title="Macro: @{NAME|vehicle_calculated_top_speed}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_start_velocity" value="0" title="Macro: @{NAME|vehicle_start_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_change_in_velocity" value="0" title="Macro: @{NAME|vehicle_change_in_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_final_velocity" value="0" title="Macro: @{NAME|vehicle_final_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_deceleration_penalty" value="0" title="Macro: @{NAME|vehicle_deceleration_penalty}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_turn_radius" value="0" title="Macro: @{NAME|vehicle_turn_radius}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_tight_turn_penalty" value="0" title="Macro: @{NAME|vehicle_tight_turn_penalty}" />
						</div>

					</div>

					<div class="grid-vehicle-status-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-health">HT</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-health-roll-tooltip">Vehicle Health Roll. <ul><li>If suffering a Major Wound.</li><li>To avoid catching fire, exploding, etc.</li><li>When reduced to zero or less HP.</li><li>Being used if HP is less than zero.</li><li>If -1xHP or -5xHP, HT Roll to avoid being destroyed.</li></ul></span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-hit-points-scale-label">HP Scale</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-points-scale-tooltip">Select a HP Scale. B470. This will update the Hit Points to the right and the hit location armor.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-hit-points">HP</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-current-hit-points-tooltip">The current Hit Points of the vehicle, based on selected HP scale.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-major-label">MW</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-major-wound-tooltip">Major Wound threshold of the vehicle. If the vehicle suffers a major wound, GM may call for a HT roll. On a failure, one or more systems fail. B484.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-size-modifier-tooltip">Vehicle's size modifier, B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-handling-label">Hnd</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-handling-tooltip">Vehicle Handling modifies Control Rolls, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-stability-rating-label">SR</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-stability-rating-tooltip">Vehicle Stability Rating determines if the failed Control Roll is a minor or major failure, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="velocity-label">Velocity</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-velocity-tooltip">The current velocity if the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="altitude-label">Altitude</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-altitude-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="depth-label">Depth</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-depth-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="hit-point-effects-label">HP Effects</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-hit-point-effects-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>

						<!-- input fields -->
						<div class="grid-item">
							<input type="number" name="attr_vehicle_health_roll" value="0" title="Macro: @{NAME|vehicle_health_roll}" />
							<button type="action" name="act_roll_vehicle_health_roll" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Team Effort}} {{skillName=@{team_effort_skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{team_effort_final_level}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{team_effort_modifier}}} {{rollModifierSummary=@{team_effort_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}"></button>
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_scale" value="normal" />
							<select name="attr_vehicle_hit_point_scale">
								<option value="normal" data-i18n="option-normal" selected>Normal</option>
								<option value="d-scale" data-i18n="option-decade-scale">Decade Scale</option>
								<option value="c-scale" data-i18n="option-century-scale">Century Scale</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_hit_points" value="0" title="Macro: @{NAME|vehicle_hit_points}" />
							<span>/</span>
							<input type="number" name="attr_vehicle_hit_points_max" readonly value="0" title="Macro: @{NAME|vehicle_hit_points_max}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_major_wound_threshold" value="0" title="Macro: @{NAME|vehicle_major_wound_threshold}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_size_modifier" readonly value="0" title="Macro: @{NAME|vehicle_size_modifier}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_handling" value="0" readonly title="Macro: @{NAME|vehicle_handling}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_stability_rating" value="0" readonly title="Macro: @{NAME|vehicle_stability_rating}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_velocity" value="0" title="Macro: @{NAME|vehicle_current_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_altitude" value="0" title="Macro: @{NAME|vehicle_current_altitude}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_depth" value="0" title="Macro: @{NAME|vehicle_current_depth}" />
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_effects" value="Please remove" title="Macro: @{NAME|vehicle_hit_point_effects}" />
							<span name="attr_vehicle_hit_point_effects">1/2 move</span>
						</div>
						
					</div>

				</div>

			</div>

		</div>

	</div>

	<!-- ===== ===== ===== ===== VEHICLE LOCATION SHEET TAB ===== ===== ===== ===== -->
	<div class="tab-vehicle-locations">
		<div class="grid-standard" style="margin-bottom: 150px;">

			<!-- #column 1 -->
			<div class="grid-cell">

				<div class="tools-container bottom-margin-medium">
					<div class="section-header bottom-margin-zero">
						<div class="grid-2-column-auto grid__align_center">
							<label class="sheet-toggle-button">
								<input type="checkbox" name="attr_toggle_vehicle_location_notes" value="1">
								<span></span>
							</label>
							<div class="standard-tooltip">
								<h4><span data-i18n="notes-label">Notes</span></h4>
								<span class="tooltiptext">
									<span data-i18n="vehicle-location-notes-tooltip">Enter additional notes about the vehicle hit locations.</span>
								</span>
							</div>
						</div>
					</div>
					<input type="hidden" name="attr_toggle_vehicle_location_notes" />
					<div class="container-vehicle-notes">
						<textarea name="attr_vehicle_location_notes" title="Macro: @{NAME|vehicle_location_notes}"></textarea>
					</div>
				</div>

				<div class="tools-container bottom-margin-large">

					<div class="section-header">
						<h3><span data-i18n="vehicle-maneuvering-status-interface-label">Vehicle Maneuvering and Status Interface</span></h3>
					</div>

					<div class="grid-vehicle-maneuvering-base-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="movement-label">Movement</span></b>
								<span class="tooltiptext">
									<span data-i18n="turning-velocity-movement-tooltip">Select movement type to determine turning radius and/or deceleration penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<b><span data-i18n="abbreviation-accuracy-label">Acc</span></b>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-percentage-label">Top %</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-top-speed-modification-percent-tooltip">Enter a percentage to modify the top speed of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-location-percentage-label">Loc %</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-cruising-speed-tooltip">The vehicle cruising speed, which is Top Speed times Cruise %. B463.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="fatigued-label">Fatigued</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-fatigued-tooltip">Check this box if the power souce, such as horses, has become fatigued. This will affect the Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-label">Top</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-calculated-top-speed-tooltip">The calculated Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-start-velocity-label">Start Vel.</span></b>
								<span class="tooltiptext">
									<span data-i18n="start-velocity-tooltip">Enter velocity (yards/second) for current turn.<br /><b>Important:</b> Be sure to check your max allowed velocity based on movement type.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="change-in-velocity-label">Change</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="change-in-velocity-tooltip">Amount to accelerate or decelerate for the turn.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-final-velocity-label">Final Vel.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="final-velocity-tooltip">Final velocity. Current Velocity - Deceleration.<br />The final velocity is how you start the turn and is used to<br />calculate the deceleration penalty, turn radius, and tight turn penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-deceleration-penalty-label">Decel. Pen.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="deceleration-penalty-tooltip">Deceleration Skill penalty to DX roll or operation skill.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="turn-radius-label">Turn Radius</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="turn-radius-tooltip">The minimum distance in yards (hexes) the vehicle must travel to make a 90-degree turn. B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="tight-turn-label">Tight Turn</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="tight-turn-tooltip">Penalty to DX roll or operation skill for tight turns.</span>
								</span>
							</div>
						</div>
						
						<!-- input row -->
						<div class="grid-item">
							<select name="attr_vehicle_movement_type">
								<option value="Select" data-i18n="option-select">--Select--</option>
								<option value="Ground" data-i18n="option-ground">Ground</option>
								<option value="Air" data-i18n="option-air">Air</option>
								<option value="Water" data-i18n="option-water">Water</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_acceleration" value="0" title="Macro: @{NAME|vehicle_acceleration}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_top_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_top_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_location_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_location_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="checkbox" name="attr_vehicle_fatigued" value="1" title="Macro: @{NAME|vehicle_fatigued}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_calculated_top_speed" value="0" title="Macro: @{NAME|vehicle_calculated_top_speed}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_start_velocity" value="0" title="Macro: @{NAME|vehicle_start_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_change_in_velocity" value="0" title="Macro: @{NAME|vehicle_change_in_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_final_velocity" value="0" title="Macro: @{NAME|vehicle_final_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_deceleration_penalty" value="0" title="Macro: @{NAME|vehicle_deceleration_penalty}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_turn_radius" value="0" title="Macro: @{NAME|vehicle_turn_radius}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_tight_turn_penalty" value="0" title="Macro: @{NAME|vehicle_tight_turn_penalty}" />
						</div>

					</div>

					<div class="grid-vehicle-status-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-health">HT</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-health-roll-tooltip">Vehicle Health Roll. <ul><li>If suffering a Major Wound.</li><li>To avoid catching fire, exploding, etc.</li><li>When reduced to zero or less HP.</li><li>Being used if HP is less than zero.</li><li>If -1xHP or -5xHP, HT Roll to avoid being destroyed.</li></ul></span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-hit-points-scale-label">HP Scale</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-points-scale-tooltip">Select a HP Scale. B470. This will update the Hit Points to the right and the hit location armor.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-hit-points">HP</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-current-hit-points-tooltip">The current Hit Points of the vehicle, based on selected HP scale.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-major-label">MW</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-major-wound-tooltip">Major Wound threshold of the vehicle. If the vehicle suffers a major wound, GM may call for a HT roll. On a failure, one or more systems fail. B484.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-size-modifier-tooltip">Vehicle's size modifier, B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-handling-label">Hnd</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-handling-tooltip">Vehicle Handling modifies Control Rolls, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-stability-rating-label">SR</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-stability-rating-tooltip">Vehicle Stability Rating determines if the failed Control Roll is a minor or major failure, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="velocity-label">Velocity</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-velocity-tooltip">The current velocity if the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="altitude-label">Altitude</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-altitude-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="depth-label">Depth</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-depth-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="hit-point-effects-label">HP Effects</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-hit-point-effects-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>

						<!-- input fields -->
						<div class="grid-item">
							<input type="number" name="attr_vehicle_health_roll" value="0" title="Macro: @{NAME|vehicle_health_roll}" />
							<button type="action" name="act_roll_vehicle_health_roll" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Team Effort}} {{skillName=@{team_effort_skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{team_effort_final_level}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{team_effort_modifier}}} {{rollModifierSummary=@{team_effort_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}"></button>
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_scale" value="normal" />
							<select name="attr_vehicle_hit_point_scale">
								<option value="normal" data-i18n="option-normal" selected>Normal</option>
								<option value="d-scale" data-i18n="option-decade-scale">Decade Scale</option>
								<option value="c-scale" data-i18n="option-century-scale">Century Scale</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_hit_points" value="0" title="Macro: @{NAME|vehicle_hit_points}" />
							<span>/</span>
							<input type="number" name="attr_vehicle_hit_points_max" readonly value="0" title="Macro: @{NAME|vehicle_hit_points_max}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_major_wound_threshold" value="0" title="Macro: @{NAME|vehicle_major_wound_threshold}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_size_modifier" readonly value="0" title="Macro: @{NAME|vehicle_size_modifier}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_handling" value="0" readonly title="Macro: @{NAME|vehicle_handling}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_stability_rating" value="0" readonly title="Macro: @{NAME|vehicle_stability_rating}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_velocity" value="0" title="Macro: @{NAME|vehicle_current_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_altitude" value="0" title="Macro: @{NAME|vehicle_current_altitude}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_depth" value="0" title="Macro: @{NAME|vehicle_current_depth}" />
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_effects" value="Please remove" title="Macro: @{NAME|vehicle_hit_point_effects}" />
							<span name="attr_vehicle_hit_point_effects">1/2 move</span>
						</div>
						
					</div>

				</div>

				<div class="grid-vehicle-location-status-bar grid__align_center grid__gap_medium">

					<div class="grid-item">
						<div class="standard-tooltip">
							<b><span data-i18n="template-label">Template</span>:</b>
							<span class="tooltiptext">
								<span data-i18n="character-armor-type-tooltip">Select the hit location type and click the <b>Apply</b> button.<br><b>ALERT:</b> This will delete the current hit locations!</span>
							</span>
						</div>
					</div>

					<div class="grid-item">
						<select name="attr_vehicle_hit_location_type" title="Macro: @{NAME|vehicle_hit_location_type}">
							<option value="select" data-i18n="option-select">--Select--</option>
							<option value="aircraft" data-i18n="option-aircraft">Aircraft</option>
							<option value="automobile" data-i18n="option-automobile">Automobile</option>
							<option value="biplane" data-i18n="option-biplane">Biplane</option>
							<option value="helicopter" data-i18n="option-helicopter">Helicopter</option>
							<option value="hovercraft" data-i18n="option-hovercraft">Hovercraft</option>
							<option value="monoplace" data-i18n="option-monoplane">Monoplane</option>
							<option value="motorcycle" data-i18n="option-motorcycle">Motorcycle</option>
							<option value="row-boat" data-i18n="option-row-boat">Row Boat</option>
							<option value="sail-boat" data-i18n="option-sailboat">Sailboat</option>
							<option value="speed-boat" data-i18n="option-speed-boat">Speed Boat</option>
							<option value="submarine" data-i18n="option-submarine">Submarine</option>
							<option value="tank" data-i18n="option-tank">Tank</option>																
						</select>
						<button type="action" name="act_vehicle_locations_apply" class="reset" title="Apply the selected hit location type"><span data-i18n="apply-label">Apply</span></button>
					</div>

					<div class="grid-item">
						<b><span data-i18n="injury-tolerance-label">Injury Tolerance</span>:</b>
					</div>

					<div class="grid-item">
						<input type="hidden" name="attr_vehicle_injury_tolerance" value="Unliving">
						<input type="hidden" name="attr_vehicle_injury_tolerance_description" value="Unliving">
						<div class="standard-tooltip">
							<b><span name="attr_vehicle_injury_tolerance"></span></b>
							<span class="tooltiptext">
								<span name="attr_vehicle_injury_tolerance_description"></span>
							</span>
						</div>
					</div>

					<div class="grid-item">
						<label class="container-label-input grid__gap_small">
							<input type="checkbox" name="attr_vehicle_sync_hit_points" value="1">
							<div class="standard-tooltip">
								<span data-i18n="sync-hp-label">Sync HP</span>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-sync-hp-tooltip">If a damage is entered into the table below, the vehicle Hit Points will also be updated.</span>
								</span>
							</div>
						</label>
					</div>

					<div class="grid-item">
						<button type="action" name="act_vehicle_reset_hp" class="sort reset" title="Reset Hit Points for vehicle and hit locations"><span data-i18n="reset-hp-label">Reset HP</span></button>
					</div>

				</div>

				<div class="grid-standard vehicle-hit-location-container">
					<div class="grid-vehicle-hit-location-table grid__align_center grid__gap_medium">
						<div class="grid-cell">&nbsp;</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="location-label">Location</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-tooltip">Hit location name.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-modifier-label">Mod</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-modifier-tooltip">To Hit modifier for the location.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="to-hit-label">To Hit</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-to-hit-tooltip">The final To Hit modifier for the location, adds the Vehicle Size Modifier and the To Hit Modifier for the location.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-defense-bonus-label">DB</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-defense-bonus-tooltip">Enter the vehicle's defensive bonus for this hit location.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-damage-label">DMG</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-damage-tooltip">Enter the amount of damage this location has taken.<br><b>NOTE:</b> If you want this column to affect the current Vehicle Hit Points,<br />click the checkbox for Sync HP.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-divisor-label">Div</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-divisor-tooltip">Hit Point Divisor. If the number is 2 or higher, that means the location can be disabled and a value will be updated in the next column. See B421.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-disabled-label">Dis</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-location-disabled-tooltip">Disabled/Crippled Threshold.<br>If a <b>single</b> attack meets or exceeds this value, the extremity or structure is disabled.<br><b>NOTE:</b> In most cases, if disabled/crippled in one injury, the excess damage is lost.<br><b>Dismemberment:</b> If injury is <i>twice</i> the threshold, then extremity is destroyed. <i>Cutting</i> or <i>Explosion</i> will sever the limb.<br>See B421.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="leak-label">Leak</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-hit-location-leak-tooltip">Check this box if the location is leaking.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="fire-label">Fire</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-hit-location-fire-tooltip">Check this box if the location is on fire.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="speed-percentage-label">Speed %</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-hit-location-reduced-tooltip">Enter the percentage of change to the top speed when the location is disabled. This will automatically update the top speed. For example, if you enter 25, the top speed will be reduced by 25%. The total percentage can't exceed 100%.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-damage-resistance-label">DR</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-hit-location-damage-resistance-tooltip">Enter the Damage Resistance for this hit location. Use the Notes text box to keep track of the original DR if armor is damaged.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="scaled-label">Scaled</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-hit-location-scaled-tooltip">The scaled value of the hit location's damage resistance. Will automatically update when the scale is selected.</span>
								</span>
							</div>
						</div>
					</div>

					<fieldset class="repeating_vehicle-hit-location-table">
						<div class="grid-vehicle-hit-location-table grid__align_center grid__gap_medium">
							<div class="grid-cell">
								<label class="sheet-toggle-button">
									<input type="checkbox" name="attr_toggle_notes" value="1">
									<span></span>
								</label>
							</div>
							<div class="grid-cell">																
								<input type="hidden" name="attr_key" />
								<input type="text" name="attr_name" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_name}" />
							</div>
							<div class="grid-cell">
								<input type="number" step="1" value="0" name="attr_hit_modifier" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_hit_modifier}" />
							</div>
							<div class="grid-cell">
								<input type="number" value="@{hit_modifier} + @{vehicle_size_modifier}" disabled="disabled" name="attr_final_modifier" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_final_modifier}" />
							</div>
							<div class="grid-cell">
								<input type="number" value="0" step="1" min="0" name="attr_defense_bonus" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_defense_bonus}" />
							</div>
							<div class="grid-cell">
								<input type="number" value="0" step="1" max="0" name="attr_damage" class="highlight-input" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_damage}" />
							</div>
							<div class="grid-cell">
								<input type="number" value="1" step="1" min="1" name="attr_divisor" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_divisor}" />
							</div>
							<div class="grid-cell">
								<input type="text" name="attr_disabled" value="0" readonly="readonly" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_disabled}" />
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_leak" value="1" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_leak}" />
								</label>
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_fire" value="1" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_fire}" />
								</label>
							</div>
							<div class="grid-cell">
								<input type="number" value="0" step="1" min="0" max="100" name="attr_reduced_top_speed" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_reduced_top_speed}" />
							</div>
							<div class="grid-cell">
								<input type="text" value="0" name="attr_damage_resistance" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_damage_resistance}" />
							</div>
							<div class="grid-cell">
								<input type="text" value="0" readonly="readonly" name="attr_scaled_damage_resistance" title="Macro: @{NAME|repeating_vehicle-hit-location-table_$[row #]_scaled_damage_resistance}" />
							</div>
						</div>

						<input type="hidden" name="attr_toggle_notes">
						<div class="expandable-section">
							<div class="hit-location-notes-grid">
								<div class="item grid-header">
									<div class="popup left-align text-right-align">
										<span data-i18n="hits-label">Hits</span>
									</div>
									<span class="tooltip tooltip-margin-medium">
										<span data-i18n="hitlocation-hits-tooltip">Enter individual hits here, if limb is crippled, burning, etc.<br />Example: -6 pi (major wound), -2 burn.</span>
									</span>
								</div>
								<div class="item">
									<input type="text" name="attr_hits" class="textbox-full-width" title="Macro: @{NAME|repeating_hitlocation_$[row #]_hits}" />
								</div>
								<div class="item text-right-align">
									<div class="popup left-align text-right-align">
										<span data-i18n="notes-label">Notes</span>
									</div>
									<span class="tooltip tooltip-margin-medium">
										<span data-i18n="hitlocation-notes-tooltip">Notes that could apply to the hit location armor, damage, or other effects.</span>
									</span>
								</div>
								<div class="item">
									<input type="text" name="attr_notes" class="textbox-full-width" title="Macro: @{NAME|repeating_hitlocation_$[row #]_notes}" />
								</div>
							</div>
						</div>
					</fieldset>
				</div>
				

			</div>

		</div>
	</div>

	<!-- ===== ===== ===== ===== VEHICLE CREW SHEET TAB ===== ===== ===== ===== -->
	<div class="tab-vehicle-crew">
		<div class="grid-standard" style="margin-bottom: 150px;">

			<!-- #column 1 -->
			<div class="grid-cell">

				<div class="tools-container bottom-margin-medium">
					<div class="section-header bottom-margin-zero">
						<div class="grid-2-column-auto grid__align_center">
							<label class="sheet-toggle-button">
								<input type="checkbox" name="attr_toggle_vehicle_crew_notes" value="1">
								<span></span>
							</label>
							<div class="standard-tooltip">
								<h4><span data-i18n="notes-label">Notes</span></h4>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-notes-tooltip">Enter additional notes about the vehicle crew.</span>
								</span>
							</div>
						</div>
					</div>
					<input type="hidden" name="attr_toggle_vehicle_crew_notes" />
					<div class="container-vehicle-notes">
						<textarea name="attr_vehicle_crew_notes" title="Macro: @{NAME|vehicle_crew_notes}"></textarea>
					</div>
				</div>

				<div class="tools-container bottom-margin-large">

					<div class="section-header">
						<h3><span data-i18n="vehicle-maneuvering-status-interface-label">Vehicle Maneuvering and Status Interface</span></h3>
					</div>

					<div class="grid-vehicle-maneuvering-base-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="movement-label">Movement</span></b>
								<span class="tooltiptext">
									<span data-i18n="turning-velocity-movement-tooltip">Select movement type to determine turning radius and/or deceleration penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<b><span data-i18n="abbreviation-accuracy-label">Acc</span></b>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-percentage-label">Top %</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-top-speed-modification-percent-tooltip">Enter a percentage to modify the top speed of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-location-percentage-label">Loc %</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-cruising-speed-tooltip">The vehicle cruising speed, which is Top Speed times Cruise %. B463.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="fatigued-label">Fatigued</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-fatigued-tooltip">Check this box if the power souce, such as horses, has become fatigued. This will affect the Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-label">Top</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-calculated-top-speed-tooltip">The calculated Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-start-velocity-label">Start Vel.</span></b>
								<span class="tooltiptext">
									<span data-i18n="start-velocity-tooltip">Enter velocity (yards/second) for current turn.<br /><b>Important:</b> Be sure to check your max allowed velocity based on movement type.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="change-in-velocity-label">Change</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="change-in-velocity-tooltip">Amount to accelerate or decelerate for the turn.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-final-velocity-label">Final Vel.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="final-velocity-tooltip">Final velocity. Current Velocity - Deceleration.<br />The final velocity is how you start the turn and is used to<br />calculate the deceleration penalty, turn radius, and tight turn penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-deceleration-penalty-label">Decel. Pen.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="deceleration-penalty-tooltip">Deceleration Skill penalty to DX roll or operation skill.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="turn-radius-label">Turn Radius</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="turn-radius-tooltip">The minimum distance in yards (hexes) the vehicle must travel to make a 90-degree turn. B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="tight-turn-label">Tight Turn</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="tight-turn-tooltip">Penalty to DX roll or operation skill for tight turns.</span>
								</span>
							</div>
						</div>
						
						<!-- input row -->
						<div class="grid-item">
							<select name="attr_vehicle_movement_type">
								<option value="Select" data-i18n="option-select">--Select--</option>
								<option value="Ground" data-i18n="option-ground">Ground</option>
								<option value="Air" data-i18n="option-air">Air</option>
								<option value="Water" data-i18n="option-water">Water</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_acceleration" value="0" title="Macro: @{NAME|vehicle_acceleration}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_top_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_top_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_location_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_location_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="checkbox" name="attr_vehicle_fatigued" value="1" title="Macro: @{NAME|vehicle_fatigued}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_calculated_top_speed" value="0" title="Macro: @{NAME|vehicle_calculated_top_speed}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_start_velocity" value="0" title="Macro: @{NAME|vehicle_start_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_change_in_velocity" value="0" title="Macro: @{NAME|vehicle_change_in_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_final_velocity" value="0" title="Macro: @{NAME|vehicle_final_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_deceleration_penalty" value="0" title="Macro: @{NAME|vehicle_deceleration_penalty}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_turn_radius" value="0" title="Macro: @{NAME|vehicle_turn_radius}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_tight_turn_penalty" value="0" title="Macro: @{NAME|vehicle_tight_turn_penalty}" />
						</div>

					</div>

					<div class="grid-vehicle-status-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-health">HT</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-health-roll-tooltip">Vehicle Health Roll. <ul><li>If suffering a Major Wound.</li><li>To avoid catching fire, exploding, etc.</li><li>When reduced to zero or less HP.</li><li>Being used if HP is less than zero.</li><li>If -1xHP or -5xHP, HT Roll to avoid being destroyed.</li></ul></span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-hit-points-scale-label">HP Scale</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-points-scale-tooltip">Select a HP Scale. B470. This will update the Hit Points to the right and the hit location armor.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-hit-points">HP</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-current-hit-points-tooltip">The current Hit Points of the vehicle, based on selected HP scale.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-major-label">MW</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-major-wound-tooltip">Major Wound threshold of the vehicle. If the vehicle suffers a major wound, GM may call for a HT roll. On a failure, one or more systems fail. B484.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-size-modifier-tooltip">Vehicle's size modifier, B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-handling-label">Hnd</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-handling-tooltip">Vehicle Handling modifies Control Rolls, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-stability-rating-label">SR</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-stability-rating-tooltip">Vehicle Stability Rating determines if the failed Control Roll is a minor or major failure, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="velocity-label">Velocity</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-velocity-tooltip">The current velocity if the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="altitude-label">Altitude</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-altitude-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="depth-label">Depth</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-depth-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="hit-point-effects-label">HP Effects</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-hit-point-effects-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>

						<!-- input fields -->
						<div class="grid-item">
							<input type="number" name="attr_vehicle_health_roll" value="0" title="Macro: @{NAME|vehicle_health_roll}" />
							<button type="action" name="act_roll_vehicle_health_roll" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Team Effort}} {{skillName=@{team_effort_skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{team_effort_final_level}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{team_effort_modifier}}} {{rollModifierSummary=@{team_effort_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}"></button>
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_scale" value="normal" />
							<select name="attr_vehicle_hit_point_scale">
								<option value="normal" data-i18n="option-normal" selected>Normal</option>
								<option value="d-scale" data-i18n="option-decade-scale">Decade Scale</option>
								<option value="c-scale" data-i18n="option-century-scale">Century Scale</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_hit_points" value="0" title="Macro: @{NAME|vehicle_hit_points}" />
							<span>/</span>
							<input type="number" name="attr_vehicle_hit_points_max" readonly value="0" title="Macro: @{NAME|vehicle_hit_points_max}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_major_wound_threshold" value="0" title="Macro: @{NAME|vehicle_major_wound_threshold}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_size_modifier" readonly value="0" title="Macro: @{NAME|vehicle_size_modifier}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_handling" value="0" readonly title="Macro: @{NAME|vehicle_handling}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_stability_rating" value="0" readonly title="Macro: @{NAME|vehicle_stability_rating}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_velocity" value="0" title="Macro: @{NAME|vehicle_current_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_altitude" value="0" title="Macro: @{NAME|vehicle_current_altitude}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_depth" value="0" title="Macro: @{NAME|vehicle_current_depth}" />
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_effects" value="Please remove" title="Macro: @{NAME|vehicle_hit_point_effects}" />
							<span name="attr_vehicle_hit_point_effects">1/2 move</span>
						</div>
						
					</div>

				</div>

				<div class="tools-container bottom-margin-large">

					<div class="section-header">
						<div class="standard-tooltip">
							<h3><span data-i18n="skill-modifiers-label">Skill Roll Modifiers</span></h3>
							<span class="tooltiptext">
								<span data-i18n="skill-modifiers-tooltip">These modifiers affect all skill rolls, use the reset button to clear modifiers. These modifiers will be cleared the next time you load your character sheet.</span>
							</span>
						</div>
					</div>

					<div class="grid-skill-roll-modifier grid__align_center grid__gap_medium">

						<div class="item">
							<button type="action" name="act_show_roll_modifiers_for_skill" class="roll-modifier-button btn" title="Select Skill Modifiers">
								<span data-i18n="select-skill-modifiers-button">Select Skill Modifiers</span>
							</button>
						</div>

						<div class="item">
							<div class="summary-group">
								<div class="icon text-align__center"><span data-i18n="notes-label">Notes</span></div>
								<div class="summary" style="width:250px">
									<div class="roll-traits">
										<b>Traits:</b>
										<div>
											<textarea name="attr_crew_skill_roll_trait_summary" class="trait-summary" readonly></textarea>
										</div>
									</div>
									<div class="roll-summary">
										<b>Summary:</b>
										<div>
											<textarea name="attr_crew_skill_roll_modifier_summary" class="roll-summary" readonly></textarea>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="item">
							<div class="standard-tooltip">
								<span data-i18n="modifier-label">Modifier:</span>
								<span class="tooltiptext">
									<span data-i18n="modifier-dialog-tooltip">Enter a custom modifier and optional reason to apply to any rolls on the this table.</span>
								</span>
							</div>
							<input type="number" value="0" step="1" name="attr_crew_skill_custom_roll_modifier" />
						</div>

						<div class="item">
							<div class="container-label-input grid__gap_small">
								<div class="standard-tooltip">
									<span data-i18n="reason-label">Reason</span>:
									<span class="tooltiptext">
										<span data-i18n="roll-modifier-reason-tooltip">Describe the reasons why you entered the custom modifier.</span>
									</span>
								</div>
								<textarea class="reason-textarea" name="attr_crew_skill_custom_roll_modifier_reason"></textarea>
							</div>
						</div>

						<div class="item">
							<div class="container-label-input grid__gap_small">
								<div class="standard-tooltip">
									<span data-i18n="final-modifier-label">Final Modifier</span>:
									<span class="tooltiptext">
										<span data-i18n="final-modifier-dialog-tooltip">The final modifier that will be applied to the effective skill level.</span>
									</span>
								</div>
								<div class="number-input">
									<input type="hidden" name="attr_crew_skill_roll_modifier_status" value="neutral" class="modifier-status" />
									<input type="number" value="0" step="1" name="attr_crew_skill_roll_modifier" class="final-modifier" readonly />
									<input type="hidden" value="" name="attr_crew_skill_roll_modifier_summary" />
									<input type="hidden" value="" name="attr_crew_skill_roll_trait_summary" />
									<input type="hidden" value="" name="attr_crew_skill_roll_hit_location" />
									<input type="hidden" value="" name="attr_crew_skill_roll_maneuver" />
									<input type="hidden" value="" name="attr_crew_skill_roll_allout_attack" />
								</div>
							</div>
						</div>

						<div class="item">
							<button type="action" name="act_skill_roll_reset" class="reset-button btn tool-modifier-reset" title="Reset Skill Modifiers">
								<span data-i18n="reset-label">Reset</span>
							</button>
						</div>

					</div>

				</div>

				<div class="grid-standard vehicle-crew-container">
					<div class="grid-vehicle-crew-table grid__align_center grid__gap_medium">
						<div class="grid-cell">&nbsp;</div>
						<div class="grid-cell">&nbsp;</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="name-label-no-colon">Name</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-name-tooltip">Enter the name of the crew member.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="location-label">Location</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-location-tooltip">Enter the location of the crew member.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-fatigued-label">Fat</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-fatigued-tooltip">Check this box if the crew member has become fatigued.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="weight-label">Weight</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-weight-tooltip">Enter the weight of the crew member.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="on-label">On</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-on-tooltip">Check if the crew member is on or in the vehicle. If checked, the crew member weight will be added to the total weight of the crew.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="skill-label">Skill</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-crew-skill-name-tooltip">Enter the name of the skill that will be used for the roll, use a skill that is appropriate for the crew member's role on the vehicle. For example, if the person is a driver, enter Driving (automobile) as the skill name.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="base-label">Base</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-crew-base-skill-level-tooltip">Enter the base skill level.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-modifier-label">Mod</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-crew-skill-modifier-tooltip">Enter an optional long term skill modifier, this will be applied to the Base skill level.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="level-label">Level</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-crew-final-skill-level-tooltip">This is the final skill level that will be used with the roll.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">
							<div class="standard-tooltip">
								<b><span data-i18n="control-label">Control</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-crew-control-roll-tooltip">If checked, the skill roll is a vehicle control roll, the results will updated to reflect the roll type.</span>
								</span>
							</div>
						</div>
						<div class="grid-cell">&nbsp;</div>
					</div>

					<fieldset class="repeating_vehicle-crew-table">
						<div class="grid-vehicle-crew-table grid__align_center grid__gap_medium">
							<div class="grid-cell">
								<label class="sheet-toggle-button">
									<input type="checkbox" name="attr_toggle_notes" value="1">
									<span></span>
								</label>
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_highlight" value="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_highlight}" />
								</label>
							</div>
							<div class="grid-cell">																
								<input type="hidden" name="attr_key" />
								<input type="text" name="attr_name" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_name}" />
							</div>
							<div class="grid-cell">																
								<input type="text" name="attr_location" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_location}" />
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_fatiqued" value="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_fatiqued}" />
								</label>
							</div>
							<div class="grid-cell">
								<input type="number" step="1" value="0" min="0" name="attr_weight" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_weight}" />
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_on" value="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_on}" />
								</label>
							</div>
							<div class="grid-cell">																
								<input type="text" name="attr_skill_name" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_skill_name}" />
							</div>
							<div class="grid-cell">
								<input type="number" step="1" value="10" min="0" step="1" name="attr_skill_base" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_skill_base}" />
							</div>
							<div class="grid-cell">
								<input type="number" step="1" value="0" step="1" name="attr_skill_mod" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_skill_mod}" />
							</div>
							<div class="grid-cell">
								<input type="number" step="1" value="10" step="1" name="attr_skill_final" readonly title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_skill_final}" />
							</div>
							<div class="grid-cell">
								<label class="container-label-input">
									<input type="checkbox" name="attr_is_control_roll" value="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_is_control_roll}" />
								</label>
							</div>
							<div class="grid-cell">
								<button type="roll" class="btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=@{name}}} {{skillName=@{skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{skill_final}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{chase_pursuer_final_modifier}}} {{rollModifierSummary=@{chase_pursuer_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}"></button>
							</div>
						</div>

						<input type="hidden" name="attr_toggle_notes">
						<div class="expandable-section">
							<div class="tools-container bottom-margin-medium">
								<div class="section-header bottom-margin-zero">
									<div class="grid-2-column-auto grid__align_center">
										<label class="toggle-button">
											<input type="checkbox" name="attr_toggle_crew_member_notes" value="1">
											<span></span>
										</label>
										<div class="standard-tooltip">
											<h4><span data-i18n="notes-label">Notes</span></h4>
											<span class="tooltiptext">
												<span data-i18n="crew-member-notes-tooltip">Enter notes about the crew member.</span>
											</span>
										</div>
									</div>
								</div>
								<input type="hidden" name="attr_toggle_crew_member_notes" value="0">
								<div class="container-vehicle-notes">
									<textarea name="attr_crew_member_notes" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_crew_notes}"></textarea>
								</div>
							</div>
							<div class="grid-2-column-auto grid__align_center grid__gap_medium">
								<div class="item">
									<span data-i18n="reason-for-mod-label">Reason for mod:</span>
								</div>
								<div class="item">
									<input type="text" name="attr_reason_for_mod" value="" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_reason_for_mod" />
								</div>
								<div class="item">
									<div class="standard-tooltip">
										<span data-i18n="role-label">Role</span>:
										<span class="tooltiptext">
											<span data-i18n="vehicle-crew-role-tooltip">Enter the role of the crew member.</span>
										</span>
									</div>
								</div>
								<div class="item">
									<input type="text" name="attr_role" value="" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_role" />
								</div>
								<div class="item">
									<span data-i18n="abbreviation-fatigued-current-max-label">FP (Current/Max)</span>:
								</div>
								<div class="item">
									<input type="number" name="attr_fatigue_points" value="10" min="0" step="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_fatigue_points" />
									<span>/</span>
									<input type="number" name="attr_fatigue_points_max" value="10" min="0" step="1" title="Macro: @{NAME|repeating_vehicle-crew-table_$[row #]_fatigue_points_max" />
									<input type="hidden" name="attr_fatigue_points_threshold" value="Fatigued at 3 or less." />
									<i><span name="attr_fatigue_points_threshold"></span></i>
								</div>
							</div>
							
						</div>
					</fieldset>
				</div>
				

			</div>

		</div>
	</div>

	<!-- ===== ===== ===== ===== VEHICLE LOADOUT TAB ===== ===== ===== ===== -->
	<div class="tab-vehicle-loadout">
		<div style="margin-bottom: 150px;">

			<!-- #column 1 -->
			<div class="grid-cell">

				<div class="tools-container bottom-margin-medium grid-standard">
					<div class="section-header bottom-margin-zero">
						<div class="grid-2-column-auto grid__align_center">
							<label class="sheet-toggle-button">
								<input type="checkbox" name="attr_toggle_vehicle_loadout_notes" value="1">
								<span></span>
							</label>
							<div class="standard-tooltip">
								<h4><span data-i18n="notes-label">Notes</span></h4>
								<span class="tooltiptext">
									<span data-i18n="vehicle-loadout-notes-tooltip">Enter additional notes about the vehicle loadout.</span>
								</span>
							</div>
						</div>
					</div>
					<input type="hidden" name="attr_toggle_vehicle_loadout_notes" />
					<div class="container-vehicle-notes">
						<textarea name="attr_vehicle_loadout_notes" title="Macro: @{NAME|vehicle_loadout_notes}"></textarea>
					</div>
				</div>

				<div class="tools-container bottom-margin-large grid-standard">

					<div class="section-header">
						<h3><span data-i18n="vehicle-maneuvering-status-interface-label">Vehicle Maneuvering and Status Interface</span></h3>
					</div>

					<div class="grid-vehicle-maneuvering-base-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="movement-label">Movement</span></b>
								<span class="tooltiptext">
									<span data-i18n="turning-velocity-movement-tooltip">Select movement type to determine turning radius and/or deceleration penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<b><span data-i18n="abbreviation-accuracy-label">Acc</span></b>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-percentage-label">Top %</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-top-speed-modification-percent-tooltip">Enter a percentage to modify the top speed of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-location-percentage-label">Loc %</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-cruising-speed-tooltip">The vehicle cruising speed, which is Top Speed times Cruise %. B463.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="fatigued-label">Fatigued</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-fatigued-tooltip">Check this box if the power souce, such as horses, has become fatigued. This will affect the Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="top-label">Top</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-calculated-top-speed-tooltip">The calculated Top Speed.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-start-velocity-label">Start Vel.</span></b>
								<span class="tooltiptext">
									<span data-i18n="start-velocity-tooltip">Enter velocity (yards/second) for current turn.<br /><b>Important:</b> Be sure to check your max allowed velocity based on movement type.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="change-in-velocity-label">Change</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="change-in-velocity-tooltip">Amount to accelerate or decelerate for the turn.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-final-velocity-label">Final Vel.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="final-velocity-tooltip">Final velocity. Current Velocity - Deceleration.<br />The final velocity is how you start the turn and is used to<br />calculate the deceleration penalty, turn radius, and tight turn penalty.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-deceleration-penalty-label">Decel. Pen.</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="deceleration-penalty-tooltip">Deceleration Skill penalty to DX roll or operation skill.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="turn-radius-label">Turn Radius</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="turn-radius-tooltip">The minimum distance in yards (hexes) the vehicle must travel to make a 90-degree turn. B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="tight-turn-label">Tight Turn</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="tight-turn-tooltip">Penalty to DX roll or operation skill for tight turns.</span>
								</span>
							</div>
						</div>
						
						<!-- input row -->
						<div class="grid-item">
							<select name="attr_vehicle_movement_type">
								<option value="Select" data-i18n="option-select">--Select--</option>
								<option value="Ground" data-i18n="option-ground">Ground</option>
								<option value="Air" data-i18n="option-air">Air</option>
								<option value="Water" data-i18n="option-water">Water</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_acceleration" value="0" title="Macro: @{NAME|vehicle_acceleration}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_top_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_top_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_location_speed_mod_percentage" value="0" title="Macro: @{NAME|vehicle_location_speed_mod_percentage}" />
						</div>
						<div class="grid-item">
							<input type="checkbox" name="attr_vehicle_fatigued" value="1" title="Macro: @{NAME|vehicle_fatigued}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_calculated_top_speed" value="0" title="Macro: @{NAME|vehicle_calculated_top_speed}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_start_velocity" value="0" title="Macro: @{NAME|vehicle_start_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_change_in_velocity" value="0" title="Macro: @{NAME|vehicle_change_in_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_final_velocity" value="0" title="Macro: @{NAME|vehicle_final_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_deceleration_penalty" value="0" title="Macro: @{NAME|vehicle_deceleration_penalty}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_turn_radius" value="0" title="Macro: @{NAME|vehicle_turn_radius}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_tight_turn_penalty" value="0" title="Macro: @{NAME|vehicle_tight_turn_penalty}" />
						</div>

					</div>

					<div class="grid-vehicle-status-fields grid__align_center grid__gap_small">
						<!-- Headers -->
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-health">HT</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-health-roll-tooltip">Vehicle Health Roll. <ul><li>If suffering a Major Wound.</li><li>To avoid catching fire, exploding, etc.</li><li>When reduced to zero or less HP.</li><li>Being used if HP is less than zero.</li><li>If -1xHP or -5xHP, HT Roll to avoid being destroyed.</li></ul></span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-hit-points-scale-label">HP Scale</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-hit-points-scale-tooltip">Select a HP Scale. B470. This will update the Hit Points to the right and the hit location armor.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<label>
								<div class="standard-tooltip">
									<b><span data-i18n="abbreviation-hit-points">HP</span></b>
									<span class="tooltiptext">
										<span data-i18n="vehicle-current-hit-points-tooltip">The current Hit Points of the vehicle, based on selected HP scale.</span>
									</span>
								</div>
							</label>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-major-label">MW</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-major-wound-tooltip">Major Wound threshold of the vehicle. If the vehicle suffers a major wound, GM may call for a HT roll. On a failure, one or more systems fail. B484.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span></b>
								<span class="tooltiptext">
									<span data-i18n="vehicle-size-modifier-tooltip">Vehicle's size modifier, B463.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-handling-label">Hnd</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-handling-tooltip">Vehicle Handling modifies Control Rolls, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="abbreviation-stability-rating-label">SR</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-stability-rating-tooltip">Vehicle Stability Rating determines if the failed Control Roll is a minor or major failure, B466.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="velocity-label">Velocity</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-velocity-tooltip">The current velocity if the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="altitude-label">Altitude</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-altitude-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="depth-label">Depth</span></b>
								<span class="tooltiptext move-left">
									<span data-i18n="vehicle-current-depth-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>
						<div class="grid-item">
							<div class="standard-tooltip">
								<b><span data-i18n="hit-point-effects-label">HP Effects</span></b>
								<span class="tooltiptext move-far-left">
									<span data-i18n="vehicle-hit-point-effects-tooltip">The current altitude of the vehicle.</span>
								</span>
							</div>
						</div>

						<!-- input fields -->
						<div class="grid-item">
							<input type="number" name="attr_vehicle_health_roll" value="0" title="Macro: @{NAME|vehicle_health_roll}" />
							<button type="action" name="act_roll_vehicle_health_roll" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Team Effort}} {{skillName=@{team_effort_skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{team_effort_final_level}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{team_effort_modifier}}} {{rollModifierSummary=@{team_effort_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}"></button>
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_scale" value="normal" />
							<select name="attr_vehicle_hit_point_scale">
								<option value="normal" data-i18n="option-normal" selected>Normal</option>
								<option value="d-scale" data-i18n="option-decade-scale">Decade Scale</option>
								<option value="c-scale" data-i18n="option-century-scale">Century Scale</option>
							</select>
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_hit_points" value="0" title="Macro: @{NAME|vehicle_hit_points}" />
							<span>/</span>
							<input type="number" name="attr_vehicle_hit_points_max" readonly value="0" title="Macro: @{NAME|vehicle_hit_points_max}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_major_wound_threshold" value="0" title="Macro: @{NAME|vehicle_major_wound_threshold}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_size_modifier" readonly value="0" title="Macro: @{NAME|vehicle_size_modifier}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_handling" value="0" readonly title="Macro: @{NAME|vehicle_handling}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_stability_rating" value="0" readonly title="Macro: @{NAME|vehicle_stability_rating}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_velocity" value="0" title="Macro: @{NAME|vehicle_current_velocity}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_altitude" value="0" title="Macro: @{NAME|vehicle_current_altitude}" />
						</div>
						<div class="grid-item">
							<input type="number" name="attr_vehicle_current_depth" value="0" title="Macro: @{NAME|vehicle_current_depth}" />
						</div>
						<div class="grid-item">
							<input type="hidden" name="attr_vehicle_hit_point_effects" value="Please remove" title="Macro: @{NAME|vehicle_hit_point_effects}" />
							<span name="attr_vehicle_hit_point_effects">1/2 move</span>
						</div>
						
					</div>

				</div>

				<!-- _____ _____ INVENTORY BOX _____ _____ -->

				<div class="box items">
					<div class="table">
						<div class="header">
							<div class="cell col0"><span data-i18n="inventory-label">Inventory</span></div>
							<div class="cell col-location">
								<div class="popup"><span data-i18n="location-label">Location</span></div>
								<div class="tooltip tooltip-spell-ref">
									<span data-i18n="inventory-location-tooltip">
		Where is the item located? If you entered a Parent ID in the expanded notes area, this field will be updated with the name of the parent inventory item.<br />
									</span>
								</div>	
							</div>
							<div class="cell col1"><span data-i18n="abbreviation-technology-level-label">TL</span></div>
							<div class="cell col1">
								<div class="popup"><span data-i18n="abbreviation-legality-class-label">LC</span></div>
								<div class="tooltip tooltip-spell-ref">
									<span data-i18n="legality-class-tooltip">
										Legality Class B267.
									</span>
								</div>
							</div>
							<div class="cell col2">
								<div class="popup"><span data-i18n="abbreviation-book-reference-label">Ref</span></div>
								<div class="tooltip tooltip-spell-ref">
									<span data-i18n="book-reference-tooltip">
										Reference to book and page numbers.<br />
										Examples:<br />
										B238 = GURPS Basic, Page 238<br />
										PU2:126 = Power-Ups 2. Page 126
									</span>
								</div>
							</div>
							<div class="cell col3">
								<div class="popup"><span data-i18n="on-label">On</span></div>
								<span class="tooltip">
									<span data-i18n="inventory-carried-tooltip">
										Carried<br />
										Is the item being carried at the moment?
									</span>
								</span>
							</div>
							<div class="cell col4">#</div>
							<div class="cell col5">$</div>
							<div class="cell col6">
								<input type="hidden" name="attr_weight_system" value="lbs" />
								<span name="attr_weight_system"></span>
							</div>
							<div class="cell col7">$+</div>
							<div class="cell col8">W+</div>
						</div>
						<fieldset class="repeating_item">
							<input class="toggle-highlight" type="checkbox" title="Check to highlight row" name="attr_highlight" />
							<input class="toggle toggle-notes" type="checkbox" title="Click to show/hide more information." name="attr_item_toggle_notes" />
							<span class="checkbox"></span>
							<div class="row row-stats">
								<div class="cell col0">
									<input type="hidden" class="indent-field" name="attr_indent_level" value="0" />
									<input type="text" class="field-to-indent" name="attr_name" title="Macro: @{NAME|repeating_item_$[row #]_name}" />
									<input type="hidden" name="attr_idkey" />
								</div>
								<div class="cell col-button">
									<button type="roll" name="roll_useitem" class="button-roll-template btn ui-draggable" value="&{template:macro} {{sheetStyle=@{chatstyle}}} {{templateType=dnd5e}} {{title=Use Item}} {{subtitle=@{name}}} {{desc=@{macro_content}}}"></button>
								</div>
								<div class="cell col-location">
									<input type="text" name="attr_location" title="Macro: @{NAME|repeating_item_$[row #]_location}" />
								</div>
								<div class="cell col1">
									<input type="text" name="attr_tl" title="Macro: @{NAME|repeating_item_$[row #]_tl}" />
								</div>
								<div class="cell col1">
									<input type="number" step="1" min="0" max="4" name="attr_legality_class" title="Macro: @{NAME|repeating_item_$[row #]_legality_class}" />
								</div>
								<div class="cell col2">
									<input type="text" name="attr_ref" title="Macro: @{NAME|repeating_item_$[row #]_ref}" />
								</div>
								<div class="cell col3">
									<input class="boolean" type="checkbox" name="attr_carried" value="1" checked title="Macro: @{NAME|repeating_item_$[row #]_carried}" />
								</div>
								<div class="cell col4">
									<input type="number" name="attr_count" value="1" title="Macro: @{NAME|repeating_item_$[row #]_count}" />
								</div>
								<div class="cell col5">
									<input type="number" name="attr_cost" value="0.00" step="0.01" title="Macro: @{NAME|repeating_item_$[row #]_cost}" />
								</div>
								<div class="cell col6">
									<input type="number" name="attr_weight" value="0.000" step="0.001" title="Macro: @{NAME|repeating_item_$[row #]_weight}" />
								</div>
								<div class="cell col7" style="text-align: right;background-color: #c9c9c9;border-bottom: 1px solid white;border-right: 1px solid white;">
									<span name="attr_costtotal" value="0.00" title="Macro: @{NAME|repeating_item_$[row #]_costtotal}" />
								</div>
								<div class="cell col8" style="text-align: right;background-color: #c9c9c9;border-bottom: 1px solid white;border-right: 1px solid white;">
									<input type="hidden" name="attr_carried" />
									<span name="attr_weighttotal" value="0.000" class="item-weight-total" title="Macro: @{NAME|repeating_item_$[row #]_weighttotal}" />
								</div>
							</div> <!-- .row -->
							<div class="row row-details notebox">

								<div class="row-misc">
									<div class="cell label">
										<div class="popup">
											<span data-i18n="row-id-label">Row ID:</span>
										</div>
										<span class="tooltip">
											<span data-i18n="inventory-row-id-tooltip">
		For inventory, the row id can used to link an inventory item to a parent item.<br />
		That means, if you uncheck the <b>ON</b> checkbox, all the child inventory items will also become unchecked.<br />
		You can use the row id with macros.
											</span>
										</span> 
									</div>
									<div class="cell">
										<input type="text" readonly="readonly" name="attr_row_id" value="" />
									</div>
								</div> <!-- .row -->

								<div class="row-misc">
									<div class="cell label">
										<div class="popup">
											<span data-i18n="parent-id-label">Parent ID</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="inventory-parent-id-tooltip">
		For inventory, the row id can used to link an inventory item to a parent item.<br />
		That means, if you uncheck the <b>ON</b> checkbox, all the child inventory items will also become unchecked.<br />
		You can use the row id with macros.
											</span>
										</span> 
									</div>
									<div class="cell">
										<input type="text" name="attr_parent_id" value="" />
									</div>
								</div> <!-- .row -->

								<div class="row-misc">
									<div class="cell label">
										<div class="popup">
											<span data-i18n="indent-label">Indent</span>:
										</div>
										<span class="tooltip">
											<span data-i18n="inventory-indent-tooltip">
		Select the indent level of the inventory item. This is handy to help show the item belongs to a parent item.
											</span>
										</span> 
									</div>
									<div class="cell">
										<select name="attr_indent_level">
											<option>0</option>
											<option>1</option>
											<option>2</option>
											<option>3</option>
											<option>4</option>
											<option>5</option>
											<option>6</option>									
										</select>
									</div>
								</div> <!-- .row -->

								<div class="cell col-notebox">
									<div class="show-notes">
										<span class="label">
											<span data-i18n="notes-label">Notes</span>
										</span>
									</div>
									<textarea name="attr_notes" title="Macro: @{NAME|repeating_item_$[row #]_notes}"></textarea>
								</div>

								<div class="cell col-notebox" style="display:none;">
									<div class="show-notes">
										<span class="label">
											<span data-i18n="macro-label">Macro</span>
										</span>
									</div>
									<textarea name="attr_macro" title="Macro: @{NAME|repeating_item_$[row #]_macro}">&{template:macro} {{templateType=dnd5e}} {{sheetStyle=4}} {{title=Use Item}} {{desc=@{macro_content}}}</textarea>
								</div>
								
								<div class="cell col-notebox">
									<div class="show-notes">
										<span class="label">
											<span data-i18n="macro-label">Macro Content</span>
										</span>
									</div>
									<textarea name="attr_macro_content" title="Macro: @{NAME|repeating_item_$[row #]_macro_content}"></textarea>
								</div>


							</div> <!-- .row -->
						</fieldset> <!-- .repeating_item -->
						<div class="sort-control">
							<button type="action" name="act_sort_inventory" class="btn sort">Sort & Indent</button>
							<div>
								<i>After sorting, please open/close the notes for one item. This will fix the weirdness caused by the Roll20 sorter.</i>
							</div>
						</div>
						<div class="row row-totals">
							<div class="cell col0">
								<div class="cell" style="width: 50px;">
									<div class="popup" style="font-weight: bold;">
										<span data-i18n="gravity-label">Gravity</span><span>:</span>
									</div>
									<div class="tooltip">
										<span data-i18n="gravity-tooltip">Standard gravity is based on 1G, earth normal.<br />If gravity is over 1G, then add <i>your</i> weight and encumbrance then multiply by Gravity - 1. Add this value to your encumbrance.<br />If gravity is less than 1G, multiply the weight of your gear by the Gravity value, this is your new encumbrance.<br />See B350.</span>
									</div>
								</div>
								<div class="cell" style="width: 35px;">
									<input type="number" value="1" step=".01" min=".01" name="attr_gravity" title="Macro: @{NAME|gravity}" />
								</div>
							</div>
							<div class="cell col1">
								<div style="text-align: right; font-weight: bold;" class="popup">
									<span data-i18n="total-inventory-value-label">Total Inventory Value:</span>
								</div>
								<div class="tooltip">
									<span data-i18n="total-inventory-value-tooltip">
										Total monetary value of all items (carried or not).
									</span>
								</div>
							</div>
							<div class="cell col2">
								<input type="number" style="font-weight: bold;" step=".01" name="attr_total_value" value="0" readonly="readonly" title="Macro: @{NAME|total_value}" />
							</div>
							<div class="cell col3">
								<div style="text-align: right; font-weight: bold;" class="popup">
									<span data-i18n="total-inventory-weight-label">Total Inventory Weight:</span>
								</div>
								<div class="tooltip">
									<span data-i18n="total-inventory-weight-tooltip">
										Total weight of all items carried.
									</span>
								</div>
							</div>
							<div class="cell col4">
								<input type="hidden" name="attr_total_weight" value="" />
								<input type="text" style="font-weight: bold; text-align: center;" name="attr_total_weight_gravity" value="" readonly="readonly" title="Macro: @{NAME|total_weight_gravity}" />
								<span name="attr_weight_system" class="inline"></span>
							</div>
							<div class="cell col5">
								<div style="text-align: right; font-weight: bold;" class="popup">
									<span data-i18n="grand-total-weight-label">Grand Total Weight:</span>
								</div>
								<div class="tooltip">
									<span data-i18n="grand-total-weight-tooltip">
										Grand total of PC's weight: <span style="background-color: white; font-weight: bold; text-decoration: underline;" name="attr_weight" value="0"></span>, and all items carried.
									</span>
								</div>
							</div>
							<div class="cell col6">
								<input type="hidden" name="attr_grand_total_weight" />
								<input type="text" style="font-weight: bold; text-align: center;" name="attr_grand_total_weight_display" value="0" readonly="readonly" title="Macro: @{NAME|grand_total_weight}" />

							</div>					
						</div> <!-- .row -->
					</div> <!-- .table -->
				</div> <!-- .box .items -->

			</div>

		</div>
	</div>

	<!-- ===== ===== ===== ===== TOOLS SHEET TAB ===== ===== ===== ===== -->
	<div class="tab-tools">
		
		<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
		<div class="tabbed">
			
			<!-- tabs -->
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="general" class="tab-control" checked />
				<span data-i18n="general-label">General</span>
			</label>
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="structural" class="tab-control" checked />
				<span data-i18n="structural-label">Structural</span>
			</label>
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="senses" class="tab-control" checked />
				<span data-i18n="senses-label">Senses</span>
			</label>
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="feats" class="tab-control" checked />
				<span data-i18n="feats-label">Feats</span>
			</label>
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="environmental" class="tab-control" checked />
				<span data-i18n="environmental-label">environmental</span>
			</label>
			<label class="tools-character">
				<input type="radio" name="attr_tool_tabs" value="macros" class="tab-control" />
				<span data-i18n="macros-label">Macros</span>
			</label>
		</div>

		<!-- tabbed section to display | value changes based on selected radio button -->
		<input type="hidden" name="attr_tool_tabs" value="general" />
		<div class="tabs options">
			
			<div class="options general" style="margin-bottom: 75px;">
				
				<div class="grid-standard grid-2-column-equal-width grid__gap_large">

					<div class="grid-cell">

						<div class="tools-container">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="team-effort-label">Team Effort</span></h3>
									<span class="tooltiptext">
										<span data-i18n="team-effort-tooltip">Group effort where skilled characters to cover for unskilled characters, such climbing, hiking, and group stealth. One roll is used for the entire team. B185.</span>
									</span>
								</div>
							</div>
							
							<div class="grid-team-efforts grid__gap_small grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="skill-label">Skill</span>:
											<span class="tooltiptext">
												<span data-i18n="team-effort-skill-tooltip">The name of the skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_team_effort_skill_name" />
								</div>
								
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="skill-level-label">Level</span>:
											<span class="tooltiptext">
												<span data-i18n="team-effort-highest-skill-tooltip">Use the person with the highest skill level, they must be leader.<br/>They should usually lead from the front and are able to communicate with others, at least using gestures.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_team_effort_starting_level" min="3" step="1" value="10" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="size-label">Size</span>:
											<span class="tooltiptext">
												<span data-i18n="team-effort-size-tooltip">The total number of characters participating in the team effort.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="number" min="1" step="1" name="attr_team_effort_group_size" value="4" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="has-skill-label">Has Skill</span>:
											<span class="tooltiptext">
												<span data-i18n="team-effort-has-skill-tooltip">The number of characters that have at least 1 CP into the skill. B185.</span>
											</span>
										</div>
									</label>	
								</div>
								<div>
									<input type="number" min="1" step="1" name="attr_team_effort_knows_skill" value="1" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="final-skill-level-label">Final Level</span>:
											<span class="tooltiptext">
												<span data-i18n="team-effort-final-skill-level-tooltip">The final skill level based on group size, number of characters that know the skill, and starting skill level.</span>
											</span>
										</div>
									</label>
								</div>

								<div class="grid-cell">
									<input type="hidden" name="attr_team_effort_modifier" value="0" />
									<input type="hidden" name="attr_team_effort_modifier_description" value="" />
									<input type="number" name="attr_team_effort_final_level" readonly="readonly" class="input-disabled" value="10" />
									<button type="action" name="act_roll_skill_team_effort" class="button-roll-template btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Team Effort}} {{skillName=@{team_effort_skill_name}}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{team_effort_final_level}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{team_effort_modifier}}} {{rollModifierSummary=@{team_effort_modifier_description}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}}" ></button>
								</div>
							
							</div>

						</div>
						
					</div>

					<div class="grid-cell">
						
						<div class="tools-container">
							
							<div class="section-header">
								<h3><span data-i18n="extra-effort-label">Extra Effort</span></h3>
							</div>
							
							<div class="grid-team-efforts grid__gap_small grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="modifier-label">Modifier:</span>
											<span class="tooltiptext">
												<span data-i18n="extra-effort-will-modifier-tooltip">To perform extra effort, as described on B356-357, requires a will roll at -1 per 5% increase to an attribute.<br />For specific physical tasks,use the relavant skill as a Will-based roll, if that would be better. Example; Jumping (Will instead of DX).</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_extra_effort_will_modifier" value="0" max="0" step="1" />
									<input type="hidden" name="attr_extra_effort_display_percentage" value="0" />
									+<span name="attr_extra_effort_display_percentage"></span>%
								</div>
								
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="fatigued-modifier-label">Fatigued Modifier</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="extra-effort-fatigued-tooltip">If your character is less than one third of your Fatigue Points, then you are fatigued. Apply a penalty of your Max Fatigue - Current Fatigue as a negative penalty.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_extra_effort_fatigue_modifier" max="0" step="1" value="0" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="motivated-label">Motivated</span>:
											<span class="tooltiptext">
												<span data-i18n="extra-effort-motivated-tooltip">+5 to Will if Motivated! Fear, anger, concern for loved one, etc. Usually requires a failed Fright Check, failed self-control roll, victim of a successful intimidation. GM decision, see B357.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="checkbox" name="attr_extra_effort_motivated" value="1" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="final-modifier-label">Final Modifier</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="extra-effort-final-modifier-tooltip">The final modifier for the will roll. Fatigue Point Cost see B357. <ul><li>1 FP per instantaneous action.</li><li>1 FP per hour for digging.</li><li>1 FP per day for hiking.</li><li>1 FP per minute for lifting/moving and swimming.</li><li>1 FP per 15 seconds for running.</li></ul></span>
											</span>
										</div>
									</label>	
								</div>
								<div>
									<input type="number" name="attr_extra_effort_final_modifier" readonly="readonly" value="0" class="input-disabled" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="attribute-label">Attribute</span>:
											<span class="tooltiptext">
												<span data-i18n="extra-effort-attribute-tooltip">The attribute that you're trying to improve upon.<br /><b>Throwing:</b> Can increase ST for both damage and distance, but it does NOT impact Basic Lift. You will need to make a separate extra-effort lifting roll to increase basic lift.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_extra_effort_attribute" class="medium-width" min="0" step="1" value="0" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="adjusted-attribute-label">Adjusted Attribute</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="extra-effort-adjusted-attribute-tooltip">Adjusted Attributed based on the initial Will Modifier, +5% per -1 to Will Modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_extra_effort_adjusted_attribute" class="input-disabled medium-large-width" readonly="readonly" value="0" />
								</div>
							
							</div>

						</div>	
						
					</div>

					<div class="grid-cell">
						<div class="tools-container" style="margin-bottom: 150px;">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="drinking-intoxication-label">Drinking and Intoxication</span></h3>
									<span class="tooltiptext">
										<span data-i18n="drinking-intoxication-tooltip">Tool based on Drinking and Intoxication from B439.</span>
									</span>
								</div>
							</div>

							<div class="grid-standard grid-4-column-auto grid__align_center grid__gap_medium">

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="drinks-label">Drinks</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-drinks-tooltip">Enter the number of drinks consumed. B439.<br />One drink is equal to...<ul><li>12 oz beer</li><li>5 oz glass of wine</li><li>1.5 oz shot of spirits</li></ul></span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_drinks_consumed" value="0" min="0" />
								</div>
								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="total-drinks-label">Total Drinks</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-total-drinks-tooltip">Enter the total number of drinks consumed during this session, used with the sobering up rules. B439.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_total_drinks_consumed" value="0" min="0" />
								</div>
								
								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-strength">ST</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-strength-score-tooltip">Enter the character's Strength (ST) level, this determines the modifier to the skill check. -1 skill per drink over ST/4. Basic 439.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_strength_level" value="10" min="1" step="1" />
								</div>
								<div class="grid-item"></div>
								<div class="grid-item"></div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="level-label">Level</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-base-skill-level-tooltip">Enter the base skill level to use for drinking and Intoxication. Either the Health (HT) score or Carousing skill level.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_base_skill_level" value="10" min="0" step="1" />
								</div>
								<div class="grid-item"></div>
								<div class="grid-item"></div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="modifier-label">Modifier</span>
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-base-skill-level-modifier-tooltip">Enter a custom modifier for the base skill level for drinking and Intoxication.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_base_skill_level_modifier" value="0" step="1" />
								</div>
								<div class="grid-item"></div>
								<div class="grid-item"></div>	

							</div>

							<div class="grid-standard grid-2-column-equal-width grid__align_center grid__gap_medium">

								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_eaten" value="eaten" checked />
										<span data-i18n="has-eaten-label">Has Eaten +0</span>
									</label>
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_eaten" value="recently" />
										<span data-i18n="recently-eaten-label">Recently Eaten +1</span>
									</label>
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_eaten" value="empty" />
										<span data-i18n="empty-stomach-label">Empty Stomach -2</span>
									</label>
								</div>

								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_perk" value="none" checked />
										<span data-i18n="no-perk-label">No perk +0</span>
									</label>
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_perk" value="tolerant" />
										<span data-i18n="alcohol-tolerance-label">Alchohol Tolerance +2</span>
									</label>
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_perk" value="intolerant" />
										<span data-i18n="alchohol-intolerance-label">Alchohol Tolerance -2</span>
									</label>
								</div>

							</div>

							<div class="grid-standard grid-2-column-auto grid__align_center grid__gap_medium">
								<div class="grid-item">
									<div class="container-label-input grid__gap_small grid__align_center">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="roll-label">Roll:</span>
												<span class="tooltiptext">
													<span data-i18n="drinking-intoxication-roll-tooltip">After every hour of drinking, roll the dice to check for drinking and intoxication results.</span>
												</span>
											</div>
										</label>
										<input type="number" name="attr_drinking_intoxication_roll" readonly="readonly" class="input-disabled" value="10" />
									</div>
								</div>
								<div class="grid-item">
									<div class="container-label-input grid__gap_small grid__align_center">
										<input type="hidden" name="attr_drinking_intoxication_should_roll" value="0" />
										<input type="hidden" name="attr_drinking_intoxication_skill_total_modifier" value="" />
										<input type="hidden" name="attr_drinking_intoxication_skill_modifier_summary" value="" />
										<span class="drinking-intoxication-health-roll">
											<button type="action" name="act_roll_skill_drinking" class="button-roll-template btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Check}} {{activeDefense=[[0]]}} {{showSuccessLabel=[[1]]}} {{isSkillRoll=[[1]]}} {{characterName=Drinking}} {{skillName=Drinking and Intoxication}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{drinking_intoxication_roll}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{drinking_intoxication_skill_total_modifier}}} {{rollModifierSummary=@{drinking_intoxication_skill_modifier_summary}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{showRawDefenseNotes=[[1]]}} {{rawFailNote=Shift sobriety level to the right one spot.}} {{rawCriticalFailNote=Shift sobriety level to the right two spots. If effective skill is two or less, shift three levels!}}"></button>
											<span data-i18n="per-hour-label">per hour</span>
										</span>
										<span class="drinking-intoxication-no-health-roll">
											<span data-i18n="no-roll-needed-label">No roll needed</span>
										</span>
									</div>
								</div>
							</div>

							<div>
								<div class="standard-tooltip">
									<h4><span data-i18n="sobriety-level-label">Sobriety Level</span></h4>
									<span class="tooltiptext">
										<span data-i18n="drinking-intoxication-sobriety-level-tooltip">Track the character's current sobriety level.</span>
									</span>
								</div>
							</div>

							<div class="grid-standard grid-5-column-auto-repeat grid__align_center grid__gap_medium">

								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_state" value="sober" checked />
										<span data-i18n="sober-option">Sober</span>
									</label>
								</div>
								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_state" value="tipsy" />
										<span data-i18n="tipsy-option">Tipsy</span>
									</label>
								</div>
								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_state" value="drunk" />
										<span data-i18n="drunk-option">Drunk</span>
									</label>
								</div>
								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_state" value="unconscious" />
										<span data-i18n="unconscious-option">Unconscious</span>
									</label>
								</div>
								<div class="grid-item">
									<label class="container-label-input grid__gap_small">
										<input type="radio" name="attr_drinking_intoxication_state" value="coma" />
										<span data-i18n="coma-option">Coma</span>
									</label>
								</div>
							</div>

							<div>
								<input type="hidden" name="attr_drinking_intoxication_state_description" value="You're sober." />
								<span name="attr_drinking_intoxication_state_description"></span>
							</div>

							<div>
								<div class="standard-tooltip">
									<h4><span data-i18n="stop-drinking-checks-label">Stop Drinking Checks</span></h4>
									<span class="tooltiptext">
										<span data-i18n="drinking-intoxication-stop-drinking-checks-tooltip">After you stop drinking, check for hangovers and recovery.</span>
									</span>
								</div>
							</div>

							<div class="grid-standard grid-3-column-auto grid__align_center grid__gap_medium">

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-health">HT</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-sobering-up-health">Enter the character's Health (HT).</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_sobering_up_health" value="10" min="1" step="1" />
								</div>
								<div class="grid-item"></div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="hangover-label">Hangover</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-hangover-roll-tooltip">After you stop drinking, check to see if you will suffer a hangover.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_hangover_roll_modifier" value="0" step="1" />
									<input type="hidden" name="attr_drinking_intoxication_hangover_roll_modifier_summary" value="" />
									<input type="number" name="attr_drinking_intoxication_hangover_roll" readonly="readonly" class="input-disabled" value="10" />
								</div>
								<div class="grid-item">
									<div class="container-label-input grid__gap_small grid__align_center">
										<button type="action" name="act_roll_skill_hangover" class="button-roll-template btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Check}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Stop Drinking Checks}} {{skillName=Hangover Check}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{drinking_intoxication_hangover_roll}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{drinking_intoxication_hangover_roll_modifier}}} {{rollModifierSummary=@{drinking_intoxication_hangover_roll_modifier_summary}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{showRawDefenseNotes=[[1]]}} {{rawFailNote=Suffer a hangover. Kicks in [[1d6]] hours after the end of the drinking session or on awakening if you pass out or fall asleep before this time. Hangover lasts by the margin failure in hours. During this time, you will suffer moderate pain, see B428, and acquire Low Pain Threshold or lose Hight Pain Threshold.}}"></button>
										<span data-i18n="tipsy-or-worse-label">tipsy or worse.</span>
									</div>
								</div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="sober-up-label">Sober Up</span>:
											<span class="tooltiptext">
												<span data-i18n="drinking-intoxication-sober-up-roll-tooltip">After you stop drinking, roll to start recovering.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-item">
									<input type="number" name="attr_drinking_intoxication_sober_up_roll_modifier" value="0" step="1" />
									<input type="hidden" name="attr_drinking_intoxication_sober_up_roll_modifier_summary" value="" />
									<input type="number" name="attr_drinking_intoxication_sober_up_roll" readonly="readonly" class="input-disabled" value="10" />
								</div>
								<div class="grid-item">
									<div class="container-label-input grid__gap_small grid__align_center">
										<input type="hidden" name="attr_drinking_intoxication_sober_up_hours" value="1" />
										<button type="action" name="act_roll_skill_sober_up" class="button-roll-template btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Check}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Stop Drinking Checks}} {{skillName=Sobering Up}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{drinking_intoxication_sober_up_roll}]]}} {{showNotes=[[1]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{rollModifier=@{drinking_intoxication_sober_up_roll_modifier}}} {{rollModifierSummary=@{drinking_intoxication_sober_up_roll_modifier_summary}}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[1]]}} {{showRawDefenseNotes=[[1]]}} {{rawSuccessNote=Move one step to the left on the sobriety level.}}"></button>
										<span class="sober-hours-description">
											<span data-i18n="sober-after-label">after</span>
											<span name="attr_drinking_intoxication_sober_up_hours"></span>
											<span data-i18n="sober-hours-label">hours</span>
										</span>
									</div>
								</div>
							</div>

						</div>
					</div>

				</div>

			</div>

			<div class="options structural" style="margin-bottom: 100px;">
				
				<div class="grid-standard grid-2-column-equal-width grid__gap_large">

					<div class="grid-cell">

						<div class="tools-container">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="damage-to-objects-label">Damage to Objects</span></h3>
									<span class="tooltiptext">
										<span data-i18n="damage-to-objects-tooltip">This tool is based on the rules starting at B483.</span>
									</span>
								</div>
							</div>
							
							<div class="grid-damage-to-objects-measurements grid__align_center">

								<!-- row #1 size -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="measure-label">Measure</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-measure-tooltip">Enter the largest linear measurement of the object. For example, a 2x4 is 4 feet long, so enter 4.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number"  name="attr_object_measure" value="1" min="0" />
									<select name="attr_object_measure_unit">
										<option value="inch" data-i18n="inches-option">Inches</option>
										<option value="feet" data-i18n="feet-option">Feet</option>
										<option value="yards" data-i18n="yards-option" selected>Yards</option>
										<option value="meters" data-i18n="meters-option">Meters</option>
									</select>
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-size-modifier-tooltip">Size Modifier based on the largest linear measurement of the object. B550.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" readonly name="attr_object_size_modifier" class="input-disabled" value="0" />
								</div>

								<!-- row #2 material -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="material-label">Material</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-material-tooltip">The material determines the Damage Resistance. B483.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<select name="attr_object_material">
										<option value="wooden-plastic" data-i18n="wooden-plastic-option">Wooden/Plastic</option>
										<option value="small-metal" data-i18n="small-metal-option">Small metal</option>
										<option value="metal-wood" data-i18n="metal-wood-option" selected>Metal-wood (gun)</option>
										<option value="composite" data-i18n="composite-option">Composite (axe)</option>
										<option value="solid-metal" data-i18n="solid-metal-option">Solid metal (crowbar)</option>
										<option value="quarter-inch-armor" data-i18n="quarter-inch-armor-option">1/4" mild steel armor</option>
									</select>
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-damage-resistance-label">DR</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-size-damage-resistance-tooltip">Modify as needed, see HP and DR of structures on B558 for additional options.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_damage_resistance" value="4" />
								</div>

								<!-- row #3 injury tolerance -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="tolerance-label">Tolerance</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-injury-tolerance-tooltip">The injury tolerance is used to determine the object's Hit Points. B483.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<select name="attr_object_injury_tolerance">
										<option value="unliving" data-i18n="unliving-option">Unliving (complex machines)</option>
										<option value="homogenous" data-i18n="homogenous-option" selected>Homogenous (weapons)</option>
										<option value="diffuse" data-i18n="diffuse-option">Diffuse (nets, mattresses)</option>
									</select>
								</div>
								<div class="grid-cell">&nbsp;</div>
								<div class="grid-cell">&nbsp;</div>

							</div><!-- end grid -->

							<div class="grid-damage-to-objects-attributes grid__align_center">
								
								<!-- row #1 Health-->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="health-label">Health</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-health-tooltip">The health of the object based on Injury Tolerance and the modifier. B483.<ul><li>HT 10, most machines</li><li>HT 12, homogenous objects.</li></ul></span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" readonly name="attr_object_health" class="input-disabled" value="12" />
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-modifier-label">Mod</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-health-mod-tooltip">Enter the modifier to the base health. B483.<ul><li>Cheap, temperamental, or poorly maintained items are -1 to -3</li><li>Well-made or rugged objects get +1 or +2.</li></ul></span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_health_mod" value="0" step="1" />
									<button type="action" name="act_roll_attribute_object_health" class="button-roll-template btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Damage to Objects}} {{skillName=Object Health Check}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{object_health}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
								</div>
								
								<!-- row #2 Weight -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="weight-label">Weight</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-weight-tooltip">The weight of the object, which is used to determine the base Hit Points. B483.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" min="0" name="attr_object_weight" value="1" />
									<input type="hidden" name="attr_object_hit_points_multiplier" value="4" />
									<select name="attr_object_weight_units">
										<option value="pounds" data-i18n="pounds-option" selected>Pounds</option>
										<option value="kilograms" data-i18n="kilograms-option">Kilograms</option>
									</select>
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-base-hit-points-label">Base HP</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-base-hit-points-tooltip">The calculated base hit points. B483.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_base_hit_points" value="10" readonly class="input-disabled" />
								</div>

								<!-- row #3 max hit points -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-max-hit-points-label">Max HP</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-max-hit-points-tooltip">Base Hit Points plus modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_object_hit_points_realing_threshold" value="3" />
									<input type="hidden" name="attr_object_hit_points_destroyed" value="-50" />
									<input type="hidden" name="attr_object_hit_points_destroyed_thresholds" value="-10, -20, -30, -40" />
									<input type="number" name="attr_object_hit_points_max" value="10" readonly class="input-disabled" />
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-modifier-label">Mod</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-max-hit-points-mod-tooltip">Modifier to the base Hit Points.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_hit_points_mod" value="0" step="1" />
								</div>

								<!-- row #3 current hit points -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="current-hit-points-label">Current HP</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-current-hit-points-tooltip">If needed, help track an objects current hit points.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_hit_points" value="10" step="1" />
								</div>
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-major-label">MW</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-major-wound-tooltip">The number of points needed to cause a major wound to the object.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_object_major_wound" value="6" readonly class="input-disabled" />
								</div>
								
							</div><!-- end grid -->

							<div class="grid-damage-to-objects-checkboxes grid__align_center">

								<div class="grid-cell">
									<label>
										<input type="checkbox" name="attr_object_is_brittle" value="1" />
										<div class="standard-tooltip">
											<span data-i18n="brittle-label">Brittle</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-brittle-tooltip">Brittle</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<label>
										<input type="checkbox" name="attr_object_is_combustible" value="1" />
										<div class="standard-tooltip">
											<span data-i18n="combustible-label">Combustible</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-combustible-tooltip">Combustible</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell final-two-columns">
									<label>
										<input type="checkbox" name="attr_object_is_explosive" value="1" />
										<div class="standard-tooltip">
											<span data-i18n="explosive-label">Explosive</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-explosive-tooltip">Explosive</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<label>
										<input type="checkbox" name="attr_object_is_flammable" value="1" />
										<div class="standard-tooltip">
											<span data-i18n="flammable-label">Flammable</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-flammable-tooltip">Flammable</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell final-three-columns">
									<label>
										<input type="checkbox" name="attr_object_is_unnatural" value="1" />
										<div class="standard-tooltip">
											<span data-i18n="unnatural-label">Unnatural</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-unnatural-tooltip">Unnatural</span>
											</span>
										</div>
									</label>
								</div>

							</div><!-- end grid -->

							<div class="grid-2-column-auto grid__align_center">
								<label class="sheet-toggle-button">
									<input type="checkbox" name="attr_toggle_injury_effects" value="1">
									<span></span>
								</label>
								<h4><span data-i18n="effects-of-injury-label">Effects of Injury</span></h4>
							</div>

							<input type="hidden" name="attr_toggle_injury_effects" />
							<div class="grid-damage-to-objects-injury-effects">

								<input type="hidden" name="attr_object_injury_tolerance" />
								<div class="grid-cell injury-tolerance unliving">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="unliving-label">Unliving</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-unliving-tooltip">Unliving</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell injury-tolerance unliving">
									<span data-i18n="injury-tolerance-unliving-description">Unliving are less vulnerable to impaling and piercing damage. B380. Impaling and huge piercing modifiier x1; large piercing, x1/2; piercing, x1/3; and small piercing, x1/5.</span>
								</div>

								<div class="grid-cell injury-tolerance homogenous">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="homogenous-label">Homogenous</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-homogenous-tooltip">Things that lack vulnerable internal parts or mechanisms, such as solid or hollow objects., unpowered vehicles, trees, walls, etc. B380.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell injury-tolerance homogenous">
									<span data-i18n="injury-tolerance-homogenous-description">Impaling and huge piercing modifiier x1/2; large piercing, x1/3; piercing, x1/5; and small piercing, x1/10.</span>
								</div>

								<div class="grid-cell injury-tolerance diffuse">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="diffuse-label">Diffuse</span>
											<span class="tooltiptext">
												<span data-i18n="damage-to-objects-diffuse-tooltip">Swarms, air elementals, nets, etc.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell injury-tolerance diffuse">
									<span data-i18n="injury-tolerance-diffuse-description">Impaling and piercing attacks never do more than 1 HP! Other attacks can't do more than 2 HP. <i>Exception:</i> Area-effect, cone, and explosion cause normal damage. B380.</span>
								</div>

								<input type="hidden" name="attr_object_is_brittle" />
								<div class="grid-cell fragile brittle">
									<label><span data-i18n="brittle-label">Brittle</span></label>
								</div>
								<div class="grid-cell fragile brittle">
									<span data-i18n="fragile-object-brittle-description">If limb/extremity is crippled, it breaks off! Roll vs HT, on success it is one piece, otherwise it shatters/liquefies. If HT roll to avoid death fails, object is instantly destroyed. B136.</span>
								</div>

								<input type="hidden" name="attr_object_is_combustible" />
								<div class="grid-cell fragile combustible">
									<label><span data-i18n="combustible-label">Combustible</span></label>
								</div>
								<div class="grid-cell fragile combustible">
									<span data-i18n="fragile-object-combustible-description">On a Major Wound from a burning or explosive attack, roll vs HT to avoid catching fire. If the burning/explosive attack does 10 + HP of object, object is on fire. Burning objects suffer 1d6-1 burn damage per second until extinguished. B136.</span>
								</div>

								<input type="hidden" name="attr_object_is_explosive" />
								<div class="grid-cell fragile explosive">
									<label><span data-i18n="explosive-label">Explosive</span></label>
								</div>
								<div class="grid-cell fragile explosive">
									<span data-i18n="fragile-object-explosive-description">On any critical failure HT roll due to a Major Wound, object explodes. If object fails HT roll vs Death, it explodes. Damage is 6dx(HP/10) crushing explosion. B136.</span>
								</div>

								<input type="hidden" name="attr_object_is_flammable" />
								<div class="grid-cell fragile flammable">
									<label><span data-i18n="flammable-label">Flammable</span></label>
								</div>
								<div class="grid-cell fragile flammable">
									<span data-i18n="fragile-object-flammable-description">On any Major Wound, roll vs HT; -3 if burning/explosive attack, -3 if vitals were struck, -6 if both. On failure start burning for 1d6-1 burn damage per second. If burning, any failed Death roll will cause an explosion, 6dx(HP/10) crushing explosion. If object is Combustible, any burning or explosive attack that inflicts either a major wound or 10 + HP will automatically set object ablaze.  B136.</span>
								</div>

								<input type="hidden" name="attr_object_is_unnatural" />
								<div class="grid-cell fragile unnatural">
									<label><span data-i18n="unnatural-label">Unnatural</span></label>
								</div>
								<div class="grid-cell fragile unnatural">
									<span data-i18n="fragile-object-unnatural-description">Automatically fail Death roll at -HP, that much damage severs object from the force that animates it. B136.</span>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="shock-label">Shock</span></label>
								</div>
								<div class="grid-cell">
									<span data-i18n="object-shock-description">Damage can disrupt functionality, apply usual shock damage to any use of the object, GM discretion. B483.</span>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="major-wound-label">Major Wound</span></label>
								</div>
								<div class="grid-cell">
									<span data-i18n="object-major-wound-description">When a machine with many subsystems suffers a major wound, roll vs HT. On a failure, one or more systems fail. B483.</span>
								</div>

								<div class="grid-cell">
									<label>1 - <span name="attr_object_hit_points_realing_threshold"></span> <span data-i18n="abbreviation-hit-points">HP</span></label>
								</div>
								<div class="grid-cell">
									<span data-i18n="object-badly-damaged-description">Artifact suffers halved effectiveness, at the GM's discretion. B483.</span>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="zero-less-hit-points-label">0 or less HP</span></label>
								</div>
								<div class="grid-cell">
									<span data-i18n="object-stressed-description">Each second object is under stress, roll vs HT. On a failure, object suffers severe malfunction and is disabled. B483.</span>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="destroy-check-label">Destroy Check</span></label>
								</div>
								<div class="grid-cell">
									<span name="attr_object_hit_points_destroyed_thresholds"></span> <span data-i18n="abbreviation-hit-points">HP</span><br />
									<span data-i18n="object-destroy-check-description">At each HP level listed, roll vs HT, on a failure the object is destroyed. B483.</span>
								</div>

								<div class="grid-cell">
									<label><span name="attr_object_hit_points_destroyed"></span> <span data-i18n="abbreviation-hit-points">HP</span></label>
								</div>
								<div class="grid-cell">
									<span data-i18n="object-destroyed-description">At the listed HP level, object is destroyed. B483.</span>
								</div>

							</div>

						</div>
						
					</div>

					<div class="grid-cell">
						
						<div class="tools-container">

							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="repairs-label">Repairs</span></h3>
									<span class="tooltiptext">
										<span data-i18n="repairs-tooltip">Repairing and maintaining objects based on rules from B484 to B485.</span>
									</span>
								</div>
							</div>

							<div class="grid-standard grid-2-column-auto grid__gap_large">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="repair-type-label">Repair Type</span>
											<span class="tooltiptext">
												<span data-i18n="repair-type-tooltip">Repair type.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_type">
											<option value="minor" data-i18n="minor-repair-option" selected>Minor Repair</option>
											<option value="major" data-i18n="major-repair-option">Major Repair</option>
										</select>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="object-cost-label">Object Cost</span>
											<span class="tooltiptext">
												<span data-i18n="object-cost-tooltip">Object cost.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_object_cost">
											<option value="one-thousand" data-i18n="cost-one-thousand-option" selected>$1,000 or less (+1)</option>
											<option value="ten-thousand" data-i18n="cost-under-ten-thousand-option">$1,001 to $10,000 (0)</option>
											<option value="one-hundred-thousand" data-i18n="cost-under-one-hundred-thousand-option">$10,001 to $100,000 (-1)</option>
											<option value="one-million" data-i18n="cost-under-one-million-option">$100,001 to $1,000,000 (-2)</option>
											<option value="over-one-million" data-i18n="cost-over-one-million-option">$1,000,001+ (-3)</option>
										</select>
									</div>
								</div>

							</div>

							<input type="hidden" name="attr_repair_type" />
							<div class="repair-type-description minor-repair">
								<span data-i18n="minor-repair-description">Object must have a 1 or more hit points remaining. Each successful repair attempt restores 1 HP plus margin of success.</span>
							</div>

							<div class="repair-type-description major-repair">
								<span data-i18n="major-repair-description">Object has zero or negative hit points. Requires spare parts at a cost 1d6 x 10% of the original price of the object. Each successful repair attempt restores 1 HP plus margin of success.</span>
							</div>

							<div class="grid-standard grid-repairs-equipment grid__gap_large grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="equipment-label">Equipment</span>
											<span class="tooltiptext">
												<span data-i18n="repair-equipment-tooltip">Equipment modifiers. B345.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_equipment">
											<option value="no-equipment-tech" data-i18n="repair-no-equipment-tech-option">None, technical skill (-10)</option>
											<option value="no-equipment" data-i18n="repair-no-equipment-option">None, non-technical skill (-5)</option>
											<option value="improvised-tech" data-i18n="repair-improvised-tech-option">Improvised, technical skill (-5)</option>
											<option value="improvised" data-i18n="repair-improvised-option">Improvised, non-technical skill (-2)</option>
											<option value="basic" data-i18n="repair-basic-option" selected>Basic equipment (0)</option>
											<option value="good" data-i18n="repair-good-option">Good-quality equipment (+1)</option>
											<option value="fine" data-i18n="repair-fine-option">Fine-quality equipment (+2)</option>
											<option value="best" data-i18n="repair-best-option">Best equipment (+3)</option>
										</select>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="missing-label">Missing</span>
											<span class="tooltiptext move-left">
												<span data-i18n="repair-missing-equipment-tooltip">Enter the number of missing equipment. Each missing item is -1 to repair skill.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_repair_missing_equipment" value="0" min="0" step="1" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="damaged-label">Damaged</span>
											<span class="tooltiptext move-far-left">
												<span data-i18n="repair-damaged-equipment-tooltip">Damaged equipment modifiers. B345.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_damaged_equipment">
											<option value="0" selected>0</option>
											<option value="-1">-1</option>
											<option value="-2">-2</option>
											<option value="-3">-3</option>
										</select>
									</div>
								</div>

							</div>

							<div class="grid-standard grid-repairs-times grid__gap_large">

								<div class="grid-cell">
									<label><span data-i18n="base-time-label">Base Time</span></label>
									<div>
										<span>30 minutes</span>
									</div>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="final-time-label">Final Time</span></label>
									<div>
										<input type="hidden" name="attr_repair_final_time" value="30" />
										<span name="attr_repair_final_time">30</span> <span data-i18n="minutes-label">minutes</span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="extra-time-label">Extra Time</span>
											<span class="tooltiptext move-left">
												<span data-i18n="repair-extra-time-tooltip">Spend extra time to get a skill bonus. B346.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_extra_time">
											<option value="1" data-i18n="repair-extra-time-normal-option" selected>Normal</option>
											<option value="2" data-i18n="repair-extra-time-twice-option">2x (+1)</option>
											<option value="4" data-i18n="repair-extra-time-four-times-option">4x (+2)</option>
											<option value="8" data-i18n="repair-extra-time-eight-times-option">8x (+3)</option>
											<option value="15" data-i18n="repair-extra-time-fifteen-times-option">15x (+4)</option>
											<option value="30" data-i18n="repair-extra-time-thirty-times-option">30x (+5)</option>
										</select>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="haste-label">Haste</span>
											<span class="tooltiptext move-far-left">
												<span data-i18n="repair-haste-tooltip">Decrease the amount of time at a penalty to skill. B346.</span>
											</span>
										</div>
									</label>
									<div>
										<select name="attr_repair_haste">
											<option value="0" data-i18n="repair-haste-normal-option" selected>Normal</option>
											<option value="10" data-i18n="repair-haste-10-option">-10% (-1)</option>
											<option value="20" data-i18n="repair-haste-20-option">-20% (-2)</option>
											<option value="30" data-i18n="repair-haste-30-option">-30% (-3)</option>
											<option value="40" data-i18n="repair-haste-40-option">-40% (-4)</option>
											<option value="50" data-i18n="repair-haste-50-option">-50% (-5)</option>
											<option value="60" data-i18n="repair-haste-60-option">-60% (-6)</option>
											<option value="70" data-i18n="repair-haste-70-option">-70% (-7)</option>
											<option value="80" data-i18n="repair-haste-80-option">-80% (-8)</option>
											<option value="90" data-i18n="repair-haste-90-option">-90% (-9)</option>
										</select>
									</div>
								</div>

							</div>

							<div class="grid-standard grid-repairs-skill grid__gap_large">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="skill-label">Skill</span>
											<span class="tooltiptext">
												<span data-i18n="repair-skill-tooltip">Enter the skill level for the repair. An NPC can be hired for about $20 per hour with a skill of 9 + 1d6. B485.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_repair_skill" value="10" min="0" step="1" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-modifier-label">Mod</span>
											<span class="tooltiptext">
												<span data-i18n="repair-skill-modifiers-tooltip">The final modifier total based on Object Cost, Equipment quality, Missing equipment, Damaged equipment, Extra Time, and Haste.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_repair_skill_modifier" value="0" readonly class="input-disabled" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="custom-label">Custom</span>
											<span class="tooltiptext move-left">
												<span data-i18n="repair-skill-custom-modifier-tooltip">Enter a custom modifier.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_repair_skill_custom_modifier" value="10" min="0" step="1" />
									</div>
								</div>

								<div class="grid-cell">
									<label><span data-i18n="final-skill-label">Final Skill</span></label>
									<div>
										<input type="number" name="attr_repair_skill_final" value="10" readonly class="input-disabled" />
										<button type="action" name="act_roll_skill_object_repair" class="button-roll-template btn ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Repairs}} {{skillName=Repair object}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{repair_skill_final}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
									</div>
								</div>

							</div>

						</div>
						
					</div>

					<div class="grid-cell">
						<div class="tools-container">

							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="breaking-bindings-label">Breaking Bindings</span></h3>
									<span class="tooltiptext">
										<span data-i18n="breaking-bindings-tooltip">Breaking bindings tool based on rules from GURPS Low Tech 130.</span>
									</span>
								</div>
							</div>

							<div class="grid-standard grid-3-column-auto grid__align_center grid__gap_large">
								
								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="supports-label">Supports</span>
											<span class="tooltiptext">
												<span data-i18n="breaking-bindings-supports-tooltip">Enter how much the binding material can support. For example, a 1" hemp rope can support 2,000 pounds.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="hidden" name="attr_binding_supports_weight_pounds" value="2000" />
										<input type="number" name="attr_binding_supports_weight" class="large-width" value="2000" min="0" step="1" title="Macro: @{NAME|binding_supports_weight}" />
										<select name="attr_bindings_weight_units">
											<option value="pounds" data-i18n="pounds-option" selected>Pounds</option>
											<option value="kilograms" data-i18n="kilograms-option">Kilograms</option>
										</select>
									</div>
								</div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="coils-label">Coils</span>
											<span class="tooltiptext">
												<span data-i18n="breaking-bindings-coils-tooltip">Number of coils around the prisoner, about 2 yards of rope for a normal-sized human. Each coil after the first gives +1 ST to the rope.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="hidden" name="attr_binding_coils_strength_mod" value="0" />
										<input type="number" name="attr_binding_coils" value="1" min="1" step="1" title="Macro: @{NAME|binding_coils}" />
									</div>
								</div>

								<div class="grid-item">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-strength">ST</span>
											<span class="tooltiptext">
												<span data-i18n="binding-strength-tooltip">Effective ST of rope based on the amount of weight it supports and the number of coils. GURPS Low-Tech 130.<br />Math: ST = (square root of dynamic load limit /2) plus +1 ST per extra coil. Dynamic load limit = ropes support weight / 2.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="hidden" name="attr_binding_supports_strength" value="22" />
										<input type="number" name="attr_binding_strength" value="22" min="0" step="1" readonly class="input-disabled" />
										<button type="action" name="act_roll_skill_breaking_bindings" class="button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Tool}} {{skillName=Rope ST}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{binding_strength}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
									</div>
								</div>

							</div>

							<div>
								<span data-i18n="breaking-bindings-contest-description">Prisoner must <i>win</i> a Quick Contest of their ST versus rope's ST. Each attempt takes a minute and costs 1 FP; repeated attempts have a cumulative -1 ST to the prisoner's ST. If prisoner loses and bindings are thin wire, prisoner suffers 1 HP of cutting damage. Critical Failure means a temporarily crippled arm. GURPS Low Tech 130.</span>
							</div>

						</div>
					</div>
					
				</div>

			</div>

			<div class="options senses">
				
				<div class="grid-standard grid-2-column-equal-width grid__gap_large">

					<div class="grid-cell">

						<div class="tools-container" style="margin-bottom: 150px;">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="hearing-distance-label">Hearing Distance</span></h3>
									<span class="tooltiptext">
										<span data-i18n="hearing-tool-tooltip">Based on Hearing rules on B358 and GURPS Powers Enhanced Senses p21.</span>
									</span>
								</div>
							</div>
							
							<div class="grid-2-column-auto grid__gap_small grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="sound-label">Sound</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-sound-tooltip">Select the cause of the sound.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_hearing_sound_source_sort_by" value="alphabetical" />
									<select name="attr_hearing_sound_source" class="hearing-source hearing-source-sort-decibel">
										<option value="step-none" selected>-- Select --</option>
										<option value="step-1" data-i18n="quiet-breathing-option"><span>Quiet Breathing (10 dB)</span></option>
										<option value="step-1-stealth" data-i18n="critical-success-stealth-option"><span>Stealth, critical success (10 dB)</span></option>
										<option value="step-2" data-i18n="very-quiet-room-option"><span>Very quiet room (20 dB)</span> </option>
										<option value="step-3" data-i18n="whisper-option"><span>Whisper (30 dB)</span></option>
										<option value="step-4" data-i18n="leaves-rustling-option"><span>Leaves Rustling (40 dB)</span></option>
										<option value="step-4-stealth" data-i18n="success-stealth-option"><span>Success on stealth (40 dB)</span></option>
										<option value="step-5" data-i18n="quiet-conversation-option"><span>Quiet Conversation (50 dB)</span></option>
										<option value="step-6"  data-i18n="conversation-cocking-pistol-option"><span>Normal Conversation, Cocking Pistol (60 dB)</span></option>
										<option value="step-6-stealth" data-i18n="fail-stealth-option"><span>Failure on Stealth (60 dB)</span></option>
										<option value="step-7" data-i18n="light-traffic-vacuum-option"><span>Light traffic, vacuum cleaner (70 dB)</span></option>
										<option value="step-8" data-i18n="loud-conversation-option"><span>Loud conversation (80 dB)</span></option>
										<option value="step-9" data-i18n="shout-gas-engine-option"><span>Noisy office, Shout, gasoline engine (90 dB)</span></option>
										<option value="step-9-stealth" data-i18n="critical-failure-stealth-option"><span>Critical failure on Stealth (90 dB)</span></option>
										<option value="step-10" data-i18n="silenced-pistol-orchestra-option"><span>Silenced pistol, orchastra (100 dB)</span></option>
										<option value="step-11" data-i18n="chainsaw-horn-concert-option"><span>Chainsaw, car horn, rock concert (110 dB)</span></option>
										<option value="step-12" data-i18n="jackhammer-option"><span>Jackhammer (120 dB)</span></option>
										<option value="step-13" data-i18n="applause-siren-option"><span>Loud hand clapping, siren (130 dB)</span></option>
										<option value="step-14" data-i18n="light-pistol-option"><span>Light pistol, bat sonar (140 dB)</span></option>
										<option value="step-15" data-i18n="smithy-option"><span>Smithy, heavy pistol (150 dB)</span></option>
										<option value="step-16" data-i18n="stun-grenade-option"><span>Stun grenade (160 dB)</span></option>
										<option value="step-17" data-i18n="jet-engine-option"><span>Jet engine (170 dB)</span></option>
										<option value="step-18" data-i18n="tank-gun-option"><span>Tank gun (180 dB)</span></option>
										<option value="step-19" data-i18n="step-nineteen-option"><span>Step 19 (190 dB)</span></option>
										<option value="step-20" data-i18n="explosive-shockwave-option"><span>Explosive shockwave (200 dB)</span></option>
										<option value="step-21" data-i18n="artillery-option"><span>Artillery (210 dB)</span></option>
										<option value="step-22" data-i18n="dolphin-sonar-option"><span>Dolphin sonar (220 dB)</span></option>
									</select>
									<select name="attr_hearing_sound_source" class="hearing-source hearing-source-sort-alpha">
										<option value="step-none" selected>-- Select --</option>
										<option value="step-10" data-i18n="air-gun-alpha-option">Air gun (100 db)</option>
										<option value="step-21" data-i18n="artillery-alpha-option">Artillery (210 db)</option>
										<option value="step-6" data-i18n="attaching-bayonet-alpha-option">Attaching bayonet (60 db)</option>
										<option value="step-14" data-i18n="bat-sonar-alpha-option">Bat sonar (140 db)</option>
										<option value="step-8" data-i18n="bow-alpha-option">Bow (80 db)</option>
										<option value="step-11" data-i18n="chainsaw-alpha-option">Chainsaw (110 db)</option>
										<option value="step-8" data-i18n="shouting-alpha-option">Conversation, shouting (80 db)</option>
										<option value="step-8" data-i18n="conversation-loud-alpha-option">Conversation, loud (80 db)</option>
										<option value="step-6" data-i18n="conversation-normal-alpha-option">Conversation, normal (60 db)</option>
										<option value="step-5" data-i18n="conversation-quiet-alpha-option">Conversation, quiet (50 db)</option>
										<option value="step-9" data-i18n="crossbow-alpha-option">Crossbow (90 db)</option>
										<option value="step-22" data-i18n="dolphin-sonar-alpha-option">Dolphin sonar (220 db)</option>
										<option value="step-11" data-i18n="engine-diesel-alpha-option">Engine, diesel (110 db)</option>
										<option value="step-9" data-i18n="engine-gasoline-alpha-option">Engine, gasoline (90 db)</option>
										<option value="step-17" data-i18n="engine-jet-alpha-option">Engine, jet (170 db)</option>
										<option value="step-10" data-i18n="engine-revving-gas-alpha-option">Engine, revving gas (100 db)</option>
										<option value="step-18" data-i18n="explosion-large-alpha-option">Explosion, large (180 db)</option>
										<option value="step-17" data-i18n="explosion-small-alpha-option">Explosion, small (170 db)</option>
										<option value="step-20" data-i18n="explosive-shockwave-alpha-option">Explosive shockwave (200 db)</option>
										<option value="step-10" data-i18n="firearm-silent-ammo-alpha-option">Firearm, "silent" ammo (100 db)</option>
										<option value="step-6" data-i18n="firearm-cocking-or-reloading-alpha-option">Firearm, cocking or reloading  (60 db)</option>
										<option value="step-14" data-i18n="grenade-launcher-alpha-option">Grenade launcher (140 db)</option>
										<option value="step-16" data-i18n="grenade-stun-alpha-option">Grenade, stun (160 db)</option>
										<option value="step-16" data-i18n="heavy-machine-gun-alpha-option">Heavy machine gun (160 db)</option>
										<option value="step-11" data-i18n="horn-car-auto-alpha-option">Horn, car/auto (110 db)</option>
										<option value="step-12" data-i18n="jackhammer-alpha-option">Jackhammer (120 db)</option>
										<option value="step-13" data-i18n="jet-takeoff-alpha-option">Jet takeoff (130 db)</option>
										<option value="step-4" data-i18n="leaves-rustling-alpha-option">Leaves Rustling (40 db)</option>
										<option value="step-4" data-i18n="library-alpha-option">Library (40 db)</option>
										<option value="step-13" data-i18n="loud-hand-clapping-alpha-option">Loud hand clapping (130 db)</option>
										<option value="step-11" data-i18n="motorcycle-alpha-option">Motorcycle (110 db)</option>
										<option value="step-9" data-i18n="office-noisy-alpha-option">Office, noisy (90 db)</option>
										<option value="step-10" data-i18n="orchastra-alpha-option">Orchastra (100 db)</option>
										<option value="step-12" data-i18n="oxygen-torch-alpha-option">Oxygen torch (120 db)</option>
										<option value="step-4" data-i18n="person-stalking-alpha-option">Person, stalking (40 db)</option>
										<option value="step-5" data-i18n="person-walking-alpha-option">Person, walking (50 db)</option>
										<option value="step-15" data-i18n="pistol-heavy-x-mm-acp-alpha-option">Pistol, heavy (9x19mm, .45 ACP) (150 db)</option>
										<option value="step-14" data-i18n="pistol-light-alpha-option">Pistol, light (140 db)</option>
										<option value="step-13" data-i18n="pistol-silenced-alpha-option">Pistol, silenced (130 db)</option>
										<option value="step-12" data-i18n="pistol-very-light-lr-alpha-option">Pistol, very light (.22 LR) (120 db)</option>
										<option value="step-1" data-i18n="quiet-breathing-db-alpha-option">Quiet Breathing (10 db)</option>
										<option value="step-15" data-i18n="rifle-alpha-option">Rifle (150 db)</option>
										<option value="step-17" data-i18n="rifle-magnum-wm-h&h-alpha-option">Rifle, magnum (.300 WM, .600 H&H) (170 db)</option>
										<option value="step-12" data-i18n="rifle-very-ligh-lr-alpha-option">Rifle, very ligh (.22 LR) (120 db)</option>
										<option value="step-9" data-i18n="rock-band-`quiet`-alpha-option">Rock band, `Quiet` (90 db)</option>
										<option value="step-11" data-i18n="rock-band-metallica-alpha-option">Rock band, Metallica (110 db)</option>
										<option value="step-12" data-i18n="rock-band-very-loud-alpha-option">Rock band, very loud (120 db)</option>
										<option value="step-13" data-i18n="rock-concert-alpha-option">Rock concert (130 db)</option>
										<option value="step-3" data-i18n="room-very-quiet-alpha-option">Room, very quiet (30 db)</option>
										<option value="step-16" data-i18n="shotgun-alpha-option">Shotgun (160 db)</option>
										<option value="step-12" data-i18n="siren-alpha-option">Siren (120 db)</option>
										<option value="step-11" data-i18n="smithy-alpha-option">Smithy (110 db)</option>
										<option value="step-9-stealth" data-i18n="critical-failure-stealth-option">Stealth, critical failure (90 dB)</option>
										<option value="step-6-stealth" data-i18n="fail-stealth-option">Stealth, failure (60 dB)</option>
										<option value="step-4-stealth" data-i18n="success-stealth-option">Stealth, success (40 dB)</option>
										<option value="step-1-stealth" data-i18n="critical-success-stealth-option">Stealth, critical success (10 dB)</option>
									</select>									  
								</div>
								
								<div class="grid-cell">
									<label>
										<span data-i18n="sort-by-label">Sort by</span>:										
									</label>	
								</div>
								<div class="grid-cell">
									<select name="attr_hearing_sound_source_sort_by">
										<option value="decibel" data-i18n="decibel-option">Decibel</option>
										<option value="alphabetical" data-i18n="alphabetical-option" selected>Alphabetical</option>
									</select>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="range-label">Range</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-base-range-tooltip">The base range of the sound, this is used to apply +1/-1 to the hearing roll based on listener's position. B358 and GURPS Powers Enhanced Senses p21.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_hearing_sound_base_range" value="0" />
									<span name="attr_hearing_sound_base_range"></span>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="distance-label">Distance</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-distance-tooltip">Enter the number of yards the listener is away from the source.<ul><li>1 inch = 0.028 yards</li><li>2 inches = 0.055 yards</li><li>4.5 inches = 0.125 yards</li><li>9 inches = .25 yards</li><li>1.5 feet = .5 yards</li><li>1 mile = 1,760 yards</li></ul></span>
											</span>
										</div>
									</label>	
								</div>
								<div>
									<input type="number" min="0" name="attr_hearing_distance" value="0" class="medium-width" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="step-difference-label">Step Difference</span>:
											<span class="tooltiptext">
												<span data-i18n="step-difference-tooltip">The step difference is based on the listener's distance and the base range of the sound.<br />Example: Normal conversation has a range of 1 yard (step value of 6). The listener is at eight yards away, the sound that matches 8 yards is a <b>Shout (step value of 9)</b>. Steps away is 9 - 6 = 3 steps away. Which is -3 to Hearing rolls.</span>
											</span>
										</div>
									</label>	
								</div>
								<div>
									<input type="number" name="attr_hearing_step_difference" value="0" readonly="readonly" class="input-disabled" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="tunnel-width-label">Tunnel Width</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-tunnel-width-tooltip">Width of the tunnel or corridor in yards. If the base range of the sound exceeds the width of the tunnel, the penalty to Hearing rolls is -1 for each <i>two</i> steps. GURPS Powers Enhanced Senses p21.</span>
											</span>
										</div>
									</label>	
								</div>
								<div>
									<input type="number" min="0" name="attr_hearing_tunnel_width" value="0" class="medium-width" />
								</div>
							
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="hearing-modifier-label">Hearing Modifier</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-modifier-tooltip">The hearing modifier to apply to the sense roll.</span>
											</span>
										</div>
									</label>
								</div>
								<div>
									<input type="number" name="attr_hearing_modifier" value="0" class="input-disabled" readonly="readonly" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="protected-hearing-label">Protected Hearing</span>:
											<span class="tooltiptext">
												<span data-i18n="protected-hearing-tooltip">Check if the character has Protected Hearing. +5 to appropriate health rolls.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="checkbox" name="attr_hearing_protected" value="1" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="effects-label">Effects</span>:
											<span class="tooltiptext">
												<span data-i18n="hearing-effects-tooltip">As described in GURPS Powers Enhanced Senses p21.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_hearing_effects" value="n/a" />
									<span name="attr_hearing_effects"></span>
								</div>
							
							</div>

						</div>
						
					</div>

					<div class="grid-cell">
						
						<div class="tools-container" style="margin-bottom: 150px;">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="stealth-perception-label">Stealth vs Perception</span></h3>
									<span class="tooltiptext">
										<span data-i18n="stealth-perception-tooltip">Stealth vs. Perception is based on rules from B222 and rule clarification from Kromm posted on Steve Jackson Games Forums.</span>
									</span>
								</div>
							</div>

							<div>
								<p>If a watcher is <i>actively</i> looking for intruders, roll a quick contest.</p>
							</div>

							<div class="grid-standard grid-stealth-perception grid__align_center">
								
								<!-- row #1: stealth and perception-->
								<div class="grid-cell left-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="stealth-label">Stealth</span>:
											<span class="tooltiptext">
												<span data-i18n="stealth-vs-perception-stealth-skill-tooltip">Enter the effective skill level, factoring in appropriate modifiers.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_stealth_skill" value="10" min="3" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="perception-label">Perception</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-perception-skill-tooltip">Enter the effective skill level. NOTE: You can replace this with the Observation skill, B211.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_perception_skill" value="10" min="3" step="1" />
								</div>
								<div class="grid-cell inner-cell">&nbsp;</div>
								<div class="grid-cell right-cell">&nbsp;</div>

								<!-- row #2: encumbrance and headers -->
								<div class="grid-cell left-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-encumbrance-label">Enc</span>:
											<span class="tooltiptext">
												<span data-i18n="stealth-vs-perception-encumbrance-tooltip">Select the encumbrance level.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<select name="attr_stealth_vs_perception_encumbrance">
										<option value="0">0</option>
										<option value="-1">1</option>
										<option value="-2">2</option>
										<option value="-3">3</option>
										<option value="-4">4</option>
									</select>
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="attribute-vision">Vision</span>
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-vision-tooltip">This column will factor all the vision modifiers and then tool will determine the best perception to use.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="attribute-hearing">Hearing</span>
											<span class="tooltiptext move-far-left">
												<span data-i18n="stealth-vs-perception-hearing-tooltip">This column will factor all the hearing modifiers and then tool will determine the best perception to use.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">&nbsp;</div>

								<!-- row #3: move greater than 1 and acute modifiers -->
								<div class="grid-cell left-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-custom-modifier-label">Custom Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-stealth-custom-modifier-tooltip">Enter the total of other modifiers. <ul><li>-5 to hide in an area without "natural" hiding places. B222</li><li>+3 or more if there are <i>many</i> hiding places. B222.</li></ul></span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_stealth_custom_modifier" value="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-acute-mod-label">Acute Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-acute-vision-tooltip">Enter the character's Acute Vision modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_acute_vision" value="0" min="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-acute-mod-label">Acute Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-acute-hearing-tooltip">Enter the character's Acute Hearing modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">
									<input type="number" name="attr_stealth_vs_perception_acute_hearing" value="0" min="0" step="1" />
								</div>

								<!-- row #4: disc. smell and conceal modifiers -->
								<div class="grid-cell column-checkbox left-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_move_over_1" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="move-greater-one-label">Move > 1 (-5)</span>
										<span class="tooltiptext">
											<span data-i18n="stealth-vs-perception-move-greater-1-tooltip">Check if the character is moving over 1 yard per second. B222.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-concealment-modifier-label">Conceal Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-concealment-vision-tooltip">Enter a modifier if the target is concealed by high-tech camouflage or "stealth technology". B211.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_conceal_vision_mod" value="0" max="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-concealment-modifier-label">Conceal Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-concealment-hearing-tooltip">Enter a modifier if the target is concealed by high-tech dampening or "stealth technology". B211.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">
									<input type="number" name="attr_stealth_vs_perception_conceal_hearing_mod" value="0" max="0" step="1" />
								</div>

								<!-- row #5: blank column and surv. modifiers -->
								<div class="grid-cell column-checkbox left-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_discriminatory_smell" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="versus-discriminatory-label">vs. Disc. Smell (-5)</span>
										<span class="tooltiptext">
											<span data-i18n="stealth-vs-perception-versus-discriminatory-tooltip">If the observer has Discriminatory smell, apply a -5 modifier.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-surveillance-modifier-label">Surv Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-surveillance-tooltip">Enter a modifier if the observer possesses suitable surveillance devices (thermograph to spot a concealed sniper, etc.) and had a successfull skill roll to use them. B211.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_surveillance_vision_mod" value="0" min="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-surveillance-modifier-label">Surv Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-surveillance-tooltip">Enter a modifier if the observer possesses suitable surveillance devices (thermograph to spot a concealed sniper, etc.) and had a successfull skill roll to use them. B211.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">
									<input type="number" name="attr_stealth_vs_perception_surveillance_hearing_mod" value="0" min="0" step="1" />
								</div>

								<!-- row #6: blank column and custom modifiers -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-custom-modifier-label">Custom Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-custom-modifier-tooltip">Enter any other modifiers the GM would like to apply.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_custom_vision_mod" value="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-custom-modifier-label">Custom Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-custom-modifier-tooltip">Enter any other modifiers the GM would like to apply.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">
									<input type="number" name="attr_stealth_vs_perception_custom_hearing_mod" value="0" step="1" />
								</div>

								<!-- row #7: blank column and vision distance and hearing distance modifier -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="distance-label">Distance</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-distance-vision-tooltip">Enter the number of yards (hexes or meters) between observer and character using stealth.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_distance_vision" value="0" min="0" step="1" />
								</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-distance-modifier-label">Distance Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-distance-hearing-modifier-tooltip">Enter the distance modifier, you can use the tool <b>Hearing Distance</b>.<br /><b>Suggestion:</b> If you are using the single roll button below, you can assume the sound level is equal to a succesful stealth roll.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell right-cell">
									<input type="number" name="attr_stealth_vs_perception_distance_hearing_mod" value="0" step="1" />
								</div>

								<!-- row #8: blank column and vision distance mod and discriminatory hearing -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-distance-modifier-label">Distance Mod</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-distance-vision-modifier-tooltip">Distance modifier is determined by the <b>Size and Speed/Range Table</b>, B550.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_distance_vision_modifier" value="0" readonly class="input-disabled" />
								</div>
								<div class="grid-cell column-checkbox right-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_discriminatory_hearing" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="abbrevation-discriminatory-hearing-label">Disc Hearing (+4)</span>
										<span class="tooltiptext move-left">
											<span data-i18n="stealth-vs-perception-discriminatory-hearing-tooltip">If the observer has Discriminatory Hearing, apply a +5 modifier.</span>
										</span>
									</div>
								</div>

								<!-- row #9: blank column and vision size modifier and hard of hearing -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="two-letter-abbreviation-size-modifier-label">SM</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-size-modifier-tooltip">Size Modifier of the character performing the stealth roll.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_size_modifier" value="0" step="1" />
								</div>
								<div class="grid-cell column-checkbox right-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_hard_of_hearing" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="hard-of-hearing-with-penalty-label">Hard of hearing (-4)</span>
										<span class="tooltiptext move-left">
											<span data-i18n="stealth-vs-perception-hard-of-hearing-tooltip">If the observer has Hard of Hearing, apply a -4 penalty.</span>
										</span>
									</div>
								</div>

								<!-- row #10: blank column and darkness penalty for vision-->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell inner-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="darkness-label">Darkness</span>:
											<span class="tooltiptext move-left">
												<span data-i18n="stealth-vs-perception-darkness-modifier-tooltip">Enter the total darkness penalty, factoring in all modifiers.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="number" name="attr_stealth_vs_perception_darkness_modifier" value="0" max="0" step="1" />
								</div>
								<div class="grid-cell column-checkbox right-cell">&nbsp;</div>

								<!-- row #11: blank column and hypersectral vision -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell column-checkbox inner-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_hyperspectral_vision" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="hyperspectral-with-bonus-label">Hyperspectral (+3)</span>
										<span class="tooltiptext move-left">
											<span data-i18n="stealth-vs-perception-hyperspectral-tooltip">If the observer has hyperspectral vision, apply a +3 bonus.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell column-checkbox right-cell">&nbsp;</div>

								<!-- row #12: blank column and hypersectral vision -->
								<div class="grid-cell column-checkbox left-cell">&nbsp;</div>
								<div class="grid-cell column-checkbox inner-cell">
									<input type="checkbox" name="attr_stealth_vs_perception_in_plain_sight" value="1" />
									<div class="standard-tooltip">
										<span data-i18n="in-plain-sight-with-bonus-label">In plain sight (+10)</span>
										<span class="tooltiptext move-left">
											<span data-i18n="stealth-vs-perception-in-plain-sight-tooltip">If the character performing the stealth is in plain sight, apply a +10 modifier.</span>
										</span>
									</div>
								</div>
								<div class="grid-cell column-checkbox right-cell">&nbsp;</div>
								
							</div>

							<div class="grid-standard grid-stealth-perception-rolls grid__align_center">

								<!-- row #1: stealth mod total, vision mod total, hearing mod total-->
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="abbreviation-modifier-label">Mod</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_stealth_mod_total" value="0" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
								</div>
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="abbreviation-modifier-label">Mod</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_vision_mod_total" value="0" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
								</div>
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="abbreviation-modifier-label">Mod</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_hearing_mod_total" value="0" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
								</div>

								<!-- row #2: stealth, vision, hearing skills with die roller -->
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="stealth-label">Stealth</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_stealth_skill_final" value="10" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
									<button type="action" name="act_roll_skill_stealth" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Stealth vs Perception}} {{skillName=Stealth}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{stealth_vs_perception_stealth_skill_final}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
								</div>
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="attribute-vision">Vision</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_vision_skill" value="10" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
									<button type="action" name="act_roll_skill_vision" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Stealth vs Perception}} {{skillName=Vision Perception}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{stealth_vs_perception_vision_skill}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
								</div>
								<div class="grid-cell left-cell">
									<label>
										<span data-i18n="attribute-hearing">Hearing</span>:
									</label>
								</div>
								<div class="grid-cell inner-cell">
									<input type="text" name="attr_stealth_vs_perception_hearing_skill" value="10" readonly="readonly" class="input-disabled width-stealth-vs-perception-skill" />
									<button type="action" name="act_roll_skill_hearing" class="sheet-button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showHitLabel=[[0]]}} {{characterName=Stealth vs Perception}} {{skillName=Hearing Perception}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{stealth_vs_perception_hearing_skill}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{displayRollModifierSummary=[[1]]}}"></button>
								</div>

							</div>

							<div>
								<p class="footnote-font">
									Kromm: 
									<button type="roll" class="no-decoration btn ui-draggable" name="roll_blank" value="https://forums.sjgames.com/showpost.php?p=1086674&postcount=9" title="Show link in chat. NOTE: Right-click to open in new window">
										<span data-i18n="sm-and-stealth-button">Re: SM and stealth</span>
									</button>
								</p>
								<ul>
									<li><b>Not Being Seen:</b> Win a Quick Contest of Stealth vs. your subject's <b>Vision</b>. Your SM modifies watcher's Vision roll.</li>
									<li><b>Not Being Heard:</b> Win a Quick Contest of Stealth vs your subject's <b>Hearing</b>. Your SM has no effect.</li>
									<li>If you can be seen <b>and</b> heard, just roll once, but use the worst odds</li>
								</ul>
							</div>
							
						</div>	
						
					</div>

				</div>

			</div>

			<div class="options feats">

				<div class="grid-standard grid-2-column-equal-width grid__gap_large grid__margin_bottom_small">

					<div class="grid-cell">

						<div class="tools-container">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="climbing-label">Climbing</span></h3>
									<span class="tooltiptext">
										<span data-i18n="climbing-tool-tooltip">Climbing tool is based on rules from B349.</span>
									</span>
								</div>
								<span class="header-subscript" name="attr_metric_title"></span>
							</div>
							
							<div class="grid-climbing-tool grid__align_center">

								<!-- row 1 -->
								<div class="grid-cell">
									<label>
										<span data-i18n="type-of-climb-label">Type of Climb</span>
									</label>
								</div>
								
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="in-combat-label">In combat</span>
											<span class="tooltiptext">
												<span data-i18n="climbing-tool-in-combat-tooltip">Use the person with the highest skill level, they must be leader.<br/>They should usually lead from the front and are able to communicate with others, at least using gestures.</span>
											</span>
										</div>
									</label>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="speed-label">Speed</span>
											<span class="tooltiptext">
												<span data-i18n="climbing-tool-speed-tooltip">The tool assumes the distance between rungs is one foot or 0.3 meters.</span>
											</span>
										</div>
									</label>
								</div>
							
								<div class="grid-cell">
									<label>
										<span data-i18n="modifier-no-colon-label">Modifier</span>
									</label>
								</div>

								<!-- row 2 -->
								<div class="grid-cell">
									<select name="attr_climbing_tool_type_of_climb">
										<option value="ladder-up" data-i18n="ladder-up-option" selected>Ladder up</option>
										<option value="ladder-down" data-i18n="ladder-down-option">Ladder down</option>
										<option value="tree" data-i18n="ordindary-tree-option">Ordindary tree</option>
										<option value="mountain" data-i18n="ordinary-mountain-option">Ordinary mountain</option>
										<option value="vertical-stone-wall" data-i18n="vertical-stone-wall-option">Vertical stone wall</option>
										<option value="modern-building" data-i18n="modern-building-option">Modern building</option>
										<option value="rope-up" data-i18n="rope-up-option">Rope-up</option>
										<option value="rope-down-no-equipment" data-i18n="rope-down-no-equipment-option">Rope-down w/o equipment</option>
										<option value="rope-down-with-equipment" data-i18n="rope-down-with-equipment-option">Rope-down w/ equipment</option>
									</select>
								</div>
								
								<div class="grid-cell">
									<input type="checkbox" name="attr_climbing_tool_in_combat" checked value="1" />
								</div>

								<div class="grid-cell">
									<input type="hidden" name="attr_climbing_tool_speed_in_feet" value="3" />
									<input type="hidden" name="attr_climbing_tool_speed_description" value="3 rungs/sec" />
									<span name="attr_climbing_tool_speed_description"></span>
								</div>
							
								<div class="grid-cell">
									<input type="hidden" name="attr_climbing_tool_type_of_climb_modifier" value="no-roll" />
									<input type="hidden" name="attr_climbing_tool_type_of_climb_modifier_description" value="No roll" />
									<span name="attr_climbing_tool_type_of_climb_modifier_description"></span>
								</div>
								
							</div>
							
							<div class="grid-3-column-equal-width grid__gap_small grid__align_center">
								<!-- Row #1 -->
								<div class="grid-cell">
									<div>
										<label>
											<div class="standard-tooltip">
												<span data-i18n="encumbrance-label">Encumbrance</span>
												<span class="tooltiptext">
													<span data-i18n="climbing-tool-encumbrance-tooltip">Enter the character's encumbrance level.</span>
												</span>
											</div>
										</label>
									</div>
									<div>
										<input type="number" value="0" min="0" step="1" name="attr_climbing_tool_encumbrance" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<div>
										<label>
											<span data-i18n="custom-modifier-label">Custom Modifier</span>
										</label>
									</div>
									<div>
										<input type="number" value="0" min="0" step="1" name="attr_climbing_tool_custom_modifier" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<div>
										<label>
											<span data-i18n="final-modifier-label">Final Modifier</span>
										</label>
									</div>
									<div>
										<input type="text" value="No roll" readonly name="attr_climbing_tool_final_modifier" class="medium-width input-disabled" />
									</div>
								</div>

								<!-- Row #2 -->
								<input type="hidden" name="attr_use_metric_distances" value="0" />
								<div class="grid-cell united-states-customary-units">
									<div>
										<label>
											<div class="standard-tooltip">
												<span data-i18n="height-in-feet-label">Height in Feet</span>
												<span class="tooltiptext">
													<span data-i18n="climbing-tool-height-in-feet-tooltip">Enter how for is the character climbing in feet.</span>
												</span>
											</div>
										</label>
									</div>
									<div>
										<input type="number" value="12" min="0" name="attr_climbing_tool_height" class="medium-width" />
									</div>
								</div>
								<div class="grid-cell metric-units">
									<div>
										<label>
											<div class="standard-tooltip">
												<span data-i18n="height-in-meters-label">Height in Meters</span>
												<span class="tooltiptext">
													<span data-i18n="climbing-tool-height-in-meters-tooltip">Enter how for is the character climbing in feet.</span>
												</span>
											</div>
										</label>
									</div>
									<div>
										<input type="number" value="3.66" min="0" name="attr_climbing_tool_height_meters" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<div>
										<label>
											<span data-i18n="travel-time-label">Travel Time</span>
										</label>
									</div>
									<div>
										<input type="tex" value="4 sec" readonly name="attr_climbing_tool_travel_time" class="large-width input-disabled" />
									</div>
								</div>

								<div class="grid-cell">
									<div>
										<label>
											<div class="standard-tooltip">
												<span data-i18n="number-of-rolls-label">Number of rolls</span>
												<span class="tooltiptext">
													<span data-i18n="climbing-tool-number-of-rolls-tooltip">Total number of rolls needed to climb the entered height.</span>
												</span>
											</div>
										</label>
									</div>
									<div>
										<input type="text" value="1" readonly name="attr_climbing_tool_number_of_rolls" class="medium-width input-disabled" />
									</div>
								</div>

							</div>

						</div>
						
					</div>

					<div class="grid-cell">
						
						<div class="tools-container">
							
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="digging-label">Digging</span></h3>
									<span class="tooltiptext">
										<span data-i18n="digging-tool-tooltip">Digging tool is based on rules from B350-351.</span>
									</span>
								</div>
								<span class="header-subscript" name="attr_metric_title"></span>
							</div>

							<div class="grid-digging-tool grid__align_center">

								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="basic-lift-label">Basic Lift</span>
											<span class="tooltiptext">
												<span data-i18n="digging-tool-basic-lift-tooltip">Enter the basic lift of the character doing the digging, (ST * ST)/5.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" value="20" min="0" step="1" name="attr_digging_tool_basic_lift" class="medium-width" />
								</div>
								<div class="grid-cell">&nbsp;</div>
								<div class="grid-cell">&nbsp;</div>

								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="tools-label">Tools</span>
											<span class="tooltiptext">
												<span data-i18n="digging-tool-tools-tooltip">Select the type of tools being used or you can enter a custom modifier. Digging Tools B350.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<select name="attr_digging_tool_implentation">
										<option value="iron-steel" data-i18n="iron-steel-tools-option" selected>Iron or steel tools</option>
										<option value="wooden" data-i18n="wooden-tools-option">Wooden tools</option>
										<option value="improvised" data-i18n="improvised-tools-option">Improvised tools</option>
										<option value="custom" data-i18n="custom-tools-option">Custom modifier</option>
									</select>
								</div>
								<div class="grid-cell">
									<span class="container-label-input">
										<span>x</span><span>&nbsp;</span>
										<input type="number" value="1" min="0" step="1" name="attr_digging_tool_custom_modifier" class="medium-width" />
									</span>
								</div>
								<div class="grid-cell">&nbsp;</div>

								<!-- row #3 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="action-label">Action</span>
											<span class="tooltiptext">
												<span data-i18n="digging-tool-action-tooltip">Select an action and the digging and fatigue rate will automatically update. Digging Rate = Basic Lift * quality of tools modifier * action/soil type.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<select name="attr_digging_tool_action">
										<option value="shovel-loose-soil" data-i18n="shovel-loose-soil-action-option" selected>Shovel loose soil, sand, etc</option>
										<option value="shovel-ordinary-soil" data-i18n="shovel-ordinary-soil-action-option">Shovel ordinary soil</option>
										<option value="pick-ordinary-soil" data-i18n="pick-ordinary-soil-action-option">Pick ordinary soil</option>
										<option value="pick-hard-soil" data-i18n="pick-hard-soil-action-option">Pick hard soil, clay, etc</option>
										<option value="shovel-hard-soil" data-i18n="shovel-hard-soil-action-option">Shovel hard soil, clay, etc</option>
										<option value="pick-shovel-hard-soil" data-i18n="pick-shovel-hard-soil-action-option">Pick & shovel hard soil, clay, etc</option>
										<option value="pick-hard-rock" data-i18n="pick-hard-rock-action-option">Pick hard rock</option>
										<option value="shovel-hard-rock" data-i18n="shovel-hard-rock-action-option">Shovel hard rock</option>
									</select>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_digging_rate_multiplier" value="2" />
									<input type="hidden" name="attr_digging_tool_digging_rate_cubic_feet_hour" value="40" />
									<input type="text" name="attr_digging_tool_digging_rate_description" value="40 cf/hr" title="Digging rate" readonly class="medium-large-width input-disabled" />
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_fatigue_per_hour" value="1" />
									<input type="text" name="attr_digging_tool_fatigue_description" value="1 FP/hr" title="Fatigue rate" readonly class="medium-large-width input-disabled" />
								</div>

								<!-- row #4 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="hours-label">Hours</span>
											<span class="tooltiptext">
												<span data-i18n="digging-tool-hours-tooltip">Enter the number of hours to determine total volume and fatigue cost.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" value="1" min="0" name="attr_digging_tool_hours" class="medium-width" />
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_total_volume_for_hours" value="320" />
									<input type="text" name="attr_digging_tool_total_volume_for_hours_description" value="320 cf" title="Total volume" readonly class="medium-large-width input-disabled" />
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_total_fatigue_for_hours" value="8" />
									<input type="text" name="attr_digging_tool_total_fatigue_for_hours_description" value="8 FP" readonly class="medium-large-width input-disabled" />
								</div>

								<!-- row #5 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="area-label">Area</span>
											<span class="tooltiptext">
												<span data-i18n="digging-tool-dimensions-tooltip">Enter the height, width, and depth of the area to get the total volume and number of hours based on the action/soil type.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" value="6" min="0" name="attr_digging_tool_height" title="height" class="small-medium-width" />
									<span>x</span>
									<input type="number" value="3" min="0" name="attr_digging_tool_width" title="width" class="small-medium-width" />
									<span>x</span>
									<input type="number" value="12" min="0" name="attr_digging_tool_depth" title="depth" class="small-medium-width" />
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_total_volume_for_dimensions" value="216" />
									<input type="text" name="attr_digging_tool_total_volume_for_dimensions_description" value="216 cf" title="Total volume" readonly class="medium-large-width input-disabled" />
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_digging_tool_total_hours_for_dimensions" value="5.4" />
									<input type="text" name="attr_digging_tool_total_hours_for_dimensions_description" value="5.4 hours" readonly class="medium-large-width input-disabled" />
								</div>

							</div>
							
						</div>	
						
					</div>

				</div>
				
				<div class="grid-standard" style="margin-bottom: 150px;">

					<!-- #column 1 -->
					<div class="grid-cell">

						<div class="tools-container">
								
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="travel-time-distances-heading">Travel Time and Distances</span></h3>
									<span class="tooltiptext">
										<span data-i18n="travel-time-distances-tooltip">This tool uses the rules from <b>Dungeon Fantasy 16 Wilderness Adventures</b> p20-24, which is based on rules from B351.</span>
									</span>
								</div>
								<span class="header-subscript" name="attr_metric_title"></span>
							</div>

							<!-- #initial travel options -->
							<div class="grid-travel-options grid__gap_large grid__align_center">

								<div class="grid-cell">
									<div class="container-label-input">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="move-label">Move</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-move-tooltip">Enter the move of the slowest person or vehicle in the group.</span>
												</span>
											</div>
										</label>
										<span>
											<input type="number" name="attr_travel_move" value="5" min="1" step="1" class="medium-width" />
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<div class="container-label-input">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="terrain-label">Terrain</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-terrain-tooltip">Select the predominant terrain for the area being traveled upon. Use the description shown below to determine the <b>Speed Modifier</b>.<br /><b>Mixed Terrain:</b> If there's mixed terrain, <i>all</i> applicable <b>Survival</b> specialties work that day.</span>
												</span>
											</div>
										</label>
										<span>
											<select name="attr_travel_terrain">
												<option value="arctic" data-i18n="terrain-option-arctic">Arctic</option>
												<option value="arctic-skating" data-i18n="terrain-option-arctic-skating">Arctic (ice), skating</option>
												<option value="arctic-skiing" data-i18n="terrain-option-arctic-skiing">Arctic (snow), skiing</option>
												<option value="arctic-snowshoeing" data-i18n="terrain-option-arctic-snowshoeing">Arctic, snowshoeing</option>
												<option value="desert" data-i18n="terrain-option-desert">Desert</option>
												<option value="desert-sandshoeing" data-i18n="terrain-option-desert-sandshoeing">Desert (sand), sandshoeing</option>
												<option value="island-beach" data-i18n="terrain-option-island-beach">Island/Beach</option>
												<option value="jungle" data-i18n="terrain-option-jungle">Jungle</option>
												<option value="mountain" data-i18n="terrain-option-mountain">Mountain</option>
												<option value="plains" data-i18n="terrain-option-plains" selected>Plains</option>
												<option value="swampland" data-i18n="terrain-option-swampland">Swampland</option>
												<option value="woodlands" data-i18n="terrain-option-woodlands">Woodlands</option>
											</select>
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<div class="container-label-input">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="abbreviation-modifier-label">Mod</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-terrain-modifier-tooltip">Enter the terrain modifier based on the description.</span>
												</span>
											</div>
										</label>
										<span>
											<input type="number" name="attr_travel_terrain_modifier" value="1" min=".2" step="0.10" class="medium-width" />
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<div class="container-label-input">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="weather-label">Weather</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-weather-tooltip">Select the predominant weather during the travel period. GURPS Dungeon Fantasy 16 Wilderness Adventures, Nasty Weather page 30.<ul><li><b>Perfect:</b> the "wind" is at the traveler's back or sails.</li><li><b>Passable:</b> Normal/typical weather for terrain.</li><li><b>Bad:</b> Harsh conditions, just as snow or rain in most terrains. Well lit, maintained roads may not be effected by rain, GM fiat.</li><li><b>Dire:</b> Typhoon type condtions.</li></ul></span>
												</span>
											</div>
										</label>
										<span>
											<select name="attr_travel_weather">
												<option value="perfect" data-i18n="weather-option-perfect">Perfect, +10%</option>
												<option value="passable" data-i18n="weather-option-passable" selected>Passable</option>
												<option value="bad" data-i18n="weather-option-bad">Bad, -50%</option>
												<option value="dire" data-i18n="weather-option-dire">Dire, -75%</option>
											</select>
										</span>
									</div>
								</div>
								

							</div>
							<!-- /initial travel options -->
							
							<!-- #terrain description -->
							<div>
								<div class="grid-4-column-equal grid__border grid__padding">
									<div class="grid-cell">
										<h4><span data-i18n="terrain-label">Terrain</span></h4>
										<div class="content">
											<input type="hidden" name="attr_travel_terrain_name" value="Plains" />
											<span name="attr_travel_terrain_name"></span>
										</div>
									</div>
									<div class="grid-cell">
										<h4><span data-i18n="foraging-label">Foraging</span></h4>
										<div class="content">
											<input type="hidden" name="attr_travel_terrain_foraging" value="2d-7 (avg. 0)" />
											<span name="attr_travel_terrain_foraging"></span>
										</div>
									</div>
									<div class="grid-cell">
										<h4><span data-i18n="tracking-label">Tracking</span></h4>
										<div class="content">
											<input type="hidden" name="attr_travel_terrain_tracking" value="0" />
											<span name="attr_travel_terrain_tracking"></span>
										</div>
									</div>
									<div class="grid-cell">
										<h4><span data-i18n="travel-speed-modifier-label">Travel Speed Modifier</span></h4>
										<div class="content">
											<input type="hidden" name="attr_travel_terrain_travel_speed" value="x0.50 if hilly to x1.25 if completely level (avg. x1.00)" />
											<span name="attr_travel_terrain_travel_speed"></span>
										</div>
									</div>
								</div>
							</div>
							<!-- #terrain description -->
							
							<!-- #travel results -->
							<div>
								<div class="grid-travel-results grid__gap_large grid__align_center">

									<!-- #row 1 -->
									<div class="grid-cell">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="base-speed-label">Base Speed</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-base-speed-tooltip">Base speed is determined by move, terrain, and weather.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell">
										<input type="number" name="attr_travel_base_speed" value="5.00" readonly class="input-disabled medium-width" />
									</div>

									<div class="grid-cell">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="mitigators-label">Mitigators</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-mitigators-tooltip">This value is calculated using the <b>Mitigating Circumstances</b> tabel below.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell">
										<input type="text" name="attr_travel_mitigators_total_percentage_display" value="+0%" readonly class="input-disabled medium-width" />
									</div>

									<div class="grid-cell">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="travel-speed-label">Travel Speed</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-travel-speed-tooltip">The final travel speed.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell">
										<input type="text" name="attr_travel_final_speed" value="5.00" readonly class="input-disabled medium-width" />
									</div>
									<!-- /row 1 -->
									
									<!-- #row 2 -->
									<input type="hidden" name="attr_use_metric_distances" value="0" />
									<div class="grid-cell united-states-customary-units">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="miles-per-hour-abbreviation-label">MPH</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-miles-per-hour-tooltip">Average miles per hour.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell united-states-customary-units">
										<input type="text" name="attr_travel_miles_per_hour" value="2.5" readonly class="input-disabled medium-width" />
									</div>

									<div class="grid-cell metric-units">
										<label class="">
											<div class="standard-tooltip">
												<span data-i18n="kilometers-per-hour-abbreviation-label">KPH</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-kilometers-per-hour-tooltip">Average kilometers per hour.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell metric-units">
										<input type="text" name="attr_travel_kilometer_per_hour" value="4.0" readonly class="input-disabled medium-width" />
									</div>

									<div class="grid-cell">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="hours-per-day-label">Hours per day</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-hours-per-day-tooltip">Enter the number of hours per day spent on traveling, see GUPRS Dungeon Fantasy 16 page 23.<br /><b>Muscle-Powered travel.</b><ul><li>No one with <b>Survival</b> skill, 8 hours per day.</li><li>One or more persons with the <b>Survival</b> skill, 12 hours/day.</li><li>If not sleeping (lose 3 FP per day if not aided) and no one has <b>Survival</b>, 14 hours/day.</li><li>If not sleeping (lose 3 FP per day if not aided) and someone has <b>Survival</b>, 19 hours/day.</li></ul></span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell">
										<input type="number" name="attr_travel_hours_per_day" value="12" class="medium-width" />
									</div>

									<div class="grid-cell united-states-customary-units">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="total-miles-label">Total Miles</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-total-miles-tooltip">Total miles traveled in the day.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell united-states-customary-units">
										<input type="text" name="attr_travel_total_miles" value="30.00" readonly class="input-disabled medium-width" />
									</div>
									
									<div class="grid-cell metric-units">
										<label>
											<div class="standard-tooltip">
												<span data-i18n="total-kilometers-label">Total Kilometers</span>:
												<span class="tooltiptext">
													<span data-i18n="travel-total-kilometers-tooltip">Total kilometers traveled in the day.</span>
												</span>
											</div>
										</label>
									</div>
									<div class="grid-cell metric-units">
										<input type="text" name="attr_travel_total_kilometers" value="48.3" readonly class="input-disabled medium-width" />
									</div>
									<!-- /row 2 -->
									
								</div>

							</div>
							<!-- #travel results -->

							<div class="grid-standard grid__border_cell grid__padding">
								
								<div class="grid-cell">

									<div class="container-label-input custom__margin_bottom_medium">
										<div class="standard-tooltip">
											<h4><span data-i18n="mitigating-circumstances-heading">Mitigating Circumstances</span></h4>
											<span class="tooltiptext">
												<span data-i18n="travel-mitigating-circumstances-tooltip">Use the table below to enter in <b>mitigating circumstances</b> such as using the <b>Hiking</b> skill to improve speed. If you're actively tracking or maybe "patrolling" while traveling.</span>
											</span>
										</div>
										<span>
											<button type="action" name="act_travel_add_mitigators" class="margin_left_medium sort" title="Add a set of example mitigators.">
												<span data-i18n="add-items-button-label">Add Items</span>
											</button>
										</span>
									</div>

									<!-- #Mitigating circumstances table -->
									<div class="grid-travel-mitigation-header">
										<div class="grid-cell">&nbsp;</div>
										<div class="grid-cell">
											<span data-i18n="apply-label">Apply</span>
										</div>
										<div class="grid-cell">
											<div class="standard-tooltip">
												<span data-i18n="mitigator-label">Mitigator</span>
												<span class="tooltiptext">
													<span data-i18n="travel-mitigator-name-tooltip">Enter a memorable name for the mitigating circumstance, use the notes box to provide additional details.</span>
												</span>
											</div>
										</div>
										<div class="grid-cell">
											<div class="standard-tooltip">
												<span data-i18n="percent-label">Percent</span>
												<span class="tooltiptext move-far-left">
													<span data-i18n="travel-mitigator-percent-tooltip">Enter a percent value that will be used to modify the travel speed. <b>NOTE:</b> Use only number, don't add the percent sign.</span>
												</span>
											</div>
										</div>
									</div>

									<input type="hidden" name="attr_travel_mitigators_total_percentage" />
									<fieldset class="repeating_travel-mitigation-options">
										<div class="grid-travel-mitigation-options">
											<div class="grid-cell">
												<label class="toggle-button">
													<input type="checkbox" name="attr_toggle_notes" value="1" />
													<span></span>
												</label>
											</div>
											<div class="grid-cell">
												<input type="checkbox" name="attr_apply" value="1" title="Macro: @{NAME|repeating_travel-mitigation-options_$[row #]_apply}" />
											</div>
											<div class="grid-cell">
												<input type="text" name="attr_name" value="" title="Macro: @{NAME|repeating_travel-mitigation-options_$[row #]_name}" />
											</div>
											<div class="grid-cell">
												<input type="number" name="attr_percent" value="0" class="medium-width" title="Macro: @{NAME|repeating_travel-mitigation-options_$[row #]_percent}" />
											</div>
											<input type="hidden" name="attr_toggle_notes" />
											<div class="expandable-section">
												<h4><span data-i18n="notes-label">Notes</span></h4>
												<textarea name="attr_notes"></textarea>
											</div>
										</div>
									</fieldset>									
									<!-- /Mitigating circumstances table -->


								</div>
								
							</div>

							
						</div>
					</div>
					<!-- /column 1 -->
					
				</div>

			</div>

			<div class="options environmental">
				
				<div class="grid-standard grid-2-column-equal-width grid__gap_large">

					<div class="grid-cell">
						<div class="tools-container">
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="cold-exposure-label">Cold Exposure</span></h3>
									<span class="tooltiptext">
										<span data-i18n="cold-exposure-tooltip">Exposure to cold conditions and thermal shock, see B430.</span>
									</span>
								</div>
							</div>
							<div class="grid-3-column-auto grid__align_center grid__gap_medium">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-label">Temperature</span>
											<span class="tooltiptext">
												<span data-i18n="cold-exposure-temperature-tooltip">Enter the effective temperature, accounting for "wind chill".</span>
											</span>
										</div>
									</label>
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="number" name="attr_cold_exposure_temperature" value="32" step="1" class="medium-width" />
											<input type="hidden" name="attr_cold_exposure_temperature_fahrenheit" value="32" />
										</span>
										<span>
											<select name="attr_cold_exposure_temperature_unit_type">
												<option value="fahrenheit" data-i18n="unit-type-fahrenheit" selected>Fahrenheit</option>
												<option value="celsius" data-i18n="unit-type-celsius">Celcius</option>
											</select>
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<label>
										<span data-i18n="wind-label">Wind</span>
									</label>
									<div>
										<select name="attr_cold_exposure_wind">
											<option value="calm" data-i18n="wind-option-calm" selected>Calm</option>
											<option value="light" data-i18n="wind-option-light">Light (10mph/16kmh+)</option>
											<option value="strong" data-i18n="wind-option-strong">Strong (30mph/48kmh+)</option>
										</select>
									</div>
								</div>	
								<div class="grid-cell">
									<label>
										<span data-i18n="frequency-label">Frequency</span>
									</label>
									<div>
										<input type="hidden" name="attr_cold_exposure_frequency" value="30" />
										<span name="attr_cold_exposure_frequency"></span> <span data-i18n="minutes-label">minutes</span>
									</div>
								</div>	

							</div>
							<div>
								<div class="container-label-input grid__gap_small">
									<span>
										<input type="checkbox" name="attr_cold_exposure_thermal_shock" value="1" />
									</span>
									<span>
										<label>
											<div class="standard-tooltip">
												<span data-i18n="thermal-shock-label">Thermal Shock</span>
												<span class="tooltiptext">
													<span data-i18n="thermal-shock-tooltip">Did the character suffer <i>sudden</i> immersion into icy waters? Impurities can bring the temperature below freezing! If wearing a "dry suit", suffer normal freezing. Otherwise, roll per minute, on success lose 1 FP, only failure, lose FP equal to the margin of failure. Also, check for drowning!</span>
												</span>
											</div>
										</label>
									</span>
								</div>
							</div>
							<div class="grid-2-column-auto grid__gap_large">

								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<span data-i18n="clothing-label">Clothing</span>
										</span>
										<span>
											<select name="attr_cold_exposure_clothing">
												<option value="-5" data-i18n="clothing-option-light">Light or no clothing, -5</option>
												<option value="0" data-i18n="clothing-option-winter" selected>Winter clothing, +0</option>
												<option value="5" data-i18n="clothing-option-arctic">"Arctic" clothing, +5</option>
												<option value="10" data-i18n="clothing-option-heated">Heated suit, +10</option>
											</select>
										</span>
									</div>
								</div>

								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="checkbox" name="attr_cold_exposure_wet_clothes" value="1" />
										</span>
										<span>
											<span data-i18n="wet-clothes-label">Wet clothes</span><span>, -5</span>
										</span>
									</div>
								</div>

							</div>
							<div class="grid-2-column-auto grid__gap_large grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-modifier-label">Temperature Modifier</span>
											<span class="tooltiptext">
												<span data-i18n="temperature-modifier-tooltip">Effective temperature modifier, for every 10° below 0°F or 5° below -18°C, apply a -1 modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_cold_exposure_temperature_modifier" value="0" />
									<span name="attr_cold_exposure_temperature_modifier"></span>
								</div>
								
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="lower-comfort-zone-label">Lower Comfort Zone</span>
											<span class="tooltiptext">
												<span data-i18n="lower-comfort-zone-tooltip">Enter the lower temperature of the comfort zone. Humans have a comfort zone of 35 to 90°F (2 to 32°C). See Temperature Tolerance B93.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="number" name="attr_cold_exposure_lower_comfort_zone" value="35" step="1" class="medium-width" />
											<input type="hidden" name="attr_cold_exposure_lower_comfort_zone_fahrenheit" value="35" />
										</span>
										<span>
											<span name="attr_cold_exposure_current_unit_type_display"></span>
										</span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-tolerance-label">Temperature Tolerance</span>
											<span class="tooltiptext">
												<span data-i18n="temperature-tolerance-tooltip">Enter the character's Cold Temperature Tolerance, each level will decrease the lower comfort zone by HT degrees. See Temperature Tolerance B93.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_cold_exposure_temperature_tolerance" value="0" step="1" class="medium-width" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-tolerance-health-label">Temperature Tolerance HT</span>
											<span class="tooltiptext">
												<span data-i18n="temperature-tolerance-health-tooltip">Enter the character's HT that will be used with Temperature Tolerance.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_cold_exposure_temperature_tolerance_health" value="10" min="1" step="1" class="medium-width" />
								</div>

								<div class="grid-cell">
									<span data-i18n="effective-comfort-zone-label">Effective Comfort Zone</span>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_cold_exposure_effective_comfort_zone" value="35" />
									<input type="hidden" name="attr_cold_exposure_effective_comfort_zone_display" value="35 °F" />
									<input type="hidden" name="attr_cold_exposure_effective_comfort_zone_modifier" value="0" />
									<input type="hidden" name="attr_cold_exposure_must_roll" value="1" />
									<input type="hidden" name="attr_cold_exposure_must_roll_text" value="must roll" />
									<input type="hidden" name="attr_cold_exposure_current_unit_type" value="fahrenheit" />
									<span name="attr_cold_exposure_effective_comfort_zone_display"></span>
									<i>(<span name="attr_cold_exposure_must_roll_text"></span>)</i>
								</div>

							</div>

							<div class="grid-4-column-auto grid__align_center grid__gap_large">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-health">HT</span>
											<span class="tooltiptext">
												<span data-i18n="cold-exposure-health-tooltip">Enter the character's HT or HT-based Survival (Arctic) skill level. B430.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_cold_exposure_health_level" value="10" step="1" min="1" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="modifier-abbreviation-label">MOD</span>
											<span class="tooltiptext">
												<span data-i18n="cold-exposure-health-modifier-tooltip">Enter an optional HT modifier.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_cold_exposure_health_modifier" value="0" step="1" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="total-label">TOTAL</span>
											<span class="tooltiptext">
												<span data-i18n="cold-exposure-health-modifier-total-tooltip">The total modifier that will be applied to the final roll.</span>
											</span>
										</div>
									</label>
									<div style="height:26px;">
										<input type="hidden" name="attr_cold_exposure_health_modifier_total" value="0" />
										<span name="attr_cold_exposure_health_modifier_total"></span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="effective-health-label">Effective HT</span>
											<span class="tooltiptext">
												<span data-i18n="cold-exposure-effective-health-tooltip">The effective health of the character.</span>
											</span>
										</div>
									</label>
									<div style="height:26px;">
										<div class="container-label-input grid__gap_small grid__align_center">
											<span>
												<input type="hidden" name="attr_cold_exposure_effective_health_level" value="10" />
												<span name="attr_cold_exposure_effective_health_level"></span>
											</span>
											<input type="hidden" name="attr_cold_exposure_must_roll" />
											<span class="cold-exposure-roll">
												<input type="hidden" name="attr_cold_exposure_success_note" value="No fatigue loss." />
												<input type="hidden" name="attr_cold_exposure_critical_success_note" value="No fatigue loss." />
												<input type="hidden" name="attr_cold_exposure_fail_note" value="Lose 1 FP." />
												<input type="hidden" name="attr_cold_exposure_critical_fail_note" value="Lose 1 FP." />
												<input type="hidden" name="attr_cold_exposure_modifier_summary" value="" />
												<button type="action" name="act_roll_skill_cold" class="button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=Cold Exposure}} {{skillName=Health Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{cold_exposure_effective_health_level}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{rollModifier=[[@{cold_exposure_health_modifier_total}]]}} {{rollModifierSummary=@{cold_exposure_modifier_summary}}} {{customSuccessNote=@{cold_exposure_success_note}}} {{customCriticalSuccessNote=@{cold_exposure_critical_success_note}}} {{customFailNote=@{cold_exposure_fail_note}}} {{customCriticalFailNote=@{cold_exposure_critical_fail_note}}}"></button>
											</span>
										</div>
									</div>
								</div>

							</div>

						</div>
					</div>

					<div class="grid-cell" style="margin-bottom: 50px;">
						<div class="tools-container">
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="heat-exposure-label">Heat Exposure</span></h3>
									<span class="tooltiptext">
										<span data-i18n="heat-exposure-tooltip">Exposure to heat conditions, see B434.</span>
									</span>
								</div>
							</div>
							<div class="grid-2-column-auto grid__align_center grid__gap_large">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-label">Temperature</span>
											<span class="tooltiptext">
												<span data-i18n="heat-exposure-temperature-tooltip">Enter the effective temperature.</span>
											</span>
										</div>
									</label>
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="number" name="attr_heat_exposure_temperature" value="80" step="1" class="medium-width" />
											<input type="hidden" name="attr_heat_exposure_temperature_fahrenheit" value="80" />
										</span>
										<span>
											<select name="attr_heat_exposure_temperature_unit_type">
												<option value="fahrenheit" data-i18n="unit-type-fahrenheit" selected>Fahrenheit</option>
												<option value="celsius" data-i18n="unit-type-celsius">Celcius</option>
											</select>
										</span>
									</div>
								</div>
								<div class="grid-cell">
									<label>
										<span data-i18n="frequency-label">Frequency</span>
									</label>
									<div>
										<input type="hidden" name="attr_heat_exposure_frequency" value="30" />
										<span name="attr_heat_exposure_frequency"></span> 
										
										<input type="hidden" name="attr_is_intense_heat" value="0" />
										<span class="frequency-minutes" data-i18n="minutes-label">minutes</span>
										<span class="frequency-intense-heat" data-i18n="intense-heat-frequency-label">second, armor protects DR x 3 seconds.</span>
									</div>
								</div>	

							</div>
							<div class="grid-2-column-auto grid__gap_large">

								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<span data-i18n="encumbrance-label">Encumbrance</span>
										</span>
										<span>
											<select name="attr_heat_exposure_encumbrance">
												<option value="0" data-i18n="encumberance-option-none" selected>None, +0</option>
												<option value="-1" data-i18n="encumberance-option-light">Light, -1</option>
												<option value="-2" data-i18n="encumberance-option-medium">Medium, -2</option>
												<option value="-3" data-i18n="encumberance-option-heavy">Heavy, -3</option>
												<option value="-4" data-i18n="encumberance-option-x-heavy">X-Heavy, -4</option>
												<option value="-5" data-i18n="encumberance-option-max">Max, -5</option>
											</select>
										</span>
									</div>
								</div>

								<div class="grid-cell"></div>

							</div>
							<div class="grid-2-column-auto grid__gap_large grid__align_center">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-modifier-label">Temperature Modifier</span>
											<span class="tooltiptext">
												<span data-i18n="heat-temperature-modifier-tooltip">Effective temperature modifier, for every 10° below 0°F or 5° below -18°C, apply a -1 modifier.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_heat_exposure_temperature_modifier" value="0" />
									<span name="attr_heat_exposure_temperature_modifier"></span>
								</div>
								
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="lower-comfort-zone-label">Lower Comfort Zone</span>
											<span class="tooltiptext">
												<span data-i18n="lower-comfort-zone-tooltip">Enter the lower temperature of the comfort zone. Humans have a comfort zone of 35 to 90°F (2 to 32°C). See Temperature Tolerance B93.</span><br />
												<span data-i18n="heat-exposure-lower-comfort-zone-tooltip"><b>Note:</b> Use the <b>Cold Exposure</b> tool to determine the effective lower comfort zone and enter the value here. In order to determine if the character is experiencing <b>Intense Heat</b> we the final range based on temperature tolerance. Intense is calculate as the difference between the lower comfort zone and the upper comfort zone, then multiply by 6. For humans, with tolerance of 35 to 90 °F, <b>Intense Heat</b> occurs at 330°F. (90 - 35) * 6 = 330. B434.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="number" name="attr_heat_exposure_lower_comfort_zone" value="35" step="1" class="medium-width" />
											<input type="hidden" name="attr_heat_exposure_lower_comfort_zone_fahrenheit" value="35" />
										</span>
										<span>
											<span name="attr_heat_exposure_current_unit_type_display"></span>
										</span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="upper-comfort-zone-label">Upper Comfort Zone</span>
											<span class="tooltiptext">
												<span data-i18n="upper-comfort-zone-tooltip">Enter the upper temperature of the comfort zone. Humans have a comfort zone of 35 to 90°F (2 to 32°C). See Temperature Tolerance B93.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<div class="container-label-input grid__gap_small">
										<span>
											<input type="number" name="attr_heat_exposure_upper_comfort_zone" value="90" step="1" class="medium-width" />
											<input type="hidden" name="attr_heat_exposure_upper_comfort_zone_fahrenheit" value="90" />
										</span>
										<span>
											<span name="attr_heat_exposure_current_unit_type_display"></span>
										</span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-tolerance-label">Temperature Tolerance</span>
											<span class="tooltiptext">
												<span data-i18n="heat-temperature-tolerance-tooltip">Enter the character's Heat Temperature Tolerance, each level will increase the upper comfort zone by HT degrees. See Temperature Tolerance B93.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_heat_exposure_temperature_tolerance" value="0" step="1" class="medium-width" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="temperature-tolerance-health-label">Temperature Tolerance HT</span>
											<span class="tooltiptext">
												<span data-i18n="temperature-tolerance-health-tooltip">Enter the character's HT that will be used with Temperature Tolerance.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="number" name="attr_heat_exposure_temperature_tolerance_health" value="10" min="1" step="1" class="medium-width" />
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="intense-heat-threshold-label">Intense Heat Threshold</span>
											<span class="tooltiptext">
												<span data-i18n="intense-heat-threshold-tooltip">The temperature at which the character will start to suffer from intense heat. B434.</span>
											</span>
										</div>
									</label>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_heat_exposure_intense_heat_threshold" value="330" />
									<input type="hidden" name="attr_heat_exposure_intense_heat_threshold_display" value="330 °F" />
									<span name="attr_heat_exposure_intense_heat_threshold_display"></span>
								</div>

								<div class="grid-cell">
									<span data-i18n="effective-comfort-zone-label">Effective Comfort Zone</span>
								</div>
								<div class="grid-cell">
									<input type="hidden" name="attr_heat_exposure_effective_comfort_zone" value="90" />
									<input type="hidden" name="attr_heat_exposure_effective_comfort_zone_display" value="90 °F" />
									<input type="hidden" name="attr_heat_exposure_effective_comfort_zone_modifier" value="0" />
									<input type="hidden" name="attr_heat_exposure_must_roll" value="1" />
									<input type="hidden" name="attr_heat_exposure_must_roll_text" value="must roll" />
									<input type="hidden" name="attr_heat_exposure_current_unit_type" value="fahrenheit" />
									<span name="attr_heat_exposure_effective_comfort_zone_display"></span>
									<i>(<span name="attr_heat_exposure_must_roll_text"></span>)</i>
								</div>

							</div>

							<div class="grid-4-column-auto grid__align_center grid__gap_large">

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="abbreviation-health">HT</span>
											<span class="tooltiptext">
												<span data-i18n="heat-exposure-health-tooltip">Enter the character's HT or HT-based Survival (Desert) skill level. B430.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_heat_exposure_health_level" value="10" step="1" min="1" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="modifier-abbreviation-label">MOD</span>
											<span class="tooltiptext">
												<span data-i18n="heat-exposure-health-modifier-tooltip">Enter an optional HT modifier.</span>
											</span>
										</div>
									</label>
									<div>
										<input type="number" name="attr_heat_exposure_health_modifier" value="0" step="1" class="medium-width" />
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="total-label">TOTAL</span>
											<span class="tooltiptext move-left">
												<span data-i18n="heat-exposure-health-modifier-total-tooltip">The total modifier that will be applied to the final roll.</span>
											</span>
										</div>
									</label>
									<div style="height:26px;">
										<input type="hidden" name="attr_heat_exposure_health_modifier_total" value="0" />
										<span name="attr_heat_exposure_health_modifier_total"></span>
									</div>
								</div>

								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="effective-health-label">Effective HT</span>
											<span class="tooltiptext move-left">
												<span data-i18n="heat-exposure-effective-health-tooltip">The effective health of the character.</span>
											</span>
										</div>
									</label>
									<div style="height:26px;">
										<div class="container-label-input grid__gap_small grid__align_center">
											<span>
												<input type="hidden" name="attr_heat_exposure_effective_health_level" value="10" />
												<span name="attr_heat_exposure_effective_health_level"></span>
											</span>
											<input type="hidden" name="attr_heat_exposure_must_roll" />
											<span class="heat-exposure-roll">
												<input type="hidden" name="attr_heat_exposure_success_note" value="No fatigue loss." />
												<input type="hidden" name="attr_heat_exposure_critical_success_note" value="No fatigue loss." />
												<input type="hidden" name="attr_heat_exposure_fail_note" value="Lose 1 FP." />
												<input type="hidden" name="attr_heat_exposure_critical_fail_note" value="Lose 1d6 FP and suffer heat stroke." />
												<input type="hidden" name="attr_heat_exposure_modifier_summary" value="" />
												<button type="action" name="act_roll_skill_heat" class="button-roll-template sheet-btn sheet-ui-draggable" value="@{roll}&amp;{template:skillRoll} {{sheetStyle=@{chatstyle}}} {{type=Skill Roll}} {{activeDefense=[[0]]}} {{isSkillRoll=[[1]]}} {{showSuccessLabel=[[1]]}} {{characterName=Heat Exposure}} {{skillName=Health Roll}} {{rollResult=[[3d6cs<1cf>6]]}} {{effectiveSkill=[[@{heat_exposure_effective_health_level}]]}} {{showNotes=[[0]]}} {{useCriticalPlusTen=[[@{use_critical_plus_10}]]}} {{popupModifier=@{popup_modifier}}} {{useModTool=[[1]]}} {{displayRollModifierSummary=[[@{display_roll_modifier_summary}]]}} {{rollModifier=[[@{heat_exposure_health_modifier_total}]]}} {{rollModifierSummary=@{heat_exposure_modifier_summary}}} {{customSuccessNote=@{heat_exposure_success_note}}} {{customCriticalSuccessNote=@{heat_exposure_critical_success_note}}} {{customFailNote=@{heat_exposure_fail_note}}} {{customCriticalFailNote=@{heat_exposure_critical_fail_note}}}"></button>
											</span>
										</div>
									</div>
								</div>

							</div>

						</div>
					</div>

				</div>
				
			</div>

			<div class="options macros">
				
				<input type="hidden" name="attr_old_macros_moved" value="false" />
				<div class="grid-standard grid-3-column-equal-width grid__gap_large">
					
					<!-- row #1 -->
					<div class="grid-cell">

						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-one-label">Custom Skill Macro 1</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_one_name" value="Skill" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_one_code"></textarea>
								</div>
	
							</div>
						</div>
						
					</div>
					<div class="grid-cell">
						
						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-two-label">Custom Skill Macro 2</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_two_name" value="Defense" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_two_code"></textarea>
								</div>
	
							</div>
						</div>

					</div>
					<div class="grid-cell">
						
						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-three-label">Custom Skill Macro 3</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_three_name" value="Melee" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_three_code"></textarea>
								</div>
	
							</div>
						</div>

					</div>
					
					<!-- row #2 -->
					<div class="grid-cell">
						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-four-label">Custom Skill Macro 4</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_four_name" value="Ranged" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_four_code"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="grid-cell">
						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-five-label">Custom Skill Macro 5</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_five_name" value="Spell" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_five_code"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="grid-cell">
						<div class="tools-container">
							<div class="section-header">
								<h3><span data-i18n="custom-skill-macro-six-label">Custom Skill Macro 6</span></h3>
							</div>
							<div class="grid-2-column-auto grid__gap_small grid__align_center">
							
								<!-- row #1 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="name-label">Name:</span>
											<span class="tooltiptext">
												<span data-i18n="macro-name-tooltip">Enter a useful name, it will displayed to you when selecting macros to apply to a skill.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<input type="text" name="attr_custom_skill_macro_six_name" value="Macro Six" />
								</div>
	
								<!-- row #2 -->
								<div class="grid-cell">
									<label>
										<div class="standard-tooltip">
											<span data-i18n="macro-label">Macro</span>:
											<span class="tooltiptext">
												<span data-i18n="custom-macro-tooltip">Enter the code for your macro.</span>
											</span>
										</div>
									</label>	
								</div>
								<div class="grid-cell">
									<textarea name="attr_custom_skill_macro_six_code"></textarea>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

		</div>

	</div>

	<!-- ===== ===== ===== ===== Revision History TAB ===== ===== ===== ===== -->
	<div class="tab7">

		<div>

			<h3>
				<span data-i18n="latest-changes-updated-label">Latest Changes: Updated</span>
				<!-- NOTE: set value by using var latestChangesDate = "DATE";  -->
				<input type="text" style="font-size: 20px; font-weight: bold; border-style: none;" name="attr_latest_changes" readonly="readonly"/>
			</h3>
			
			<h3>Suggestions</h3>
			
			<ul>
				<p>Please note: I, Mike W, and MadCoder are not one of the original authors of this sheet. All we have done is to fix a number of small issues, changed some formatting, and implemented some suggested changes. The basic functionality of the sheet has remained the same.</p>
				
				<p>The original authors are Devindra Payment (@Ardnived), Joseph Mason (@sdJasper).</p>

				<p>To report any Issues or a Suggestion, please use the Roll20 forum under Character Sheets & Compendium. I have created a thread named: [GURPS] - Sheet #1 - Thread 2 (that seems to be similar to the naming convention used by other sheets).</p>
				
				<p>https://app.roll20.net/forum/post/10667695/gurps-sheet-number-1-thread-2</p>
					
				<p>In your post, please specify if it is an Issue or Suggestion with as much detail information as possible. Screen shots help a lot! I am just learning to work with HTML and CSS so I may not be able to do everything requested. I make no promises on how fast I may be able to implement a Fix or a Suggestion - so please be patient. -Thanks, Mike W.</p>

				<p>If there are others that are working on or wish to work on this sheet, lets coordinate using the Roll20 forum for now - perhaps later we can use GitHub.</p>
			</ul>
			
			<h4>Version: <span name="attr_announcement_version"></span></h4>

			<p>Pull Request: <span name="attr_latest_changes"></span></p>

			<!-- current version notes: 2.23.1 -->
			<ul>
				<li><b>BUGFIX:</b> A couple of translation updates and fixing a page reference for Aim. Suggested by Spriteanon and Uncle Mojo.</li>
				<li><b>BUGFIX:</b> When adding a brand new spell, not all of the modifiers were correctly added. This has now been fixed.</li>
			</ul>

			<h4>Version: 2.23.0</h4>
			<p>Pull Request: 7/16/2024</p>
			<ul>
				<li><b>BUGFIX:</b> Updated the Roll20.json file link to point to Roll20's master repository, the other link was out of date.</li>
				<li><b>BUGFIX:</b> Fix display of <b>Sort & Indent</b> button, there was a style change that hid the button.</li>
				<li><b>BUGFIX:</b> GCS Exporter. Updated all skills to be treated as a string instead of a number because GCS can return an empty value for a number. Support from EMP TeemoMobile.</li>
			</ul>

			<h4>Version: 2.22.0</h4>
			<p>Pull Request: 7/2/2024</p>
			<ul>
				<li><b>BUGFIX:</b> Fixed bug where sprint value was not calculating correctly for zero encumbrance.</li>
				<li><b>ENHANCEMENT:</b> Combat > Your Hit Locations tab. Added a checkbox to each armor layer. The checkbox indicates if the armor is "On" or "Off". Toggling the checkbox will update the armor summary.</li>
			</ul>

			<h4>Version: 2.21.0</h4>
			<p>Pull Request: 6/18/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Combat > Defense Tab > Active Defense. Updated Parry Heavy Weapon chart to round to decimal places.</li>
				<li><b>BUGFIX:</b> Fixed bug where the spell roll effective skill was using the ranged modifier tool instead of the spell modifier tool.</li>
				<li><b>ENHANCEMENT:</b> Updated the Sprint value to be based on the current encumbrance level.</li>
				<li><b>ENHANCEMENT:</b> Melee skill roll: added the weapon weight.</li>
				<li><b>ENHANCEMENT:</b> For melee and ranged attacks, added a new tool that auto-calculates damage rolls based on thrust and swing damage.</li>
			</ul>

			<h4>Version: 2.20.0</h4>
			<p>Pull Request: 6/13/2024</p>
			<ul>
				<li><b>BUGFIX:</b> Fixed bug where all rolls were showing the note "If parrying weapon is or less, check for breakage. B376." Reported by Niccy_Everson and Cal Godot.</li>
			</ul>


			<h4>Version: 2.19.0</h4>
			<p>Pull Request: 6/12/2024</p>
			<ul>
				<li><b>NEW:</b> Combat > Your Hit Locations Tab. Added a note for <b>Large-Area Injury</b>. If you apply a hit location template, there is now a <b>Large-Area</b> hit location.</li>
				<li><b>ENHANCEMENT:</b> Roll Modifiers Toolbox for Melee attacks. Added a modifier for attacking through unfriendly hex. B388.</li>
				<li><b>ENHANCEMENT:</b> Roll Modifiers Toolbox for Active Defenses. Added a modifier for attack from a side hex. B390.</li>
				<li><b>ENHANCEMENT:</b> Tools > General > Drinking and Intoxication Tool. If drinks consumed is less than ST/4, the die button is replaced by the text "No roll needed." Requested by Demented Avenger.</li>
				<li><b>ENHANCEMENT:</b> Active Defenses. Added a new field for weight of the parrying weapon and tool to calculate weapon breakage. B376.</li>
				<li><b>ENHANCEMENT:</b> Melee Attacks. Added a new field for weight of the attacking weapon and tool to show the parrying weapon's breaking point. B376.</li>
				<li><b>BUGFIX:</b> Skill roll was not setting values for max 9, and summary.</li>
				<li><b>BUGFIX:</b> Technique skill roll was not setting values for max 9, and summary.</li>
				<li><b>BUGFIX:</b> Defense roll was not setting values summary.</li>
				<li><b>BUGFIX:</b> Melee skill roll was not setting values for max 9, summary, hit location, maneuver, and all-out attack.</li>
				<li><b>BUGFIX:</b> Ranged skill roll was not setting values for max 9, summary, hit location, maneuver, and all-out attack.</li>
				<li><b>BUGFIX:</b> Fixed the styling for the <b>Duplicate</b> button for melee and ranged attacks.</li>
			</ul>
			
			<h4>Version: 2.18.0</h4>
			<p>Pull Request: 5/20/2024</p>
			<ul>
				<li><b>NEW:</b> Melee and Ranged damage rolls automatically calculate Blunt Trauma Damage based on rules from <b>Flexible Armor and Blunt Trauma</b> B379.</li>
				<li><b>ENHANCEMENTS:</b>Updated GCS Roll20 Export Code
					<ul>
						<li>Added GCS Equipment.Other to Roll20 Inventory Export.</li>
						<li>Updated Active Defense to replace the "F" and "U" with an empty string. Example, "11U" is updated to "11" for a parry defense. Roll20 only allows numbers for defenses, otherwise the roll will not work.</li>
						<li>Fix bug with Vision Points.</li>
						<li><b>ACTION:</b> Please update your Roll20.js file, see Gear Icon > Import > GCS Instructions.</li>
					</ul>
				</li>
				<li><b>BUGFIX:</b> Fixed issue with adding hit locations, size modifier was incorrectly being applied.</li>
			</ul>

			<h4>Version: 2.17.0</h4>
			<p>Pull Request: 5/14/2024</p>
			<ul>
				<li><b>NEW:</b> Added <b>Drinking and Intoxication</b> tool, located under Tools > General.</li>
			</ul>
			
			<h4>Version: 2.16.0</h4>
			<p>Pull Request: 5/7/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Update Combat Tab > Tools > Demolition > Fragmentation tool; added skill modifiers for hitting targets.</li>
				<li><b>NEW:</b> Added Breaking Bindings to Tools > Structural tools tab. Based on Breaking Bindings rules from GURPS Low Tech Page 130.</li>
			</ul>
			
			<h4>Version: 2.15.0</h4>
			<p>Pull Request: 4/22/2024</p>
			<ul>
				<li><b>NEW:</b> Chat results now have their own set of styles to select from, the value will default to the current character sheet style.</li>
				<li>
					<b>ENHANCEMENT:</b> Under Skills, a new subsection has been added named Familiarities.
					<ul>
						<li><b>USER ACTION:</b> Any skill used to operate equipment, for example - Guns (Pistol), Driving (Automobile), and Electronics Operation (Communications), take a penalty when you are faced with an unfamiliar type of item. You should start updating the appropriate skill equipment Familiarities. (See Familiarity B169).</li>
					</ul>
				</li>
				<li><b>ENHANCEMENT:</b> Under Skills, added popup tooltip for <b>Show Skill Modifier notes (refer to the actual skill description)</b>.</li>
			</ul>
			
			<h4>Version: 2.14.1</h4>
			<p>Pull Request: 4/15/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Improve contrast of colors for selected custom color theme. Requested and reported by Demon83.</li>
				<li><b>ENHANCEMENT:</b> Improve layout and better theme handling for the import tool. Requested and reported by Demon83.</li>
			</ul>
			
			<h4>Version: 2.14.0</h4>
			<p>Pull Request: 4/8/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Grimoire tab, spell tables. Added parent/child relationship and sorting, like inventory items. You could create a parent college (remember to set points to zero!) and then set spells to be children of that college. Helps with organizing spell lists.</li>
				<li><b>ENHANCEMENT:</b> Heat Exposure tool, added formula to determine <b>Intense Heat Threshold</b>.</li>
			</ul>
			
			<h4>Version: 2.13.0</h4>
			<p>Pull Request: 4/1/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Bio/Misc tab, physical description, Added Skin field, requested by Demented Avenger.</li>
				<li><b>NEW:</b> Added the <b>Heat Exposure</b> tool, which can be found under Tools > Environmental.</li>
				<li><b>BUGFIX:</b> Default setting for <b>Use Custom Layer Labels</b> was not setting correctly, this should fix it.</li>
			</ul>
			
			<h4>Version: 2.12.0</h4>
			<p>Pull Request: 3/26/2024</p>
			<ul>
				<li><b>NEW:</b> Added the <b>Cold Exposure</b> tool, which can be found under Tools > Environmental.</li>
			</ul>

			<h4>Version: 2.11.0</h4>
			<p>Pull Request: 3/18/2024</p>
			<ul>
				<li>
					<b>ENHANCEMENTS:</b> Inventory table. Added a text box to store information for use with an inventory button. 
					This button can be clicked to show the content of the text box and run macros.
					<ul>
						<li><b>ACTIONS:</b> You can place macros in the macro content box. If you have a pro subscription you can install
						libraries that can apply modifiers to a stat, such as hit points.</li>
					</ul>
				</li>
			</ul>
			
			<h4>Version: 2.10.10</h4>
			<p>Pull Request: 3/11/2024</p>
			<ul>
				<li><b>NEW:</b> GCS Export/Import, see the instructions on the import tab. Gear Icon > Import tab.</li>
				<li><b>ENHANCEMENTS:</b> Some changes for the importer to work with files generated by the GCS Roll20 exporter.</li>
			</ul>


			<h4>Version: 2.10.10</h4>
			<p>Pull Request: 3/4/2024</p>
			<ul>
				<li><b>BUGFIX:</b> Active Defense Roll Template. Info Notes not showing correctly.</li>
				<li><b>ENHANCEMENTS:</b> A number of behind scenes updates.</li>
			</ul>

			<h4>Version: 2.10.9</h4>
			<p>Pull Request: 2/26/2024</p>
			<ul>
				<li><b>ENHANCEMENT:</b> Ranged table, when determining if the Number of Shots popup should appear, it now requires the recoil to be zero or higher. If it's a negative number, it will assume you're using a 3rd edition rules and so the popup is not needed.</li>
				<li><b>ENHANCEMENT:</b> Hit Location table, increased the width of the Summary columns.</li>
				<li><b>ENHANCEMENT:</b> Hit Location table, added the ability to assign custom labels to the layers.
					<ul>
						<li>Go to the Options tab (gear icon) -> Sheet Options. Scroll to the bottom and look for the section named <b>Hit Location Options</b>.</li>
						<li>Update the labels for each layer as you like.</li>
						<li>Mark the checkbox for <b>Use Custom Layer Labels</b>.</li>
					</ul>
				</li>
				<li><b>ENHANCEMENT:</b> General tab, Current Movement speed. If you don't have enhanced movement, it will now display your sprinting speed, see B394 and B354.</li>
				<li>
					<b>NEW:</b> Added a new rolltemplate named columnlayout. You can use this rolltemplate with your custom macros 
					and can manage a 3 to 5 column table layout. For more information, go to the Help tab, Other sub-tab, 
					and look under the section titled <b>Roll Template 3 to 5 Columns</b>.
				</li>
				<li>
					<b>NEW:</b> Added quick modifier tables to Melee and Ranged tabs. This will allow a player to quickly add a modifier to their attack roll and use 
					the checkbox to apply them. This is helpful if you have a common modifier you like to apply, such as Rapid Attack, Move and Attack, etc.
					<ul>
						<li>
							<b>ACTION:</b> To view the new quick modifier tables, click the <b>Sheet Options (gear icon)</b> tab and then go to the <b>Sheet Options</b> sub tab, 
							look for the section titled <b>Quick Modifier Options</b>.
						</li>
						<li>
							<b>ACTION:</b> If you would like the quick modifiers to visible on new character sheets, 
							you can set the options on the game level by going to your game landing page, 
							go to game settings, and update the options for quick modifiers.
						</li>
					</ul>
				</li>
				<li>
					<b>BUGFIX:</b> Fixed bug where the minimum damage for ranged attacks was not being calculated correctly.
				</li>
				<li>
					<b>BUGFIX:</b> Ranged weapons table, malfunction options. The malfunction options were not being implemented correctly after the conversion to get margin of success/fail and number of shots that hit.
				</li>
			</ul>
			
			<h4>Version: 2.10.8</h4>
			<p>Pull Request: 2/19/2024</p>
			<ul>
				<li>
					<b>ENHANCEMENT:</b> Ranged attack table. If you enter a ROF greater than 1, the attack roll will ask for the number of shots fired and the roll results will show the number of hits based on recoil. If there's no recoil entered, it will assume the recoil is 1.
					<ul>
						<li><b>ACTIONS:</b> The ranged attack table should automatically update the new shots fired macro when the sheet loads, but it's possible it doesn't. In that case, just change the ROF for a ranged attack and the macro should get updated.</li>
					</ul>
				</li>
				<li>
					<b>DISPLAY BUGFIX:</b> Fixed the order of fields for the Modifier Tool Summary box. Reported by Demented Avenger.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Hit Location Table, each hit location has a toggle notes button, in addition there are two links to open and close all notes. Requested by Tommi.
				</li>
			</ul>

			<h4>Version: 2.10.6</h4>
			<p>Pull Request: 1/8/2024</p>
			<ul>
				<li><b>ENHANCEMENTS:</b> Updated layout for tools <b>Damage to Objects</b> and <b>Repairs</b>. Added option to select pounds or kilograms for <b>Damage to Objects</b>.</li>
				<li><b>NEW:</b> Added <b>Stealth vs Perception</b> tool.</li>
				<li><b>ENHANCEMENT:</b> Increased input width for Height. Changed drop-down options from <b>WILL</b> to <b>Will</b>. Requested by Uncle Mojo.</li>
				<li><b>ENHANCEMENT:</b> For chat damage roll results, moved <b>Damage Notes</b> just above the damage type description.</li>
			</ul>
			
			<h4>Version: 2.10.5</h4>
			<p>Pull Request: 1/2/2024</p>
			<ul>
				<li><b>NEW:</b> Added <b>Climbing</b> tool, located under Tools > Feats. Select <b>User Metric Distances & Volumes</b> to see metric values.</li>
				<li><b>NEW:</b> Added <b>Digging</b> too, located under Tools > Feats. Select <b>User Metric Distances & Volumes</b> to see metric values.</li>
				<li><b>BUGFIX:</b> Updated title from <b>Detailed Format</b> to <b>Detailed</b>. Reported by Tommi.</li>
				<li><b>ENHANCEMENT:</b> For the <b>Your Hit Locations</b> tab, added a border around damage taken to increase visibility. Suggested by Tommi.</li>
				<li><b>ENHANCEMENT:</b> Refactored the tool <b>Object Hit Points</b> to <b>Damage to Objects</b> based on rules from B483.</li>
			</ul>
			
			<h4>Version: 2.10.4</h4>
			<p>Pull Request: 12/4/2023</p>
			<ul>
				<li><b>NEW:</b> Added new sheet option <b>Use Metric Distances</b>, which is currently only implemented by the <b>Travel Time and Distance tool.</b></li>
				<li><b>ENHANCEMENT:</b> Travel Time and Distances tool.
					<ul>
						<li>The <b>Add Items</b> button is functional and can be used to add a number of default skills to use.</li>
						<li>If the sheet option <b>Use Metric Distances</b> has been selected, values will display in metric.</li>
					</ul>
				</li>
				<li>
					<b>BUGFIX:</b> Updated default values for <b>Editable Wound Modifier Notes</b>.
				</li>
			</ul>

			<h4>Version: 2.10.3</h4>
			<p>Pull Request: 12/4/2023</p>
			<ul>
				<li><b>BUGFIX:</b> Fixed bug where you had to select a sheet-type at the bottom of the character sheet to see the Tools menu.</li>
				<li><b>BUGFIX:</b> Fixed bug where custom macros were added to damage rolls for melee and ranged attacks.</li>
				<li><b>BUGFIX:</b> Fixed bug with macros not honoring the checkboxes correctly due to duplicate fields.</li>
				<li><b>BUGFIX:</b> Fixed bug with range tool where the braced modifier wasn't updating correctly. Reported by Ctelin Ajira.</li>
				<li><b>ENHANCEMENT:</b> Added sort by option for the <b>Hearing Distance</b> tool.</li>
				<li><b>NEW:</b> Added the <b>Travel Times and Distances</b> tool, which is based on <b>Dungeon Fantasy 16 Wilderness Adventures</b> p20-24</li>
				<li>
					<b>NEW:</b> Phase One of updating Rolls to use Roll's Custom Roll Parser. This allows us to manipulate the data for rolls.
					<ul>
						<li>
							All skill and attribute rolls that are <b>NOT</b> in a repeating section of have been updated to use the Roll Parser. 
							They now show difference in your roll.
						</li>
						<li>
							On the Combat Tab, Tools Sub Tab, the <b>Fragmentation Damage Skill Roll</b> will show the number of rounds that hit the 
							target, based on a recoil of 3. 
						</li>
					</ul>
				</li>
			</ul>
			
			<h4>Version: 2.10.2</h4>
			<p>Pull Request: 11/27/2023</p>
			<ul>
				<li><b>REVISION:</b> Moved the custom macros for each repeating table to a Global Custom Macro section, under the Options tab.
					<ul>
						<li>There will be a total of six global custom skill macros, and you can provide a name and the macro you created.</li>
						<li>For most of the repeating tables with skill rolls, you will be able to apply your custom macros to a skill by expanding the skill
							and checking which custom macros you would like to use for that skill.
						</li>
						<li>
							<b>ACTION:</b> If you have created a custom macro, you will find it under the new  Global Custom Macro. I would suggest
							renaming the macro to something appropriate. Next, apply the macro to the skills of your choice, you are no longer limited to a 
							specific repeating table.
						</li>
					</ul>
				</li>
				<li><b>NEW:</b> Add a <b>Hearing Distance</b> tool to help calculate hearing modifiers based on sound and listener's distance.</li>
				<li><b>ENHANCEMENT:</b> Tweaked layout of roll result for success/fail notes and layout of custom note boxes.</li>
			</ul>

			<h4>Version: 2.10.1</h4>
			<p>Pull Request: 11/20/2023</p>
			<ul>
				<li><b>REVISION:</b> For roll results, moved the Target row (AKA Effective skill) just after the roll, followed by possible success/fail notes. Had to do some fancy work to get it to work right.</li>
				<li><b>REVISION:</b> If damage type is one these "Crushing (cr)", "Affliction (aff)", "Special (spec)", "Knockback (knock)", the minimum damage is set to zero.</li>
				<li><b>REVISION:</b> Update tooltip for Fright check threshold.</li>
				<li><b>ENHANCEMENT:</b> Chase Control Sheet is completely functional with tooltips, handling static states, and additional information when rolling a chase skill roll.</li>
				<li><b>NEW:</b> Added a new top-level item named <b>Tools</b>. The Tools has several tabs for different types of tools for use with GURPS and general roleplaying.</li>
				<li><b>NEW:</b> Tools added: Team Effort, Extra Effort, and Object Hit Points.</li>
			</ul>
			
			
			<h4>Version: 2.10.0</h4>
			<p>Pull Request: 11/13/2023</p>
			<ul>
				<li>
					<b>NEW:</b> Added a new Sheet type for Chases. The chase control sheet is functional, 
					the next iteration will include tooltips, revisions, and more helpful instructions.
				</li>
				<li>
					<b>NEW:</b> Added a sheet type selector to the footer in case there are weird things with Roll20 that break your character sheet.
				</li>
				<li>
					<b>FIX:</b> Roll Result Template. Moved the target field (aka effective skill) above the actual roll 
					since the original target field was getting lost after the success/fail notes. Resolved a couple critical fail notes logic bugs.
				</li>
				<li>
					GURPS 2.9.20 - Re-added Updates
				</li>
				<li>
					<b>ENHANCEMENT:</b> Traits tab, languages. Added an action button to expand a notes area for each language.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Roll template update, moved <i>Notes:</i> to a separate row and then applied a title prefix, if needed. For example, if you entered 
					notes for a Ranged Attack, the roll result chat will have a title called <b>Weapon Notes</b> then the notes are displayed below it.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Combat tab, ranged sub-tab, updates to Thrown Object Tool. Added additional notes and ability to link to DX, Skill, or Technique.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Updated tooltips for Active Defense, Dodge and Retreat (vs. Melee Attacks Only), ACC, AIM BONUS, and Unconsciousness.
				</li>
				<li>
					<b>ENHANCEMENT:</b> All damage rolls automatically implement negative modifier rules from B378 based on appropriate damage type, 
					<i>"A negative modifier can't reduce damage below 0 if the attack does crushing damage, or below 1 if it does any other type of damage."</i>
				</li>
				<li>
					<b>BUGFIX:</b> Fixed issue during load of the latest version of the character sheet. The modifier columns for languages were not calculating correctly.
				</li>
			</ul>
			
			<h4>Version: 2.9.19</h4>
			<p>Pull Request: 10/23/2023</p>
			<ul>
				<li>
					<b>BUGFIX:</b> Languages were not totaling correctly during a load of a new version of the character sheet. This is has been fixed, reported by Lloyd J. 
				</li>
				<li>
					<b>BUGFIX:</b> Possible issue with Spell Rolls. There's a field named `spell_roll_max_nine` that is no longer needed. This field was completely removed now, so if you had issues with Spells rolls, it should be fixed now. Reported by user on Discord channel.
				</li>
				<li>
					<b>NEW:</b> Initial development of selecting a customized sheet, such as a vehicle sheet.
				</li>
			</ul>


			<h4>Version: 2.9.18</h4>
			<p>Pull Request: 10/16/2023</p>
			<ul>
				<li>
					<b>ENHANCEMENT:</b> Tweaks to several tooltips.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Subdivided the <b>Bio\Misc</b> into sub-tabs for Bio, Reactions, Training, and Campaign, which is a placeholder for future fields.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Grimoire tab, repeating spells table. Added a new option named <b>Rule of 16</b>, checked by default,
					found by clicking the Gear icon on the nav menu, then the Sheet Options sub-tab. It is under the section labeled <b>Spell Options.</b>
					If checked, the effective skill of a spell that requires a resistance will use the Rule of 16. B349.
				</li>
				<li>
					<b>BUGFIX:</b> Death check roll was using the Unconscious level, fixed to use the Death Check level. Noticed by Ctelin Ajira.
				</li>
			</ul>
			
			<h4>Version: 2.9.17</h4>
			<p>Pull Request: 10/9/2023</p>

			<ul>
				<li>
					<b>NEW:</b> Added custom macro text boxes for Skills, Defense, Melee, Ranged, and Spell rolls. To view the custom macros, expand the notes section at the top of each section.
				</li>
				<li>
					<b>ENHANCEMENT:</b> On the Option Rules tab, added a <b>Reset Spell Notes</b> button. If clicked, the existing notes are replaced with the original notes.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Under Sheet Options\Rules, added text entries for the Success\Fail\Crit Success\Crit Fail text for Fright Check, Unstun, Knockdown and Stunning, and Unconsciousness.
				</li>
				<li>
					<b>ENHANCEMENT:</b> Under the General Page for HT, updated the ToolTip.
				</li>
				<li>
					<b>FIX:</b> Under Combat\Ranged for the Ranged Calculator Tool, fixed a synchronization issue with the <b>Reset</b> button that wasn't applying the updates to modifier tool.
				</li>
			</ul>
			
			<h4>Version: 2.9.16</h4>
			<p>Pull Request: 9/18/2023</p>

			<ul>
				<li>
					Added <b>Reason for Mod</b> to Hit Point and Fatigue Point columns.
				</li>
				<li>
					Updated tooltip notes for Recover from Physical Stun Check, Knockdown and Stunning Check, Unconsciousness Check, and Death Check.
				</li>
				<li>
					<b>Range Calculator Tool:</b> Updated modifier summary to include the number of shots fired. Fix macro help tooltip for the <b>Fired</b> input box.
				</li>
			</ul>

			<h4>Version: 2.9.14.1</h4>
			<p>Pull Request: 9/18/2023</p>

			<ul>
				<li>
					Updated toggle buttons from Arrow buttons to an intuitive Plus/Minus buttons, with hover state to help provide feedback. The update also reduces the footprint of the toggle button.
				</li>
				<li>
					Added additional reason modifier buttons and text box for attributes, which involved tweaking the layout to add space for the toggle buttons.
				</li>
				<li>
					Updated tooltips for GURPS Horror Stress & Derangement rules.
				</li>
			</ul>

			<h4>Version: 2.9.14.1</h4>
			<p>Pull Request: 9/11/2023</p>

			<ul>
				<li>
					Added a toggle for ST, DX, IQ, Per, and Will attributes. Clicking the toggle will show/hide a reason for modifier box.
					<ul>
						<li>CSS fix to allow entering values for these attributes.</li>
					</ul>
				</li>
				<li>Melee tab, roll modifier tool dialog box. Fixed bug where selecting the posture doesn't update the modifiers. Reported by valkray</li>
				<li>Roll Modifier Dialog Box. Added tooltip for the Traits heading and added a section titled Temporary Traits, which will cover cases such as spells and other mitigators.</li>
			</ul>
			
			<h4>Version: 2.9.13</h4>
			<p>Pull Request: 9/5/2023</p>
			
			<ul>
				<li>Combat Tab. Melee and Ranged attack tables. Added a <b>Duplicate</b> button. Click the button to duplicate the attack, useful for quickly creating alternate attacks based on ammo type or something similar.</li>
				<li>Traits Tab. Disadvantages table. Added a checkbox labeled <b>Check to make the results a whisper to GM only</b>. If checked, the control roll will be whispered to you and the GM.</li>
			</ul>
			
			<h4>Version: 2.9.12</h4>
			<p>Pull Request: 8/28/2023</p>
			
			<ul>
				<li>On character load. The roll modifier toolbox for each section is cleared out, ready for a clean start.</li>
				<li>Ranged Calculator Tool. Added a checkbox for Bracing your weapon.
					<ul>
						<li>Recent incorrect translation for the title caused display issue, made updates to prevent display issue.</li>
					</ul>
				</li>
				<li>Roll modifier tools. Style update to move roll modifiers tools above the repeating tables to allow for additional updates later.</li>
				<li>Grimoire Tab. 
					<ul>
						<li>The modifiers for <b>On Penalty</b> and <b>Concentration Penalty</b> are now automatically applied to spell skill levels.</li>
						<li>Added a new custom spell modifier box, this covers special cases like taking a potion that raises IQ but not spell skill levels.</li>
					</ul>
				</li>
				<li>
					List of minor changes: success/fail notes in chat updated to use correct font. Updated warning text for effective Defense Score of 0 or less.<br />
				</li>
			</ul>

			<h4>Version: 2.9.11</h4>
			<p>Pull Request: 8/14/2023</p>
			<ul>
				<li>
					Shotgun Damage Tool. Changed the title, added some additional tooltips, and moved the DR multiplier note next to the damage roll.
				</li>
				<li>
					Spell Roll Chat Log. Streamlined some of the content so spells take up a little less space.
				</li>
				<li>
					List of minor changes: roll results notes font size changed from 13px to 12px.<br />
					Moved the custom success/fail messages for spells just below the roll result in chat dialog.<br />
					Fixed bug where repeating languages were not calculating correctly.<br />
				</li>
			</ul>

			<h4>Version: 2.9.10</h4>
			<p>Pull Requst: 7/31/2023</p>
			<ul>
				<li>
					Traits Tab. Improve ability to drag/drop repeating culture items.
				</li>
				<li>
					Skills Tab. Moved the field <b>Reason for MOD (Modifier):</b> to it's own line and expanded the input field.
				</li>
				<li>
					Active Defense Rolls. Updated title of roll template to be [type of defense] using [defensive name]. Example, <b>Unarmed Parry</b> using punch.
				</li>
				<li>Several small changes to text information; Active Defense notes for <b>INFO</b> field updated to show page 269 instead of 208.</li>
				<li>
					Several small changes to text information; Active Defense notes for <b>INFO</b> field updated to show page 269 instead of 208. 
					Added some additional help text show if malfunction is enabled or disabled.
				</li>
				<li>
					Repeating Skill Chat Log Roll. If there's a Tech Level associated with the skill, it will be appended to the name.
				</li>
				<li>
					Melee Tab - Max skill of 9 checkbox. Fixed bug where the summary would show "Mighty Blow 1 FP per attack. +2 Damage or +1 per die!". 
				</li>
			</ul>

			<h4>Version: 2.9.9</h4>
			<p>Pull Requst: 7/17/2023</p>
			<ul>
				<li>
					Inventory Tab. Increased the indent level of child items and increased the number of indents to 6 and other code improvements to prevent bugs.
				</li>
				<li>
					Combat -> Defense Tab. Updated repeating active defenses to show DB notes.
				</li>
			</ul>

			<h4>Version: 2.9.8</h4>
			<p>Pull Request: 4/18/2023</p>
			<ul>
				<li>
					Inventory Tab. Added a <b>Sort & Indent</b> button. The button will sort the inventory alphabetically and then update 
					the indent level of a child item.
				</li>
				<li>
					Import GCA5. Added a button to delete repeating sections/tables before importing a character.
				</li>
			</ul>

			<h4>Version: 2.9.7</h4>
			<p>Pull Request: 4/2/2023</p>
			<ul>
				<li>
					Bugfix: Stress and Derangement wasn't being divided by 2, rounded up.
				</li>
			</ul>

			<h4>Version: 2.9.5</h4>

			<p>Pull Request: 3/20/2023</p>

			<ul>
				<li>My Modifier on Chat Window Skill Rolls. A new row was added to the chat window to show what number you entered in the pop-up dialog box.</li>
				<li>
					New Sheet Option. <b>Display Roll Modifier Summary in Chat Window</b>. If checked (by default), the roll chat window will show a summary of modifiers, if any. 
					This option is available on the campaign level and character sheet level.
				</li>
				<li>
					Combat Tab - Common information tab. Fixed the tooltip for Size Modifier, this refers to <b>your</b> Size Modifer. Reported by underjack.
				</li>
				<li>
					Chat Window Roll Results. Added some formatting, including highlighting the <b>Malfunction</b> warning.
				</li>
				<li>
					Grimoire tab. Added collapsible notes area.
				</li>
				<li>
					Traits notes, removed some unnecessary text from default critical fail/success notes.
				</li>
				<li>
					Repeating Melee and Ranged Tables. Increased the width of the <b>Reference</b> field and updated tooltip.
				</li>
				<li>
					Hit Location & Armor Table. Added a new column to show the final to hit penalty, it will total the modifier for the hit location and the Size Modifier. 
					This should avoid weird syncing issues when changing hit location and size modifiers. Based on feedback provided by underjack.
					<ul>
						<li>
							<b>Note:</b> When the sheet is updated, it will attempt to remove the size modifier from the hit location modifier. 
							However, this may not work, you may have to manually adjust the hit location modifier.
						</li>
					</ul>
				</li>
				<li>
					Added new Help Section. This is the first iteration and will be expanded and revised over time.
				</li>
			</ul>

			<h4>Version: 2.9.4</h4>

			<p>Pull Request: 2/6/2023</p>

			<ul>
				<li>Wound Modifier Notes: Added formatting to improve legibility on roll template.
					<ul>
						<li>To update the Wound Modifier Notes for an existing character, go to the <b>Options->Rules</b> tab and under the section <b>Editable Wound Modifier Notes</b> click the reset button.</li>
					</ul>
				</li>
				<li>
					Slam, Falling, and Collision damage notes revisions. Added damage type to Falling and Collision. If the damage type is other than crushing damage is halved.
					<ul>
						<li>Notes in roll template. Collapsible notes section should be available when the character sheet is updated to work with Roll20s non-legacy html/css.</li>
					</ul>
				</li>
			</ul>

			<h4>Version: 2.9.3</h4>

			<p>Pull Request: 1/20/2023</p>

			<ul>
				<li>
					Revised how the <b>Combat Reflexes</b> checkbox modifies Fright Check and Dodge. It no longer directly updates the Fright and Dodge Modifier input boxes, 
					instead hidden fields are used to store the values. This will be more reliable and avoids conflicts with users who don't use the combat reflexes checkbox. 
					This also fixes an error that was occurring when importing characters.
					<ul>
						<li><b>NOTE:</b> When updating to the newest character sheet version, if you had combat reflexes checked, it should <b>move</b>...
						<li>
							the <b>+2 fright check bonus</b> from the Fright Check Modifier Input box to the new Combat Reflexes Fright Check Modifier.
							You can see this modifier by hovering over the tooltip for <b style="color: red;">Fright</b>.
						<li>
							the <b>+1 dodge bonus</b> from the Dodge Modifier Input box to the new Combat Reflexes Dodge Modifier.
							You can see this modifier by hovering over the tooltip for <b style="color: red;">Dodge</b>.
						</li>
					</ul>
					<li>
						GCA5 Point Summary Table. Split points for Cultural Familiarities into a separate row.
					</li>
					<li>
						Combat tab - Damage table. Updated the layout by moving <b>Wounds</b> and <b>Notes</b> text boxes below the armor location data row. 
						The summary table is now editable but be aware that editing one of the other layer text boxes will overwrite any changes you made.
						The order of the columns changed a little in order to accommodate the responsiveness of different armor layers.
					</li>
				</li>
				<li>
					Minor bugfix when adding a brand new language to set default values correctly.
				</li>
				<li>
					General tab - Left attribute column. Added a new section for Stress and Derangement for GURPS Horror 4th Edition.
				</li>
				<li>
					Combat - Defense Tab. Fixed bug where the note on the roll table <b>Alert: Max effective skill is 9</b> is displayed for new characters whenever an active defense is rolled.
				</li>
			</ul>
			
			<h4>Version: 2.9.2.2</h4>

			<p>Pull Request: 1/16/2023</p>

			<ul>
				<li>2.9.2.2 - Added a fix for broken techniques table. Reported by JanMikal.</li>
				<li>2.9.2.1 - Added a quick fix to the default values when adding a new language.</li>
				<li><b>Important:</b> Point Summary Table. Added a new option for the GCA5 format. In addition, any negative attributes or a negative racial template total are treated as disadvantages.</li>
				<li>For Skills, Melee, and Ranged tables. If the Max skill of 9 is visible and if it is checked/unchecked, then the effective skill is now updated to reflect the checkbox.</li>
				<li>Roll Modifier Tools. Each repeating section has a toolbar to modify the effective skill and other roll traits.
					<ul>
						<li>A few options were added to the <b>Roll Modifiers Toolbar</b> and the syncing of data between the <b>Roll Modifiers Toolbar</b> and <b>Roll Modifiers Toolbox</b> have been improved.</li>
						<li>The buttons to view the <b>Roll Modifiers Toolbox</b> is always available now, you no longer have to set the character sheet options or the Campaign Options to view them.</li>
					</ul>
				<li>Repeating Skills - Attribute drop-down. The value for <b>10</b> is highlighted to show that a non-standard value was selected. This is helpful if something happened while importing the character.</li>
				<li>Repeating Languages - Add a checkbox for Language Talent. If checked the drop-down will be updated to show the new costs. You can also manually modify the costs of spoken/written for special circumstances.</li>
				<li>Repeating Ranged Attacks - Fixed bug where malfunction was modifying the effective skill.</li>
				<li>General Tab - The <b>turning and velocity modifiers</b> tool is no longer hidden by a toggle button.</li>
				<li>Grimoire Table
					<ul>
						<li>Updated the tooltip for <b>Resist</b> column name.</li>
						<li>Added Difficulty <b>T/H</b>. This covers the situation for ritual magic spells. <b>Suggestion:</b> Set the points to 0 and use the modifier to get the correct spell level. Place the magic ritual spell on the Techniques table.</li>
					</ul>
				</li>
				<li>GCA5 Import. Equipment cost is rounded to 2 decimal places. Weight is rounded to 3 decimal places.</li>
				<li>Predefined Dodges - For Dodge, Dodge and Retreat, and Dodge and Drop, the roll result on the chat window will show current modifiers from HP and/or HP loss and encumbrance level.</li>
			</ul>
			
			
			<h4>Version: 2.9.1</h4>

			<p>Pull Request: 10/12/2022</p>

			<ul>
				<li>Updated all Macro Tooltips to use a standard, more useful naming convention.</li>
				<li>Several minor updates to tooltips.</li>
				<li>For new character sheets, there are now default values for a trait's (Advantages/disadvantages) critical success and failure notes.</li>
				<li>Shotgun Tool. Added roll template note multipliying targets DR.</li>
				<li>Hit Location - Low Tech. Added new hit locations and notes.</li>
				<li>Melee and Ranged Attacks. Renamed Success and Fail labels to Hit and Miss. Added reference field and display on roll template.</li>
				<li>Technique Roll Template. Added parent name below the name of the technique.</li>
				<li>Combat - Defense tab. Updated tooltip for Dodge and Drop.</li>
			</ul>

			<h4>Version: 2.9.0</h4>

			<p>Pull Request: 10/12/2022</p>

			<ul>
				<li>Options -> Import subtab.
					<ul>
						<li>This is a new feature with the ability to import GCA5 characters and can be used for importing GCS (once an exporter has been built) characters.</li>
						<li><b>NOTE:</b> The GCA4 Import has been depracted and will not be updated.</li>
					</ul>
				</li>
				<li>
					A few tooltip updates requested by Captain Joy.
				</li>
				<li>
					Skill Rolls. Rolls of <span style="color:#247305;font-weight: bold;">1</span> will be highlighted <span style="color:#247305;font-weight: bold;">Green</span>, while rolls of <span style="color:#730505;font-weight: bold;">6</span> are highlighted <span style="color:#730505;font-weight: bold;">Red</span>. Requested by Tommi.
				</li>
				<li>
					Removed minimum value for trait levels, to allow for possible 0 or negative levels. Requested Alexander W.
				</li>
				<li>
					Combat tab. Defense sub-tab. Repeating defense, added tooltip for Talent Level.
				</li>
			</ul>
			
			<h4>Version: 2.8.4</h4>

			<p>Pull Request: 9/6/2022</p>
			<ul>
				<li>Options tab. Sheet Options sub-tab. Updated <b>Resync</b> button to change colors when clicked. Thanks to Onyxring's Roll20Async functions!</li>
				<li>
					Repeating Skills, attribute drop-down. The character sheet uses an old method to link skills to an attribute. The old method might not trigger correctly
					when an attribute like Dexterity is changed. Solved the issue by tricking the system into resyncing skills when an attribute is changed.
				</li>
			</ul>

			<h4>Version: 2.8.3</h4>

			<p>Pull Request: 9/1/2022</p>	

			<ul>
				<li>
					Options Tab. Sheet Options sub-tab. Resync button - when resyncing skills and and spells, it now pulls the latest attribure value. 
					Depending on the size of character sheet and other performance issues, sometimes updating an attribute like Dexterity doesn't 
					update all the related skills that use that attribute.
				</li>
			</ul>
			
			<h4>Version: 2.8.2</h4>

			<p>Pull Request: 8/29/2022</p>	

			<ul>
				<li>
					Options. Sheet-options tab. Added initial <b>Resync</b> button. 
					First iteration resyncs Skills, Techniques, and spells, along with items linked to them.
					Followed by resyncing the weight and cost of items in the inventory.
				</li>
			</ul>

			<h4>Version: 2.8.1</h4>

			<p>Pull Request: 7/31/2022</p>	

			<ul>
				<li>Skills Tab. Add a collapsible notes area.</li>
				<li>Skills Tab. Added an indicator to show a skill has <b>Conditional notes</b></li>
				<li>Combat Tab. Add a collapsible notes area.</li>
				<li>Combat Tab. Defense sub-tab. Increased the height of the <b>DEFENSE BONUS (DB) NOTES</b> box.</li>
				<li>New Slam Tool. Moved to Tools sub-tab.</li>
				<li>Editable Wound Modifier Notes: Updated initial default notes to include <b>Injury to Unliving, Homegenous, and Diffuse Targets. B380</b>. 
					Requested and notes provided by kawaishi. 
					<b>NOTE:</b> If you made changes to one or more wound modifier notes, you will not see the most recent rule updates. However, you can use the new <b>reset</b> button to get them.
				</li>
			</ul>

			<h4>Version: 2.8.0</h4>

			<p>Pull Request: 7/26/2022</p>	

			<ul>
				<li>
					Repeating Ranged Table. If the malfunction value is used and the malfunction value is lower than the effective skill, the malfunctin 
					value will be used as the effective skill. This will prevent confusion if your roll is says hit but the malfunction description appears.
				</li>
				<li>
					Repeating Skills Table. Added new <b>Conditionals</b> textarea. Useful for keeping track of conditional modifiers for a skill. Such as <b>Navigation (Land): </b> <i>+1 from Compass</i>.
				</li>
				<li>
					Add note to armor divisor, values are rounded down.
				</li>
				<li>
					Combat Tab. Melee sub-tab. Add Slam calculator tool, taylored to the slam tools, instead of using the generic collision/falling damage tool.
				</li>
				<li>
					Combat Tab. Defense sub-tab. Removed misleading success notes for Dodge & Retreat rolls. Reported by Uncle Mojo.
				</li>
			</ul>

			<h4>Version: 2.7.9</h4>

			<p>Pull Request: 3/15/2022</p>	

			<ul>
				<li>
					Combat Ranged tab. Updated the <b>Range Calculator</b> tool so you don't have to check the sheet option <b>Use Ranged Attack Modifier Tool</b>. 
					If you click the <b>Apply</b> button for the Range Calculator tool, it will apply the modifiers and you will see them on the results table.
				</li>
				<li>
					Traits Tab. Increased the size of the notes text boxes for Advantages, Disadvantages, and Racial Traits.
				</li>
				<li>
					Active Defenses. When adding a brand new active defense, the Combat Reflexes bonus is now applied to the final base skill
					instead of adding a modifier bonus. Missed feature when converting Combat Reflexes in Version 2.7.8.
				</li>
				<li>
					Active Defenses. Added the option to <b>Dodge</b> or <b>Current Dodge</b> as a link type.
				</li>
			</ul>

			<h4>Version: 2.7.8</h4>

			<p>Pull Request: 3/1/2022</p>			

			<ul>
				<li>Updated the text for tooltips, descriptions, and <b>Add to Turn Order</b> result.</li>
				<li>Added some additional notes to Editable rules for damage types. <b>NOTE:</b> You can only see the new text if you start a new character.</li>
				<li>Changed a number of labels for <b>Weight</b> to <b>LBS</b> for pounds, this is due to the new <b>Use Metric Weight</b> option.</li>
				<li>
					Added new checkbox option for <b>Use Metric Weights</b>. The option can be selected for a specific character sheet 
					or on the <b>Default Sheet Options</b>. If checked, labels will be changed to show KG and weight formulas updated as necessary.
					<ul>
						<li>
							I did a number of tests and tried to find all the locations for weights/pounds and update corresponding formulas, 
							but if you find an error please let us know.
						</li>
					</ul>
				</li>
				<li>
					Size Modifier Costs for Strength, Hit Points, Lifting ST, and Striking ST was showing the wrong message if you didn't enter 
					the minimum number of Character Points for the attribute. This has been fixed. Reported Niccy.
				</li>
				<li>
					Combat Reflexes checkbox was updated to be more intuitive when updating the items from the custom Active Defenses table. Requested by Captain Joy.
					<ul>
						<li>
							When Combat Reflexes is checked, it will apply a bonus to the final skill level, 
							avoiding confusion when updating the mod column and reason for mod description.
						</li>
						<li>
							The first time your character sheet loads with this new version, it should convert
							custom active defenses to this new method. If you had combat reflexes checked, it will 
							remove the +1 bonus to the mod column and remove the "+1 from combat reflexes" reason for mod description.
						</li>
						<li>
							I would suggest unchecking/checking Combat Reflexes to make sure the conversion worked. 
							You may also need to remove the "+1 from combat reflexes" since it does an exact match and if 
							you modifed the description it might not have gotten removed.
						</li>
					</ul> 
				</li>
			</ul>

			<h4>Version: 2.7.7</h4>

			<p>Pull Request: 2/18/2022</p>
			
			<ul>
				<li>
					Removed a modern javascript operator that wasn't supported by Roll20's API. If you had custom API script, you may have noticed this error.
					This should be fixed now.
					<ul>
						<li>SyntaxError: Decimals with leading zeros are not allowed in strict mode.</li>
						<li>syntaxerror unexpected token '.'</li>
					</ul>
				</li>
				<li>
					Updated the link to the Community Forum GURPS Thread. 
				</li>
			</ul>

			<h4>Version: 2.7.6</h4>

			<p>Pull Request: 2/13/2022</p>

			<ul>
				<li>Updated the hover names for macro help to show the correct usage of the macro. Example change <i>Macro: @{hit_points|max}</i> or <i>Macro: @{NAME|hit_points|max}</i> </li>
				<li>
					Bio\Misc Tab. Apply Size Modifier checkbox. The apply modifier now works with Hit Points, Striking ST, and Lifting ST. 
					Added some additional feedback by updating the tooltips for points per level and warning notes if you didn't spend the correct amount. 
					Reported and suggested by Niccy.
				</li>
				<li>
					GCA4 Import Bugfix. If an advantage has an melee or ranged attack with NO skill level (like the Leech advantage), this breaks the import.
					Added a method to handle that case. Reported by Lloyd J.
				</li>
				<li>
					Huge thanks to Paulo for providing the Portuguese translations and contributing a number of bugfixes and updates to the character sheet.
				</li>
				<li>
					Other Languages currently being translated are French and Russian, huge thanks to our volunteer!
				</li>
			</ul>

			<h4>Version: 2.7.5</h4>

			<p>Pull Request: 1/13/2022</p>

			<ul>
				<li>Defense table. Fixed display issues with half and quarter damage notes.</li>
				<li>Defense table. Added note section next to dodges to indicate encumbrance penalty was applied.</li>
				<li>Defense table. Combat Reflexes. If adding a brand new defense, Combat Reflexes will be added in, if checked.</li>
				<li>
					Defense table. Combat Reflexes. Previously when Combat Reflexes was checked, the Reason for Mod was prepended with <i>+1 from combat reflexes. </i>. 
					This has been updated to use <i>[+1 from combat reflexes]</i>. This will help show that this description was automatically added after checking 
					Combat Reflexes. Please don't change this description, since it will be removed when unchecking Combat Reflexes, if it's changed, then the description
					will not get deleted.
					<ul>
						<li>If you have already checked Combat Reflexes, simply uncheck then check Combat Reflexes to update the repeating tables.</li>
						<li>
							Also, be sure to check your final modifiers and description when checking/unchecking Combat Reflexes, especially if you 
							manually added in Combat Reflexes or if you used the previous version where the description was prepended with <i>+1 from combat reflexes.</i>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div> <!-- .tab7 -->

	<div class="tab8">

		<div class="plain-text">
			<p>
				<b>Alpha Release.</b> This is the initial release of the <b>Help</b> Tab. You can provide feedback on the <b>Roll20 Forum - [GURPS] - Sheet #1 - Thread 2</b>
				or the <b>GURPS R20-CS</b> discord channel.
			</p>
		</div>

		<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
		<div class="tabbed">
			
			<!-- tabs -->
			<label>
				<input type="radio" name="attr_help_tabs" value="get-started" class="tab-control" checked />
				<span data-i18n="getting-started-label">Getting Started</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="general" class="tab-control" />
				<span data-i18n="tab-general">General</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="traits" class="tab-control" />
				<span data-i18n="traits-label">Traits</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="bio" class="tab-control" />
				<span data-i18n="tab-bio-misc">Bio\Misc</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="skills" class="tab-control" />
				<span data-i18n="skills-label">Skills</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="combat" class="tab-control" />
				<span data-i18n="tab-combat">Combat</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="inventory" class="tab-control" />
				<span data-i18n="tab-inventory">Inventory</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="grimoire" class="tab-control" />
				<span data-i18n="tab-grimoire">Grimoire</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="gear" class="tab-control" />
				<span data-i18n="gear-tab-label">Gear Tab</span>
			</label>
			<label>
				<input type="radio" name="attr_help_tabs" value="other" class="tab-control" />
				<span data-i18n="other-label">Other</span>
			</label>
		</div>

		<!-- tabbed section to display | value changes based on selected radio button -->
		<input type="hidden" name="attr_help_tabs" value="get-started" />
		<div class="tabs options">
			
			<div class="options get-started">
				
				<div class="help-column">

					<div class="option-container">

						<h4>Roll20</h4>
						<div>
							Due to Roll20 policies, unsupported character sheets should not be designed to build characters, instead it's primary use is being used as a tool to interact 
							with Roll20. You should use a program like GURPS Characters Assistant or GURPS Character Sheet to build the character.
						</div>

						<h4>Support</h4>
						<div>
							If you have any questions, feature requests, or to report a bug, you can use the link at the bottom of the character 
							sheet to view the GURPS forum thread on Roll20.
						</div>

						<h4>Announcements</h4>
						<div>
							If an update was deployed, you will see a section that you can expand to review the updates and dismiss them. 
							Please take a moment to review, since they may require action on your part.
						</div>

						<h4>Tooltips</h4>
						<div>
							Any label that is colored <b style="color: red;">red</b> has a tooltip. If you hover over the tooltip, you will see helpful information and references to GURPS rulebooks.
						</div>

					</div>

				</div>

				<div class="help-column">

					<div class="option-container">

						<h4>Input Fields</h4>
						<div>
							If you hover over input fields, a tooltip will show how you can use the field in a macro. 
							<b>Note:</b> These were all manually added, if you find a mistake, please let us know.
						</div>

						<h4>Expandable Area</h4>
						<div style="height: 20px;">
							<div class="box">
								<input type="checkbox" class="toggle" title="Expand example.">
								<span class="sheet-checkbox"></span>
							</div>
						</div>						
						<div style="clear: both;">
							<p>	
								If you see the icon above, you can click the icon to open/close an expandable area.
							</p>
						</div>

						<h4>Formatting Text Chat</h4>
						<div>
							<p>
								You can use <b>markdown</b> to add formatting and images to the rolltemplate. For example, if you 
								expand a skill, you can enter content into the <b>Success</b> textarea. You can describe what happens
								on success, add Roll20 dice rolls, and formatting.
							</p>
							<ul>
								<li>**Bold** = <b>Bold</b></li>
								<li>*Italicize* = <i>Italicize</i></li>
								<li>***Bold & Italicize*** = <b><i>Bold & Italicize</i></b></li>
								<li>[Roll20](https:roll20.com) = link</li>
								<li>[Roll20 Logo](https://app.roll20.net/v2/images/roll20-logo.png) = Image <img src="https://app.roll20.net/v2/images/roll20-logo.png" width="40" /></li>
							</ul>
							<div class="logo">
								<div class="control">
									<button type="roll" class="no-decoration" name="roll_blank" value="https://wiki.roll20.net/Markdown" title="Show link in chat. NOTE: Right-click to open in new window">
										Roll20 Markdown
									</button>
								</div>
							</div>
						</div>
	
					</div>

				</div>
			</div>

			<div class="Options general">
				
				<div class="help-column">

					<div class="option-container">

						<h4>Attributes Column</h4>
						<div>
							<p>
								The first display column relates to all the characters attributes, with a couple of options of how to modifier the attribute. Most of the attributes
								have a <b>Mod</b> field to change the attribute without spending points. This is useful if you have advantages that modifier an attribute, 
								or perhaps there are enhancements or limitations that were applied to the attribute that would change the character point cost.
							</p>
							<p>
								There's a field to enter character points, the Character Sheet will use the Rules as Written for cost of attributes. If you enter 20 points for 
								Health, the final Health attribute will be 12.
							</p>
						</div>

						<h4>Notes</h4>
						<div>
							
							<p>
								<b>Strength and Size Modifier:</b> On the <b>Bio\Misc</b> tab, you can enter your character's size modifier, there's also a checkbox to 
								apply the Size Cost Modifier. Checking this will change the points per level cost. The character sheet will show a message if you didn't 
								spend the exact amount of character points to get a specific ST. For example: If you have a Size Modifier of 2 and enter 50 points for 
								the Strength attribute you will see this error message.
							</p>
							<ul>
								<li><b>Warning!</b> Due to your Size Modifier 2 you only need to spend 48 character points (8 pts/level) for Strength 16.</li>
							</ul>
						
							
							<p>
								<b>Speed Attribute:</b> There's a clock icon that you can use to add your character to the turn order. Click your character's token and 
								then on the character sheet, go to the General tab and click the clock icon.
							</p>
							<ul>
								<li>When your character is added to the turn order the speed will be your <b>Basic Speed</b> + <b>Dexterity</b> attribute. 
								DX was added to help break ties. B363.</li>
							</ul>
						
							<p>
								<b>Thrust and Swing Damage:</b> Near the bottom is a field called <b>Striking</b> for Striking Strength. This field is used to 
								calculate Thrust and Swing Damage. Changing the effective Striking Strength will update Thrust and Swing damage. You can change 
								Striking Strength by changing your Strength Attribute or changing Striking Strength by using the modifier or character point column.
								If you notice after using the import feature the Thrust and Swing damage appear wrong, like 1d6-6, try changing the Strength attribute to force 
								the damage die to update.
							</p>
							
						</div>
					</div>
				</div>

				<div class="help-column">

					<div class="option-container">

						<h4>Upper Middle Columns</h4>
						<div>
							<p>The middle portion of the Character Sheet has two columns, one for additional stats and a notes section.</p>
							<p>There's an area for entering your own custom <i>Pools</i>, you could use them to track items that have limited users per day, an additional energy reserve, etc.</p>
						</div>

						<h4>Encumbrance Section</h4>
						<div>
							<p>
								The middle-middle portion of the Character Sheet has an encumbrance block. By default, it is collapsed, and it will show your current
								encumbrance level and related movements. Here's the formatting of movement values.
							</p>
							<ul>
								<li><b>0 or 0 (0)</b>: Movement type isn't available.</li>
								<li><b>5 (1)</b>: Means you can move 5 yards in one second and have a step of 1.</li>
								<li><b>6/12 (1)</b>: Means you have an acceleration of 6 yards per second, with a top speed of 12 yards per second, with a step of 1.</li>
							</ul>
							<p>
								Expandable button. Click the button to see full encumbrance chart.
							</p>
						</div>

						<h4>Turning and Velocity Modifiers</h4>
						<div>
							This section can be used to calculate high speed movement modifiers, such as turning radius, deceleration penalty, and tight turn penalty.
						</div>

						<h4>Movement Feats</h4>
						<div>
							This section helps calculate flying, swimming, and jumping values. There are sections where you can enter the character points to set the 
							level of an enhanced trait, such as Enhanced Flight advantage. The character points are optional, and it might make more sense to put the 
							cost in the Advantages section of the character sheet.
						</div>

					</div>

				</div>

				<div class="help-column">

					<div class="option-container">

						<h4>Character Point Summary</h4>
						<div>
							<p>
								The right-column is reserved for the Character Point Summary. It's important to note that the Character Sheet doesn't track
								rules for character creation, such as having only "-75 points in disadvantages" and "-5 points in quirks", etc. That should 
								be part of the process of the building a character.
							</p>
							<ul>
								<li>
									<b>Total Field:</b> Use this field to keep track of your character's total points, it's important to keep this field 
									up to date if you're letting the character sheet to keep track of unspent points.
								</li>
								<li>
									<b>Spent and Unspent Fields:</b> These fields are automatically calculated. Unspent = Total Field - Spent Field.
								</li>
								<li>
									<b>Point Summary:</b> You can select what type of point summary to see on the options tab. You can select 
									GCA4, GCA5, GCS, and Detailed. You can hover over the labels to see how the point summaries are calculated.
								</li>
							</ul>
						</div>
					</div>

				</div>

			</div>

			<div class="Options traits">
				
				<div class="help-column">

					<div class="option-container">

						<h4>Languages</h4>
						<div>
							<p>
								The first section is dedicated for the native language of the character. The dropdowns will 
								automatically select the rules as written costs for Spoken and Written. There's a modifier 
								field to accommodate special rules that the GM may be applying. 
							</p>
							<p>
								There's a checkbox for <b>Language Talent</b>, if checked the repeating table for languages 
								will use a different cost for Spoken and Written. 
							</p>
							<p>
								There's also a repeating table for adding as many languages as needed, along with selecting the 
								Spoken and Written level and fields to modify the cost depending on special campaign rules.
							</p>
							<p>
								<b>Special Note:</b> This applies only to character building. Roll20 simply totals  all the 
								points and doesn't consider rule limitations. If illiteracy is the norm, the GM should not 
								count these points against the disadvantage limit. Basically, if you're illiterate you get
								 free points that don't count  against the disadvantage limit when building a character.
							</p>
						</div>

						<h4>Tech Level and Cultural Familiarity</h4>
						<div>
							<p>
								The Tech Level and Cultural Familiarity section are straight forward. If you created the campaign, you could 
								set the default Campaign Tech Level when editing the settings.
							</p>
						</div>

						<h4>Tech Level and Cultural Familiarity</h4>
						<div>
							<p>
								The Tech Level and Cultural Familiarity section are straight forward. If you created the campaign, you could 
								set the default Campaign Tech Level when editing the settings.
							</p>
						</div>

					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Advantages, Perks, Quirks, and Disadvantages</h4>
						<div>
							<p>
								Each section has the same basic layout, with fields for name, optional level of trait, Frequency of Appearance or Self-Control Number, 
								cost, and page reference. Advantages and Perks has a field called FOA, Frequency of Appearance. If you enter a value there, a clickable
								die icon will become available. For disadvantages and Quirks, there's a SCN, Self-Control Number field, this will also show a die icon
								if there's a value.
							</p>
							<p>
								You can expand any of them to view additional notes. For Advantages and Disadvantages, if there's a die roll available, then there will
								additional fields for entering success/fail notes that will appear in the chat window when a roll is made.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Racial Traits</h4>
						<div>
							<p>
								This section can be used for templates; Racial, Build Templates, Robotic, etc. If you import a file from GCA and you used a template, 
								the traits will be placed in this section. To the right of the <b>Race</b> field are additional fields for Cost and Page Reference. The cost
								auto-calculates the total number of points from the repeating table below.
							</p>
							<p>
								The repeating table is like Advantages and Disadvantages, with an expandable area to enter more notes.
							</p>
						</div>
					</div>					
				</div>

			</div>

			<div class="options bio">
				
				<div class="help-column">

					<div class="option-container">
						<h4>General Information</h4>
						<div>
							<p>
								The row that starts with <b>Size Modifier</b> are useful for the character sheet. The Size Modifier field will impact the Hit Location areas tab 
								and next to the <b>Size Modifier</b> field is a checkbox labeled <b>Apply</b> is checked, the per level character point of Strength will be modified
								as described on B19. In addition, the <b>Reach Mod</b> field will automatically update based on the <b>Size Modifier</b>. There's also an option 
								to remind you that a weapon with a Reach of "C" can be used as a Reach of "1" due to larger size.
 							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Background and Training Sections</h4>
						<div>
							<p>
								The Background Information, Background History & Notes, and Training provide useful fields for background. The Training section is 
								useful for notes on Improving Skills through training and other related tasks.
							</p>
						</div>
					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Physical Appearance</h4>
						<div>
							<p>
								There are two notable fields to be aware of in this section. The weight is used on the <b>Inventory</b> tab to 
								show the grand total weight, including the character weight, which is handy if you someone/something attempts
								to carry the character. The <b>Appearance</b> drop-down is reference only and for seeing reaction modifiers. 
								You should use the Advantage and Disadvantage tables for tracking the cost and other notes for appearance.
 							</p>
						</div>
					</div>
	
				</div>
				
			</div>

			<div class="options skills">
				
				<div class="help-column-full-width">

					<div class="option-container">
						<h4>Roll Modifier Toolbar</h4>
						<div>
							<div class="tollbar-image">
								<img src="https://github.com/Roll20/roll20-character-sheets/blob/master/GURPS/Images/roll-modifier-toolbar.png?raw=true" width="100%" alt="Roll Modifier Toolbar" title="Roll Modifier Toolbar" />
							</div>
							<p>
								You can find the toolbar above repeating sections for Skills, Techniques, Active Defenses, Melee Attacks, Ranged Attacks,
								and Spells. The modifiers will apply to <b>ALL</b> items in the repeating section. Remember to click the reset button to
								clear the modifiers if they are no longer needed. Rolling the dice will <b>not</b> clear the modifiers.
 							</p>
							<ul>
								<li>
									<span class="pencil-pad-icon">W</span> Click this icon to see a dialog box with more options. This is useful for new users who are not familiar with 
									all of the modifiers. The dialog box will display different options based on the section you're working with.
								</li>
								<li>
									<span class="paper-icon">F</span> Hover the mouse pointer over this icon to see a summary of the modifiers being applied to skill rolls.
								</li>
								<li>
									<b>Custom Modifier:</b> Use the input box and reason textbox to apply a custom modifier.
								</li>
								<li>
									<b>Max skill of 9 Checkbox:</b> If checked, the maximum effective skill of the roll is set to 9, such as a <b>Wild Swing</b>.
								</li>
								<li>
									<b>Encumbrance Checkbox:</b> If checked, the current encumbrance penalty will be applied to the skill roll.
								</li>
								<li>
									<b>Final Modifier:</b> Shows the final modifiers; gray for no-modifier, blue for positive modifier, and red for negative modifiers.
								</li>
								<li>
									<span class="reset-icon">0</span> Click this icon to reset/clear the modifiers for the toolbar.
								</li>
							</ul>
							
						</div>
					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Skills</h4>
						<div>
							<p>
								You can enter a name, click the first checkbox to highlight the row, a clickable die icon for the skill roll, a field for the skill's Tech Level,
								the attribute to use for the skill, skill difficulty, a modifier field (handy for permanent/long term modifiers, such as 
								talent modifiers, equipment modifiers, etc.), a field for the number of character points (this will automatically adjust the skill level),
								and a field for page reference. 
							</p>
							<p>
								It's important to note that we can't support default values, since default values are defined the skill. You can enter 0 character points for 
								the skill and use the modifier column to adjust the skill level to match the known default level.
							</p>
							<p>
								You can expand any section to view additional fields for entering notes and success/fail results. These notes are very useful for entering 
								notes on how to use the skill, conditional modifiers so you don't have to refer back to a book or rule.
							</p>
							<p>
								<b>Roll ID:</b> This read-only field can be used to <i>Link</i> a skill to other repeating sections; Techniques, Active Defenses, 
								Melee Attacks, and Ranged Attacks.
							</p>
						</div>
					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Techniques</h4>
						<div>
							<p>
								You can enter a name and parent name, click the first checkbox to highlight the row, the base skill level which is based on the parent skill, 
								the default modifier that is applied to the base skill level, a maximum modifier that is applied to the base skill level, difficulty level,
								a modifier field (handy for permanent/long term modifiers, such as 
								talent modifiers, equipment modifiers, etc.), a field for the number of character points (this will automatically adjust the skill level), 
								a field for the final effective skill level, a clickable die icon for the skill roll, and a field for page reference. 
							</p>
							<p>
								You can expand any section to view additional fields for entering notes and success/fail results. These notes are very useful for entering 
								notes on how to use the skill, conditional modifiers so you don't have to refer back to a book or rule.
							</p>
							<p>
								<b>Link Dropdown:</b> You can link the Technique to a number of different of fields on the character sheet. This will automatically fill in 
								the parent field and base skill level. If you select <b>Skill</b> from the Dropdown, copy/paste the Row ID from a skill listed in the skills section 
								into the Row ID field.
							</p>
						</div>
					</div>

				</div>

			</div>	
			
			<div class="options combat">
				
				<div class="help-column">

					<div class="option-container">
						<h4>Combat Section</h4>
						<div>
							<p>This section has additional tabs for Hit Locations, Defense, Melee, Ranged, and Tools.</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Summary Bar</h4>
						<div>
							<p>Each tab will display a summary of useful attributes, including quickly changing your character's Size Modifier, and Current Hit Points.</p>
							<p>
								<b>Sync Hit Points Sheet Option:</b> On the character sheet option page, you can turn on syncing hit locations to the current hit points. 
								If checked, when you change the hit points of a hit location, the current hit points will also be updated. There's important issue to be aware of, 
								if you edit a location's hit points, then edit the current hit points, then edit the location's hit points again, this will cause the current hit points 
								to be out of sync.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Roll Modifier Toolbar</h4>
						<div>
							<p>Please see the help section for <b>Skills</b>.</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Hit Locations Tab</h4>
						<div>
							<p>
								Use this section to keep track of hit locations and armor for each location. There's a drop-down to populate the hit locations 
								based on a template. If you change the template, the previous rows will be deleted and the new hit locations will get added.
							</p>
							<p>
								<b>Sync Hit Points Sheet Option:</b> See <b>Summary Bar</b> above.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Defense Tab</h4>
						<div>
							<p>
								The first set of defenses are hard-coded, and they will automatically be adjusted by current encumbrance level, current hit points and fatigue points.
								There's also a row for Knockback rules, the Hit Points per yard is automatically calculated. You can expand the row to modify the knockback, and 
								you could like to a kill or the DX attribute.
							</p>
							<p>
								The repeating section allows you to enter custom active defenses such as parries, blocks, etc. You can use the checkbox to highlight the row, 
								enter the name of the active defense, dropdown to select the type of defense (if you expand the row, you will see the formula for calculating the 
								defense based on the type), an Info box (F for fencing and U for unbalanced weapon), base skill level used to calculate the effective active defense 
								skill level, a modifier field (handy for permanent/long term modifiers, such as  talent modifiers, equipment modifiers, etc.), final effective skill level, 
								and a clickable die icon for the skill roll.
							</p>
							<p>
								You can expand any section to view additional fields for entering notes and success/fail results. These notes are very useful for entering 
								notes on how to use the skill, conditional modifiers so you don't have to refer back to a book or rule.
							</p>
							<p>
								<b>Link Dropdown:</b> You can link the active defense to several different of fields on the character sheet. This will automatically fill in 
								the base skill level. If you select <b>Skill</b> from the Dropdown, copy/paste the Row ID from a skill listed in the skills section 
								into the Row ID field.
							</p>
						</div>
					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Melee Tab</h4>
						<div>
							<p>
								You can use the checkbox to highlight the row, a field to enter the roll formula for the damage done by the attack, a clickable die icon for the 
								damage roll, the damage type drop-down (damage roll will show additional notes based on damage type, which can be edited on the character sheets 
								option tab), a field for the weapon's reach, effective skill level, and a clickable die icon for the skill roll.
							</p>
							<p>
								You can expand any section to view additional fields for entering notes and success/fail results. These notes are very useful for entering 
								notes on how to use the skill, conditional modifiers so you don't have to refer back to a book or rule.
							</p>
							<p>
								<b>Link Dropdown:</b> You can link the active defense to a number of different of fields on the character sheet. This will automatically fill in 
								the base skill level. If you select <b>Skill</b> from the Dropdown, copy/paste the Row ID from a skill listed in the skills section 
								into the Row ID field.
							</p>
						</div>
					</div>
					
					<div class="option-container">
						<h4>Ranged Tab</h4>
						<div>
							<p>
								You can use the checkbox to highlight the row, a field to enter the roll formula for the damage done by the attack, a clickable die icon for the 
								damage roll, the damage type drop-down (damage roll will show additional notes based on damage type, which can be edited on the character sheets 
								option tab), additional fields for Acc, Range, Rate of Fire, Shots, Bulk, Recoil, final effective skill, and a clickable die icon for the skill roll.
							</p>
							<p>
								You can expand any section to view additional fields for entering notes and success/fail results. These notes are very useful for entering 
								notes on how to use the skill, conditional modifiers so you don't have to refer back to a book or rule.
							</p>
							<p>
								<b>Link Dropdown:</b> You can link the active defense to a number of different of fields on the character sheet. This will automatically fill in 
								the base skill level. If you select <b>Skill</b> from the Dropdown, copy/paste the Row ID from a skill listed in the skills section 
								into the Row ID field.
							</p>
							<p>
								<b>Weapon Malfunctions:</b> There's a section for applying weapon malfunction rules.
							</p>
						</div>
						
						<h4>Thrown Weapon Calculator Tool</h4>
						<div>
							<p>Use this tool to calculate damage for a generic object; extremely useful for a Supers campaign.</p>
						</div>

						<h4>Range Calculator</h4>
						<div>
							<p>Use this tool to quickly apply modifiers. Enter the modifiers and click the <b>Apply</b> button. This applies the modifiers 
							to the Roll Modifier Toolbar.</p>
						</div>

						<h4>Close Range Shotgun Damage Tool</h4>
						<div>
							<p>Use this tool to quickly calculate the damage done by a shotgun at close range.</p>
						</div>

					</div>

					<div class="option-container">
						<h4>Tools Tab</h4>
						<div>
							<p>
								Currently there are tools to help calculate Slam attacks, Falling and Collision damage, and Explosive damage.
							</p>
						</div>
					</div>

				</div>

			</div>	

			<div class="options inventory">
				
				<div class="help-column-full-width">

					<div class="option-container">
						<h4>Inventory</h4>
						<div>
							<p>The first part has a section for entering custom notes followed by a table to enter individual items.</p>
							<p>
								The inventory table has a checkbox to highlight the row, fields for item, location, Tech Level,
								Legality Class, a checkbox to mark the item "ON" which means carried which impacts the encumbrance level,
								the # field is the number of items you have, followed the cost and weight <b>per</b> item. The last 
								two columns shows the subtotal of cost and weight for the item. You can expand the row to see a field 
								to enter additional notes about the item.
							</p>
							<p>
								At the bottom of the table is the summary, with the ability to change the effective gravity of the world you're on.
								The Grand Total Weight includes your carried items plus your weight that was entered on the Bio/Misc tab.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Tips</h4>
						<div>
							<p>
								Roll20 doesn't support nested tables, so it's not possible to add a sub-table beneath an item, like having a backpack 
								and adding items to the backpack. To get around that, you can order the items and then indent child items using 
								spaces.
							</p>
						</div>
					</div>

				</div>

			</div>
			
			<div class="options grimiore">
				
				<div class="help-column-full-width">

					<div class="option-container">
						<h4>Grimoire Tab</h4>
						<div>
							<p>
								The tab starts with an expandable notes section and is followed by a spell attributes toolbar that 
								is used by the Spell Table.
							</p>
						</div>
						<h4>Spell Toolbar</h4>
						<div>
							<p>
								You need to select which attribute the spells will be based on, followed by a field to enter the modifier, such as Magery, 
								Power Investiture, and other modifiers. Unfortunately, this is a legacy table and it is limiting if you want to 
								have spells based on other stats or if you have a special case where a character has two different types of Magery or maybe even 
								in the rare case of having Magery and Power Investiture. In those cases, the best approach is to use the individual spells 
								modifier field to get the desired skill level.
							</p>
							<p>
								There are two more read-only fields that provide feedback on spell penalties. The <b>ON PENALTY</b>
								field shows the total skill roll penalty for having one or more spells "on", the <b>CONCENTRATION PENALTY</b> field shows the total 
								skill roll penalty if you are concentrating on one or more spells. <b>Important</b> the penalties will be automatically added to your 
								effective spell skill level.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Spells Table</h4>
						<div>
							<p>
								The spell table consists of a checkbox to highlight the row, fields for spell name, a clickable die icon for spell's skill roll, 
								the final effective skill level, the Difficulty level, a modifier field (handy for permanent/long term modifiers, such as talent modifiers, 
								equipment modifiers, etc.), the character points spent on the spell, a number field for <b>ON</b> which allows you to enter a value for 
								the number of spells that currently in effect, a number field for the number of spells you're currently concentrating on, duration of spell, 
								initial energy cost, time to cast, and maintenance cost.
							</p>
						</div>
						<h4>Expanded Notes Section</h4>
						<div>
							<p>
								You can expand the spell to see additional fields. The first field to notice is the <b>Row ID</b> field, which is read-only. 
								You can use this ID to link the spell to Techniques, Active Defenses, Melee Attacks, or Ranged Attacks. There are also fields to enter 
								additional information about the spell (to avoid having to find the spell in a book) and for success/fail notes.
							</p>
						</div>
						<h4>Tips</h4>
						<div>
							<p>
								Take the time to fill out as much information as you can about the spell, especially the notes for success and fail, this will Help
								save time, instead of trying to find the information.
							</p>
						</div>
					</div>

				</div>

			</div>

			<div class="options gear">

				<div class="help-column">
					
					<div class="option-container">
						<h4>Gear Icon Tab</h4>
						<div>
							<p>This tab has sub-tabs for Sheet Options, Rules, Import GCA4, and Import.</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Sheet Options</h4>
						<div>
							<p>
								There are several options for setting the behavior of the character sheet. These options are also available on the campaign level so a GM
								can set a default value for new character sheets. Please review the tooltips to help you choose the options you would like to use.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Rules</h4>
						<div>
							<p>
								Here you can decide which rules to apply to the character sheet. Most the fields on this tab are for describing the results of 
								different rolls.
							</p>
						</div>
						<h4>Editable Wound Modifiers</h4>
						<div>
							<p>
								It's important to note if you have an existing character and there's an update that changed these notes, you will need to 
								click the <b>Resync</b> to get the latest notes. Unfortunately, this will delete any custom notes you may have added.
							</p>
						</div>
					</div>

				</div>

				<div class="help-column">

					<div class="option-container">
						<h4>Import GCA4</h4>
						<div>
							<p>
								This tab has a tool to import a character from GCA4, this tool and GCA4 are no longer supported, so there will 
								be no further updates to this tool.
							</p>
						</div>
					</div>

					<div class="option-container">
						<h4>Import GCA5</h4>
						<div>
							<p>
								This is a generic tool for importing characters from GCA5. It uses a generic data structure; this allows a 
								developer to create their own exporter for an application. Currently, GCA5 is the only application that has 
								an exporter for Roll20. We are looking for volunteers to write an exporter for GCS (GURPS Character Sheet).
							</p>
						</div>
					</div>

				</div>

			</div>

			<div class="options other">
				
				<div class="help-column">
					
					<div class="option-container">
						<h4>How to write macros</h4>
						<div>
							<p>Macros can be written by both the GM and players and there are many uses below are some links to find more information on writing a macro.</p>
							<p>
								Roll20 has a wiki and help page that explains how to write macros. You can find the page by clicking the links below.
							</p>
							<div>
								<button type="roll" name="roll_blank" class="no-decoration btn ui-draggable" title="Click to view link in chat." value="https://help.roll20.net/hc/en-us/articles/360037256794-Macros">
									<span>Roll20 Help - Macro</span>
								</button>
								<span>|</span>
								<button type="roll" name="roll_blank" class="no-decoration btn ui-draggable" title="Click to view link in chat." value="https://wiki.roll20.net/Macros">
									<span>Roll20 Wiki - Macro</span>
								</button>						
							</div>
							<p>
								Nick Olivio has a YouYUbe channel that has a lot of good videos on how to write macros. You can find the channel by clicking the link below.
							</p>
							<div>
								<button type="roll" name="roll_blank" class="no-decoration btn ui-draggable" title="Click to view link in chat." value="https://www.youtube.com/@NickOlivo">
									<span>Nick Olivo</span>
								</button>					
							</div>
						</div>
						
					</div>

					<div class="option-container">
						<h4>Roll Template for Skill Rolls</h4>
						<div>
							<p>
								Most skill and damage rolls use the same template. Below is a link to a file to help explain how they work, 
								in case you want to try to make your own macro for skill and damage rolls.
							</p>
							<div class="control">
								<button type="roll" class="no-decoration" name="roll_blank" value="https://github.com/Roll20/roll20-character-sheets/blob/master/GURPS/Docs/Roll20-GURPS-4E-Roll-Template.pdf" title="Show link in chat. NOTE: Right-click to open in new window">
									<span data-i18n="gurps-4th-edition-roll-template-button">Roll20 GURPS 4E Roll Template</span>
								</button>
							</div>
						</div>
						
					</div>

					<div class="option-container">
						<h4>Roll Template Generic Macro</h4>
						<div>
							<p>
								A generic Roll Template for macros that can have a couple of different styles.
							</p>

							<div class="grid-2-column-auto grid-standard grid__gap_small">

								<div class="grid-cell"><label>Variable</label></div>
								<div class="grid-cell"><label>Description</label></div>

								<div class="grid-cell">macro</div>
								<div class="grid-cell">This is the name to use for the rolltemplate macro: `&{template:macro}`</div>

								<div class="grid-cell">templateType</div>
								<div class="grid-cell">Available types: dnd5e, pathfinder</div>

								<div class="grid-cell">sheetStyle</div>
								<div class="grid-cell">
									Color scheme<br />
									0: Green<br />
									1: Blue<br />
									2: Beige<br />
									3: Gray<br />
									4: Classic White<br />
									5: Pastel Pink<br />
									6: Pastel Earth<br />
									7: Purple<br />
									8: Fabric
								</div>

								<div class="grid-cell">title</div>
								<div class="grid-cell">The title of the roll.</div>
								
								<div class="grid-cell">subtitle</div>
								<div class="grid-cell">The subtitle of the roll.</div>
								
								<div class="grid-cell">roll</div>
								<div class="grid-cell">Enter the formula for rolling the dice.</div>
								
								<div class="grid-cell">target</div>
								<div class="grid-cell">The target of the roll, optional.</div>
								
								<div class="grid-cell">Key/Values</div>
								<div class="grid-cell">
									You can have your own list of key/value pairs, and they will be used in the order you entered them. The first column will be the name of your variable and the first letter will be capitalized, the second column will be the value.
								</div>

								<div class="grid-cell">desc</div>
								<div class="grid-cell">Describe the roll or any other notes you would like to add.</div>

								<div class="grid-cell">Example</div>
								<div class="grid-cell"><pre>&{template:macro} {{templateType=dnd5e}} {{sheetStyle=4}} {{title=My Roll}} {{subtitle=Emergency only}} {{roll=[[3d6]]}} {{target=12}} {{timeRequired=3 sec.}} {{duration=10 min.}} {{fail=-1 to all skills}} {{success=+1 to all skills}} {{desc=A special call for help.}}</pre></div>

							</div>
						</div>
					</div>
				</div>

				<div class="help-column">
					
					<div class="option-container">
						<h4>Roll Template 3 to 5 Columns</h4>
						<div>
							<p>
								This template provides a method to create a table with 3 to 5 columns and with as many rows as you would like to add. 
								The table below shows the available variables that can be used in the template.
							</p>
							<div class="grid-2-column-auto grid-standard grid__gap_small">

								<div class="grid-cell"><label>Variable</label></div>
								<div class="grid-cell"><label>Description</label></div>

								<div class="grid-cell">columnlayout</div>
								<div class="grid-cell">This is the name to use for the rolltemplate columnlayout: `&{template:columnlayout}`</div>

								<div class="grid-cell">columns</div>
								<div class="grid-cell">Can be set from 3 to 5.</div>

								<div class="grid-cell">sheetStyle</div>
								<div class="grid-cell">
									Color scheme<br />
									0: Green<br />
									1: Blue<br />
									2: Beige<br />
									3: Gray<br />
									4: Classic White<br />
									5: Pastel Pink<br />
									6: Pastel Earth<br />
									7: Purple<br />
									8: Fabric
								</div>
								
								<div class="grid-cell">header#</div>
								<div class="grid-cell">These variables will be used as column headers.<br />
									3 columns: header1, header2, and header3.<br /> 
									4 columns: header1, header2, header3, header4.<br />
									5 columns: header1, header2, header3, header4, header5.<br />
								</div>

								<div class="grid-cell">Row Data</div>
								<div class="grid-cell">
									These variables will be used as row data, and they will be used in the order you entered them. 
									For example, if you have a three column table, the first row will use first three variable names. 
									It may help to number your variables to show which row they are for.<br />
									Example: name1, st1, dx1, name2, st2, dx2, etc.
								</div>

								<div class="grid-cell">3-col macro</div>
								<div class="grid-cell"><pre>&{template:columnlayout} {{columns=3}} {{sheetStyle=4}} {{header1=User Name}} {{header2=DX}} {{header3=IQ}} {{name1=Ken}} {{dex1=12}} {{iq1=12}} {{name2=Dave}} {{dex2=13}} {{iq2=11}} {{name3=John}} {{dex3=11}} {{iq3=13}}</pre></div>
							
								<div class="grid-cell">4-col macro</div>
								<div class="grid-cell"><pre>&{template:columnlayout} {{columns=4}} {{sheetStyle=4}} {{header1=User Name}} {{header2=DX}} {{header3=IQ}} {{header4=HT}} {{name1=Ken}} {{dex1=12}} {{iq1=12}} {{ht1=12}} {{name2=Dave}} {{dex2=13}} {{iq2=11}} {{ht2=12}} {{name3=John}} {{dex3=11}} {{iq3=13}} {{ht3=12}}</pre></div>
							
								<div class="grid-cell">5-col macro</div>
								<div class="grid-cell"><pre>&{template:columnlayout} {{columns=5}} {{sheetStyle=4}} {{header1=User Name}} {{header2=ST}} {{header3=DX}} {{header4=IQ}} {{header5=HT}} {{name1=Ken}} {{st1=11}} {{dex1=12}} {{iq1=12}} {{ht1=12}} {{name2=Dave}} {{st2=11}} {{dex2=13}} {{iq2=11}} {{ht2=12}} {{name3=John}} {{st3=11}} {{dex3=11}} {{iq3=13}} {{ht3=12}}</pre></div>
							
							</div>
						</div>
						
					</div>

				</div>

			</div>
			
		</div>

	</div> <!-- .tab8 -->
	
	<div class="tab0">

		<!-- see: https://codepen.io/YozhEzhi/pen/gcLpI/ -->
		<div class="tabbed">
			
			<!-- tabs -->
			<label>
				<input type="radio" name="attr_options_tabs" value="sheet" class="tab-control" checked />
				<span data-i18n="sheet-options-label">Sheet Options</span>
			</label>
			<label>
				<input type="radio" name="attr_options_tabs" value="rules" class="tab-control" />
				<span data-i18n="rules-label">Rules</span>
			</label>
			<label>
				<input type="radio" name="attr_options_tabs" value="import" class="tab-control" />
				<span data-i18n="import-label">Import GCA4</span>
			</label>
			<label>
				<input type="radio" name="attr_options_tabs" value="import-json" class="tab-control" />
				<span data-i18n="import-json-label">Import</span>
			</label>

		</div>
		
		<!-- tabbed section to display | value changes based on selected radio button -->
		<input type="hidden" name="attr_options_tabs" value="sheet" />
		<div class="tabs options">

			<div class="options sheet-options">
				
				<div class="option-column">
					
					<div class="option-container">
						
						<h4>
							<span data-i18n="sheet-type-label">Sheet Type</span>
						</h4>
						
						<div>
							<input type="radio" name="attr_gurps_sheet_type" value="character" checked="checked" />
							<span class="popup">
								<span data-i18n="standard-character-sheet-label">Standard Character Sheet</span>
							</span>
							<span class="tooltip">
								<span data-i18n="standard-character-sheet-tooltip">The standard character sheet will display the following tabs: General, Traits, Bio\\Misc, Skills, Combat, Inventory, Grimoire, Updates, Help, and Options Icon.</span>
							</span>
						</div>
						
						<div>
							<input type="radio" name="attr_gurps_sheet_type" value="chase" />
							<span class="popup">
								<span data-i18n="chase-sheet-label">Chase Sheet</span>
							</span>
							<span class="tooltip">
								<span data-i18n="chase-sheet-tooltip">A custom control sheet for managing chases scenes using the Rules from GURPS Action 2 Exploits, pages 31-39.</span>
							</span>
						</div>

						<!--
						<div>
							<input type="radio" name="attr_gurps_sheet_type" value="vehicle" />
							<span class="popup">
								<span data-i18n="vehicle-sheet-label">Vehicle Sheet</span>
							</span>
							<span class="tooltip">
								<span data-i18n="vehicle-sheet-tooltip">The vehicle sheet based on rules from GURPS Basic 462-470 and Damage to Objects 483.</span>
							</span>
						</div>
						-->

					</div><!-- end sheet type options -->
					
					<div class="option-container">
						
						<h4>
							<span data-i18n="critical-roll-options-label">Critical Roll Options</span>
						</h4>
						
						<input type="radio" name="attr_use_critical_plus_10" value="1" checked="checked" />
						<span data-i18n="user-rules-as-written-label">Use rules as written</span>
						<br />
						
						<input type="radio" name="attr_use_critical_plus_10" value="0" />
						<span data-i18n="only-on-3-or-4-label">Only on a 3 or 4</span>
						<br />
						
						<input type="radio" name="attr_use_critical_plus_10" value="2" /> 
						<span data-i18n="turn-off-label">Turn Off</span>

					</div><!-- end critical roll options -->

					<div class="option-container">

						<h4>
							<span data-i18n="quick-modifier-options-label">Quick Modifier Options</span>
						</h4>

						<input type="checkbox" name="attr_melee_quick_mod_show" value="1" />
						<span class="popup">
							<span data-i18n="display-melee-quick-modifiers-label">Display Melee Quick Modifiers</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-melee-quick-modifiers-tooltip">
								Display the melee quick modifiers table. This table is used to quickly apply modifiers to a melee attack.<br />
								If unchecked, the table will be hidden and modifiers will be cleared.<br />
								You can also set this on the campaign level.
							</span>
						</span>
						<br />
						<input type="checkbox" name="attr_range_quick_mod_show" value="1" />
						<span class="popup">
							<span data-i18n="display-range-quick-modifiers-label">Display Range Quick Modifiers</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-range-quick-modifiers-tooltip">
								Display the range quick modifiers table. This table is used to quickly apply modifiers to a ranged attack.<br />
								If unchecked, the table will be hidden and modifiers will be cleared.<br />
								You can also set this on the campaign level.
							</span>
						</span>
						<br />

					</div>
					
					<!-- roll modifiers -->
					<div class="option-container">
						<h4>
							<span data-i18n="skill-modifier-options-label">Skill Modifier Options</span>
						</h4>
						
						<input type="checkbox" name="attr_display_roll_modifiers_header" value="1" />
						<span class="popup">
							<span data-i18n="display-modifier-in-header-label">Display Roll Modifier Options in Header</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-modifier-in-header-tooltip">
								If checked, the options for <b>No Modifier Prompt</b>, <b>Single Modifier Prompt</b> and <b>Extended Modifier Prompts</b> will be displayed to the right of the character name above the tabs.
							</span>
						</span>
						<br />
						
						<input type="checkbox" name="attr_display_roll_modifier_summary" value="1" checked="checked" />
						<span class="popup">
							<span data-i18n="display-modifier-summary-in-chat-label">Display Roll Modifier Summary in Chat Window</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-modifier-summary-in-chat-tooltip">If checked, the summary of all the modifiers for a roll will be display in the chat window.</span>
						</span>
						<br />
						
						<input type="radio" name="attr_modifier_option" value="0" />
						<span class="popup">
							<span data-i18n="no-modifier-prompt-label">No Modifier Prompt</span>
						</span>
						<span class="tooltip">
							<span data-i18n="no-modifier-prompt-tooltip">
								Rolls will be made immediately with no prompt.
							</span>
						</span>
						<br />
						
						<input type="radio" name="attr_modifier_option" value="1" checked="true" />
						<span class="popup">
							<span data-i18n="single-modifier-prompt-label">Single Modifier Prompt</span>
						</span>
						<span class="tooltip">
							<span data-i18n="single-modifier-prompt-tooltip">
								Ask for a bonus or penalty to be added to dice rolls.<br />
								This will not affect damage rolls.
							</span>
						</span>
						<br />
						
						<input type="radio" name="attr_modifier_option" value="2" />
						<span class="popup">
							<span data-i18n="extended-modifier-prompt-label">Extended Modifier Prompts</span>
						</span>
						<span class="tooltip">
							<span data-i18n="extended-modifier-prompt-tooltip">
								Instead of a single modifier, rolls will ask for a series of modifiers,<br />
								to remind you about potential bonuses/penalties.<br />
								This will not affect damage rolls.
							</span>
						</span>
						
					</div><!-- end roll modifiers -->
					
					<div class="option-container">
						<h4>
							<span data-i18n="public-or-private-rolls-label">Public or Private Rolls</span>
						</h4>
						
						<input type="checkbox" name="attr_display_roll_option_header" value="1" />
						<span class="popup">
							<span data-i18n="display-in-header-label">Display Roll Options in Header</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-in-header-tooltip">
								If checked, the options for <b>Public Rolls</b> and <b>Private Rolls</b> will be displayed to the right of the character name above the tabs.
							</span>
						</span>
						<br />

						<input type="checkbox" name="attr_display_custom_roll_option_header" value="1" />
						<span class="popup">
							<span data-i18n="display-custom-in-header-label">Display Custom Option in Header</span>
						</span>
						<span class="tooltip">
							<span data-i18n="display-custom-in-header-tooltip">
								If checked, button name for <b>Custom Rolls</b> will be displayed to the right of the character name above the tabs.
							</span>
						</span>
						<br />

						<input type="radio" name="attr_roll_option" value="public" checked="checked">
						<span class="popup">
							<span data-i18n="public-rolls-label">Public Rolls</span>
						</span>
						<span class="tooltip">
							<span data-i18n="public-rolls-tooltip">All players will be able to see<br>your skill level, roll and results.</span>
						</span>
						<br>
						
						<input type="radio" name="attr_roll_option" value="deprecated">
						<span class="popup">
							<span data-i18n="private-skill-levels-label">Private Skill Levels <em>deprecated</em></span>
						</span>
						<span class="tooltip">
							<span data-i18n="private-skill-levels-tooltip">Only the GM will be able to see<br>your skill level, but all players<br>will see the result.<br><b>NOTE:</b> This now behaves just like Private Rolls</span>
						</span>
						<br>
						
						<input type="radio" name="attr_roll_option" value="private">
						<span class="popup">
							<span data-i18n="private-rolls-label">Private Rolls</span>
						</span>
						<span class="tooltip">
							<span data-i18n="private-rolls-tooltip">Only the GM will see your skill<br>level and the result.</span>
						</span>
						<br>

						<input type="radio" name="attr_roll_option" value="custom">
						<span class="popup">
							<span data-i18n="custom-rolls-label">Custom Rolls</span>
						</span>
						<span class="tooltip">
							<span data-i18n="custom-rolls-tooltip">Use this option to use a custom macro with the Roll Template.<br><br><b style="color:red;">Important:</b> When entering the macro, be sure to add a <i>space</i> character to the end!<br><br>Add a <b>Button Label</b> to display a button in the header.<br><br>For example, the Private Rolls option adds <i style="color:gray;">/w gm</i> to the beginning of the roll, which means whisper to GM.</span>
						</span>

						<div>
							<div>
								<b>
									<span data-i18n="button-label">Button Name</span>
								</b><br>
								<input type="text" name="attr_custom_roll_macro_label" value="Blind Roll">
							</div>
							<div>
								<span class="popup">
									<span data-i18n="macro-label">Macro</span>
								</span>
								<span class="tooltip">
									<span data-i18n="macro-label-tooltip"><b>NOTE:</b> In order to use this option, you will need an API script that can intercept the data for the roll and then send a message to the GM.</span>
								</span>
								<br />
								<input type="text" name="attr_custom_roll_macro" value="">
							</div>
						</div>

					</div>
					
					<div class="option-container">
						<h4>
							<span data-i18n="repeating-technique-tables-label">Repeating Technique Tables</span>
						</h4>

						<div>
							<input type="checkbox" name="attr_show_old_techniques" value="1" />
							<span class="popup">
								<span data-i18n="show-original-label">Show Original</span>
							</span>
							<span class="tooltip">
								<span data-i18n="show-original-tooltip">Show the original techniques table.</span>
							</span>
						</div>

						<div>
							<input type="checkbox" name="attr_show_new_techniques" checked="checked" value="1" />
							<span class="popup">
								<span data-i18n="show-revised-label">Show Revised</span>
							</span>
							<span class="tooltip">
								<span data-i18n="show-revised-tooltip">Show the revised techniques table.</span>
							</span>
						</div>
						
					</div><!-- end public/private rolls -->
					
				</div><!-- end option-column -->
				
				<div class="option-column">
					
					<div class="option-container">
						
						<h4>
							<span data-i18n="point-summary-layout-label">Point Summary Layout</span>
						</h4>
						
						<div>
							<input type="radio" name="attr_point_summary_layout" value="4" checked="checked" />
							<span class="popup">
								<span data-i18n="abbreviation-gurps-character-assistant5-label">GCA5</span>
							</span>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="gurps-character-assistant5-tooltip">GURPS Character Assistant 5.</span>
							</span>
						</div>
						<div>
							<input type="radio" name="attr_point_summary_layout" value="1" />
							<span class="popup">
								<span data-i18n="abbreviation-gurps-character-assistant-label">GCA4</span>
							</span>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="gurps-character-assistant-tooltip">GURPS Character Assistant 4.</span>
							</span>
						</div>
						<div>
							<input type="radio" name="attr_point_summary_layout" value="2" />
							<span class="popup">
								<span data-i18n="abbreviation-gurps-character-sheet-label">GCS</span>
							</span>
							<span class="tooltip" style="margin-left: 0;">
								<span data-i18n="gurps-character-sheet-tooltip">GURPS Character Sheet.</span>
							</span>
						</div>
						<div>
							<input type="radio" name="attr_point_summary_layout" value="3" />
							<span class="popup">
								<span data-i18n="detailed-label">Detailed</span>
							</span>
							<span class="tooltip" style="margin-left: -10px;">
								<span data-i18n="point-summary-detailed-tooltip">
									Custom view displaying each section total.<br />
									Including the deprecated Misc. Points box.
								</span>
							</span>
						</div>
					</div><!-- end point summary layout -->
					
					<div class="option-container">
						<div>
							<input type="checkbox" name="attr_use_unspent_box" value="1" />
							<span class="popup">
								<span data-i18n="enter-unspent-points-label">Enter Unspent Points</span>
							</span>
							<span class="tooltip">
								<span data-i18n="enter-unspent-points-tooltip">Check if you would like to manually track your unspent points</span>
							</span>
						</div>
					</div><!-- end enter unspent points -->
				
					<div class="option-container">
						
						<h4>
							<span data-i18n="add-to-combat-tracker-label">Add to combat tracker</span>
						</h4>
						
						<input type="radio" name="attr_speed_tracker" value="/em" checked="true" />
						<span class="popup">
							<span data-i18n="public-speed-tracker-label">Public Speed Tracker</span>
						</span>
						<span class="tooltip">
							<span data-i18n="public-speed-tracker-tooltip">Show basic speed and add to Chat message to public.</span>
						</span>
						<br />
						
						<input type="radio" name="attr_speed_tracker" value="/w gm" />
						<span class="popup">
							<span data-i18n="private-speed-tracker-label">Private Speed Tracker</span>
						</span>
						<span class="tooltip">
							<span data-i18n="private-speed-tracker-tooltip">Show basic speed and add to Chat message to GM.</span>
						</span>
						
					</div><!-- end combat-tracker -->
					
					<div class="option-container">
						
						<h4>
							<span data-i18n="spell-options-label">Spell Options (See B238, M10)</span>
						</h4>
						
						<span data-i18n="spell-options-table">
							<table>
								<tr>
									<td>
										Penalty for each spell <b>ON:</b>
									</td>
									<td>
										<input type="number" step="1" value="-1" name="attr_penalty_per_spell_on"></input>
									</td>
								</tr>
								<tr>
									<td>
										Penalty for each spell <b>Concentrated On:</b>
									</td>
									<td>
										<input type="number" step="1" value="-3" name="attr_penalty_per_spell_maintained"></input>
									</td>
								</tr>
								<tr>
									<td>
										Show casting details on roll template:
									</td>
									<td>
										<input type="checkbox" name="attr_show_casting_details" value="1" checked="checked" />
									</td>
								</tr>
								
							</table>
						</span>

						<table>
							<tr>
								<td style="width: 210px;">
									<div class="popup">
										<b><span data-i18n="rule-of-16-label">Rule of 16</span></b>
									</div>
									<div class="tooltip max-skill-9">
										<span data-i18n="rule-of-16-tooltip">B349. If a supernatural attack (magic spell, psi ability, etc.) offers a resistance roll and the subject is living or sapient, the attacker's effective skill cannot exceed the higher of 16 and the defender's actual resistance. If it does, reduce it to that level.</span>
									</div>
								</td>
								<td>
									<input type="checkbox" name="attr_spell_roll_rule_of_16" value="1" checked="checked" title="Macro: @{NAME|spell_roll_rule_of_16}" />
								</td>
							</tr>
						</table>
						
					</div><!-- end option-container -->
					
					<div class="option-container">
						
						<h4><span data-i18n="rules-as-written-label">Rules as Written</span></h4>
						
						<div>
							<input type="checkbox" name="attr_show_raw_defensive_notes" value="1" checked="checked" />
							<span class="popup">
								<span data-i18n="abbreviation-show-rules-as-written-notes-label">Show RAW Notes</span>
							</span>
							<span class="tooltip">
								<span data-i18n="abbreviation-show-rules-as-written-notes-tooltip">
									Show <b>Rules as Written</b> Success/Fail notes in roll results template. Such as notes for active defenses and attacks.
								</span>
							</span>
						</div>
						
					</div><!-- end option-container -->

					<div class="option-container">
						
						<h4><span data-i18n="damage-table-label">Damage Table</span></h4>
						
						<div>
							<input type="checkbox" name="attr_damage_update_hit_points" value="1" />
							<span class="popup">
								<span data-i18n="update-hit-points-label">Update Hit Points</span>
							</span>
							<span class="tooltip">
								<span data-i18n="update-hit-points-tooltip">
									If checked, when applying damage to a location, current <b>Hit Points</b> is updated.
								</span>
							</span>
						</div>
						
					</div><!-- end option-container -->

					<div class="option-container">
						
						<h4><span data-i18n="hit-location-options-label">Hit Location Options</span></h4>
						
						<div class="grid-2-column-auto grid-standard grid__gap_small grid__padding grid__align_top">

							<div class="grid-cell">
								<span data-i18n="use-custom-layer-labels">Use custom layer labels</span>
							</div>
							<div class="grid-cell">
								<input type="checkbox" name="attr_hit_location_layer_use_custom_labels" value="1">
							</div>
							
							<div class="grid-cell">
								<span data-i18n="layer-one-label">Layer 1 Label</span>
							</div>
							<div class="grid-cell">
								<input type="text" name="attr_hit_location_layer_one_label" value="Layer 1">
							</div>
							
							<div class="grid-cell">
								<span data-i18n="layer-two-label">Layer 2 Label</span>
							</div>
							<div class="grid-cell">
								<input type="text" name="attr_hit_location_layer_two_label" value="Layer 2">
							</div>

							<div class="grid-cell">
								<span data-i18n="layer-three-label">Layer 3 Label</span>
							</div>
							<div class="grid-cell">
								<input type="text" name="attr_hit_location_layer_three_label" value="Layer 3">
							</div>

							<div class="grid-cell">
								<span data-i18n="layer-four-label">Layer 4 Label</span>
							</div>
							<div class="grid-cell">
								<input type="text" name="attr_hit_location_layer_four_label" value="Layer 4">
							</div>
							
						</div>
						
					</div><!-- end option-container -->
					
				</div><!-- end option-column -->
				
				<div class="option-column">

					<div class="option-container">
						<h4>
							<span data-i18n="resync-character-label">Resync Character Sheet</span>
						</h4>
						<div class="reset resync">
							<input type="hidden" name="attr_resync_state" value="normal" />
							<button type="action" name="act_resync" class="reset">
								<span data-i18n="resync-label">Resync</span>
							</button>
						</div>
						<div>
							<ul>
								<li>Resync repeating Skills and items linked them.</li>
								<li>Resync repeating Techniques and items linked them.</li>
								<li>Resync repeating Inventory cost and weight.</li>
							</ul>
						</div>
					</div>
					
					<div class="option-container damage-dice">
						<h4>
							<span data-i18n="damage-dice-icon">Damage Dice Icon</span>
						</h4>
						
						<div>
							<input type="radio" name="attr_damage_dice_type" value="explode" checked="true" />
							<button type="roll" value="0" name="btn_damage_dice_explode" class="roll_explode btn" disabled="disabled" />
						</div>
						<div>
							<input type="radio" name="attr_damage_dice_type" value="d6black" />
							<button type="roll" value="0" name="btn_damage_dice_d6black" class="btn" disabled="disabled" />
						</div>
						<div>
							<input type="radio" name="attr_damage_dice_type" value="d20blank" />
							<button type="roll" value="0" name="btn_damage_dice_d20blank" class="btn roll_d20blank" disabled="disabled" />
						</div>
						<div>
							<input type="radio" name="attr_damage_dice_type" value="d4skull" />
							<button type="roll" value="0" name="btn_damage_dice_d4skull" class="btn roll_d4skull" disabled="disabled" />
						</div> 
					</div><!-- end damage dice icon -->

					<div class="option-container">
						<div>
							<input type="checkbox" name="attr_use_malfunction" value="1" />
							<span class="popup">
								<span data-i18n="use-malfunction-label">Use Malfunction</span>
							</span>
							<span class="tooltip">
								<span data-i18n="use-malfunction-tooltip">If checked, roll results will check for malfunction.</span>
							</span>
						</div>
						<div>
							<input type="checkbox" name="attr_use_metric" value="1" />
							<span class="popup">
								<span data-i18n="use-metric-label">Use Metric Weights</span>
							</span>
							<span class="tooltip">
								<span data-i18n="use-metric-tooltip">If checked, labels will be changed from LBS (pounds) to KG (kilograms) and encumbrance formula will use metric weights.</span>
							</span>
						</div>
						<div>
							<input type="hidden" name="attr_metric_title" />
							<input type="checkbox" name="attr_use_metric_distances" value="1" />
							<span class="popup">
								<span data-i18n="use-metric-distances-label">Use Metric Distances</span>
							</span>
							<span class="tooltip">
								<span data-i18n="use-metric-distances-tooltip">If checked, the tool <b>Travel Time and Distances</b> will display results in metric.</span>
							</span>
						</div>
					</div><!-- end malfunction -->
					
					<div class="option-container">

						<h4>
							<span data-i18n="stat-modifier-options-label">Stat Modifier Options</span>
						</h4>
						
						<div>
							<input type="radio" name="attr_mod_cascade" value="all" checked="true" />
							<span data-i18n="modifiers-to-attributes-increase-all-label">Mods to attributes increase all derived stats (including HP, FP)</span>
						</div>
						<div>
							<input type="radio" name="attr_mod_cascade" value="some" />
							<span data-i18n="modifiers-to-attributes-increase-most-label">Mods to attributes increase most derived stats (not HP, FP)</span>
						</div>
						<div>
							<input type="radio" name="attr_mod_cascade" value="none" />
							<span data-i18n="modifiers-to-attributes-increase-none-label">Mods to attributes do not increase derived stats</span>
						</div>
					</div><!-- end stat modifier options -->

					<div class="option-container">
						
						<h4>
							<span data-i18n="sheet-style-label">Sheet Style</span>
						</h4>
						
						<span data-i18n="sheet-style-description">Selects a visual style for the character sheet</span>
						
						<div>
							<select name="attr_sheetstyle"/>
								<option value="0" data-i18n="sheet-style-green-option" class="color-option-0">Green</option> <!-- Color Style options, remember to add one to add a new option-->
								<option value="1" data-i18n="sheet-style-blue-option" class="color-option-1">Blue</option>
								<option value="2" data-i18n="sheet-style-beige-option" class="color-option-2">Beige</option>
								<option value="3" data-i18n="sheet-style-gray-option" class="color-option-3">Gray</option>
								<option value="5" data-i18n="sheet-style-pastel-pink-option" class="color-option-5">Pastel Pink</option>
								<option value="6" data-i18n="sheet-style-pastel-earth" class="color-option-6">Pastel Earth</option>
								<option value="7" data-i18n="sheet-style-purple-option" class="color-option-7">Purple</option>
								<option value="8" data-i18n="sheet-style-fabric-option" class="color-option-8">Fabric</option>
								<option value="4" data-i18n="sheet-style-classic-white-option" class="color-option-4" selected>Classic White</option>
							</select>
						</div>
					</div><!-- end style selector options -->

					<div class="option-container">
						
						<h4>
							<span data-i18n="chat-style-label">Chat Style</span>
						</h4>
						
						<span data-i18n="chat-style-tooltip">Selects a visual style for the chat roll results.</span>
						
						<div>
							<input type="hidden" name="attr_chatstyle_new" value="true" />
							<select name="attr_chatstyle"/>
								<option value="0" data-i18n="sheet-style-green-option" class="color-option-0">Green</option> <!-- Color Style options, remember to add one to add a new option-->
								<option value="1" data-i18n="sheet-style-blue-option" class="color-option-1">Blue</option>
								<option value="2" data-i18n="sheet-style-beige-option" class="color-option-2">Beige</option>
								<option value="3" data-i18n="sheet-style-gray-option" class="color-option-3">Gray</option>
								<option value="5" data-i18n="sheet-style-pastel-pink-option" class="color-option-5">Pastel Pink</option>
								<option value="6" data-i18n="sheet-style-pastel-earth" class="color-option-6">Pastel Earth</option>
								<option value="7" data-i18n="sheet-style-purple-option" class="color-option-7">Purple</option>
								<option value="8" data-i18n="sheet-style-fabric-option" class="color-option-8">Fabric</option>
								<option value="4" data-i18n="sheet-style-classic-white-option" class="color-option-4" selected>Classic White</option>
							</select>
						</div>
					</div><!-- end style selector options -->

				</div><!-- end option-column -->
				
			</div><!-- end options row -->
				
			<div class="options rule-options">
				
				<input type="hidden" name="attr_raw_slam_attack_notes" value="" />
				<span style="display:none;" data-i18n="raw_slam_attack_notes">slam attack notes</span>

				<input type="hidden" name="attr_raw_slam_damage_notes" value="" />
				<span style="display:none;" data-i18n="raw_slam_damage_notes">slam attack damage notes</span>
		
				<div class="option-column">
				
					<div class="option-container collision-falling-options">
						<h4>
							<span data-i18n="falling-damage-notes-label">Falling Damage Notes B431</span>
						</h4>
						<textarea name="attr_falling_damage_notes">**Immovable Objects:** Inflict damage on both objects. If immovable is breakable, moving object can't inflict/take more damage than immovable's (HP + DR). 

**Immovable Soft Object:** Add DR 2 (feather bed) to DR 10 (safety net).

**Striking Water:** Swimming or Vehicle Skill Roll minus Speed Penalty from Size and Speed/Range Table B550 to avoid all damage.

**Armor:** ALL armor counts as flexible armor. If DR blocks all damage, moving object suffers 1 HP per 5 points of falling damage.

**Falling Damage**: If using hit locations, roll randomly. If extremity/limb, do not ignore injury in excess of crippling damage. Instead, subtract the full amount from HP! If crippled limb, roll 1d. On 5-6, all limbs of that type are crippled, although there is no extra injury.</textarea>
					</div>

					<div class="option-container collision-falling-options">
						<h4>
							<span data-i18n="collision-damage-notes-label">Collision Damage Notes B431</span>
						</h4>
						<textarea name="attr_collision_damage_notes">**Immovable Objects:** Inflict damage on both objects. If immovable is breakable, moving object can't inflict/take more damage than immovable's (HP + DR). 

**Immovable Soft Object:** Add DR 2 (feather bed) to DR 10 (safety net).

**Striking Water:** Swimming or Vehicle Skill Roll minus Speed Penalty from Size and Speed/Range Table B550 to avoid all damage.

**Armor:** ALL armor counts as flexible armor. If DR blocks all damage, moving object suffers 1 HP per 5 points of falling damage.</textarea>
					</div>
					
					<div class="option-container collision-falling-options">
						<h4>
							<span data-i18n="demolition-damage-notes-label">Demolition Damage Notes</span>
						</h4>
						<textarea name="attr_demolition_damage_notes">Explosion damage. Targets struck directly takes listed damage. Apply "collateral damage" of Damage / (3 x distance from center of blast) rounded down.

* Use torso armor to determine DR against explosion.
* If the explosion has an armor divisor, do NOT apply to "collateral damage.
* Explosions are considered incendiary. see Catching Fire B434.
* Can use Dodge and Drop (B377) to avoid collateral damage.
* See B414</textarea>
					</div><!-- end option-container -->
				
					<div class="option-container collision-falling-options">
						<h4>
							<span data-i18n="fragmentation-skill-notes-label">Fragmentation Skill Notes</span>
						</h4>
						<textarea name="attr_fragmentation_skill_notes">For every three points by which the attack roll succeeds, one additional fragment strikes the target.

The only active defense against fragments is to dive away from the explosion that produced them; see Dodge and Drop and Diving for Cober (B377).

For each hit, roll hit location randomly. If that location is behind cover, the fragment hits cover.</textarea>
					</div><!-- end option-container -->
					
					<div class="option-container collision-falling-options">
						<h4>
							<span data-i18n="fragmentation-damage-notes-label">Fragmentation Damage Notes</span>
						</h4>
						<textarea name="attr_fragmentation_damage_notes">Fragmentation damage is cutting. Note that if an explosive attack has an armor divisor, this does not apply to the fragments it produces.</textarea>
					</div><!-- end option-container -->
					
					<div class="option-container">
						
						<table>
							<tr>
								<td>
									<b><span data-i18n="fragmentation-recoil-label">Fragmentation Recoil:</span></b>
								</td>
								<td>
									<input type="number" step="1" value="3" name="attr_fragmentation_recoil"></input>
								</td>
							</tr>
						</table>
						
					</div><!-- end option-container -->

					<div class="option-container">

						<!-- knockdown and stunning check -->
						<div class="option-container collision-falling-options">
						
							<div>
								<button type="action" name="act_knockdown_check_notes_reset" class="reset" style="width: auto;">
									<span data-i18n="reset-knockdown-check-button-label">Reset Knockdown Check Notes</span>
								</button>
								<br />
								<span data-i18n="knockdown-check-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
							</div>
						
							<h4>
								<span data-i18n="knockdown-check-success-notes-label">Knockdown Check Success Notes</span>
							</h4>
							<textarea name="attr_knockdown_check_success_notes">You suffer no penalty beyond ordinary shock. (B420)</textarea>
						
							<h4>
								<span data-i18n="knockdown-check-critical-success-notes-label">Knockdown Check Critical Success Notes</span>
							</h4>
							<textarea name="attr_knockdown_check_critical_success_notes">You suffer no penalty beyond ordinary shock.</textarea>
						
							<h4>
								<span data-i18n="knockdown-check-fail-notes-label">Knockdown Check Fail Notes</span>
							</h4>
							<textarea name="attr_knockdown_check_fail_notes">You're stunned; see Effects of Stun, B420. You fall prone (if you weren't already), and if you were holding anything, you drop it.

**On a Failure by 5 or more:** You fall unconscious! See Recovering from Unconsciousness (B423). Obviously, you fall prone (if you weren't already), and if you were holding anything, you drop it. (B420)</textarea>
		
							<h4>
								<span data-i18n="knockdown-check-critical-failure-notes-label">Unstun Check Critical Failure Notes</span>
							</h4>
							<textarea name="attr_knockdown_check_critical_failure_notes">You fall unconscious! See Recovering from Unconsciousness (B423). Obviously, you fall prone (if you weren't already), and if you were holding anything, you drop it. (B420)</textarea>
		
						</div><!-- end option-container -->

						<!-- unconscious check -->
						<div class="option-container collision-falling-options">
						
							<div>
								<button type="action" name="act_unconscious_check_notes_reset" class="reset" style="width: 203px;">
									<span data-i18n="reset-unconscious-check-button-label">Reset Unconscious Check Notes</span>
								</button>
								<br />
								<span data-i18n="unconscious-check-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
							</div>
						
							<h4>
								<span data-i18n="unconscious-check-success-notes-label">Unconscious Check Success Notes</span>
							</h4>
							<textarea name="attr_unconscious_check_success_notes">You are able to remain conscious.</textarea>
						
							<h4>
								<span data-i18n="unconscious-check-critical-success-notes-label">Unconscious Check Critical Success Notes</span>
							</h4>
							<textarea name="attr_unconscious_check_critical_success_notes">You are able to remain conscious. The GM decides if there is some unusual benefit because of the Critical Success.</textarea>
						
							<h4>
								<span data-i18n="unconscious-check-fail-notes-label">Unconscious Check Fail Notes</span>
							</h4>
							<textarea name="attr_unconscious_check_fail_notes">The GM to decide whether you are truly unconscious or just totally incapacitated by pain and injury - but either way, you can't do anything. If you fall unconscious, see Recovering from Unconsciousness (B423).</textarea>
		
							<h4>
								<span data-i18n="unconscious-check-critical-failure-notes-label">Unconscious Check Critical Failure Notes</span>
							</h4>
							<textarea name="attr_unconscious_check_critical_failure_notes">The GM to decide whether you are truly unconscious or just totally incapacitated by pain and injury - but either way, you can't do anything. If you fall unconscious, see Recovering from Unconsciousness (B423). The GM decides if there is some unusual disaster because of the Critical Failure.</textarea>
		
						</div><!-- end option-container -->

					</div>
					
				</div><!-- end option-column -->
				
				<div class="option-column">
					
					<!-- Spell Roll Result Notes -->
					<div class="option-container collision-falling-options">
						<div>
							<button type="action" name="act_spell_notes_reset" class="reset" style="width: 111px;">
								<span data-i18n="reset-spell-notes-button-label">Reset Spell Notes</span>
							</button>
							<br />
							<span data-i18n="spell-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
						</div>

						<h4>
							<span data-i18n="spell-critical-success-notes-label">Spell Critical Success Notes</span>
						</h4>
						<textarea name="attr_spell_critical_success_notes">The spell works especially well. **Details are up to the GM**, who should be both generous and creative. Whatever else occurs, there is never an energy cost if you get a critical success when you cast a spell. B235, M7</textarea>
					
						<h4>
							<span data-i18n="spell-fail-notes-label">Spell Fail Notes</span>
						</h4>
						<textarea name="attr_spell_fail_notes">The spell does not work. If success would have cost energy, you lose one energy point; otherwise, you lose nothing. (Exception: You must pay the full energy cost even on a failure for an Information spell; see Information Spells. B235, M7.

**In Very High Mana Areas**, all Failures are treated as Critical Failures. M6.</textarea>

						<h4>
							<span data-i18n="spell-critical-failure-notes-label">Spell Critical Failure Notes</span>
						</h4>
						<textarea name="attr_spell_critical_failure_notes">You must spend the full energy cost and the spell fails . . . badly! **The GM may** use the Critical Spell Failure Table on B236 or, M7, or improvise some other “backfire” he finds amusing. (B235, M7.)

**In Very High Mana Areas**, all actual Critical Failures produce spectacular disasters! (M6)

**In Low Mana Areas**, Critical Failures have mild effects or no effect at all. (M6)</textarea>

					</div><!-- end option-container -->
					
					<!-- fright check roll result notes -->
					<div class="option-container collision-falling-options">
						<div>
							<button type="action" name="act_fright_check_notes_reset" class="reset" style="width: 165px;">
								<span data-i18n="reset-fright-check-button-label">Reset Fright Check Notes</span>
							</button>
							<br />
							<span data-i18n="fright-check-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
						</div>
					
						<h4>
							<span data-i18n="fright-check-success-notes-label">Fright Check Success Notes</span>
						</h4>
						<textarea name="attr_fright_check_success_notes">You suffer no ill effects. (B360)</textarea>
					
						<h4>
							<span data-i18n="fright-check-critical-success-notes-label">Fright Check Critical Success Notes</span>
						</h4>
						<textarea name="attr_fright_check_critical_success_notes">You suffer no ill effects. (B360)  The GM decides if there is some unusual benefit because of the Critical Success.</textarea>
					
						<h4>
							<span data-i18n="fright-check-fail-notes-label">Fright Check Fail Notes</span>
						</h4>
						<textarea name="attr_fright_check_fail_notes">Roll 3d6, add your margin of failure on the Fright Check, and consult the Fright Check Table B360-361. (B360). Also, if using GURPS Horror, add -1 to the Stress or Derangement value as appropriate (H141).</textarea>
	
						<h4>
							<span data-i18n="fright-check-critical-failure-notes-label">Fright Check Critical Failure Notes</span>
						</h4>
						<textarea name="attr_fright_check_critical_failure_notes">Roll 3d6, add your margin of failure on the Fright Check, and consult the Fright Check Table B360-361. (B360). Also, if using GURPS Horror, add -3 to the Stress or Derangement value as appropriate (H141). The GM decides if there is some unusual disaster because of the Critical Failure.</textarea>
	
					</div><!-- end option-container -->
					
					<div class="option-container collision-falling-options">
						
						<div>
							<button type="action" name="act_unstun_check_notes_reset" class="reset" style="width:auto;">
								<span data-i18n="reset-unstun-check-button-label">Reset Unstun Check Notes</span>
							</button>
							<br />
							<span data-i18n="unstun-check-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
						</div>
					
						<h4>
							<span data-i18n="unstun-check-success-notes-label">Unstun Check Success Notes</span>
						</h4>
						<textarea name="attr_unstun_check_success_notes">You recover from stun and can act normally on subsequent turns. (B420)</textarea>
					
						<h4>
							<span data-i18n="unstun-check-critical-success-notes-label">Fright Check Critical Success Notes</span>
						</h4>
						<textarea name="attr_unstun_check_critical_success_notes">You recover from stun and can act normally on subsequent turns. (B420) The GM decides if there is some unusual benefit because of the Critical Success.</textarea>
					
						<h4>
							<span data-i18n="unstun-check-fail-notes-label">Unstun Check Fail Notes</span>
						</h4>
						<textarea name="attr_unstun_check_fail_notes">You remain stunned; your next maneuver must also be Do Nothing, but you get another roll at the end of that turn... and so on, until you recover from stun. (B420)</textarea>
	
						<h4>
							<span data-i18n="unstun-check-critical-failure-notes-label">Unstun Check Critical Failure Notes</span>
						</h4>
						<textarea name="attr_unstun_check_critical_failure_notes">You remain stunned; your next maneuver must also be Do Nothing, but you get another roll at the end of that turn... and so on, until you recover from stun. (B420) The GM decides if there is some unusual disaster because of the Critical Failure.</textarea>
	
					</div><!-- end option-container -->

					<!-- death check -->
					<div class="option-container collision-falling-options">
						
						<div>
							<button type="action" name="act_death_check_notes_reset" class="reset" style="width:auto;">
								<span data-i18n="reset-death-check-button-label">Reset Death Check Notes</span>
							</button>
							<br />
							<span data-i18n="death-check-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
						</div>
					
						<h4>
							<span data-i18n="death-check-success-notes-label">Death Check Success Notes</span>
						</h4>
						<textarea name="attr_death_check_success_notes">You don't die.</textarea>
					
						<h4>
							<span data-i18n="death-check-critical-success-notes-label">Death Check Critical Success Notes</span>
						</h4>
						<textarea name="attr_death_check_critical_success_notes">You don't die. The GM decides if there is some unusual benefit because of the Critical Success.</textarea>
					
						<h4>
							<span data-i18n="death-check-fail-notes-label">Death Check Fail Notes</span>
						</h4>
						<textarea name="attr_death_check_fail_notes">You died! When a PC or important NPC is killed in any but the most sudden and thorough fashion, the GM should allow a "dying action." If this is a final blow to the enemy, it should take no more than a turn. (B423)
**On a Failure of only 1 or 2:** you don't drop dead, but suffer a "mortal wound."" This is a wound so severe that your internal injuries might kill you even after you stop bleeding. (See Mortal Wounds B423)</textarea>
	
						<h4>
							<span data-i18n="death-check-critical-failure-notes-label">Death Check Critical Failure Notes</span>
						</h4>
						<textarea name="attr_death_check_critical_failure_notes">You died! When a PC or important NPC is killed in any but the most sudden and thorough fashion, the GM should allow a "dying action." If this is a final blow to the enemy, it should take no more than a turn. The GM decides if there is some unusual disaster because of the Critical Failure.</textarea>
	
					</div><!-- end option-container -->
						
				</div><!-- end option-column -->
				
				<div class="option-column">

					<div class="option-container damage-type-notes">
					
						<h4>
							<span data-i18n="editable-wound-modifier-notes-label">Editable Wound Modifier Notes</span>
						</h4>
					
						<div>
							<span data-i18n="editable-wound-modifier-notes-description">Initial wound modifier notes based on GURPS 4th Edition - Campaigns</span>
						</div>

						<div class="toggle-notes">
							<input type="checkbox" name="attr_use_damage_type_notes" value="1" checked="checked" />
							<span data-i18n="show-notes-in-roll-template-label">Show notes in roll template</span>
						</div>

						<div style="margin-bottom: 15px;">
							<button type="action" name="act_wound_notes_reset" class="reset">
								<span data-i18n="reset-button-label">Reset</span>
							</button><br />
							<span data-i18n="wound-notes-button-description">If you modified a note, you will not see the most recent rule updates. Press the button to get the recent rules. <b>NOTE:</b> this will replace any notes you made.</span>
						</div>
					
						<table>
							<tr>
								<th>
									<span data-i18n="type-label">Type</span>
								</th>
								<th>
									<span data-i18n="notes-label">Notes</span>
								</th>
							</tr>
							<tr>
								<td>
									<span data-i18n="cutting-label">Cutting</span>
								</td>
								<td>
									<textarea name="attr_damage_type_note_cut">**CUTTING** *(Always round down)*
**Damage:** x1.5 **Neck:** x2 **Skull:** x4
**Knockback:** A cutting attack can cause knockback only if it fails to penetrate DR. (B378)
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
									</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="impaling-label">Impaling</span>
								</td>
								<td>
									<textarea name="attr_damage_type_note_imp">**IMPALING** *(Always round down)*
**Damage:** x2 **Limbs:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x0.5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="crushing-label">Crushing</span>
								</td>
								<td>
									<textarea name="attr_damage_type_note_cr">**CRUSHING** *(Always round down)*
**Damage:** x1 **Neck:** x1.5 **Skull:** x4
**Knockback:** A crushing attack can cause knockback regardless of whether it penetrates DR. (B378)
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="abbreviation-piercing-label">PI</span>-
								</td>
								<td>
									<textarea name="attr_damage_type_note_pi_minus">**PIERCING-** *(Always round down)*
**Damage:** x.5 **Vitals:** x3 **Skull:** x4
**Unliving:** x1/5 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/10
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="abbreviation-piercing-label">PI</span>
								</td>
								<td>
									<textarea name="attr_damage_type_note_pi">**PIERCING** *(Always round down)*
**Damage:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1/3 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="abbreviation-piercing-label">PI</span>+
								</td>
								<td>
									<textarea name="attr_damage_type_note_pi_plus">**PIERCING+** *(Always round down)*
**Damage:** x1.5 **Limbs**: x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x0.5 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/3
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="abbreviation-piercing-label">PI</span>++
								</td>
								<td>
									<textarea name="attr_damage_type_note_pi_plus_plus">**PIERCING++** *(Always round down)*
**Damage:** x2 **Limbs:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x0.5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td>
									<span data-i18n="afflication-label">Affliction</span>
								</td>
								<td>
									<textarea name="attr_damage_type_note_aff">**AFFLICTION** *(Always round down)*
Special damage and affects based on affliction description
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)</textarea>
								</td>
							</tr>
							<tr>
								<td><span data-i18n="burn-label">Burn</span></td>
								<td>
									<textarea name="attr_damage_type_note_burn">**BURN** *(Always round down)*
**Damage:** x1 **Skull:** x4
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
								</td>
							</tr>
							<tr>
								<td><span data-i18n="corrosion-label">Corrosion</span></td>
								<td>
									<textarea name="attr_damage_type_note_cor">**CORROSION** *(Always round down)*
**Damage:** x1 **Neck:** x1.5 **Skull:** x4 **Face** x1.5
**Face** blind eye if major wound, both eyes if full HP
**Armor:** -1 DR per 5 points damage
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
									</td>
								</tr>
								<tr>
									<td>
										<span data-i18n="fatigue-label">Fatigue</span>
									</td>
									<td>
										<textarea name="attr_damage_type_note_fat">**FATIGUE** *(Always round down)*
**Damage:** x1
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Normal Fatigue Damage, but apply HP modifier if applicable. Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
									</td>
								</tr>
								<tr>
									<td>
										<span data-i18n="toxic-label">Toxic</span>
									</td>
									<td>
										<textarea name="attr_damage_type_note_tox">**TOXIC** *(Always round down)*
**Damage:** x1
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)(Additional Ref: B380)</textarea>
									</td>
								</tr>
								<tr>
									<td>
										<span data-i18n="special-label">Special</span>
									</td>
									<td>
										<textarea name="attr_damage_type_note_spec">**SPECIAL** *(Always round down)*
See notes for weapon.
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
									</td>
								</tr>
								<tr>
									<td>
										<span data-i18n="knockback-label">Knockback</span>
									</td>
									<td>
										<textarea name="attr_damage_type_note_knockback">**Knockback Only**  *(Always round down)*
B378
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP Knockback (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)</textarea>
									</td>
								</tr>
							</table>
							
					</div><!-- end option-container -->	
						
				</div><!-- end option-column -->
				
			</div><!-- end options row -->

			<div class="options import">

				<div class="instructions" style="width: 33%; float: left;">

					<h3>Import Tool [DEPRECATED]</h3>

					<p>
						Initial version is designed for a one time import. 
						This import is being replaced by a generic json formatted import.
						See the <b>Import</b> tab.
					</p>
	
					<h4>GCA4 Import</h4>
	
					<ol>
						<li>Export your character sheet to an XML file.
							<ul>
								<li>File > Export ... > <b>Check</b> Export XML File.</li>
							</ul>
						</li>
						<li>Convert the XML file to json.
							<ul>
								<li>https://jsonformatter.org/xml-to-json</li>
								<li><b style="color:red;">Alert!</b> Open the file in an editor like Notepad or Notepad++. Opening in a browser may break the formatting of the json!</li>
								<li>Initial testing worked with this sites. <b>Alert</b> if you use a different one make sure it <b>doesn't</b> create fields named <b>__cdata</b></li>
							</ul>
						</li>
						<li>Copy/Past the json data to the text box below.</li>
						<li>Press the <b>[Import CGA]</b> button</li>
						<li>Wait for the process to complete.</li>
						<li>Review the sheet and notify the Forum of any errors or feature requests.</li>
					</ol>
	
				</div>

				<div class="importer">

					<div class="json-data">
						<h4>JSON DATA</h4>

						<textarea name="attr_json_data" class="json-data"></textarea>
					</div>

					<div class="controls">

						<div class="import-reset">
							<button type="action" name="act_import_reset" class="btn reset">Reset</button>
						</div>

						<div class="import-button">
							<button type="action" name="act_import_gca" class="btn">Import GCA4</button>
						</div>

						<div style="display: none;">
							<button type="action" name="act_import_gcs" class="btn">Import GCS</button>
						</div>

						<div class="import-message">
							<input type="hidden" name="attr_import_message" value="Start Import" />
							<span name="attr_import_message"></span>
						</div>

					</div>

					<div class="controls">

						<div class="import-option">
							
							<div class="import-notes">
								<input type="checkbox" name="attr_import_notes" value="1" checked="checked" title="Macro: @{NAME|import_notes}" />
							</div>

							<div class="popup import-notes-popup">
								<span data-i18n="import-notes-label">Import Notes</span>
							</div>
							<span class="tooltip">
								<span data-i18n="import-notes-tooltip">Import notes into <i>Bio\Misc</i> fields and into <i>Notes</i> textboxes for repeating tables.</span>
							</span>

						</div>

					</div>

					<div class="control">
						<div>
							<h4 style="color:red;">Alert</h4>
							<p>
								Since the JSON data is large, please only press the button <b>once.</b> Then wait for the <b>Processing...</b> message to show.
								It might take more than 5 to 10 seconds to run, depending on your processing power. If the <b>Processing...</b> doesn't disappear 
								after 20 seconds or so, then something probably broke during the import.
							</p>
						</div>
					</div>

				</div>

			</div>

			<div class="options import">

				<div class="grid-standard grid-2-column-equal-width grid__gap_small">
						
					<div class="grid-cell">
						
						<div class="tools-container">

							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="import-tool-label">Import Tool</span></h3>
									<span class="tooltiptext">
										<span data-i18n="import-tool-tooltip">Uses a standard json format to import a character. There are existing methods to export data for GCA5 and GCS.</span>
									</span>
								</div>
							</div>

							<div class="content">
								<p>
									Imports a file using data based on a standard json schema for use with the GURPS Roll20 Charactersheet. 
									Exporter tools can be developed for a character generator in this format, instead of
									creating a special import for each character generator.  
								</p>
								<p>
									Initial version is designed to allow you to re-import your character. Be aware, this will overwrite general notes. 
									Future iterations will check for deleted items and remove them and import notes checkbox. This checkbox will 
									prevent overwriting any notes you may have written on the character sheet.
								</p>
							</div>
							
							<div class="grid-2-column-auto grid__align_center">
								<label class="sheet-toggle-button">
									<input type="checkbox" name="attr_gca5_instructions_toggle" value="1">
									<span></span>
								</label>
								<h4>GCA5 Instructions</h4>
							</div>
							
							<input type="hidden" name="attr_gca5_instructions_toggle" value="0" />
							<div class="content gca5-instructions">								
								<h5>How to Install</h5>

								<ul>
									<li>Open GCA5</li>
									<li>Update GCA5
										<ul>
											<li>Click on Help -> Check for Updates</li>
											<li>Click on Optional Packages tab</li>
											<li>Look for <b>Export to Roll20</b> and check <b>This package is installed</b></li>
											<li>Press the <b>OK</b> button to install the plugin.</li>
										</ul>
									</li>
									<li>Enable the Plugin
										<ul>
											<li>Click on Tools -> Plugins...</li>
											<li>Find the section titled <b>Export Character to Roll20</b></li>
											<li><i>Enable this plugin</i></li>
										</ul>
									</li>
								</ul>

								<h5>How to export</h5>

								<ul>
									<li>Open GCA5 and a character</li>
									<li>Click on File -> Export...</li>
									<li>Save the character and note where you saved it.</li>
								</ul>

								<h5>How to import</h5>

								<ul>
									<li>Open the file in a text editor, <b style="color:red;">NOT</b> a web browser.</li>
									<li>Copy the content and paste it into the box to the right.</li>
								</ul>
							</div>

							<div class="grid-2-column-auto grid__align_center">
								<label class="sheet-toggle-button">
									<input type="checkbox" name="attr_gcs_instructions_toggle" value="1">
									<span></span>
								</label>
								<h4>GCS Instructions</h4>
							</div>
							
							<input type="hidden" name="attr_gcs_instructions_toggle" value="0" />
							<div class="content gcs-instructions">
								<p>
									There is an initial GCS export file available that you can add to your <b>GCS User Library</b>. 
									Once you have it in your library, you can export your character to a Json file.
								</p>
								<ul>
									<li>Open GCS</li>
									<li>Under the <b>Library Explorer</b>, right-click on <b>User Library</b> and then click on <b>Show on Disk</b>.</li>
									<li>Create a new folder named <b>Output Templates</b></li>
									<li>In that folder create an empty file named <b>Roll20.json</b></li>
									<li>
										Use the link below so you can get the file contents. <b>NOTE:</b> The best method is to download the file and open 
										it in a editor like Notepad.
									</li>
									<li>Copy the file contents into the file you named <b>Roll20.json</b></li>
									<li>To Export to Roll20, in GCS go to File > Export to... > User Library > Roll20.</li>
									<li>
										<b>Important:</b> After importing you will need to verify the content and adjust accordingly. 
										Due to the limitations of the Go <i>text/template</i> system, which is standard for templating systems, 
										it allows a limited set of coding logic.
									</li>
								</ul>
								<div class="control">
									<button type="roll" class="no-decoration btn ui-draggable" name="roll_blank" value="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/GURPS/Docs/GCS/Roll20.json" title="Show link in chat. NOTE: Right-click to open in new window">
										<span data-i18n="gcs-roll20-file-link-button" style="font-size: .9em;">Roll20.json</span>
									</button>
								</div>
								<div>
									<p>
										<b>NOTE:</b> This file is a work in progress and may not be up to date with the latest changes to GCS, 
										and it hasn't been thoroughly tested, I've imported four characters so far. Please report any issues 
										or suggestions on the Roll20 Forum.
									</p>
									<h4>Future Revisions</h4>
									<p>
										This is a complicated export and will need support from users and people willing to dig deeper into the export templating code.
										I will also try to make adjustments based on user input and suggestions. Fortunately, I was able to employ GitHub Copilot to help with developement, 
										which saved a dramatic amout of development time, especially when trying to fix trailing commas, which is not allowed in Json.
									</p>
									<h5>Helfpul links</h5>
									<div class="control">
										<button type="roll" class="no-decoration btn ui-draggable" name="roll_blank" value="https://github.com/richardwilkes/gcs_master_library/blob/master/Library/Markdown/Help/Export%20Templates.md" title="Show link in chat. NOTE: Right-click to open in new window">
											<span data-i18n="gcs-template-readme-link-button" style="font-size: .9em;">GCS Export Template Readme</span>
										</button>
									</div>
									<div class="control">
										<button type="roll" class="no-decoration btn ui-draggable" name="roll_blank" value="https://github.com/richardwilkes/gcs_master_library/blob/master/Library/Markdown/Help/Expression%20Functions.md" title="Show link in chat. NOTE: Right-click to open in new window">
											<span data-i18n="gcs-functions-link-button" style="font-size: .9em;">GCS Expression Functions</span>
										</button>
									</div>
									<h4>GCS Master Library</h4>
									<p>
										The goal is to eventually add the Roll20.json to the <b>GCS Master Library</b>. This will allow for a more streamlined process for exporting to Roll20.
									</p>
								</div>
							</div>
						</div>

					</div>

					<div class="grid-cell">

						<div class="tools-container">
						
							<div class="section-header">
								<div class="standard-tooltip">
									<h3><span data-i18n="json-data-label">JSON DATA</span></h3>
									<span class="tooltiptext">
										<span data-i18n="json-data-tooltip">Copy/paste the json data here.</span>
									</span>
								</div>
							</div>

							<div class="content">
								<textarea name="attr_character_json_data" class="json-data"></textarea>
							</div>

							<div class="content controls">

								<div class="grid-import-controls grid__align_center grid__gap_small">

									<div class="grid-cell">
										<label>
											<input type="checkbox" name="attr_import_confirm_delete_tables" value="1" />
											<div class="sheet-standard-tooltip">
												<span data-i18n="delete-repeating-tables-question">Do you want to delete tables?</span>
												<span class="sheet-tooltiptext">
													<span data-i18n="delete-repeating-tables-question-tooltip">If checked, the delete button will become active. This can be helpful if items were re-added or removed in the original application. The system is unable to delete tables and import them at the same time, so you have to delete the tables before importing.</span>
												</span>
											</div>
										</label>
									</div>

									<div class="grid-cell">
										<input type="hidden" name="attr_import_confirm_delete_tables" value="0" />
										<button type="action" name="act_import_delete_tables" class="btn reset wide-reset">Delete Tables</button>
									</div>

									<div class="grid-cell">
										<input type="hidden" name="attr_import_json_state" value="normal" />
										<button type="action" name="act_import_json" class="btn sheet-reset">Import</button>
									</div>

									<div class="grid-cell">
										&nbsp;
									</div>

									<div class="grid-cell">
										<button type="action" name="act_import_json_reset" class="sheet-btn">Reset</button>
									</div>

								</div>						
		
							</div>

							<div class="content">
								<input type="hidden" name="attr_import_json_message" value="Start Import" />
								<span name="attr_import_json_message"></span>
							</div>

							<div class="content">
								<h4>
									<span data-i18n="tips-label">Tips</span>
								</h4>
								<div>
									<span data-i18n="import-tips-description">
										<p>After importing, compare your Roll20 sheet to the original application character sheet.</p>
										<p>Roll20 doesn't support parent/child relationship, repeating tables will be imported alphabetically.</p>
									</span>
								</div>
							</div>

						</div>
						
					</div>
					
				</div>

			</div>

		</div>

	</div> <!-- .tab0 -->

</div>

<div>
	
	<!-- ===== ===== ===== ===== LOGO ===== ===== ===== ===== -->

	<div class="logo">
	
		<div class="control">
			<button type="roll" class="no-decoration" name="roll_blank" value="https://wiki.roll20.net/GURPS_4th_Edition" title="Show link in chat. NOTE: Right-click to open in new window">
				<span data-i18n="gurps-4th-edition-wiki-button">GURPS 4th Edition Roll20 Wiki Page</span>
			</button>
		</div>
	
		<h3> Your feedback is most welcomed! See link below.</h3>
	
		<div class="control">
			<button type="roll" class="no-decoration" name="roll_blank" value="https://app.roll20.net/forum/post/10667695/gurps-sheet-number-1-thread-2/" title="Show link in chat. NOTE: Right-click to open in new window">
				<span data-i18n="gurps-sheet-thread-link-button">Roll20 Forum - [GURPS] - Sheet #1 - Thread 2</span>
			</button>
		</div>

		<div>
			<p>
				Come join our dedicated GURPS discord channel at GURPS R20-CS
			</p>
		</div>

		<div>
			<h4>
				<span data-i18n="sheet-type-label">Sheet Type</span>
			</h4>

			<div>
				<select name="attr_gurps_sheet_type">
					<option>-- Select --</option>
					<option value="character" selected>Standard Character Sheet</option>
					<!--<option value="vehicle">Vehicle Sheet</option>-->
					<option value="chase">Chase Sheet</option>
				</select>
			</div>
			
		</div>

	</div>

</div>

<!-- ROLL TEMPLATES -->
<div class="rolltemplates">

	<rolltemplate class="sheet-rolltemplate-columnlayout">

		<div class="container rolltemplate-color-setting-{{sheetStyle}}">

			<div class="grid-{{columns}}-column-auto grid__padding">

				<div class="grid-item header__bg">
					<label>{{header1}}</label>
				</div>
				<div class="grid-item header__bg">
					<label>{{header2}}</label>
				</div>
				<div class="grid-item header__bg">
					<label>{{header3}}</label>
				</div>
				{{#header4}}
				<div class="grid-item header__bg">
					<label>{{header4}}</label>
				</div>
				{{/header4}}
				{{#header5}}
				<div class="grid-item header__bg">
					<label>{{header5}}</label>
				</div>
				{{/header5}}

				<!-- list all the other properties that were not defined -->
				{{#allprops() columns sheetStyle header1 header2 header3 header4 header5}}
				<div class="grid-item data__item">
					{{value}}
				</div>
				{{/allprops() columns sheetStyle header1 header2 header3 header4 header5}}

			</div>

		</div>

	</rolltemplate>
    
    <rolltemplate class="sheet-rolltemplate-addToTracker">
        <div class="container rolltemplate-color-setting-{{sheetStyle}}">
            <table class="result">
                <tr>
                    <th colspan="2">
						{{characterName}}
					</th>
                </tr>
				
				<tr>
					<td colspan="2" class="subhead">{{skillName}}
						{{#subSkillName}}
							<span class="normal">{{subSkillName}}</span>
						{{/subSkillName}}
						{{#skillNameTechLevel}}
							<span>{{skillNameTechLevel}}</span> <span>(see B168)</span>
						{{/skillNameTechLevel}}
					</td>
				</tr>

                <tr>
                    <td class="label"><span data-i18n="base-label">BASE</span>:</td>
                    <td>{{basicSpeed}}</td>
                </tr>

				<tr>
					<td colspan="2"><span data-i18n="speed-ties-description">DX has been added to Speed to help break ties. (B363)</span></td>
				</tr>

            </table>
        </div>
    </rolltemplate>

    <rolltemplate class="sheet-rolltemplate-skillRoll">
        <div class="container rolltemplate-color-setting-{{sheetStyle}}">
            <table class="result">
                <tr>
                    <th colspan="2">
						{{characterName}}
						{{#target1}}
							<span data-i18n="targets-label" class="sheet-damageType">Targets</span>
							{{target1}}
						{{/target1}}
					</th>
                </tr>
				<tr>
					<td colspan="2" class="subhead">{{skillName}}
						{{#parentName}}
							<br />Parent: <i style="font-weight:normal;">{{parentName}}</i>
						{{/parentName}}
						{{#subSkillName}}
							<span class="normal">{{subSkillName}}</span>
						{{/subSkillName}}
						{{#skillNameTechLevel}}
							<span>/TL{{skillNameTechLevel}}</span> <span>(see B168)</span>
						{{/skillNameTechLevel}}
					</td>
				</tr>				
                {{#type}}
                <tr>
                    <td class="label"><span data-i18n="type-label">Type</span>:</td>
                    <td>
                        {{type}}
                        {{#bookReference}}
                        <span class="ref-label"><b><span data-i18n="abbreviation-book-reference-label">Ref</span>:</b> {{bookReference}}</span>
                        {{/bookReference}}
                    </td>
                </tr>
				{{/type}}
				{{#selected}}
                <tr>
                    <td class="label"><span data-i18n="selected-label">Selected</span>:</td>
                    <td>
                        {{selected}}
                    </td>
                </tr>
                {{/selected}}
				{{#rollResult}}
                        
                        <!-- WARNING THIS IS GOING TO GET UGLY AND HARD TO FOLLOW -->
                        
                        <!-- NOTE: Regardless of the score you are rolling against, -->
                        <!-- a roll of 3 or 4 is always a success, while a roll of 17 or 18 is always a failure. -->
                        
                        <!-- Roll of 18 is always critical failure -->
						{{#rollTotal() rollResult 18}}
                        <tr>
							<td class="label"><span data-i18n="roll-label">Roll:</span></td>
							<td>
								<span class="failure">
									{{rollResult}}
									<span class="failure-text">
										{{#showHitLabel}}Critical Miss{{/showHitLabel}}
										{{#showSuccessLabel}}Critical Failure{{/showSuccessLabel}}
									</span>
								</span>
							</td>
						</tr>
                        
						{{#effectiveSkill}}
						<tr>
							<td class="label"><span data-i18n="target-label">Target</span>:</td>
							<td class="effective-skill">
								{{effectiveSkill}}

								{{#computed::rollDifference}}
								
									{{#rollGreater() computed::rollDifference -1}}
									<span data-i18n="roll-made-by-label">Roll made by</span>
									<span class="success">
										{{computed::rollDifference}}
									</span>
									{{/rollGreater() computed::rollDifference -1}}

									{{#rollLess() computed::rollDifference 0}}
									<span data-i18n="roll-missed-by-label">Roll missed by</span>
									<span class="failure">
										{{computed::rollDifference}}
									</span>
									{{/rollLess() computed::rollDifference 0}}
									<br />
								{{/computed::rollDifference}}

								<!--
									Need to figure out how to display with rollDifference
								{{#useFrightLabel}}
									<i>Fright Threshold</i>
								{{/useFrightLabel}}
								
								{{#isSkillRoll}}
									<i>(Effective Skill)</i>
								{{/isSkillRoll}}
								-->

								<!-- If defense roll, check for effective skill below 1 -->
								{{#rollTotal() activeDefense 1}}
									{{#rollLess() effectiveSkill 1}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-one-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 1}}
								{{/rollTotal() activeDefense 1}}
								
								<!-- For other rolls, check for effective skill below 3 -->
								{{#rollTotal() activeDefense 0}}
									{{#rollLess() effectiveSkill 3}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-three-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 3}}
								{{/rollTotal() activeDefense 0}}

							</td>
						</tr>
						{{/effectiveSkill}}

						<!-- check for number of hits -->
						{{#rollGreater() computed::hits 0}}
						<tr>
							<td class="label"><span data-i18n="hits-label">Hits</span>:</td>
							<td>
								<span class="effective-skill">{{computed::hits}}</span> round(s) hit
								{{#shotsFired}}
									out of {{shotsFired}} shot(s)
								{{/shotsFired}}
							</td>
						</tr>
						{{/rollGreater() computed::hits 0}}

						<tr>
							<td colspan="2">
                                <!-- raw & custom critical failure note -->
								{{#rollTotal() showRawDefenseNotes 1}}
								{{#rawCriticalFailNote}}
								
								<!-- if not using malfunction, just display note as is-->
                                {{^useMalfunction}}
								    <div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
								{{/useMalfunction}}

								<!-- if using malfunction check for malfunction -->
								{{#rollTotal() useMalfunction 1}}
								
								<!-- If there's no malfuction #, then display note -->
								{{^malfunction}}
									<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
								{{/malfunction}}
								
								<!-- if there is a malfunction and it's value is 0, then display the note -->
								{{#malfunction}}
								{{#rollTotal() malfunction 0}}
									<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
								{{/rollTotal() malfunction 0}}
								{{/malfunction}}
								
								{{/rollTotal() useMalfunction 1}}
								
								{{/rawCriticalFailNote}}
								{{/rollTotal() showRawDefenseNotes 1}}

								{{#customCriticalFailNote}}
                                    <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                {{/customCriticalFailNote}}

								{{#rollTotal() isRepeatingSkill 1}}
								{{^customCriticalFailNote}}
									<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
								{{/customCriticalFailNote}}
								{{/rollTotal() isRepeatingSkill 1}}
                                    
							</td>
						</tr> 
                        {{/rollTotal() rollResult 18}}
                        
                        <!-- Roll of 17 is always a failure -->
                        {{#rollTotal() rollResult 17}}
						<tr>
							<td class="label"><span data-i18n="roll-label">Roll:</span></td>
							<td>
								<span class="failure">
									{{rollResult}}
									<span class="failure-text">
										
										<!-- skill of 15 or less is critical -->
										{{#rollLess() effectiveSkill 16}}Critical{{/rollLess() effectiveSkill 16}}
										
										{{#showHitLabel}}Miss{{/showHitLabel}}
										{{#showSuccessLabel}}Failure{{/showSuccessLabel}}
										
									</span>
								</span>
							</td>
						</tr>
                                
						{{#effectiveSkill}}
						<tr>
							<td class="label"><span data-i18n="target-label">Target</span>:</td>
							<td class="effective-skill">
								{{effectiveSkill}}

								{{#computed::rollDifference}}
								
									{{#rollGreater() computed::rollDifference -1}}
									<span data-i18n="roll-made-by-label">Roll made by</span>
									<span class="success">
										{{computed::rollDifference}}
									</span>
									{{/rollGreater() computed::rollDifference -1}}
									
									{{#rollLess() computed::rollDifference 0}}
									<span data-i18n="roll-missed-by-label">Roll missed by</span>
									<span class="failure">
										{{computed::rollDifference}}
									</span>
									{{/rollLess() computed::rollDifference 0}}
									<br />
								{{/computed::rollDifference}}

								<!--
									Need to figure out how to display with rollDifference
								{{#useFrightLabel}}
									<i>Fright Threshold</i>
								{{/useFrightLabel}}
								
								{{#isSkillRoll}}
									<i>(Effective Skill)</i>
								{{/isSkillRoll}}
								-->
								
								<!-- If defense roll, check for effective skill below 1 -->
								{{#rollTotal() activeDefense 1}}
									{{#rollLess() effectiveSkill 1}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-one-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 1}}
								{{/rollTotal() activeDefense 1}}
								
								<!-- For other rolls, check for effective skill below 3 -->
								{{#rollTotal() activeDefense 0}}
									{{#rollLess() effectiveSkill 3}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-three-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 3}}
								{{/rollTotal() activeDefense 0}}

							</td>
						</tr>
						{{/effectiveSkill}}

						<!-- check for number of hits -->
						{{#rollGreater() computed::hits 0}}
						<tr>
							<td class="label"><span data-i18n="hits-label">Hits</span>:</td>
							<td>
								<span class="effective-skill">{{computed::hits}}</span> round(s) hit
								{{#shotsFired}}
									out of {{shotsFired}} shot(s)
								{{/shotsFired}}
							</td>
						</tr>
						{{/rollGreater() computed::hits 0}}

						<tr>
							<td colspan="2">
                                <!-- skill of 16 or higher is normal failure, add helper text -->
                                {{#rollGreater() effectiveSkill 15}}
                                
                                    <!-- custom failure note -->
                                    {{#rawFailNote}}
                                        <div>{{rawFailNote}}</div>
                                    {{/rawFailNote}}
									
									{{#customFailNote}}
                                        <div>{{customFailNote}}</div>
                                    {{/customFailNote}}
                                    
                                {{/rollGreater() effectiveSkill 15}}
                                
                                <!-- skill of 15 or less is critical, add helper text -->
                                {{#rollLess() effectiveSkill 16}}
                                
                                    <!-- raw & custom critical failure note -->
									{{#rollTotal() showRawDefenseNotes 1}}
									{{#rawCriticalFailNote}}
									
									<!-- if not using malfunction, just display note as is-->
									{{^useMalfunction}}
										<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
									{{/useMalfunction}}

									<!-- if using malfunction check for malfunction -->
									{{#rollTotal() useMalfunction 1}}
									
										<!-- If there's no malfuction #, then display note -->
										{{^malfunction}}
											<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
										{{/malfunction}}
										
										<!-- if there is a malfunction and it's value is 0, then display the note -->
										{{#malfunction}}
										{{#rollTotal() malfunction 0}}
											<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
										{{/rollTotal() malfunction 0}}		
										{{/malfunction}}
									
									{{/rollTotal() useMalfunction 1}}
									
									{{/rawCriticalFailNote}}
									{{/rollTotal() showRawDefenseNotes 1}}
									
									{{#customCriticalFailNote}}
                                        <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                    {{/customCriticalFailNote}}
                                    
									{{#rollTotal() isRepeatingSkill 1}}
									{{^customCriticalFailNote}}
										<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
									{{/customCriticalFailNote}}
									{{/rollTotal() isRepeatingSkill 1}}
									
                                {{/rollLess() effectiveSkill 16}}
                                
                            </td>
						</tr>
                        {{/rollTotal() rollResult 17}}
                        
                        <!-- A roll of 3 or 4 always succeeds -->
                        {{#rollBetween() rollResult 3 4}}
						<tr>
							<td class="label"><span data-i18n="roll-label">Roll:</span></td>
							<td>
								<span class="success">
									{{rollResult}}
									<span class="success-text">
										
										<!-- if critical success is turned on, show text -->
										{{#rollLess() useCriticalPlusTen 2}}Critical{{/rollLess() useCriticalPlusTen 2}}
										
										{{#showHitLabel}}Hit{{/showHitLabel}}
										{{#showSuccessLabel}}Success{{/showSuccessLabel}}
									</span>
								</span>
							</td>	
						</tr>

						{{#effectiveSkill}}
						<tr>
							<td class="label"><span data-i18n="target-label">Target</span>:</td>
							<td class="effective-skill">
								{{effectiveSkill}}
								
								{{#computed::rollDifference}}
								
									{{#rollGreater() computed::rollDifference -1}}
									<span data-i18n="roll-made-by-label">Roll made by</span>
									<span class="success">
										{{computed::rollDifference}}
									</span>
									{{/rollGreater() computed::rollDifference -1}}
									
									{{#rollLess() computed::rollDifference 0}}
									<span data-i18n="roll-missed-by-label">Roll missed by</span>
									<span class="failure">
										{{computed::rollDifference}}
									</span>
									{{/rollLess() computed::rollDifference 0}}
									<br />
								{{/computed::rollDifference}}

								<!--
									Need to figure out how to display with rollDifference
								{{#useFrightLabel}}
									<i>Fright Threshold</i>
								{{/useFrightLabel}}
								
								{{#isSkillRoll}}
									<i>(Effective Skill)</i>
								{{/isSkillRoll}}
								-->
								
								<!-- If defense roll, check for effective skill below 1 -->
								{{#rollTotal() activeDefense 1}}
									{{#rollLess() effectiveSkill 1}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-one-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 1}}
								{{/rollTotal() activeDefense 1}}
								
								<!-- For other rolls, check for effective skill below 3 -->
								{{#rollTotal() activeDefense 0}}
									{{#rollLess() effectiveSkill 3}}
									<div style="color: red; margin-top: 6px;">
										<span data-i18n="rolltemplate-warning-less-than-three-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
									</div> 
									{{/rollLess() effectiveSkill 3}}
								{{/rollTotal() activeDefense 0}}
								
							</td>
						</tr>
						{{/effectiveSkill}}

						<!-- check for number of hits -->
						{{#rollGreater() computed::hits 0}}
						<tr>
							<td class="label"><span data-i18n="hits-label">Hits</span>:</td>
							<td>
								<span class="effective-skill">{{computed::hits}}</span> round(s) hit
								{{#shotsFired}}
									out of {{shotsFired}} shot(s)
								{{/shotsFired}}
							</td>
						</tr>
						{{/rollGreater() computed::hits 0}}

						<tr>
							<td colspan="2">
                                <!-- normal success area -->
                                {{#rollTotal() useCriticalPlusTen 2}}
                                
									<!-- block custom success note -->
									{{#rollTotal() showRawDefenseNotes 1}}
                                    {{#rawSuccessNote}}
                                        <div>{{rawSuccessNote}}</div>
                                    {{/rawSuccessNote}}
									{{/rollTotal() showRawDefenseNotes 1}}
                                    
									{{#customSuccessNote}}
                                        <div>{{customSuccessNote}}</div>
                                    {{/customSuccessNote}}
                                    
                                {{/rollTotal() useCriticalPlusTen 2}}
                                
                                <!-- Check if Critical Success was turned on -->
                                <!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
                                {{#rollLess() useCriticalPlusTen 2}}
                                
                                    <!-- block custom critical success note -->
                                    {{#rollTotal() showRawDefenseNotes 1}}
                                    {{#rawCriticalSuccessNote}}
                                        <div>{{rawCriticalSuccessNote}}</div>
                                    {{/rawCriticalSuccessNote}}
									{{/rollTotal() showRawDefenseNotes 1}}
                                    
									{{#customCriticalSuccessNote}}
                                        <div>{{customCriticalSuccessNote}}</div>
                                    {{/customCriticalSuccessNote}}

									{{#rollTotal() isRepeatingSkill 1}}
									{{^customCriticalSuccessNote}}
                                        <div><span data-i18n="default-repeating-skill-crit-success-message">The GM may determine what happens to You. (B347)</span></div>
                                    {{/customCriticalSuccessNote}}
									{{/rollTotal() isRepeatingSkill 1}}
									
                                {{/rollLess() useCriticalPlusTen 2}}
                                                    
                            </td>
						</tr>
                        {{/rollBetween() rollResult 3 4}}
                        
                        <!-- Roll from 5 to 16 means we have a chance at hit or miss -->
                        <!-- NOTE: A roll of 3 or 4 always succeeds, handled above -->
                        {{#rollBetween() rollResult 5 16}}

                            <!-- Check for failure, where roll is greater than effective skill -->
							{{#rollGreater() rollResult effectiveSkill}}
							<tr>
								<td class="label"><span data-i18n="roll-label">Roll:</span></td>
								<td>                            
                                <span class="failure">
                                    {{rollResult}}
                                    <span class="failure-text">
                                        
										<!-- if effective skill is 3 or less, critical failure is 13 or higher -->
										<!-- does not apply to ranged attacks -->
										{{^rangedAttack}}
                                        {{#rollLess() effectiveSkill 4}}
                                            {{#rollGreater() rollResult 12}}Critical{{/rollGreater() rollResult 12}}
                                        {{/rollLess() effectiveSkill 4}}
										{{/rangedAttack}}
										
										<!-- if effective skill is 4, critical failure is 14 or higher -->
										{{^rangedAttack}}
                                        {{#rollTotal() effectiveSkill 4}}
                                            {{#rollGreater() rollResult 13}}Critical{{/rollGreater() rollResult 13}}
                                        {{/rollTotal() effectiveSkill 4}}
										{{/rangedAttack}}
										
                                        <!-- if effective skill is 5, critical failure is 15 or higher -->
										{{^rangedAttack}}
										{{#rollTotal() effectiveSkill 5}}
                                            {{#rollGreater() rollResult 14}}Critical{{/rollGreater() rollResult 14}}
                                        {{/rollTotal() effectiveSkill 5}}
										{{/rangedAttack}}
										
										<!-- if effective skill is 6, critical failure is 16 or higher -->
										{{^rangedAttack}}
                                        {{#rollTotal() effectiveSkill 6}}
                                            {{#rollGreater() rollResult 15}}Critical{{/rollGreater() rollResult 15}}
                                        {{/rollTotal() effectiveSkill 6}}
                                        {{/rangedAttack}}
                                        
                                        <!-- if effective skill is 7 to 15, critical failure is 17 or 18 -->
                                        {{^rangedAttack}}
                                        {{#rollBetween() effectiveSkill 7 15}}
                                            {{#rollGreater() rollResult 16}}Critical{{/rollGreater() rollResult 16}}
                                        {{/rollBetween() effectiveSkill 7 15}}
                                        {{/rangedAttack}}
                                        
                                        <!-- NOTE: Roll of 18 check has already been made -->

                                        {{#showHitLabel}}Miss{{/showHitLabel}}
										{{#showSuccessLabel}}Failure{{/showSuccessLabel}}
										
                                    </span>
								</span>
								</td>
							</tr>

							{{#effectiveSkill}}
							<tr>
								<td class="label"><span data-i18n="target-label">Target</span>:</td>
								<td class="effective-skill">
									{{effectiveSkill}}

									{{#computed::rollDifference}}
								
										{{#rollGreater() computed::rollDifference -1}}
										<span data-i18n="roll-made-by-label">Roll made by</span>
										<span class="success">
											{{computed::rollDifference}}
										</span>
										{{/rollGreater() computed::rollDifference -1}}
										
										{{#rollLess() computed::rollDifference 0}}
										<span data-i18n="roll-missed-by-label">Roll missed by</span>
										<span class="failure">
											{{computed::rollDifference}}
										</span>
										{{/rollLess() computed::rollDifference 0}}
										<br />
									{{/computed::rollDifference}}

									<!--
									Need to figure out how to display with rollDifference
									{{#useFrightLabel}}
										<i>Fright Threshold</i>
									{{/useFrightLabel}}
									
									{{#isSkillRoll}}
										<i>(Effective Skill)</i>
									{{/isSkillRoll}}
									-->
									
									<!-- If defense roll, check for effective skill below 1 -->
									{{#rollTotal() activeDefense 1}}
										{{#rollLess() effectiveSkill 1}}
										<div style="color: red; margin-top: 6px;">
											<span data-i18n="rolltemplate-warning-less-than-one-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
										</div> 
										{{/rollLess() effectiveSkill 1}}
									{{/rollTotal() activeDefense 1}}
									
									<!-- For other rolls, check for effective skill below 3 -->
									{{#rollTotal() activeDefense 0}}
										{{#rollLess() effectiveSkill 3}}
										<div style="color: red; margin-top: 6px;">
											<span data-i18n="rolltemplate-warning-less-than-three-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
										</div> 
										{{/rollLess() effectiveSkill 3}}
									{{/rollTotal() activeDefense 0}}

								</td>
							</tr>
							{{/effectiveSkill}}
							
							<!-- check for number of hits -->
							{{#rollGreater() computed::hits 0}}
							<tr>
								<td class="label"><span data-i18n="hits-label">Hits</span>:</td>
								<td>
									<span class="effective-skill">{{computed::hits}}</span> round(s) hit
									{{#shotsFired}}
										out of {{shotsFired}} shot(s)
									{{/shotsFired}}
								</td>
							</tr>
							{{/rollGreater() computed::hits 0}}

							<tr>
								<td colspan="2">
									<!-- if ranged attack, show additional note about 10 or more not applied to ranged attacks -->
									{{#rangedAttack}}
									{{#rollLess() effectiveSkill 4}}
										{{#rollGreater() rollResult 12}}
											<div style="margin-top: 5px;">
												<span data-i18n="ranged-critical-miss-by-10-description">Critical miss by 10 or more doesn't apply to ranged weapons. See B382</span>
											</div>
										{{/rollGreater() rollResult 12}}
									{{/rollLess() effectiveSkill 4}}
									{{/rangedAttack}}
									
									{{#rangedAttack}}
									{{#rollTotal() effectiveSkill 4}}
										{{#rollGreater() rollResult 13}}
											<div style="margin-top: 5px;">
												<span data-i18n="ranged-critical-miss-by-10-description">Critical miss by 10 or more doesn't apply to ranged weapons. See B382</span>
											</div>
										{{/rollGreater() rollResult 13}}
									{{/rollTotal() effectiveSkill 4}}
									{{/rangedAttack}}
									
									{{#rangedAttack}}
									{{#rollTotal() effectiveSkill 5}}
										{{#rollGreater() rollResult 14}}
											<div style="margin-top: 5px;">
												<span data-i18n="ranged-critical-miss-by-10-description">Critical miss by 10 or more doesn't apply to ranged weapons. See B382</span>
											</div>
										{{/rollGreater() rollResult 14}}
									{{/rollTotal() effectiveSkill 5}}
									{{/rangedAttack}}
									
									{{#rangedAttack}}
									{{#rollTotal() effectiveSkill 6}}
										{{#rollGreater() rollResult 15}}
											<div style="margin-top: 5px;">
												<span data-i18n="ranged-critical-miss-by-10-description">Critical miss by 10 or more doesn't apply to ranged weapons. See B382</span>
											</div>
										{{/rollGreater() rollResult 15}}
									{{/rollTotal() effectiveSkill 6}}
									{{/rangedAttack}}
									
									{{#rangedAttack}}
									{{#rollBetween() effectiveSkill 7 15}}
										{{#rollGreater() rollResult 16}}
											<div style="margin-top: 5px;">
												<span data-i18n="ranged-critical-miss-by-10-description">Critical miss by 10 or more doesn't apply to ranged weapons. See B382</span>
											</div>
										{{/rollGreater() rollResult 16}}
									{{/rollBetween() effectiveSkill 7 15}}
									{{/rangedAttack}}
                                  
                                    <!-- additional critical failure text -->
                                    <!-- if effective skill is 3 or less, critical failure is 13 or higher -->
                                    {{#rollLess() effectiveSkill 4}}
                                        
                                        <!-- normal failure -->
                                        {{#rollLess() rollResult 13}}
                                        
                                            <!-- block custom fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
                                    		{{#rawFailNote}}
                                                <div>{{rawFailNote}}</div>
											{{/rawFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customFailNote}}
                                                <div>{{customFailNote}}</div>
                                            {{/customFailNote}}
                                            
                                        {{/rollLess() rollResult 13}}
                                        
                                        <!-- critical failure -->
                                        {{#rollGreater() rollResult 12}}
                                        
                                            <!-- dodge critical failure -->
                                            {{#rollTotal() defenseType 1}}
                                                <div>Lose your footing and fall prone. (B382)</div>
                                            {{/rollTotal() defenseType 1}}
                                        
                                            <!-- parry critical failure -->
                                            {{#rollTotal() defenseType 2}}
                                                <div>Roll on the appropriate Critical Miss Table B556. (B382). Apply the result immediately.</div>
                                            {{/rollTotal() defenseType 2}}
                                            
                                            <!-- block critical failure -->
                                            {{#rollTotal() defenseType 3}}
                                                <div>You lose your grip on whatever you were Blocking with and must take a turn to ready it before you can use it to block again. (B382)</div>
                                            {{/rollTotal() defenseType 3}}
                                            
                                            <!-- raw & custom critical fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
											{{#rawCriticalFailNote}}
											
											<!-- if not using malfunction, just display note as is-->
											{{^useMalfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/useMalfunction}}

											<!-- if using malfunction check for malfunction -->
											{{#rollTotal() useMalfunction 1}}
											
											<!-- If there's no malfuction #, then display note -->
											{{^malfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/malfunction}}
											
											<!-- if there is a malfunction and it's value is 0, then display the note -->
											{{#malfunction}}
											{{#rollTotal() malfunction 0}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/rollTotal() malfunction 0}}
											{{/malfunction}}
											
											{{/rollTotal() useMalfunction 1}}
											
											{{/rawCriticalFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customCriticalFailNote}}
                                                <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                            {{/customCriticalFailNote}}

											{{#rollTotal() isRepeatingSkill 1}}
											{{^customCriticalFailNote}}
												<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
											{{/customCriticalFailNote}}
											{{/rollTotal() isRepeatingSkill 1}}
                                            
                                        {{/rollGreater() rollResult 12}}
                                        
                                    {{/rollLess() effectiveSkill 4}}
                                    
                                    <!-- if effective skill is 4, critical failure is 14 or higher -->
                                    {{#rollTotal() effectiveSkill 4}}
                                        
                                        <!-- normal failure -->
                                        {{#rollLess() rollResult 15}}
                                        
                                            <!-- block custom fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
                                    		{{#rawFailNote}}
                                                <div>{{rawFailNote}}</div>
                                            {{/rawFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customFailNote}}
                                                <div>{{customFailNote}}</div>
                                            {{/customFailNote}}
                                            
                                        {{/rollLess() rollResult 15}}
                                        
                                        <!-- critical failure -->
                                        {{#rollGreater() rollResult 13}}
                                        
                                            <!-- dodge critical failure -->
                                            {{#rollTotal() defenseType 1}}
                                                <div>Lose your footing and fall prone. (B382)</div>
                                            {{/rollTotal() defenseType 1}}
                                        
                                            <!-- parry critical failure -->
                                            {{#rollTotal() defenseType 2}}
                                                <div>Roll on the appropriate Critical Miss Table B556. (B382). Apply the result immediately.</div>
                                            {{/rollTotal() defenseType 2}}
                                            
                                            <!-- block critical failure -->
                                            {{#rollTotal() defenseType 3}}
                                                <div>You lose your grip on whatever you were Blocking with and must take a turn to ready it before you can use it to block again. (B382)</div>
                                            {{/rollTotal() defenseType 3}}
                                            
                                            <!-- raw & custom critical fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
											{{#rawCriticalFailNote}}
											
											<!-- if not using malfunction, just display note as is-->
											{{^useMalfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/useMalfunction}}

											<!-- if using malfunction check for malfunction -->
											{{#rollTotal() useMalfunction 1}}
											
											<!-- If there's no malfuction #, then display note -->
											{{^malfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/malfunction}}
											
											<!-- if there is a malfunction and it's value is 0, then display the note -->
											{{#malfunction}}
											{{#rollTotal() malfunction 0}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/rollTotal() malfunction 0}}
											{{/malfunction}}
											
											{{/rollTotal() useMalfunction 1}}
											
											{{/rawCriticalFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customCriticalFailNote}}
                                                <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                            {{/customCriticalFailNote}}

											{{#rollTotal() isRepeatingSkill 1}}
											{{^customCriticalFailNote}}
												<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
											{{/customCriticalFailNote}}
											{{/rollTotal() isRepeatingSkill 1}}
                                            
                                        {{/rollGreater() rollResult 13}}
                                        
                                    {{/rollTotal() effectiveSkill 4}}
                                    
                                    <!-- if effective skill is 5, critical failure is 15 or higher -->
                                    {{#rollTotal() effectiveSkill 5}}
                                        
                                        <!-- normal failure -->
                                        {{#rollLess() rollResult 15}}
                                        
                                            <!-- block custom fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
                                    		{{#rawFailNote}}
                                                <div>{{rawFailNote}}</div>
                                            {{/rawFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customFailNote}}
                                                <div>{{customFailNote}}</div>
                                            {{/customFailNote}}
                                            
                                        {{/rollLess() rollResult 15}}
                                        
                                        <!-- critical failure -->
                                        {{#rollGreater() rollResult 14}}
                                        
                                            <!-- dodge critical failure -->
                                            {{#rollTotal() defenseType 1}}
                                                <div>Lose your footing and fall prone. (B382)</div>
                                            {{/rollTotal() defenseType 1}}
                                        
                                            <!-- parry critical failure -->
                                            {{#rollTotal() defenseType 2}}
                                                <div>Roll on the appropriate Critical Miss Table B556. (B382). Apply the result immediately.</div>
                                            {{/rollTotal() defenseType 2}}
                                            
                                            <!-- block critical failure -->
                                            {{#rollTotal() defenseType 3}}
                                                <div>You lose your grip on whatever you were Blocking with and must take a turn to ready it before you can use it to block again. (B382)</div>
                                            {{/rollTotal() defenseType 3}}
                                            
                                            <!-- raw & custom critical fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
											{{#rawCriticalFailNote}}
											
											<!-- if not using malfunction, just display note as is-->
											{{^useMalfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/useMalfunction}}

											<!-- if using malfunction check for malfunction -->
											{{#rollTotal() useMalfunction 1}}
											
											<!-- If there's no malfuction #, then display note -->
											{{^malfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/malfunction}}
											
											<!-- if there is a malfunction and it's value is 0, then display the note -->
											{{#malfunction}}
											{{#rollTotal() malfunction 0}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/rollTotal() malfunction 0}}
											{{/malfunction}}
											
											{{/rollTotal() useMalfunction 1}}
											
											{{/rawCriticalFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customCriticalFailNote}}
                                                <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                            {{/customCriticalFailNote}}

											{{#rollTotal() isRepeatingSkill 1}}
											{{^customCriticalFailNote}}
												<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
											{{/customCriticalFailNote}}
											{{/rollTotal() isRepeatingSkill 1}}
                                            
                                        {{/rollGreater() rollResult 14}}
                                        
                                    {{/rollTotal() effectiveSkill 5}}
                                    
                                    <!-- if effective skill is 6, critical failure is 16 or higher -->
                                    {{#rollTotal() effectiveSkill 6}}
                                        
                                        <!-- normal failure -->
                                        {{#rollLess() rollResult 16}}
                                        
                                            <!-- block custom fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
                                    		{{#rawFailNote}}
                                                <div>{{rawFailNote}}</div>
                                            {{/rawFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customFailNote}}
                                                <div>{{customFailNote}}</div>
                                            {{/customFailNote}}
                                            
                                        {{/rollLess() rollResult 16}}
                                        
                                        <!-- critical failure -->
                                        {{#rollGreater() rollResult 15}}
                                        
                                            <!-- dodge critical failure -->
                                            {{#rollTotal() defenseType 1}}
                                                <div>Lose your footing and fall prone. (B382)</div>
                                            {{/rollTotal() defenseType 1}}
                                            
                                            <!-- parry critical failure -->
                                            {{#rollTotal() defenseType 2}}
                                                <div>Roll on the appropriate Critical Miss Table B556. (B382). Apply the result immediately.</div>
                                            {{/rollTotal() defenseType 2}}
                                            
                                            <!-- block critical failure -->
                                            {{#rollTotal() defenseType 3}}
                                                <div>You lose your grip on whatever you were Blocking with and must take a turn to ready it before you can use it to block again. (B382)</div>
                                            {{/rollTotal() defenseType 3}}
                                            
                                            <!-- raw & custom critical fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
											{{#rawCriticalFailNote}}
											
											<!-- if not using malfunction, just display note as is-->
											{{^useMalfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/useMalfunction}}

											<!-- if using malfunction check for malfunction -->
											{{#rollTotal() useMalfunction 1}}
											
											<!-- If there's no malfuction #, then display note -->
											{{^malfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/malfunction}}
											
											<!-- if there is a malfunction and it's value is 0, then display the note -->
											{{#malfunction}}
											{{#rollTotal() malfunction 0}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/rollTotal() malfunction 0}}
											{{/malfunction}}
											
											{{/rollTotal() useMalfunction 1}}
											
											{{/rawCriticalFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customCriticalFailNote}}
                                                <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                            {{/customCriticalFailNote}}

											{{#rollTotal() isRepeatingSkill 1}}
											{{^customCriticalFailNote}}
												<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
											{{/customCriticalFailNote}}
											{{/rollTotal() isRepeatingSkill 1}}
                                            
                                        {{/rollGreater() rollResult 15}}
                                        
                                    {{/rollTotal() effectiveSkill 6}}
                                    
                                    <!-- if effective skill is 7 to 15, critical failure is 17 or 18 -->
                                    {{#rollBetween() effectiveSkill 7 15}}
                                        
                                        <!-- normal failure -->
                                        {{#rollLess() rollResult 17}}
                                        
                                            <!-- block custom fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
                                    		{{#rawFailNote}}
                                                <div>{{rawFailNote}}</div>
                                            {{/rawFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customFailNote}}
                                                <div>{{customFailNote}}</div>
                                            {{/customFailNote}}
                                            
                                        {{/rollLess() rollResult 17}}
                                        
                                        <!-- critical failure -->
                                        {{#rollGreater() rollResult 16}}
                                        
                                            <!-- dodge critical failure -->
                                            {{#rollTotal() defenseType 1}}
                                                <div>Lose your footing and fall prone. (B382)</div>
                                            {{/rollTotal() defenseType 1}}
                                            
                                            <!-- parry critical failure -->
                                            {{#rollTotal() defenseType 2}}
                                                <div>Roll on the appropriate Critical Miss Table B556. (B382). Apply the result immediately.</div>
                                            {{/rollTotal() defenseType 2}}
                                            
                                            <!-- block critical failure -->
                                            {{#rollTotal() defenseType 3}}
                                                <div>You lose your grip on whatever you were Blocking with and must take a turn to ready it before you can use it to block again. (B382)</div>
                                            {{/rollTotal() defenseType 3}}
                                            
                                            <!-- raw & custom critical fail note -->
                                            {{#rollTotal() showRawDefenseNotes 1}}
											{{#rawCriticalFailNote}}
											
											<!-- if not using malfunction, just display note as is-->
											{{^useMalfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/useMalfunction}}

											<!-- if using malfunction check for malfunction -->
											{{#rollTotal() useMalfunction 1}}
											
											<!-- If there's no malfuction #, then display note -->
											{{^malfunction}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/malfunction}}
											
											<!-- if there is a malfunction and it's value is 0, then display the note -->
											{{#malfunction}}
											{{#rollTotal() malfunction 0}}
												<div><span class="failure-note-label"></span> {{rawCriticalFailNote}}</div>
											{{/rollTotal() malfunction 0}}
											{{/malfunction}}
											
											{{/rollTotal() useMalfunction 1}}
											
											{{/rawCriticalFailNote}}
											{{/rollTotal() showRawDefenseNotes 1}}
                                    
											{{#customCriticalFailNote}}
                                                <div><span class="failure-note-label"></span> {{customCriticalFailNote}}</div>
                                            {{/customCriticalFailNote}}

											{{#rollTotal() isRepeatingSkill 1}}
											{{^customCriticalFailNote}}
												<div><span data-i18n="default-repeating-skill-crit-fail-message">The GM may determine what happens to You. (B348)</span></div>
											{{/customCriticalFailNote}}
											{{/rollTotal() isRepeatingSkill 1}}
                                            
                                        {{/rollGreater() rollResult 16}}
                                        
                                    {{/rollBetween() effectiveSkill 7 15}}
                                
								</td>
							</tr>
                            {{/rollGreater() rollResult effectiveSkill}}

                            <!-- check for success, roll from 5 to effective skill -->
                            <!-- NOTE: roll 3 or 4 has already been handled -->
                            {{#rollBetween() rollResult 5 effectiveSkill}}
							<tr>
								<td class="label"><span data-i18n="roll-label">Roll:</span></td>
								<td>
									<span class="success">
										{{rollResult}}
										<span class="success-text">
											
											<!-- Check if Critical Success was turned on -->
											<!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
											{{#rollLess() useCriticalPlusTen 2}}
											
												<!-- If rules as written -->
												{{#rollTotal() useCriticalPlusTen 1}}
												
													<!-- if effective skill is 16 or higher, check for critical success on a 6 -->
													{{#rollGreater() effectiveSkill 15}}
														{{#rollTotal() rollResult 6}}Critical{{/rollTotal() rollResult 6}}
														{{#rollTotal() rollResult 5}}Critical{{/rollTotal() rollResult 5}}
													{{/rollGreater() effectiveSkill 15}}

													<!-- If rules as written and if effectiveSkill is 15, check for critical success on a 5 -->
													{{#rollTotal() effectiveSkill 15}}
														{{#rollTotal() rollResult 5}}Critical{{/rollTotal() rollResult 5}}
													{{/rollTotal() effectiveSkill 15}}

												{{/rollTotal() useCriticalPlusTen 1}}

											{{/rollLess() useCriticalPlusTen 2}}
											
											{{#showHitLabel}}Hit{{/showHitLabel}}
											{{#showSuccessLabel}}Success{{/showSuccessLabel}}
										</span>
									</span>
								</td>
							</tr>
							{{#effectiveSkill}}
							<tr>
								<td class="label"><span data-i18n="target-label">Target</span>:</td>
								<td class="effective-skill">
									{{effectiveSkill}}

									{{#computed::rollDifference}}
								
										{{#rollGreater() computed::rollDifference -1}}
										<span data-i18n="roll-made-by-label">Roll made by</span>
										<span class="success">
											{{computed::rollDifference}}
										</span>
										{{/rollGreater() computed::rollDifference -1}}
										
										{{#rollLess() computed::rollDifference 0}}
										<span data-i18n="roll-missed-by-label">Roll missed by</span>
										<span class="failure">
											{{computed::rollDifference}}
										</span>
										{{/rollLess() computed::rollDifference 0}}
										<br />
									{{/computed::rollDifference}}

									<!--
									Need to figure out how to display with rollDifference
									{{#useFrightLabel}}
										<i>Fright Threshold</i>
									{{/useFrightLabel}}
									
									{{#isSkillRoll}}
										<i>(Effective Skill)</i>
									{{/isSkillRoll}}
									-->
									
									<!-- If defense roll, check for effective skill below 1 -->
									{{#rollTotal() activeDefense 1}}
										{{#rollLess() effectiveSkill 1}}
										<div style="color: red; margin-top: 6px;">
											<span data-i18n="rolltemplate-warning-less-than-one-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
										</div> 
										{{/rollLess() effectiveSkill 1}}
									{{/rollTotal() activeDefense 1}}
									
									<!-- For other rolls, check for effective skill below 3 -->
									{{#rollTotal() activeDefense 0}}
										{{#rollLess() effectiveSkill 3}}
										<div style="color: red; margin-top: 6px;">
											<span data-i18n="rolltemplate-warning-less-than-three-description"><b>WARNING:</b> You may not attempt a success roll if your effective skill (Target) is less than 3. (See B345)</span>
										</div> 
										{{/rollLess() effectiveSkill 3}}
									{{/rollTotal() activeDefense 0}}
									
								</td>
							</tr>
							{{/effectiveSkill}}

							<!-- check for number of hits -->
							{{#rollGreater() computed::hits 0}}
							<tr>
								<td class="label"><span data-i18n="hits-label">Hits</span>:</td>
								<td>
									<span class="effective-skill">{{computed::hits}}</span> round(s) hit
									{{#shotsFired}}
										out of {{shotsFired}} shot(s)
									{{/shotsFired}}
								</td>
							</tr>
							{{/rollGreater() computed::hits 0}}
							
							<tr>
								<td colspan="2">
                                    <!-- check if critical success is off -->
                                    <!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
                                    {{#rollTotal() useCriticalPlusTen 2}}
                                        <!-- block custom success note -->
                                        {{#rollTotal() showRawDefenseNotes 1}}
                                    	{{#rawSuccessNote}}
                                            <div>{{rawSuccessNote}}</div>
										{{/rawSuccessNote}}
										{{/rollTotal() showRawDefenseNotes 1}}
                                    
										{{#customSuccessNote}}
                                            <div>{{customSuccessNote}}</div>
                                        {{/customSuccessNote}}
                                    {{/rollTotal() useCriticalPlusTen 2}}
                                    
                                    <!-- Check if Critical Success was turned on -->
                                    <!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
                                    <!-- show additional notes -->
                                    {{#rollLess() useCriticalPlusTen 2}}
                                    
                                        <!-- If rules as written -->
                                        {{#rollTotal() useCriticalPlusTen 1}}
                                        
                                            <!-- if effective skill is less than 15, then show success note -->
                                            {{#rollLess() effectiveSkill 15}}
                                                <!-- block custom success note -->
                                                {{#rollTotal() showRawDefenseNotes 1}}
                                    			{{#rawSuccessNote}}
                                                    <div>{{rawSuccessNote}}</div>
												{{/rawSuccessNote}}
												{{/rollTotal() showRawDefenseNotes 1}}
                                    
												{{#customSuccessNote}}
                                                    <div>{{customSuccessNote}}</div>
                                                {{/customSuccessNote}}
                                            {{/rollLess() effectiveSkill 15}}
                                            
                                            <!-- if effective skill is 16 or higher, check for critical success on a 6 -->
                                            {{#rollGreater() effectiveSkill 15}}
                                                
                                                <!-- normal success -->
                                                {{#rollGreater() rollResult 6}}
                                                
                                                    <!-- block custom success note -->
                                                    {{#rollTotal() showRawDefenseNotes 1}}
                                    				{{#rawSuccessNote}}
                                                        <div>{{rawSuccessNote}}</div>
                                                    {{/rawSuccessNote}}
													{{/rollTotal() showRawDefenseNotes 1}}
                                    
													{{#customSuccessNote}}
                                                        <div>{{customSuccessNote}}</div>
                                                    {{/customSuccessNote}}
                                                    
                                                {{/rollGreater() rollResult 6}}
                                                
                                                <!-- critical success -->
                                                {{#rollBetween() rollResult 5 6}}
                                                
                                                    <!-- block custom critical success note -->
                                                    {{#rollTotal() showRawDefenseNotes 1}}
                                    				{{#rawCriticalSuccessNote}}
                                                        <div>{{rawCriticalSuccessNote}}</div>
                                                    {{/rawCriticalSuccessNote}}
													{{/rollTotal() showRawDefenseNotes 1}}
                                    
													{{#customCriticalSuccessNote}}
                                                        <div>{{customCriticalSuccessNote}}</div>
                                                    {{/customCriticalSuccessNote}}
                                                    
													{{#rollTotal() isRepeatingSkill 1}}
													{{^customCriticalSuccessNote}}
														<div><span data-i18n="default-repeating-skill-crit-success-message">The GM may determine what happens to You. (B347)</span></div>
													{{/customCriticalSuccessNote}}
													{{/rollTotal() isRepeatingSkill 1}}
													
                                                {{/rollBetween() rollResult 5 6}}
                                                
                                            {{/rollGreater() effectiveSkill 15}}

                                            <!-- If rules as written and if effectiveSkill is 15, check for critical success on a 5 -->
                                            {{#rollTotal() effectiveSkill 15}}
                                            
                                                <!-- normal success -->
                                                {{#rollGreater() rollResult 5}}
                                                
                                                    <!-- block custom success note -->
                                                    {{#rollTotal() showRawDefenseNotes 1}}
                                    				{{#rawSuccessNote}}
                                                        <div>{{rawSuccessNote}}</div>
													{{/rawSuccessNote}}
													{{/rollTotal() showRawDefenseNotes 1}}
                                    
													{{#customSuccessNote}}
                                                        <div>{{customSuccessNote}}</div>
                                                    {{/customSuccessNote}}
                                                    
                                                {{/rollGreater() rollResult 5}}
                                                
                                                <!-- critical success -->
                                                {{#rollTotal() rollResult 5}}
                                                    
                                                    <!-- block custom critical success note -->
                                                    {{#rollTotal() showRawDefenseNotes 1}}
                                    				{{#rawCriticalSuccessNote}}
                                                        <div>{{rawCriticalSuccessNote}}</div>
                                                    {{/rawCriticalSuccessNote}}
													{{/rollTotal() showRawDefenseNotes 1}}
                                    
													{{#customCriticalSuccessNote}}
                                                        <div>{{customCriticalSuccessNote}}</div>
                                                    {{/customCriticalSuccessNote}}

													{{#rollTotal() isRepeatingSkill 1}}
														{{^customCriticalSuccessNote}}
															<div><span data-i18n="default-repeating-skill-crit-success-message">The GM may determine what happens to You. (B347)</span></div>
														{{/customCriticalSuccessNote}}
													{{/rollTotal() isRepeatingSkill 1}}
                                                    
                                                {{/rollTotal() rollResult 5}}
                                            
                                            {{/rollTotal() effectiveSkill 15}}

                                        {{/rollTotal() useCriticalPlusTen 1}}

                                    {{/rollLess() useCriticalPlusTen 2}}
                                    
                                </span>                            
                            {{/rollBetween() rollResult 5 effectiveSkill}}

                        {{/rollBetween() rollResult 5 16}}
                        
                    </td>
                </tr>
                {{/rollResult}}

				<!-- NOTE: Need to replicate the complicated success/fail checks to display spell notes. -->
                {{#rollResult}}
                {{#spellRoll}}
                
                        <!-- WARNING THIS IS GOING TO GET UGLY AND HARD TO FOLLOW -->
                        
                        <!-- NOTE: Regardless of the score you are rolling against, -->
                        <!-- a roll of 3 or 4 is always a success, while a roll of 17 or 18 is always a failure. -->
                        
                        <!-- Roll of 18 is always critical failure -->
                        {{#rollTotal() rollResult 18}}
						<tr class="rollResult">
							<td colspan="2">
                            {{spellCriticalFailureNote}}
							</td>
						</tr>
                        {{/rollTotal() rollResult 18}}
                        
                        <!-- Roll of 17 is always a failure -->
                        {{#rollTotal() rollResult 17}}
                        
                            <!-- skill of 15 or less is critical -->
                            {{#rollLess() effectiveSkill 16}}
							<tr class="rollResult">
								<td colspan="2">							
                                {{spellCriticalFailureNote}}
								</td>
							</tr>
                            {{/rollLess() effectiveSkill 16}}
                               
                             <!-- skill of 16 or higher is normal failure, add helper text -->
                            {{#rollGreater() effectiveSkill 15}}
							<tr class="rollResult">
								<td colspan="2">
                                {{spellFailNote}}
								</td>
							</tr>
                            {{/rollGreater() effectiveSkill 15}}
                            
                        {{/rollTotal() rollResult 17}}
                        
                        <!-- A roll of 3 or 4 always succeeds -->
                        {{#rollBetween() rollResult 3 4}}
                        
                            <!-- if critical success is turned on, show text -->
                            {{#rollLess() useCriticalPlusTen 2}}
							<tr class="rollResult">
								<td colspan="2">
								{{spellCriticalSuccessNote}}
								</td>
							</tr>
                            {{/rollLess() useCriticalPlusTen 2}}
                                
                            <!-- normal success area -->
                            {{#rollTotal() useCriticalPlusTen 2}}
                                <!-- block custom success note -->
                            {{/rollTotal() useCriticalPlusTen 2}}
                                
                        {{/rollBetween() rollResult 3 4}}
                        
                        <!-- Roll from 5 to 16 means we have a chance at hit or miss -->
                        <!-- NOTE: A roll of 3 or 4 always succeeds, handled above -->
                        {{#rollBetween() rollResult 5 16}}

                            <!-- Check for failure, where roll is greater than effective skill -->
                            {{#rollGreater() rollResult effectiveSkill}}
                            
                                <!-- if effective skill is 3 or less, critical failure is 13 or higher -->
                                {{#rollLess() effectiveSkill 4}}
                                    {{#rollGreater() rollResult 12}}
									<tr class="rollResult">
										<td colspan="2">
                                        {{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 12}}
                                {{/rollLess() effectiveSkill 4}}
                                
                                 <!-- NOTE: Roll of 18 check has already been made -->
                                  
                                <!-- additional critical failure text -->
                                <!-- if effective skill is 3 or less, critical failure is 13 or higher -->
                                {{#rollLess() effectiveSkill 4}}
                                    
                                    <!-- normal failure -->
									{{#rollLess() rollResult 13}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellFailNote}}
										</td>
									</tr>
                                    {{/rollLess() rollResult 13}}
                                    
                                    <!-- critical failure -->
                                    {{#rollGreater() rollResult 12}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 12}}
                                    
                                {{/rollLess() effectiveSkill 4}}
                                
                                <!-- if effective skill is 4, critical failure is 14 or higher -->
                                {{#rollTotal() effectiveSkill 4}}
                                    
                                    <!-- normal failure -->
                                    {{#rollLess() rollResult 14}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellFailNote}}
										</td>
									</tr>
                                    {{/rollLess() rollResult 14}}
                                    
                                    <!-- critical failure -->
                                    {{#rollGreater() rollResult 13}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 13}}
                                    
                                {{/rollTotal() effectiveSkill 4}}
                                
                                <!-- if effective skill is 5, critical failure is 15 or higher -->
                                {{#rollTotal() effectiveSkill 5}}
                                    
                                    <!-- normal failure -->
                                    {{#rollLess() rollResult 15}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellFailNote}}
										</td>
									</tr>
                                    {{/rollLess() rollResult 15}}
                                    
                                    <!-- critical failure -->
                                    {{#rollGreater() rollResult 14}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 14}}
                                    
                                {{/rollTotal() effectiveSkill 5}}
                                
                                <!-- if effective skill is 6, critical failure is 16 or higher -->
                                {{#rollTotal() effectiveSkill 6}}
                                    
                                    <!-- normal failure -->
                                    {{#rollLess() rollResult 16}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellFailNote}}
										</td>
									</tr>
                                    {{/rollLess() rollResult 16}}
                                    
                                    <!-- critical failure -->
                                    {{#rollGreater() rollResult 15}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 15}}
                                    
                                {{/rollTotal() effectiveSkill 6}}
                                
                                <!-- if effective skill is 7 to 15, critical failure is 17 or 18 -->
                                {{#rollBetween() effectiveSkill 7 15}}
                                    
                                    <!-- normal failure -->
                                    {{#rollLess() rollResult 17}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellFailNote}}
										</td>
									</tr>
                                    {{/rollLess() rollResult 17}}
                                    
                                    <!-- critical failure -->
                                    {{#rollGreater() rollResult 16}}
									<tr class="rollResult">
										<td colspan="2">
										{{spellCriticalFailureNote}}
										</td>
									</tr>
                                    {{/rollGreater() rollResult 16}}
                                    
                                {{/rollBetween() effectiveSkill 7 15}}
                                
                            {{/rollGreater() rollResult effectiveSkill}}

                            <!-- check for success, roll from 5 to effective skill -->
                            <!-- NOTE: roll 3 or 4 has already been handled -->
                            {{#rollBetween() rollResult 5 effectiveSkill}}

                                <!-- Check if Critical Success was turned on -->
                                <!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
                                <!-- NOTE: 3 or 4 has already been handled at the beginning -->
                                {{#rollLess() useCriticalPlusTen 2}}
                                
                                    <!-- If rules as written -->
                                    {{#rollTotal() useCriticalPlusTen 1}}
                                    
                                        <!-- normal success -->
                                        {{#rollGreater() rollResult 6}}
                                            <!-- block custom success note -->
                                        {{/rollGreater() rollResult 6}}
                                            
                                        <!-- if effective skill is 16 or higher, check for critical success on a 5 or 6 -->
                                        {{#rollGreater() effectiveSkill 15}}
                                            {{#rollBetween() rollResult 5 6}}
											<tr class="rollResult">
												<td colspan="2">
												{{spellCriticalSuccessNote}}
												</td>
											</tr>
                                            {{/rollBetween() rollResult 5 6}}
                                        {{/rollGreater() effectiveSkill 15}}

                                        <!-- If rules as written and if effectiveSkill is 15, check for critical success on a 5 -->
                                        {{#rollTotal() effectiveSkill 15}}
                                            {{#rollTotal() rollResult 5}}
											<tr class="rollResult">
												<td colspan="2">
												{{spellCriticalSuccessNote}}
												</td>
											</tr>
                                            {{/rollTotal() rollResult 5}}
                                        {{/rollTotal() effectiveSkill 15}}

                                    {{/rollTotal() useCriticalPlusTen 1}}

                                {{/rollLess() useCriticalPlusTen 2}}
                                
                                <!-- check if critical success is off -->
                                <!-- attr_use_critical_plus_10: 0 = only on 3 or 4, 1 = rules as written, 2 = turn off -->
                                {{#rollTotal() useCriticalPlusTen 2}}
                                    <!-- block custom success note -->
                                {{/rollTotal() useCriticalPlusTen 2}}
                                                          
                            {{/rollBetween() rollResult 5 effectiveSkill}}

                        {{/rollBetween() rollResult 5 16}}
                    
                    </td>
                </tr>
                {{/spellRoll}}
                {{/rollResult}}

				<!-- Hard-coded defense roll modifiers -->
				{{#rollTotal() showDodgeNotes 1}}

					<tr>
						<td colspan="2" class="tool-modifier-title">
							<span data-i18n="defense-modifiers-label">Predefined Defense Modifiers</span>
						</td>
					</tr>

					<tr>
						<td colspan="2">
							<div>{{dodgeEncumbrancePenalty}} <span data-i18n="encumbrance-label">Encumbrance</span></div>

							{{#rollTotal() dodgeReducedNotes 1}}
							<div>
								<span data-i18n="half-dodge-tooltip">Dodge is halved due to hit points or fatigue loss. See B418 or B426.</span>
							</div>
							{{/rollTotal() dodgeReducedNotes 1}}

							{{#rollTotal() dodgeReducedNotes 2}}
							<div>
								<span data-i18n="quarter-dodge-tooltip">Dodge is quartered due to hit points and fatigue loss. See B418 or B426.</span>						
							</div>
							{{/rollTotal() dodgeReducedNotes 2}}
							
						</td>
					</tr>
					
				{{/rollTotal() showDodgeNotes 1}}

				{{#popupModifier}}
				<tr>
					<td class="label"><span data-i18n="my-modifier-label">My Mod</span>:</td>
					<td class="effective-skill">
						{{popupModifier}}
						<i>(<span data-i18n="my-modifier-tooltip">Value entered in pop-up box.</span>)</i>
					</td>
				</tr>
				{{/popupModifier}}

				<!-- parrying weapon breakage -->
				{{#parryingWeaponWeight}}
				<tr>
					<td colspan="2">
						<span data-i18n="weapon-weight-label">Weapon Weight</span>: {{weaponWeight}}<br />
						If parrying weapon is {{parryingWeaponWeight}} {{weightSystem}} or less, check for breakage. B376.
					</td>
				</tr>
				{{/parryingWeaponWeight}}

				<!-- quick modifiers -->
				{{#rollTotal() quickModShow 1}}
				<tr>
					<td colspan="2" class="tool-modifier-title">
						<span data-i18n="quick-modifiers-label">Quick Modifiers</span>
					</td>
				</tr>
				<tr>
                    <td class="label"><span data-i18n="modifier-label">Modifier:</span></td>
                    <td class="effective-skill">
						{{quickModTotal}}
					</td>
				</tr>
				<tr>
                    <td class="label"><span data-i18n="summary-label">Summary</span>:</td>
                    <td class="effective-skill">
						{{quickModSummary}}
					</td>
				</tr>
				{{/rollTotal() quickModShow 1}}
				
				<!-- Roll Modifier Tool Sections -->
				{{#rollTotal() useModTool 1}}
				
				<tr>
					<td colspan="2" class="tool-modifier-title">
						<span data-i18n="rolltemplate-tool-modifiers-label">Tool Modifiers</span>
					</td>
				</tr>

				<tr>
                    <td class="label"><span data-i18n="modifier-label">Modifier:</span></td>
                    <td class="effective-skill">
						{{rollModifier}}
						<i>(<span data-i18n="roll-modifier-tooltip">Total modifier from roll modifier tools and range calculator.</span>)</i>
					</td>
				</tr>
				
				{{#maneuver}}
				<tr>
					<td class="label"><span data-i18n="maneuver-label">Maneuver</span>:</td>
					<td>{{maneuver}}</td>
				</tr>
				{{/maneuver}}
				
				{{#allOutAttack}}
				<tr>
					<td class="label"><span data-i18n="all-out-attack-label">All-Out Attack</span>:</td>
					<td>{{allOutAttack}}</td>
				</tr>
				{{/allOutAttack}}
				
				{{#hitLocation}}
				<tr>
					<td class="label"><span data-i18n="hit-location-label">Hit Location</span>:</td>
					<td>{{hitLocation}}</td>
				</tr>
				{{/hitLocation}}
				
				{{#rollTotal() maxNine 1}}
				<tr>
					<td class="label alert-notice">
						<span data-i18n="alert-label">Alert</span>:
					</td>
					<td>
						<span data-i18n="rolltemplate-max-9-description">Max effective skill is <b>9</b></span>
					</td>
				</tr>
				{{/rollTotal() maxNine 1}}

				{{#rollTotal() showCustomMacroOne 1}}
					{{#customMacroOne}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroOne}}
							</div>
						</td>
					</tr>
					{{/customMacroOne}}
				{{/rollTotal() showCustomMacroOne 1}}

				{{#rollTotal() showCustomMacroTwo 1}}
					{{#customMacroTwo}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroTwo}}
							</div>
						</td>
					</tr>
					{{/customMacroTwo}}
				{{/rollTotal() showCustomMacroTwo 1}}

				{{#rollTotal() showCustomMacroThree 1}}
					{{#customMacroThree}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroThree}}
							</div>
						</td>
					</tr>
					{{/customMacroThree}}
				{{/rollTotal() showCustomMacroThree 1}}

				{{#rollTotal() showCustomMacroFour 1}}
					{{#customMacroFour}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroFour}}
							</div>
						</td>
					</tr>
					{{/customMacroFour}}
				{{/rollTotal() showCustomMacroFour 1}}

				{{#rollTotal() showCustomMacroFive 1}}
					{{#customMacroFive}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroFive}}
							</div>
						</td>
					</tr>
					{{/customMacroFive}}
				{{/rollTotal() showCustomMacroFive 1}}

				{{#rollTotal() showCustomMacroSix 1}}
					{{#customMacroSix}}
					<tr>
						<td colspan="2">
							<div>
								{{customMacroSix}}
							</div>
						</td>
					</tr>
					{{/customMacroSix}}
				{{/rollTotal() showCustomMacroSix 1}}

				{{#rollTotal() displayRollModifierSummary 1}}
					
					{{#rollTraitSummary}}
					<tr>
						<td colspan="2">
							<div style="font-weight: bold;">
								<span data-i18n="traits-label">Traits</span>:
							</div>
							<div>
								{{rollTraitSummary}}
							</div>
						</td>
					</tr>
					{{/rollTraitSummary}}

					{{#rollModifierSummary}}
					<tr>
						<td colspan="2">
							<div style="font-weight: bold;">
								<span data-i18n="roll-modifier-summary-label">Modifier Summary</span>:
							</div>
							<div>
								{{rollModifierSummary}}
							</div>
						</td>
					</tr>
					{{/rollModifierSummary}}
				{{/rollTotal() displayRollModifierSummary 1}}
				
				{{/rollTotal() useModTool 1}}
				
                {{#rollTotal() useMalfunction 1}}
					{{#malfunction}}
						{{#rollGreater() malfunction 0}}
							{{#rollBetween() rollResult malfunction 18}}
							<tr class="malfunction">
								<tr>
									<td colspan="2" class="tool-modifier-title highlight-red">
										<span data-i18n="rolltemplate-malfunction-label">Malfunction!</span>
									</td>
								</tr>
								<td colspan="2">
									{{#rollTotal() verifyMalfunction 1}}
										<span data-i18n="rolltemplate-verify-malfunction-description">
											<span style="color: red; font-weight:bold;">Verify:</span> roll 3d6 again to verify the results. (HT79)<br />
										</span>
									{{/rollTotal() verifyMalfunction 1}}
									{{#rollTotal() veryReliable 1}}
										<span data-i18n="rolltemplate-very-reliable-description">
											<span style="color: red; font-weight:bold;">Very Reliable:</span> Won't malfunction unless lack of maintenance lowers Malf. (HT101, 121, 157)<br />
										</span>
									{{/rollTotal() veryReliable 1}}
									<span data-i18n="rolltemplate-malfunction-description">
										For effect, Roll 3d6 and see table on B407 or use custom table.<br />
										<b style="color:red;">Note:</b> Malfunction has "priority" over a critical miss: if both would occur,
										only the malfunction takes place. Critical Misses (B382).
									</span>
								</td>
							</tr>
							{{/rollBetween() rollResult malfunction 18}}
						{{/rollGreater() malfunction 0}}
					{{/malfunction}}
                {{/rollTotal() useMalfunction 1}}
                
                {{#damageRoll}}
                <tr>
                    <td class="label">
						<span data-i18n="damage-label">Damage</span>:
					</td>
                    <td class="damage-roll">
                        {{damageRoll}} <span class="damageType">{{damageType}}</span>
						{{#drMultiplier}}
							<span>DR Multiplier: {{drMultiplier}}</span>
						{{/drMultiplier}}
                    </td>
				</tr>
				{{#rollTotal() showMinimumDmgNote 1}}
                {{#minDamageNote}}
                <tr>
                    <td class="label">
						<span data-i18n="minimum-label">Minimum</span>:
					</td>
                    <td class="damage-roll">
						{{minDamageNote}}: 
						<span data-i18n="rolltemplate-minimum-damage-description">
							Applied to Target's DR<br />
							See B378 <b>Damage Roll</b>
						</span>
                    </td>
                </tr>
				{{/minDamageNote}}
				{{/rollTotal() showMinimumDmgNote 1}}
				{{#rollGreater() computed::bluntTrauma 0}}
				<tr>
					<td class="label"></td>
					<td class="damage-roll">
						{{computed::bluntTrauma}} 
						<span data-i18n="trauma-description">Blunt Trauma B379.</span>
					</td>
				{{/rollGreater() computed::bluntTrauma 0}}
				{{/damageRoll}}
				
				<!-- only show AD if value is greater than zero and isn't a one or a zero -->
				{{#^rollTotal() armorDivisor 1}}
				<tr>
                    <td class="label">
						<span data-i18n="armor-divisor-label">Armor Divisor</span>:
					</td>
                    <td class="effective-skill">
						<span data-i18n="divide-by-label">Divide target DR by</span> {{armorDivisor}}<br />
						<span data-i18n="round-down-note">Round Down (B378)</span>
					</td>
				</tr>
				{{/^rollTotal() armorDivisor 1}}
                
                {{#rollTotal() showNotes 1}}
                    {{#notes}}
					<tr>
						<td colspan="2" class="tool-modifier-title">
							<span>{{notesTitlePrefix}}</span> <span data-i18n="notes-label">Notes</span>
						</td>
					</tr>
                    <tr class="notes">
                        <td colspan="2">
							{{notes}}
						</td>
                    </tr>
                    {{/notes}}
                {{/rollTotal() showNotes 1}}
				
				{{#rollTotal() useDamageTypeNotes 1}}
                    {{#damageTypeNote}}
                    <tr class="damageTypeNote">
                        <td colspan="2"><span>{{damageTypeNote}}</span></td>
                    </tr>
                    {{/damageTypeNote}}
                {{/rollTotal() useDamageTypeNotes 1}}
                
                {{#rollTotal() showDBNotes 1}}
					{{#DBNotes}}
					<tr>
						<td class="label">DB:</td>
						<td>
							{{DBNotes}}
						</td>
					</tr>
					{{/DBNotes}}
				{{/rollTotal() showDBNotes 1}}

				{{#rollTotal() showCastingDetails 1}}

					<tr>
						<td colspan="2" class="tool-modifier-title">
							<span data-i18n="spell-summary-label">Spell Summary</span>
							{{#castingClass}}
								(<span data-i18n="class-label">Class</span>: {{castingClass}})
							{{/castingClass}}
						</td>
					</tr>
                
					{{#rollTotal() showSpellNotes 1}}
					{{#spellNotes}}
					<tr>
						<td class="label">Mods:</td>
						<td>
							{{spellNotes}}<br />
						</td>
					</tr>
					{{/spellNotes}}
					{{/rollTotal() showSpellNotes 1}}
					
					<tr>
						<td colspan="2">
							<div class="rolltemplate-spell-grid">
								<div class="label"><span data-i18n="time-label">Time</span>:</div>
								<div>{{castingTime}}</div>
								<div class="label"><span data-i18n="duration-abbreviated-label">Dur.</span>:</div>
								<div>{{castingDuration}}</div>
							</div>
						</td>
					</tr>
					
					<tr>
						<td colspan="2">
							<div class="rolltemplate-spell-grid">
								<div class="label"><span data-i18n="cost-label">Cost</span>:</div>
								<div>{{castingCost}}</div>
								<div class="label"><span data-i18n="maintain-abbreviated-label">Maint.</span>:</div>
								<div>{{castingMaintain}}</div>
							</div>
						</td>
					</tr>
					
					{{#castingResist}}
					<tr>
						<td class="label"><span data-i18n="resisted-by-label">Resisted by</span>:</td>
						<td>
							{{castingResist}}
							{{#^rollTotal() rule16Value 100}}
								<div><i><span data-i18n="rule-of-16-applied">Rule of 16 Applied</span></i></div>
							{{/^rollTotal() rule16Value 100}}
						</td>
					</tr>
					{{/castingResist}}
					
				{{/rollTotal() showCastingDetails 1}}
				
                
                {{#recoil}}
                <tr>
                    <td colspan="2">
                        <span class="title">
							<span data-i18n="recoil-label">Recoil</span><span>:</span></span>
						<span class="recoil-margin effective-skill">{{recoil}}</span>
						{{#rollTotal() useMalfunction 1}}
                        {{#rollGreater() malfunction 0}}
                            <span class="title">
								<span data-i18n="abbreviation-malfunction-label">Malf</span>:
							</span>
							<span class="normal-text-content">{{malfunction}}{{#rollTotal() verifyMalfunction 1}}v{{/rollTotal() verifyMalfunction 1}}</span>
							{{#rollTotal() veryReliable 1}}
								<span class="normal-text-content"><i>(Very Reliable)</i></span>
							{{/rollTotal() veryReliable 1}}
                        {{/rollGreater() malfunction 0}}
						{{/rollTotal() useMalfunction 1}}
                    </td>
                </tr>
				{{/recoil}}
				
        {{#rollTotal() noteBoxOneShow 1}}
                {{#noteBoxOneContent}}
				<tr>
					<td colspan="2" class="tool-modifier-title">
						{{noteBoxOneLabel}}
					</td>
				</tr>
                <tr>
                    <td colspan="2">
                        {{noteBoxOneContent}}
                    </td>
                </tr>
                {{/noteBoxOneContent}}
        {{/rollTotal() noteBoxOneShow 1}}

        {{#rollTotal() noteBoxTwoShow 1}}
                {{#noteBoxTwoContent}}
				<tr>
					<td colspan="2" class="tool-modifier-title">
						{{noteBoxTwoLabel}}
					</td>
				</tr>
                <tr>
                    <td colspan="2">
                        {{noteBoxTwoContent}}
                    </td>
                </tr>
                {{/noteBoxTwoContent}}
        {{/rollTotal() noteBoxTwoShow 1}}

        {{#rollTotal() noteBoxThreeShow 1}}
                {{#noteBoxThreeContent}}
				<tr>
					<td colspan="2" class="tool-modifier-title">
						{{noteBoxThreeLabel}}
					</td>
				</tr>
                <tr>
                    <td colspan="2">
                        {{noteBoxThreeContent}}
                    </td>
                </tr>
                {{/noteBoxThreeContent}}
        {{/rollTotal() noteBoxThreeShow 1}}

        {{#rollTotal() noteBoxFourShow 1}}
                {{#noteBoxFourContent}}
				<tr>
					<td colspan="2" class="tool-modifier-title">
						{{noteBoxFourLabel}}
					</td>
				</tr>
                <tr>
                    <td colspan="2">
                        {{noteBoxFourContent}}
                    </td>
                </tr>
                {{/noteBoxFourContent}}
        {{/rollTotal() noteBoxFourShow 1}}

            </table>
        </div>
	</rolltemplate>
	
	<rolltemplate class="sheet-rolltemplate-macro">
        <div class="container template-{{templateType}} rolltemplate-color-setting-{{sheetStyle}}">
			
			<div class="header">
				{{#title}}
				<div class="title">
					<div class="text">{{title}}</div>
				</div>
				{{/title}}
				{{#subtitle}}
				<div class="subtitle">
					<div class="text">{{subtitle}}</div>
				</div>
				{{/subtitle}}
			</div>

			<div class="arrow-container">
				<div class="arrow-right"></div>
			</div>

			<div class="content">

				{{#roll}}
				{{#target}}
				<div class="key">Roll</div>
				<div class="value">
					<span class="roll">{{roll}}</span> <span class="versus">vs</span> <span class="target">{{target}}</span>
				</div>
				{{/target}}
				{{/roll}}
				
				{{#roll}}
				{{#^target}}
				<div class="key">Roll</div>
				<div class="value">
					<span class="roll">{{roll}}</span>
				</div>
				{{/^target}}
				{{/roll}}

				<!-- list all the other properties that were not defined -->
				{{#allprops() title subtitle roll target desc templateType sheetStyle rollMadeBy rollMissedBy}}
				<div class="key">{{key}}</div>
      			<div class="value">{{value}}</div>
				{{/allprops() title subtitle roll target desc templateType sheetStyle rollMadeBy rollMissedBy}}

				{{#desc}}
				<div class="desc">{{desc}}</div>
				{{/desc}}

			</div>

        </div>
    </rolltemplate>

</div>
 
<script type="text/worker">
	
	// "use strict";
	
	// this type is required by roll20, be sure to set before uploading
	// type="text/worker"
	
	// if using VS code or similar coding tool, use the type listed below or just delete type="text/worker"
	// type="application/javascript"
	
	const noop = function () { }; // do nothing callback function.
	
	const version = "2.23.1";
	
	const latestChangesDate = "9/10/2024";
	
	let modCascade = true;
	
	let modCascadeAll = true;
	
	// add global variable
	let damageTable = [];
	
	const decelerationDivisor = 2;

	const metricWeightConversionMultiplier = 2.20462262;
	
	// see: https://app.roll20.net/forum/post/7251390/slug%7D
	const modBySpeedRange = [
		{ r: 1, m: 0 },
		{ r: 2, m: 0 },
		{ r: 3, m: -1 },
		{ r: 5, m: -2 },
		{ r: 7, m: -3 },
		{ r: 10, m: -4 },
		{ r: 15, m: -5 },
		{ r: 20, m: -6 },
		{ r: 30, m: -7 },
		{ r: 50, m: -8 },
		{ r: 70, m: -9 },
		{ r: 100, m: -10 },
		{ r: 150, m: -11 },
		{ r: 200, m: -12 },
		{ r: 300, m: -13 },
		{ r: 500, m: -14 },
		{ r: 700, m: -15 },
		{ r: 1000, m: -16 },
		{ r: 1500, m: -17 },
		{ r: 2000, m: -18 },
		{ r: 3000, m: -19 },
		{ r: 5000, m: -20 },
		{ r: 7000, m: -21 },
		{ r: 10000, m: -22 },
		{ r: 15000, m: -23 },
		{ r: 20000, m: -24 },
		{ r: 30000, m: -25 },
		{ r: 50000, m: -26 },
		{ r: 70000, m: -27 },
		{ r: 100000, m: -28 },
		{ r: 150000, m: -29 },
		{ r: 200000, m: -30 },
	];
	
	/**
	 * Create global function
	 * use: let mod = getModBySpeedRange(14);
	 * Uses the array of json object objects
	 * to get the modifier based on speed/range
	 * 
	 * @param {number} d Total of speed + range
	 * 
	 * @returns {number}
	 */
	const getModBySpeedRange = (d) => {
	
		// find first matching entry where range is greater than or equal to distance
		// Distance = 4, first entry where range is greater than 4. 
		// Range = 5, which is greater than 4. return that object. Modifier = -2
		const entry = modBySpeedRange.find((o) => o.r >= d);
	
		// TODO: use formula. Each 10x increase in linear measurement, give +6 SM or -6 speed/range modifier
	
		// if no matches, return -30.
		return (entry != undefined ? entry.m : -30);
	
	};

	// linear value is in yards. size modifier is an integer
	const sizeLinearMeasurementTable = [
		{linear: 0.005555, sm: -15},
		{linear: 0.009258, sm: -14},
		{linear: 0.013888, sm: -13},
		{linear: 0.018516, sm: -12},
		{linear: 0.027777, sm: -11},
		{linear: 0.041666, sm: -10},
		{linear: 0.055556, sm: -9},
		{linear: 0.083333, sm: -8},
		{linear: 0.138889, sm: -7},
		{linear: 0.222222, sm: -6},
		{linear: 0.333333, sm: -5},
		{linear: 0.5, sm: -4},
		{linear: 0.666667, sm: -3},
		{linear: 1, sm: -2},
		{linear: 1.5, sm: -1},
		{linear: 2, sm: 0},
		{linear: 3, sm: 1},
		{linear: 5, sm: 2},
		{linear: 7, sm: 3},
		{linear: 10, sm: 4},
		{linear: 15, sm: 5},
		{linear: 20, sm: 6},
		{linear: 30, sm: 7},
		{linear: 50, sm: 8},
		{linear: 70, sm: 9},
		{linear: 100, sm: 10},
		{linear: 150, sm: 11},
		{linear: 200, sm: 12},
		{linear: 300, sm: 13},
		{linear: 500, sm: 14},
		{linear: 700, sm: 15},
		{linear: 1000, sm: 16},
		{linear: 1500, sm: 17},
		{linear: 2000, sm: 18},
		{linear: 3000, sm: 19},
		{linear: 5000, sm: 20},
		{linear: 7000, sm: 21},
		{linear: 10000, sm: 22},
		{linear: 15000, sm: 23},
		{linear: 20000, sm: 24},
		{linear: 30000, sm: 25},
		{linear: 50000, sm: 26},
		{linear: 70000, sm: 27},
		{linear: 100000, sm: 28},
		{linear: 150000, sm: 29},
		{linear: 200000, sm: 30},
	];

	const getSizeModifierByMeasurement = yards => {

		const entry = sizeLinearMeasurementTable.find( object => object.linear >= yards);

		return (entry != undefined ? entry.sm : 30);

	}
	
	/**
	 * Defines all the skill modifiers
	 * used to total modifier, determine max9, and description summary.
	 * If isDropDown, value modifier is pulled from the drop-down value or special value based on radio button
	 * Map => key = field_name. value = { int modifier, string description, bool affectsVisibility, bool isDropDown, bool isMax9, bool isTrait, bool checkPain}
	 */
	const rollModifiers = new Map([
		["night_vision", { modifier: 0, description: "Night Vision", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: true, checkPain: false }],
		["temporary_night_vision", { modifier: 0, description: "Temporary Night Vision", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: true, checkPain: false }],
		["has_dark_vision", { modifier: 0, description: "Dark Vision", affectsVisibility: true, isDropDown: false, isMax9: false, isTrait: true, checkPain: false }],
		["is_used_to_blindness", { modifier: 0, description: "Used to blindness", affectsVisibility: true, isDropDown: false, isMax9: false, isTrait: true, checkPain: false }],
		["has_high_pain_threshold", { modifier: 0, description: "High Pain Threshold", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: true, checkPain: false }],
		["shock_penalty", { modifier: 0, description: "Shock", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: true }],
		["dialog_custom_roll_modifier", { modifier: 0, description: "Custom modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["darkness_penalty", { modifier: 0, description: "Darkness", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["visiblity_condition", { modifier: 0, description: "Based on selected condition", affectsVisibility: true, isDropDown: false, isMax9: true, isTrait: false, checkPain: false }],
		["darkness_penalty", { modifier: 0, description: "Darkness", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["smoke_penalty", { modifier: 0, description: "Smoke", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["fog_penalty", { modifier: 0, description: "Fog", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["blur_penalty", { modifier: 0, description: "Blur", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["other_vision_penalty", { modifier: 0, description: "Other vision penalty", affectsVisibility: true, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["coughing_sneezing_iq", { modifier: -1, description: "IQ Coughing/Sneezing", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["coughing_sneezing_dx", { modifier: -3, description: "DX Coughing/Sneezing", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["drowsy", { modifier: -2, description: "drowsy", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["tipsy", { modifier: -1, description: "Tipsy", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["drunk", { modifier: -2, description: "Drunk", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["euphoria", { modifier: -3, description: "Euphoria", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["distraction", { modifier: 0, description: "Distraction", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["pain_level", { modifier: 0, description: "Pain", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: true }],
		["skill_encumbered", { modifier: 0, description: "Encumbered", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["bad_footing", { modifier: 0, description: "Bad Footing", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["shield_close_combat_penalty", { modifier: 0, description: "Close combat with shield", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["grappled", { modifier: -4, description: "Grappled", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["holding_large_shield", { modifier: -2, description: "Holding Large Shield", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["task_difficulty", { modifier: 0, description: "Task Difficulty", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["task_extra_time", { modifier: 0, description: "Extra time for task", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["task_haste", { modifier: 0, description: "Hurry task", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["unfamiliar_culture", { modifier: -3, description: "Unfamiliar Culture", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["language_modifier", { modifier: 0, description: "Language Modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["iq_tech_level_modifier", { modifier: 0, description: "IQ based Tech Level Modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["non_iq_tech_level_modifier", { modifier: 0, description: "Non-IQ based Tech Level Modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["task_equipment_modifier", { modifier: 0, description: "Equipment modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["task_missing_items", { modifier: 0, description: "Missing items from equipment", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["task_damaged_equipment", { modifier: 0, description: "Damaged equipment", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["unfamiliar_equipment", { modifier: -2, description: "Unfamiliar Equipment", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["hit_location_modifier", { modifier: 0, description: "From hit_location field", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["melee_maneuver", { modifier: 0, description: "A function returns description", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["melee_all_out_attack", { modifier: 0, description: "A function returns description", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["deceptive_strike", { modifier: 0, description: "A function returns description", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["evaluate", { modifier: 0, description: "Evaluate", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["wild_swing", { modifier: -5, description: "Wild Swing", affectsVisibility: false, isDropDown: false, isMax9: true, isTrait: false, checkPain: false }],
		["rapid_strike", { modifier: -6, description: "Rapid Strike", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["flurry_of_blows", { modifier: -3, description: "Flurry of Blows. 1 FP per attack", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["rapid_strike_master", { modifier: -3, description: "Rapid Strike (master)", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["attack_from_above", { modifier: -2, description: "Attack from above", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["mighty_blow", { modifier: 0, description: "Mighty Blow 1 FP per attack. +2 Damage or +1 per die!", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["posture", { modifier: 0, description: "From a function", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["melee_height_difference", { modifier: 0, description: "From a function", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["improvised_weapon", { modifier: 0, description: "Improvised Weapon", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["tactics", { modifier: 0, description: "Tactics", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["backstab", { modifier: 4, description: "Backstab", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["unfriendly_hex", { modifier: -4, description: "Through unfriendly hex", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_tactics", { modifier: 0, description: "Tactics", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_backstab", { modifier: 4, description: "Backstab", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["weapon_hand", { modifier: 0, description: "Weapon hand description from function", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_weapon_hand", { modifier: 0, description: "Weapon hand description from function", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["mounted_skill_difference", { modifier: 0, description: "Mount attack, difference between skills", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["mount_attacked", { modifier: -2, description: "Mount attacked last turn", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["mount_has_velocity", { modifier: -1, description: "Mount relative velocity 7+. +1 damage, lances special damage", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_accuracy_bonus", { modifier: 0, description: "Accuracy bonus.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_range_speed_modifier", { modifier: 0, description: "Range/Speed Modifier.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_aiming_bonus", { modifier: 0, description: "Aiming bonus.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_rof_modifier", { modifier: 0, description: "Rate of Fire.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_targeting_system_modifier", { modifier: 0, description: "Targeting system.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_maneuver", { modifier: 0, description: "A function returns description.", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_in_close_combat", { modifier: 0, description: "Close combat", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_damaged_weapon", { modifier: 0, description: "Damaged weapon", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_strength_difference", { modifier: 0, description: "Strength Difference", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_opportunity_fire_watched", { modifier: 0, description: "Opportunity fire, Watched area", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_opportunity_fire_target", { modifier: -2, description: "Opportunity fire, check target first", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_braced", { modifier: 1, description: "Braced weapon", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_popup", { modifier: -2, description: "Pop-up attack", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_vehicle_conditions", { modifier: 0, description: "Function gets description", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_controll_roll", { modifier: 0, description: "Failed control roll", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_over_under_mount", { modifier: -6, description: "Over/under mount", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_vehicle_dodge", { modifier: -2, description: "Vehicle dodge", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["ranged_air_vehicle_dodge", { modifier: -4, description: "Vehicle dodge", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_maneuver", { modifier: 0, description: "A function returns description", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_crawling", { modifier: -3, description: "Crawling/Lying down", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_kneeling", { modifier: -2, description: "Kneeling/Sitting", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_from_behind", { modifier: -2, description: "Attacked from behind, you have peripheral vision", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_from_side", { modifier: -2, description: "Attacked from the side", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_runaround", { modifier: -2, description: "Ranaround attack", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["shield_db", { modifier: 0, description: "Shield DB", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["magic_db", { modifier: 0, description: "Magic DB", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["general_db", { modifier: 0, description: "General DB", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_retreat_dodge", { modifier: 3, description: "Retreating Dodge", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_retreat_parry", { modifier: 1, description: "Retreating Block/Parry", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_retreat_parry_fence", { modifier: 3, description: "Retreating Parry using fencing, boxing, judo, karate", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_retreating_flight", { modifier: 1, description: "Retreating while flying, must be able to hover", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_acrobatic_dodge_success", { modifier: 2, description: "Acrobatic Dodge", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_acrobatic_dodge_failed", { modifier: -2, description: "Failed Acrobatic Dodge", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_dodge_drop", { modifier: 3, description: "Dodge & Drop", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_feverish", { modifier: 2, description: "Feverish defense (costs 1 FP)", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_offhand_parry", { modifier: -2, description: "Off-Hand Parry", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parries", { modifier: 0, description: "Multiple parries", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parries_master", { modifier: 0, description: "Multiple parries by a master", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_improvised_weapon", { modifier: 0, description: "Parry with improvised weapon", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_laser_sight", { modifier: 1, description: "Laster Sight", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_deceptive_attack", { modifier: 0, description: "Defending against deceptive attack", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_feint", { modifier: 0, description: "Defending against a feint", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_height_difference", { modifier: 0, description: "From a function", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_mounted", { modifier: 0, description: "Defending while mounted", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_tactics", { modifier: 0, description: "Tactics", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_hidden_weapon", { modifier: -2, description: "Defending against hidden weapon", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parry_knife", { modifier: -1, description: "Parrying with knife/dagger", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parry_kusari", { modifier: -2, description: "Parrying with kusari/whip", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_unarmed_parry", { modifier: -3, description: "Unarmed parry against a swung weapon", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_dual_weapon", { modifier: -1, description: "Defending against a dual-weapon attack", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parry_flail", { modifier: -4, description: "Parrying against a flail", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_parry_nunchaku", { modifier: -2, description: "Parrying against a nunchaku", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_block_flail", { modifier: -2, description: "Blocking against a flail", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_block_nunchaku", { modifier: -1, description: "Blocking against a nunchaku", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_thrown_weapon", { modifier: -1, description: "Parry a thrown weapon", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_thrown_small_weapon", { modifier: -2, description: "Parry a small thrown weapon", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_trident_dodge", { modifier: -1, description: "Dodging a trident", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_trident_block", { modifier: -1, description: "Block/parry against a trident", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_stunned", { modifier: -4, description: "Stunned", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_nauseated", { modifier: -1, description: "Nauseated", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_encumbered", { modifier: 0, description: "Encumbered", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_cant_see_attacker", { modifier: -4, description: "Can't see attacker", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_bad_footing", { modifier: 0, description: "Bad footing", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_distraction", { modifier: 0, description: "Distraction", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["defense_grappled_dodge", { modifier: -1, description: "Grappled dodge penalty", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["defense_grappled_block", { modifier: -2, description: "Grappled block/parry penalty", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["spells_low_mana", { modifier: -5, description: "Low Mana", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["spell_burn_hit_points", { modifier: 0, description: "Spell Burn HP", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["spell_ceremonial_bonus", { modifier: 0, description: "Spell Ceremonial Bonus", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["regular_spell_modifier", { modifier: 0, description: "Regular Spell Range Modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["regular_spell_cant_see_touch", { modifier: -5, description: "Regular Spell Can't See or Touch", affectsVisibility: false, isDropDown: false, isMax9: false, isTrait: false, checkPain: false }],
		["spell_long_distance", { modifier: 0, description: "Spell Long Distance Modifier", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
		["spell_natures_strength", { modifier: 0, description: "Spell Nature's Strength", affectsVisibility: false, isDropDown: true, isMax9: false, isTrait: false, checkPain: false }],
	]);
	
	const traitFields = [
		"night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
	];

	const checkBoxFields = [];

	const dropDownField = [];
	
	/**
	 * These fields modify a skill
	 **/
	const skillModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"coughing_sneezing_iq",
		"coughing_sneezing_dx",
		"drowsy",
		"tipsy",
		"drunk",
		"euphoria",
		"distraction",
		"pain_level",
		"skill_encumbered",
		"bad_footing",
		"shield_close_combat_penalty",
		"grappled",
		"holding_large_shield",
		"visiblity_condition",
		"darkness_penalty",
		"smoke_penalty",
		"fog_penalty",
		"blur_penalty",
		"other_vision_penalty",
		"task_difficulty",
		"task_extra_time",
		"task_haste",
		"unfamiliar_culture",
		"language_modifier",
		"iq_tech_level_modifier",
		"non_iq_tech_level_modifier",
		"task_equipment_modifier",
		"task_missing_items",
		"task_damaged_equipment",
		"unfamiliar_equipment",
	];
	
	/**
	 * These fields modify a technique rolls.
	 **/
	const techniqueModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"coughing_sneezing_iq",
		"coughing_sneezing_dx",
		"drowsy",
		"tipsy",
		"drunk",
		"euphoria",
		"distraction",
		"pain_level",
		"skill_encumbered",
		"bad_footing",
		"shield_close_combat_penalty",
		"grappled",
		"holding_large_shield",
		"visiblity_condition",
		"darkness_penalty",
		"smoke_penalty",
		"fog_penalty",
		"blur_penalty",
		"other_vision_penalty",
		"task_difficulty",
		"task_extra_time",
		"task_haste",
		"unfamiliar_culture",
		"language_modifier",
		"iq_tech_level_modifier",
		"non_iq_tech_level_modifier",
		"task_equipment_modifier",
		"task_missing_items",
		"task_damaged_equipment",
		"unfamiliar_equipment",
	];
	
	/**
	 * These fields modify a skill
	 **/
	const meleeModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"coughing_sneezing_iq",
		"coughing_sneezing_dx",
		"drowsy",
		"tipsy",
		"drunk",
		"euphoria",
		"distraction",
		"pain_level",
		"skill_encumbered",
		"bad_footing",
		"shield_close_combat_penalty",
		"grappled",
		"holding_large_shield",
		"visiblity_condition",
		"darkness_penalty",
		"smoke_penalty",
		"fog_penalty",
		"blur_penalty",
		"other_vision_penalty",
		"hit_location_modifier",
		"hit_location",
		"melee_maneuver",
		"melee_all_out_attack",
		"posture",
		"deceptive_strike",
		"evaluate",
		"rapid_strike",
		"flurry_of_blows",
		"rapid_strike_master",
		"attack_from_above",
		"mighty_blow",
		"melee_height_difference",
		"improvised_weapon",
		"tactics",
		"backstab",
		"unfriendly_hex",
		"weapon_hand",
		"off_hand_training",
		"dual_weapon_training",
		"mounted_skill_difference",
		"mount_attacked",
		"mount_has_velocity",
		"wild_swing",
	];
	
	/**
	 * These fields modify a skill
	 **/
	const rangedModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"coughing_sneezing_iq",
		"coughing_sneezing_dx",
		"drowsy",
		"tipsy",
		"drunk",
		"euphoria",
		"distraction",
		"pain_level",
		"skill_encumbered",
		"bad_footing",
		"shield_close_combat_penalty",
		"grappled",
		"holding_large_shield",
		"visiblity_condition",
		"darkness_penalty",
		"smoke_penalty",
		"fog_penalty",
		"blur_penalty",
		"other_vision_penalty",
		"hit_location_modifier",
		"hit_location",
		"ranged_tactics",
		"ranged_backstab",
		"ranged_weapon_hand",
		"ranged_off_hand_training",
		"ranged_dual_weapon_training",
		"ranged_accuracy_bonus",
		"ranged_range_speed_modifier",
		"ranged_aiming_bonus",
		"ranged_rof_modifier",
		"ranged_targeting_system_modifier",
		"ranged_maneuver",
		"ranged_move_default_or_bulk",
		"ranged_in_close_combat",
		"ranged_damaged_weapon",
		"ranged_strength_difference",
		"ranged_opportunity_fire_watched",
		"ranged_opportunity_fire_target",
		"ranged_braced",
		"ranged_popup",
		"ranged_vehicle_conditions",
		"ranged_controll_roll",
		"ranged_over_under_mount",
		"ranged_vehicle_dodge",
		"ranged_air_vehicle_dodge",
	];
	
	/**
	 * These fields modify a skill
	 **/
	const defenseModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"defense_maneuver",
		"defense_crawling",
		"defense_kneeling",
		"defense_from_behind",
		"defense_from_side",
		"defense_runaround",
		"shield_db",
		"magic_db",
		"general_db",
		"defense_retreat_dodge",
		"defense_retreat_parry",
		"defense_retreat_parry_fence",
		"defense_retreating_flight",
		"defense_acrobatic_dodge_success",
		"defense_acrobatic_dodge_failed",
		"defense_dodge_drop",
		"defense_feverish",
		"defense_offhand_parry",
		"defense_parries",
		"defense_parries_master",
		"defense_improvised_weapon",
		"defense_laser_sight",
		"defense_deceptive_attack",
		"defense_feint",
		"defense_height_difference",
		"defense_mounted",
		"defense_tactics",
		"defense_hidden_weapon",
		"defense_parry_knife",
		"defense_parry_kusari",
		"defense_unarmed_parry",
		"defense_dual_weapon",
		"defense_parry_flail",
		"defense_parry_nunchaku",
		"defense_block_flail",
		"defense_block_nunchaku",
		"defense_thrown_weapon",
		"defense_thrown_small_weapon",
		"defense_trident_dodge",
		"defense_trident_block",
		"defense_stunned",
		"defense_nauseated",
		"defense_encumbered",
		"defense_cant_see_attacker",
		"defense_bad_footing",
		"defense_distraction",
		"defense_grappled_dodge",
		"defense_grappled_block",
	];
	
	/**
	 * These fields modify a skill
	 **/
	const spellModifierFields = [
		"max_skill_nine",
		"shock_penalty",
		"dialog_custom_roll_modifier",
		"dialog_custom_roll_modifier_reason",
		"night_vision",
		"temporary_night_vision",
		"has_dark_vision",
		"has_high_pain_threshold",
		"has_low_pain_threshold",
		"is_used_to_blindness",
		"coughing_sneezing_iq",
		"coughing_sneezing_dx",
		"drowsy",
		"tipsy",
		"drunk",
		"euphoria",
		"distraction",
		"pain_level",
		"skill_encumbered",
		"bad_footing",
		"shield_close_combat_penalty",
		"grappled",
		"holding_large_shield",
		"spells_low_mana",
		"spell_burn_hit_points",
		"spell_ceremonial_bonus",
		"regular_spell_modifier",
		"regular_spell_cant_see_touch",
		"spell_long_distance",
		"spell_natures_strength",
	];
	
	// predefined hit locations
	const HIT_LOCATIONS_JSON = new Map([
		["arachnoid", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "brain", display: "Brain", penalty: -7, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "eye-1", display: "Eye #1", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "eye-2", display: "Eye #2", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "eye-3", display: "Eye #3", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "eye-4", display: "Eye #4", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "eye-5", display: "Eye #5", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "eye-6", display: "Eye #6", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "leg-1", display: "Leg #1", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-2", display: "Leg #2", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-3", display: "Leg #3", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-4", display: "Leg #4", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-5", display: "Leg #5", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-6", display: "Leg #6", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-7", display: "Leg #7", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-8", display: "Leg #8", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
		]],
		["avian", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-wing", display: "Left Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-wing", display: "Right Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-leg", display: "Left Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foot", display: "Left Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-leg", display: "Right Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-foot", display: "Right Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["cancroid", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-pincer", display: "Left Pincer", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-pincer", display: "Right Pincer", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-1", display: "Leg #1", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-2", display: "Leg #2", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-3", display: "Leg #3", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-4", display: "Leg #4", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-5", display: "Leg #5", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-6", display: "Leg #6", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-7", display: "Leg #7", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "leg-8", display: "Leg #8", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "tail", display: "Tail", penalty: -3, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["centaur", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "animal-torso", display: "Animal Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-arm", display: "Left Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-hand", display: "Left Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-arm", display: "Right Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-hand", display: "Right Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-foreleg", display: "Left Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foreleg-foot", display: "Left Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-foreleg", display: "Right Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-foreleg-foot", display: "Right Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-hind-leg", display: "Left Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-hind-foot", display: "Left Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-hind-leg", display: "Right Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-hind-foot", display: "Right Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "tail", display: "Tail", penalty: -3, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["hexapod", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-wing", display: "Left Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-wing", display: "Right Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foreleg", display: "Left Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foreleg-foot", display: "Left Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-foreleg", display: "Right Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-foreleg-foot", display: "Right Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-mid-leg", display: "Left Mid Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-mid-foot", display: "Left Mid Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-mid-leg", display: "Right Mid Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-mid-foot", display: "Right Mid Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-hind-leg", display: "Left Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-hind-foot", display: "Left Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-hind-leg", display: "Right Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-hind-foot", display: "Right Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "tail", display: "Tail", penalty: -3, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["humanoid", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-arm", display: "Left Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-hand", display: "Left Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-arm", display: "Right Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-hand", display: "Right Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-leg", display: "Left Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foot", display: "Left Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-leg", display: "Right Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-foot", display: "Right Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["humanoid_low_tech", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "chest", display: "Chest", penalty: 0, DR: 0, hp_divisor: 1, notes: "Roll 1d6, on 1, hit vitals." },
			{ key: "abdomen", display: "Abdomen", penalty: -1, DR: 0, hp_divisor: 1, notes: "Roll 1d6, on 1, hit vitals." },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-arm", display: "Left Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "Roll 1d6 to determine what armor piece is hit." },
			{ key: "left-shoulder", display: "  Shoulder", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 6." },
			{ key: "left-upper-arm", display: " Upper Arm", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 5." },
			{ key: "left-elbow", display: "  Elbow", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 4." },
			{ key: "left-forearm", display: "  Forearm", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 1-3." },
			{ key: "left-hand", display: "Left Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-arm", display: "Right Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "Roll 1d6 to determine what armor piece is hit." },
			{ key: "right-shoulder", display: "  Shoulder", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 6." },
			{ key: "right-upper-arm", display: "  Upper Arm", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 5." },
			{ key: "right-elbow", display: "  Elbow", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 4." },
			{ key: "right-forearm", display: "  Forearm", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 1-3." },
			{ key: "right-hand", display: "Right Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-leg", display: "Left Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "Roll 1d6 to determine what armor piece is hit." },
			{ key: "left-thigh", display: "  Thigh", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 5-6." },
			{ key: "left-knee", display: "  Knee", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 4." },
			{ key: "left-shin", display: "  Shin", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 1-3" },
			{ key: "left-foot", display: "Left Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-leg", display: "Right Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "Roll 1d6 to determine what armor piece is hit." },
			{ key: "left-thigh", display: "  Thigh", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 5-6." },
			{ key: "left-knee", display: "  Knee", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 4." },
			{ key: "left-shin", display: "  Shin", penalty: -2, DR: 0, hp_divisor: 1, notes: "Hit on 1-3" },
			{ key: "right-foot", display: "Right Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["humanoid_martial_arts", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "chest", display: "Chest", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "abdomen", display: "Abdomen", penalty: -1, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck-veins", display: "Neck Veins", penalty: -8, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "jaw", display: "Jaw", penalty: -6, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "nose", display: "Nose", penalty: -7, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "spine", display: "Spine", penalty: -8, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "left-ear", display: "Left Ear", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
			{ key: "right-ear", display: "Right Ear", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-arm", display: "Left Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-arm-joints", display: "Left Arm Joints", penalty: -5, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-arm-veins", display: "Left Arm Veins", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "left-hand", display: "Left Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-hand-joints", display: "Left Hand Joints", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
			{ key: "right-arm", display: "Right Arm", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-arm-joints", display: "Right Arm Joints", penalty: -5, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-arm-veins", display: "Right Arm Veins", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "right-hand", display: "Right Hand", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-hand-joints", display: "Right Hand Joints", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
			{ key: "left-leg", display: "Left Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-leg-joints", display: "Left Leg Joints", penalty: -5, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-leg-veins", display: "Left Leg Veins", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "left-foot", display: "Left Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-foot-joint", display: "Left Foot Joint", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
			{ key: "right-leg", display: "Right Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-leg-joints", display: "Right Leg Joints", penalty: -5, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-leg-veins", display: "Right Leg Veins", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "right-foot", display: "Right Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-foot-joint", display: "Right Foot Joint", penalty: -7, DR: 0, hp_divisor: 4, notes: "" },
		]],
		["ichthyoid", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-fin", display: "Left Fin", penalty: -2, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-fin", display: "Right Fin", penalty: -2, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "top-fin", display: "Top Fin", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "bottom-fin", display: "Bottom Fin", penalty: -2, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "tail", display: "Tail", penalty: -3, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["octopod", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "brain", display: "Brain", penalty: -7, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "arm-1", display: "Arm #1", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-2", display: "Arm #2", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-3", display: "Arm #3", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-4", display: "Arm #4", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-5", display: "Arm #5", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-6", display: "Arm #6", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-7", display: "Arm #7", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "arm-8", display: "Arm #8", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
		]],
		["quadruped", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -9, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "left-wing", display: "Left Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-wing", display: "Right Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foreleg", display: "Left Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-foreleg-foot", display: "Left Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-foreleg", display: "Right Foreleg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-foreleg-foot", display: "Right Foreleg Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "left-hind-leg", display: "Left Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "left-hind-foot", display: "Left Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-hind-leg", display: "Right Hind Leg", penalty: -2, DR: 0, hp_divisor: 2, notes: "" },
			{ key: "right-hind-foot", display: "Right Hind Foot", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "tail", display: "Tail", penalty: -3, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["vermiform", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "vitals", display: "Vitals", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "groin", display: "Groin", penalty: -3, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "face", display: "Face", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "neck", display: "Neck", penalty: -5, DR: 0, hp_divisor: 1, notes: "" },
			{ key: "skull", display: "Skull", penalty: -7, DR: 2, hp_divisor: 1, notes: "" },
			{ key: "left-eye", display: "Left Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
			{ key: "right-eye", display: "Right Eye", penalty: -8, DR: 0, hp_divisor: 10, notes: "" },
		]],
		["wagon", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "wheel-1", display: "Wheel #1", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-2", display: "Wheel #2", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-3", display: "Wheel #3", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-3", display: "Wheel #4", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
		]],
		["automobile", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "large-windows", display: "Large Windows", penalty: -3, DR: 0, hp_divisor: 1, notes: "1/2 DR. Check occupant hit." },
			{ key: "wheel-1", display: "Wheel #1", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-2", display: "Wheel #2", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-3", display: "Wheel #3", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-3", display: "Wheel #4", penalty: -4, DR: 0, hp_divisor: 8, notes: "If damaged, roll HT to avoid flat tire." },
		]],
		["rowboat", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "open-body", display: "Open Body", penalty: -3, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "open-body", display: "Open Body", penalty: -3, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
		]],
		["speedboat", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "open-body", display: "Open Body", penalty: -3, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
		]],
		["biplane", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "open-body", display: "Open Body", penalty: -3, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "wheel-1", display: "Wheel #1", penalty: -4, DR: 0, hp_divisor: 4, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-2", display: "Wheel #2", penalty: -4, DR: 0, hp_divisor: 4, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "left-wing", display: "Left Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "If disabled, lose control and crash." },
			{ key: "right-wing", display: "Right Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "If disabled, lose control and crash." },
		]],
		["monoplane", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "large-windows", display: "Large Windows", penalty: -3, DR: 0, hp_divisor: 1, notes: "1/2 DR. Check occupant hit." },
			{ key: "wheel-1", display: "Wheel #1", penalty: -4, DR: 0, hp_divisor: 4, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "wheel-2", display: "Wheel #2", penalty: -4, DR: 0, hp_divisor: 4, notes: "If damaged, roll HT to avoid flat tire." },
			{ key: "left-wing", display: "Left Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "If disabled, lose control and crash." },
			{ key: "right-wing", display: "Right Wing", penalty: -2, DR: 0, hp_divisor: 2, notes: "If disabled, lose control and crash." },
		]],
		["helicopter", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "large-windows", display: "Large Windows", penalty: -3, DR: 0, hp_divisor: 1, notes: "1/2 DR. Check occupant hit." },
			{ key: "rotor-main", display: "Main Rotor", penalty: -2, DR: 0, hp_divisor: 2, notes: "If disabled, lose control and crash." },
			{ key: "rotor-tail", display: "Tail Rotor", penalty: -2, DR: 0, hp_divisor: 3, notes: "If disabled, lose control and crash." },
			{ key: "left-skid", display: "Left Skid", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
			{ key: "right-skid", display: "Right Skid", penalty: -4, DR: 0, hp_divisor: 3, notes: "" },
		]],
		["tank", [
			{ key: "large-area", display: "Large-Area", penalty: 0, DR: 0, hp_divisor: 1, notes: "Large-Area Injury. B400" },
			{ key: "body", display: "Body", penalty: 0, DR: 0, hp_divisor: 1, notes: "Check occupant hit." },
			{ key: "vital-area", display: "Vital Area", penalty: -3, DR: 0, hp_divisor: 1, notes: "Tight-beam burning x2 damage. Impaling/piercing x3 damage." },
			{ key: "caterpillar-track-left", display: "Left Track", penalty: -2, DR: 0, hp_divisor: 2, notes: "If track disabled, move is 0." },
			{ key: "caterpillar-track-left", display: "Main Rotor", penalty: -2, DR: 0, hp_divisor: 2, notes: "If track disabled, move is 0." },
			{ key: "main-turrent", display: "Main Turrent", penalty: -2, DR: 0, hp_divisor: 2, notes: "If major wound and failed HT roll, turret is knocked out." },
			{ key: "exposed-weapon", display: "Exposed Weapon", penalty: -7, DR: 0, hp_divisor: 5, notes: "" },
		]],
	]);
	
	let rawRollNotes = {};

	
	/* -------- async functions -------- */
	/* see: https://github.com/onyxring/Roll20Async */

	function setActiveCharacterId(charId) {
        var oldAcid = getActiveCharacterId();
        var ev = new CustomEvent("message");
        ev.data = { "id": "0", "type": "setActiveCharacter", "data": charId };
        self.dispatchEvent(ev);
        return oldAcid;
    }

    var _sIn = setInterval;
    setInterval = function (callback, timeout) {
        var acid = getActiveCharacterId();
        _sIn(
            function () {
                var prevAcid = setActiveCharacterId(acid);
                callback();
                setActiveCharacterId(prevAcid);
            }
            , timeout);
    }

    var _sto = setTimeout
    setTimeout = function (callback, timeout) {
        var acid = getActiveCharacterId();
        _sto(
            function () {
                var prevAcid = setActiveCharacterId(acid);
                callback();
                setActiveCharacterId(prevAcid);
            }
            , timeout);
    }

    function getAttrsAsync(props) {
        var acid = getActiveCharacterId(); //save the current activeCharacterID in case it has changed when the promise runs 
        var prevAcid = null;               //local variable defined here, because it needs to be shared across the promise callbacks defined below
        return new Promise((resolve, reject) => {
            prevAcid = setActiveCharacterId(acid);  //in case the activeCharacterId has changed, restore it to what we were expecting and save the current value to restore later
            try {
                getAttrs(props, (values) => { resolve(values); });
            }
            catch { reject(); }
        }).finally(() => {
            setActiveCharacterId(prevAcid); //restore activeCharcterId to what it was when the promise first ran
        });
    }

    //use the same pattern for each of the following...
    function setAttrsAsync(propObj, options) {
        var acid = getActiveCharacterId();
        var prevAcid = null;
        return new Promise((resolve, reject) => {
            prevAcid = setActiveCharacterId(acid);
            try {
                setAttrs(propObj, options, (values) => { resolve(values); });
            }
            catch { reject(); }
        }).finally(() => {
            setActiveCharacterId(prevAcid);
        });
    }

    function getSectionIDsAsync(sectionName) {
        var acid = getActiveCharacterId();
        var prevAcid = null;
        return new Promise((resolve, reject) => {
            prevAcid = setActiveCharacterId(acid);
            try {
                getSectionIDs(sectionName, (values) => { resolve(values); });
            }
            catch { reject(); }
        }).finally(() => {
            setActiveCharacterId(prevAcid);
        });
    }

    function getSingleAttrAsync(prop) {
        var acid = getActiveCharacterId();
        var prevAcid = null;
        return new Promise((resolve, reject) => {
            prevAcid = setActiveCharacterId(acid);
            try {
                getAttrs([prop], (values) => { resolve(values[prop]); });
            }
            catch { reject(); }
        }).finally(() => {
            setActiveCharacterId(prevAcid);
        });
    }

	function setSectionOrderAsync(sectionName, rowIds) {
		var acid = getActiveCharacterId();
        var prevAcid = null;
        return new Promise((resolve, reject) => {
            prevAcid = setActiveCharacterId(acid);
            try {
                setSectionOrder(sectionName, rowIds, (values) => { resolve(values[prop]); });
            }
            catch { reject(); }
        }).finally(() => {
            setActiveCharacterId(prevAcid);
        });
	}

	/**
	 * Async foreach.
	 * see: https://codeburst.io/javascript-async-await-with-foreach-b6ba62bbf404
	 */
	async function asyncForEach(array, callback) {
		for (let index = 0; index < array.length; index++) {
			await callback(array[index], index, array);
		}
	}	
	/*------------------*/
	
	const styleCount = 9; // THIS NUMBER MUST BE EQUAL TO THE NUMBER OF COLOR SETTINGS
	on("change:sheetstyle change:chatstyle sheet:opened", function (event) {
		let styleAttrs = {};
	
		for (let i = 0; i < styleCount; i++) {
			styleAttrs["styleset" + i] = "off";
		}
	
		getAttrs(["sheetstyle"], function (values) {
			let on = values.sheetstyle;
			styleAttrs["styleset" + on] = "on";
			setAttrs(styleAttrs);
		});
	});
	
	/* Due to the change from auto-calc fields to helper scripts,
	 * I'm running a "on open" to set various fields. At some point
	 * in the future this might no longer be needed.
	 */
	on('sheet:opened', function () {
	
		console.log('********* Sheet Opened *********');
	
		rawRollNotes = getRawNotes();

		fixArmorLayerLabels();
	
		syncRollOptions();
	
		syncModifierPromptOptions();
	
		updateStaticNotes();

		checkUpdateDefaultSlamValues();
	
		setAttrs({ inventory_fixed_digits: 1 });
	
		sumRepeating('repeating_item', 'weighttotal', function (v) {
			setAttrs({ total_weight: Number(Math.round(v * 1000) / 1000).toFixed(3) });
		});

		sumRepeating('repeating_item', 'costtotal', function (v) {
			setAttrs({ total_value: Number((v * 100) / 100).toFixed(2) }, { silent: true });
		});
	
		getAttrs(['sheet_version', 'mod_cascade', 'modCascade', 'modCascadeAll', 'combat_reflexes', 'reflexes_converted_to_base_skill'], function (v) {
	
			const hasCombatReflexes = v.combat_reflexes === "1" ? true : false;

			const hasReflexesBeenConverted = v.reflexes_converted_to_base_skill === "1" ? true : false;

			if (v.modCascade && v.modCascadeAll) {
				modCascade = v.modCascade;
				modCascadeAll = v.modCascadeAll;
			}
	
			if (!v.sheet_version || v.sheet_version != version) {
	
				let hide = 0;
					
				// if this is a brand new sheet. don't show announcements
				if (!v.sheet_version) {
					hide = 1;
				}
	
				let defaultSettings = {
					sheet_version: version,
					announcement_version: version,
					latest_changes: latestChangesDate,
					announcements_hide: hide,
					announcements_show: 0
				};

				// Set sheet version:
				// show announcements div
				setAttrs(defaultSettings);
	
				// initialize any empty fields in repeating sections since the default values were removed.
				loadRepeating('repeating_languages', 'spoken', 0);
				loadRepeating('repeating_languages', 'written', 0);
				loadRepeating('repeating_skills', 'points', 1);
				loadRepeating('repeating_cultures', 'points', 1);
				loadRepeating('repeating_techniques', 'points', 1);
				loadRepeating('repeating_spells', 'points', 1);

				// initialize all calculated stats
				resetAll(v.mod_cascade, !v.sheet_version, hasCombatReflexes, hasReflexesBeenConverted);
	
			}
	
		});
	
		damageTable = generateDamageTable();

		resetAllRollModifiers();
	
	});
	
	on('change:mod_cascade', function (e) {
		getAttrs(['mod_cascade'], function (v) {
			resetAll(v.mod_cascade, false, false, false);
		})
	});

	const fixArmorLayerLabels = () => {

		getAttrs(["hit_location_layer_use_custom_labels"], (values) => {
			if (values.hit_location_layer_use_custom_labels === undefined) {
				setAttrs({ hit_location_layer_use_custom_labels: "0" });
			}
		});

	}
	
	/**
	 * Resets values for the sheet
	 * 
	 * @param {string}  mod_cascade              What fields to update based on other attributes
	 * @param {boolean} isNewSheet               Is this a brand new sheet
	 * @param {boolean} hasCombatReflexes        Does character sheet have combat reflexes checked
	 * @param {boolean} hasReflexesBeenConverted Has the character sheet already been converted
	 */ 
	function resetAll(mod_cascade, isNewSheet, hasCombatReflexes, hasReflexesBeenConverted) {
		
		switch (mod_cascade) {
			case 'all':
				modCascade = true;
				modCascadeAll = true;
				break;
			case 'some':
				modCascade = true;
				modCascadeAll = false;
				break;
			default:
				modCascade = false;
				modCascadeAll = false;
		}

		setAttrs({
			modCascade: modCascade,
			modCascadeAll: modCascadeAll
		});
	
		// last thing to update is movement
		let thenMovementStats = _.after(1, function () {
	
			// last thing to update is movement tables
			updateToggleUnspentCheckBox();
			updateDiceDamageIcons();
			updateEnhancedMove();
			updateFlightValues();
			updateWaterMoveValues();
			updateJumpDistanceValues();
	
			// update conditions
			updateHealthConditionChecks();
	
			updateFatiguePointThresholds();
	
			updateReach();

			updateCombatReflexesMod();
	
		});
	
		// After move, dodge, encumbrance, HP, and FP
		let thenCurrentMoveDodge = _.after(2, function () {
			updateMoveDodge(thenMovementStats);
		});
	
		// After DX and HT
		let thenSpeedMoveDodge = _.after(2, function () {
	
			updateBasicSpeed(function () {
	
				// After Basic Speed...
				updateBasicMove(thenCurrentMoveDodge);
				updateDodge(thenCurrentMoveDodge);
	
			});
	
		});
	
		// After Lift and weight...
		let thenEncumbrance = _.after(2, function () {
			updateEncLevel(thenCurrentMoveDodge);
		});
	
		// After Striking st damage
		let thenUpdateThrownObjectStats = _.after(1, function () {
			updateThrownObjectStats();
		});
	
		sumRepeating('repeating_item', 'weighttotal', function (v) {
			setAttrs({ total_weight: Math.round(v * 1000) / 1000 }, null, thenEncumbrance);
		});
	
		// Update attributes, then secondary characteristics, and so on...
		updateST(function () {
	
			// After ST...
			updateHP(thenCurrentMoveDodge);
	
			updateLift(thenEncumbrance);
	
			updateStrikingST();
	
			// updateStrikingST damage rolls
			// after completed, then update thrown object
			updateStrikingStrengthDamage(thenUpdateThrownObjectStats);
	
		});
	
		updateDX(thenSpeedMoveDodge);
	
		updateIQ(function () {
	
			// After IQ...
			updateWill();
	
			updatePer(function () {
				// After Per...
				updateSense();
			});
	
		});
	
		updateHT(function () {
	
			updateFP(thenCurrentMoveDodge);
	
			thenSpeedMoveDodge();
	
		});
	
		updateDamageNotes();
	
		updateFrightCheckThreshold();
	
		updateRepeatingDefenseTypes();
	
		updateRepeatingDefenseNotes(isNewSheet, hasCombatReflexes, hasReflexesBeenConverted);
	
		syncModsToRepeatingSpells(true, updateRepeatingSkillSpellLevels("repeating_spells"));
	
		updateRepeatingSkillSpellLevels("repeating_skills");
	
		updateHitPointThresholds();

		setRangedMaxMalfunctionValues();

		updateRepeatingLanguages();

		totalAttributeCharacterPoints();

		updateRacialCharacterPoints();

		updateTechLevelPoints();

		updateLanguagePoints();

		upgradeHitLocationPenaltiesToNewVersion();

		updateRuleSixteenForSpells();

		moveOldMacros();

		updateAllRangedShotsFiredMacro();

		setDefaultChatStyle();
	
	}
	
	// Sum values, used in reduce
	function getSum(total, num) {
		return (+total || 0) + (+num || 0);
	}
	
	// function to sum a field from a repeating section
	function sumRepeating(sectionName, fieldName, callback) {
		getSectionIDs(sectionName, function (ids) {
			if (ids.length === 0) {
				callback(0);
				return;
			}
			let fieldArray = [];
			for (let i = 0; i < ids.length; i++) {
				fieldArray.push(sectionName + '_' + ids[i] + '_' + fieldName);
			}
			getAttrs(fieldArray, function (fieldValues) {
				let vals = Object.values(fieldValues);
				vals.push(0);
				let total = vals.reduce(getSum);
				callback(total);
			});
		});
	}
	
	// load values of a repeating section
	function loadRepeating(sectionName, fieldName, defaultValue) {
	
		console.log('********* loadRepeating ' + sectionName + '.' + fieldName + '*********');
	
		getSectionIDs(sectionName, function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let fieldArray = [];
	
			let update = {};
	
			for (let i = 0; i < ids.length; i++) {
	
				let propName = sectionName + '_' + ids[i] + '_' + fieldName;
	
				fieldArray.push(propName);
	
				update[propName] = defaultValue;
			}
	
			getAttrs(fieldArray, function (fieldValues) {
				Object.assign(update, fieldValues);
				setAttrs(update);
			});
	
		});
	
	}
	
	// Strength Change
	on('change:strength_points change:strength_mod change:defense_knockback_hitpoints_mod change:size change:apply_size_modifier', function (e) {
		updateST();
	});
	
	/**
	 * Get the size modifier percentage for use with 
	 * Strength and extra HP character point costs
	 * 
	 * @param {number} sizeModifier size of character
	 * 
	 * @returns {number}
	 */
	function getSizeModifierPercentage(sizeModifier) {
	
		let percentModifier = 0;
	
		// make sure we have an integer
		if (Number.isInteger(sizeModifier) === false) {
			sizeModifier = Math.floor(sizeModifier);
		}
	
		if (1 <= sizeModifier && sizeModifier <= 8) {
			percentModifier = -10 * sizeModifier;
		} else if (sizeModifier > 8) {
			percentModifier = -80;
		}
	
		return percentModifier;
	
	}
	
	/**
	 * Get the point cost per level based on size modifier.
	 * 
	 * @param {boolean} applySizeModifier  Should size modifier by applied?
	 * @param {number}  sizeModifier       Size of character
	 * @param {number}  basePointsPerLevel Cost per level for an attribute. ST is 10 per level. HP is 2 per level
	 * 
	 * @returns {number}
	 */
	function getSizeModifierPointsPerLevel(applySizeModifier, sizeModifier, basePointsPerLevel) {
	
		let pointsPerLevel = basePointsPerLevel;
	
		// make sure we have an integer
		if (Number.isInteger(sizeModifier) === false) {
			sizeModifier = Math.floor(sizeModifier);
		}
	
		if (applySizeModifier && sizeModifier > 0) {
	
			let percentModifier = getSizeModifierPercentage(sizeModifier);
	
			let decimalModifier = percentModifier / 100;
	
			// formula ST example: points per level = 10
			//                     basePointsPerLevel + (basePointsPerLevel * percentModifier) = pointsPerLevel
			//                     10 + (10 * 0) = 10		-- size modifier = 0
			//                     10 + (10 * -10%) = 9		-- size mofifier = 1 | -10% = -.1
			//                     10 + (10 * -20%) = 8		-- size modifier = 2
			// formula HP example: points per level = 2
			//                     2 + (2 * -10%) = 2
			pointsPerLevel = basePointsPerLevel + (basePointsPerLevel * decimalModifier);
	
		}
	
		return pointsPerLevel;
	
	}
	
	/**
	 * Updates strength properties
	 * 
	 * @param {() => void=} callback Function to run after updating properties
	 */
	function updateST(callback) {
	
		callback = callback || noop;
	
		console.log('********* updateST *********');
	
		getAttrs(['strength_points', 'strength_mod', 'strength_halved', 'defense_knockback_hitpoints_mod', 'apply_size_modifier', 'size'], function (v) {
	
			let applySizeModifier = (v.apply_size_modifier == "1");
	
			let sizeModifier = Number(v.size) || 0;
	
			let characterPoints = Number(v.strength_points) || 0;
	
			let pointsPerLevel = getSizeModifierPointsPerLevel(applySizeModifier, sizeModifier, 10);
	
			let strengthModByCharacterPoints = Math.floor(characterPoints / pointsPerLevel);
	
			const calculatedCost = strengthModByCharacterPoints * pointsPerLevel;
	
			let isTooLarge = characterPoints - calculatedCost >= 1;
	
			let pointsNeededForStrength = 0;
	
			let showMessage = 0;
	
			if (applySizeModifier && sizeModifier > 0 && isTooLarge) {
	
				showMessage = 1;
	
				pointsNeededForStrength = Math.floor(pointsPerLevel * strengthModByCharacterPoints);
	
			}
	
			let base = 10 + strengthModByCharacterPoints;
	
			let mod = +v.strength_mod || 0;
	
			let st_halved = +v.strength_halved;
	
			let st_display = base + mod;
	
			let knockbackMod = +v.defense_knockback_hitpoints_mod;
	
			// check if ST was halved due to fatigue.
			if (st_halved === 1) {
	
				st_display = st_display / 2;
	
			}
	
			setAttrs({
				strength_base: base,
				strength: base + mod,
				strength_display: st_display,
				knockback_points: st_display - 2 + knockbackMod,
				show_size_modifier_strength_message: showMessage,
				size_modifier_cp_strength_adjustment: pointsNeededForStrength,
				strength_points_per_level: pointsPerLevel
			}, null, callback);
		});
	}
	
	// Dexterity Change
	on('change:dexterity_points change:dexterity_mod', function (e) {
		updateDX();
	});
	
	/**
	 * Update DX properties
	 * 
	 * @param {*} callback Function to run after updatin properties
	 */
	function updateDX(callback) {
		callback = callback || noop;
		console.log('********* updateDX *********');
		getAttrs(['dexterity_points', 'dexterity_mod'], function (v) {
			let base = 10 + ((+v.dexterity_points || 0) / 20 | 0);
			let mod = +v.dexterity_mod || 0;
			setAttrs({
				dexterity_base: base,
				dexterity: base + mod
			}, null, callback);
		});
	}
	
	// Intelligence
	on('change:intelligence_points change:intelligence_mod', function (e) {
		updateIQ();
	});
	
	/**
	 * Update Intelligence properties
	 * 
	 * @param {*} callback Function to run after updating properties
	 */
	function updateIQ(callback) {
		callback = callback || noop;
		console.log('********* updateIQ *********');
		getAttrs(['intelligence_points', 'intelligence_mod'], function (v) {
			let base = 10 + ((+v.intelligence_points || 0) / 20 | 0);
			let mod = +v.intelligence_mod || 0;
			setAttrs({
				intelligence_base: base,
				intelligence: base + mod
			}, null, callback);
		});
	}
	
	// Health
	on('change:health_points change:health_mod', function (e) {
		updateHT();
	});
	
	/**
	 * Update Health properties
	 * 
	 * @param {*} callback Function to run after updating properties
	 */
	function updateHT(callback) {
		callback = callback || noop;
		console.log('********* updateHT *********');
		getAttrs(['health_points', 'health_mod'], function (v) {
			let base = 10 + ((+v.health_points || 0) / 10 | 0);
			let mod = +v.health_mod || 0;
			setAttrs({
				health_base: base,
				health: base + mod
			}, null, callback);
		});
	}
	
	// HP
	on('change:strength change:hit_points_points change:hit_points_mod change:apply_size_modifier change:size', function (e) {
	
		// after updating hit points, update thresholds
		updateHP(updateHitPointThresholds);
	
	});
	
	// Update HP
	function updateHP(callback) {
	
		console.log('********* updateHP *********');
	
		callback = callback || noop;
	
		getAttrs(['strength', 'strength_base', 'hit_points_points', 'hit_points_mod', 'apply_size_modifier', 'size'], function (v) {
	
			let applySizeModifier = (v.apply_size_modifier == "1");
	
			let sizeModifier = Number(v.size) || 0;
	
			let characterPoints = Number(v.hit_points_points) || 0;
	
			let pointsPerLevel = getSizeModifierPointsPerLevel(applySizeModifier, sizeModifier, 2);
	
			let modByCharacterPoints = Math.floor(characterPoints / pointsPerLevel);
	
			const calculatedCost = modByCharacterPoints * pointsPerLevel;
	
			let isTooLarge = characterPoints - calculatedCost >= 1;
	
			let pointsNeededForHitPoints = 0;
	
			let showMessage = 0;
	
			if (applySizeModifier && sizeModifier > 0 && isTooLarge) {
	
				showMessage = 1;
	
				pointsNeededForHitPoints = Math.ceil(pointsPerLevel * modByCharacterPoints);
	
			}
	
			let base = (modCascadeAll ? +v.strength : +v.strength_base) + modByCharacterPoints;
	
			let mod = +v.hit_points_mod || 0;
	
			let hitPoints = base + mod;
	
			let majorWound = Math.floor(hitPoints / 2) + 1;
	
			setAttrs({
				hit_points_max: hitPoints,
				major_wound_threshold: majorWound,
				show_size_modifier_hit_point_message: showMessage,
				size_modifier_cp_hit_point_adjustment: pointsNeededForHitPoints,
				extra_hit_points_per_level: pointsPerLevel,
			}, null, callback);
	
		});
	}
	
	// FP
	on('change:health change:fatigue_points_points change:fatigue_points_mod', function (e) {
		updateFP(updateFatiguePointThresholds);
	});
	
	// Update FP
	function updateFP(callback) {
		console.log('********* updateFP *********');
		callback = callback || noop;
		getAttrs(['health', 'health_base', 'fatigue_points_points', 'fatigue_points_mod'], function (v) {
			let base = (modCascadeAll ? +v.health : +v.health_base) +
				((+v.fatigue_points_points || 0) / 3 | 0);
			let mod = +v.fatigue_points_mod;
			setAttrs({
				fatigue_points_max: base + mod
			}, null, callback);
		});
	}
	
	// Perception
	on('change:intelligence change:perception_points change:perception_mod', function (e) {
		updatePer();
	});
	
	// Update Perception
	function updatePer(callback) {
		console.log('********* updatePer *********');
		callback = callback || noop;
		getAttrs(['intelligence', 'intelligence_base', 'perception_points', 'perception_mod'], function (v) {
			let base = (modCascade ? +v.intelligence : +v.intelligence_base) + ((+v.perception_points || 0) / 5 | 0);
			let mod = +v.perception_mod || 0;
			setAttrs({
				perception_base: base,
				perception: base + mod
			}, null, callback);
		});
	}
	
	// Vision, Hearing, Smell, Touch
	on('change:perception change:vision_points change:vision_mod change:hearing_points change:hearing_mod change:taste_smell_points change:taste_smell_mod change:touch_points change:touch_mod', function (e) {
		updateSense();
	});
	
	// Update Vision, Hearing, Smell, Touch
	function updateSense() {
		console.log('********* updateSense *********');
		getAttrs(['perception', 'perception_base', 'vision_points', 'vision_mod', 'hearing_points', 'hearing_mod', 'taste_smell_points', 'taste_smell_mod', 'touch_points', 'touch_mod'], function (v) {
			let base = (modCascade ? +v.perception : +v.perception_base);
			let visionBase = base + ((+v.vision_points || 0) / 2 | 0);
			let visionMod = +v.vision_mod || 0;
			let hearingBase = base + ((+v.hearing_points || 0) / 2 | 0);
			let hearingMod = +v.hearing_mod || 0;
			let tasteSmellBase = base + ((+v.taste_smell_points || 0) / 2 | 0);
			let tasteSmellMod = +v.taste_smell_mod || 0;
			let touchBase = base + ((+v.touch_points || 0) / 2 | 0);
			let touchMod = +v.touch_mod || 0;
			setAttrs({
				vision_base: visionBase,
				vision: visionBase + visionMod,
				hearing_base: hearingBase,
				hearing: hearingBase + hearingMod,
				taste_smell_base: tasteSmellBase,
				taste_smell: tasteSmellBase + tasteSmellMod,
				touch_base: touchBase,
				touch: touchBase + touchMod
			});
		});
	}
	
	// Updage Willpower, Fear (This is actually called Fright Check - the General page reflects this)
	on('change:intelligence change:willpower_points change:willpower_mod change:fear_check_points change:fear_check_mod change:combat_reflexes_fear_check_mod change:stress_level change:derangement_level', function (e) {
		updateWill();
	});
	
	// Updage Willpower, Fear (This is actually called Fright Check - the General page reflects this)
	function updateWill() {
		console.log('********* updateWill *********');
		getAttrs(['intelligence', 'intelligence_base', 'willpower_points', 'willpower_mod', 'fear_check_points', 'fear_check_mod', 'combat_reflexes_fear_check_mod', 'stress_level_modifier', 'derangement_level_modifier', 'stress_level', 'derangement_level'], function (v) {
			let wBase = (modCascade ? +v.intelligence : +v.intelligence_base) + ((+v.willpower_points || 0) / 5 | 0);
			let wMod = +v.willpower_mod || 0;
			let fBase = wBase + (modCascade ? +wMod : 0) + ((+v.fear_check_points || 0) / 2 | 0);
			let fMod = +v.fear_check_mod || 0;
			let combatFearCheckMod = +v.combat_reflexes_fear_check_mod || 0;
			let stressLevelModifier =  Number(v.stress_level_modifier) || 0;
			let derangementLevelModifier = Number(v.derangement_level_modifier) || 0;
			let stressLevel = Number(v.stress_level) || 0;
			let derangementLevel = Number(v.derangement_level) || 0;

			let stressDerangementPenalty = Math.ceil((stressLevel + derangementLevel)/2);

			setAttrs({
				willpower_base: wBase,
				willpower: wBase + wMod,
				fear_check_base: fBase,
				fear_check: fBase + fMod + combatFearCheckMod + stressDerangementPenalty,
				stress_level_max: (-1 * (wBase + wMod)) + stressLevelModifier,
				derangement_level_max: (-1 * (wBase + wMod)) + derangementLevelModifier,
				stress_derangement_fright_check_penalty: stressDerangementPenalty
			});

		});
	}

	// Check for conditions to HT and conditions
	on('change:health change:stun_check_mod change:knockdown_check_mod change:unconscious_check_mod change:unconscious_check_points change:death_check_mod change:death_check_points', function (e) {
		updateHealthConditionChecks();
	});
	
	// Update HT, update Stun, Knockdown, Unconscious, and Death Checks
	function updateHealthConditionChecks() {
		console.log('********* updateHealthConditionChecks *********');
		getAttrs(['health', 'health_base', 'stun_check_mod', 'knockdown_check_mod', 'unconscious_check_mod', 'unconscious_check_points', 'death_check_mod', 'death_check_points'], function (v) {
	
			let healthBase = (modCascade ? +v.health : +v.health_base);
	
			// stun
			let stunMod = +v.stun_check_mod || 0;
	
			let stunCheck = healthBase + stunMod;
	
			// knockdown	
			let knockDownMod = +v.knockdown_check_mod || 0;
	
			let knockDownCheck = healthBase + knockDownMod;
	
			// unconscious
			let unconsciousMod = +v.unconscious_check_mod || 0;
	
			let unconsciousCheck = healthBase + (modCascade ? +unconsciousMod : 0) + ((+v.unconscious_check_points || 0) / 2 | 0);
	
			// death
			let deathMod = +v.death_check_mod || 0;
	
			let deathCheck = healthBase + (modCascade ? +deathMod : 0) + ((+v.death_check_points || 0) / 2 | 0);
	
			setAttrs({
				stun_check: stunCheck,
				knockdown_check: knockDownCheck,
				unconscious_check: unconsciousCheck,
				death_check: deathCheck
			});
		});
	}
	
	
	
	// Speed
	on('change:dexterity change:health change:basic_speed_points change:basic_speed_mod', function (e) {
		updateBasicSpeed();
	});
	
	// Update Speed
	function updateBasicSpeed(callback) {
		console.log('********* updateBasicSpeed *********');
		callback = callback || noop;
		getAttrs(['dexterity', 'dexterity_base', 'health', 'health_base', 'basic_speed_points', 'basic_speed_mod'], function (v) {
			let dx = (modCascade ? +v.dexterity : +v.dexterity_base);
			let ht = (modCascade ? +v.health : +v.health_base);
			let base = (dx + ht) / 4 + (((+v.basic_speed_points || 0) / 5 | 0) * 0.25);
			let mod = +v.basic_speed_mod || 0;
			setAttrs({
				basic_speed_base: base,
				basic_speed: base + mod
			}, null, callback);
		});
	}
	
	// Move
	on('change:basic_speed change:basic_move_points change:basic_move_mod', function (e) {
		updateBasicMove();
	});
	
	// Update Move
	function updateBasicMove(callback) {
		console.log('********* updateBasicMove *********');
		callback = callback || noop;
		getAttrs(['basic_speed', 'basic_speed_base', 'basic_move_points', 'basic_move_mod'], function (v) {
			let speed = (modCascade ? +v.basic_speed : +v.basic_speed_base);
			let base = Math.floor(speed) + ((+v.basic_move_points || 0) / 5 | 0);
			let mod = +v.basic_move_mod || 0;
			setAttrs({
				basic_move_base: base,
				basic_move: base + mod
			}, null, callback);
		});
	}
	
	// Dodge
	on('change:basic_speed change:dodge_mod change:combat_reflexes_dodge_mod', function (e) {
		updateDodge();
	});
	
	// Update Dodge
	function updateDodge(callback) {
		console.log('********* updateDodge *********');
		callback = callback || noop;
		getAttrs(['basic_speed', 'basic_speed_base', 'dodge_mod', `combat_reflexes_dodge_mod`], function (v) {
			
			let speed = (modCascade ? +v.basic_speed : +v.basic_speed_base);
			let base = Math.floor(speed) + 3;
			let mod = +v.dodge_mod || 0;
			let combatReflexesDodgeMod = +v.combat_reflexes_dodge_mod || 0;
			
			setAttrs({
				dodge_base: base,
				dodge: base + mod + combatReflexesDodgeMod
			}, null, callback);
		});
	}
	
	// Encumbered/injured move and dodge
	on('change:encumbrance_level change:dodge change:basic_move change:hit_points change:fatigue_points', function (e) {
	
		updateMoveDodge();
	
	});
	
	// Update encumbered/injured move and dodge
	function updateMoveDodge(callback) {
	
		console.log('***** UPDATE MOVE/DODGE *****');
	
		callback = callback || noop;
	
		getAttrs(['encumbrance_level', 'dodge', 'basic_move', 'hit_points', 'hit_points_max', 'fatigue_points', 'fatigue_points_max', 'strength', 'dodge_mod'], function (v) {
	
			let dodge = +v.dodge;
	
			let move = +v.basic_move;
	
			let groundStep = 0;
	
			let hitPointsNotes = 0;
	
			let fatiguePointNotes = 0;
	
			let dodgeNotes = 0;
	
			let strengthDisplay = +v.strength;
	
			let strengthHalved = 0;

			if (v.encumbrance_level === 5) {
	
				dodge = 1;
	
				move = 1;
	
			} else {
	
				dodge = dodge - +v.encumbrance_level;
	
				// There is some math error when calculating Encumbrance which requires the modifier of 1.01 instead of 1 below
				move = Math.floor(+v.basic_move * (1.01 - (0.2 * +v.encumbrance_level)));
	
				dodge = dodge < 1 ? 1 : dodge;
	
				move = move < 1 ? 1 : move;
			}
			// check for reduced move for low hit points
			if (+v.hit_points < +v.hit_points_max / 3) {
	
				hitPointsNotes = 1;
	
				dodgeNotes = 1;
	
				dodge = Math.ceil(dodge / 2);
	
				move = Math.ceil(move / 2);
	
			}
	
			// check for reduced move for low fatigue points
			if (+v.fatigue_points < +v.fatigue_points_max / 3) {
	
				fatiguePointNotes = 1;
	
				dodgeNotes = 1;
	
				dodge = Math.ceil(dodge / 2);
	
				move = Math.ceil(move / 2);
	
				// reduce strength_display in half
				strengthDisplay = Math.ceil(strengthDisplay / 2);
	
				strengthHalved = 1;
	
			}
	
			// if both hit and fatigue were reduced, then change trigger to value
			if (hitPointsNotes === 1 && fatiguePointNotes == 1) {
	
				hitPointsNotes = 2;
	
				fatiguePointNotes = 2;
	
				dodgeNotes = 2;
	
			}
	
			groundStep = Math.ceil(move / 10);
	
			setAttrs({
				current_move: `${move} (${groundStep})`,
				current_ground_step: groundStep,
				current_dodge: dodge,
				hit_points_notes: hitPointsNotes,
				fatigue_points_notes: fatiguePointNotes,
				dodge_reduced_notes: dodgeNotes,
				strength_display: strengthDisplay,
				strength_halved: strengthHalved
			}, null, callback);
	
		});
	}
	
	// Lifting ST
	on('change:strength change:lift_st_points change:lift_st_mod change:apply_size_modifier change:use_metric', function (e) {
		updateLift();
	});
	
	// Update Lift
	function updateLift(callback) {
	
		console.log('********* updateLift *********');
	
		callback = callback || noop;
	
		getAttrs(['strength', 'strength_base', 'lift_st_points', 'lift_st_mod', 'size', 'apply_size_modifier', 'use_metric'], function (v) {
	
			let applySizeModifier = (v.apply_size_modifier == "1");
	
			let sizeModifier = Number(v.size) || 0;
	
			let characterPoints = Number(v.lift_st_points) || 0;
	
			let pointsPerLevel = getSizeModifierPointsPerLevel(applySizeModifier, sizeModifier, 3);
	
			let strengthModByCharacterPoints = Math.floor(characterPoints / pointsPerLevel);

			const calculatedCost = strengthModByCharacterPoints * pointsPerLevel;
	
			let isTooLarge = characterPoints - calculatedCost >= 1;
	
			let pointsNeededForStrength = 0;
	
			let showMessage = 0;
	
			if (applySizeModifier && sizeModifier > 0 && isTooLarge) {
	
				showMessage = 1;
	
				pointsNeededForStrength = Math.ceil(pointsPerLevel * strengthModByCharacterPoints);
	
			}
	
			let base = (modCascade ? +v.strength : +v.strength_base) + strengthModByCharacterPoints;
	
			let modded = base + +v.lift_st_mod;
	
			let basicLift = (modded * modded) / 5;
	
			let useMetricChecked = Number(v.use_metric);

			if (Number.isNaN(useMetricChecked)) {
				useMetricChecked = 0;
			}

			if (useMetricChecked) {
				// conver to a metric value
				basicLift = basicLift / metricWeightConversionMultiplier;
			}
	
			// rounding
			if (basicLift >= 10) {
	
				basicLift = Math.round(basicLift);
	
			} 
			
			setAttrs({
				lift_st_base: base,
				lift_st: modded,
				basic_lift: basicLift,
				basic_lift_x2: basicLift * 2,
				show_size_modifier_lifting_st_message: showMessage,
				size_modifier_cp_lifting_st_adjustment: pointsNeededForStrength,
				lifting_points_per_level: pointsPerLevel,
			}, null, callback);
	
		});
	}
	
	// Striking ST
	on('change:strength change:striking_st_points change:striking_st_mod change:apply_size_modifier', function (e) {
		updateStrikingST();
	});
	
	// Update Striking
	function updateStrikingST() {
	
		console.log('********* updateStrikingST *********');
	
		getAttrs(['strength', 'strength_base', 'striking_st_points', 'striking_st_mod', 'size', 'apply_size_modifier'], function (v) {
	
			let applySizeModifier = (v.apply_size_modifier == "1");
	
			let sizeModifier = Number(v.size) || 0;
	
			let characterPoints = Number(v.striking_st_points) || 0;
	
			let pointsPerLevel = getSizeModifierPointsPerLevel(applySizeModifier, sizeModifier, 5);
	
			let strengthModByCharacterPoints = Math.floor(characterPoints / pointsPerLevel);
	
			const calculatedCost = strengthModByCharacterPoints * pointsPerLevel;
	
			let isTooLarge = characterPoints - calculatedCost >= 1;
	
			let pointsNeededForStrength = 0;
	
			let showMessage = 0;
	
			if (applySizeModifier && sizeModifier > 0 && isTooLarge) {
	
				showMessage = 1;
	
				pointsNeededForStrength = Math.ceil(pointsPerLevel * strengthModByCharacterPoints);
	
			}
	
			let base = (modCascade ? +v.strength : +v.strength_base) + strengthModByCharacterPoints;
	
			let mod = +v.striking_st_mod;
	
			setAttrs({
				striking_st_base: base,
				striking_st: base + mod,
				show_size_modifier_striking_st_message: showMessage,
				size_modifier_cp_striking_st_adjustment: pointsNeededForStrength,
				striking_points_per_level: pointsPerLevel,
			});
	
		});
	}
	
	// Update the total cost of Languages
	on('change:native_language_spoken change:native_language_written change:repeating_languages:spoken_points change:repeating_languages:written_points remove:repeating_languages', function (e) {
		console.log('**** Languages Changed ****');
		let total = 0;
		let tally = _.after(2, function () {
			setAttrs({ languages_points: total });
		});
		getAttrs(['native_language_spoken', 'native_language_written'], function (v) {
			total += +v.native_language_spoken;
			total += +v.native_language_written;
			tally();
		});
		sumRepeating('repeating_languages', 'spoken_points', function (v) {
			total += +v;
			tally();
		});
		sumRepeating('repeating_languages', 'written_points', function (v) {
			total += +v;
			tally();
		});
	});

	// check for changes to repeating language drop-downs	
	on("change:repeating_languages:spoken change:repeating_languages:spoken_talent change:repeating_languages:spoken_mod_points change:repeating_languages:written change:repeating_languages:written_talent change:repeating_languages:written_mod_points", (event) => {

		const fields = [
			"has_language_talent",
			"repeating_languages_spoken",
			"repeating_languages_spoken_talent",
			"repeating_languages_spoken_mod_points",
			"repeating_languages_written",
			"repeating_languages_written_talent",
			"repeating_languages_written_mod_points",
		];

		getAttrs(fields, values => {

			const hasLanguageTalent = values.has_language_talent === "1";

			let spokenPoints = Number(values.repeating_languages_spoken);

			let spokenModPoints = Number(values.repeating_languages_spoken_mod_points);

			let writtenPoints = Number(values.repeating_languages_written);

			let writtenModPoints = Number(values.repeating_languages_written_mod_points);

			let totalPoints = 0;

			if (hasLanguageTalent) {

				spokenPoints = Number(values.repeating_languages_spoken_talent);

				writtenPoints = Number(values.repeating_languages_written_talent);
			}

			// factor in modifiers
			spokenPoints = spokenPoints + spokenModPoints;

			writtenPoints = writtenPoints + writtenModPoints;

			totalPoints = spokenPoints + writtenPoints;

			setAttrs({
				repeating_languages_spoken_points: spokenPoints,
				repeating_languages_written_points: writtenPoints
			});

		})

	});

	on("change:has_language_talent", (event) => {
		updateRepeatingLanguages();
	});

	/**
	 * Updates the spoken/written points based on the language talent checkbox
	 */
	function updateRepeatingLanguages() {

		// get all the rows for each language
		getSectionIDs("languages", ids => {

			// get the vaues for each row and then get the correct language points
			ids.forEach(id => {

				let fields = ["has_language_talent"];

				let spokenFieldName = `repeating_languages_${id}_spoken`;

				let spokenModPointsFieldName = `repeating_languages_${id}_spoken_mod_points`;

				let spokenTalentFieldName = `repeating_languages_${id}_spoken_talent`;

				let writtenFieldName = `repeating_languages_${id}_written`;

				let writtenModPointsFieldName = `repeating_languages_${id}_written_mod_points`;

				let writtenTalentFieldName = `repeating_languages_${id}_written_talent`;

				fields.push(spokenFieldName);

				fields.push(spokenModPointsFieldName);

				fields.push(spokenTalentFieldName);

				fields.push(writtenFieldName);

				fields.push(writtenModPointsFieldName);

				fields.push(writtenTalentFieldName);

				getAttrs(fields, values => {

					const hasLanguageTalent = values.has_language_talent === "1";

					let spokenPoints = Number(values[spokenFieldName]);

					let spokenModPoints = Number(values[spokenModPointsFieldName]);

					let writtenPoints = Number(values[writtenFieldName]);

					let writtenModPoints = Number(values[writtenModPointsFieldName]);

					let totalPoints = 0;

					if (hasLanguageTalent) {

						spokenPoints = Number(values[spokenTalentFieldName]);

						writtenPoints = Number(values[writtenTalentFieldName]);
					}

					totalPoints = spokenPoints + spokenModPoints + writtenPoints + writtenModPoints;

					// initialize an object to hold fields to update.
					const items = {};

					items[`repeating_languages_${id}_spoken_points`] = spokenPoints;

					items[`repeating_languages_${id}_written_points`] = writtenPoints;

					setAttrs(items);

				});

			});

		});

	}

	
	// Update the total cost of Cultural Familiarities
	on('change:repeating_cultures:points remove:repeating_cultures', function (e) {
		sumRepeating('repeating_cultures', 'points', function (v) {
			setAttrs({ cf_points: v });
		});
	});
	
	// Update the total cost of Advantages
	on('change:repeating_traits:points remove:repeating_traits', function (e) {
		sumRepeating('repeating_traits', 'points', function (v) {
			setAttrs({ advantages_points: v });
		});
	});
	
	// Update the total cost of Perks
	on('change:repeating_perks remove:repeating_perks', function (e) {
		sumRepeating('repeating_perks', 'points', function (v) {
			setAttrs({ advantages_perks: v });
		});
	});
	
	// Update the total cost of Disadvantages
	on('change:repeating_disadvantages:points remove:repeating_disadvantages', function (e) {
		sumRepeating('repeating_disadvantages', 'points', function (v) {
			setAttrs({ disadvantages_points: v });
		});
	});
	
	// Update the total cost of Quirks
	on('change:repeating_quirks remove:repeating_quirks', function (e) {
		sumRepeating('repeating_quirks', 'points', function (v) {
			setAttrs({ disadvantages_quirks: v });
		});
	});
	
	// Update the total cost of Racial Traits
	on('change:repeating_racial:points remove:repeating_racial', function (e) {
		sumRepeating('repeating_racial', 'points', function (v) {
			setAttrs({ racial_points: v });
		});
	});
	
	// if skill removed, update total skill points
	on('remove:repeating_skills', (event) => {
	
		sumRepeating('repeating_skills', 'points', function (v) {
			setAttrs({ skills_points: v }, { silent: true });
		});
	
	});
	
	// if spell level is updated, updated linked combat or techniques. 
	on("change:repeating_spells:level", event => {
	
		let rowId = getRowIdFromEventInfo(event, "repeating_spells");
	
		updateSectionSkillsLinkedToUpdatedRow(rowId);
	
	});
	
	// check for "new" spell row. Only able to check for changes to a value,
	// using "name" to check for a new row and the base="new"
	on("change:repeating_spells:name", event => {
	
		getAttrs(["repeating_spells_name", "repeating_spells_base", "spell_base", "spell_bonus", "spell_on_penalty_total", "spell_maintained_penalty_total", "spell_custom_modifier"], values => {
	
			if (values.repeating_spells_base === "new") {

				console.log("values", values);
	
				// if new, set the repeating base and bonus to the global spell_base drop-down and bonus
				setAttrs({
					repeating_spells_base: values.spell_base,
					repeating_spells_bonus: values.spell_bonus,
					repeating_spells_custom_modifier: values.spell_custom_modifier,
					repeating_spells_on_penalty: values.spell_on_penalty_total,
					repeating_spells_maintained_penalty: values.spell_maintained_penalty_total
				});
	
			}
	
		});
	
	});

	// check for user entering a resistance level
	// if entered AND rule of 16 is checked, set the max effective skill level
	on("change:repeating_spells:spell_resisted_by", event => {

		const hasResistanceValue = Boolean(event.newValue);

		getAttrs(["spell_roll_rule_of_16", "spell_rule_of_16_target_resistance"], values => {
	
			let maxEffectiveSkill = 100;

			let targetResistance = Number(values.spell_rule_of_16_target_resistance) ?? 10;

			if (values.spell_roll_rule_of_16 == "1" && hasResistanceValue) {
	
				if (targetResistance <= 16) {

					maxEffectiveSkill = 16;

				} else {

					maxEffectiveSkill = targetResistance;
				}

			}

			setAttrs({repeating_spells_rule_of_16_value: maxEffectiveSkill});
	
		});

	});

	// check if target resistance or rule of 16 option checkbox
	// update the spells that use rule of 16
	on("change:spell_roll_rule_of_16 change:spell_rule_of_16_target_resistance", event => {

		updateRuleSixteenForSpells();

	});

	const updateRuleSixteenForSpells = () => {

		const attribs = [
			"spell_roll_rule_of_16",
			"spell_rule_of_16_target_resistance"
		];

		getAttrs(attribs, values => {

			const useRule16 = values.spell_roll_rule_of_16 == "1";
			
			let targetResistance = Number(values.spell_rule_of_16_target_resistance) ?? 10;

			getSectionIDs('repeating_spells', ids => {

				const fieldNames = [];

				ids.forEach(id => fieldNames.push(`repeating_spells_${id}_spell_resisted_by`));
	
				getAttrs(fieldNames, values => {

					let fieldsToUpdate = {};

					ids.forEach(id => {

						// set the maxEffectiveSkill
						let maxEffectiveSkill = 100;

						const hasResistanceValue = Boolean(values[`repeating_spells_${id}_spell_resisted_by`]);

						if (useRule16 && hasResistanceValue) {

							if (targetResistance <= 16) {

								maxEffectiveSkill = 16;

							} else {

								maxEffectiveSkill = targetResistance;

							}

						}

						let fieldName = `repeating_spells_${id}_rule_of_16_value`;

						fieldsToUpdate[fieldName] = maxEffectiveSkill;

					});

					setAttrs(fieldsToUpdate);

				});

			});

		});

	}
	
	// Update the skill level and update the total cost of Skills 
	on('change:repeating_skills:base change:repeating_skills:difficulty change:repeating_skills:bonus change:repeating_skills:points change:repeating_skills:sync', (event) => {
	
		// check if this is a valid sync
		const isSync = String(event.sourceAttribute).endsWith("sync");
	
		if (isSync) {

			const attributeName = event.sourceAttribute;

			// if this a sync, then we need to check it's value. If it's 1 then we want to resync all the data
			getAttrs([attributeName], values => {

				const syncValue = Number(values[attributeName]);

				if (syncValue === 1) {
					updateRepeatingSkillValues();
				}

			});
			
		} else {

			updateRepeatingSkillValues();
		}
	
	});

	let updateRepeatingSkillValues = () => {

		let fieldValues = [
			"repeating_skills_name",	//for debugging
			"repeating_skills_base",
			"repeating_skills_difficulty",
			"repeating_skills_bonus",
			"repeating_skills_points",
			"strength",
			"dexterity",
			"intelligence",
			"health",
			"perception",
			"willpower"
		];
	
		getAttrs(fieldValues, (values) => {
	
			let baseLevel = getBaseSkillLevel(values.repeating_skills_base, values);
	
			let difficulty = Number(values.repeating_skills_difficulty);
	
			let bonus = Number(values.repeating_skills_bonus);
	
			let skill_points = Number(values.repeating_skills_points);
	
			let use_wildcard_points = 0;
	
			let use_normal_points = 0;
	
			let wildcard_skill_points = 0;
	
			// check for wildcard difficulty
			if (String(values.repeating_skills_difficulty) == "-5 + 1") {
	
				use_wildcard_points = 1;
	
				use_normal_points = 0;
	
				// minimum point cost is 3
				if (skill_points < 3) {
	
					wildcard_skill_points = 0;
	
				} else {
	
					wildcard_skill_points = Math.floor(skill_points / 3);
	
				}
	
				difficulty = -4;
	
			} else {
	
				use_wildcard_points = 0;
	
				use_normal_points = 1;
	
				wildcard_skill_points = Number(values.repeating_skills_points);
	
				difficulty = Number(difficulty);
	
			}
	
			let finalSkillLevel = getSkillLevelUsingRaw(baseLevel, difficulty, bonus, wildcard_skill_points, skill_points, use_normal_points);
	
			// make sure to reset the sync back to 0. see function updateSkillLevel()
			let fieldsToUpdate = {
				repeating_skills_wildcard_skill_points: wildcard_skill_points,
				repeating_skills_use_wildcard_points: use_wildcard_points,
				repeating_skills_use_normal_points: use_normal_points,
				repeating_skills_level: finalSkillLevel,
				repeating_skills_sync: 0
			};
	
			// if the skill level changes, this will trigger 
			// the change event to update items linked to that skill; see `on("change:repeating_skills:level")`
			setAttrs(fieldsToUpdate
				, null
				, sumRepeating('repeating_skills', 'points', function (v) {
					setAttrs({ skills_points: v });
				})
			);
	
		});

	}
	
	on("change:repeating_skills:level", (event) => {
	
		const rowId = getRowIdFromEventInfo(event, "repeating_skills");
	
		updateSectionSkillsLinkedToUpdatedRow(rowId);
	
	});
	
	// keep "spell based on:" and "Magery/PI/Bonus Level" synced with repeating fields
	// this avoids having to do a lot of coding to get the id of the row
	// NOTE: this will trigger updating the spell level. 
	on("change:spell_base change:spell_bonus change:spell_custom_modifier change:spell_on_penalty_total change:spell_maintained_penalty_total", event => {
	
		syncModsToRepeatingSpells(false);
	
	});
	
	// Update the spell level and update the total cost of spells 
	on('change:repeating_spells:base change:repeating_spells:bonus change:repeating_spells:custom_modifier change:repeating_spells:on_penalty change:repeating_spells:maintained_penalty change:repeating_spells:difficulty change:repeating_spells:spell_modifier change:repeating_spells:points change:repeating_spells:sync', (event) => {
	
		// check if this is a valid sync
		const isSync = String(event.sourceAttribute).endsWith("sync");
	
		if (isSync) {

			const attributeName = event.sourceAttribute;

			// if this a sync, then we need to check it's value. If it's 1 then we want to resync all the data
			getAttrs([attributeName], values => {

				const syncValue = Number(values[attributeName]);

				if (syncValue === 1) {
					updateRepeatingSpellValues();
				}

			});

		} else {

			updateRepeatingSpellValues();
		}
	
	});

	let updateRepeatingSpellValues = () => {

		let fieldValues = [
			"repeating_spells_base",
			"repeating_spells_bonus",
			"repeating_spells_custom_modifier",
			"repeating_spells_on_penalty",
			"repeating_spells_maintained_penalty",
			"repeating_spells_difficulty",
			"repeating_spells_spell_modifier",
			"repeating_spells_points",
			"strength",
			"dexterity",
			"intelligence",
			"health",
			"perception",
			"willpower"
		];
	
		getAttrs(fieldValues, (values) => {
	
			const baseLevel = getBaseSkillLevel(values.repeating_spells_base, values);
	
			let difficulty = Number(values.repeating_spells_difficulty);
	
			const bonus = Number(values.repeating_spells_bonus);

			const customMod = Number(values.repeating_spells_custom_modifier);

			const onPenalty = Number(values.repeating_spells_on_penalty);

			const maintainedPenalty = Number(values.repeating_spells_maintained_penalty);
	
			const modifier = Number(values.repeating_spells_spell_modifier);
	
			let totalModifier = bonus + modifier + customMod + onPenalty + maintainedPenalty;
	
			if (isNaN(totalModifier)) {
				totalModifier = 0;
			}
	
			const skill_points = Number(values.repeating_spells_points);
	
			const finalSkillLevel = getSkillLevelUsingRaw(baseLevel, difficulty, totalModifier, 0, skill_points, 1);
	
			// make sure to reset the sync back to 0. see function updateSkillLevel()
			const fieldsToUpdate = {
				repeating_spells_level: finalSkillLevel,
				repeating_spells_sync: 0,
			};
	
			// if the skill level changes, this will trigger 
			// the change event to update items linked to that skill; see `on("change:repeating_skills:level")`
			setAttrs(fieldsToUpdate
				, null
				, sumRepeating('repeating_spells', 'points', function (v) {
					setAttrs({ spells_points: v });
				})
			);
	
		});

	}
	
	// if toggle is clicked, update the display id.
	// event = {sourceAttribute, sourceType, triggerName, sourceAttribute, previousValue, newValue}
	on("change:repeating_spells:spell_toggle_notes change:repeating_skills:skill_toggle_notes change:repeating_techniquesrevised:technique_revised_toggle_notes change:repeating_melee:melee_toggle_notes change:repeating_item:item_toggle_notes", event => {
	
		if (event.triggerName) {

			let row = event.triggerName;
	
			let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
			switch (section) {
				case "repeating_spells":
					updateRowIdDisplay(section, rowId);
					break;
		
				case "repeating_skills":
					updateRowIdDisplay(section, rowId);
					break;
		
				case "repeating_techniquesrevised":
					updateRowIdDisplay(section, rowId);
					break;
		
				case "repeating_melee":
					updateRowIdDisplay(section, rowId);
					break;

				case "repeating_item":
					updateRowIdDisplay(section, rowId);
					break;
			}
		}
		
	});
	
	/**
	 * Updates the display row id for a repeating section
	 * 
	 * @param {string}      section  Repeating section name
	 * @param {string}      rowId    Row id of repeating section
	 * @param {() => void=} callback function Optional callback function
	 */
	function updateRowIdDisplay(section, rowId, callback) {
	
		// check for optional callback function
		callback = callback || noop;
	
		// initialize an object to hold fields to update.
		const items = {};
	
		// set the field value
		items[`${section}_${rowId}_row_id`] = rowId;
	
		// update the field values
		setAttrs(items, { silent: true }, callback);
	
	}
	
	// Update the total cost of Techniques
	on('change:repeating_techniques:points remove:repeating_techniques', function (e) {
		sumRepeating('repeating_techniques', 'points', function (v) {
			setAttrs({ techniques_points: v }, { silent: true });
		});
	});
	
	// Update the total cost of Techniques revised
	on('change:repeating_techniquesrevised:points remove:repeating_techniquesrevised', function (e) {
		sumRepeating('repeating_techniquesrevised', 'points', function (v) {
			setAttrs({ techniques_revised_points: v }, { silent: true });
		});
	});
	
	// Update the total cost of Spells
	on('remove:repeating_spells', function (e) {
		sumRepeating('repeating_spells', 'points', function (v) {
			setAttrs({ spells_points: v }, { silent: true });
		});
	});

	// check for user metric
	on("change:use_metric", event => {

		let useMetricChecked = Number(event.newValue);

		if (Number.isNaN(useMetricChecked)) {
			useMetricChecked = 0;
		}

		let weightSystem = "lbs";

		if (useMetricChecked) {
			weightSystem = "kg";
		}

		setAttrs({
			weight_system: weightSystem
		});
		
	});
	
	// Update the line total weight and cost
	on('change:repeating_item:count change:repeating_item:cost change:repeating_item:carried change:repeating_item:weight', function (e) {
		getAttrs(['repeating_item_count', 'repeating_item_cost', 'repeating_item_weight', 'repeating_item_carried'], function (item) {
			setAttrs({
				repeating_item_weighttotal: Number(Math.round(item.repeating_item_count * item.repeating_item_weight * item.repeating_item_carried * 1000) / 1000).toFixed(3),
				repeating_item_costtotal: Number(Math.round(item.repeating_item_count * item.repeating_item_cost * 100) / 100).toFixed(2)
			});
		});
	});
	

	// check to see if the inventory item parent name changed
	// update any children's location
	on("change:repeating_item:name", event => {

		let updatedRowId = getRowIdFromEventInfo(event, "repeating_item");

		let newParentName = event.newValue ?? "";

		updateInventoryItemChildLocations(updatedRowId, newParentName);


	});

	/**
	 * Update the location name of children if a parent name changed.
	 * 
	 */
	function updateInventoryItemChildLocations(updatedRowId, newParentName) {

		getSectionIDs("item", (ids) => {

			if (ids.length === 0) return;

			let fieldArray = [];

			ids.forEach(id => fieldArray.push(
				`repeating_item_${id}_parent_id`
			));

			let doUpdate = false;

			getAttrs(fieldArray, (values) => {

				let items = {};

				ids.forEach(id => {

					const parentFieldName = `repeating_item_${id}_parent_id`;

					const locationFieldName = `repeating_item_${id}_location`;

					if (values[parentFieldName] === updatedRowId) {

						doUpdate = true;

						items[locationFieldName] = newParentName;	
					}

				});

				if (doUpdate) {
					setAttrs(items);
				}
				
			});

		});

	}

	// Update the total weight of all carried items.
	on('change:repeating_item:weighttotal remove:repeating_item', function (e) {

		let removeTrigger = e.triggerName ?? "";

		if (removeTrigger === "remove:repeating_item") {

			let deletedRowId = getRowIdFromEventInfo(e, "repeating_item");

			clearInventoryParentValueFromChildren(deletedRowId, sumInventory);

		} else {

			sumInventory();

		}
		
	});

	/**
	 * If a item was deleted, we have to make sure any children related to that 
	 * item parent item has it's parent_id value cleared. fixing orphaned child items.
	 */
	function clearInventoryParentValueFromChildren(deletedRowId, callback) {

		callback = callback || noop;

		getSectionIDs("item", (ids) => {

			if (ids.length === 0) return;

			let fieldArray = [];

			ids.forEach(id => fieldArray.push(
				`repeating_item_${id}_parent_id`
			));

			getAttrs(fieldArray, (values) => {

				let items = {};

				let doUpdate = false;

				ids.forEach(id => {

					const parentFieldName = `repeating_item_${id}_parent_id`;

					const locationFieldName = `repeating_item_${id}_location`;

					if (values[parentFieldName] === deletedRowId) {

						// clear the parent id
						items[parentFieldName] = "";

						items[locationFieldName] = "";	
					}

				});

				if (doUpdate) {
					setAttrs(items, null, callback);
				}
				
			});

		});

	}

	function sumInventory() {

		sumRepeating('repeating_item', 'weighttotal', function (v) {
			setAttrs({ total_weight: Number(Math.round(v * 1000) / 1000).toFixed(3) });
		});

	}
	
	// Update the line Format for existing inventory weight and cost - Script provided by GiGs ID:157788 (Roll20)
	on('change:inventory_fixed_digits', function () {
	
		// getSectionIDs gives an array of all the row ids.
		getSectionIDs('item', function (ids) {
			if (ids.length === 0) return;
			// need to get an array of all the attributes used in the repeating_items calculations, for getAttrs
			let fieldArray = [];
			ids.forEach(id => fieldArray.push(
				`repeating_item_${id}_count`, `repeating_item_${id}_cost`, `repeating_item_${id}_weight`, `repeating_item_${id}_carried`
			));
			getAttrs(fieldArray, function (item) {
				let items = {}; // initialize an object to hold the total weights and costs.
				ids.forEach(id => {
					// for each row of the table, calculate the total weight and cost
					let weight = (+item[`repeating_item_${id}_count`] || 0) * (+item[`repeating_item_${id}_weight`] || 0) * (+item[`repeating_item_${id}_carried`] || 0);
					let cost = (+item[`repeating_item_${id}_count`] || 0) * (+item[`repeating_item_${id}_cost`] || 0);
					// save the totals, in the correct format 
					items[`repeating_item_${id}_weighttotal`] = Number(Math.round(weight * 1000) / 1000).toFixed(3);
					items[`repeating_item_${id}_costtotal`] = Number(Math.round(cost * 100) / 100).toFixed(2);
				});
				setAttrs(items);
			});
		});
	});
	
	// Get Encumbrance Level:
	on('change:total_weight change:weight change:basic_lift change:gravity change:use_metric', function (e) {
		updateEncLevel();
	});
	
	// factor in gravity difference
	function updateEncLevel(callback) {
	
		getAttrs(['basic_lift', 'total_weight', 'gravity', 'weight', 'weight_system'], function (v) {
	
			callback = callback || noop;
	
			let basicLift = Number(v.basic_lift);
	
			let totalWeight = Number(v.total_weight);
	
			let totalGravityWeight = totalWeight;
	
			let totalGravityWeightDisplay = "";
	
			let gravity = Number(v.gravity);
	
			let characterWeight = Number(v.weight);

			let weightSystem = String(v.weight_system);

			// don't factor in grand total weight
			let grandTotalWeight = characterWeight + totalWeight;
	
			// round to three decimal places
			grandTotalWeight = Math.round(grandTotalWeight * 1000) / 1000;

			const grandTotalWeightDisplay = grandTotalWeight.toFixed(2) + " " + weightSystem;
	
			if (gravity < 1) {
	
				totalGravityWeight = totalWeight * gravity;
	
			} else if (gravity > 1) {
	
				let gravityMod = (totalWeight + characterWeight) * (gravity - 1);
	
				totalGravityWeight = totalWeight + gravityMod;
	
			}
			
			totalGravityWeightDisplay = Number(Math.round(totalGravityWeight * 1000) / 1000).toFixed(2) + " " + weightSystem;
	
			let encumbranceLevel = Math.floor(totalGravityWeight / basicLift);
	
			if (encumbranceLevel > 0 && (totalGravityWeight % basicLift) === 0) {
				encumbranceLevel--;
			}
	
			if (encumbranceLevel >= 10) {
				encumbranceLevel = 4;
			} else if (encumbranceLevel >= 6) {
				encumbranceLevel = 4;
			} else if (encumbranceLevel >= 3) {
				encumbranceLevel = 3;
			}
	
			setAttrs({
				encumbrance_level: encumbranceLevel,
				total_weight_gravity: totalGravityWeightDisplay,
				grand_total_weight: grandTotalWeight,
				grand_total_weight_display: grandTotalWeightDisplay
			},
				null,
				callback
			);
	
		});
	}
	
	// Update the total cost of all items.
	on('change:repeating_item:costtotal remove:repeating_item', function (e) {
		sumRepeating('repeating_item', 'costtotal', function (v) {
			setAttrs({ total_value: Number((v * 100) / 100).toFixed(2) }, { silent: true });
		});
	});
	
	// Update thrust and swing when striking st is updated
	on('change:striking_st', function (e) {
	
		updateStrikingStrengthDamage();
	
	});
	
	/**
	 * Get the striking ST value and then get the damage type
	 * update Thrust and Swing
	 */
	function updateStrikingStrengthDamage(callback) {
	
		console.log("******** updateStrikingStrengthDamage ********");
	
		// get striking strength
		getAttrs(['striking_st'], function (values) {
	
			callback = callback || noop;
	
			// + means to convert variable to number
			let strikingST = +values.striking_st;
	
			// get the damageType object (strength, thrust, swing)
			let damageType = getDamageType(strikingST);
	
			// set thrust and swing
			setAttrs({
				thrust: damageType.thrust,
				swing: damageType.swing
			}, null, callback);
	
		});
	
	}
	
	/**
	 * Returns the damage type object 
	 * based on ST
	 * damageType {strength, thrust, swing}
	 *
	 * @param {number} strikingST ST of attack
	 *
	 * @returns {object}
	 */
	function getDamageType(strikingST) {
	
		// return value
		let damageType = null;
	
		let modifier = 0;
	
		let baseThrust = 11;
	
		let baseSwing = 13;
	
		// prevent bad ST from causing issue
		if (isNaN(strikingST) || strikingST < 0) {
			strikingST = 1;
		}
	
		if (strikingST <= 100) {
	
			// get damageType from table
			damageType = damageTable[strikingST];
	
		} else {
	
			// calculate the total 
			// Add 1d6 to thrust and swing for every full 10 points over 100
			modifier = Math.floor((strikingST - 100) / 10);
	
			baseThrust = baseThrust + modifier;
	
			baseSwing = baseSwing + modifier;
	
			damageType = { strength: strikingST, thrust: baseThrust + "d6", swing: baseSwing + "d6" };
	
		}
	
		return damageType;
	}
	
	/**
	 * Populates the global variable damageTable
	 */
	function generateDamageTable() {
	
		let damageTable = [];
	
		damageTable[0] = { strength: "0", thrust: "1d6-6", swing: "1d6-6" };
		damageTable[1] = { strength: "1", thrust: "1d6-6", swing: "1d6-5" };
		damageTable[2] = { strength: "2", thrust: "1d6-6", swing: "1d6-5" };
		damageTable[3] = { strength: "3", thrust: "1d6-5", swing: "1d6-4" };
		damageTable[4] = { strength: "4", thrust: "1d6-5", swing: "1d6-4" };
		damageTable[5] = { strength: "5", thrust: "1d6-4", swing: "1d6-3" };
		damageTable[6] = { strength: "6", thrust: "1d6-4", swing: "1d6-3" };
		damageTable[7] = { strength: "7", thrust: "1d6-3", swing: "1d6-2" };
		damageTable[8] = { strength: "8", thrust: "1d6-3", swing: "1d6-2" };
		damageTable[9] = { strength: "9", thrust: "1d6-2", swing: "1d6-1" };
		damageTable[10] = { strength: "10", thrust: "1d6-2", swing: "1d6" };
		damageTable[11] = { strength: "11", thrust: "1d6-1", swing: "1d6+1" };
		damageTable[12] = { strength: "12", thrust: "1d6-1", swing: "1d6+2" };
		damageTable[13] = { strength: "13", thrust: "1d6", swing: "2d6-1" };
		damageTable[14] = { strength: "14", thrust: "1d6", swing: "2d6" };
		damageTable[15] = { strength: "15", thrust: "1d6+1", swing: "2d6+1" };
		damageTable[16] = { strength: "16", thrust: "1d6+1", swing: "2d6+2" };
		damageTable[17] = { strength: "17", thrust: "1d6+2", swing: "3d6-1" };
		damageTable[18] = { strength: "18", thrust: "1d6+2", swing: "3d6" };
		damageTable[19] = { strength: "19", thrust: "2d6-1", swing: "3d6+1" };
		damageTable[20] = { strength: "20", thrust: "2d6-1", swing: "3d6+2" };
		damageTable[21] = { strength: "21", thrust: "2d6", swing: "4d6-1" };
		damageTable[22] = { strength: "22", thrust: "2d6", swing: "4d6" };
		damageTable[23] = { strength: "23", thrust: "2d6+1", swing: "4d6+1" };
		damageTable[24] = { strength: "24", thrust: "2d6+1", swing: "4d6+2" };
		damageTable[25] = { strength: "25", thrust: "2d6+2", swing: "5d6-1" };
		damageTable[26] = { strength: "26", thrust: "2d6+2", swing: "5d6" };
		damageTable[27] = { strength: "27", thrust: "3d6-1", swing: "5d6+1" };
		damageTable[28] = { strength: "28", thrust: "3d6-1", swing: "5d6+1" };
		damageTable[29] = { strength: "29", thrust: "3d6", swing: "5d6+2" };
		damageTable[30] = { strength: "30", thrust: "3d6", swing: "5d6+2" };
		damageTable[31] = { strength: "31", thrust: "3d6+1", swing: "6d6-1" };
		damageTable[32] = { strength: "32", thrust: "3d6+1", swing: "6d6-1" };
		damageTable[33] = { strength: "33", thrust: "3d6+2", swing: "6d6" };
		damageTable[34] = { strength: "34", thrust: "3d6+2", swing: "6d6" };
		damageTable[35] = { strength: "35", thrust: "4d6-1", swing: "6d6+1" };
		damageTable[36] = { strength: "36", thrust: "4d6-1", swing: "6d6+1" };
		damageTable[37] = { strength: "37", thrust: "4d6", swing: "6d6+2" };
		damageTable[38] = { strength: "38", thrust: "4d6", swing: "6d6+2" };
		damageTable[39] = { strength: "39", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[40] = { strength: "40", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[41] = { strength: "41", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[42] = { strength: "42", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[43] = { strength: "43", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[44] = { strength: "44", thrust: "4d6+1", swing: "7d6-1" };
		damageTable[45] = { strength: "45", thrust: "5d6", swing: "7d6+1" };
		damageTable[46] = { strength: "46", thrust: "5d6", swing: "7d6+1" };
		damageTable[47] = { strength: "47", thrust: "5d6", swing: "7d6+1" };
		damageTable[48] = { strength: "48", thrust: "5d6", swing: "7d6+1" };
		damageTable[49] = { strength: "49", thrust: "5d6", swing: "7d6+1" };
		damageTable[50] = { strength: "50", thrust: "5d6+2", swing: "8d6-1" };
		damageTable[51] = { strength: "51", thrust: "5d6+2", swing: "8d6-1" };
		damageTable[52] = { strength: "52", thrust: "5d6+2", swing: "8d6-1" };
		damageTable[53] = { strength: "53", thrust: "5d6+2", swing: "8d6-1" };
		damageTable[54] = { strength: "54", thrust: "5d6+2", swing: "8d6-1" };
		damageTable[55] = { strength: "55", thrust: "6d6", swing: "8d6+1" };
		damageTable[56] = { strength: "56", thrust: "6d6", swing: "8d6+1" };
		damageTable[57] = { strength: "57", thrust: "6d6", swing: "8d6+1" };
		damageTable[58] = { strength: "58", thrust: "6d6", swing: "8d6+1" };
		damageTable[59] = { strength: "59", thrust: "6d6", swing: "8d6+1" };
		damageTable[60] = { strength: "60", thrust: "7d6-1", swing: "9d6" };
		damageTable[61] = { strength: "61", thrust: "7d6-1", swing: "9d6" };
		damageTable[62] = { strength: "62", thrust: "7d6-1", swing: "9d6" };
		damageTable[63] = { strength: "63", thrust: "7d6-1", swing: "9d6" };
		damageTable[64] = { strength: "64", thrust: "7d6-1", swing: "9d6" };
		damageTable[65] = { strength: "65", thrust: "7d6+1", swing: "9d6+2" };
		damageTable[66] = { strength: "66", thrust: "7d6+1", swing: "9d6+2" };
		damageTable[67] = { strength: "67", thrust: "7d6+1", swing: "9d6+2" };
		damageTable[68] = { strength: "68", thrust: "7d6+1", swing: "9d6+2" };
		damageTable[69] = { strength: "69", thrust: "7d6+1", swing: "9d6+2" };
		damageTable[70] = { strength: "70", thrust: "8d6", swing: "10d6" };
		damageTable[71] = { strength: "71", thrust: "8d6", swing: "10d6" };
		damageTable[72] = { strength: "72", thrust: "8d6", swing: "10d6" };
		damageTable[73] = { strength: "73", thrust: "8d6", swing: "10d6" };
		damageTable[74] = { strength: "74", thrust: "8d6", swing: "10d6" };
		damageTable[75] = { strength: "75", thrust: "8d6+2", swing: "10d6+2" };
		damageTable[76] = { strength: "76", thrust: "8d6+2", swing: "10d6+2" };
		damageTable[77] = { strength: "77", thrust: "8d6+2", swing: "10d6+2" };
		damageTable[78] = { strength: "78", thrust: "8d6+2", swing: "10d6+2" };
		damageTable[79] = { strength: "79", thrust: "8d6+2", swing: "10d6+2" };
		damageTable[80] = { strength: "80", thrust: "9d6", swing: "11d6" };
		damageTable[81] = { strength: "81", thrust: "9d6", swing: "11d6" };
		damageTable[82] = { strength: "82", thrust: "9d6", swing: "11d6" };
		damageTable[83] = { strength: "83", thrust: "9d6", swing: "11d6" };
		damageTable[84] = { strength: "84", thrust: "9d6", swing: "11d6" };
		damageTable[85] = { strength: "85", thrust: "9d6+2", swing: "11d6+2" };
		damageTable[86] = { strength: "86", thrust: "9d6+2", swing: "11d6+2" };
		damageTable[87] = { strength: "87", thrust: "9d6+2", swing: "11d6+2" };
		damageTable[88] = { strength: "88", thrust: "9d6+2", swing: "11d6+2" };
		damageTable[89] = { strength: "89", thrust: "9d6+2", swing: "11d6+2" };
		damageTable[90] = { strength: "90", thrust: "10d6", swing: "12d6" };
		damageTable[91] = { strength: "91", thrust: "10d6", swing: "12d6" };
		damageTable[92] = { strength: "92", thrust: "10d6", swing: "12d6" };
		damageTable[93] = { strength: "93", thrust: "10d6", swing: "12d6" };
		damageTable[94] = { strength: "94", thrust: "10d6", swing: "12d6" };
		damageTable[95] = { strength: "95", thrust: "10d6+2", swing: "12d6+2" };
		damageTable[96] = { strength: "96", thrust: "10d6+2", swing: "12d6+2" };
		damageTable[97] = { strength: "97", thrust: "10d6+2", swing: "12d6+2" };
		damageTable[98] = { strength: "98", thrust: "10d6+2", swing: "12d6+2" };
		damageTable[99] = { strength: "99", thrust: "10d6+2", swing: "12d6+2" };
		damageTable[100] = { strength: "100", thrust: "11d6", swing: "13d6" };
	
		return damageTable;
	
	}
	
	// check for combat reflexes toggle box
	on('change:combat_reflexes', function (e) {
	
		updateActiveDefenses(updateRepeatingDefensesWithCombatReflexes());
	
	});
	
	/**
	* Get combat reflexes. Update active defenses
	*/
	function updateActiveDefenses(callback) {
	
		// get the defense values
		getAttrs(['combat_reflexes'], function (values) {
	
			callback = callback || noop;
	
			// + means to convert variable to number
			let chkCombatReflexes = Number(values.combat_reflexes);
	
			let modDodge = 0;
	
			let modFear = 0;
	
			if (chkCombatReflexes == 1) {
	
				modDodge = 1;
	
				modFear = 2;
	
			}

			// set the combat reflex fields for dodge and fear check
			setAttrs({
				combat_reflexes_dodge_mod: modDodge,
				combat_reflexes_fear_check_mod: modFear
			}, null, callback);
	
		});
	
	}
	
	function updateRepeatingDefensesWithCombatReflexes() {
	
		getAttrs(["combat_reflexes"], values => {
	
			const useCombatReflexes = values.combat_reflexes === "1";
	
			getSectionIDs("repeating_defense", ids => {
	
				let fields = {};

				ids.forEach(id => {
					
					// checkbox
					fields[`repeating_defense_${id}_defense_combat_reflexes`] = useCombatReflexes ? "1" : "";

					// value to use on final defensive skill level. 
					fields[`repeating_defense_${id}_defense_combat_reflexes_bonus`] = useCombatReflexes ? "1" : "0";
	
				});

				setAttrs(fields);
	
			});
	
		});
	
	}
	
	// check for manual or calculated option
	on("change:use_unspent_box", function (e) {
	
		updateToggleUnspentCheckBox();
	
	});
	
	/**
	 * Updates the hidden toggle_unspent_points. Used by 
	 * css to show/hide unspent boxes
	 * see: gurps.css -> input.toggle-unspoint-points[value="1"]
	 * 
	 */
	function updateToggleUnspentCheckBox() {
	
		getAttrs(['use_unspent_box'], function (values) {
	
			setAttrs({
				toggle_unspent_points: values.use_unspent_box
			});
	
		});
	
	}
	
	// check for selected damage dice change
	on("change:damage_dice_type", function (e) {
	
		updateDiceDamageIcons();
	
	});
	
	/**
	 * Controller function to update each section of 
	 * damage dice icons
	 */
	function updateDiceDamageIcons() {
	
		updateThrustSwingDamageIcons();
	
		updateRepeatingDamageDice("repeating_melee");
	
		updateRepeatingDamageDice("repeating_ranged");
	
	}
	
	/**
	 * Update the Thrust and Swing Damage Icons
	 * on the general tab by setting the hidden inputs
	 */
	function updateThrustSwingDamageIcons() {
	
		getAttrs(['damage_dice_type'], function (values) {
	
			setAttrs({
				thrust_damage_dice_icon: values.damage_dice_type,
				swing_damage_dice_icon: values.damage_dice_type
			});
	
		});
	
	}
	
	/**
	 * Gets the repeating sections ids. loop through 
	 * each id, must use getAttrs() inside the loop, 
	 * then set the hidden input for dice damage icon
	 * 
	 * @param {string} sectionID Repeating section id
	 */
	function updateRepeatingDamageDice(sectionID) {
	
		// get all the ids for each repeating section
		getSectionIDs(sectionID, function (ids) {
	
			// loop though each ids using underscores
			// see: https://underscorejs.org/#each 
			_.each(ids, function (id) {
	
				getAttrs(['damage_dice_type'], function (values) {
	
					// set the hidden input attribute
					setAttrs({
						[sectionID + "_" + id + "_damage_dice_icon"]: values.damage_dice_type
					});
	
				});
	
			});
	
		});
	
	}
	
	// check to see if ground move mod or move points changed
	on("change:enhanced_ground_move_mod change:enhanced_ground_move_points change:basic_move change:encumbrance_level change:hit_points change:fatigue_points", function (e) {
	
		updateEnhancedMove();
	
	});
	
	/**
	 * Get the attributes for enhanced ground move modifier and points spent
	 * Update the fields for ground multiple and ground move based on mod and points
	 */
	function updateEnhancedMove() {
	
		console.log('***** UPDATE ENHANCED MOVE *****');
	
		getAttrs(["enhanced_ground_move_mod", "enhanced_ground_move_points", "basic_move", "encumbrance_level", "hit_points", "hit_points_max", "fatigue_points", "fatigue_points_max"], function (values) {
	
			// + sign converts value to a number
			let groundModifier = +values.enhanced_ground_move_mod;
	
			let groundPoints = +values.enhanced_ground_move_points;
	
			let groundModifierFromPoints = 0;
	
			let totalModifier = 0;
	
			let basicMove = +values.basic_move;
	
			let enhancedMove = 0;

			let encumberanceLevel = +values.encumbrance_level;
	
			// encumbrance levels
			let enhancedMove0 = "";
	
			let enhancedMove1 = "";
	
			let enhancedMove2 = "";
	
			let enhancedMove3 = "";
	
			let enhancedMove4 = "";
	
			let enhancedMove5 = "";
	
			let encumberedEnhancedMove1 = 0;
	
			let encumberedEnhancedMove2 = 0;
	
			let encumberedEnhancedMove3 = 0;
	
			let encumberedEnhancedMove4 = 0;
	
			// current speed based on encumbrance and pain/fatigue
			let currentEnhancedMove = "";
	
			let injuryFatigueMoveModifier = 1;
	
			let step = 0;
	
			let baseGroundMove = 0;
	
			// validate groundModifer
			if (groundModifier < 0) {
				groundModifier = 0;
			}
	
			// make sure groundModifier is multiple of .5
			// https://stackoverflow.com/questions/25209849/javascript-round-up-to-nearest-5 
			groundModifier = Math.ceil(groundModifier * 2) / 2;
	
			// validate groundPoints
			if (groundPoints < 0) {
				groundPoints = 0;
			}
	
			// make sure groundPoints is multiple of 10
			// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
			groundPoints = Math.ceil(groundPoints / 10) * 10;
	
			groundModifierFromPoints = groundPoints / 20;
	
			totalModifier = groundModifier + groundModifierFromPoints;
	
			enhancedMove = getEnhancedValue(basicMove, totalModifier);
	
			if (totalModifier == 0) {

				let encumberanceMove = getEncumberedMove(basicMove, encumberanceLevel);
	
				let sprint = Math.floor(encumberanceMove * 1.2);

				enhancedMove0 = "";
	
				enhancedMove1 = "";
	
				enhancedMove2 = "";
	
				enhancedMove3 = "";
	
				enhancedMove4 = "";
	
				enhancedMove5 = "";
	
				currentEnhancedMove = `Sprint ${sprint}`;
	
			} else {
	
				enhancedMove0 = basicMove + "/" + enhancedMove;
	
				const move1 = getEncumberedMove(basicMove, 1);
				encumberedEnhancedMove1 = getEncumberedMove(enhancedMove, 1);
				enhancedMove1 = move1 + "/" + encumberedEnhancedMove1;
	
				const move2 = getEncumberedMove(basicMove, 2);
				encumberedEnhancedMove2 = getEncumberedMove(enhancedMove, 2);
				enhancedMove2 = move2 + "/" + encumberedEnhancedMove2;
	
				const move3 = getEncumberedMove(basicMove, 3);
				encumberedEnhancedMove3 = getEncumberedMove(enhancedMove, 3);
				enhancedMove3 = move3 + "/" + encumberedEnhancedMove3;
	
				const move4 = getEncumberedMove(basicMove, 4);
				encumberedEnhancedMove4 = getEncumberedMove(enhancedMove, 4);
				enhancedMove4 = move4 + "/" + encumberedEnhancedMove4;
	
				enhancedMove5 = enhancedMove4;
	
				// check for half move
				injuryFatigueMoveModifier = getInjuryFatigueModifier(values.hit_points, values.hit_points_max, values.fatigue_points, values.fatigue_points_max);
	
				// determine the current encumbrance move
				switch (Number(values.encumbrance_level)) {
	
					case 0:
						baseGroundMove = Math.floor(+basicMove * injuryFatigueMoveModifier);
						step = Math.ceil(baseGroundMove / 10)
						currentEnhancedMove = baseGroundMove + "/" + Math.floor(+enhancedMove * injuryFatigueMoveModifier);
						break;
	
					case 1:
						baseGroundMove = Math.floor(+move1 * injuryFatigueMoveModifier);
						step = Math.ceil(baseGroundMove / 10)
						currentEnhancedMove = baseGroundMove + "/" + Math.floor(+encumberedEnhancedMove1 * injuryFatigueMoveModifier);
						break;
	
					case 2:
						baseGroundMove = Math.floor(+move2 * injuryFatigueMoveModifier);
						step = Math.ceil(baseGroundMove / 10)
						currentEnhancedMove = baseGroundMove + "/" + Math.floor(+encumberedEnhancedMove2 * injuryFatigueMoveModifier);
						break;
	
					case 3:
						baseGroundMove = Math.floor(+move3 * injuryFatigueMoveModifier);
						step = Math.ceil(baseGroundMove / 10)
						currentEnhancedMove = baseGroundMove + "/" + Math.floor(+encumberedEnhancedMove3 * injuryFatigueMoveModifier);
						break;
	
					case 4:
					case 5:
					default:
						baseGroundMove = Math.floor(+move4 * injuryFatigueMoveModifier);
						step = Math.ceil(baseGroundMove / 10)
						currentEnhancedMove = baseGroundMove + "/" + Math.floor(+encumberedEnhancedMove4 * injuryFatigueMoveModifier);
						break;
	
				}
	
				currentEnhancedMove = `${currentEnhancedMove} (${step})`;
	
			}
	
			// set values and making sure modifiers are correct multiples
			setAttrs({
				"enhanced_ground_move_mod": groundModifier,
				"enhanced_ground_move_points": groundPoints,
				"enhanced_ground_move_multiple": totalModifier,
				"enhanced_ground_move": enhancedMove,
				"enhanced_move_0": enhancedMove0,
				"enhanced_move_1": enhancedMove1,
				"enhanced_move_2": enhancedMove2,
				"enhanced_move_3": enhancedMove3,
				"enhanced_move_4": enhancedMove4,
				"enhanced_move_5": enhancedMove5,
				"enhanced_move_current": currentEnhancedMove
			});
	
	
		});
	
	}
	
	/**
	 * Calculates move based on encumbrance level
	 * encumbrance level 1-4. 5 is the same as 4, just costs fatigue
	 * 
	 * @param {number} basicMove        Starting basic move
	 * @param {number} encumbranceLevel Encumbrance level 1-4
	 * 
	 * @returns {number}
	 */
	function getEncumberedMove(basicMove, encumbranceLevel) {
	
		let newMove = 0;
	
		let encumbranceModifier = 0;
	
		// make sure we have a good value
		if (encumbranceLevel < 1) {
			return basicMove;
		} else if (encumbranceLevel > 4) {
			encumbranceLevel = 4;
		}
	
		encumbranceModifier = 1 - ((encumbranceLevel * 2) / 10);
	
		// fix floating point bug
		// see: https://stackoverflow.com/questions/11832914/round-to-at-most-2-decimal-places-only-if-necessary
		encumbranceModifier = Math.round(encumbranceModifier * 100) / 100;
	
		newMove = Math.floor(basicMove * encumbranceModifier);
	
		// minimum move is 1
		if (newMove <= 0) {
			newMove = 1;
		}
	
		return newMove;
	
	}
	
	/**
	 * Calculate the enhanced value for multiples of 2. 
	 * If .5 value, then multiply by 1.5
	 * see GURPS Basic Set, page 52 enhanced move
	 * 
	 * @param {number} baseValue Value to multiply
	 * @param {number} level     Level of enhanced move to apply to baseValue
	 * 
	 * @returns {number}
	 */
	function getEnhancedValue(baseValue, level) {
	
		let enhancedValue = 0;
	
		// check for formula to use
		if (level == 0) {
	
			enhancedValue = 0;
	
		} else if (level % 1 == 0) {
	
			// if no remainder, use this formula
			enhancedValue = baseValue * Math.pow(2, level);
	
		} else {
	
			// if there is a remainder, use this formula
			// remove the .5 and then multiply by 1.5
			enhancedValue = (baseValue * Math.pow(2, Math.floor(level))) * 1.5;
	
			enhancedValue = Math.floor(enhancedValue);
	
		}
		return enhancedValue;
	
	}
	
	/**
	 * Checks for 1/3 HP and 1/3 FP. 
	 * Apply move modifies
	 * 
	 * @param {number} hit_points         Current hit points of character
	 * @param {number} hit_points_max     Max HP of character
	 * @param {number} fatigue_points     Current FP of character
	 * @param {number} fatigue_points_max Max FP of character
	 * 
	 * @returns {number}
	 */
	function getInjuryFatigueModifier(hit_points, hit_points_max, fatigue_points, fatigue_points_max) {
	
		let modifier = 1;
	
		if (+hit_points < +hit_points_max / 3) {
	
			modifier = modifier / 2;
	
		}
	
		if (+fatigue_points < +fatigue_points_max / 3) {
	
			modifier = modifier / 2;
	
		}
	
		return modifier;
	
	}
	
	// check for changes that affect flight speed
	on("change:flight_checked change:basic_speed change:basic_air_move_points change:basic_air_move_mod change:enhanced_air_level change:enhanced_air_move_points change:encumbrance_level change:hit_points change:fatigue_points", function (e) {
	
		updateFlightValues();
	
	});
	
	/**
	 * Update flight values, including encumbered and current speed
	 */
	function updateFlightValues() {
	
		console.log('***** UPDATE FLIGHT VALUES *****');
	
		getAttrs(["flight_checked", "basic_speed", "enhanced_air_level", "basic_air_move", "basic_air_move_mod",
			"basic_air_move_points", "enhanced_air_level", "enhanced_air_move_points",
			"encumbrance_level", "hit_points", "hit_points_max", "fatigue_points", "fatigue_points_max"], function (values) {
	
				// + sign converts value to a number
				let airMovePoints = +values.basic_air_move_points;
	
				let basicAirMoveMod = +values.basic_air_move_mod;
	
				let airMoveUnmodified = 0;
	
				let airMove = 0;
	
				let baseAirMove = 0;
	
				let airModifierFromPoints = 0;
	
				let baseEnhancedAirMove = 0;
	
				let baseEnhancedAirMoveDisplay = "";
	
				let enhancedAirLevel = 0;
	
				let enhancedEnteredLevel = +values.enhanced_air_level;
	
				let encumberedDisplayMove0 = "";
	
				let encumberedDisplayMove1 = "";
	
				let encumberedDisplayMove2 = "";
	
				let encumberedDisplayMove3 = "";
	
				let encumberedDisplayMove4 = "";
	
				let encumberedDisplayMove5 = "";
	
				let currentAirMove = 0;
	
				let currentAirMoveDisplay = "";
	
				// ensure valid enhancedEnteredLevel
				if (enhancedEnteredLevel < 0) {
					enhancedEnteredLevel = 0;
				}
	
				let enhancedEnteredPoints = +values.enhanced_air_move_points;
	
				// ensure valid enhancedEnteredPoints
				if (enhancedEnteredPoints < 0) {
					enhancedEnteredPoints = 0;
				}
	
				let enhancedAirLevelFromPoints = 0;
	
				let totalEnhancedLevel = 0;
	
				let injuryFatigueMoveModifier = 1;
	
				// if flight is checked, calculate the values
				if (values.flight_checked == 1) {
	
					//----------------
					// calculate air move
					airMoveUnmodified = Math.floor(+values.basic_speed * 2);
	
					// base is basis_speed * 2
					airMove = Math.floor(+values.basic_speed * 2);
	
					// add air move modifier
					airMove = airMove + basicAirMoveMod;
	
					// make sure airMovePoints is multiple of 2
					// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
					airMovePoints = Math.ceil(airMovePoints / 2) * 2;
	
					airModifierFromPoints = airMovePoints / 2;
	
					// add in the air move from spent points
					airMove = airMove + airModifierFromPoints;
	
					//-----------------
					// calculate top air speed
					// make sure groundPoints is multiple of 10
					// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
					enhancedEnteredPoints = Math.ceil(enhancedEnteredPoints / 10) * 10;
	
					enhancedAirLevelFromPoints = enhancedEnteredPoints / 20;
	
					// make sure enhancedEnteredLevel is multiple of .5
					// https://stackoverflow.com/questions/25209849/javascript-round-up-to-nearest-5 
					enhancedEnteredLevel = Math.ceil(enhancedEnteredLevel * 2) / 2;
	
					totalEnhancedLevel = enhancedEnteredLevel + enhancedAirLevelFromPoints;
	
					baseEnhancedAirMove = getEnhancedValue(airMove, totalEnhancedLevel);
	
					// get the encumbered levels
					if (baseEnhancedAirMove > 0) {
	
						// show the enhanced move
						encumberedDisplayMove0 = airMove + "/" + baseEnhancedAirMove;
	
						encumberedDisplayMove1 = getEncumberedMove(airMove, 1) + "/" + getEncumberedMove(baseEnhancedAirMove, 1);
	
						encumberedDisplayMove2 = getEncumberedMove(airMove, 2) + "/" + getEncumberedMove(baseEnhancedAirMove, 2);
	
						encumberedDisplayMove3 = getEncumberedMove(airMove, 3) + "/" + getEncumberedMove(baseEnhancedAirMove, 3);
	
						encumberedDisplayMove4 = getEncumberedMove(airMove, 4) + "/" + getEncumberedMove(baseEnhancedAirMove, 4);
	
						encumberedDisplayMove5 = encumberedDisplayMove4;
	
					} else {
	
						// don't need the enhanced move
						encumberedDisplayMove0 = airMove || "";
	
						encumberedDisplayMove1 = getEncumberedMove(airMove, 1) || "";
	
						encumberedDisplayMove2 = getEncumberedMove(airMove, 2) || "";
	
						encumberedDisplayMove3 = getEncumberedMove(airMove, 3) || "";
	
						encumberedDisplayMove4 = getEncumberedMove(airMove, 4) || "";
	
						encumberedDisplayMove5 = encumberedDisplayMove4;
	
					}
	
					// check for half move
					injuryFatigueMoveModifier = getInjuryFatigueModifier(values.hit_points, values.hit_points_max, values.fatigue_points, values.fatigue_points_max);
	
					// determine the current encumbrance move
					switch (Number(values.encumbrance_level)) {
	
						case 0:
							currentAirMove = (airMove * injuryFatigueMoveModifier);
	
							baseAirMove = (airMove * injuryFatigueMoveModifier);
	
							if (baseEnhancedAirMove > 0) {
								currentAirMoveDisplay = currentAirMove + "/" + (baseEnhancedAirMove * injuryFatigueMoveModifier);
							} else {
								currentAirMoveDisplay = currentAirMove || "";
							}
	
							break;
	
						case 1:
	
							currentAirMove = (getEncumberedMove(airMove, 1) * injuryFatigueMoveModifier);
	
							baseAirMove = (getEncumberedMove(airMove, 1) * injuryFatigueMoveModifier);
	
							if (baseEnhancedAirMove > 0) {
								currentAirMoveDisplay = currentAirMove + "/" + (getEncumberedMove(baseEnhancedAirMove, 1) * injuryFatigueMoveModifier);
							} else {
								currentAirMoveDisplay = currentAirMove || "";
							}
	
							break;
	
						case 2:
	
							currentAirMove = (getEncumberedMove(airMove, 2) * injuryFatigueMoveModifier);
	
							baseAirMove = (getEncumberedMove(airMove, 2) * injuryFatigueMoveModifier);
	
							if (baseEnhancedAirMove > 0) {
								currentAirMoveDisplay = currentAirMove + "/" + (getEncumberedMove(baseEnhancedAirMove, 2) * injuryFatigueMoveModifier);
							} else {
								currentAirMoveDisplay = currentAirMove || "";
							}
	
							break;
	
						case 3:
	
							currentAirMove = (getEncumberedMove(airMove, 3) * injuryFatigueMoveModifier);
	
							baseAirMove = (getEncumberedMove(airMove, 3) * injuryFatigueMoveModifier);
	
							if (baseEnhancedAirMove > 0) {
								currentAirMoveDisplay = currentAirMove + "/" + (getEncumberedMove(baseEnhancedAirMove, 3) * injuryFatigueMoveModifier);
							} else {
								currentAirMoveDisplay = currentAirMove || "";
							}
	
							break;
	
						case 4:
						case 5:
						default:
	
							currentAirMove = (getEncumberedMove(airMove, 4) * injuryFatigueMoveModifier);
	
							baseAirMove = (getEncumberedMove(airMove, 4) * injuryFatigueMoveModifier);
	
							if (baseEnhancedAirMove > 0) {
								currentAirMoveDisplay = currentAirMove + "/" + (getEncumberedMove(baseEnhancedAirMove, 4) * injuryFatigueMoveModifier);
							} else {
								currentAirMoveDisplay = currentAirMove || "";
							}
	
							break;
	
					}
	
				} else {
	
					airMove = 0;
	
					baseAirMove = 0;
	
					baseEnhancedAirMove = 0;
	
					currentAirMove = 0;
	
					currentAirMoveDisplay = "0";
	
				}
	
				let step = Math.ceil(baseAirMove / 10);
	
				// set air moves
				setAttrs({
					"basic_air_move": airMove,
					"basic_air_move_unmodified": airMoveUnmodified,
					"enhanced_air_move": baseEnhancedAirMove,
					"enhanced_air_move_level": totalEnhancedLevel,
					"basic_air_move_points": airMovePoints,
					"enhanced_air_move_points": enhancedEnteredPoints,
					"air_0": encumberedDisplayMove0,
					"air_1": encumberedDisplayMove1,
					"air_2": encumberedDisplayMove2,
					"air_3": encumberedDisplayMove3,
					"air_4": encumberedDisplayMove4,
					"air_5": encumberedDisplayMove5,
					"current_air": `${currentAirMoveDisplay} (${step})`,
					"current_air_step": step
				});
	
	
			});
	
	}
	
	// check for changes that affect water speed
	on("change:amphibious_checked change:basic_move change:basic_water_move_points change:basic_water_move_mod change:enhanced_water_level change:enhanced_water_move_points change:encumbrance_level change:hit_points change:fatigue_points", function (e) {
	
		updateWaterMoveValues();
	
	});
	
	/**
	 * Update water move values, including encumbered and current speed
	 */
	function updateWaterMoveValues() {
	
		console.log('***** UPDATE WATER MOVE VALUES *****');
	
		getAttrs(["amphibious_checked", "basic_move", "enhanced_water_level", "basic_water_move", "basic_water_move_mod",
			"basic_water_move_points", "enhanced_water_level", "enhanced_water_move_points",
			"encumbrance_level", "hit_points", "hit_points_max", "fatigue_points", "fatigue_points_max"], function (values) {
	
				// + sign converts value to a number
				let waterMovePoints = +values.basic_water_move_points;
	
				let basicWaterMoveMod = +values.basic_water_move_mod;
	
				let waterMoveUnmodified = 0;
	
				let waterMove = 0;
	
				let baseWaterMove = 0;
	
				let waterModifierFromPoints = 0;
	
				let baseEnhancedWaterMove = 0;
	
				let enhancedWaterLevel = 0;
	
				let enhancedEnteredLevel = +values.enhanced_water_level;
	
				let encumberedDisplayMove0 = "";
	
				let encumberedDisplayMove1 = "";
	
				let encumberedDisplayMove2 = "";
	
				let encumberedDisplayMove3 = "";
	
				let encumberedDisplayMove4 = "";
	
				let encumberedDisplayMove5 = "";
	
				let currentWaterMoveDisplay = "";
	
				// ensure valid enhancedEnteredLevel
				if (enhancedEnteredLevel < 0) {
					enhancedEnteredLevel = 0;
				}
	
				let enhancedEnteredPoints = +values.enhanced_water_move_points;
	
				// ensure valid enhancedEnteredPoints
				if (enhancedEnteredPoints < 0) {
					enhancedEnteredPoints = 0;
				}
	
				let enhancedWaterLevelFromPoints = 0;
	
				let totalEnhancedLevel = 0;
	
				let injuryFatigueMoveModifier = 1;
	
				// if flight is checked, calculate the values
				if (values.amphibious_checked == 1 && (enhancedEnteredPoints > 0 || enhancedEnteredLevel > 0)) {
	
					//----------------
					// calculate water move
					waterMoveUnmodified = +values.basic_move;
	
					// determine move
					if (values.amphibious_checked == 1) {
						// base is basis_move
						waterMove = +values.basic_move;
	
					} else {
	
						// base is basis_move / 5
						waterMove = +values.basic_move / 5;
					}
	
					// add water move modifier
					waterMove = waterMove + basicWaterMoveMod;
	
					// make sure waterMovePoints is multiple of 5
					// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
					waterMovePoints = Math.ceil(waterMovePoints / 5) * 5;
	
					waterModifierFromPoints = waterMovePoints / 5;
	
					// add in the water move from spent points
					waterMove = waterMove + waterModifierFromPoints;
	
					waterMove = Math.floor(waterMove);
	
					// make sure it's a minimum of 1.
					if (waterMove <= 0) {
						waterMove = 1;
					}
	
					//-----------------
					// calculate top water speed
					// make sure groundPoints is multiple of 10
					// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
					enhancedEnteredPoints = Math.ceil(enhancedEnteredPoints / 10) * 10;
	
					enhancedWaterLevelFromPoints = enhancedEnteredPoints / 20;
	
					// make sure enhancedEnteredLevel is multiple of .5
					// https://stackoverflow.com/questions/25209849/javascript-round-up-to-nearest-5 
					enhancedEnteredLevel = Math.ceil(enhancedEnteredLevel * 2) / 2;
	
					totalEnhancedLevel = enhancedEnteredLevel + enhancedWaterLevelFromPoints;
	
					baseEnhancedWaterMove = getEnhancedValue(waterMove, totalEnhancedLevel);
	
					// get the encumbered levels
					encumberedDisplayMove0 = waterMove + "/" + baseEnhancedWaterMove;
	
					encumberedDisplayMove1 = getEncumberedMove(waterMove, 1) + "/" + getEncumberedMove(baseEnhancedWaterMove, 1);
	
					encumberedDisplayMove2 = getEncumberedMove(waterMove, 2) + "/" + getEncumberedMove(baseEnhancedWaterMove, 2);
	
					encumberedDisplayMove3 = getEncumberedMove(waterMove, 3) + "/" + getEncumberedMove(baseEnhancedWaterMove, 3);
	
					encumberedDisplayMove4 = getEncumberedMove(waterMove, 4) + "/" + getEncumberedMove(baseEnhancedWaterMove, 4);
	
					encumberedDisplayMove5 = encumberedDisplayMove4;
	
					// check for half move
					injuryFatigueMoveModifier = getInjuryFatigueModifier(values.hit_points, values.hit_points_max, values.fatigue_points, values.fatigue_points_max);
	
					// determine the current encumbrance move
					switch (Number(values.encumbrance_level)) {
	
						case 0:
							currentWaterMoveDisplay = (waterMove * injuryFatigueMoveModifier) + "/" + (baseEnhancedWaterMove * injuryFatigueMoveModifier);
							baseWaterMove = (waterMove * injuryFatigueMoveModifier);
							break;
	
						case 1:
							currentWaterMoveDisplay = (getEncumberedMove(waterMove, 1) * injuryFatigueMoveModifier) + "/" + (getEncumberedMove(baseEnhancedWaterMove, 1) * injuryFatigueMoveModifier);
							baseWaterMove = (getEncumberedMove(waterMove, 1) * injuryFatigueMoveModifier);
							break;
	
						case 2:
							currentWaterMoveDisplay = (getEncumberedMove(waterMove, 2) * injuryFatigueMoveModifier) + "/" + (getEncumberedMove(baseEnhancedWaterMove, 2) * injuryFatigueMoveModifier);
							baseWaterMove = (getEncumberedMove(waterMove, 2) * injuryFatigueMoveModifier);
							break;
	
						case 3:
							currentWaterMoveDisplay = (getEncumberedMove(waterMove, 3) * injuryFatigueMoveModifier) + "/" + (getEncumberedMove(baseEnhancedWaterMove, 3) * injuryFatigueMoveModifier);
							baseWaterMove = (getEncumberedMove(waterMove, 3) * injuryFatigueMoveModifier);
							break;
	
						case 4:
						case 5:
						default:
							currentWaterMoveDisplay = (getEncumberedMove(waterMove, 4) * injuryFatigueMoveModifier) + "/" + (getEncumberedMove(baseEnhancedWaterMove, 4) * injuryFatigueMoveModifier);
							baseWaterMove = (getEncumberedMove(waterMove, 4) * injuryFatigueMoveModifier);
							break;
	
					}
	
				} else {
	
					//----------------
					// calculate water move
					waterMoveUnmodified = +values.basic_move;
	
					// determine move
					if (values.amphibious_checked == 1) {
						// base is basis_move
						waterMove = +values.basic_move;
	
					} else {
	
						// base is basis_move / 5
						waterMove = +values.basic_move / 5;
					}
	
					// add water move modifier
					waterMove = waterMove + basicWaterMoveMod;
	
					waterMove = Math.floor(waterMove);
	
					// make sure it's a minimum of 1.
					if (waterMove <= 0) {
						waterMove = 1;
					}
	
					// make sure waterMovePoints is multiple of 5
					// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
					waterMovePoints = Math.ceil(waterMovePoints / 5) * 5;
	
					waterModifierFromPoints = waterMovePoints / 5;
	
					// add in the water move from spent points
					waterMove = waterMove + waterModifierFromPoints;
	
					baseEnhancedWaterMove = 0;
	
					currentWaterMoveDisplay = "";
	
					// get the encumbered levels
					encumberedDisplayMove0 = waterMove || "";
	
					encumberedDisplayMove1 = getEncumberedMove(waterMove, 1);
	
					encumberedDisplayMove2 = getEncumberedMove(waterMove, 2);
	
					encumberedDisplayMove3 = getEncumberedMove(waterMove, 3);
	
					encumberedDisplayMove4 = getEncumberedMove(waterMove, 4);
	
					encumberedDisplayMove5 = encumberedDisplayMove4;
	
					// check for half move
					injuryFatigueMoveModifier = getInjuryFatigueModifier(values.hit_points, values.hit_points_max, values.fatigue_points, values.fatigue_points_max);
	
					// determine the current encumbrance move
					switch (Number(values.encumbrance_level)) {
	
						case 0:
							baseWaterMove = (waterMove * injuryFatigueMoveModifier);
							currentWaterMoveDisplay = baseWaterMove;
							break;
	
						case 1:
							baseWaterMove = (getEncumberedMove(waterMove, 1) * injuryFatigueMoveModifier);
							currentWaterMoveDisplay = baseWaterMove; 
							break;
	
						case 2:
							baseWaterMove = (getEncumberedMove(waterMove, 2) * injuryFatigueMoveModifier);
							currentWaterMoveDisplay = baseWaterMove; 
							break;
	
						case 3:
							baseWaterMove = (getEncumberedMove(waterMove, 3) * injuryFatigueMoveModifier);
							currentWaterMoveDisplay = baseWaterMove; 
							break;
	
						case 4:
						case 5:
						default:
							baseWaterMove = (getEncumberedMove(waterMove, 4) * injuryFatigueMoveModifier);
							currentWaterMoveDisplay = baseWaterMove; 
							break;
	
					}
	
				}
	
				let step = Math.ceil(baseWaterMove / 10);
	
				// set water moves
				setAttrs({
					"basic_water_move": waterMove,
					"basic_water_move_unmodified": waterMoveUnmodified,
					"enhanced_water_move": baseEnhancedWaterMove,
					"enhanced_water_move_level": totalEnhancedLevel,
					"basic_water_move_points": waterMovePoints,
					"enhanced_water_move_points": enhancedEnteredPoints,
					"water_0": encumberedDisplayMove0,
					"water_1": encumberedDisplayMove1,
					"water_2": encumberedDisplayMove2,
					"water_3": encumberedDisplayMove3,
					"water_4": encumberedDisplayMove4,
					"water_5": encumberedDisplayMove5,
					"current_water": `${currentWaterMoveDisplay} (${step})`,
					"current_water_step": step
				});
	
	
			});
	
	}
	
	// check for changes that affect jump distance
	on("change:use_st_for_jump change:jump_skill change:basic_move change:enhanced_ground_move change:super_jump_entered_level change:super_jump_points change:jump_encumbrance change:encumbrance_level change:jump_concentration change:running_jump_yards_moved change:running_high_jump_yards_moved change:strength change:encumbrance_level change:hit_points change:fatigue_points change:gravity", function (e) {
	
		updateJumpDistanceValues();
	
	});
	
	/**
	 * Update jump distance values
	 */
	function updateJumpDistanceValues() {
	
		console.log('***** UPDATE JUMP VALUES *****');
	
		let fields = [
			"use_st_for_jump",
			"jump_skill",
			"basic_move",
			"enhanced_ground_move",
			"super_jump_entered_level",
			"super_jump_points",
			"strength",
			"jump_concentration",
			"running_jump_yards_moved",
			"running_high_jump_yards_moved",
			"encumbrance_level",
			"hit_points",
			"hit_points_max",
			"fatigue_points",
			"fatigue_points_max",
			"jump_encumbrance",
			"gravity",
		];
	
		getAttrs(fields, function (values) {
	
			let gravity = Number(values.gravity);
	
			let gravityRatio = 1 / gravity;
	
			let jumpSkill = Number(values.jump_skill);
	
			if (jumpSkill < 0) {
				jumpSkill = 0;
			}
	
			let jumpST = Number(values.strength);
	
			if (jumpST < 0) {
				jumpST = 0;
			}
	
			let superJumpPoints = Number(values.super_jump_points);
	
			// ensure valid superJumpPoints
			if (superJumpPoints < 0) {
				superJumpPoints = 0;
			}
	
			let superJumpEnteredLevel = Number(values.super_jump_entered_level);
	
			if (superJumpEnteredLevel < 0) {
				superJumpEnteredLevel = 0;
			}
	
			let basicMove = Number(values.basic_move);
	
			// check for super move
			let enhancedGroundMove = Number(values.enhanced_ground_move);
	
			if (enhancedGroundMove < 0) {
				enhancedGroundMove = 0;
			}
	
			// check for running jump
			let runningJumpYardsMoved = Number(values.running_jump_yards_moved);
	
			runningJumpYardsMoved = Math.floor(runningJumpYardsMoved);
	
			let runningHighJumpYardsMoved = Number(values.running_high_jump_yards_moved);
	
			runningHighJumpYardsMoved = Math.floor(runningHighJumpYardsMoved);
	
			let runningMoveToUse = 0;
	
			let runningHighMoveToUse = 0;
	
			let jumpBroadFeet = 0;
	
			let jumpBroadYards = 0;
	
			let runningBroadJumpFeet = 0;
	
			let runningBroadJumpYards = 0;
	
			let jumpHighFeet = 0;
	
			let jumpHighYards = 0;
	
			let runningHighJumpFeet = 0;
	
			let runningHighJumpYards = 0;
	
			let superJumpLevelFromPoints = 0;
	
			let totalSuperJumpLevel = 0;
	
			let encumberedDisplayMove0 = "";
	
			let encumberedDisplayMove1 = "";
	
			let encumberedDisplayMove2 = "";
	
			let encumberedDisplayMove3 = "";
	
			let encumberedDisplayMove4 = "";
	
			let encumberedDisplayMove5 = "";
	
			let injuryFatigueMoveModifier = 1;
	
			let jumpMoveSpeed = 0;
	
			let finalJumpMoveSpeed = 0;
	
			let statUsedForJump = "";
	
			let statUsedForRunningJump = "";
	
			let baseJumpMove = 0;
	
			// calculate broad and high jump
			if (jumpSkill > 0) {
	
				// -------------
				// USE JUMP SKILL
				baseJumpMove = Math.floor(jumpSkill / 2);
	
				// calc. standing broad jump
				jumpBroadFeet = baseJumpMove;
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				jumpBroadFeet = jumpBroadFeet * gravityRatio;
	
				statUsedForJump = "Jump Skill/2 = " + jumpBroadFeet;
	
				jumpBroadFeet = (jumpBroadFeet * 2) - 3;
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				// calc. running broad jump
				if (enhancedGroundMove > Math.floor(jumpSkill / 2)) {
	
					// use enhanced move instead of jump skill
					statUsedForRunningJump = "Basic Move * (2 ^ Enh MV Mod)";
	
					runningMoveToUse = enhancedGroundMove * gravityRatio
	
					runningHighMoveToUse = enhancedGroundMove * gravityRatio;
	
				} else {
	
					// use jump skill for running jump
					statUsedForRunningJump = statUsedForJump + " + Yards Run";
	
					runningMoveToUse = (Math.floor(jumpSkill / 2) + runningJumpYardsMoved) * gravityRatio;
	
					// do not apply gravity ratio to running start
					runningHighMoveToUse = (Math.floor(jumpSkill / 2) * gravityRatio) + runningHighJumpYardsMoved;
	
				}
	
				runningBroadJumpFeet = (runningMoveToUse * 2) - 3;
	
				if (runningBroadJumpFeet <= 0) {
	
					runningBroadJumpFeet = 1;
	
				}
	
				// calc. standing high jump
				jumpHighFeet = Math.floor(jumpSkill / 2);
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				jumpHighFeet = jumpHighFeet * gravityRatio;
	
				jumpHighFeet = (6 * jumpHighFeet) - 10;
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				// convert to feet
				jumpHighFeet = jumpHighFeet / 12;
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				// calc. running high jump
				runningHighJumpFeet = (6 * runningHighMoveToUse) - 10;
	
				if (runningHighJumpFeet <= 0) {
					runningHighJumpFeet = 1;
				}
	
				// convert to feet
				runningHighJumpFeet = Math.floor(runningHighJumpFeet / 12);
	
				if (runningHighJumpFeet <= 0) {
	
					runningHighJumpFeet = 1;
	
				} else if (runningHighJumpFeet > jumpHighFeet * 2) {
	
					// can't be greater than twice standing broad jump
					runningHighJumpFeet = jumpHighFeet * 2;
	
				}
	
			} else if (values.use_st_for_jump == "1") {
	
				//-------------------------------
				// USE Strength to determine jump
				baseJumpMove = Math.floor(jumpST / 4);
	
				// calc. standing broad jump
				jumpBroadFeet = baseJumpMove;
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				jumpBroadFeet = jumpBroadFeet * gravityRatio;
	
				statUsedForJump = "ST / 4 = " + jumpBroadFeet;
	
				jumpBroadFeet = (jumpBroadFeet * 2) - 3;
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				// calc. running broad jump
				if (enhancedGroundMove > Math.floor(jumpST / 4)) {
	
					// use enhanced move instead of strength
					statUsedForRunningJump = "Basic Move * (2 ^ Enh MV Mod)";
	
					runningMoveToUse = enhancedGroundMove * gravityRatio;
	
					runningHighMoveToUse = enhancedGroundMove * gravityRatio;
	
				} else {
	
					statUsedForRunningJump = statUsedForJump + " + Yards Run";
	
					runningMoveToUse = (Math.floor(jumpST / 4) + runningJumpYardsMoved) * gravityRatio;
	
					// do not apply gravity ratio to running start
					runningHighMoveToUse = (Math.floor(jumpST / 2) * gravityRatio) + runningHighJumpYardsMoved;
				}
	
				runningBroadJumpFeet = (runningMoveToUse * 2) - 3;
	
				if (runningBroadJumpFeet <= 0) {
	
					runningBroadJumpFeet = 1;
	
				}
	
				// calc. standing high jump
				jumpHighFeet = Math.floor(jumpST / 4);
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				jumpHighFeet = jumpHighFeet * gravityRatio;
	
				jumpHighFeet = (6 * jumpHighFeet) - 10;
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				// convert to feet
				jumpHighFeet = jumpHighFeet / 12;
	
				// calc. running high jump
				runningHighJumpFeet = (6 * runningHighMoveToUse) - 10;
	
				if (runningHighJumpFeet <= 0) {
					runningHighJumpFeet = 1;
				}
	
				// convert to feet
				runningHighJumpFeet = Math.floor(runningHighJumpFeet / 12);
	
				if (runningHighJumpFeet <= 0) {
	
					runningHighJumpFeet = 1;
	
				} else if (runningHighJumpFeet > jumpHighFeet * 2) {
	
					// can't be greater than twice standing broad jump
					runningHighJumpFeet = jumpHighFeet * 2;
	
				}
	
			} else {
	
				//---------------
				// USE Basic Move
				baseJumpMove = basicMove;
	
				statUsedForJump = "Basic Move = " + basicMove;
	
				// calc. standing broad jump
				jumpBroadFeet = (basicMove * 2) - 3;
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				jumpBroadFeet = jumpBroadFeet * gravityRatio;
	
				// calc. running broad jump
				if (enhancedGroundMove > basicMove) {
	
					// use enhanced move instead of strength
					statUsedForRunningJump = "Basic Move * (2 ^ Enh MV Mod)";
	
					runningMoveToUse = enhancedGroundMove * gravityRatio;
	
					runningHighMoveToUse = enhancedGroundMove * gravityRatio;
	
				} else {
	
					statUsedForRunningJump = statUsedForJump + " + Yards Run";
	
					runningMoveToUse = (basicMove + runningJumpYardsMoved) * gravityRatio;
	
					// do not apply gravity ratio to running start
					runningHighMoveToUse = (basicMove * gravityRatio) + runningHighJumpYardsMoved;
	
				}
	
				runningBroadJumpFeet = (runningMoveToUse * 2) - 3;
	
				if (runningBroadJumpFeet <= 0) {
	
					runningBroadJumpFeet = 1;
	
				} else if (runningBroadJumpFeet > jumpBroadFeet * 2) {
	
					// can't be greater than twice standing broad jump
					runningBroadJumpFeet = jumpBroadFeet * 2;
	
				}
	
				// calc. high jump
				jumpHighFeet = (6 * basicMove) - 10;
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				jumpHighFeet = jumpHighFeet * gravityRatio;
	
				// convert to feet
				jumpHighFeet = jumpHighFeet / 12;
	
				// calc. running high jump
				runningHighJumpFeet = (6 * runningHighMoveToUse) - 10;
	
				if (runningHighJumpFeet <= 0) {
					runningHighJumpFeet = 1;
				}
	
				// convert to feet
				runningHighJumpFeet = Math.floor(runningHighJumpFeet / 12);
	
				if (runningHighJumpFeet <= 0) {
	
					runningHighJumpFeet = 1;
	
				} else if (runningHighJumpFeet > jumpHighFeet * 2) {
	
					// can't be greater than twice standing broad jump
					runningHighJumpFeet = jumpHighFeet * 2;
	
				}
	
			}
	
			// If no concentration, divide distance by 2
			if (values.jump_concentration != "1") {
	
				jumpBroadFeet = Math.floor(jumpBroadFeet / 2);
	
				if (jumpBroadFeet <= 0) {
					jumpBroadFeet = 1;
				}
	
				runningBroadJumpFeet = Math.floor(runningBroadJumpFeet / 2);
	
				if (runningBroadJumpFeet <= 0) {
					runningBroadJumpFeet = 1;
				}
	
				// reduce in half
				jumpHighFeet = jumpHighFeet / 2;
	
				if (jumpHighFeet <= 0) {
					jumpHighFeet = 1;
				}
	
				runningHighJumpFeet = Math.floor(runningHighJumpFeet / 2);
	
				if (runningHighJumpFeet <= 0) {
	
					runningHighJumpFeet = 1;
				}
	
			}
	
			// check for super jump
			if (superJumpPoints > 0 || superJumpEnteredLevel > 0) {
	
				//-----------------
				// calculate super jump
				// make sure points is multiple of 10
				// https://stackoverflow.com/questions/18953384/javascript-round-up-to-the-next-multiple-of-5 
				superJumpPoints = Math.ceil(superJumpPoints / 10) * 10;
	
				superJumpLevelFromPoints = superJumpPoints / 10;
	
				// -------
				// make sure entered super jump level is an integer, min of 1
				superJumpEnteredLevel = Math.floor(superJumpEnteredLevel);
	
				if (superJumpEnteredLevel < 0) {
					superJumpEnteredLevel = 0;
				}
	
				totalSuperJumpLevel = superJumpEnteredLevel + superJumpLevelFromPoints;
	
				// get the new jump feet values based on super level
				jumpBroadFeet = getEnhancedValue(jumpBroadFeet, totalSuperJumpLevel);
	
				runningBroadJumpFeet = getEnhancedValue(runningBroadJumpFeet, totalSuperJumpLevel);
	
				jumpHighFeet = getEnhancedValue(jumpHighFeet, totalSuperJumpLevel);
	
				runningHighJumpFeet = getEnhancedValue(runningHighJumpFeet, totalSuperJumpLevel);
	
			}
	
			// check if encumbrance should be factored in.
			if (+values.jump_encumbrance === 1) {
	
				switch (Number(values.encumbrance_level)) {
	
					default:
					case 0:
						// round everything to two decimals
						jumpBroadFeet = Math.round(jumpBroadFeet * 100) / 100;
	
						runningBroadJumpFeet = Math.round(runningBroadJumpFeet * 100) / 100;
	
						jumpHighFeet = Math.round(jumpHighFeet * 100) / 100;
	
						runningHighJumpFeet = Math.round(runningHighJumpFeet * 100) / 100;
	
						break;
	
					case 1:
						// Light
						jumpBroadFeet = Math.round((jumpBroadFeet * .8) * 100) / 100;
	
						runningBroadJumpFeet = Math.round((runningBroadJumpFeet * .8) * 100) / 100;
	
						jumpHighFeet = Math.round((jumpHighFeet * .8) * 100) / 100;
	
						runningHighJumpFeet = Math.round((runningHighJumpFeet * .8) * 100) / 100;
	
						break;
	
					case 2:
						// Medium
						jumpBroadFeet = Math.round((jumpBroadFeet * .6) * 100) / 100;
	
						runningBroadJumpFeet = Math.round((runningBroadJumpFeet * .6) * 100) / 100;
	
						jumpHighFeet = Math.round((jumpHighFeet * .6) * 100) / 100;
	
						runningHighJumpFeet = Math.round((runningHighJumpFeet * .6) * 100) / 100;
	
						break;
	
					case 3:
						// Heavy
						jumpBroadFeet = Math.round((jumpBroadFeet * .4) * 100) / 100;
	
						runningBroadJumpFeet = Math.round((runningBroadJumpFeet * .4) * 100) / 100;
	
						jumpHighFeet = Math.round((jumpHighFeet * .4) * 100) / 100;
	
						runningHighJumpFeet = Math.round((runningHighJumpFeet * .4) * 100) / 100;
	
						break;
	
					case 4:
						// Extra-Heavy
						jumpBroadFeet = Math.round((jumpBroadFeet * .2) * 100) / 100;
	
						runningBroadJumpFeet = Math.round((runningBroadJumpFeet * .2) * 100) / 100;
	
						jumpHighFeet = Math.round((jumpHighFeet * .2) * 100) / 100;
	
						runningHighJumpFeet = Math.round((runningHighJumpFeet * .2) * 100) / 100;
	
						break;
	
				}
	
			} else {
	
				// make sure to round final values
				jumpBroadFeet = Math.round(jumpBroadFeet * 100) / 100;
	
				runningBroadJumpFeet = Math.round(runningBroadJumpFeet * 100) / 100;
	
				jumpHighFeet = Math.round(jumpHighFeet * 100) / 100;
	
				runningHighJumpFeet = Math.round(runningHighJumpFeet * 100) / 100;
	
			}
	
			// get broad jump in yards. Minimum of 1
			jumpBroadYards = Math.round((jumpBroadFeet / 3) * 100) / 100;
	
			// get running jump in yards. Min of 1
			runningBroadJumpYards = Math.round((runningBroadJumpFeet / 3) * 100) / 100;
	
			// get high jump in yards
			jumpHighYards = Math.round((jumpHighFeet / 3) * 100) / 100;
	
			// get running high in yards
			runningHighJumpYards = Math.round((runningHighJumpFeet / 3) * 100) / 100;
	
			// calculate jump move speed
			jumpMoveSpeed = Math.floor(jumpBroadYards / 5);
	
			if (jumpMoveSpeed <= 0) {
				jumpMoveSpeed = 1;
			}
	
			// determine which one to use
			if (jumpMoveSpeed > basicMove) {
	
				finalJumpMoveSpeed = jumpMoveSpeed;
	
			} else {
	
				finalJumpMoveSpeed = basicMove;
	
			}
	
			// set jump distances
			setAttrs({
				"broad_jump_distance_feet": jumpBroadFeet,
				"broad_jump_distance_yards": jumpBroadYards,
				"high_jump_distance_feet": jumpHighFeet,
				"high_jump_distance_yards": jumpHighYards,
				"super_jump_level": totalSuperJumpLevel,
				"super_jump_entered_level": superJumpEnteredLevel,
				"super_jump_points": superJumpPoints,
				"running_jump_distance_feet": runningBroadJumpFeet,
				"running_jump_distance_yards": runningBroadJumpYards,
				"running_high_jump_distance_feet": runningHighJumpFeet,
				"running_high_jump_distance_yards": runningHighJumpYards,
				"broad_jump_base": baseJumpMove,
				"standing_broad_jump_stat_to_use": statUsedForJump,
				"running_broad_jump_stat_to_use": statUsedForRunningJump,
				"high_jump_base": baseJumpMove,
				"standing_high_jump_stat_to_use": statUsedForJump,
				"running_high_jump_stat_to_use": statUsedForRunningJump,
				"jump_move_speed": finalJumpMoveSpeed
			});
	
		});
	
	}
	
	// check for malfunction number. it should always be set to 0 or higher.
	// also set the max malfunction number. This is used to set the effective skill
	// based on the lowest skill level.
	on("change:repeating_ranged:malfunction", event => {
	
		getAttrs(["repeating_ranged_malfunction", "use_malfunction"], values => {

			const useMalfunction = values.use_malfunction === "1";

			const malfunctionValue = Number(values.repeating_ranged_malfunction);

			let maxValue = 100;
	
			// check to see if we need to set the value to 0
			if (isNaN(malfunctionValue) || malfunctionValue < 0) {
				
				malfunctionValue = 0;
				
				setAttrs({ "repeating_ranged_malfunction": 0 }, { silent: true });
			}

			// check for using malfunction and setting max value
			if (useMalfunction && malfunctionValue > 0) {
				maxValue = malfunctionValue;
			}

			setAttrs({"repeating_ranged_malf_max_value": maxValue});

		});	

	});

	on("change:use_malfunction", event => {
		setRangedMaxMalfunctionValues();
	});

	/**
	 * Function to make sure the repeating_ranged_{id}_mal_max_value is set
	 * during a new version load or possible future reset button
	 */
	let setRangedMaxMalfunctionValues = () => {

		getSectionIDs("repeating_ranged", (ids) => {

			if (ids.length === 0) {
				return;
			}
	
			let getFields = ["use_malfunction"];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines note
				const fieldName = "repeating_ranged_" + ids[i] + '_malfunction';
	
				getFields.push(fieldName);
	
			}
	
			getAttrs(getFields, function (values) {
	
				let updateFields = {};

				const useMalfunction = values["use_malfunction"] === "1";
	
				// loop through the row ids again so we can get the values
				// and fill array of note values to update
				_.each(ids, function (id) {
	
					let malfunctionField = "repeating_ranged_" + id + '_malfunction';
	
					// field we need to update
					let maxMalfunctionField = "repeating_ranged_" + id + '_malf_max_value';
	
					let malfunctionValue = values[malfunctionField];

					let maxMalfunctionValue = Number(malfunctionValue);
	
					if (useMalfunction === false || isNaN(maxMalfunctionValue) || maxMalfunctionValue <= 0) {
						maxMalfunctionValue = 100;
					}
	
					updateFields[maxMalfunctionField] = maxMalfunctionValue;
	
				});
	
				setAttrs(updateFields);
	
			});

		});

	};

	// check to see if the melee weapon weight changed. Update parrying weapon weight
	on('change:repeating_melee:weapon_weight', event => {

		let weaponWeight = +event.newValue;

		let parryingWeaponWeight = weaponWeight / 3;

		// round parryingWeaponWeight to two decimal places
		parryingWeaponWeight = Math.round(parryingWeaponWeight * 100) / 100;

		setAttrs({ "repeating_melee_parrying_weapon_weight": parryingWeaponWeight });
	});

	// set note values for damage types
	// Update thrust and swing when striking st is updated
	on('change:repeating_melee:type', function (event) {
	
		getAttrs(['repeating_melee_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.repeating_melee_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.repeating_melee_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"repeating_melee_damage_type_note": typeNote,
				"repeating_melee_minimum_damage_note": minDamageNote,
				"repeating_melee_minimum_damage": minDamage
			});
	
		});
	
	});
	
	// set note values for damage types
	// Update thrust and swing when striking st is updated
	on('change:repeating_ranged:type', function (event) {
	
		getAttrs(['repeating_ranged_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.repeating_ranged_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.repeating_ranged_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"repeating_ranged_damage_type_note": typeNote,
				"repeating_ranged_minimum_damage_note": minDamageNote,
				"repeating_ranged_minimum_damage": minDamage,
			});
	
		});
	
	});
	
	// update damage notes for thrown object
	on('change:thrown_object_damage_type', function (event) {
	
		updateThrownObject();
	
	});
	
	/*
	 * Update the thrown object weight damage notes
	 */
	function updateThrownObject() {
	
		getAttrs(['thrown_object_damage_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.thrown_object_damage_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.thrown_object_damage_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"thrown_object_damage_type_note": typeNote,
				"thrown_minimum_damage_note": minDamageNote,
				"thrown_minimum_damage": minDamage
			});
	
		});
	
	}

	// check for thrown modifier skill change
	on("change:thrown_link_type change:thrown_skill_row_id", event => {
	
		updateLinkedThrownSkill(null);

	});

	function updateLinkedThrownSkill(callback) {

		// check if we need to set default value
		callback = callback || noop;

		getAttrs(["thrown_link_type", "thrown_skill_row_id", "thrown_skill_modifier"], values => {

			let rowType = values.thrown_link_type;
	
			let skillRowId = values.thrown_skill_row_id;
	
			let skillMod = +values.thrown_skill_modifier;
	
			let { updateMethod, repeatingTableToUse } = getLinkedSkillUpdateMethod(rowType);
	
			let skillName = "";
	
			let skillLevel = "";
	
			let updateFields = {};
	
			// if updating using a repeating field AND no row id, clear the fields
			if (updateMethod == "nothing" || (updateMethod != "attribute" && skillRowId.length === 0)) {
	
				updateFields["thrown_skill_row_id_message"] = "";
	
				updateFields["thrown_skill_row_id_level"] = "";

				updateFields["thrown_skill_row_id"] = "";
	
				setAttrs(updateFields, null, callback);
	
			} else if (updateMethod == "attribute") {
	
				updateLinkedThrownSkillByAttribute(rowType, callback);
	
			} else {
	
				updateLinkedThrownSkillByTable(repeatingTableToUse, skillRowId, rowType, callback);
	
			}

		});
		
	}

	/**
	 * Update the linked thrown skill by using an attribute stat
	 *
	 * @param {string}      rowType  The attribute to use for setting weapon skill level
	 * @param {() => void=} callback Callback function 
	 */
	 function updateLinkedThrownSkillByAttribute(rowType, callback) {
		callback = callback || noop;
	
		let fieldName;
	
		switch (rowType) {
			case "DX":
				fieldName = "dexterity";
				break;
	
			default:
				fieldName = null;
				break;
		}
	
		let skillLevel = "";

		let updateFields = {};

		if (fieldName) {

			// update the skill level for knockback save.
			getAttrs([fieldName], function (skillValues) {
				
				skillLevel = +skillValues[fieldName];

				updateFields["thrown_skill_row_id_message"] = rowType;

				updateFields["thrown_skill_row_id_level"] = skillLevel;

				updateFields["thrown_skill_row_id"] = "";

				setAttrs(updateFields, null, callback);

			});

		} else {

			updateFields["thrown_skill_row_id_message"] = "";

			updateFields["thrown_skill_row_id_level"] = "";

			updateFields["thrown_skill_row_id"] = "";

			setAttrs(updateFields, null, callback);

		}

	}

	/**
	 * Update the Thrown based on a repeating item
	 *
	 * @param {string} repeatingTableToUse Name of table that contains the row id
	 * @param {string} skillRowId          The Row that has the information we need for name and skill level to use
	 * @param {string} rowType             Type of knockback defense
	 * @param {() => void=} callback       An optional call back function  
	 */
	 function updateLinkedThrownSkillByTable(repeatingTableToUse, skillRowId, rowType, callback) {
		// if it's a good row id, let's update stuff
		let skillFieldName = `${repeatingTableToUse}_${skillRowId}_level`;
	
		let skillFieldNameOfSkill = `${repeatingTableToUse}_${skillRowId}_name`;
	
		// update the skill level for weapon.
		getAttrs([skillFieldName, skillFieldNameOfSkill], function (skillValues) {
	
			let skillLevel = +skillValues[skillFieldName];
	
			let updateFields = {};
	
			// check for valid skill level
			if (skillLevel > 0) {
	
				updateFields["thrown_skill_row_id_message"] = skillValues[skillFieldNameOfSkill];
	
				updateFields["thrown_skill_row_id_level"] = skillLevel;
	
				setAttrs(updateFields, null, callback);
	
			} else {
	
				// show an error message
				updateFields["thrown_skill_row_id_message"] = `Could not find ${rowType}.`;
	
				setAttrs(updateFields, { silent: true }, callback);
	
			}
	
		});
	}

	/**
	 * Checks to see if the thrown skill is linked to this rowId
	 *
	 * @param {string} rowId Row ID of a skill or the Attribute that might be linked to a weapon
	 */
	function updateThrownLinkedToRow(rowId) {
	
		let fields = ["thrown_row_type", "thrown_skill_row_id"];

		getAttrs(fields, values => {

			let updateFields = {};

			// convert the values object into an array
			let entries = Object.entries(values);

			// loop through each entry
			for (const [field, value] of entries) {

				// NOTE: This match based on either skill/technique ID or against an attribute
				// the field name lets us know which.
				if (value == rowId) {

					updateLinkedThrownSkill();

					break; // we found a match, no reason to continue

				}

			}

		});

	}

	on("change:thrown_skill_row_id_level change:thrown_skill_modifier", (event) => {

		updateThrownSkill();

	});

	function updateThrownSkill() {

		let fields = ["thrown_skill_row_id_level", "thrown_skill_modifier", "thrown_object_skill"];

		getAttrs(fields, values => {

			let selectedSkillLevel = Number(values.thrown_skill_row_id_level);

			let skillModifier = Number(values.thrown_skill_modifier);

			let currentSkillLevel = Number(values.thrown_object_skill);

			if (isNaN(skillModifier)) {
				skillModifier = 0;
			}

			if (isNaN(currentSkillLevel)) {
				currentSkillLevel = 0;
			}

			let finalSkillLevel = 0;

			if (isNaN(selectedSkillLevel)) {

				// if they didn't use a selectedSkill then use the current skill level
				finalSkillLevel = currentSkillLevel + skillModifier;

			} else {

				// otherwise use the selectedSkillLevel (such as linked to DX, Skill, or Technique)
				finalSkillLevel = selectedSkillLevel + skillModifier;
			}

			if (finalSkillLevel <= 0) {
				finalSkillLevel = 10;
			}

			let updateFields = {
				thrown_object_skill: finalSkillLevel
			};

			setAttrs(updateFields, { silent: true });

		});

	}

	// update damage notes for slam
	on('change:slam_damage_type', function (event) {
	
		updateSlamDamageTypes();
	
	});
	
	/*
	 * Update the slam damage type notes
	 */
	function updateSlamDamageTypes() {
	
		getAttrs(['slam_damage_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.slam_damage_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.slam_damage_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"slam_damage_type_note": typeNote,
				"slam_minimum_damage_note": minDamageNote,
				"slam_minimum_damage": minDamage
			});
	
		});
	
	}

	// update damage notes for falling
	on('change:falling_damage_type', function (event) {
	
		updateFallingDamageTypes();
	
	});
	
	/*
	 * Update the falling damage type notes
	 */
	function updateFallingDamageTypes() {
	
		getAttrs(['falling_damage_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.falling_damage_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.falling_damage_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"falling_damage_type_note": typeNote,
				"falling_minimum_damage_note": minDamageNote,
				"falling_minimum_damage": minDamage
			});
	
		});
	
	}

	// update damage notes for collision
	on('change:collision_damage_type', function (event) {
	
		updateFallingDamageTypes();
	
	});
	
	/*
	 * Update the collision damage type notes
	 */
	function updateFallingDamageTypes() {
	
		getAttrs(['collision_damage_type',
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], function (values) {
	
			let typeNote = getDamageTypeNote(values.collision_damage_type, values);
	
			let minDamageNote = getMinimumDamageNote(values.collision_damage_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			setAttrs({
				"collision_damage_type_note": typeNote,
				"collision_minimum_damage_note": minDamageNote,
				"collision_minimum_damage": minDamage
			});
	
		});
	
	}
	
	/**
	 * Get Damage Type Note for damage type string
	 * Used for adding custom notes to rolltemplates
	 */
	function getDamageTypeNote(damageType, values) {
	
		let typeNote = "";
	
		switch (damageType) {
	
			case "Cutting (cut)":
				typeNote = values.damage_type_note_cut;
				break;
	
			case "Impaling (imp)":
				typeNote = values.damage_type_note_imp;
				break;
	
			case "Crushing (cr)":
				typeNote = values.damage_type_note_cr;
				break;
	
			case "Small Piercing (pi-)":
				typeNote = values.damage_type_note_pi_minus;
				break;
	
			case "Piercing (pi)":
				typeNote = values.damage_type_note_pi;
				break;
	
			case "Large Piercing (pi+)":
				typeNote = values.damage_type_note_pi_plus;
				break;
	
			case "Huge Piercing (pi++)":
				typeNote = values.damage_type_note_pi_plus_plus;
				break;
	
			case "Affliction (aff)":
				typeNote = values.damage_type_note_aff;
				break;
	
			case "Burning (burn)":
				typeNote = values.damage_type_note_burn;
				break;
	
			case "Corrosion (cor)":
				typeNote = values.damage_type_note_cor;
				break;
	
			case "Fatigue (fat)":
				typeNote = values.damage_type_note_fat;
				break;
	
			case "Toxic (tox)":
				typeNote = values.damage_type_note_tox;
				break;
	
			case "Special (spec)":
				typeNote = values.damage_type_note_spec;
				break;
	
			case "Knockback (knock)":
				typeNote = values.damage_type_note_knockback;
				break;
	
			default:
				typeNote = values.damage_type_note_cut;
	
		}
	
		return typeNote;
	
	}
	
	/*
	 * Loop through each repeating section 
	 * for melee and ranged and update
	 * damage notes to match damage type
	 *
	 */
	function updateDamageNotes() {
	
		// note field values
		const noteFields = ['damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		];
	
		getAttrs(noteFields, function (noteFieldValues) {
	
			updateDamageNotesBySection("melee", noteFieldValues);
	
			updateDamageNotesBySection("ranged", noteFieldValues);
	
		});
	
	
	}
	
	/**
	 * Update damage notes for a section
	 * 
	 * @param {string} sectionName     Values: melee | ranged
	 * @param {object} noteFieldValues Note Content for each damage type
	 */
	function updateDamageNotesBySection(sectionName, noteFieldValues) {
	
		console.log('********* updateDamageNotesBySection ' + sectionName + '*********');
	
		getSectionIDs(sectionName, function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let getFields = [];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines note
				let damageTypeField = "repeating_" + sectionName + '_' + ids[i] + '_type';
	
				getFields.push(damageTypeField);
	
			}
	
			getAttrs(getFields, function (values) {
	
				let updateFields = {};
	
				// loop through the row ids again so we can get the values
				// and fill array of note values to update
				_.each(ids, function (id) {
	
					let damageTypeField = "repeating_" + sectionName + '_' + id + '_type';
	
					// field we need to update
					let damageTypeNoteField = "repeating_" + sectionName + '_' + id + '_damage_type_note';
	
					let type = values[damageTypeField];
	
					let note = getDamageTypeNote(type, noteFieldValues);
	
					let minDamageNote = getMinimumDamageNote(type);

					let minDamage = minDamageNote.replace("Min ", "");
	
					let minDamageNoteField = `repeating_${sectionName}_${id}_minimum_damage_note`;
	
					let minDamageField = `repeating_${sectionName}_${id}_minimum_damage`;
	
					updateFields[damageTypeNoteField] = note;
	
					updateFields[minDamageNoteField] = minDamageNote;

					updateFields[minDamageField] = minDamage;
	
				});
	
				setAttrs(updateFields);
	
			});
	
		});
	
	}
	
	// check for changes that affect thrown object stats
	on('change:thrown_object_weight change:basic_lift change:thrust change:super_throw_level change:thrown_object_strength_mod change:thrown_object_damage_mod change:gravity change:use_metric', function (event) {
	
		updateThrownObjectStats();
	
	});
	
	/**
	 * Update thrown objects stats
	 * Damage, range, etc.
	 */
	function updateThrownObjectStats() {
	
		console.log("*********** Updating Thrown Object Stats ***********");
	
		const fields = ['thrown_object_weight',
			'striking_st',
			'thrown_object_strength_mod',
			'super_throw_level',
			'thrust',
			'basic_lift',
			'thrown_object_damage_mod',
			'gravity',
			'use_metric'
		];
	
		getAttrs(fields, function (values) {
	
			let weight = +values.thrown_object_weight;
	
			let basicLift = +values.basic_lift;
	
			let throwingST = +values.striking_st;
	
			let throwingStMod = parseInt(values.thrown_object_strength_mod);
	
			let superThrowLvl = parseInt(values.super_throw_level);
	
			let enteredDamageMod = parseInt(values.thrown_object_damage_mod);
	
			let gravity = Number(values.gravity);
	
			throwingST = throwingST + throwingStMod;
	
			if (weight < 1) {
				weight = 0;
			}
	
			if (basicLift < 0) {
				basicLift = 1;
			}
	
			if (superThrowLvl < 0) {
				superThrowLvl = 0;
			}
	
			let weightRatio = weight / basicLift;
	
			let distanceMod = distanceModifier(weightRatio);
	
			let distance = throwingST * distanceMod;
	
			let damageMod = getThrownDamageModifier(basicLift, weight);
	
			// check for super throw
			if (superThrowLvl > 0) {
	
				distance = distance * Math.pow(2, superThrowLvl);
	
				damageMod = damageMod + (superThrowLvl * 2);
	
			}
	
			// check to see if they entered a modifier
			if (enteredDamageMod != 0) {
				damageMod = damageMod + enteredDamageMod;
			}
	
			// factor in gravity
			let gravityRatio = 1 / gravity;
	
			distance = Math.floor(distance * gravityRatio);
	
			let finalDamage = getModifiedDamage(values.thrust, damageMod);
	
			setAttrs({
				'thrown_object_strength': throwingST,
				'thrown_object_range': distance,
				'thrown_object_damage': finalDamage
			});
	
		});
	
	}
	
	/**
	 * Get damage modifier
	 *
	 * @param {number} basicLift In pounds
	 * @param {number} weight    Weight of thrown object
	 *
	 * @returns {number}
	 */
	function getThrownDamageModifier(basicLift, weight) {
	
		let damageMod = 0;
	
		if (weight <= Math.floor(basicLift / 8)) {
			damageMod = -2;
		} else if (Math.floor(basicLift / 8) < weight && weight <= Math.floor(basicLift / 4)) {
			damageMod = -1;
		} else if (Math.floor(basicLift / 4) < weight && weight <= Math.floor(basicLift / 2)) {
			damageMod = 0;
		} else if (Math.floor(basicLift / 2) < weight && weight <= Math.floor(basicLift)) {
			damageMod = 1;
		} else if (Math.floor(basicLift) < weight && weight <= Math.floor(basicLift * 2)) {
			damageMod = 0;
		} else if (Math.floor(basicLift * 2) < weight && weight <= Math.floor(basicLift * 4)) {
			damageMod = -.5;
		} else if (Math.floor(basicLift * 4) < weight && weight <= Math.floor(basicLift * 8)) {
			damageMod = -1;
		} else {
			damageMod = -10;
		}
	
		return damageMod;
	
	}
	
	/**
	 * Get distance modifier based on ratio
	 *
	 * @param {number} weightRatio Object Weight/Basic Lift
	 *
	 * @returns {number}
	 */
	function distanceModifier(weightRatio) {
	
		let distanceMod = 0;
	
		if (weightRatio <= .05) {
			distanceMod = 3.5;
		} else if (.05 < weightRatio && weightRatio <= .10) {
			distanceMod = 2.5;
		} else if (.10 < weightRatio && weightRatio <= .15) {
			distanceMod = 2.0;
		} else if (.15 < weightRatio && weightRatio <= .20) {
			distanceMod = 1.5;
		} else if (.20 < weightRatio && weightRatio <= .25) {
			distanceMod = 1.2;
		} else if (.25 < weightRatio && weightRatio <= .30) {
			distanceMod = 1.1;
		} else if (.30 < weightRatio && weightRatio <= .40) {
			distanceMod = 1.0;
		} else if (.40 < weightRatio && weightRatio <= .50) {
			distanceMod = .8;
		} else if (.50 < weightRatio && weightRatio <= .75) {
			distanceMod = .7;
		} else if (.75 < weightRatio && weightRatio <= 1.00) {
			distanceMod = .6;
		} else if (1.00 < weightRatio && weightRatio <= 1.50) {
			distanceMod = .4;
		} else if (1.50 < weightRatio && weightRatio <= 2.0) {
			distanceMod = .30;
		} else if (2.0 < weightRatio && weightRatio <= 2.5) {
			distanceMod = .25;
		} else if (2.5 < weightRatio && weightRatio <= 3.0) {
			distanceMod = .20;
		} else if (3.0 < weightRatio && weightRatio <= 4.0) {
			distanceMod = .15;
		} else if (4.0 < weightRatio && weightRatio <= 5.0) {
			distanceMod = .12;
		} else if (5.0 < weightRatio && weightRatio <= 6.0) {
			distanceMod = .10;
		} else if (6.0 < weightRatio && weightRatio <= 7.0) {
			distanceMod = .09;
		} else if (7.0 < weightRatio && weightRatio <= 8.0) {
			distanceMod = .08;
		} else if (8.0 < weightRatio && weightRatio <= 9.0) {
			distanceMod = .07;
		} else if (9.0 < weightRatio && weightRatio <= 10.0) {
			distanceMod = .06;
		} else if (10.0 < weightRatio && weightRatio <= 12.0) {
			distanceMod = .05;
		} else {
			distanceMod = 0;
		}
	
		return distanceMod;
	
	}
	
	/**
	 * Determines the final damage dice + modifier
	 * 
	 * @param {string} damageDice Original damage dice; 3d6
	 * @param {number} damageMod  Damage modifier per dice; +1 per dice
	 * 
	 * @returns {string} Modified damage dice
	 */
	function getModifiedDamage(damageDice, damageMod) {
	
		let newDamageDice = String(damageDice);
	
		damageDice = String(damageDice).toLowerCase();
	
		// split into array. 
		// 3d6 = [3,6]
		let arrDice = String(damageDice).split("d");
	
		if (arrDice.length == 2) {
	
			let diceCount = parseInt(arrDice[0]);
	
			let diceType = arrDice[1];
	
			let arrDiceTypeModifier = [];
	
			let diceModifier = 0;
	
			if (diceCount < 1) {
				diceCount = 1;
			}
	
			// check for dice modifier
			// 3d6+1; diceType = 6+1; diceType=6; diceModifier=1;
			if (diceType && diceType.includes("+")) {
	
				arrDiceTypeModifier = diceType.split("+");
	
				diceType = arrDiceTypeModifier[0];
	
				diceModifier = parseInt(arrDiceTypeModifier[1]);
	
			} else if (diceType && diceType.includes("-")) {
	
				arrDiceTypeModifier = diceType.split("-");
	
				diceType = arrDiceTypeModifier[0];
	
				diceModifier = -1 * parseInt(arrDiceTypeModifier[1]);
	
			} else {
	
				diceModifier = 0;
	
			}
	
			newDamageDice = diceCount + "d" + diceType;
	
			// get the final damage modifier
			damageMod = Math.floor(damageMod + diceModifier);
	
			if (damageMod < 0) {
	
				damageMod = Math.abs(damageMod) * diceCount;
	
				newDamageDice = newDamageDice + "-" + damageMod;
	
			} else if (damageMod > 0) {
	
				damageMod = Math.abs(damageMod) * diceCount;
	
				newDamageDice = newDamageDice + "+" + damageMod;
	
			}
	
		}
	
		return newDamageDice;
	
	}
	
	on("clicked:range_calc_reset", async () => {

		await resetRangeCalculator();

		await setAttrsAsync({roll_modifier_types: "ranged"});

		resetRollModifiersToolBox(applyRollModifiers);

	
	});
	
	resetRangeCalculator = async () => {
	
		await setAttrsAsync(
			{
				"firing_distance": 0,
				"firing_speed_difference": 0,
				"firing_size_mod": 0,
				"firing_elevation": 0,
				"firing_acc": 0,
				"firing_braced": 0,
				"firing_aiming_bonus": 0,
				"firing_rof": 0,
			});
	
	}
	
	// Range Calculator
	on('change:firing_distance change:firing_speed_difference change:firing_size_mod change:firing_elevation change:firing_acc change:firing_aiming_bonus change:firing_rof change:firing_braced', function (event) {
	
		updateRangeModifier("calculator");
	
	});
	
	on("clicked:apply_firing_modifiers", function () {
		updateRangeModifier("tool");
	});
	
	/**
	 * Determine new range based on fields
	 * and then get the final to hit modifier
	 * applyTo = calculator. Update the ranged calculator
	 *         = tool. Update the modifier boxes and the roll modifier dialog tool.
	 * 
	 * @param {string} applyTo Select set of fields: calculator | tool
	 */
	function updateRangeModifier(applyTo) {
	
		let fields = [
			"firing_distance",
			"firing_speed_difference",
			"firing_size_mod",
			"firing_elevation",
			"firing_acc",
			"firing_aiming_bonus",
			"firing_rof",
			"firing_braced",
			"size"
		];
	
		getAttrs(fields, function (values) {
	
			let linearDistance = Number(values.firing_distance);
	
			let sizeMod = Number(values.firing_size_mod);
	
			let characterSize = Number(values.size) || 0;
	
			// calculate the final size modifier
			sizeMod = sizeMod + characterSize;
	
			let speed = Number(values.firing_speed_difference);
	
			let elevation = Number(values.firing_elevation);
	
			let acc = Number(values.firing_acc);
	
			let aiming = Number(values.firing_aiming_bonus);

			let braced = Number(values.firing_braced);
	
			let rof = Number(values.firing_rof);
	
			let rofModifier = getRateOfFireModifier(rof);
	
			let elevationDown = 0;
	
			let rangeToTarget = 0;
	
			let speedRangeValue = 0;
	
			let finalSpeedRangeValue = 0;
	
			let rangedRollModSummary = "";
	
			// make sure value is valid
			if (linearDistance < 0)
				linearDistance = 0;
	
			if (elevation < 0) {
	
				rangeToTarget = linearDistance - elevation;
	
			} else if (elevation > 0) {
	
				elevationDown = Math.floor(elevation / 2);
	
				// max elevation is half of ground distance
				if (elevationDown > Math.floor(linearDistance / 2)) {
	
					elevationDown = Math.floor(linearDistance / 2);
	
				}
	
				rangeToTarget = linearDistance - elevationDown;
	
			} else {
	
				rangeToTarget = linearDistance;
	
			}
	
			finalSpeedRangeValue = rangeToTarget + speed;
	
			let rangeModifier = getModBySpeedRange(finalSpeedRangeValue);
	
			// add in size modifier
			let hitModifier = rangeModifier + sizeMod + acc + aiming + rofModifier + braced;
	
			let updates;
	
			if (applyTo == "tool") {
	
				if (acc) {
	
					rangedRollModSummary += `+${acc} ACC\n`;
	
				}
	
				if (aiming) {
	
					rangedRollModSummary += `+${aiming} Aiming\n`;
	
				}
	
				if (braced) {
	
					rangedRollModSummary += `+${braced} Braced\n`;
	
				}
	
				if (rofModifier) {
	
					rangedRollModSummary += `+${rofModifier} RoF [${rof} shots fired]\n`;
	
				}
	
				if (rangeModifier) {
	
					rangedRollModSummary += `${rangeModifier} Speed/Range\n`;
	
				}
	
				if (sizeMod) {
	
					rangedRollModSummary += `${sizeMod} Size Modifier\n`;
	
				}

				let hitModifierStatus = "neutral";

				if (hitModifier > 0) {
					hitModifierStatus = "positive";
				} else if (hitModifier < 0) {
					hitModifierStatus = "negative";
				}
	
				updates = {
					ranged_roll_modifier_status: hitModifierStatus,
					ranged_roll_modifier: hitModifier,
					ranged_roll_modifier_summary: rangedRollModSummary,
					target_size_modifier: sizeMod,
					ranged_accuracy_bonus: acc,
					ranged_aiming_bonus: aiming,
					ranged_braced: braced,
					ranged_rof: rof,
					ranged_elevation: elevation,
					ranged_range_speed: linearDistance + speed
				};
	
			} else {
	
				updates = {
					firing_new_range: finalSpeedRangeValue,
					firing_hit_mod: hitModifier
				};
	
			}
	
			setAttrs(updates);
	
		});
	
	}
	
	// check to see if modifier for fright check threshold changed
	on("change:fright_check_threshold_mod", function (event) {
	
		updateFrightCheckThreshold();
	
	});
	
	function updateFrightCheckThreshold() {
	
		const fields = [
			"fright_check_threshold_mod"
		];
	
		getAttrs(fields, function (values) {
	
			let base = 13;
	
			let mod = +values.fright_check_threshold_mod;
	
			let final = base + mod;
	
			setAttrs({
				"fright_check_threshold": final
			});
	
		});
	
	}
	
	// when button is clicked, show the updates tab
	on("clicked:view_updates_tab", function () {
	
		setAttrs({
			"tab": 7
		});
	
	});
	
	on("change:yards_fallen change:gravity change:atmosphere", function () {
	
		const fields = [
			"yards_fallen",
			"gravity",
			"atmosphere",
		];
	
		getAttrs(fields, function (values) {
	
			let yards = Math.floor(+values.yards_fallen);
	
			let gravity = +values.gravity;
	
			let atmosphere = +values.atmosphere;
	
			if (yards <= 0)
				yards = 1;
	
			if (gravity < 0)
				gravity = 1;
	
			if (atmosphere < 0)
				atmosphere = 1;
	
			let velocity = Math.sqrt(gravity * 21.4 * yards);
	
			let terminalVelocityMultiplier = Math.sqrt(gravity) / Math.sqrt(atmosphere);
	
			// round to 2 digits
			let terminalVelocityMultiplierDisplay = Number(Math.round(terminalVelocityMultiplier * 100) / 100).toFixed(2);
	
			velocity = Math.round(velocity);
	
			setAttrs({
				falling_velocity: velocity,
				terminal_velocity_multiplier: terminalVelocityMultiplierDisplay,
			});
	
		});
	
	});
	
	// handle falling/collision damage
	on("change:falling_velocity change:falling_hit_points change:falling_hard_object change:falling_damage_divisor", function () {
	
		let strDmg = "";
	
		getAttrs(["falling_velocity", "falling_hit_points", "falling_hard_object", "falling_damage_divisor"], function (values) {
	
			let hitPoints = Number(values.falling_hit_points);
	
			const isHardObject = values.falling_hard_object === "1";
	
			if (isHardObject) {
				hitPoints = hitPoints * 2;
			}

			let damageDivisor = Number(values.falling_damage_divisor) ?? 1;
	
			strDmg = getCollisionDamage(values.falling_velocity, hitPoints, 0, damageDivisor);
	
			setAttrs({
				"falling_damage": strDmg
			});
	
		});
	
	});
	
	on("change:collision_velocity change:collision_hit_points change:collision_hard_object change:collision_damage_divisor", function () {
	
		let strDmg = "";
	
		getAttrs(["collision_velocity", "collision_hit_points", "collision_hard_object", "collision_damage_divisor"], function (values) {
	
			let hitPoints = Number(values.collision_hit_points);
	
			const isHardObject = values.collision_hard_object === "1";
	
			if (isHardObject) {
				hitPoints = hitPoints * 2;
			}

			let damageDivisor = Number(values.collision_damage_divisor) ?? 1;
	
			strDmg = getCollisionDamage(values.collision_velocity, hitPoints, 0, damageDivisor);
	
			setAttrs({
				"collision_damage": strDmg
			});
	
		});
	
	});
	
	function getCollisionDamage(velocity, hit_points, customDamageModifier = 0, damageDivisor = 1) {
	
		let strDmg = "1d6-3";
	
		let remainder = 0;

		let dieModifier = customDamageModifier;
	
		velocity = +velocity;
	
		if (velocity <= 0) {
			velocity = 1;
		}
	
		hit_points = +hit_points;
	
		if (hit_points <= 0) {
			hit_points = 1;
		}
	
		let ratio = (hit_points * velocity) / 100;
	
		if (ratio <= .25) {
	
			strDmg = "1d6";

			dieModifier = dieModifier - 3;
	
		} else if (ratio <= .5) {
	
			strDmg = "1d6";

			dieModifier = dieModifier - 2;
	
		} else if (ratio < 1) {
	
			strDmg = "1d6";

			dieModifier = dieModifier - 1;
	
		} else {
	
			remainder = ratio % 1;
	
			if (remainder < .5) {
				strDmg = Math.floor(ratio) + "d6";
			} else {
				strDmg = Math.ceil(ratio) + "d6";
			}
	
		}

		if (dieModifier > 0) {

			strDmg = `${strDmg}+${dieModifier}`;
		
			if (damageDivisor > 1) {
				strDmg = `floor((${strDmg})/2)`;
			}
		
		} else if (dieModifier < 0) {
		
			strDmg = `${strDmg}${dieModifier}`
	
			if (damageDivisor > 1) {
				strDmg = `floor((${strDmg})/2)`;
			}
		
		} else if (damageDivisor > 1) {
			strDmg = `floor((${strDmg})/2)`;
		}

		
		return strDmg;
	}

	// update damage notes by type
	["falling", "collision", "slam"].forEach(type => {

		on(`change:${type}_damage_type`, (event) => {

			updateDamageTypeNotes(type);
	
		});

	});

	/**
	 * Update damage type notes for a specific type of damage.
	 * 
	 * @param string type falling|collision|slam
	 */
	function updateDamageTypeNotes(type) {

		getAttrs([`${type}_damage_type`,
			'damage_type_note_cut',
			'damage_type_note_imp',
			'damage_type_note_cr',
			'damage_type_note_pi_minus',
			'damage_type_note_pi',
			'damage_type_note_pi_plus',
			'damage_type_note_pi_plus_plus',
			'damage_type_note_aff',
			'damage_type_note_burn',
			'damage_type_note_cor',
			'damage_type_note_fat',
			'damage_type_note_tox',
			'damage_type_note_spec',
			'damage_type_note_knockback'
		], (values) => {
	
			const damageType = `${type}_damage_type`;

			const typeNote = getDamageTypeNote(values[damageType], values);
	
			const minDamageNote = getMinimumDamageNote(damageType);

			let damageDivisor = 2;

			if (values[damageType] === "Crushing (cr)") {
				damageDivisor = 1;
			}

			let updateFields = {};

			updateFields[`${type}_damage_divisor`] = damageDivisor;

			updateFields[`${type}_damage_type_note`] = typeNote;

			updateFields[`${type}_minimum_damage_note`] = minDamageNote;
	
			setAttrs(updateFields);
	
		});

	}
	
	on("clicked:falling_reset", function () {
	
		setAttrs({
			"yards_fallen": 1,
			"gravity": 1,
			"atmosphere": 1,
			"falling_hit_points": 10,
			terminal_velocity_multiplier: 1,
			falling_hard_object: 0,
		});
	
	});
	
	on("clicked:collision_reset", function () {
	
		setAttrs({
			collision_velocity: 1,
			collision_hit_points: 10,
			collision_hard_object: 0,
		});
	
	});
	
	// TODO: Update to check for new defense types
	// If defense type changed, update hidden defense type
	on('change:repeating_defense:type', function (event) {
	
		getAttrs(['repeating_defense_type'], function (v) {
	
			let defenseTypeName = String(v.repeating_defense_type);
	
			let defenseTypeId = 1;
	
			// 		    <option>Dodge</option> = 1
			// 			<option>Parry</option> = 2
			// 			<option>Block</option> = 3
			// 			<option>Magic</option> = 4
			// 			<option>Other</option> = 5
	
			defenseTypeName = defenseTypeName.toLowerCase();
	
			switch (defenseTypeName) {
	
				case "parry":
					defenseTypeId = 2;
					break;
	
				case "block":
					defenseTypeId = 3;
					break;
	
				case "magic":
					defenseTypeId = 4;
					break;
	
				case "block":
					defenseTypeId = 5;
					break;
	
				default:
				case "dodge":
					defenseTypeId = 1;
					break;
	
			}
	
			// set the hidden value
			setAttrs({
				repeating_defense_defense_type: defenseTypeId
			});
	
		});
	
	});
	
	/**
	 * When loading a new version, make sure defense_type is updated
	 * for each item in the row.
	 */
	function updateRepeatingDefenseTypes() {
	
		console.log('********* updateRepeatingDefenseTypes *********');
	
		const sectionName = "repeating_defense";
	
		getSectionIDs(sectionName, function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let getFields = [];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines defense type
				let damageTypeField = "repeating_defense_" + ids[i] + '_type';
	
				getFields.push(damageTypeField);
	
			}
	
			getAttrs(getFields, function (values) {
	
				let updateFields = {};
	
				// loop through the row ids again so we can get the values
				// and fill array of defense_type id numbers
				_.each(ids, function (id) {
	
					let defenseTypeField = "repeating_defense_" + id + '_type';
	
					// field we need to update
					let defenseTypeIdField = "repeating_defense_" + id + '_defense_type';
	
					let defenseName = String(values[defenseTypeField]);
	
					// determine id based on defense type name
					let defenseTypeId = 0;
	
					// TODO: Update for new defense types
					switch (defenseName.toLowerCase()) {
	
						case "parry":
							defenseTypeId = 2;
							break;
	
						case "block":
							defenseTypeId = 3;
							break;
	
						case "magic":
							defenseTypeId = 4;
							break;
	
						case "block":
							defenseTypeId = 5;
							break;
	
						default:
						case "dodge":
							defenseTypeId = 1;
							break;
	
					}
	
					// update the defense type id number
					updateFields[defenseTypeIdField] = defenseTypeId;
	
				});
	
				setAttrs(updateFields);
	
			});
	
		});
	
	}
	
	on("change:damage_type_note_cut", function () {
	
		getAttrs(["damage_type_note_cut"], function (values) {
	
			updateMeleeCombatWoundNotes("Cutting (cut)", values.damage_type_note_cut);
	
			updateRangedCombatWoundNotes("Cutting (cut)", values.damage_type_note_cut);
	
			updateCombatToolThrownDamageType("Cutting (cut)", values.damage_type_note_cut);
	
		});
	
	});
	
	on("change:damage_type_note_imp", function () {
	
		getAttrs(["damage_type_note_imp"], function (values) {
	
			updateMeleeCombatWoundNotes("Impaling (imp)", values.damage_type_note_imp);
	
			updateRangedCombatWoundNotes("Impaling (imp)", values.damage_type_note_imp);
	
			updateCombatToolThrownDamageType("Impaling (imp)", values.damage_type_note_imp);
	
		});
	
	});
	
	on("change:damage_type_note_cr", function () {
	
		getAttrs(["damage_type_note_cr"], function (values) {
	
			updateMeleeCombatWoundNotes("Crushing (cr)", values.damage_type_note_cr);
	
			updateRangedCombatWoundNotes("Crushing (cr)", values.damage_type_note_cr);
	
			updateCombatToolThrownDamageType("Crushing (cr)", values.damage_type_note_cr);
	
		});
	
	});
	
	on("change:damage_type_note_pi_minus", function () {
	
		getAttrs(["damage_type_note_pi_minus"], function (values) {
	
			updateMeleeCombatWoundNotes("Small Piercing (pi-)", values.damage_type_note_pi_minus);
	
			updateRangedCombatWoundNotes("Small Piercing (pi-)", values.damage_type_note_pi_minus);
	
			updateCombatToolThrownDamageType("Small Piercing (pi-)", values.damage_type_note_pi_minus);
	
		});
	
	});
	
	on("change:damage_type_note_pi", function () {
	
		getAttrs(["damage_type_note_pi"], function (values) {
	
			updateMeleeCombatWoundNotes("Piercing (pi)", values.damage_type_note_pi);
	
			updateRangedCombatWoundNotes("Piercing (pi)", values.damage_type_note_pi);
	
			updateCombatToolThrownDamageType("Piercing (pi)", values.damage_type_note_pi);
	
		});
	
	});
	
	on("change:damage_type_note_pi_plus", function () {
	
		getAttrs(["damage_type_note_pi_plus"], function (values) {
	
			updateMeleeCombatWoundNotes("Large Piercing (pi+)", values.damage_type_note_pi_plus);
	
			updateRangedCombatWoundNotes("Large Piercing (pi+)", values.damage_type_note_pi_plus);
	
			updateCombatToolThrownDamageType("Large Piercing (pi+)", values.damage_type_note_pi_plus);
	
		});
	
	});
	
	on("change:damage_type_note_pi_plus_plus", function () {
	
		getAttrs(["damage_type_note_pi_plus_plus"], function (values) {
	
			updateMeleeCombatWoundNotes("Huge Piercing (pi++)", values.damage_type_note_pi_plus_plus);
	
			updateRangedCombatWoundNotes("Huge Piercing (pi++)", values.damage_type_note_pi_plus_plus);
	
			updateCombatToolThrownDamageType("Huge Piercing (pi++)", values.damage_type_note_pi_plus_plus);
	
		});
	
	});
	
	on("change:damage_type_note_aff", function () {
	
		getAttrs(["damage_type_note_aff"], function (values) {
	
			updateMeleeCombatWoundNotes("Affliction (aff)", values.damage_type_note_aff);
	
			updateRangedCombatWoundNotes("Affliction (aff)", values.damage_type_note_aff);
	
			updateCombatToolThrownDamageType("Affliction (aff)", values.damage_type_note_aff);
	
		});
	
	});
	
	on("change:damage_type_note_burn", function () {
	
		getAttrs(["damage_type_note_burn"], function (values) {
	
			updateMeleeCombatWoundNotes("Burning (burn)", values.damage_type_note_burn);
	
			updateRangedCombatWoundNotes("Burning (burn)", values.damage_type_note_burn);
	
			updateCombatToolThrownDamageType("Burning (burn)", values.damage_type_note_burn);
	
		});
	
	});
	
	on("change:damage_type_note_cor", function () {
	
		getAttrs(["damage_type_note_cor"], function (values) {
	
			updateMeleeCombatWoundNotes("Corrosion (cor)", values.damage_type_note_cor);
	
			updateRangedCombatWoundNotes("Corrosion (cor)", values.damage_type_note_cor);
	
			updateCombatToolThrownDamageType("Corrosion (cor)", values.damage_type_note_cor);
	
		});
	
	});
	
	on("change:damage_type_note_fat", function () {
	
		getAttrs(["damage_type_note_fat"], function (values) {
	
			updateMeleeCombatWoundNotes("Fatigue (fat)", values.damage_type_note_fat);
	
			updateRangedCombatWoundNotes("Fatigue (fat)", values.damage_type_note_fat);
	
			updateCombatToolThrownDamageType("Fatigue (fat)", values.damage_type_note_fat);
	
		});
	
	});
	
	on("change:damage_type_note_tox", function () {
	
		getAttrs(["damage_type_note_tox"], function (values) {
	
			updateMeleeCombatWoundNotes("Toxic (tox)", values.damage_type_note_tox);
	
			updateRangedCombatWoundNotes("Toxic (tox)", values.damage_type_note_tox);
	
			updateCombatToolThrownDamageType("Toxic (tox)", values.damage_type_note_tox);
	
		});
	
	});
	
	on("change:damage_type_note_spec", function () {
	
		getAttrs(["damage_type_note_spec"], function (values) {
	
			updateMeleeCombatWoundNotes("Special (spec)", values.damage_type_note_spec);
	
			updateRangedCombatWoundNotes("Special (spec)", values.damage_type_note_spec);
	
			updateCombatToolThrownDamageType("Special (spec)", values.damage_type_note_spec);
	
		});
	
	});
	
	on("change:damage_type_note_knockback", function () {
	
		getAttrs(["damage_type_note_knockback"], function (values) {
	
			updateMeleeCombatWoundNotes("Knockback (knock)", values.damage_type_note_knockback);
	
			updateRangedCombatWoundNotes("Knockback (knock)", values.damage_type_note_knockback);
	
			updateCombatToolThrownDamageType("Knockback (knock)", values.damage_type_note_knockback);
	
		});
	
	});
	
	/**
	 * Update the damage types for repeating tables
	 * Find damage types that match the one that was updated.
	 * Replace the note with the new note.
	 * 
	 * @param {string} damageType Type of damage to update
	 * @param {string} damageNote Damage note to use
	 */
	function updateMeleeCombatWoundNotes(damageType, damageNote) {
	
		let updateAttrs = {};
	
		// repeating_melee | repeating_ranged
	
		getSectionIDs("repeating_melee", function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let getFields = [];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines defense type
				let damageTypeField = "repeating_melee_" + ids[i] + '_type';
	
				getFields.push(damageTypeField);
	
			}
	
			getAttrs(getFields, function (values) {
	
				let updateFields = {};
	
				// loop through the row ids again so we can get the values
				// and fill array of defense_type id numbers
				_.each(ids, function (id) {
	
					let damageTypeField = "repeating_melee_" + id + '_type';
	
					// field we need to update
					let fieldToUpdate = "repeating_melee_" + id + '_damage_type_note';
	
					let damageTypeValue = values[damageTypeField];
	
					if (damageTypeValue === damageType) {
	
						// update the defense type id number
						updateFields[fieldToUpdate] = damageNote;
	
					}
	
				});
	
				setAttrs(updateFields);
	
			});
	
		});
	
	}
	
	/**
	 * Update the damage types for repeating tables
	 * Find damage types that match the one that was updated.
	 * Replace the note with the new note.
	 * 
	 * @param {string} damageType Type of damage to update
	 * @param {string} damageNote Damage not to use
	 */
	function updateRangedCombatWoundNotes(damageType, damageNote) {
	
		let updateAttrs = {};
	
		getSectionIDs("repeating_ranged", function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let getFields = [];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines defense type
				let damageTypeField = "repeating_ranged_" + ids[i] + '_type';
	
				getFields.push(damageTypeField);
	
			}
	
			getAttrs(getFields, function (values) {
	
				let updateFields = {};
	
				// loop through the row ids again so we can get the values
				// and fill array of defense_type id numbers
				_.each(ids, function (id) {
	
					let damageTypeField = "repeating_ranged_" + id + '_type';
	
					// field we need to update
					let fieldToUpdate = "repeating_ranged_" + id + '_damage_type_note';
	
					let damageTypeValue = values[damageTypeField];
	
					if (damageTypeValue === damageType) {
	
						// update the defense type id number
						updateFields[fieldToUpdate] = damageNote;
	
					}
	
				});
	
				setAttrs(updateFields);
	
			});
	
		});
	
	}
	
	/**
	 * Update the damage type now for the combat tool thrown damage
	 * 
	 * @param {string} damageType
	 * @param {string} damageNote
	 */
	function updateCombatToolThrownDamageType(damageType, damageNote) {
	
		getAttrs(["thrown_object_damage_type"], function (values) {
	
			if (damageType === values.thrown_object_damage_type) {
	
				setAttrs({
					"thrown_object_damage_type_note": damageNote,
				});
	
			}
	
		});
	
	}
	
	on("change:repeating_defense:info", function (event) {
	
		updateDefenseNote();
	
	});
	
	/**
	 * Update the defense note.
	 */
	function updateDefenseNote() {
	
		getAttrs(['repeating_defense_info'], function (values) {
	
			let defenseInfo = "";
	
			if (values) {
				defenseInfo = values.repeating_defense_info;
			}
	
			let note = getDefenseNote(defenseInfo);
	
			// update the note
			setAttrs({
				repeating_defense_info_description: note
			});
	
		});
	
	}
	
	/**
	 * Get defense note based on initial defense info field
	 * 
	 * @param {string} defenseInfo
	 * 
	 * @returns {string}
	 */
	function getDefenseNote(defenseInfo) {
	
		let note = "";
	
		if (typeof defenseInfo === "string") {
	
			switch (defenseInfo.toLowerCase()) {
	
				case "u":
					note = "Info: U\nThe weapon is unbalanced. You cannot use it to parry if you've already attacked with it this turn. See B269";
					break;
	
				case "f":
					note = "Info: F\nThis is a fencing weapon. +3 to retreat, instead of +1. -2 for each additional parry for the round. See B269";
					break;
	
			}
	
		}
	
		return note;
	
	}
	
	/**
	 * Update the static defense success/fail notes
	 */
	function updateStaticNotes() {
	
		const fields = {
			"raw_dodge_success_notes": getNotesByCode("dodge_success_notes"),
			"raw_dodge_critical_success_notes": getNotesByCode("dodge_critical_success_notes"),
			"raw_dodge_fail_notes": getNotesByCode("dodge_fail_notes"),
			"raw_dodge_critical_fail_notes": getNotesByCode("dodge_critical_failure_notes"),
			"raw_dodge_retreat_success_notes": getNotesByCode("dodge_retreat_success_notes"),
			"raw_dodge_retreat_critical_success_notes": getNotesByCode("dodge_retreat_critical_success_notes"),
			"raw_dodge_retreat_fail_notes": getNotesByCode("dodge_fail_notes"),
			"raw_dodge_retreat_critical_fail_notes": getNotesByCode("dodge_critical_failure_notes"),
			"raw_dodge_drop_success_notes": getNotesByCode("dodge_success_notes"),
			"raw_dodge_drop_critical_success_notes": getNotesByCode("dodge_critical_success_notes"),
			"raw_dodge_drop_fail_notes": getNotesByCode("dodge_fail_notes"),
			"raw_dodge_drop_critical_fail_notes": getNotesByCode("dodge_critical_failure_notes"),
			"raw_critical_miss_notes": getNotesByCode("critical_miss_notes"),
			"raw_critical_hit_notes": getNotesByCode("critical_hit_notes"),
			"raw_slam_attack_notes": getNotesByCode("slam_attack_notes"),
			"raw_slam_damage_notes": getNotesByCode("slam_damage_notes")
		};
	
		setAttrs(fields);
	
	}
	
	function checkUpdateDefaultSlamValues() {

		getAttrs(["is_slam_attack_new", "hit_points_max"], (values) => {

			// if new, set the hit points and default link to DX
			if (values.is_slam_attack_new === "1") {

				let hitPoints = Number(values.hit_points_max);

				if (Number.isNaN(hitPoints)) {
					hitPoints = 10;
				}

				const slamST = Math.floor(hitPoints/2);

				// get the damageType object (strength, thrust, swing)
				let damageType = getDamageType(slamST);

				setAttrs({
					slam_hit_points: hitPoints,
					slam_damage_type: "Crushing (cr)",
					slam_link_type: "DX",
					slam_minimum_damage_note: "Min 0",
					slam_minimum_damage: "0",
					is_slam_attack_new: 0,
					slam_overrun_st: slamST,
					slam_overrun_damage: damageType.thrust
				});
			}

		});

	}

	/**
	 * If new version, make sure to update the 
	 * defensive informaton notes and the raw success/fail notes
	 * Will also handle converting old sheets to new combat reflexes for repeating defense
	 * 
	 * @param {boolean} isNewSheet               Is this a brand new sheet
	 * @param {boolean} hasCombatReflexes        Does character sheet have combat reflexes checked
	 * @param {boolean} hasReflexesBeenConverted Has the character sheet already been converted
	 */
	function updateRepeatingDefenseNotes(isNewSheet, hasCombatReflexes,hasReflexesBeenConverted ) {
	
		getSectionIDs("repeating_defense", function (ids) {
	
			if (ids.length === 0) {
				return;
			}
	
			let getFields = [];
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				// field that determines defense info box
				let defenseInfoField = "repeating_defense_" + ids[i] + "_info";
	
				getFields.push(defenseInfoField);
	
				// field that determines defense type
				let defenseTypeField = "repeating_defense_" + ids[i] + "_type";
	
				getFields.push(defenseTypeField);

				// mod field
				let defenseMod = "repeating_defense_" + ids[i] + "_skill_mod";
	
				getFields.push(defenseMod);

				// reason for modification
				let defenseReasonMod = "repeating_defense_" + ids[i] + "_defense_mod_reason";
	
				getFields.push(defenseReasonMod);
	
			}
	
			getAttrs(getFields, function (values) {
	
				// always make sure to mark as converted
				let updateFields = {
					reflexes_converted_to_base_skill: 1
				};

				// loop through the row ids again so we can get the values
				// and fill array of defense_type id numbers
				_.each(ids, function (id) {
	
					let infoField = "repeating_defense_" + id + "_info";
	
					// field we need to update
					let fieldToUpdate = "repeating_defense_" + id + "_info_description";
	
					let infoValue = values[infoField];
	
					// update the defense type id number
					updateFields[fieldToUpdate] = getDefenseNote(infoValue);
	
					// active defense RAW notes
					let typeField = "repeating_defense_" + id + "_type";
	
					let rawNotes = getRawDefenseNotesByType(values[typeField]);
	
					updateFields["repeating_defense_" + id + "_raw_success_note"] = rawNotes.success;
	
					updateFields["repeating_defense_" + id + "_raw_critical_success_note"] = rawNotes.successCritical;
	
					updateFields["repeating_defense_" + id + "_raw_fail_note"] = rawNotes.fail;
	
					updateFields["repeating_defense_" + id + "_raw_critical_fail_note"] = rawNotes.failCritical;

					// see if we need to update combat reflexes
					const reflexFields = convertCombatReflexesToBaseSkill(values, id, isNewSheet, hasCombatReflexes, hasReflexesBeenConverted);

					// combine the fields
					updateFields = {...updateFields, ...reflexFields};
	
				});

				setAttrs(updateFields);
	
			});
	
		});
	
	}

	/**
	 * If an old sheet that has combat reflexes but hasn't been converted yet, 
	 * then convert to the new skill base method. 
	 * 
	 * @param {object}  values                   An object values for the current active defense row
	 * @param {string}  id                       The active defense row id
	 * @param {boolean} isNewSheet               Is this a brand new sheet
	 * @param {boolean} hasCombatReflexes        Was combat reflexes checked
	 * @param {boolean} hasReflexesBeenConverted Was combat reflexes already converted to modify base skill level
	 * 
	 * @return {object} 
	 */
	const convertCombatReflexesToBaseSkill = (values, id, isNewSheet, hasCombatReflexes, hasReflexesBeenConverted) => {

		let fields = {};

		// only convert old sheetd that haven't been converted
		if (isNewSheet === false && hasReflexesBeenConverted === false && hasCombatReflexes) {

			// mod field
			const defenseModField = "repeating_defense_" + id + "_skill_mod";

			// reason for modification
			const defenseReasonModField = "repeating_defense_" + id + "_defense_mod_reason";

			// checkbox field for line item combat reflexes
			// NOTE: changing the value should trigger a hook to update the base skill level
			const reflexCheckboxField = "repeating_defense_" + id + "_defense_combat_reflexes";

			// update the hidden checkbox field
			const reflexBonusField = "repeating_defense_" + id +"_defense_combat_reflexes_bonus";

			const currentMod = Number(values[defenseModField]);

			const currentReasonMod = String(values[defenseReasonModField]);

			let finalMod = currentMod;

			let finalReasonMod = currentReasonMod;

			// if there's a value for the currentMod, reduce the final mod by one
			if (currentMod > 0) {
				finalMod = finalMod - 1;
			}

			// remove the possible descriptions that could have been added
			// either programmatically or manually by sheet user
			finalReasonMod = currentReasonMod.replace("[+1 from combat reflexes]", "");
			finalReasonMod = currentReasonMod.replace("+1 from combat reflexes.", "");
			finalReasonMod = currentReasonMod.replace("+1 from combat reflexes,", "");
			finalReasonMod = currentReasonMod.replace("+1 from combat reflexes", "");

			// set the new field values
			fields[defenseModField] = finalMod;
			
			fields[defenseReasonModField] = finalReasonMod;

			// check mark the reflexes box and apply the bonus
			fields[reflexCheckboxField] = "1";

			fields[reflexBonusField] = "1";

		}

		return fields;

	};
	
	on("change:repeating_item:carried", async (event) => {
	
		if (event.sourceType === "player") {

			let checked = event.newValue;

			let parentId = getRowIdFromEventInfo(event, "repeating_item");

			await updateCarriedStatusOfChildrenAsync(parentId, checked);

		}
		
	});

	on("clicked:sort_inventory", async (event) => {

		await sortIndentInventoryAsync();
		
	});

	/**
	 * We're going to generate an inventory tree and use that to find
	 * child items of the parentId and update their checked status.
	 * Which will trigger updating totals.
	 * see: https://typeofnan.dev/an-easy-way-to-build-a-tree-with-object-references/
	 */
	let updateCarriedStatusOfChildrenAsync = async (parentId, checked) => {

		const treeData = await getTreeData("item");

		const inventoryTree = getTreeStructure(treeData);

		const parentItem = searchTree(inventoryTree, parentId);

		const descendantIds = getDescendantIdsFromParent(parentItem);

		// only run if we have al least one descendant
		if (descendantIds.length > 0) {

			let fieldsToUpdate = {};

			descendantIds.forEach(id => {

				let itemCheckFieldName = `repeating_item_${id}_carried`;

				fieldsToUpdate[itemCheckFieldName] = checked;

			});

			setAttrs(fieldsToUpdate);

		}
		
	};

	let sortIndentInventoryAsync = async () => {

		let treeData = await getTreeData("item");

		// before making the tree, let's sort everything
		// see: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
		treeData = treeData.sort((item1, item2) => {

			const item1Name = item1.name.toUpperCase();

			const item2Name = item2.name.toUpperCase();

			if (item1Name < item2Name) {
				return -1;
			}

			if (item1Name > item2Name) {
				return 1;
			}

			// names must be equeal
			return 0;

		});

		const inventoryTree = getTreeStructure(treeData);

		// this will get the row ids in the correct order.
		const inventoryRowIds = getRowIdsUsingTree([], inventoryTree);

		// get all the indent levels of each item.
		// indent must start at -1 because we have a "root" level that 
		// is the base of the tree but not used.
		const inventoryItemIndentLevels = getIndentLevelsUsingTree("item", {}, inventoryTree, -1);

		// now update the indent levels
		await setAttrsAsync(inventoryItemIndentLevels);

		setSectionOrder("item", inventoryRowIds);

	};

	/**
	 * Gets an array of each inventory item as an object; id, name, parentId
	 * This can be used to generate a tree structure.
	 * 
	 * @return array
	 */
	let getTreeData = async (section) => {

		// this is our root of our tree. They key is setting parentId = null
		let baseRoot = {
			id: "root",
			name: "root",
			parentId: null,
			children: []
		};

		let treeData = [baseRoot];

		let ids = await getSectionIDsAsync(`repeating_${section}`);

		if (ids === undefined || ids.length == 0) {
			return treeData;
		}

		// index will correspond with indexes for ids!
		let fieldsToGet = [];

		ids.forEach( id => {

			let itemNameField = `repeating_${section}_${id}_name`;

			let itemParentIdField = `repeating_${section}_${id}_parent_id`;

			fieldsToGet.push(itemNameField);

			fieldsToGet.push(itemParentIdField);

		});

		let values = await getAttrsAsync(fieldsToGet);

		// now we can loop through ids again and find the values we need.
		ids.forEach( id => {

			let itemNameField = `repeating_${section}_${id}_name`;

			let itemParentIdField = `repeating_${section}_${id}_parent_id`;

			let nameValue = values[itemNameField];

			let parentIdValue = values[itemParentIdField];

			// if it doesn't have a parent id that means
			// it's a top level item, therefore it's parent is root.
			if (isEmpty(parentIdValue)) {
				parentIdValue = "root";
			}

			let treeItem = {
				id: id,
				name: nameValue,
				parentId: parentIdValue,
				children: []
			};

			treeData.push(treeItem);

		});

		return treeData;

	};

	/**
	 * Generates a tree structure based on array of objects; id, name, parentId
	 * see: https://typeofnan.dev/an-easy-way-to-build-a-tree-with-object-references/
	 */
	let getTreeStructure = (treeData) => {

		// Making an ID-to-Array Position Map
		const idMapping = treeData.reduce((acc, el, i) => {
			acc[el.id] = i;
			return acc;
		}, {});

		let root;

		treeData.forEach((el) => {

			// Handle the root element
			if (el.id == "root") {
				root = el;
				return;
			}

			// Use our mapping to locate the parent element in our data array
			const parentEl = treeData[idMapping[el.parentId]];
		
			if (parentEl && parentEl.children !== undefined) {
				// Add our current el to its parent's `children` array
				parentEl.children = [...(parentEl.children || []), el];
			}
				
		});

		return root;

	};

	/**
	 * find a node in a tree by the element id
	 * see: https://stackoverflow.com/a/9133680
	 */
	let searchTree = (node, idToFind) => {

		if(node.id == idToFind) {
        
			return node;
     
		} else if (node.children !== undefined && node.children.length > 0) {
        
			let foundNode = null;
          
			for (let i = 0; foundNode == null && i < node.children.length; i++){
               
				foundNode = searchTree(node.children[i], idToFind);
          
			}
          
			return foundNode;
     	}

    	return null;

	};

	/**
	 * Get an array of descendant ids from a parent node.
	 */
	let getDescendantIdsFromParent = (parentNode, ids = null) => {

		if (ids == null) {
			ids = [];
		}

		if (parentNode.children !== undefined && parentNode.children.length > 0) {

			parentNode.children.forEach(childNode => {

				ids.push(childNode.id);

				if (childNode.children !== undefined && childNode.children.length > 0) {
					ids = getDescendantIdsFromParent(childNode, ids);
				}

			});

		}

		return ids;

	}; 

	/**
	 * Returns an array of inventory objects
	 */
	let getInventoryItems = async() => {

		let ids = await getSectionIDsAsync("repeating_item");

		// index will correspond with indexes for ids!
		let fieldsToGet = [];

		ids.forEach( id => {

			let itemHighlightField = `repeating_item_${id}_highlight`;
			fieldsToGet.push(itemHighlightField);

			let itemItemToggleNotesField = `repeating_item_${id}_item_toggle_notes`;
			fieldsToGet.push(itemItemToggleNotesField);

			let itemIndentLevelField = `repeating_item_${id}_indent_level`;
			fieldsToGet.push(itemIndentLevelField);

			let itemNameField = `repeating_item_${id}_name`;
			fieldsToGet.push(itemNameField);

			let itemLocationField = `repeating_item_${id}_location`;
			fieldsToGet.push(itemLocationField);

			let itemTechLevelField = `repeating_item_${id}_tl`;
			fieldsToGet.push(itemTechLevelField);

			let itemLegalityClassField = `repeating_item_${id}_legality_class`;
			fieldsToGet.push(itemLegalityClassField);

			let itemRefField = `repeating_item_${id}_ref`;
			fieldsToGet.push(itemRefField);

			let itemCarriedField = `repeating_item_${id}_carried`;
			fieldsToGet.push(itemCarriedField);

			let itemCountField = `repeating_item_${id}_count`;
			fieldsToGet.push(itemCountField);

			let itemCostField = `repeating_item_${id}_cost`;
			fieldsToGet.push(itemCostField);

			let itemWeightField = `repeating_item_${id}_weight`;
			fieldsToGet.push(itemWeightField);

			let itemRowIdField = `repeating_item_${id}_row_id`;
			fieldsToGet.push(itemRowIdField);

			let itemParentIdField = `repeating_item_${id}_parent_id`;
			fieldsToGet.push(itemParentIdField);
			
			let itemNotesField = `repeating_item_${id}_notes`;
			fieldsToGet.push(itemNotesField);

		});

		let values = await getAttrsAsync(fieldsToGet);

		return values;

	};

	/**
	 * Get all the data for building the inventory table
	 * 
	 * @param object tableItems     Items for repeating_item table
	 * @param object itemNode       The current node on the tree
	 * @param int    indentLevel    The depth level of the tree.
	 * @param object inventoryItems Original item data from repeating_item talbe
	 * @return object Data for repeating_item
	 */
	let getInventoryTableItems = (tableItems, itemNode, indentLevel, inventoryItems) => {

		// ignore the root level
		if (itemNode.id != "root") {

			// filter objects: https://masteringjs.io/tutorials/fundamentals/filter-object

			// convert object to an array
			const inventoryItemsAsArray = Object.entries(inventoryItems);

			// get filtered data

			// get the data for the inventory usig the row id.
			// example array: ["repeating_item_-mtzce6xvluz3aksvzqo_row_id": "-mtzce6xvluz3aksvzqo", "repeating_item_-mtzce6xvluz3aksvzqo_name": "Purse", key: value]
			const inventoryItemsFiltered = inventoryItemsAsArray.filter( ([key, value]) => {
				return key.includes(itemNode.id);
			});

			// set the indent level
			inventoryItemsFiltered[`repeating_item_${itemNode.id}_indent_level`] = indentLevel;

			// convert to object
			const inventoryData = Object.fromEntries(inventoryItemsFiltered);
			
			// loop through each property and add it to the original tableItems
			Object.keys(inventoryData).forEach( key => {

				tableItems[key] = inventoryData[key];

			});
			
		}

		// get child items
		// now add any children
		if (itemNode.children !== undefined && itemNode.children.length > 0) {

			itemNode.children.forEach(childNode => {

				tableItems = getInventoryTableItems(tableItems, childNode, indentLevel + 1, inventoryItems);

			});

		}
		
		return tableItems;
		
	}

	let getRowIdsUsingTree = (rowIds, itemNode) => {

		// ignore the root level
		if (itemNode.id != "root") {

			rowIds.push(itemNode.id);
			
		}
	
		// get child items
		// now add any children
		if (itemNode.children !== undefined && itemNode.children.length > 0) {
			
			itemNode.children.forEach(childNode => {

				rowIds = getRowIdsUsingTree(rowIds, childNode);

			});

		}

		return rowIds;
	}

	let getIndentLevelsUsingTree = (section, inventoryItemIndentLevels, itemNode, indentLevel) => {

		// ignore the root level
		if (itemNode.id != "root") {

			// set the indent level
			inventoryItemIndentLevels[`repeating_${section}_${itemNode.id}_indent_level`] = indentLevel;

		}

		// get child items
		// now add any children
		if (itemNode.children != undefined && itemNode.children.length > 0) {
	
			itemNode.children.forEach(childNode => {

				inventoryItemIndentLevels = getIndentLevelsUsingTree(section, inventoryItemIndentLevels, childNode, indentLevel + 1);

			});

		}

		return inventoryItemIndentLevels;

	}

	on("change:repeating_item:parent_id", event => {

		if (event.sourceType === "player") {

			let parentId = event.newValue;

			let childId = getRowIdFromEventInfo(event, "repeating_item");

			if (!isEmpty(parentId) && !isEmpty(childId)) {

				updateInventoryLocationName(parentId, childId);
			}

		}		
		
	});

	function updateInventoryLocationName(parentId, childId) {

		const parentNameField = `repeating_item_${parentId}_name`;

		const childLocationField = `repeating_item_${childId}_location`;

		const childIndentField = `repeating_item_${childId}_indent_level`;

		getAttrs([parentNameField], values => {

			const parentName = values[parentNameField];

			if (!isEmpty(parentName)) {

				let updateFields = {};

				updateFields[childLocationField] = parentName;

				// for now just indent one level
				updateFields[childIndentField] = 1;

				setAttrs(updateFields);

			}
			
		});

	}
	
	/**
	 * Returns min. damage note based on damage type
	 * Crush = min. of 0
	 * others = min. of 1
	 *  
	 * @param {string} damageTypeValue Damage type to analyze 
	 * 
	 * @returns {string}
	 */
	function getMinimumDamageNote(damageTypeValue) {
	
		let minDamageNote = "";

		let minZeroDamageTypes = ["Crushing (cr)", "Affliction (aff)", "Special (spec)", "Knockback (knock)"];

		if (minZeroDamageTypes.includes(damageTypeValue)) {
	
			minDamageNote = "Min 0";
	
		} else {
	
			minDamageNote = "Min 1";
	
		}
	
		return minDamageNote;
	
	}
	
	on("change:turning_move_type change:start_velocity change:current_move change:enhanced_move_current change:current_air change:current_water change:change_velocity", function (event) {
	
		updateTurnRadiusMovements();
	
	});
	
	/**
	 * Updates the turn radius and deceleration for selected movement type
	 * based on velocity.
	 * 
	 */
	function updateTurnRadiusMovements() {
	
		getAttrs(["turning_move_type", "start_velocity", "current_move", "enhanced_move_current", "current_air", "current_water", "change_velocity"], function (values) {
	
			let moveType = String(values.turning_move_type);
	
			let velocityStart = Number(values.start_velocity);
	
			let velocityChange = Number(values.change_velocity);
	
			let velocityFinal = 0;
	
			let baseMove = 0;
	
			let turnRadius = 0;
	
			let tightTurnPenalty = 0;
	
			let decelerationPenalty = 0;
	
			if (velocityStart < 0) {
				velocityStart = 0;
			}
	
			velocityFinal = velocityStart + velocityChange;
	
			if (isNaN(velocityFinal) || velocityFinal < 0) {
				velocityFinal = 0;
			}
	
			// get turn penalty based on type.
			switch (moveType.toLowerCase()) {
	
				case "ground":
	
					if (values.enhanced_move_current === "0") {
	
						// normal move, no tight turn penalty
						tightTurnPenalty = 0;
	
						baseMove = getBaseMove(values.current_move);
	
					} else {
	
						baseMove = getBaseMove(values.enhanced_move_current);
	
						// enhanced move has tight turn penalty
						tightTurnPenalty = getTightTurnPenalty(velocityFinal, baseMove);
	
					}
					break;
	
				case "air":
	
					baseMove = getBaseMove(values.current_air);
	
					tightTurnPenalty = getTightTurnPenalty(velocityFinal, baseMove);
	
					break;
	
				case "water":
					baseMove = getBaseMove(values.current_water);
	
					tightTurnPenalty = getTightTurnPenalty(velocityFinal, baseMove);
					break;
	
				default:
					baseMove = 0;
	
					tightTurnPenalty = 0;
			}
	
			// --
			if (velocityChange < 0) {
	
				decelerationPenalty = getDecelerationPenalty(velocityChange, baseMove);
	
			} else {
	
				decelerationPenalty = 0;
	
			}
	
			// --
			if (baseMove && velocityFinal) {
	
				turnRadius = velocityFinal / baseMove;
	
				if (turnRadius <= 1) {
					turnRadius = 1;
				} else {
					turnRadius = Math.floor(turnRadius);
				}
	
			} else {
				turnRadius = 1;
			}
	
			setAttrs({
				"final_velocity": velocityFinal,
				"deceleration_penalty": decelerationPenalty,
				"turn_radius": turnRadius,
				"tight_turn_penalty": tightTurnPenalty,
			});
	
		});
	
	}
	
	/**
	 * Calculate deceleration penalty
	 * See B395
	 * -1 per two full yards/second beyond basic move
	 * 
	 * @param {number} deceleration How much is thing/vehicle slows down by
	 * @param {number} baseMove     base move. 
	 * 
	 * @returns {number}
	 */
	function getDecelerationPenalty(deceleration, baseMove) {
	
		// deceleration needs to be a postive number
		if (deceleration < 0) {
			deceleration = -1 * deceleration;
		}
	
		let difference = 0;
	
		let penalty = 0;
	
		// only get penalty if deceleration is greater than base move
		if (deceleration > baseMove) {
	
			// example: deceleration = 10, baseMove = 3
			//          difference = 10 - 3 = 7
			//          penalty = 7/2 = -3
			difference = deceleration - baseMove;
	
			// note: decelerationDivisor is a constant declared at top of javascript 
			penalty = -1 * Math.floor(difference / decelerationDivisor);
	
		}
	
		return penalty;
	}
	
	/**
	 * Gets base move from a number or two values.
	 * If move = 8/16, basemove = 8.
	 * If move = 8, basemove = 8.
	 * If move = 8/16 (1), basemove = 8.
	 * if move = 8 (1), basemove = 8.
	 */
	function getBaseMove(moveValue) {
	
		let move = 0;
	
		if (moveValue) {
	
			// Remove number in parentheses
			moveValue = moveValue.replace(/ *\([^)]*\)/g, "");
	
			if (moveValue && moveValue.includes("/")) {
	
				// split the value
				// move = 8/16
				// 8 = base move
				// 16 = enhanced move
				const arrMoveValue = moveValue.split("/");
	
				// get first part, convert to number
				move = Number(arrMoveValue[0]);
	
			} else {
	
				move = Number(moveValue);
	
			}
	
		}
	
		if (isNaN(move)) {
			move = 0;
		}
	
		return move;
	}
	
	/**
	 * Determines max velocity for a movement type.
	 * Entered move can't exceed move value.
	 * Example moveValue = 8/16
	 *   if enteredMove = 8, then use it
	 *   if enteredMove = 20, then use 16
	 * 
	 * @param {string} moveValue   Example: 8/16 or 8
	 * @param {number} enteredMove Velocity entered by user
	 * 
	 * @returns {number}
	 */
	function getMaxVelocity(moveValue, enteredMove) {
	
		let maxVelocity = 0;
	
		let move = 0;
	
		let arrMoveValue;
	
		if (moveValue && moveValue.includes("/")) {
	
			// split the value
			// move = 8/16
			// 8 = base move
			// 16 = max move
			arrMoveValue = moveValue.split("/");
	
			// get second part, convert to number
			move = +arrMoveValue[1];
	
		} else {
	
			move = +moveValue;
	
		}
	
		// i.e. entered move = 20, top speed = 16
		// if 20 > 16, then use 16
		if (enteredMove > move) {
	
			maxVelocity = move;
	
		} else {
	
			maxVelocity = enteredMove;
	
		}
	
		return maxVelocity;
	
	}
	
	/**
	 * Determines the tight turn penalty
	 * 
	 * @param {number} velocity Current velocity
	 * @param {number} baseMove Base move used to determine turn penalty
	 * 
	 * @returns {number}
	 */
	function getTightTurnPenalty(velocity, baseMove) {
	
		let penalty = 0;
	
		if (isNaN(baseMove) || velocity === 0 || velocity <= baseMove || baseMove === 0) {
	
			penalty = 0;
	
		} else {
	
			let difference = velocity - baseMove;
	
			penalty = Math.floor(difference / baseMove) * -1;
	
		}
	
		return penalty;
	}
	
	// check if technique level changed
	on("change:repeating_techniquesrevised:level", function (event) {
	
		let rowId = getRowIdFromEventInfo(event, "repeating_techniquesrevised");
	
		updateSectionSkillsLinkedToUpdatedRow(rowId);
	
	});
	
	// if an attribute is updated, update linked items
	on("change:strength_display", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("ST");
	
	});
	
	on("change:striking_st", event => {
	
		updateSectionSkillsLinkedToUpdatedRow("STRIKING");
	
	});
	
	on("change:dexterity", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("DX");
	
	});
	
	on("change:intelligence", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("IQ");
	
	});
	
	on("change:willpower", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("WILL");
	
	});

	on("change:perception", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("PER");
	
	});
	
	on("change:health", event => {
	
		resyncRepeatingSkills();

		updateSectionSkillsLinkedToUpdatedRow("HT");
	
	});
	
	on("change:dodge", event => {
	
		updateSectionSkillsLinkedToUpdatedRow("DODGE");
	
	});
	
	on("change:basic_speed", event => {
	
		updateSectionSkillsLinkedToUpdatedRow("SPEED");
	
	});
	
	// check if melee level changed
	on("change:repeating_melee:skill", function (event) {
	
		let rowId = getRowIdFromEventInfo(event, "repeating_melee");
	
		updateSectionSkillsLinkedToUpdatedRow(rowId);
	
	});
	
	/**
	 * Checks to see if the knockback defense skill is linked to this rowId
	 *
	 * @param {string} rowId Row ID of a skill or the Attribute that might be linked to a weapon
	 */
	function updateKnockbackLinkedToRow(rowId) {
	
		let fields = ["knockback_defense_row_type", "defense_knockback_skill_row_id"];
	
		getAttrs(fields, values => {
	
			let updateFields = {};
	
			// convert the values object into an array
			let entries = Object.entries(values);
	
			// loop through each entry
			for (const [field, value] of entries) {
	
				// NOTE: This match based on either skill/technique ID or against an attribute
				// the field name lets us know which.
				if (value == rowId) {
	
					updateLinkedKnockbackSkill();
	
					break; // we found a match, no reason to continue
	
				}
	
			}
	
		});
	
	}
	
	/**
	 * Finds repeating sections that are linked to the rowId or attribute value
	 * Then triggers the toggle for the repeating section that tells it to update 
	 * the skill level.
	 * 
	 * @param {string} rowId Row ID of a skill or the Attribute that might be linked to a weapon  
	 */
	function updateSectionSkillsLinkedToUpdatedRow(rowId) {
	
		let sections = [
			{ sectionName: "repeating_melee", prefix: "melee" },
			{ sectionName: "repeating_ranged", prefix: "ranged" },
			{ sectionName: "repeating_techniquesrevised", prefix: "technique" },
			{ sectionName: "repeating_defense", prefix: "defense" }
		];
	
		// loop through each section and update items that match the rowId
		sections.forEach((section) => {
	
			toggleRepeatingSectionLinkedToRow(rowId, section.sectionName, section.prefix);
	
		});
	
		updateKnockbackLinkedToRow(rowId);

		updateSlamLinkedToRow(rowId);

		updateThrownLinkedToRow(rowId);
	
	}
	
	/**
	 * Loop throuch item in a repeating section. If row type OR skill row id 
	 * matches the rowID value, then mark that row as needing to update.
	 * This will trigger the skill level for that repeating section
	 *
	 * @param {string} rowId       A skill/spell/technique row id or an attribute, like ST, DX, IQ, etc.
	 * @param {string} sectionName Repeating section to loop through
	 * @param {string} prefix      The prefix used for the field names in that section
	 */
	function toggleRepeatingSectionLinkedToRow(rowId, sectionName, prefix) {
	
		// find items in this repeating section that use the skill/technique/attribute
		getSectionIDs(sectionName, function (ids) {
	
			// a list of data fields
			let fields = [];
	
			// loop through each row
			_.each(ids, function (id) {
	
				// example: repeating_melee_-m1z2saaqh577ah99q6d_skill_row_id
				let linkedRowId = `${sectionName}_${id}_${prefix}_skill_row_id`;
	
				let linkedType = `${sectionName}_${id}_${prefix}_row_type`;
	
				fields.push(linkedRowId);
	
				fields.push(linkedType);
	
			});
	
			// lets get all the values
			getAttrs(fields, values => {
	
				let updateFields = {};
	
				// convert the values object into an array
				let entries = Object.entries(values);
	
				let foundMatch = false;
	
				// loop through each entry
				for (const [field, value] of entries) {
	
					// NOTE: This match based on either skill/technique ID or against an attribute
					// the field name lets us know which.
					if (value == rowId) {
	
						// check that field contains "_"
						if (field && field.includes("_")) {
	
							// we have a match, get the row id
							// example: repeating_melee_-m1z2saaqh577ah99q6d_skill_row_id
							// split = ["repeating", "melee", "-m1z2saaqh577ah99q6d", "skill", "row", "id"]
							let arrField = field.split("_");
	
							// the id will always be the 3rd element
							let currentId = arrField[2];
	
							// toggle the update field for that row
							let toggleField = `${sectionName}_${currentId}_${prefix}_skill_row_id_toggle`;
	
							updateFields[toggleField] = 1;
	
							// we have at least one match
							foundMatch = true;
	
						}
	
					}
	
					if (foundMatch) {
	
						// don't run silently, the toggle fields forces the row to update the skill level
						setAttrs(updateFields);
	
					}
	
				}
	
			});
	
		});
	
	}
	
	/**
	 * finds the row id for an on change event and repeating section name
	 *
	 * @param {object} event       A change event object
	 * @param {string} sectionName The name of a repeating section
	 */
	function getRowIdFromEventInfo(event, sectionName) {
	
		let rowId = "";
	
		// example: repeating_skills_-l6zk36zhcjhsyvc-kax_level
		let sourceAttr = event.sourceAttribute;
	
		if (sourceAttr && sourceAttr.includes("_")) {
	
			// remove the sectionname
			let regReplace = new RegExp(sectionName + '_', "ig");
	
			// example: -l6zk36zhcjhsyvc-kax_level
			sourceAttr = sourceAttr.replace(regReplace, "");
	
			// now split by the _
			let arrSource = sourceAttr.split("_");
	
			// first element should be rowId
			rowId = arrSource[0];
	
			rowId = rowId.toLowerCase();
	
		}
	
		return rowId;
	
	}
	
	/**
	 * finds the row id for row field key for a repeating section name
	 * example:  repeating_skills_-l6zk36zhcjhsyvc-kax_level
	 * 
	 * @param {object} fieldKey  Field Key name
	 * @param {string} sectionName The name of a repeating section
	 * 
	 * @returns {string}
	 */
	function getRowIdFromRowFieldKey(fieldKey, sectionName) {
	
		let rowId = "";
	
		// repeating_skills_-l6zk36zhcjhsyvc-kax_level
		if (fieldKey && fieldKey.includes("_")) {
	
			// remove the sectionname
			let regReplace = new RegExp(sectionName + '_', "ig");
	
			// example: -l6zk36zhcjhsyvc-kax_level
			fieldKey = fieldKey.replace(regReplace, "");
	
			// now split by the _
			let arrKey = fieldKey.split("_");
	
			// first element should be rowId
			rowId = String(arrKey[0]).toLowerCase();
	
		}
	
		return rowId;
	
	}
	
	/**
	 * Simplified function to get section name and row id based on event
	 * see: https://roll20.zendesk.com/hc/en-us/articles/360037773513-Sheet-Worker-Scripts#events-0-3
	 * 
	 * @param {object} event Event Info triggered by an action
	 *
	 * @returns {[string, string, string]} An array array of [sectioName: string, rowId: string, fieldName: string]
	 */
	function getSectionRowIdFromChangeEvent(event) {
	
		// example: repeating_skills_-mormdnyobkj-4uwf7lf_skill_toggle_notes
		let triggerName = event.triggerName;
	
		// split into an array
		// example: ["repeating", "spells", "-mi2gev09xkxzckxltdw", "skill", "toggle", "notes"]
		//        : [0, 1, *2*, 3, 4, 5]
		//        : field name = skill_toggle_notes = array slice
		let arrName = triggerName.split("_");
	
		let rowId = String(arrName[2]);
	
		let sectionName = `${arrName[0]}_${arrName[1]}`;

		if (sectionName.includes(":")) {

			//remove the action
			// example: clicked:repeating_skills
			// remove `clicked:`
			let arrSectionName = sectionName.split(":");

			sectionName = arrSectionName[1];

		}
	
		sectionName = sectionName.toLowerCase();
	
		let slicedFieldNameArray = arrName.slice(3, arrName.length);

		let fieldName = slicedFieldNameArray.join("_");

		return [sectionName, rowId, fieldName];
	
	}
	
	// if linked data for repeating range changes update the skill level
	on('change:repeating_ranged:ranged_row_type change:repeating_ranged:ranged_skill_row_id change:repeating_ranged:ranged_skill_row_id_modifier change:repeating_ranged:ranged_skill_row_id_toggle', function (event) {
	
		// check if this is a valid toggle
		const isToggled = String(event.sourceAttribute).endsWith("_skill_row_id_toggle");
	
		const toggledValue = Number(event.newValue);
	
		if (isToggled && toggledValue !== 1) {
			return;
		}
	
		getAttrs(["repeating_ranged_ranged_row_type"], function (values) {
	
			updateLinkedWeaponSkill("repeating_ranged", "ranged", values.repeating_ranged_ranged_row_type, "", 0);
	
		});
	
	
	});
	
	// if linked data for repeating melee changes update the skill level
	on('change:repeating_melee:melee_row_type change:repeating_melee:melee_skill_row_id change:repeating_melee:melee_skill_row_id_modifier change:repeating_melee:melee_skill_row_id_toggle', function (event) {
	
		// check if this is a valid toggle
		const isToggled = String(event.sourceAttribute).endsWith("_skill_row_id_toggle");
	
		const toggledValue = Number(event.newValue);
	
		if (isToggled && toggledValue !== 1) {
			return;
		}
	
		getAttrs(["repeating_melee_melee_row_type"], function (values) {
	
			updateLinkedWeaponSkill("repeating_melee", "melee", values.repeating_melee_melee_row_type, "", 0);
	
		});
	
	});
	
	// if linked data for repeating techniques changes update the skill level
	on('change:repeating_techniquesrevised:technique_row_type change:repeating_techniquesrevised:technique_skill_row_id change:repeating_techniquesrevised:technique_skill_row_id_toggle', function (event) {
	
		// check if this is a valid toggle
		const isToggled = String(event.sourceAttribute).endsWith("_skill_row_id_toggle");
	
		const toggledValue = Number(event.newValue);
	
		if (isToggled && toggledValue !== 1) {
			return;
		}
	
		getAttrs(["repeating_techniquesrevised_technique_row_type"], function (values) {
	
			updateLinkedWeaponSkill("repeating_techniquesrevised", "technique", values.repeating_techniquesrevised_technique_row_type, "", 0);
	
		});
	
	});

	// check if combat reflex was applied to active defense.
	on("change:repeating_defense:defense_combat_reflexes", event => {

		getAttrs(["repeating_defense_defense_combat_reflexes", "repeating_defense_defense_row_type"], values => {

			const isDodge = values.repeating_defense_defense_row_type == "DODGE" || values.repeating_defense_defense_row_type == "CURRENT_DODGE";

			const useReflexes = values.repeating_defense_defense_combat_reflexes === "1" && isDodge === false;

			const reflexBonus = useReflexes ? "1" : "0";

			setAttrs({
				repeating_defense_defense_combat_reflexes_bonus: reflexBonus
			});

		});

	});
	
	// if linked data for repeating defense is changed, get the new linked skill values
	on('change:repeating_defense:type change:repeating_defense:defense_row_type change:repeating_defense:defense_talent_level change:repeating_defense:defense_skill_row_id change:repeating_defense:repeating_defense_defense_talent_level change:repeating_defense:defense_skill_row_id_toggle change:repeating_defense:defense_combat_reflexes', function (event) {
	
		// check if this is a valid toggle
		const isToggled = String(event.sourceAttribute).endsWith("_skill_row_id_toggle");
	
		const toggledValue = Number(event.newValue);
	
		if (isToggled && toggledValue !== 1) {
			return;
		}
	
		getAttrs(["repeating_defense_defense_row_type", "repeating_defense_type", "repeating_defense_defense_talent_level"], function (values) {
	
			updateLinkedWeaponSkill("repeating_defense", "defense", values.repeating_defense_defense_row_type, values.repeating_defense_type, +values.repeating_defense_defense_talent_level);
	
		});
	
	});
	
	// if linked information changed for Knockback save, update the base skill level
	on('change:knockback_defense_row_type change:defense_knockback_skill_row_id', (event) => {
	
		updateLinkedKnockbackSkill();
	
	});
	
	/**
	 * Update the Knockback skill based on selected attribute and/or skill
	 *
	 * @param {() => void=} callback Optional call back function
	 */
	function updateLinkedKnockbackSkill(callback) {
	
		// check if we need to set default value
		callback = callback || noop;
	
		getAttrs(["knockback_defense_row_type", "defense_knockback_skill_row_id", "ad_knockback_skill_mod"], (values) => {
	
			let rowType = values.knockback_defense_row_type;
	
			let skillRowId = values.defense_knockback_skill_row_id;
	
			let skillMod = +values.ad_knockback_skill_mod;
	
			let { updateMethod, repeatingTableToUse } = getLinkedSkillUpdateMethod(rowType);
	
			let skillName = "";
	
			let skillLevel = "";
	
			let updateFields = {};
	
			// if updating using a repeating field AND no row id, clear the fields
			if (updateMethod != "attribute" && skillRowId.length === 0) {
	
				updateFields["defense_knockback_skill_row_id_message"] = "";
	
				updateFields["defense_knockback_skill_row_id_level"] = "";
	
				setAttrs(updateFields, null, callback);
	
			} else if (updateMethod == "attribute") {
	
				updateLinkedKnockbackSkillByAttribute(rowType, callback);
	
			} else {
	
				updateLinkedKnockbackSkillByTable(repeatingTableToUse, skillRowId, rowType, callback);
	
			}
	
		});
	
	}
	
	/**
	 * Update the melee, ranged, or technique associated with the skill row id
	 * 
	 * @param {string}      sectionName  Should be either repeating_melee or repeating_ranged
	 * @param {string}      prefix       Placed before skill attribute names to follow rules for unique names, even inside repeating sections.
	 * @param {string}      rowType      Where to get the level. Skill | Spell 
	 * @param {string}      defenseType  If there's a defense type (Parry, Dodge, etc.) a formula will be used to calculate the skill level
	 * @param {number}      talentLevel  Used with defense type to calculate skill level
	 * 
	 * @param {() => void=} callback    A function to run after everything is done
	 */
	function updateLinkedWeaponSkill(sectionName, prefix, rowType, defenseType, talentLevel, callback) {
	
		callback = callback || noop;
	
		let { updateMethod, repeatingTableToUse } = getLinkedSkillUpdateMethod(rowType);
	
		let skillRowIdFieldName = `${sectionName}_${prefix}_skill_row_id`;
	
		let skillRowModFieldName = `${sectionName}_${prefix}_skill_row_id_modifier`;
	
		let skillMessageFieldName = `${sectionName}_${prefix}_skill_row_id_message`;
	
		let skillMessageFieldLevel = `${sectionName}_${prefix}_skill_row_id_level`;
	
		// for updating technique values
		let parentFieldName = `${sectionName}_parent`;
	
		// for updating technique values
		let baseSkillFieldName = `${sectionName}_base_level`;
	
		let weaponSkillFieldName = `${sectionName}_skill`;
	
		// if this gets changed, then the update linked weapon skill gets triggered
		let skillRowIdToggleFieldName = `${sectionName}_${prefix}_skill_row_id_toggle`;
	
		getAttrs([skillRowIdFieldName,
			skillRowModFieldName
		], function (values) {
	
			let skillRowId = values[skillRowIdFieldName];
	
			let skillMod = Number(values[skillRowModFieldName]);
	
			if (isNaN(skillMod)) {
				skillMod = 0;
			}
	
			// if updating using a repeating field make sure there's a row id to search for
			if (updateMethod != "attribute" && skillRowId.length === 0) {
	
				// clear the field
				let updateFields = {};
	
				updateFields[skillMessageFieldName] = ``;
	
				updateFields[skillMessageFieldLevel] = "";
	
				// change the toggle back to 0
				updateFields[skillRowIdToggleFieldName] = 0;
	
				setAttrs(updateFields, { silent: true }, callback);
	
			} else if (updateMethod == "attribute") {
	
				updateLinkWeaponSkillByAttribute(sectionName, skillRowIdFieldName, weaponSkillFieldName, skillMessageFieldName, skillMessageFieldLevel, skillRowIdToggleFieldName, parentFieldName, baseSkillFieldName, rowType, skillMod, defenseType, talentLevel, callback);
	
			} else {
	
				updateLinkedWeaponSkillByRepeatingRow(sectionName, weaponSkillFieldName, skillMessageFieldName, skillMessageFieldLevel, skillRowIdToggleFieldName, parentFieldName, baseSkillFieldName, repeatingTableToUse, skillRowId, skillMod, defenseType, talentLevel, callback);
	
			}
	
		});
	
	}
	
	/**
	 * Returns method and repeating table to use
	 * 
	 * @param {string} rowType What type of skill/attribute are we linking to.
	 * 
	 * @returns {object} properties {updateMethod, repeatingTableToUse}
	 */
	function getLinkedSkillUpdateMethod(rowType) {
	
		// can be repeating | attribute
		let method = "repeating";
	
		let table = "";
	
		switch (rowType) {
	
			case "ST":
				method = "attribute";
				break;
	
			case "STRIKING":
				method = "attribute";
				break;
	
			case "DX":
				method = "attribute";
				break;
	
			case "IQ":
				method = "attribute";
				break;
	
			case "WILL":
				method = "attribute";
				break;
	
			case "HT":
				method = "attribute";
				break;
	
			case "DODGE":
				method = "attribute";
				break;
	
			case "CURRENT_DODGE":
				method = "attribute";
				break;
	
			case "SPEED":
				method = "attribute";
				break;
	
			case "10":
				method = "attribute";
				break;
	
			case "Technique":
				table = "repeating_techniquesrevised";
				break;
	
			case "Spell":
				table = "repeating_spells";
				break;
	
			case "Melee":
				table = "repeating_melee";
				break;

			case "nothing":
				method = "";
				break;
	
			case "Skill":
			default:
				table = "repeating_skills";
				break;
	
		}
	
		let objMethod = {
			updateMethod: method,
			repeatingTableToUse: table
		};
	
		return objMethod;
	
	}
	
	/**
	 * Update the selected weapon skill by linking to another skill, technique, spell, or melee weapon
	 * 
	 * @param {string} sectionName               Name of section that is getting udpated
	 * @param {string} weaponSkillFieldName      For Weapon that is getting updated
	 * @param {string} skillMessageFieldName     For Weapon that is getting updated
	 * @param {string} skillMessageFieldLevel    For Weapon that is getting updated
	 * @param {string} skillRowIdToggleFieldName For Weapon that is getting updated
	 * @param {string} parentFieldName           For Weapon that is getting updated
	 * @param {string} baseSkillFieldName        For Weapon that is getting updated
	 * @param {string} repeatingTableToUse       Which table to get the skill level from
	 * @param {string} skillRowId                Row Id that will get updated
	 * @param {number} skillMod                  Modifier to skill level 
	 * @param {string} defenseType               Used by active defense to determine skill calculation formula
	 * @param {number} talentLevel               Talent level is used by active defense to determine skill calculation formula
	 * @param {() => void=} callback             Callback function 
	 */
	function updateLinkedWeaponSkillByRepeatingRow(sectionName, weaponSkillFieldName, skillMessageFieldName, skillMessageFieldLevel, skillRowIdToggleFieldName, parentFieldName, baseSkillFieldName, repeatingTableToUse, skillRowId, skillMod, defenseType, talentLevel, callback) {
		
		// if it's a good row id, let's update stuff
		let skillFieldName = `${repeatingTableToUse}_${skillRowId}_level`;
	
		let skillFieldNameOfSkill = `${repeatingTableToUse}_${skillRowId}_name`;
	
		if (repeatingTableToUse == "repeating_melee" || repeatingTableToUse == "repeating_ranged") {
	
			skillFieldName = `${repeatingTableToUse}_${skillRowId}_skill`;
	
		}
	
		// update the skill level for weapon.
		getAttrs([skillFieldName, skillFieldNameOfSkill], function (skillValues) {
	
			let skillLevel = +skillValues[skillFieldName];
	
			let skillLevelFinal = skillLevel + skillMod;
	
			let updateFields = {};
	
			// reset toggle to zero
			updateFields[skillRowIdToggleFieldName] = 0;
	
			if (skillLevel > 0) {
	
				updateFields[weaponSkillFieldName] = skillLevelFinal;
	
				updateFields[skillMessageFieldName] = skillValues[skillFieldNameOfSkill];
	
				updateFields[skillMessageFieldLevel] = skillLevel;
	
				// if repeating_techniquesrevised, also update the Parent skill name and base skill level
				if (sectionName == "repeating_techniquesrevised") {
	
					updateFields[parentFieldName] = skillValues[skillFieldNameOfSkill];
	
					updateFields[baseSkillFieldName] = skillLevel;
	
				}
	
				// check for repeating active defense
				if (sectionName == "repeating_defense") {
	
					let calculatedSkillLevel = getCalculatedSkillByDefenseType(defenseType, talentLevel, skillLevel);

					updateFields["repeating_defense_defense_formula_level"] = calculatedSkillLevel;
	
					updateFields["repeating_defense_skill"] = calculatedSkillLevel;
	
				}
	
				setAttrs(updateFields, null, callback);
	
			} else {
	
				updateFields[skillMessageFieldName] = `Could not find ${skillLevel}.`;
	
				setAttrs(updateFields, { silent: true }, callback);
	
			}
	
		});
	
	}
	
	/**
	 * Update the linked weapon skill by using an attribute stat
	 *
	 * @param {string} sectionName               Name of section that is getting udpated
	 * @param {string} skillRowIdFieldName       Copy the attribute used to this field.
	 * @param {string} weaponSkillFieldName      For Weapon that is getting updated
	 * @param {string} skillMessageFieldName     For Weapon that is getting updated
	 * @param {string} skillMessageFieldLevel    For Weapon that is getting updated
	 * @param {string} skillRowIdToggleFieldName For Weapon that is getting updated
	 * @param {string} parentFieldName           For Weapon that is getting updated
	 * @param {string} baseSkillFieldName        For Weapon that is getting updated
	 * @param {string} rowType                   The attribute to use for setting weapon skill level
	 * @param {number} skillMod                  Modifier to skill level
	 * @param {string} defenseType               Used by active defense to determine skill calculation formula
	 * @param {number} talentLevel               Talent level is used by active defense to determine skill calculation formula
	 * @param {() => void=} callback             Callback function 
	 */
	function updateLinkWeaponSkillByAttribute(sectionName, skillRowIdFieldName, weaponSkillFieldName, skillMessageFieldName, skillMessageFieldLevel, skillRowIdToggleFieldName, parentFieldName, baseSkillFieldName, rowType, skillMod, defenseType, talentLevel, callback) {
		
		let fieldName;
	
		switch (rowType) {
			case "ST":
				fieldName = "strength_display";
				break;
	
			case "STRIKING":
				fieldName = "striking_st";
				break;
	
			case "DX":
				fieldName = "dexterity";
				break;
	
			case "IQ":
				fieldName = "intelligence";
				break;
	
			case "WILL":
				fieldName = "willpower";
				break;
	
			case "HT":
				fieldName = "health";
				break;
	
			case "SPEED":
				fieldName = "basic_speed";
				break;
	
			case "DODGE":
				fieldName = "dodge";
				break;
	
			case "CURRENT_DODGE":
				fieldName = "current_dodge";
				break;
	
			case "10":
			default:
				fieldName = "base_attribute_level";
				break;
		}
	
		// update the skill level for weapon.
		getAttrs([fieldName], function (skillValues) {
	
			let skillLevel = +skillValues[fieldName];
	
			let skillLevelFinal = skillLevel + skillMod;
	
			let updateFields = {};
	
			updateFields[skillRowIdFieldName] = rowType;
	
			updateFields[weaponSkillFieldName] = skillLevelFinal;
	
			updateFields[skillMessageFieldName] = rowType;
	
			updateFields[skillMessageFieldLevel] = skillLevel;
	
			// reset toggle to zero
			updateFields[skillRowIdToggleFieldName] = 0;
	
			// if repeating_techniquesrevised, also update the Parent skill name and base skill level
			if (sectionName == "repeating_techniquesrevised") {
	
				updateFields[parentFieldName] = rowType;
	
				updateFields[baseSkillFieldName] = skillLevel;
	
			}
	
			// check for repeating active defense
			if (sectionName == "repeating_defense") {
	
				let calculatedSkillLevel = getCalculatedSkillByDefenseType(defenseType, talentLevel, skillLevel);

				updateFields["repeating_defense_defense_formula_level"] = calculatedSkillLevel;
	
				updateFields["repeating_defense_skill"] = calculatedSkillLevel;

				// if dodge or current dodge is selected as the skill link make sure to turn OFF combat reflexes
				if (rowType === "DODGE" || rowType === "CURRENT_DODGE") {

					updateFields["repeating_defense_defense_combat_reflexes"] = "";

					updateFields["repeating_defense_defense_combat_reflexes_bonus"] = "0";

				}
				
			}
	
			setAttrs(updateFields, { silent: true });
	
		});
	
	}
	
	/**
	 * Calculates the final active defense skill based on selected options
	 *
	 * @param {string} defenseType Type of defense that was selected
	 * @param {number} talentLevel Level of talent used
	 * @param {number} skillLevel  skill to base calculation on
	 * 
	 * @returns {number}
	 */
	function getCalculatedSkillByDefenseType(defenseType, talentLevel, skillLevel) {
		let calculatedSkillLevel = skillLevel;
	
		switch (defenseType) {
			case "Parry":
			case "Unarmed Parry":
			case "Block":
				// 3 + (skilllevel/2) rounded down
				calculatedSkillLevel = 3 + (skillLevel / 2);
				break;
	
			case "Power Dodge":
				// Basic Speed + 3 + Talent/2, rounded down. User's should select basic speed from drop-down
				calculatedSkillLevel = skillLevel + 3 + (talentLevel / 2);
				break;
	
			case "Power Parry":
			case "Power Block":
			case "Power Block Mental":
				// 3 + ( (Innate attack skill + talent)/2). User's should select either HT or WILL from drop-down
				calculatedSkillLevel = 3 + ((skillLevel + talentLevel) / 2);
				break;
	
			default:
				// no formula needed
				break;
		}
	
		calculatedSkillLevel = Math.floor(calculatedSkillLevel);
	
		return calculatedSkillLevel;
	
	}
	
	/**
	 * Update the linked knocked back skill by using an attribute stat
	 *
	 * @param {string}      rowType  The attribute to use for setting weapon skill level
	 * @param {() => void=} callback Callback function 
	 */
	function updateLinkedKnockbackSkillByAttribute(rowType, callback) {
		callback = callback || noop;
	
		let fieldName;
	
		switch (rowType) {
			case "ST":
				fieldName = "strength_display";
				break;
	
			case "STRIKING":
				fieldName = "striking_st";
				break;
	
			case "DX":
				fieldName = "dexterity";
				break;
	
			case "IQ":
				fieldName = "intelligence";
				break;
	
			case "WILL":
				fieldName = "willpower";
				break;
	
			case "HT":
				fieldName = "health";
				break;
	
			case "SPEED":
				fieldName = "basic_speed";
				break;
	
			case "DODGE":
				fieldName = "dodge";
				break;
	
			case "10":
			default:
				fieldName = "base_attribute_level";
				break;
		}
	
		// update the skill level for knockback save.
		getAttrs([fieldName], function (skillValues) {
	
			let skillLevel = +skillValues[fieldName];
	
			let updateFields = {};
	
			updateFields["defense_knockback_skill_row_id_message"] = rowType;
	
			updateFields["defense_knockback_skill_row_id_level"] = skillLevel;
	
			updateFields["ad_knockback_skill"] = skillLevel;
	
			setAttrs(updateFields, { silent: true }, callback);
	
		});
	
	}
	
	/**
	 * Update the Knockback sill based on a repeating item
	 *
	 * @param {string} repeatingTableToUse Name of table that contains the row id
	 * @param {string} skillRowId          The Row that has the information we need for name and skill level to use
	 * @param {string} rowType             Type of knockback defense
	 * @param {() => void=} callback       An optional call back function  
	 */
	function updateLinkedKnockbackSkillByTable(repeatingTableToUse, skillRowId, rowType, callback) {
		// if it's a good row id, let's update stuff
		let skillFieldName = `${repeatingTableToUse}_${skillRowId}_level`;
	
		let skillFieldNameOfSkill = `${repeatingTableToUse}_${skillRowId}_name`;
	
		// update the skill level for weapon.
		getAttrs([skillFieldName, skillFieldNameOfSkill], function (skillValues) {
	
			let skillLevel = +skillValues[skillFieldName];
	
			let updateFields = {};
	
			// check for valid skill level
			if (skillLevel > 0) {
	
				updateFields["defense_knockback_skill_row_id_message"] = skillValues[skillFieldNameOfSkill];
	
				updateFields["defense_knockback_skill_row_id_level"] = skillLevel;
	
				updateFields["ad_knockback_skill"] = skillLevel;
	
				setAttrs(updateFields, null, callback);
	
			} else {
	
				// show an error message
				updateFields["defense_knockback_skill_row_id_message"] = `Could not find ${rowType}.`;
	
				setAttrs(updateFields, { silent: true }, callback);
	
			}
	
		});
	}
	
	/**
	 * This function is used to make sure the repeating 
	 * skill/spell levels are updated when the version has changed
	 * 
	 * @param {string} sectionName Name of section
	 */
	function updateRepeatingSkillSpellLevels(sectionName) {
	
		getSectionIDs(sectionName, (ids) => {
	
			updateSkillLevel(sectionName, ids);
	
		});
	
	}
	
	/**
	 * Ensures skill levels are correct when loading 
	 * a new version of the sheet. This is needed, since the
	 * skill levels were converted from auto-calculating fields to 
	 * sheet workers. This code ensures older sheets have the 
	 * correct skill levels when the sheet loads.
	 * 
	 * NOTE: if the skill level changes, this will automatically trigger 
	 *       updating the linked items.
	 * 
	 * @param {string} sectionName Name of repeating section
	 * @param {[]}     ids         An array of row ids
	 */
	function updateSkillLevel(sectionName, ids) {
	
		// we can trigger an update by setting the sync property to 1
		let fieldsToUpdate = {};
	
		if (ids.length === 0) {
			return;
		}
	
		ids.forEach(id => {
	
			const syncFieldName = `${sectionName}_${id}_sync`;
	
			fieldsToUpdate[syncFieldName] = 1;
	
		});
	
		// by setting sync to 1, this trigger the change event on("change:repeating_skills:sync") OR on("change:repeating_spells:sync")
		// which updates the skill level
		setAttrs(fieldsToUpdate, null, () => {

			let fieldsToZero = {};
	
			ids.forEach(id => {
	
				const syncFieldName = `${sectionName}_${id}_sync`;

				fieldsToZero[syncFieldName] = 0;

			});

			setAttrs(fieldsToZero);

		});
	
	}
	
	/**
	 * Get the base skill level for a property
	 * 
	 * @param {string} baseFieldName 
	 * @param {object} values 
	 * 
	 * @returns {number}
	 */
	function getBaseSkillLevel(baseFieldName, values) {
	
		let baseLevel = 10;
	
		switch (baseFieldName) {
	
			case "@{strength}":
				baseLevel = Number(values.strength);
				break;
	
			case "@{dexterity}":
				baseLevel = Number(values.dexterity);
				break;
	
			case "@{intelligence}":
				baseLevel = Number(values.intelligence);
				break;
	
			case "@{health}":
				baseLevel = Number(values.health);
				break;
	
			case "@{willpower}":
				baseLevel = Number(values.willpower);
				break;
	
			case "@{perception}":
				baseLevel = Number(values.perception);
				break;
	
			default:
				baseLevel = 10;
				break;
	
		}
	
		if (isNaN(baseLevel)) {
			baseLevel = 10;
		}
	
		return baseLevel;
	}
	
	/**
	 * Syncs `attr_spell_base`, `attr_spell_bonus`, `attr_spell_custom_modifier`, `spell_on_penalty_total`, and `spell_maintained_penalty_total` to 
	 * corresponding repeating_spells fields. This will
	 * trigger updating the spell level at the same time.
	 * 
	 * @param {boolean}  silent   If it should be run silently
	 * @param {any} callback Callback function to run
	 */
	const syncModsToRepeatingSpells = (silent = false, callback) => {
	
		callback = callback || noop;
	
		const fields = [
			"spell_base",
			"spell_bonus",
			"spell_custom_modifier",
			"spell_on_penalty_total",
			"spell_maintained_penalty_total",
			"strength",
			"dexterity",
			"intelligence",
			"health",
			"perception",
			"willpower"
		];
	
		getAttrs(fields, values => {
	
			const baseLevel = String(values.spell_base);
	
			const bonus = Number(values.spell_bonus);

			const customSpellMod = Number(values.spell_custom_modifier);

			const onPenalty = Number(values.spell_on_penalty_total);

			const maintainedPenalty = Number(values.spell_maintained_penalty_total);
	
			const sectionName = "repeating_spells";
	
			getSectionIDs(sectionName, function (ids) {
	
				if (ids.length === 0) {
					return;
				}
	
				let fieldsToUpdate = {};
	
				for (let i = 0; i < ids.length; i++) {
					fieldsToUpdate[`${sectionName}_${ids[i]}_base`] = baseLevel;
					fieldsToUpdate[`${sectionName}_${ids[i]}_bonus`] = bonus;
					fieldsToUpdate[`${sectionName}_${ids[i]}_custom_modifier`] = customSpellMod;
					fieldsToUpdate[`${sectionName}_${ids[i]}_on_penalty`] = onPenalty;
					fieldsToUpdate[`${sectionName}_${ids[i]}_maintained_penalty`] = maintainedPenalty;
				}
	
				if (silent) {
	
					// silent is needed when the sheet opens
					setAttrs(fieldsToUpdate, { silent: true }, callback);
	
				} else {
	
					// otherwise if base attribue or bonus changed, 
					// this will fire the hook to update spells
					// change:repeating_spells:base, change:repeating_spells:bonus change:repeating_spells:custom_modifier change:spell_on_penalty_total change:spell_maintained_penalty_total
					setAttrs(fieldsToUpdate, null, callback);
	
				}
	
			});
	
		});
	
	}
	
	/**
	 * Calculate skill level using GURPS rules as written
	 * 
	 * @param {number}  base                   Base skill level
	 * @param {number}  difficulty             Modifier selected from drop-down
	 * @param {number}  bonus                  Modifier entered by user
	 * @param {number}  wildcardSkillPoints     
	 * @param {number}  points                 
	 * @param {number}  useNormalPoints        
	 * 
	 * @returns {number}
	 */
	function getSkillLevelUsingRaw(base, difficulty, bonus, wildcardSkillPoints, points, useNormalPoints) {
	
		let skill = 10;
	
		let skillPoints = 0;
	
		// make sure we have a number.
		difficulty = Number(difficulty);
	
		if (isNaN(difficulty)) {
			difficulty = 0;
		}
	
		// determine which points to use
		if (useNormalPoints) {
	
			skillPoints = points;
	
		} else {
	
			skillPoints = wildcardSkillPoints;
	
		}
	
		const levelFromPoints = Math.floor((skillPoints * 0.25) + 2)
			* Math.ceil(((skillPoints - 2) + Math.abs(skillPoints - 2)) / 256)
			+ skillPoints
			* Math.abs(Math.ceil(((skillPoints - 2) + Math.abs(skillPoints - 2)) / 256) - 1);
	
		skill = base + difficulty + bonus + levelFromPoints;
	
		return skill;
	
	}
	
	// method to reduce code
	['on', 'maintained'].forEach(onormaintained => {
	
		// calculates the spell penalties for either ON or Concentrated
		on(`change:repeating_spells:spell_${onormaintained}_checked change:penalty_per_spell_${onormaintained} remove:repeating_spells`, function (event) {
	
			getSectionIDs('repeating_spells', ids => {
	
				const fieldnames = [];
	
				ids.forEach(id => fieldnames.push(`repeating_spells_${id}_spell_${onormaintained}_checked`));
	
				getAttrs([`penalty_per_spell_${onormaintained}`, ...fieldnames], values => {
					const penalty = +values[`penalty_per_spell_${onormaintained}`] || 0;
	
					let checkedcount = 0;
	
					ids.forEach(id => {
	
						// get the value entered into the input number box. NOTE: converted from checkbox to number.
						checkedcount += +values[`repeating_spells_${id}_spell_${onormaintained}_checked`];
	
					});
	
					const totalpenalty = checkedcount * penalty;
	
					setAttrs({
						[`spell_${onormaintained}_count`]: checkedcount,
						[`spell_${onormaintained}_penalty_total`]: totalpenalty
					})
	
				});
			});
		});
	});
	
	
	/* ---- DEMOLITION SECTION ---- */
	
	const DEMO_TYPES = [
		{ type: "TNT", ref: "1.0" },
		{ type: "Serpentine Powder", ref: "0.3" },
		{ type: "Ammonium Nitrate", ref: "0.4" },
		{ type: "TL4 Black Powder", ref: "0.4" },
		{ type: "TL5 Black Powder", ref: "0.5" },
		{ type: "Diesel/Fertilizer", ref: "0.5" },
		{ type: "Dynamite", ref: "0.8" },
		{ type: "Amatol", ref: "1.2" },
		{ type: "Nitroglycerine", ref: "1.5" },
		{ type: "Tetryl", ref: "1.3" },
		{ type: "Composition B", ref: "1.4" },
		{ type: "C4", ref: "1.4" },
		{ type: "Octanitrocubane", ref: "4" },
		{ type: "Metallic Hydrogen", ref: "6" },
	];
	
	// check for how much? damage
	on("change:demo_how_much_ref change:demo_how_much_damage_multiplier change:demo_how_much_base_damage change:demo_how_much_divisor change:demo_how_much_target_distance change:use_metric", function (event) {
	
		getAttrs(["demo_how_much_ref", "demo_how_much_base_damage", "demo_how_much_damage_multiplier", "demo_how_much_divisor", "demo_how_much_target_distance", "use_metric"], function (values) {
	
			let multiplier = +values.demo_how_much_damage_multiplier;
	
			let REF = +values.demo_how_much_ref;
	
			// this is in pounds
			let weight = (multiplier * multiplier) / (4 * REF);

			let useMetricChecked = Number(values.use_metric);

			if (Number.isNaN(useMetricChecked)) {
				useMetricChecked = 0;
			}

			// if using metric, convert the weight which is pounds into kilograms
			if (useMetricChecked) {
				weight = weight / metricWeightConversionMultiplier;
			}
	
			let result = weight.toFixed(2);
	
			// determine damage divisor
			let divisor = 1;
	
			let targetDistance = parseInt(values.demo_how_much_target_distance);
	
			let baseDivisor = parseInt(values.demo_how_much_divisor);
	
			// if target is 1 or more yards away, determine divisor
			if (targetDistance > 0) {
	
				divisor = baseDivisor * targetDistance;
	
			}
	
			// determine blast radius
			let diceCount = getNumberOfDiceToRoll(values.demo_how_much_base_damage);
	
			// see B414
			let blastRadius = diceCount * multiplier * 2;
	
			setAttrs({
				demo_how_much_weight: result,
				demo_how_much_damage_divisor: divisor,
				demo_how_much_radius: blastRadius
			});
	
		});
	
	});
	
	/**
	 * Determines the number of dice in a simple roll value
	 * If 3d6+2, it will return 3. The number of dice to roll.
	 * 
	 * @param {string} rollString Roll value to parse
	 * 
	 * @returns {number}
	 */
	function getNumberOfDiceToRoll(rollString) {
	
		rollString = String(rollString).toLowerCase();
	
		let arrRoll = rollString.split("d");
	
		let diceCount = Number(arrRoll[0]);
	
		return diceCount;
	
	}
	
	// check for how big? damage
	on("change:demo_how_big_ref chage:demo_how_big_base_damage change:demo_how_big_weight change:demo_how_big_divisor change:demo_how_big_target_distance change:use_metric", function (event) {
	
		getAttrs(["demo_how_big_ref", "demo_how_big_base_damage", "demo_how_big_weight", "demo_how_big_divisor", "demo_how_big_target_distance", "use_metric"], function (values) {
	
			let multiplier = 0;
	
			let REF = +values.demo_how_big_ref;
	
			// could be pounds or kg
			let weight = +values.demo_how_big_weight;

			let useMetricChecked = Number(values.use_metric);

			if (Number.isNaN(useMetricChecked)) {
				useMetricChecked = 0;
			}

			// if using metric, convert the weight which is KG into pounds
			if (useMetricChecked) {
				weight = weight * metricWeightConversionMultiplier;
			}
	
			if (weight > 0) {
	
				multiplier = Math.sqrt(weight * 4 * REF);
	
				multiplier = Math.floor(1 * multiplier);
	
			}
	
			// determine damage divisor
			let divisor = 1;
	
			let targetDistance = parseInt(values.demo_how_big_target_distance);
	
			let baseDivisor = parseInt(values.demo_how_big_divisor);
	
			// if target is 1 or more yards away, determine divisor
			if (targetDistance > 0) {
	
				divisor = baseDivisor * targetDistance;
	
			}
	
			// determine blast radius
			let diceCount = getNumberOfDiceToRoll(values.demo_how_big_base_damage);
	
			// see B414
			let blastRadius = diceCount * multiplier * 2;
	
			setAttrs({
				demo_how_big_damage_multiplier: multiplier,
				demo_how_big_damage_divisor: divisor,
				demo_how_big_radius: blastRadius
			});
	
		});
	
	});
	
	// check for selecting an demolition type for how much.
	on("change:demo_how_much_selected_type", function (event) {
	
		getAttrs(["demo_how_much_selected_type"], function (values) {
	
			let demoType = getDemoTypeObject(values.demo_how_much_selected_type);
	
			setAttrs({
				demo_how_much_type: demoType.type,
				demo_how_much_ref: demoType.ref
			});
	
		});
	
	});
	
	// check for selectin an demolition type for how big
	on("change:demo_how_big_selected_type", function (event) {
	
		getAttrs(["demo_how_big_selected_type"], function (values) {
	
			let demoType = getDemoTypeObject(values.demo_how_big_selected_type);
	
			setAttrs({
				demo_how_big_type: demoType.type,
				demo_how_big_ref: demoType.ref
			});
	
		});
	
	});
	
	/**
	 * Find the demo type objects in the DEMO_TYPES constant array
	 * 
	 * @param {string} type Demolition Type name
	 * 
	 * @returns {object} Properties {type, ref}
	 */
	function getDemoTypeObject(type) {
	
		let object = DEMO_TYPES.find(element => element.type === type);
	
		return object;
	
	}
	
	on("clicked:demo_how_much_reset", function () {
	
		setAttrs({
			demo_how_much_selected_type: "TNT",
			demo_how_much_type: "TNT",
			demo_how_much_ref: 1.0,
			demo_how_much_damage_multiplier: 1
		});
	
	});
	
	on("clicked:demo_how_big_reset", function () {
	
		setAttrs({
			demo_how_big_selected_type: "TNT",
			demo_how_big_type: "TNT",
			demo_how_big_ref: 1.0,
			demo_how_big_weight: 1
		});
	
	});
	
	on("change:fragmentation_damage", function (event) {
	
		getAttrs(["fragmentation_damage"], function (values) {
	
			let diceCount = getNumberOfDiceToRoll(values.fragmentation_damage);
	
			let radius = 5 * diceCount;
	
			setAttrs({
				fragmentation_radius: radius
			});
	
		});
	
	});
	
	/* ====================== */
	/*   TECHNIQUES REVISED   */
	/* ====================== */
	
	// check for changes that effect final technique level
	on("change:repeating_techniquesrevised:base_level change:repeating_techniquesrevised:default change:repeating_techniquesrevised:max_modifier change:repeating_techniquesrevised:difficulty change:repeating_techniquesrevised:skill_modifier change:repeating_techniquesrevised:points", function (event) {
	
		const technigueFields = [
			"repeating_techniquesrevised_base_level",
			"repeating_techniquesrevised_default",
			"repeating_techniquesrevised_max_modifier",
			"repeating_techniquesrevised_difficulty",
			"repeating_techniquesrevised_skill_modifier",
			"repeating_techniquesrevised_points"
		];
	
		getAttrs(technigueFields, function (values) {
	
			let finalLevel = 10;
	
			const baseLevel = +values.repeating_techniquesrevised_base_level;
	
			const defaultMod = +values.repeating_techniquesrevised_default;
	
			const customSkillModifier = +values.repeating_techniquesrevised_skill_modifier;
	
			let maxModifier = 0;
	
			let maxLevel = 0;
	
			let techPoints = +values.repeating_techniquesrevised_points;
	
			const technigueSkillMod = getModifierForTechniqueDifficulty(values.repeating_techniquesrevised_difficulty, techPoints);
	
			if (values.repeating_techniquesrevised_max_modifier) {
	
				maxModifier = +values.repeating_techniquesrevised_max_modifier;
	
				maxLevel = baseLevel + maxModifier;
	
			}
	
			finalLevel = baseLevel + defaultMod + technigueSkillMod + customSkillModifier;
	
			// check for max level
			if (maxLevel > 0 && finalLevel > maxLevel) {
	
				// the finalLevel can't exceed maxLevel
				finalLevel = maxLevel;
	
			}
	
			setAttrs({
				repeating_techniquesrevised_level: finalLevel
			});
	
		});
	
	});
	
	/**
	 * Calculate the technique skill modifier based
	 * difficulty level. see B230
	 */
	function getModifierForTechniqueDifficulty(difficultyLevel, points) {
	
		let mod = 0;
	
		let characterPoints = Number(points);
	
		if (characterPoints > 0) {
	
			if (String(difficultyLevel).toLowerCase() == "average") {
	
				mod = characterPoints;
	
			} else if (characterPoints > 1) {
	
				// Hard requires a minimum of 2 spoint be spent.
				mod = characterPoints - 1;
			}
	
		}
	
		return mod;
	
	}
	
	//------------------------------------
	// Active Defense Methods
	//------------------------------------
	
	// check for new repeating defense, if new check to add combat reflexes modifier
	on("change:repeating_defense:name", event => {
	
		getAttrs(["repeating_defense_new", "repeating_defense_skill_mod", "repeating_defense_defense_mod_reason", "combat_reflexes", "basic_lift", "weight_system"], values => {
	
			const isNew = values.repeating_defense_new === "1";
	
			const addCombatReflexes = values.combat_reflexes === "1";
	
			if (isNew) {
	
				let checked = "";

				let bonus = 0;

				if (addCombatReflexes) {
					
					checked = "1";

					bonus = "1";
				}

				let basicLift = Number(values.basic_lift) ?? 16;

				let weightSystem = values.weight_system ?? "lbs";
				
				const fields = {
					repeating_defense_defense_combat_reflexes: checked,
					repeating_defense_defense_combat_reflexes_bonus: bonus,
					repeating_defense_new: 0,
					repeating_defense_attacking_weapon_basic_lift: basicLift,
					repeating_defense_attacking_weapon_basic_lift_x2: basicLift * 2,
					repeating_defense_weight_system: weightSystem,
				};
	
				setAttrs(fields);
	
			}
	
		});
	
	});

	// check if parry weapon weight changed and update values
	on("change:repeating_defense:weapon_weight",  event => {

		const fields = [
			"repeating_defense_weapon_weight",
		];

		getAttrs(fields, values => {

			let weaponWeight = +values.repeating_defense_weapon_weight;

			if (weaponWeight < 0) {
				weaponWeight = 1;
			}

			// round to 2 decimal places
			let attackingWeaponWeightTimesThree = parseFloat((weaponWeight * 3).toFixed(2));
			let attackingWeaponWeightTimesFour = parseFloat((weaponWeight * 4).toFixed(2));
			let attackingWeaponWeightTimesFive = parseFloat((weaponWeight * 5).toFixed(2));
			let attackingWeaponWeightTimesSix = parseFloat((weaponWeight * 6).toFixed(2));
			let attackingWeaponWeightTimesSeven = parseFloat((weaponWeight * 7).toFixed(2));

			const fields = {
				repeating_defense_attacking_weapon_weight_x3: attackingWeaponWeightTimesThree,
				repeating_defense_attacking_weapon_weight_x4: attackingWeaponWeightTimesFour,
				repeating_defense_attacking_weapon_weight_x5: attackingWeaponWeightTimesFive,
				repeating_defense_attacking_weapon_weight_x6: attackingWeaponWeightTimesSix,
				repeating_defense_attacking_weapon_weight_x7: attackingWeaponWeightTimesSeven,
			};

			setAttrs(fields);

		});

	});
	
	// if basic lift changes update the basic lift stats for the active defenses
	on("change:basic_lift", event => {

		let basicLift = +event.newValue;

		if (basicLift < 0) {
			basicLift = 16;
		}

		getSectionIDs("repeating_defense", (ids) => {
	
			let fields = {};

			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				fields[`repeating_defense_${ids[i]}_attacking_weapon_basic_lift`] = basicLift;

				fields[`repeating_defense_${ids[i]}_attacking_weapon_basic_lift_x2`] = basicLift * 2;

			}
	
			setAttrs(fields, { silent: true });

		});
		

	});

	// if weight system changes, update the melee weapon's weight system
	on("change:weight_system", event => {

		let weightSystem = event.newValue ?? "lbs";

		getSectionIDs("repeating_defense", (ids) => {
	
			let fields = {};

			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				fields[`repeating_defense_${ids[i]}_weapon_weight_system`] = weightSystem;
	
			}

			setAttrs(fields, { silent: true });
	
		});
		

	});

	// check if an repeating active defense type changed
	// update raw success/fail notes based on selected defense Type
	on("change:repeating_defense:type", (event) => {
	
		const fields = [
			"repeating_defense_type"
		]
	
		getAttrs(fields, (values) => {
	
			let defenseType = values.repeating_defense_type;
	
			let successNote;
	
			let successCritNote;
	
			let failNote;
	
			let failCriticalNote;
	
			let rawNotes = getRawDefenseNotesByType(defenseType);
	
			const updateFields = {
				repeating_defense_raw_success_note: rawNotes.success,
				repeating_defense_raw_critical_success_note: rawNotes.successCritical,
				repeating_defense_raw_fail_note: rawNotes.fail,
				repeating_defense_raw_critical_fail_note: rawNotes.failCritical
			};
	
			setAttrs(updateFields);
	
		});
	
	});
	
	/**
	 * Get an array of defense notes based on defense type
	 *
	 * @param {string} defenseType Type of defense
	 *
	 * @returns {object} Properties {success, successCritical, fail, failCritical}
	 */
	function getRawDefenseNotesByType(defenseType) {
	
		let successNote;
	
		let successCritNote;
	
		let failNote;
	
		let failCriticalNote;
	
		switch (defenseType) {
			case "Dodge":
				successNote = getNotesByCode("dodge_success_notes");
				successCritNote = getNotesByCode("dodge_critical_success_notes");
				failNote = getNotesByCode("dodge_fail_notes");
				failCriticalNote = getNotesByCode("dodge_critical_failure_notes");
				break;
	
			case "Parry":
				successNote = getNotesByCode("parry_success_notes");
				successCritNote = getNotesByCode("parry_critical_success_notes");
				failNote = getNotesByCode("parry_fail_notes");
				failCriticalNote = getNotesByCode("parry_critical_failure_notes");
				break;
	
			case "Unarmed Parry":
				successNote = getNotesByCode("unarmed_parry_success_notes");
				successCritNote = getNotesByCode("unarmed_parry_critical_success_notes");
				failNote = getNotesByCode("unarmed_parry_fail_notes");
				failCriticalNote = getNotesByCode("unarmed_parry_critical_failure_notes");
				break;
	
			case "Block":
				successNote = getNotesByCode("block_success_notes");
				successCritNote = getNotesByCode("block_critical_success_notes");
				failNote = getNotesByCode("block_fail_notes");
				failCriticalNote = getNotesByCode("block_critical_failure_notes");
				break;
	
			default:
				successNote = " ";
				successCritNote = " ";
				failNote = " ";
				failCriticalNote = " ";
				break;
	
		}
	
		let notes = {
			"success": successNote,
			"successCritical": successCritNote,
			"fail": failNote,
			"failCritical": failCriticalNote
		};
	
		return notes;
	
	}
	
	/**
	 * Update hit point thresholds
	 */
	function updateHitPointThresholds() {
	
		getAttrs(["hit_points_max"], (values) => {
	
			let max = +values.hit_points_max;
	
			let reeling = Math.ceil(max / 3);
	
			let verge = max * -1;
	
			let death = max * -5;
	
			let destruction = max * -10;
	
			const fields = {
				hp_reeling: reeling,
				hp_verge: verge,
				hp_death: death,
				hp_destruction: destruction
			};
	
			setAttrs(fields);
	
		});
	
	}
	
	/**
	 * Update fatigue point thresholds
	 */
	function updateFatiguePointThresholds() {
	
		getAttrs(["fatigue_points_max"], (values) => {
	
			let max = +values.fatigue_points_max;
	
			let tired = Math.ceil(max / 3);
	
			let unconscious = max * -1;
	
			const fields = {
				fp_tired: tired,
				fp_unconscious: unconscious,
			};
	
			setAttrs(fields);
	
		});
	
	}
	
	/**
	 * Generate a table for storing active defense notes.
	 */
	function getRawNotes() {
	
		// TODO: Convert all of these to translations!!!
		const dodgeSuccessNotes = `If a single rapid-fire attack, avoid one hit, plus additional hits equal to your margin of success. See B375.`;
	
		const dodgeCriticalSuccessNotes = `If melee attack, foe goes immediately to the Critical Miss Table on B556. See B381. 

If a single rapid-fire attack, dodge <i>all</i> hits. See B375.`;
	
		const dodgeRetreatSuccessNotes = ``;
	
		const dodgeRetreatCriticalSuccessNotes = `If melee attack, foe goes immediately to the Critical Miss Table on B556. See B381.`;

		const dodgeFailNotes = "";
	
		const dodgeCriticalFailureNotes = `You lose your footing and fall prone (no effect if already prone). See B382`;
	
		const parrySuccessNotes = `If parrying a weapon 3 times your weapons weight, roll for breakage. See B376.`;
	
		const parryCriticalSuccessNotes = `If melee attack, foe goes immediately to the Critical Miss Table on B556. See B381. 

If parrying a weapon 3 times your weapons weight, roll for breakage. See B376.`;
	
		const parryFailNotes = ``;
	
		const parryCriticalFailureNotes = `Roll on the appropriate <i>Critical Miss Table</i> B556. See B382.`;
	
		const unarmedParrySuccessNotes = "";
	
		const unarmedParryCriticalSuccessNotes = `If melee attack, foe goes immediately to the Critical Miss Table on B556. See B381. 

If attack is a thrown weapon, a bare handed parry lets you <i>catch</i> the incoming weapon without hurting yourself. See B381.`;
	
		const unarmedParryFailNotes = `The attacker may choose to hit the original target or the limb you used to parry with. See B376.`;
	
		const unarmedParryCriticalFailureNotes = `Roll on the appropriate <i>Critical Miss Table</i> B556. See B382.
	
The attacker may choose to hit the original target or the limb you used to parry with. See B376.`;
	
		const blockSuccessNotes = ``;
	
		const blockCriticalSuccessNotes = `If melee attack, foe goes immediately to the Critical Miss Table on B556. See B381.`;
	
		const blockFailNotes = "";
	
		const blockCriticalFailureNotes = `Lose your grip on the your shield and you must take a turn to ready it before you can use it to block again. See B382.`;
	
		const criticalMissNotes = `Roll on the appropriate Critical Miss Table (B556).`;
	
		const criticalHitNotes = `**The Attack Automatically hits:** Foe does not get an active defense roll! (B381). Roll on appropriate Critical Hits Table (B556). 
	**For Rapid Fire attacks:** The first round is a critical hit; All the others are normal hits, and the target may dodge. Rule verification from Kromm.
	**For liquid Attacks:** The liquid gets in the victim's eyes and is blinded for 1d seconds (the GM rolls secretly). (B405)
	`;

		const slamAttackNotes = getTranslationByKey("slam-attack-notes");

		const slamDamageNotes = getTranslationByKey("slam-damage-notes");

		const woundNotesCutting = `**CUTTING** *(Always round down)*
**Damage:** x1.5 **Neck:** x2 **Skull:** x4
**Knockback:** A cutting attack can cause knockback only if it fails to penetrate DR. (B378)
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesImpaling = `**IMPALING** *(Always round down)*
**Damage:** x2 **Limbs:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x0.5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesCrushing = `**CRUSHING** *(Always round down)*
**Damage:** x1 **Neck:** x1.5 **Skull:** x4
**Knockback:** A crushing attack can cause knockback regardless of whether it penetrates DR. (B378)
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesPiercingMinus = `**PIERCING-** *(Always round down)*
**Damage:** x.5 **Vitals:** x3 **Skull:** x4
**Unliving:** x1/5 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/10
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesPiercing = `**PIERCING** *(Always round down)*
**Damage:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1/3 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesPiercingPlus = `**PIERCING+** *(Always round down)*
**Damage:** x1.5 **Limbs**: x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x0.5 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x1/3
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesPiercingPlusPlus = `**PIERCING++** *(Always round down)*
**Damage:** x2 **Limbs:** x1 **Vitals:** x3 **Skull:** x4
**Unliving:** x1 (other than the eye, skull, or vitals  - otherwise per location) (B400)
**Homogenous:** x0.5
**Diffuse:** Max 1HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesAffliction = `**AFFLICTION** *(Always round down)*
Special damage and affects based on affliction description
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)`;

		const woundNotesBurn = `**BURN** *(Always round down)*
**Damage:** x1 **Skull:** x4
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesCorrosion = `**CORROSION** *(Always round down)*
**Damage:** x1 **Neck:** x1.5 **Skull:** x4 **Face** x1.5
**Face** blind eye if major wound, both eyes if full HP
**Armor:** -1 DR per 5 points damage
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesFatigue = `**FATIGUE** *(Always round down)*
**Damage:** x1
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Normal Fatigue Damage, but apply HP modifier if applicable. Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesToxic = `**TOXIC** *(Always round down)*
**Damage:** x1
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)(Additional Ref: B380)`;

		const woundNotesSpecial = `**SPECIAL** *(Always round down)*
See notes for weapon.
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		const woundNotesKnockback = `**Knockback Only**  *(Always round down)*
B378
**Unliving:** Hit location has its usual effect
**Homogenous:** x1
**Diffuse:** Max 2HP Knockback (Exception: Area-effect, cone, and explosion attacks cause normal injury.)
(Additional Ref: B380)`;

		/* Spell Roll Result Notes */
		const spellCriticalSuccessNotes = `The spell works especially well. **Details are up to the GM**, who should be both generous and creative. Whatever else occurs, there is never an energy cost if you get a critical success when you cast a spell. B235, M7`;

		const spellFailNotes = `The spell does not work. If success would have cost energy, you lose one energy point; otherwise, you lose nothing. (Exception: You must pay the full energy cost even on a failure for an Information spell; see Information Spells. B235, M7.
						
**In Very High Mana Areas**, all Failures are treated as Critical Failures. M6.`;

		const spellCriticalFailureNotes = `You must spend the full energy cost and the spell fails . . . badly! **The GM may** use the Critical Spell Failure Table on B236 or, M7, or improvise some other “backfire” he finds amusing. (B235, M7.)
					
**In Very High Mana Areas**, all actual Critical Failures produce spectacular disasters! (M6)

**In Low Mana Areas**, Critical Failures have mild effects or no effect at all. (M6)`;

		/* Fright Check Success/Fail Notes */
		const frightCheckSuccessNotes = `You suffer no ill effects. (B360)`;
		const frightCheckCriticalSuccessNotes = `You suffer no ill effects. (B360)  The GM decides if there is some unusual benefit because of the Critical Success.`;
		const frightCheckFailNotes = `Roll 3d6, add your margin of failure on the Fright Check, and consult the Fright Check Table B360-361. (B360). Also, if using GURPS Horror, add -1 to the Stress or Derangement value as appropriate (H141).`;
		const frightCheckCriticalFailureNotes = `Roll 3d6, add your margin of failure on the Fright Check, and consult the Fright Check Table B360-361. (B360). Also, if using GURPS Horror, add -3 to the Stress or Derangement value as appropriate (H141). The GM decides if there is some unusual disaster because of the Critical Failure.`;

	    /* Unstun Check Success/Fail Notes */
		const unstunCheckSuccessNotes = `You recover from stun and can act normally on subsequent turns. (B420)`;
		const unstunCheckCriticalSuccessNotes = `You recover from stun and can act normally on subsequent turns. (B420) The GM decides if there is some unusual benefit because of the Critical Success.`;
		const unstunCheckFailNotes = `You remain stunned; your next maneuver must also be Do Nothing, but you get another roll at the end of that turn... and so on, until you recover from stun. (B420)`;
		const unstunCheckCriticalFailureNotes = `You remain stunned; your next maneuver must also be Do Nothing, but you get another roll at the end of that turn... and so on, until you recover from stun. (B420) The GM decides if there is some unusual disaster because of the Critical Failure.`;

	    /* Knockdown Check Success/Fail Notes */
		const knockdownCheckSuccessNotes = `You suffer no penalty beyond ordinary shock. (B420)`;
		const knockdownCheckCriticalSuccessNotes = `You suffer no penalty beyond ordinary shock.`;
		const knockdownCheckFailNotes = `You're stunned; see Effects of Stun, B420. You fall prone (if you weren't already), and if you were holding anything, you drop it.

**On a Failure by 5 or more:** You fall unconscious! See Recovering from Unconsciousness (B423). Obviously, you fall prone (if you weren't already), and if you were holding anything, you drop it. (B420)`;
		const knockdownCheckCriticalFailureNotes = `You fall unconscious! See Recovering from Unconsciousness (B423). Obviously, you fall prone (if you weren't already), and if you were holding anything, you drop it. (B420)`;

	    /* Unconscious Check Success/Fail Notes */
		const unconsciousCheckSuccessNotes = `You are able to remain conscious.`;
		const unconsciousCheckCriticalSuccessNotes = `You are able to remain conscious. The GM decides if there is some unusual benefit because of the Critical Success.`;
		const unconsciousCheckFailNotes = `The GM to decide whether you are truly unconscious or just totally incapacitated by pain and injury - but either way, you can't do anything. If you fall unconscious, see Recovering from Unconsciousness (B423).`;
		const unconsciousCheckCriticalFailureNotes = `The GM to decide whether you are truly unconscious or just totally incapacitated by pain and injury - but either way, you can't do anything. If you fall unconscious, see Recovering from Unconsciousness (B423). The GM decides if there is some unusual disaster because of the Critical Failure.`;

	    /* Death Check Success/Fail Notes */
		const deathCheckSuccessNotes = `You don't die.`;
		const deathCheckCriticalSuccessNotes = `You don't die. The GM decides if there is some unusual benefit because of the Critical Success.`;
		const deathCheckFailNotes = `You died! When a PC or important NPC is killed in any but the most sudden and thorough fashion, the GM should allow a "dying action." If this is a final blow to the enemy, it should take no more than a turn. (B423)
**On a Failure of only 1 or 2:** you don't drop dead, but suffer a “mortal wound.” This is a wound so severe that your internal injuries might kill you even after you stop bleeding. (See Mortal Wounds B423)`;
		const deathCheckCriticalFailureNotes = `You died! When a PC or important NPC is killed in any but the most sudden and thorough fashion, the GM should allow a "dying action." If this is a final blow to the enemy, it should take no more than a turn. (B423)
		**On a Failure of only 1 or 2:** you don't drop dead, but suffer a "mortal wound."" This is a wound so severe that your internal injuries might kill you even after you stop bleeding. (See Mortal Wounds B423)`;

	    const notes = [
			{ code: "dodge_success_notes", value: dodgeSuccessNotes },
			{ code: "dodge_critical_success_notes", value: dodgeCriticalSuccessNotes },
			{ code: "dodge_retreat_success_notes", value: dodgeRetreatSuccessNotes },
			{ code: "dodge_retreat_critical_success_notes", value: dodgeRetreatCriticalSuccessNotes },
			{ code: "dodge_fail_notes", value: dodgeFailNotes },
			{ code: "dodge_critical_failure_notes", value: dodgeCriticalFailureNotes },
			{ code: "parry_success_notes", value: parrySuccessNotes },
			{ code: "parry_critical_success_notes", value: parryCriticalSuccessNotes },
			{ code: "parry_fail_notes", value: parryFailNotes },
			{ code: "parry_critical_failure_notes", value: parryCriticalFailureNotes },
			{ code: "unarmed_parry_success_notes", value: unarmedParrySuccessNotes },
			{ code: "unarmed_parry_critical_success_notes", value: unarmedParryCriticalSuccessNotes },
			{ code: "unarmed_parry_fail_notes", value: unarmedParryFailNotes },
			{ code: "unarmed_parry_critical_failure_notes", value: unarmedParryCriticalFailureNotes },
			{ code: "block_success_notes", value: blockSuccessNotes },
			{ code: "block_critical_success_notes", value: blockCriticalSuccessNotes },
			{ code: "block_fail_notes", value: blockFailNotes },
			{ code: "block_critical_failure_notes", value: blockCriticalFailureNotes },
			{ code: "critical_miss_notes", value: criticalMissNotes },
			{ code: "critical_hit_notes", value: criticalHitNotes },
			{ code: "slam_attack_notes", value: slamAttackNotes },
			{ code: "slam_damage_notes", value: slamDamageNotes },
			{ code: "wound_notes_cutting", value: woundNotesCutting},
			{ code: "wound_notes_impaling", value: woundNotesImpaling},
			{ code: "wound_notes_crushing", value: woundNotesCrushing },
			{ code: "wound_notes_piercing_minus", value: woundNotesPiercingMinus },
			{ code: "wound_notes_piercing", value: woundNotesPiercing },
			{ code: "wound_notes_piercing_plus", value: woundNotesPiercingPlus }, 
			{ code: "wound_notes_piercing_plus_plus", value: woundNotesPiercingPlusPlus },
			{ code: "wound_notes_affliction", value: woundNotesAffliction }, 
			{ code: "wound_notes_burn", value: woundNotesBurn },
			{ code: "wound_notes_corrosion", value: woundNotesCorrosion }, 
			{ code: "wound_notes_fatigue", value: woundNotesFatigue },
			{ code: "wound_notes_toxic", value: woundNotesToxic },
			{ code: "wound_notes_special", value: woundNotesSpecial }, 
			{ code: "wound_notes_knockback", value: woundNotesKnockback }, 
			{ code: "spell_critical_success_notes", value: spellCriticalSuccessNotes }, 
			{ code: "spell_fail_notes", value: spellFailNotes }, 
			{ code: "spell_critical_failure_notes", value: spellCriticalFailureNotes },
			{ code: "fright_check_success_notes", value: frightCheckSuccessNotes },
			{ code: "fright_check_fail_notes", value: frightCheckFailNotes },
			{ code: "fright_check_critical_success_notes", value: frightCheckCriticalSuccessNotes }, 
			{ code: "fright_check_critical_failure_notes", value: frightCheckCriticalFailureNotes },
			{ code: "unstun_check_success_notes", value: unstunCheckSuccessNotes },
			{ code: "unstun_check_fail_notes", value: unstunCheckFailNotes },
			{ code: "unstun_check_critical_success_notes", value: unstunCheckCriticalSuccessNotes }, 
			{ code: "unstun_check_critical_failure_notes", value: unstunCheckCriticalFailureNotes },
			{ code: "knockdown_check_success_notes", value: knockdownCheckSuccessNotes },
			{ code: "knockdown_check_fail_notes", value: knockdownCheckFailNotes },
			{ code: "knockdown_check_critical_success_notes", value: knockdownCheckCriticalSuccessNotes }, 
			{ code: "knockdown_check_critical_failure_notes", value: knockdownCheckCriticalFailureNotes },
			{ code: "unconscious_check_success_notes", value: unconsciousCheckSuccessNotes },
			{ code: "unconscious_check_fail_notes", value: unconsciousCheckFailNotes },
			{ code: "unconscious_check_critical_success_notes", value: unconsciousCheckCriticalSuccessNotes }, 
			{ code: "unconscious_check_critical_failure_notes", value: unconsciousCheckCriticalFailureNotes }
		];
	
		return notes;
	
	}
	
	/**
	 * Create global function
	 * use: let mod = getDefenseNotesByCode("blah");
	 * Uses the array of json object objects
	 * to get the modifier based on speed/range
	 * 
	 * @param {string} code
	 *  
	 * @returns {string}
	 */
	const getNotesByCode = (code) => {
	
		let entry = rawRollNotes.find((notes) => notes.code === code);
	
		// if no matches, return no string
		return (entry != undefined ? entry.value : "");
	
	};
	
	// when reset close range shotgun fields is clicked
	on("clicked:shotgun_reset", function () {
	
		resetShotgunFields();
	
	});
	
	function resetShotgunFields() {
	
		const updateFields = {
			shotgun_damage: "1d6+1",
			shotgun_damage_rof: "2x9",
			shotgun_damage_type: "Piercing (pi)",
			shotgun_half_range: "50",
			shotgun_close_range: "5",
			shotgun_close_rof: "2",
			shotgun_close_damage: "4d6+4",
			shotgun_dr_multiplier: "x4",
			shotgun_dr_multiplier_notes: "Multiply targets DR by 4."
		};
	
		setAttrs(updateFields);
	
	}
	
	on("change:shotgun_damage change:shotgun_rof change:shotgun_damage_type change:shotgun_half_range", () => {
	
		updateShotgunTool();
	
	});
	
	/**
	 * Updates the fields for the shotgun tool
	 */
	function updateShotgunTool() {
	
		const fields = [
			"shotgun_damage",
			"shotgun_rof",
			"shotgun_damage_type",
			"shotgun_half_range",
			"damage_type_note_cut",
			"damage_type_note_imp",
			"damage_type_note_cr",
			"damage_type_note_pi_minus",
			"damage_type_note_pi",
			"damage_type_note_pi_plus",
			"damage_type_note_pi_plus_plus",
			"damage_type_note_aff",
			"damage_type_note_burn",
			"damage_type_note_cor",
			"damage_type_note_fat",
			"damage_type_note_tox",
			"damage_type_note_spec",
			"damage_type_note_knockback"
		];
	
		getAttrs(fields, (values) => {
	
			let closeRange = 1;
	
			let closeDamage = "4d6";
	
			let halfDamageRange = parseInt(values.shotgun_half_range, values);
	
			if (isNaN(halfDamageRange)) {
				closeRange = 0;
			} else {
				closeRange = Math.floor(.1 * halfDamageRange);
			}
	
			let { closeRof, modifier } = getShotGunModifiers(values.shotgun_rof);
	
			// calculate close damage: 1d6+2
			let arrDamage = String(values.shotgun_damage).toLowerCase().split("d");
	
			let damageDie = 1;
	
			let damageMod = 0;
	
			let damageTypeNote = getDamageTypeNote(values.shotgun_damage_type, values);

			let minDamageNote = getMinimumDamageNote(values.shotgun_damage_type);

			let minDamage = minDamageNote.replace("Min ", "");
	
			// try to get the base damage die for shotgun
			// 1d6+1. arrDamage = [1][6+1]
			if (Array.isArray(arrDamage)) {
	
				damageDie = parseInt(arrDamage[0]);
	
				// check for a bad number
				if (isNaN(damageDie)) {
					damageDie = 1;
				}
	
				// check for the second half die modifier
				if (arrDamage.length === 2) {
	
					// get rid of the 6 
					// 6+1. we just need the +1 or -1.
					damageMod = parseInt(arrDamage[1].replace("6", ""));
	
				}
	
			}
	
			let closeDamageDie = damageDie * modifier;
	
			let closeDamageDieMod = damageMod * modifier;
	
			closeDamage = `${closeDamageDie}d6`;
	
			// check if we should add the damage die mod
			if (closeDamageDieMod > 0) {
	
				closeDamage = `${closeDamage}+${closeDamageDieMod}`;
	
			} else if (damageMod < 0) {
	
				closeDamage = `${closeDamage}${closeDamageDieMod}`;
	
			}
	
			let drMultiplier = `x${modifier}`;

			let multiplierNote = `Multiply Targets DR by ${modifier}`;
	
			const updateFields = {
				"shotgun_close_range": closeRange,
				"shotgun_close_rof": closeRof,
				"shotgun_close_damage": closeDamage,
				"shotgun_dr_multiplier": drMultiplier,
				"shotgun_dr_multiplier_notes": multiplierNote,
				"shotgun_damage_type_note": damageTypeNote,
				"shotgun_minimum_damage_note": minDamageNote,
				"shotgun_minimum_damage": minDamage
			};
	
			setAttrs(updateFields);
	
		});
	
	}
	
	/**
	* Get shotgun modifier based on rate of fire
	*
	* @param {string} rateOfFire Shotgun rate of fire, i.e.: 2x9
	* 
	* @returns {object} Properties {baseDamage, Modifier}
	*/
	function getShotGunModifiers(rateOfFire) {
	
		// just in case, remmove any negative numbers
		if (rateOfFire) {
			rateOfFire = rateOfFire.replace("-", "");
		} else {
			rateOfFire = "1x9";
		}
	
		// rateOfFire = shotes x Multiplier
		// example: 2 x 9
		let arrRof = String(rateOfFire).toLowerCase().split("x");
	
		let baseRof = 1;
	
		let multiplier = 1;
	
		let modifier = 1;
	
		if (arrRof.length === 2) {
	
			baseRof = parseInt(arrRof[0]);
	
			// make sure we have good number
			if (isNaN(baseRof)) {
				baseRof = 1;
			}
	
			multiplier = parseInt(arrRof[1]);
	
			// make sure we have a number
			if (isNaN(multiplier)) {
	
				modifier = 1;
	
			} else {
	
				modifier = Math.floor(multiplier / 2);
	
			}
	
		}
	
		let modifiers = {
			closeRof: baseRof,
			modifier: modifier
		};
	
		return modifiers;
	
	}
	
	on("change:hit_points_max", (event) => {
	
		updateRepeatingHitLocationCrippledValues();
	
	});
	
	
	function updateReach() {
	
		getAttrs(["size"], (values) => {
	
			const size = +values.size;
	
			let isCloseReachOne = "off";
	
			let reach = 0;
	
			switch (size) {
				case 0:
					reach = 0;
					break;
	
				case 1:
					reach = 1;
					isCloseReachOne = "on";
					break;
	
				case 2:
					reach = 1;
					break;
	
				case 3:
					reach = 2;
					break;
	
				case 4:
					reach = 3;
					break;
	
				case 5:
					reach = 5;
					break;
	
				case 6:
					reach = 7;
					break;
	
				case 7:
					reach = 10;
					break;
	
				case 8:
					reach = 15;
					break;
	
				case 9:
					reach = 20;
					break;
	
				case 10:
					reach = 30;
					break;
	
				default:
					reach = 0;
					break;
			}
	
			let fields = {
				"reach": reach,
				"is_close_reach": isCloseReachOne
			};
	
			setAttrs(fields, { silent: true });
	
		});
	
	}

	function updateCombatReflexesMod() {

		getAttrs(["combat_reflexes", "reflex_mods_added", "fear_check_mod", "dodge_mod"], values => {

			const hasReflexModsBeenApplied = values.reflex_mods_added === "1" ? true : false;

			/*
			if (hasReflexModsBeenApplied) {
				//we're done, let's get out of here.
				return;
			}
			*/

			console.log('***** UPDATE COMBAT REFLEX MODIFIERS *****');

			let currentFearCheckMod = Number(values.fear_check_mod) || 0;

			let newFearCheckMod = currentFearCheckMod;

			let currentDodgeMod = Number(values.dodge_mod) || 0;

			let newDodgeMod = currentDodgeMod;

			let hasCombatReflexes = values.combat_reflexes === "1" ? true : false;

			let combatReflexesFearCheckMod = 0;

			let combatReflexesDodgeMod = 0;

			if (hasCombatReflexes) {

				// let's set the new attributes
				combatReflexesFearCheckMod = 2;

				combatReflexesDodgeMod = 1;

			}

			if (hasCombatReflexes && currentFearCheckMod >= 2) {

				// let's remove that +2 fright check bonus, it is now stored in the new field
				newFearCheckMod = currentFearCheckMod - 2;

			} 

			if (hasCombatReflexes && currentDodgeMod >= 1) {

				// let's remove the +1 dodge, it is now stored in the new field
				newDodgeMod = currentDodgeMod - 1;

			} 

			setAttrs({
				fear_check_mod: newFearCheckMod,
				dodge_mod: newDodgeMod,
				combat_reflexes_fear_check_mod: combatReflexesFearCheckMod,
				combat_reflexes_dodge_mod: combatReflexesDodgeMod,
				reflex_mods_added: 1
			});

		});

	}

	/* ROLL MODIFIERS BOX */
	
	// close roll modifiers, no updates
	on("clicked:close_roll_modifiers", (event) => {
	
		let fields = {
			"show_roll_modifiers": 0,
			"roll_modifier_types": ""
		};
	
		setAttrs(fields, { silent: true });
	
	});
	
	// apply and close the roll modifiers modal box
	on("clicked:apply_roll_modifiers", (event) => {
	
		applyRollModifiers();
	
	});

	/**
	* Applies the roll modifiers to the current section: 
	*/
	function applyRollModifiers() {

		let fields = [
			"roll_modifier_types",
			"max_skill_nine",
			"dialog_custom_roll_modifier",
			"dialog_custom_roll_modifier_reason",
			"roll_modifier",
			"roll_modifier_summary",
			"roll_trait_summary",
			"roll_hit_location",
			"roll_maneuver",
			"roll_allout_attack",
			"shield_db",
			"magic_db",
			"defense_encumbered",
			"skill_encumbered"
		];
	
		getAttrs(fields, values => {
	
			// roll_modifier_types stores which repeating section we're applying modifiers to.
			// roll_modifier_types = skill | technique | defense | melee | ranged
			let section = values.roll_modifier_types;

			// If max 9 is not used, set value to 100, so it will never be used
			// If max 9 is used, then limit effective skill to 9 by setting value to 9
			let maxSkillNine = 100;
	
			if (Number(values.max_skill_nine) === 1) {
				maxSkillNine = 9;
			}

			const rollModifier = Number(values.roll_modifier);

			let rollModifierStatus = "neutral";

			if (rollModifier > 0) {
				rollModifierStatus = "positive";
			} else if (rollModifier < 0) {
				rollModifierStatus = "negative";
			}

			let defenseEncumbered = Number(values.defense_encumbered) || 0;

			let skillEncumbered = Number(values.skill_encumbered) || 0;

			let toolbarEncumberedChecked = "0";

			if ( section === "defense" && defenseEncumbered < 0 ) {
				toolbarEncumberedChecked = "1";
			} else if (section != "defense" && skillEncumbered < 0) {
				toolbarEncumberedChecked = "1";
			}
				
			// fields to get updated 
			const updateFields = {
				"show_roll_modifiers": 0,
				"roll_modifier_types": "",
				[`${section}_custom_roll_modifier`]: Number(values.dialog_custom_roll_modifier),
				[`${section}_custom_roll_modifier_reason`]: values.dialog_custom_roll_modifier_reason,
				[`${section}_roll_modifier_status`]: rollModifierStatus,
				[`${section}_roll_modifier`]: rollModifier,
				[`${section}_roll_modifier_summary`]: values.roll_modifier_summary,
				[`${section}_roll_trait_summary`]: values.roll_trait_summary,
				[`${section}_roll_max_nine`]: values.max_skill_nine,
				[`${section}_roll_max_nine_value`]: maxSkillNine,
				[`${section}_roll_hit_location`]: values.roll_hit_location,
				[`${section}_roll_maneuver`]: values.roll_maneuver,
				[`${section}_roll_allout_attack`]: values.roll_allout_attack,
				[`${section}_roll_apply_encumbrance`]: toolbarEncumberedChecked,
			};

			if (section === "defense") {
				updateFields[`${section}_apply_shield_db`] = values.shield_db;
				updateFields[`${section}_apply_magic_db`] = values.magic_db;
			}

			setAttrs(updateFields, { silent: true });
	
		});

	}
	
	// reset modifiers but keep traits
	on("clicked:reset_roll_modifiers", event => {
	
		resetRollModifiersToolBox();
	
	});

	// reset all roll modifiers 
	function resetAllRollModifiers() {

		["melee", "ranged", "spell", "skill", "technique", "defense"].forEach(section => {
	
			setAttrs({roll_modifier_types: section}, null, resetRollModifiersToolBox(applyRollModifiers));
			
		});

	}
	
	/**
	 * Resets the roll modifiers fields in the dialog box
	 * Doesn't change the traits fields, since they are usually static
	 **/
	function resetRollModifiersToolBox(callback) {
	
		// make sure we have a valid function
		callback = callback || noop;

		getAttrs(["roll_modifier_types"], values => {
	
			let modType = values.roll_modifier_types;
	
			let modFields;
	
			let key = "";
	
			let value = "";
	
			let rollModifier = 0;
	
			let rollSummary = "";
	
			let updateFields = {
				roll_modifier: rollModifier,
				max_skill_nine: 0,
				visibility_modifier: 0,
				roll_modifier_summary: rollSummary,
				roll_trait_summary: "",
				roll_hit_location: "",
				roll_maneuver: "",
				roll_allout_attack: "",
				hit_location_type: "",
				humanoid_location: "torso-0",
				target_size_modifier: 0,
				grapple_modifier: -1,
				has_shield: 0,
				target_chink_in_armor: 0,
				target_light_cover: 0,
				target_down: 0,
				target_partly_exposed: 0,
				target_intervening_figures: 0,
				ranged_range_speed: 0,
				ranged_rof: 1,
				ranged_scope_bonus: 0,
				ranged_laser_sight: 0,
				ranged_bulk: -2,
				ranged_move_default_or_bulk: 0,
				vehicle_stability_rating: 0,
				vehicle_weapon_unstabilized: 0,
				ranged_elevation: 0,
			};
	
			switch (modType) {
	
				case "technique":
					modFields = [...techniqueModifierFields];
					break;
	
				case "melee":
					modFields = [...meleeModifierFields];
					break;
	
				case "ranged":
					modFields = [...rangedModifierFields];
					break;
	
				case "defense":
					modFields = [...defenseModifierFields];
					break;
	
				case "spell":
	
					modFields = [...spellModifierFields];
	
					// remove spells on and maintained. do NOT reset
					modFields.splice(modFields.indexOf("spell_on_penalty_total"), 1);
					modFields.splice(modFields.indexOf("spell_maintained_penalty_total"), 1);
	
					break;
	
				case "skill":
				default:
					// NOTE: Need to do a deep copy, since we don't want to reference the original array
					modFields = [...skillModifierFields];
					break;
	
			}
	
			// loop through each item in the array
			// if a modifier add to udpatefields, clear value
			for (let i = 0; i < modFields.length; i++) {
	
				key = modFields[i];
	
				// ignore traits
				if (traitFields.indexOf(key) === -1) {
	
					// check for reason field, which is a text value
					if (key == "dialog_custom_roll_modifier_reason" ||
						key == "hit_location") {
	
						value = "";
	
					} else if (key == "melee_maneuver") {
	
						value = "step-attack";
	
					} else if (key == "ranged_maneuver") {
	
						value = "step-attack";
	
					} else if (key == "defense_maneuver") {
	
						value = "step-attack";
	
					} else {
	
						value = "";
	
					}
	
					// add a new property
					updateFields[key] = value;
	
				}
	
			}

			setAttrs(updateFields, { silent: true }, callback);
	
		});
	
	}
	
	const arrChangeSkillRollMods = [
		"change:show_roll_modifiers",
		"change:shock_penalty",
		"change:dialog_custom_roll_modifier",
		"change:dialog_custom_roll_modifier_reason",
		"change:night_vision",
		"change:temporary_night_vision",
		"change:has_dark_vision",
		"change:has_high_pain_threshold",
		"change:has_low_pain_threshold",
		"change:is_used_to_blindness",
		"change:coughing_sneezing_iq",
		"change:coughing_sneezing_dx",
		"change:drowsy",
		"change:tipsy",
		"change:drunk",
		"change:euphoria",
		"change:distraction",
		"change:pain_level",
		"change:skill_encumbered",
		"change:bad_footing",
		"change:shield_close_combat_penalty",
		"change:grappled",
		"change:holding_large_shield",
		"change:visiblity_condition",
		"change:darkness_penalty",
		"change:smoke_penalty",
		"change:fog_penalty",
		"change:blur_penalty",
		"change:other_vision_penalty",
		"change:task_difficulty",
		"change:task_extra_time",
		"change:task_haste",
		"change:unfamiliar_culture",
		"change:language_modifier",
		"change:iq_tech_level_modifier",
		"change:non_iq_tech_level_modifier",
		"change:task_equipment_modifier",
		"change:task_missing_items",
		"change:task_damaged_equipment",
		"change:unfamiliar_equipment",
		"change:target_size_modifier",
		"change:hit_location_modifier",
		"change:hit_location",
		"change:melee_maneuver",
		"change:melee_all_out_attack",
		"change:deceptive_strike",
		"change:evaluate",
		"change:rapid_strike",
		"change:flurry_of_blows",
		"change:rapid_strike_master",
		"change:attack_from_above",
		"change:mighty_blow",
		"change:melee_height_difference",
		"change:improvised_weapon",
		"change:tactics",
		"change:backstab",
		"change:unfriendly_hex",
		"change:ranged_tactics",
		"change:ranged_backstab",
		"change:weapon_hand",
		"change:off_hand_training",
		"change:dual_weapon_training",
		"change:ranged_weapon_hand",
		"change:ranged_off_hand_training",
		"change:ranged_dual_weapon_training",
		"change:mounted_skill_difference",
		"change:mount_attacked",
		"change:mount_has_velocity",
		"change:posture",
		"change:wild_swing",
		"change:ranged_weapon_hand",
		"change:ranged_off_hand_training",
		"change:ranged_dual_weapon_training",
		"change:ranged_accuracy_bonus",
		"change:ranged_range_speed_modifier",
		"change:ranged_aiming_bonus",
		"change:ranged_rof_modifier",
		"change:ranged_targeting_system_modifier",
		"change:ranged_maneuver",
		"change:ranged_move_default_or_bulk",
		"change:ranged_in_close_combat",
		"change:ranged_damaged_weapon",
		"change:ranged_strength_difference",
		"change:ranged_opportunity_fire_watched",
		"change:ranged_opportunity_fire_target",
		"change:ranged_braced",
		"change:ranged_popup",
		"change:ranged_vehicle_conditions",
		"change:ranged_controll_roll",
		"change:ranged_over_under_mount",
		"change:ranged_vehicle_dodge",
		"change:ranged_air_vehicle_dodge",
		"change:defense_maneuver",
		"change:defense_crawling",
		"change:defense_kneeling",
		"change:defense_from_behind",
		"change:defense_from_side",
		"change:defense_runaround",
		"change:shield_db",
		"change:magic_db",
		"change:general_db",
		"change:defense_retreat_dodge",
		"change:defense_retreat_parry",
		"change:defense_retreat_parry_fence",
		"change:defense_retreating_flight",
		"change:defense_acrobatic_dodge_success",
		"change:defense_acrobatic_dodge_failed",
		"change:defense_dodge_drop",
		"change:defense_feverish",
		"change:defense_offhand_parry",
		"change:defense_parries",
		"change:defense_parries_master",
		"change:defense_improvised_weapon",
		"change:defense_laser_sight",
		"change:defense_deceptive_attack",
		"change:defense_feint",
		"change:defense_height_difference",
		"change:defense_mounted",
		"change:defense_tactics",
		"change:defense_hidden_weapon",
		"change:defense_parry_knife",
		"change:defense_parry_kusari",
		"change:defense_unarmed_parry",
		"change:defense_dual_weapon",
		"change:defense_parry_flail",
		"change:defense_parry_nunchaku",
		"change:defense_block_flail",
		"change:defense_block_nunchaku",
		"change:defense_thrown_weapon",
		"change:defense_thrown_small_weapon",
		"change:defense_trident_dodge",
		"change:defense_trident_block",
		"change:defense_stunned",
		"change:defense_nauseated",
		"change:defense_encumbered",
		"change:defense_cant_see_attacker",
		"change:defense_bad_footing",
		"change:defense_distraction",
		"change:defense_grappled_dodge",
		"change:defense_grappled_block",
		"change:spells_low_mana",
		"change:spell_burn_hit_points",
		"change:spell_ceremonial_bonus",
		"change:regular_spell_modifier",
		"change:regular_spell_cant_see_touch",
		"change:spell_long_distance",
		"change:spell_natures_strength",
	];
	
	const changeSkillRollMods = arrChangeSkillRollMods.join(" ");
	
	// total skill roll modifiers
	on(changeSkillRollMods, (event) => {
	
		getAttrs(["show_roll_modifiers", "roll_modifier_types"], (values) => {
	
			let showRollDialog = +values.show_roll_modifiers;
	
			let modifierType = values.roll_modifier_types

			if (showRollDialog && modifierType) {
	
				totalRollModifiersDialogBox(modifierType);
	
			}
	
		});
	
	});
	
	/**
	 * Total up the modifiers and check for special conditions
	 * based on modifier type.
	 * 
	 * @param {string} modifierType Values: skill | technique | melee | range | spell
	 */
	function totalRollModifiersDialogBox(modifierType, callback) {
	
		callback = callback || noop;

		let fields;
	
		// fields are defined constants, see beginning of script
		switch (modifierType) {
	
			case "spell":
				fields = [...spellModifierFields];
				break;
	
			case "technique":
				fields = [...techniqueModifierFields];
				break;
	
			case "melee":
				fields = [...meleeModifierFields];
				break;
	
			case "ranged":
				fields = [...rangedModifierFields];
				break;
	
			case "defense":
				fields = [...defenseModifierFields];
				break;
	
			case "skill":
			default:
				fields = [...skillModifierFields];
				break;
		}
	
		getAttrs(fields, (values) => {
	
			let max9 = 0;
	
			let rollMax9 = false;
	
			let visibilityMax9 = false;
	
			let visibilityMod = 0;
	
			let visibilitySummary;
	
			let rollModifierSummary;
	
			let rollModifier = 0;
	
			let traitSummary;
	
			let hitLocationDescription = "";
	
			let maneuver = "";
	
			let allOutAttack = "";
	
			[rollModifier, rollMax9, rollModifierSummary, traitSummary, hitLocationDescription, maneuver, allOutAttack] = getRollModifiers(values);
	
			[visibilityMod, visibilityMax9, visibilitySummary] = getVisibilityModifiers(values);
	
			if (rollMax9 || visibilityMax9) {
				max9 = 1;
			}
	
			// use javascript spread operator to copy values and then merge into finalSummary
			let finalSummary = new Map([...rollModifierSummary, ...visibilitySummary]);
	
			let strSummary = mapToString(finalSummary);
	
			let strTraitSummary = mapToString(traitSummary);
	
			let updateFields = {
				"max_skill_nine": max9,
				"visibility_modifier": visibilityMod,
				"roll_modifier": rollModifier + visibilityMod,
				"roll_modifier_summary": strSummary,
				"roll_trait_summary": strTraitSummary,
				"roll_hit_location": hitLocationDescription,
				"roll_maneuver": maneuver,
				"roll_allout_attack": allOutAttack,
			};
	
			setAttrs(updateFields, { silent: true }, callback);
	
		});
	
	}
	
	/**
	 * Convert Javascript Map to a string value
	 * see: https://www.cloudhadoop.com/2018/09/typescript-how-to-convert-map-tofrom.html
	 * 
	 * @param {Map} map Map to convert to a string
	 * 
	 * @returns {string}
	 */
	function mapToString(map) {
	
		let jsonObject = {};
	
		let mapString = "";
	
		map.forEach((value, key) => {
			mapString += `${value}\n`;
		});
	
		return mapString;
	
	}
	
	/**
	 * Determine visibility modifiers, if max skill 9 should apply
	 * and generate summary.
	 * 
	 * @param {object} values An array of field values
	 *
	 * @returns {[number, boolean, Map]} An array of [visibilityMod: number, max9: boolean, summary: Map]
	 */
	function getVisibilityModifiers(values) {
	
		let visibilityMod = 0;
	
		// prevent NaN error: https://stackoverflow.com/questions/37998501/return-zero-if-input-value-is-nan
		let usedToBlind = parseInt(values.is_used_to_blindness) || 0;
	
		let visibilityCondition = parseInt(values.visiblity_condition) || 0;
	
		let darknessPenalty = parseInt(values.darkness_penalty) || 0;
	
		let nightVision = parseInt(values.night_vision) || 0;
	
		let tempNightVision = parseInt(values.temporary_night_vision) || 0;
		
		let adjustedDarknessPenalty = 0;
	
		let hasDarkVision = parseInt(values.has_dark_vision) || 0;
	
		let smokePenalty = parseInt(values.smoke_penalty) || 0;
	
		let fogPenalty = parseInt(values.fog_penalty) || 0;
	
		let blurPenalty = parseInt(values.blur_penalty) || 0;
	
		let otherPenalty = parseInt(values.other_vision_penalty) || 0;
	
		let max9 = false;
	
		let summary = new Map();
	
		let summaryValue = "";
	
		switch (visibilityCondition) {
			case 1:
				// can't see anything
				visibilityMod = -10;
				max9 = true;
				summaryValue = " (Can't see anything)";
				break;
	
			case 2:
				// can't see target
				visibilityMod = -6;
				max9 = true;
				summaryValue = " (Can't see target)";
				break;
	
			case 3:
				// can't see target, but know location
				visibilityMod = -4;
				max9 = true;
				summaryValue = " (Can't see anything, but now know location)";
				break;
	
			default:
				visibilityMod = 0;
				break;
		}
	
		// add darkness penalty, offset by nightvision and tempNightVision
		if (!hasDarkVision && darknessPenalty) {
	
			adjustedDarknessPenalty = darknessPenalty + nightVision + tempNightVision;
	
			if (adjustedDarknessPenalty > 0) {
				adjustedDarknessPenalty = 0;
			}
	
			visibilityMod = visibilityMod + adjustedDarknessPenalty;
	
		}
	
		visibilityMod = visibilityMod + smokePenalty;
	
		visibilityMod = visibilityMod + fogPenalty;
	
		visibilityMod = visibilityMod + blurPenalty;
	
		visibilityMod = visibilityMod + otherPenalty;
	
		// check for max modifiers
		if (usedToBlind && visibilityMod < -6) {
			visibilityMod = -6;
		} else if (visibilityMod < -10) {
			visibilityMod = -10;
		}
	
		if (visibilityMod !== 0) {
	
			summaryValue = `${visibilityMod} Due to visibility${summaryValue}`;
	
			summary.set("Visibility", summaryValue);
	
		}
	
		return [visibilityMod, max9, summary];
	
	}
	
	/**
	 * Determine the roll modifiers by the selected fields 
	 * and by getting information from the rollModifiers constant variable. 
	 * 
	 * @param {object} values An object of input fields
	 * 
	 * @returns {[number, boolean, Map, Map, string, string, string]} An array of [totalMod: number, max9: boolean, summary: Map, traitSummary: Map, hitLocationDescription: string, maneuverDescription: string, allOutDescription: string]
	 */
	function getRollModifiers(values) {
	
		let summary = new Map();
	
		let traitSummary = new Map();
	
		let totalMod = 0;
	
		let hasHighPainThreshold = +values.has_high_pain_threshold;
	
		let hasLowPainThreshold = +values.has_low_pain_threshold;
	
		// get the current checkbox state of "max_skill_nine",
		let max9 = values.max_skill_nine === "1";
	
		let hitLocationDescription = "";
	
		let maneuverDescription = "";
	
		let allOutDescription = "";
	
		// loop through each input values
		for (let key in values) {
	
			// get the value of the input field
			let value = +values[key];
	
			let modifier = 0;
	
			let description = "";
	
			let meleeMax9 = false;
	
			let defenderMod = 0;
	
			// get the field information by key
			// field = key (field_name): value = { int modifier, string description, bool affectsVisibility, bool isDropDown, bool isMax9, bool isTrait, bool checkPain}
			let field = rollModifiers.get(key);
	
			// ignore traits and affectsVisibility
			if (field && field.isTrait === false && field.affectsVisibility === false) {
	
				// check how to get modifier value
				if (key == "melee_maneuver") {
	
					[modifier, description, meleeMax9] = getModifierForMeleeManeuver(String(values.melee_maneuver));
	
					maneuverDescription = description;
	
				} else if (key == "ranged_maneuver") {
	
					[modifier, description] = getModifierForRangedManeuver(String(values.ranged_maneuver), Number(values.ranged_move_default_or_bulk));
	
					maneuverDescription = description;
	
				} else if (key == "defense_maneuver") {
	
					[modifier, description] = getModifierForDefenseManeuver(String(values.defense_maneuver));
	
					maneuverDescription = description;
	
				} else if (key == "melee_all_out_attack") {
	
					[modifier, description] = getModifierForAllOutAttack(String(values.melee_all_out_attack));
	
					allOutDescription = description;
	
				} else if (key == "posture") {
	
					[modifier, description] = getModifierForPosture(String(values.posture));
	
				} else if (key == "melee_height_difference") {
	
					[modifier, description] = getModifierForHeightDifference(String(values.melee_height_difference));
	
				} else if (key == "defense_height_difference") {
	
					[modifier, description] = getModifierForDefenseHeightDifference(String(values.defense_height_difference));
	
				} else if (key == "weapon_hand") {
	
					[modifier, description] = getModifierHandedness(String(values.weapon_hand), Number(values.off_hand_training), Number(values.dual_weapon_training));
	
				} else if (key == "ranged_weapon_hand") {
	
					[modifier, description] = getModifierHandedness(String(values.ranged_weapon_hand), Number(values.ranged_off_hand_training), Number(values.ranged_dual_weapon_training));
	
				} else if (key == "ranged_vehicle_conditions") {
	
					[modifier, description] = getModifierForVehicleConditions(String(values.ranged_vehicle_conditions));
	
				} else if (key == "spell_natures_strength") {
	
					[modifier, description] = getModifierForNaturesStrength(values.spell_natures_strength);
	
				} else if (field.isDropDown) {
	
					modifier = value;
	
				} else if (value) {
	
					// if checked, otherwise use the value in the field information object
					modifier = field.modifier;
	
				}
	
				// check for special modifiers
				if (key === "shock_penalty") {
					modifier = getShockPenalty(modifier, hasHighPainThreshold, hasLowPainThreshold);
				} else if (key === "pain_level") {
					modifier = getPainLevelPenalty(modifier, hasHighPainThreshold, hasLowPainThreshold);
				}
	
				totalMod += modifier;
	
				// check for special description
				if (key === "dialog_custom_roll_modifier") {
	
					// split the reason modifiers into seperate lines
					let modReasons = null;

					if (values.dialog_custom_roll_modifier_reason) {
						modReasons = values.dialog_custom_roll_modifier_reason.split(/\r?\n/);
					}

					let displayReasons = "";
					
					if (modReasons && modReasons.length > 0) {

						// add two spaces before each reason and combine into single string list
						const updateModReasons = modReasons.map(reason => {
							return `  • ${reason}`;
						});

						displayReasons = updateModReasons.join("\n"); 

					}
					
					description = `Custom Modifier\n${displayReasons}`;

				} else if (key === "hit_location_modifier" && values.hit_location) {
	
					// hit location row
					hitLocationDescription = values.hit_location;
	
					// summary 
					description = values.hit_location;
	
				} else if (key == "deceptive_strike" && modifier < 0) {
	
					defenderMod = modifier / 2;
	
					description = `Deceptive Strike. Defender at ${defenderMod}.`;
	
				} else if (key == "melee_maneuver" ||
					key == "melee_all_out_attack" ||
					key == "posture" ||
					key == "melee_height_difference" ||
					key == "defense_height_difference" ||
					key == "weapon_hand" ||
					key == "ranged_weapon_hand" ||
					key == "ranged_vehicle_conditions" ||
					key == "ranged_maneuver" ||
					key == "defense_maneuver" ||
					key == "spell_natures_strength") {
	
					// we already have the description
	
				} else {
	
					description = field.description;
	
				}
	
				// only add a description if there's a modifier value
				if (modifier > 0) {
					summary.set(key, `+${modifier} ${description}`);
				} else if (modifier < 0) {
	
					summary.set(key, `${modifier} ${description}`);
	
					// apply max skill of 9 if field has it
					if (field.isMax9) {
						max9 = true;
					}
				} else if (key == "mighty_blow" && values.mighty_blow > 0) {
	
					summary.set(key, description);
	
				}
	
				// set max skill of 9 if the melee max 9 was set to true
				if (meleeMax9) {
					max9 = true;
				}
	
			} else if (field && field.isTrait) {
	
				// if there's a trait with a selected modifier, display the modifier and the description
				if (field.isDropDown && value !== 0) {
					traitSummary.set(key, `+${value} ${field.description}`);
				} else if (value) {
					// if the trait is a checkbox, just show the description
					traitSummary.set(key, `${field.description}`);
				}
	
			}
	
		}
	
		return [totalMod, max9, summary, traitSummary, hitLocationDescription, maneuverDescription, allOutDescription];
	
	}
	
	/**
	 * Get modifier, description, and max skill of 9 
	 * for a melee maneuver
	 *
	 * @param {string} maneuver User's selected maneuver
	 *
	 * @returns {[number, string, boolean]}  An Array of [modifier: number, description: string, max9: number]
	 */
	function getModifierForMeleeManeuver(maneuver) {
	
		let modifier = 0;
	
		let description = "";
	
		let max9 = false;
	
		switch (maneuver) {
			case "step-attack":
				modifier = 0;
				description = "Step and Attack";
				break;
	
			case "step-feint":
				modifier = 0;
				description = "Step and Feing";
				break;
	
			case "move-attack":
				modifier = -4;
				description = "Move and Attack";
				max9 = true;
				break;
	
			case "move-wild-swing":
				modifier = -5;
				description = "Move and Wild Swing. Random hit location!";
				max9 = true;
				break;
	
			case "move-slam":
				modifier = 0;
				description = "Move and Slam.";
				break;
	
			case "flying-tackle":
				modifier = 4;
				description = "Flying Tackle. Fall prone.";
				break;
	
			case "pounce":
				modifier = 4;
				description = "Pounce. Roll DX, Jump, or Acrobatics to avoid prone.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description, max9];
	
	}
	
	/**
	 * Get modifier, description for a defense maneuver
	 *
	 * @param {string} maneuver User's selected maneuver
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForDefenseManeuver(maneuver) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (maneuver) {
			case "step-attack":
				modifier = 0;
				description = "Normal Defense";
				break;
	
			case "all-out-defense-increased":
				modifier = 2;
				description = "All-Out Defense: Increased";
				break;
	
			case "all-out-defense-double":
				modifier = 0;
				description = "All-out Defense: Double";
				break;
	
			case "moved-attack":
				modifier = 0;
				description = "Moved and Attacked, only dodge/block no retreat.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get modifier, description for a ranged maneuver
	 *
	 * @param {string} maneuver             User's selected maneuver
	 * @param {number}    defaultOrBulkPenalty The penalty to apply for move/attack. 
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForRangedManeuver(maneuver, defaultOrBulkPenalty) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (maneuver) {
			case "step-attack":
				modifier = 0;
				description = "Step and Attack";
				break;
	
			case "move-attack-ranged":
				modifier = defaultOrBulkPenalty;
				description = "Move and Attack";
				break;
	
			case "all-out-determined":
				modifier = 1;
				description = "All-Out Attack, Determined";
				break;
	
			case "all-out-suppression":
				modifier = 0;
				description = "All-Out Attack, Suppression Fire";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get modifier, description, and max skill of 9 
	 * for an all-out attack
	 *
	 * @param {string} type Type of all-out attack
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForAllOutAttack(type) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (type) {
			case "0":
				modifier = 0;
				description = "";
				break;
	
			case "determined":
				modifier = 4;
				description = "All-Out Attack Determined.";
				break;
	
			case "double":
				modifier = 0;
				description = "All-Out Attack Double.";
				break;
	
			case "feint":
				modifier = 0;
				description = "All-Out Feint and Attack.";
				break;
	
			case "strong":
				modifier = 0;
				description = "All-out Attack Strong. +2 or +1 per die damage.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get modifier, description, and max skill of 9 
	 * for attacker's posture
	 *
	 * @param {string} posture Attacker's posture
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForPosture(posture) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (posture) {
			case "0":
				modifier = 0;
				description = "";
				break;
	
			case "crawling":
				modifier = -4;
				description = "Crawling";
				break;
	
			case "prone":
				modifier = -4;
				description = "Prone";
				break;
	
			case "crouching":
				modifier = -2;
				description = "Crouching";
				break;
	
			case "kneeling":
				modifier = -2;
				description = "Kneeling";
				break;
	
			case "sitting":
				modifier = -2;
				description = "Sitting";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get modifier, description for difference in height
	 *
	 * @param {string} height Difference in height
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForHeightDifference(height) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (height) {
			case "2-higher-legs-feet":
				modifier = -2;
				description = "Leg/feet, if up to two feet higher.";
				break;
	
			case "2-higher-head-neck":
				modifier = 2;
				description = "Head/Neck, if up to two feet higher.";
				break;
	
			case "2-lower-legs-feet":
				modifier = 2;
				description = "Leg/feet, if up to two feet lower.";
				break;
	
			case "2-lower-head-neck":
				modifier = -2;
				description = "Head/Neck, if up to two feet lower.";
				break;
	
			case "3-higher-legs-feet":
				modifier = -2;
				description = "Legs/feet, if up to three feet higher.";
				break;
	
			case "3-higher-head-neck":
				modifier = 2;
				description = "Head/Neck, if up to three feet higher.";
				break;
	
			case "3-lower-legs-feet":
				modifier = 2;
				description = "Legs/feet, if up to three feet lower.";
				break;
	
			case "3-lower-head-neck":
				modifier = -2;
				description = "Head/Neck, if up to three feet lower.";
				break;
	
			case "4-higher-legs-feet":
				modifier = -20;
				description = "Can't hit feet, if up to four feet higher.";
				break;
	
			case "4-higher-head-neck":
				modifier = 2;
				description = "Head/Neck, if up to 4 feet higher.";
				break;
	
			case "4-lower-head-neck":
				modifier = -2;
				description = "Head/Neck, if up to 4 feet lower.";
				break;
	
			case "5-higher-legs-feet":
				modifier = -20;
				description = "Can't hit Left/feet, if up to 5 feet higher.";
				break;
	
			case "5-higher-head-neck":
				modifier = 2;
				description = "Head/Neck, if up to 5 feet higher.";
				break;
	
			case "5-lower-legs-feet":
				modifier = 2;
				description = "Legs/feet, if up to 5 feet lower.";
				break;
	
			case "5-lower-head-neck":
				modifier = -20;
				description = "Can't hit Head/Neck, if up to 5 feet lower.";
				break;
	
			case "6-higher-legs-feet":
				modifier = -20;
				description = "Can't hit Legs/feet, if up to 6 feet higher.";
				break;
	
			case "6-higher-head-neck":
				modifier = 2;
				description = "Head/Neck, if up to 6 feet higher.";
				break;
	
			case "6-lower-legs-feet":
				modifier = 2;
				description = "Legs/feet, if up to 6 feet lower.";
				break;
	
			case "6-lower-head-neck":
				modifier = -20;
				description = "Can't hit Head/Neck, if up to 6 feet lower.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get defense modifier, description for difference in height
	 *
	 * @param {string} height Difference in height
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForDefenseHeightDifference(height) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (height) {
			case "2-3-higher":
				modifier = 1;
				description = "2-3 feet above attacker.";
				break;
	
			case "3-4-higher":
				modifier = 2;
				description = "3-4 feet above attacker.";
				break;
	
			case "4-6-higher":
				modifier = 3;
				description = "4-6 feet above attacker.";
				break;
	
			case "2-3-below":
				modifier = -1;
				description = "2-3 feet below attacker.";
				break;
	
			case "3-4-below":
				modifier = -2;
				description = "3-4 feet below attacker.";
				break;
	
			case "4-6-below":
				modifier = -3;
				description = "4-6 feet below attacker.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get modifier, description for vehicle conditions
	 *
	 * @param {string} condition What condition is vehicle experiencing
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForVehicleConditions(condition) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (condition) {
			case "air-handheld":
				modifier = -1;
				description = "Air vehicle. Using handheld weapon.";
				break;
	
			case "ground-good-road-handheld":
				modifier = -1;
				description = " Ground vehicle, good road. Using handheld weapon.";
				break;
	
			case "ground-bad-road-fixed":
				modifier = -1;
				description = "Ground vehicle, bad road. Weapon in fixed mount/hardpoint/carriage.";
				break;
	
			case "ground-bad-road-external":
				modifier = -2;
				description = "Ground vehicle, bad road. Weapon in external open mount.";
				break;
	
			case "ground-bad-road-handheld":
				modifier = -3;
				description = "Ground vehicle, bad road. Using handheld weapon.";
				break;
	
			case "ground-off-road-stabilized-turret":
				modifier = -1;
				description = "Ground vehicle, off-road. Weapon in stabalized turret/open mount.";
				break;
	
			case "ground-off-road-fixed":
				modifier = -2;
				description = "Ground vehicle, off-road. Weapon in fixed mount/hardpoint/carriage.";
				break;
	
			case "ground-off-road-external":
				modifier = -3;
				description = "Ground vehicle, off-road. Weapon in external open mount.";
				break;
	
			case "ground-off-road-handheld":
				modifier = -4;
				description = "Ground vehicle, off-road. Using handheld weapon.";
				break;
	
			case "water-calm-fixed":
				modifier = 2;
				description = "-1 : Water vehicle, calm. Weapon in fixed mount/hardpoint/carriage.";
				break;
	
			case "water-calm-external":
				modifier = -2;
				description = "Water vehicle, calm. Weapon in external mount.";
				break;
	
			case "water-calm-handheld":
				modifier = -3;
				description = "Water vehicle, calm. Using handheld weapon.";
				break;
	
			case "water-rough-stabilized-turret":
				modifier = -1;
				description = "Water vehicle, rough. Weapon in stabilized turret/open mount.";
				break;
	
			case "water-rough-fixed":
				modifier = -2;
				description = "Water vehicle, rough. Weapon in fixed mount/hardpoint/carriage.";
				break;
	
			case "water-rough-external":
				modifier = -3;
				description = "Water vehicle, rough. Weapon in external mount.";
				break;
	
			case "water-rough-handheld":
				modifier = -4;
				description = "Water vehicle, rough. Using handheld weapon.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	}
	
	/**
	 * Get modifier, description for nature's strength
	 *
	 * @param {string} strength The strength of nature
	 *
	 * @returns {[number, string]} An array of [modifier: number, description: string]
	 */
	function getModifierForNaturesStrength(strength) {
	
		let modifier = 0;
	
		let description = "";
	
		switch (strength) {
			case "wilderness-1":
				modifier = 1;
				description = "Primeval Wilderness.";
				break;
	
			case "wilderness-2":
				modifier = 2;
				description = "Primeval Wilderness.";
				break;
	
			case "wilderness-3":
				modifier = 3;
				description = "Primeval Wilderness.";
				break;
	
			case "wilderness-4":
				modifier = 1;
				description = "Primeval Wilderness.";
				break;
	
			case "wilderness-5":
				modifier = 1;
				description = "Primeval Wilderness.";
				break;
	
			case "not-pristine-wilderness-1":
				modifier = -1;
				description = "Not Pristine Wilderness";
				break;
	
			case "structures-2":
				modifier = -2;
				description = "Artificial Structures";
				break;
	
			case "structures-3":
				modifier = -3;
				description = "Artificial Structures";
				break;
	
			case "structures-4":
				modifier = -4;
				description = "Artificial Structures";
				break;
	
			case "defiled-5":
				modifier = -5;
				description = "Nature Defiled";
				break;
	
			case "defiled-6":
				modifier = -6;
				description = "Nature Defiled";
				break;
	
			case "defiled-7":
				modifier = -7;
				description = "Nature Defiled";
				break;
	
			case "defiled-8":
				modifier = -8;
				description = "Nature Defiled";
				break;
	
			case "defiled-9":
				modifier = -9;
				description = "Nature Defiled";
				break;
	
			case "supernatural-defiled-10":
				modifier = -10;
				description = "Nature Supernaturally Defiled";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	}
	
	/**
	 * Gets modifier and description for 
	 * handedness.
	 * 
	 * @param {string} hand                 Single/Dual weapon attack
	 * @param {number} off_hand_training    Off-Hand Weapon training
	 * @param {number} dual_weapon_training Dual-Weapon training 
	 * 
	 * @returns {[number, string]} An array of [modifier: number, string: description]
	 */
	function getModifierHandedness(hand, off_hand_training, dual_weapon_training) {
	
		let offHandTraining = Number(off_hand_training);
	
		let dualWeaponTraining = Number(dual_weapon_training);
	
		let modifier = 0;
	
		let description = "";
	
		switch (hand) {
			case "off-hand":
				modifier = -4 + offHandTraining;
				description = "Off-hand";
				break;
	
			case "dual-weapon-primary-hand":
				modifier = -4 + dualWeaponTraining;
				if (modifier > 0) {
					modifier = 0;
				}
				description = "Dual-Weapon Attack.";
				break;
	
			case "dual-weapon-off-hand":
				modifier = -4 + dualWeaponTraining + offHandTraining;
				if (modifier > 0) {
					modifier = 0;
				}
				description = "Off-Hand Dual-Weapon Attack.";
				break;
	
			default:
				break;
		}
	
		return [modifier, description];
	
	}
	
	/**
	 * Get shock penalty, factor in high and low pain threshold
	 *
	 * @param {number} shockPenalty         Original shock penalty
	 * @param {number} hasHighPainThreshold Has trait
	 * @param {number} hasLowPainThreshold  Has trait
	 *
	 * @returns {number} New shock Penalty
	 */
	function getShockPenalty(shockPenalty, hasHighPainThreshold, hasLowPainThreshold) {
	
		let newPenalty = Number(shockPenalty);
	
		if (newPenalty && hasHighPainThreshold) {
	
			newPenalty = 0;
	
		} else if (newPenalty && hasLowPainThreshold) {
			newPenalty = newPenalty * 2;
		}
	
		return newPenalty;
	}
	
	/**
	 * Get pain level penalty, factor in high and low pain threshold
	 *
	 * @param {number} painLevel            Original pain level
	 * @param {number} hasHighPainThreshold Has trait
	 * @param {number} hasLowPainThreshold  Has trait
	 *
	 * @returns {number} Penalty
	 */
	function getPainLevelPenalty(painLevel, hasHighPainThreshold, hasLowPainThreshold) {
	
		let penalty = Number(painLevel);
	
		// if high pain threshold, halve the pain penalty
		if (penalty && hasHighPainThreshold) {
	
			penalty = penalty / 2;
	
		} else if (penalty && hasLowPainThreshold) {
	
			penalty = penalty * 2;
	
		}
	
		return penalty;
	
	}
	
	// define each skill type section that can use
	// the tool modifier dialog box
	const toolSections = [
		"skill",
		"technique",
		"defense",
		"melee",
		"ranged",
		"spell",
	];
	
	// defines which section of the roll dialog to display
	// for skills.
	const displaySectionsForSkills = {
		"display_visibility_section": 1,
		"display_afflictions_section": 1,
		"display_tasks_section": 1,
		"display_equipment_section": 1,
		"display_attack_section": 0,
		"display_melee_maneuvers_section": 0,
		"display_ranged_maneuvers_section": 0,
		"display_defense_maneuvers_section": 0,
		"display_spell_modifiers_section": 0,
	};
	
	const displaySectionsForTechniques = {
		"display_visibility_section": 1,
		"display_afflictions_section": 1,
		"display_tasks_section": 1,
		"display_equipment_section": 1,
		"display_attack_section": 0,
		"display_melee_maneuvers_section": 0,
		"display_ranged_maneuvers_section": 0,
		"display_defense_maneuvers_section": 0,
		"display_spell_modifiers_section": 0,
	};
	
	const displaySectionsForDefense = {
		"display_visibility_section": 0,
		"display_afflictions_section": 0,
		"display_tasks_section": 0,
		"display_equipment_section": 0,
		"display_attack_section": 0,
		"display_melee_maneuvers_section": 0,
		"display_ranged_maneuvers_section": 0,
		"display_defense_maneuvers_section": 1,
		"display_spell_modifiers_section": 0,
	};
	
	const displaySectionsForMelee = {
		"display_visibility_section": 1,
		"display_afflictions_section": 1,
		"display_tasks_section": 0,
		"display_equipment_section": 0,
		"display_attack_section": 1,
		"display_melee_maneuvers_section": 1,
		"display_ranged_maneuvers_section": 0,
		"display_defense_maneuvers_section": 0,
		"display_spell_modifiers_section": 0,
	};
	
	const displaySectionsForRanged = {
		"display_visibility_section": 1,
		"display_afflictions_section": 1,
		"display_tasks_section": 0,
		"display_equipment_section": 0,
		"display_attack_section": 1,
		"display_melee_maneuvers_section": 0,
		"display_ranged_maneuvers_section": 1,
		"display_defense_maneuvers_section": 0,
		"display_spell_modifiers_section": 0,
	};
	
	const displaySectionsForSpell = {
		"display_visibility_section": 0,
		"display_afflictions_section": 1,
		"display_tasks_section": 0,
		"display_equipment_section": 0,
		"display_attack_section": 0,
		"display_melee_maneuvers_section": 0,
		"display_ranged_maneuvers_section": 0,
		"display_defense_maneuvers_section": 0,
		"display_spell_modifiers_section": 1,
	};
	
	// loop through each section and create event handlers
	// this reduces the amount of code that needs to be written
	toolSections.forEach(section => {
	
		// show modal box for skill modifiers for section
		on(`clicked:show_roll_modifiers_for_${section}`, (event) => {
	
			let basefields = {
				"show_roll_modifiers": 1,
				"roll_modifier_types": section
			};
	
			let fields;
	
			// determine which display sections to display on dialog box
			switch (section) {
				case "technique":
					fields = {
						...basefields,
						...displaySectionsForTechniques,
					};
					break;
	
				case "defense":
					fields = {
						...basefields,
						...displaySectionsForDefense,
					};
					break;
	
				case "melee":
					fields = {
						...basefields,
						...displaySectionsForMelee,
					};
					break;
	
				case "ranged":
					fields = {
						...basefields,
						...displaySectionsForRanged,
					};
					break;
	
				case "spell":
					fields = {
						...basefields,
						...displaySectionsForSpell,
					};
					break;
	
				case "skill":
				default:
					fields = {
						...basefields,
						...displaySectionsForSkills,
					};
					break;
	
			}
	
			setAttrs(fields, { silent: true });
	
		});
		
		const CUSTOM_MOD_DESC = "custom modifier";
	
		/* check for manual changes to modifier tool just above the repeating tables section. */
		on(`change:${section}_custom_roll_modifier change:${section}_custom_roll_modifier_reason change:${section}_roll_max_nine change:${section}_roll_apply_encumbrance change:${section}_apply_shield_db change:${section}_apply_magic_db`, event => {
	
			if (!event.sourceAttribute) {
				return;
			}

			// get the section name
			// example: sourceAttribute: "skill_roll_apply_encumbrance"
			// we want the first part, `skill`
			let arrSourceName = event.sourceAttribute.split("_");

			if (event.sourceType === "player" && !isEmpty(arrSourceName) && arrSourceName.length > 0) {

				const section = arrSourceName[0];

				syncRollModToolbarToDialogueBox(section);

			}
			
		});
	
	});

	on(`change:encumbrance_level`, event => {

		// loop through each section and sync each roll modifier toolbar
		toolSections.forEach(section => {

			// resync the roll modifiers for that section
			syncRollModToolbarToDialogueBox(section);

		});

	});

	function syncRollModToolbarToDialogueBox(section) {

		// get the current values
		const fields = [
			`${section}_custom_roll_modifier`,
			`${section}_custom_roll_modifier_reason`,
			`${section}_roll_max_nine`,
			`${section}_roll_apply_encumbrance`,
			`${section}_apply_shield_db`,
			`${section}_apply_magic_db`,
			"encumbrance_level"
		];

		getAttrs(fields, values => {

			// update the corresponding fields on the dialog box
			let customMod = Number(values[`${section}_custom_roll_modifier`]);

			if (isNaN(customMod)) {
				customMod = 0;
			}
			
			let customModReason = values[`${section}_custom_roll_modifier_reason`];

			let applyEncumbrance = Number(values[`${section}_roll_apply_encumbrance`]);

			let encumbranceLevel = values.encumbrance_level;

			let encumbranceLevelMod = 0;

			let maxNine = values[`${section}_roll_max_nine`];

			if (!isNaN(applyEncumbrance) && applyEncumbrance > 0) {
				encumbranceLevelMod = encumbranceLevel;
			}

			let updateFields = {
				dialog_custom_roll_modifier: customMod,
				dialog_custom_roll_modifier_reason: customModReason,
				max_skill_nine: maxNine,
				skill_encumbered: encumbranceLevelMod,
				roll_modifier_types: section
			};

			// check for defense
			if (section === "defense") {
				updateFields["shield_db"] = values[`${section}_apply_shield_db`];
				updateFields["magic_db"] = values[`${section}_apply_magic_db`];
			}

			// update the dialog and then trigger the apply button
			setAttrs(updateFields, {silent: false}, function (section) {
				
				getAttrs(["roll_modifier_types"], values => {

					const section = values.roll_modifier_types;

					totalRollModifiersDialogBox(section, applyRollModifiers);

				});
				
			});

		});

	}
	
	// check for change to hit location fields
	// easier to read and change list of fields using this method
	const arrChangeHitLocationFields = [
		"change:hit_location_type",
		"change:humanoid_location",
		"change:humanoid_low_tech_location",
		"change:humanoid_martial_arts_location",
		"change:arachnoid_location",
		"change:avian_location",
		"change:cancroid_location",
		"change:centaur_location",
		"change:hexapod_location",
		"change:ichthyoid_location",
		"change:octopod_location",
		"change:quadruped_location",
		"change:vehicle_location",
		"change:vermiform_location",
		"change:weapon_location",
		"change:grapple_modifier",
		"change:has_shield",
		"change:target_chink_in_armor",
		"change:target_size_modifier",
		"change:target_light_cover",
		"change:target_down",
		"change:target_partly_exposed",
		"change:target_intervening_figures",
	];
	
	const changeHitLocationFields = arrChangeHitLocationFields.join(" ");
	
	on(changeHitLocationFields, event => {
	
		updateHitLocationModifiers();
	
	});
	
	/**
	 * update the default drop-down based on selected type
	 *
	 * @param {() => void} callback function to run after update is completed
	 **/
	function updateHitLocationDropDownsByType(callback) {
	
		callback = callback || noop;
	
		getAttrs(["hit_location_type"], values => {
	
			let type = values.hit_location_type;
	
			let updateFields;
	
			switch (type) {
				case "humanoid":
				case "arachnoid":
				case "avian":
				case "cancroid":
				case "centaur":
				case "hexapod":
				case "octopod":
				case "quadruped":
				case "vermiform":
					updateFields = {
						[`${type}_location`]: "torso-0"
					};
					break;
	
				case "humanoid_martial_arts":
				case "humanoid_low_tech":
					updateFields = {
						[`${type}_location`]: "chest-0"
					};
					break;
	
				case "vehicle":
					updateFields = {
						[`${type}_location`]: "body-0"
					};
					break;
	
				case "weapon":
					updateFields = {
						[`${type}_location`]: "damage-reach-c-5"
					};
					break;
	
				default:
					break;
			}
	
			setAttrs(updateFields, { silent: true }, callback);
	
		});
	
	}
	
	function updateHitLocationModifiers() {
	
		const fields = [
			"target_size_modifier",
			"hit_location_type",
			"humanoid_location",
			"humanoid_low_tech_location",
			"humanoid_martial_arts_location",
			"arachnoid_location",
			"avian_location",
			"cancroid_location",
			"centaur_location",
			"hexapod_location",
			"ichthyoid_location",
			"octopod_location",
			"quadruped_location",
			"vehicle_location",
			"vermiform_location",
			"weapon_location",
			"grapple_modifier",
			"has_shield",
			"target_chink_in_armor",
			"target_light_cover",
			"target_down",
			"target_partly_exposed",
			"target_intervening_figures",
			"size",
			"display_melee_maneuvers_section"
		];
	
		getAttrs(fields, values => {
	
			let type = values.hit_location_type || "";
	
			let location = values[`${type}_location`] || "";
	
			let grapple = Number(values.grapple_modifier);
	
			let sizeModifier = Number(values.target_size_modifier) || 0;
	
			let characterSize = Number(values.size) || 0;
	
			let isMelee = values.display_melee_maneuvers_section == "1";
	
			let sizeModifierLabel = "SM";
	
			// if melee, use relative size modifier. See FAQ. http://www.sjgames.com/gurps/faq/FAQ4-3.html#SS3.4.2.23
			if (isMelee) {
	
				sizeModifier = sizeModifier - characterSize;
	
				sizeModifierLabel = "Relative SM";
			}
	
			let hasShield = Number(values.has_shield) === 1 ? true : false;
	
			let chinkInArmor = Number(values.target_chink_in_armor) === 1 ? true : false;
	
			let partlyExposed = Number(values.target_partly_exposed) === 1 ? true : false;
	
			let targetDown = Number(values.target_down) === 1 ? true : false;
	
			let lightCover = Number(values.target_light_cover) === 1 ? true : false;
	
			let interveningFigures = Number(values.target_intervening_figures);
	
			// make sure it's an integer
			interveningFigures = Math.floor(interveningFigures);
	
			// damage-reach-c-5
			// split into an array
			// [damage, reach, c, 5]
			// last element is the penalty
			let arrLocation = location.split("-");
	
			// remove the last element fromt they array
			// [damage, reach, c, 5]
			// locationMod = 5
			// arrLocation = [damage, reach, c, 5]
			let locationMod = arrLocation.splice(arrLocation.length - 1, 1);
	
			// convert to negative number
			locationMod = Number(locationMod) * -1;
	
			// now join the remaining pieces to get a description
			// [damage, reach, c, 5]
			// locationNote = "humanoid (SM 0)" + "damage reach c"
	
			// NOTE: some types of underscores, like humanoid_nartial_arts.
			let typeDescription = type.replace(/_/g, " ");
	
			let locationNote = `${typeDescription} (${sizeModifierLabel} ${sizeModifier}) ` + arrLocation.join(" ");
	
			// check for shield modifier
			if (hasShield && isHitLocationAffectedByShield(locationNote)) {
	
				locationMod = locationMod * 2;
	
				locationNote += " with a shield.";
	
			}
	
			// check if target or hit location is partly exposed
			if (partlyExposed) {
	
				locationMod = locationMod - 2;
	
				locationNote += " Partly exposed.";
			}
	
			// check for proned target
			if (targetDown && isHitLocationAffectedByProne(locationNote)) {
	
				locationMod = locationMod - 2;
	
				locationNote += " Target Prone.";
	
			}
	
			// check for grappling
			if (grapple >= 0) {
	
				// divid the modifier by half and update the note
				locationMod = Math.floor(locationMod / 2) + grapple;
	
				locationNote = "Grappling " + locationNote;
	
			}
	
			// check for chink in armor
			if (chinkInArmor && (arrLocation.includes("torso") || arrLocation.includes("chest") || arrLocation.includes("body"))) {
	
				locationMod = -8;
	
				locationNote += " chinks in armor. DR/2.";
	
			} else if (chinkInArmor) {
	
				locationMod = -10;
	
				locationNote += " chinks in armor. DR/2.";
	
			}
	
			// check for light cover
			if (lightCover) {
	
				locationMod += -2;
	
				locationNote += " Light cover.";
	
			}
	
			// check for intervening figures
			if (interveningFigures) {
	
				locationMod += interveningFigures * -4;
	
				locationNote += ` ${interveningFigures} intervening figures.`;
	
			}
	
			let finalMod = sizeModifier + locationMod;
	
			setAttrs({
				hit_location_modifier: finalMod,
				hit_location: locationNote,
			});
	
		});
	
	}
	
	/**
	 * Determine if hit location can be affected by a shield
	 * valid locations: arm, hand, leg, foot, pincer, wing, tail
	 * 
	 * @param {string} location Hit location being targeted
	 *
	 * @returns {boolean}
	 */
	function isHitLocationAffectedByShield(location) {
	
		if (!location) {
			return false;
		}

		let arrLocation = location.split(" ");
	
		const limbs = [
			"arm",
			"hand",
			"leg",
			"foot",
			"pincer",
			"wing",
			"tail"
		];
	
		let applyShield = false;
	
		limbs.forEach(limb => {
	
			if (arrLocation.includes(limb)) {
				applyShield = true;
			}
	
		});
	
		return applyShield;
	
	}
	
	/**
	 * Determine if hit location can be affected when a target is
	 * kneeling, sitting, crouching, or lying down
	 * valid locations: torso, chest, groin, leg
	 * 
	 * @param {string} location Hit location being targeted
	 * 
	 * @returns {boolean}
	 */
	function isHitLocationAffectedByProne(location) {
	
		if (!location) {
			return false;
		}

		let arrLocation = location.split(" ");
	
		const locations = [
			"leg",
			"chest",
			"groin",
			"torso",
		];
	
		let applyProne = false;
	
		locations.forEach(location => {
	
			if (arrLocation.includes(location)) {
				applyProne = true;
			}
	
		});
	
		return applyProne;
	
	}
	
	// if range/speed change, update the modifier
	on("change:ranged_range_speed change:ranged_elevation", event => {
	
		updateRangeSpeedModifier();
	
	});
	
	/**
	 * Update the speed/range modifier based on number of hexes
	 * in attr_ranged_range_speed
	 */
	function updateRangeSpeedModifier() {
	
		getAttrs(["ranged_range_speed", "ranged_elevation"], values => {
	
			let hexes = Number(values.ranged_range_speed);
	
			let elevation = Number(values.ranged_elevation);
	
			hexes = addElevationModifier(hexes, elevation);
	
			let modifier = getModBySpeedRange(hexes);
	
			setAttrs({ ranged_range_speed_modifier: modifier });
	
		});
	}
	
	/**
	 * Add in the elevation modifier to the ground ranged
	 *
	 * @param {number} range     Distance between two targets at the same elevation
	 * @param {number} elevation If positive, the shooter is above the target, negative shooter is below the target
	 *
	 * @returns {number}
	 */
	function addElevationModifier(range, elevation) {
	
		let rangeMod = 0;
	
		if (elevation > 0) {
	
			// firing downward
			rangeMod = Math.floor(elevation / 2);
	
			// max elevation is half of ground distance
			if (rangeMod > Math.floor(range / 2)) {
	
				rangeMod = Math.floor(range / 2);
	
			}
	
			// firing downward reduces the range
			rangeMod = rangeMod * -1;
	
		} else if (elevation < 0) {
	
			// firing upward adds range, make the number positive
			rangeMod = elevation * -1;
	
		}
	
		// calculate the final range
		range += rangeMod;
	
		return range;
	
	}
	
	// if ranged rate of fire changed, update the modifier
	on("change:ranged_rof", event => {
	
		getAttrs(["ranged_rof"], values => {
	
			let modifier = getRateOfFireModifier(Number(values.ranged_rof));
	
			setAttrs({ ranged_rof_modifier: modifier });
	
		});
	
	});
	
	// see: https://app.roll20.net/forum/post/7251390/slug%7D
	const modByRateOfFire = [
		{ r: 4, m: 0 },
		{ r: 8, m: 1 },
		{ r: 12, m: 2 },
		{ r: 16, m: 3 },
		{ r: 24, m: 4 },
		{ r: 49, m: 5 },
		{ r: 99, m: 6 },
		{ r: 199, m: 7 },
	];
	
	function getRateOfFireModifier(rof) {
	
		const entry = modByRateOfFire.find((o) => o.r >= rof);
	
		// TODO: use formula. each x2 RoF add +1 to hit
	
		// if no matches, return 8.
		return (entry != undefined ? entry.m : 8);
	
	}
	
	// check for change to hit location fields
	// easier to read and change list of fields using this method
	const arrChangeTargetingSystems = [
		"change:ranged_scope_bonus",
		"change:ranged_vehicle_targeting_bonus",
		"change:ranged_laser_sight",
		"change:ranged_accuracy_bonus",
		"change:vehicle_stability_rating",
		"change:vehicle_weapon_unstabilized",
	];
	
	const changeTargetingSystems = arrChangeTargetingSystems.join(" ");
	
	on(changeTargetingSystems, event => {
	
		updateTargetingSystems();
	
	});
	
	function updateTargetingSystems() {
	
		const fields = [
			"ranged_scope_bonus",
			"ranged_vehicle_targeting_bonus",
			"ranged_laser_sight",
			"ranged_accuracy_bonus",
			"vehicle_stability_rating",
			"vehicle_weapon_unstabilized",
		];
	
		getAttrs(fields, values => {
	
			let modifier = 0;
	
			let scope = Number(values.ranged_scope_bonus);
	
			let targeting = Number(values.ranged_vehicle_targeting_bonus);
	
			let laser = Number(values.ranged_laser_sight);
	
			let stability = Number(values.vehicle_stability_rating);
	
			let unstabilized = Number(values.vehicle_weapon_unstabilized);
	
			let accuracy = Number(values.ranged_accuracy_bonus);
	
			modifier = scope + targeting + laser;
	
			// check for unstabilized vehicle weapon
			if (unstabilized && modifier > stability) {
	
				// targeting can't exceed the stability rating
				modifier = stability;
	
			} else if (modifier > accuracy) {
	
				// targeting can't exceed accuracy bonus
				modifier = accuracy;
	
			}
	
			setAttrs({ ranged_targeting_system_modifier: modifier });
	
		});
	
	}
	
	// check for changes to move/attack and bulk
	on("change:ranged_maneuver change:ranged_bulk change:ranged_move_default_or_bulk", event => {
	
		updateRangedMoveAttackBulk();
	
	});
	
	function updateRangedMoveAttackBulk() {
	
		let fields = [
			"ranged_maneuver",
			"ranged_bulk",
		];
	
		getAttrs(fields, values => {
	
			let modifier = 0;
	
			let bulk = Number(values.ranged_bulk);
	
			if (values.ranged_maneuver == "move-attack-ranged") {
	
				modifier = -2;
	
				// check for bulky item
				if (bulk < modifier) {
					modifier = bulk;
				}
	
			}
	
			setAttrs({ ranged_move_default_or_bulk: modifier });
	
		});
	
	}
	
	// handle armor hit location call to action
	on("clicked:armor_apply", (event) => {
	
		clearArmorHitLocations();
	
		addArmorHitLocations();
	
	});
	
	/**
	 * delete all the hit locations from the locations table
	 *
	 */
	function clearArmorHitLocations() {
	
		getSectionIDs("repeating_hitlocation", (ids) => {
	
			// loop through the rows
			for (let i = 0; i < ids.length; i++) {
	
				removeRepeatingRow("repeating_hitlocation_" + ids[i]);
	
			}
	
		});
	
	}
	
	/**
	 * Add the hit locations based on the selected hit location type
	 */
	function addArmorHitLocations() {
	
		let fields = [
			"armor_hit_location_type",
			"hit_points_max",
		];
	
		getAttrs(fields, values => {
	
			let type = values.armor_hit_location_type;
	
			let hitPoints = Number(values.hit_points_max);
	
			let locations = HIT_LOCATIONS_JSON.get(type);
	
			let rows = {};
	
			// loop through each location object in the array
			// location = {key: "torso", display: "Torso", penalty: 0, DR: 0, hp_divisor: 1, notes:""},
			locations.forEach(location => {
	
				let id = generateRowID();
	
				let penalty = Number(location.penalty);
	
				let divisor = Number(location.hp_divisor);
	
				let crippled = 0;
	
				if (divisor > 1) {
					crippled = Math.floor(hitPoints / divisor) + 1;
				}
	
				rows[`repeating_hitlocation_${id}_key`] = location.key;
	
				rows[`repeating_hitlocation_${id}_where`] = location.display;
	
				rows[`repeating_hitlocation_${id}_layer_1_front`] = location.DR;
	
				rows[`repeating_hitlocation_${id}_layer_1_back`] = location.DR;
	
				rows[`repeating_hitlocation_${id}_layer_summary_front`] = location.DR;
	
				rows[`repeating_hitlocation_${id}_layer_summary_back`] = location.DR;
	
				rows[`repeating_hitlocation_${id}_penalty`] = penalty;
	
				rows[`repeating_hitlocation_${id}_divisor`] = location.hp_divisor;
	
				rows[`repeating_hitlocation_${id}_crippled`] = crippled;
	
				rows[`repeating_hitlocation_${id}_notes`] = location.notes;
	
			});
	
			setAttrs(rows);
	
		});
	
	
	}

	function upgradeHitLocationPenaltiesToNewVersion() {

		getAttrs(["hit_location_modifiers_upgraded", "size"], values => {

			const upgraded = values.hit_location_modifiers_upgraded === "true";

			const sizeModifier = Number(values.size) ?? 0;

			let updates = {
				hit_location_modifiers_upgraded: "true"
			};

			if (upgraded) {
				// only upgraded, Leave
				return;
			} else if (sizeModifier == 0) {
				// don't do anything if there's no size modifier
				setAttrs(updates, { silent: true });
				return;
			}

			// get all the section id numbers
			getSectionIDs("repeating_hitlocation", (ids) => {
		
				let repeatingFields = [];

				// get a list of values we need from the table rows
				for (let i = 0; i < ids.length; i++) {

					let penaltyProp = `repeating_hitlocation_${ids[i]}_penalty`;

					repeatingFields.push(penaltyProp);

				}

				// get the values
				getAttrs(repeatingFields, function (repeatingValues) {

					// loop through ids and create a list value to update
					for (let i = 0; i < ids.length; i++) {

						let penaltyProp = `repeating_hitlocation_${ids[i]}_penalty`;

						let penalty = Number(repeatingValues[penaltyProp]);

						// remove the size modifier
						penalty = penalty - sizeModifier;

						updates[penaltyProp] = penalty;

					}

					setAttrs(updates, { silent: true });

				});

			});
			
		});

	}
	
	/**
	 * Updates hit location table's penalty and crippled values
	 * we have to get all the IDs for each row. 
	 * Get original penalty value
	 * then update the final penalty, divisor, and disabled hit points
	 *
	 */
	function updateRepeatingHitLocationCrippledValues() {
	
		let fields = [
			"hit_points_max",
		];
	
		getAttrs(fields, values => {
	
			let hitPoints = Number(values.hit_points_max);
	
			let updates = {};
	
			// get all the section id numbers
			getSectionIDs("repeating_hitlocation", (ids) => {
	
				let repeatingFields = [];
	
				// get a list of values we need from the table rows
				for (let i = 0; i < ids.length; i++) {
	
					let divisorProp = `repeating_hitlocation_${ids[i]}_divisor`;

					repeatingFields.push(divisorProp);
	
				}
	
				// get the values
				getAttrs(repeatingFields, function (repeatingValues) {
	
					// loop through ids and create a list value to update
					for (let i = 0; i < ids.length; i++) {
	
						let divisorProp = `repeating_hitlocation_${ids[i]}_divisor`;
	
						let divisor = Number(repeatingValues[divisorProp]);
	
						if (divisor < 0) {
							divisor = 1;
						}
	
						let crippled = 0;
	
						// only apply cripple valor if divisor is over 1.
						if (divisor > 1) {
							crippled = Math.floor(hitPoints / divisor) + 1;
						}
	
						let crippledProp = `repeating_hitlocation_${ids[i]}_crippled`;
	
						updates[crippledProp] = crippled;
	
					}
	
					setAttrs(updates, { silent: true });
	
				});
	
			});

		});
	
	}
	
	// check if a hit location layor value changes. If so, update the armor summary
	[1, 2, 3, 4].forEach(layerId => {
	
		on(`change:repeating_hitlocation:layer_${layerId}_front change:repeating_hitlocation:layer_${layerId}_back`, event => {
	
			updateArmorSummary();
	
		});
	
	});
	
	/**
	 * Update the armor summary for a row when an armor layer is changed
	 */
	function updateArmorSummary() {
	
		// get all the values for each layer in this row
		let fields = [
			"repeating_hitlocation_layer_1_front",
			"repeating_hitlocation_layer_1_back",
			"repeating_hitlocation_layer_2_front",
			"repeating_hitlocation_layer_2_back",
			"repeating_hitlocation_layer_3_front",
			"repeating_hitlocation_layer_3_back",
			"repeating_hitlocation_layer_4_front",
			"repeating_hitlocation_layer_4_back",
			"hit_location_layer_1_on",
			"hit_location_layer_2_on",
			"hit_location_layer_3_on",
			"hit_location_layer_4_on",
		];
	
		getAttrs(fields, values => {
	
			let updates = {};

			const layerOneOn = values.hit_location_layer_1_on == "1";

			const layerTwoOn = values.hit_location_layer_2_on == "1";

			const layerThreeOn = values.hit_location_layer_3_on == "1";
	
			const layerFourOn = values.hit_location_layer_4_on == "1";
	
			// process the front then back locations
			["front", "back"].forEach(direction => {
	
				let isFlexible = false;
	
				let arrPrimaryArmor = [];
	
				let arrSplitArmor = [];
	
				let splitTypes = "";
	
				// sum up the total DR values. Can only do one split DR at this time
				[1, 2, 3, 4].forEach(layerNo => {

					// check if the layer is on
					if (layerNo === 1 && !layerOneOn) {
						return;
					}

					if (layerNo === 2 && !layerTwoOn) {
						return;
					}

					if (layerNo === 3 && !layerThreeOn) {
						return;
					}

					if (layerNo === 4 && !layerFourOn) {
						return;
					}
	
					let propName = `repeating_hitlocation_layer_${layerNo}_${direction}`;
	
					let armor = String(values[propName]) || "";

					[isFlexible, splitTypes] = processLayerLocationArmor(armor, arrPrimaryArmor, arrSplitArmor, splitTypes);
	
				});

				let layerSummary = getLayerSummary(arrPrimaryArmor, arrSplitArmor, isFlexible, splitTypes);
	
				updates[`repeating_hitlocation_layer_summary_${direction}`] = layerSummary;
	
			});
	
			setAttrs(updates, { silent: true });
	
		});
	
	}

	// check if an armor layer was turned on/off
	on("change:hit_location_layer_1_on change:hit_location_layer_2_on change:hit_location_layer_3_on change:hit_location_layer_4_on", async event => {

		await updateHitLocationArmorSummary();

	});

	const updateHitLocationArmorSummary = async () => {

		let layerFields = [
			"hit_location_layer_1_on",
			"hit_location_layer_2_on",
			"hit_location_layer_3_on",
			"hit_location_layer_4_on",
		];

		const layerOnOffValues = await getAttrsAsync(layerFields);

		getSectionIDs("repeating_hitlocation", ids => {

			ids.forEach(rowId => {

				let fields = [];

				[1,2,3,4].forEach(layerNo => {

					let layerOn = layerOnOffValues[`hit_location_layer_${layerNo}_on`] === "1";

					if (layerOn) {

						fields.push(`repeating_hitlocation_${rowId}_layer_${layerNo}_front`);

						fields.push(`repeating_hitlocation_${rowId}_layer_${layerNo}_back`);

					}

				});

				getAttrs(fields, values => {

					let updates = {};

					// process the front then back locations
					["front", "back"].forEach(direction => {

						let isFlexible = false;

						let arrPrimaryArmor = [];

						let arrSplitArmor = [];

						let splitTypes = "";

						// sum up the total DR values. Can only do one split DR at this time
						[1, 2, 3, 4].forEach(layerNo => {

							let propName = `repeating_hitlocation_${rowId}_layer_${layerNo}_${direction}`;

							// check if values[propName]. 
							// if it's not there, then it's not on
							if (!values[propName]) {
								return;
							}

							let armor = String(values[propName]) || "";

							[isFlexible, splitTypes] = processLayerLocationArmor(armor, arrPrimaryArmor, arrSplitArmor, splitTypes);

						});

						let layerSummary = getLayerSummary(arrPrimaryArmor, arrSplitArmor, isFlexible, splitTypes);

						updates[`repeating_hitlocation_${rowId}_layer_summary_${direction}`] = layerSummary;

					});

					setAttrs(updates, { silent: true });

				});

			});

		});

	}

	const processLayerLocationArmor = (armorValue, arrPrimaryArmor, arrSplitArmor, splitTypes) => {

		let isFlexible = false;

		let firstDR = 0;

		let secondDR = 0;

		// remove any hardened notes
		const hardenedPattern = /\[.*\]/g;

		armorValue = armorValue.replace(hardenedPattern, "");

		if (armorValue && armorValue.indexOf("*") != -1) {

			isFlexible = true;

			// be sure to remove *
			armorValue = armorValue.replace("*", "");
		}

		// check for split DR
		if (armorValue && armorValue.indexOf("/") != -1) {

			let arrArmor = armorValue.split("/");

			firstDR = Number(arrArmor[0]);

			if (isNaN(firstDR)) {
				firstDR = 0;
			}

			arrPrimaryArmor.push(firstDR);

			let arrSecondDR = arrArmor[1].split(" ");

			// pull out the first array, which should be DR
			secondDR = Number(arrSecondDR.splice(0, 1));

			if (isNaN(secondDR)) {
				secondDR = 0;
			}

			arrSplitArmor.push(secondDR);

			splitTypes = arrSecondDR.join(" ");

		} else {

			firstDR = Number(armorValue);

			if (isNaN(firstDR)) {
				firstDR = 0;
			}

			arrPrimaryArmor.push(firstDR);

			arrSplitArmor.push(firstDR);

		}

		return [isFlexible, splitTypes];

	}

	const getLayerSummary = (arrPrimaryArmor, arrSplitArmor, isFlexible, splitTypes) => {

		// see: https://stackoverflow.com/questions/1230233/how-to-find-the-sum-of-an-array-of-numbers
		let baseDR = arrPrimaryArmor.reduce((a, b) => a + b, 0);

		let splitDR = arrSplitArmor.reduce((a, b) => a + b, 0);

		let layerSummary = baseDR;

		if (splitDR !== baseDR && isFlexible) {

			layerSummary += `/${splitDR}* ${splitTypes}`;

		} else if (splitDR !== baseDR) {

			layerSummary += `/${splitDR} ${splitTypes}`;

		} else if (isFlexible) {

			layerSummary += `*`;

		}

		return layerSummary;

	}
	
	// check if a hit locations damage divisor changed
	on(`change:repeating_hitlocation:divisor`, event => {
	
		updateHitLocationDisabledColumn();
	
	});
	
	/**
	 * Update the hit location disabled column for row that changed
	 * based on divisor and max hit points
	 */
	function updateHitLocationDisabledColumn() {
	
		let fields = [
			"hit_points_max",
			"repeating_hitlocation_divisor"
		];
	
		getAttrs(fields, values => {
	
			let hitPoints = Number(values.hit_points_max);
	
			let divisor = Number(values.repeating_hitlocation_divisor);
	
			let crippled = 0;
	
			if (divisor > 1) {
	
				crippled = Math.floor(hitPoints / divisor) + 1;
	
				let updates = {
					repeating_hitlocation_crippled: crippled
				};
	
				setAttrs(updates, { silent: true });
	
			}
	
		});
	}
	
	// check if damage table hit points were modified
	on(`change:repeating_hitlocation:damage`, event => {
	
		let previousValue = Number.isNaN(event.previousValue) ? 0 : Number(event.previousValue);
	
		let newValue = Number.isNaN(event.newValue) ? 0 : Number(event.newValue);
	
		updateCurrentHitPointsByDamageTable(previousValue, newValue);
	
	});
	
	/**
	 * If option to update Hit Points when changing damage table location damage
	 * is on, then update the current Hit Points.
	 * 
	 * @param {number} previousValue Value before damage was applied
	 * @param {number} newValue      Value after damage was applied
	 */
	function updateCurrentHitPointsByDamageTable(previousValue, newValue) {
	
		let arrValues = [
			"damage_update_hit_points",
			"hit_points"
		];
	
		getAttrs(arrValues, values => {
	
			let diff = 0;
	
			let updateHitPoints = values.damage_update_hit_points === "1";
	
			// if previous and newvalue are the same, use 0 for previous value
			if (previousValue === newValue) {
	
				// special case, use previous = 0 and just use the newValue
				diff = 0 - newValue;
	
			} else {
	
				// normal process
				diff = previousValue - newValue;
	
			}
	
			if (updateHitPoints) {
	
				let hitPoints = Number(values.hit_points);
	
				let newHitPoints = hitPoints - diff;
	
				setAttrs({ hit_points: newHitPoints });
	
			}
	
		});
	
	}
	
	on("change:selected_token", event => {
	
		setSelectedMacro();
	
	});
	
	/**
	 * If checked, add selected macro to die roll
	 */
	function setSelectedMacro() {
	
		getAttrs(["selected_token"], values => {
	
			let macro = "";
	
			if (values.selected_token === "on") {
	
				macro = "@{selected|token_name}";
	
			}
	
			setAttrs({ selected_token_macro: macro });
	
		});
	
	}
	
	on("change:target_token", event => {
	
		setTargetMacro();
	
	});
	
	/**
	 * If checked, add target macro to die roll
	 */
	function setTargetMacro() {
	
		getAttrs(["target_token"], values => {
	
			let targetMacro = "";
	
			if (values.target_token === "on") {
	
				targetMacro = "@{target|token_name}";
	
			}
	
			setAttrs({ target_token_macro: targetMacro });
	
		});
	
	}
	
	["melee", "ranged", "spell", "skill", "technique", "defense"].forEach(section => {
	
		on(`clicked:${section}_roll_reset`, async (event) => {

			// check that event.htmlAttributes.name is a valid object
			if (!event.htmlAttributes || !event.htmlAttributes.name) {
				return;
			}

			// get the section name
			// example: htmlAttributes.name: "act_defense_roll_reset"
			// we want the 2nd part, `defense`
			let arrEventName = event.htmlAttributes.name.split("_");

			if (!isEmpty(arrEventName) && arrEventName.length > 0) {

				const section = arrEventName[1];

				// set the section type and then simply reset the Roll Modifiers Toolbox, then reapply the values using a callback
				await setAttrsAsync({roll_modifier_types: section});

				resetRollModifiersToolBox(applyRollModifiers);
		
			}
			
		});
	
	});
	
	/**
	 * Reset the roll modifiers for the current section: skill | technique | melee | range | spell 
	 */
	function resetRollModifiers(section) {
	
		let updates = {};
	
		updates[`${section}_custom_roll_modifier`] = 0;
		updates[`${section}_custom_roll_modifier_reason`] = "";
		updates[`${section}_roll_modifier_status`] = "neutral";
		updates[`${section}_roll_modifier`] = 0;
		updates[`${section}_roll_modifier_summary`] = "";
		updates[`${section}_roll_trait_summary`] = "";
		updates[`${section}_roll_hit_location`] = "";
		updates[`${section}_roll_allout_attack`] = "";
		updates[`${section}_roll_max_nine`] = 0;
	
		// if defense, also reset Defense Bonuses
		if (section == "defense") {
			updates[`${section}_apply_shield_db`] = 0;
			updates[`${section}_apply_magic_db`] = 0;
		}
	
		// check for resetting encumbrance
		if (section == "defense" || section == "skill") {
			updates[`${section}_roll_apply_encumbrance`] = 0;
		}
	
		setAttrs(updates, { silent: true }, () => {
			
			resetRollModifiersToolBox();

		});
	
	}
	
	["skill", "technique", "defense"].forEach(section => {
	
		on(`change:${section}_roll_apply_encumbrance change:encumbrance_level`, (event) => {
	
			applyEncumbrancePenalty(section);
	
		});
	
	});
	
	/**
	 * Apply encumbrance penalty to section and roll modifier tool
	 */
	function applyEncumbrancePenalty(section) {
	
		const fields = [
			"encumbrance_level",
			`${section}_roll_apply_encumbrance`,
			`${section}_roll_modifier_summary`,
			`${section}_roll_modifier`,
		];
	
		getAttrs(fields, values => {
	
			let currentEncumbrance = Number(values.encumbrance_level);
	
			let applyEncumbrance = Number(values[`${section}_roll_apply_encumbrance`]);
	
			let summary = values[`${section}_roll_modifier_summary`];
	
			let currentModifier = Number(values[`${section}_roll_modifier`]);
	
			let encumbranceLevel = 0;
	
			// clear out any encumbrance modifiers
			let [newSummary, encumbranceModifier] = getSummaryModifierForEncumbrance(summary);
	
			// if value for encumbranceModifier, update currentModifier
			if (encumbranceModifier < 0) {
	
				currentModifier += (-1 * encumbranceModifier);
	
			}
	
			if (applyEncumbrance === 1) {
	
				encumbranceLevel = -1 * currentEncumbrance;
	
				let encumbranceDesc = `${encumbranceLevel} Encumbered`;
	
				newSummary += encumbranceDesc + '\n';
	
				currentModifier += encumbranceLevel;
	
			}
	
			let rollModifierStatus = "neutral";

			if (currentModifier > 0) {
				rollModifierStatus = "positive";
			} else if (currentModifier < 0) {
				rollModifierStatus = "negative";
			}
				
			const updates = {};
	
			switch (section) {
	
				case "defense":
					updates[`defense_encumbered`] = encumbranceLevel;
					break;
	
				case "skill":
				case "technique":
				default:
					updates[`skill_encumbered`] = encumbranceLevel;
					break;
	
			}
	
			updates[`${section}_roll_modifier_summary`] = newSummary;
	
			updates[`${section}_roll_modifier_status`] = rollModifierStatus;
	
			updates[`${section}_roll_modifier`] = currentModifier;
	
			setAttrs(updates, { silent: true }, () => {
	
				totalRollModifiersDialogBox(section);
	
			});
	
		});
	
	}
	
	/**
	 * Parses the summary text to remove Encumbered and return
	 * the encumbered value
	 * @param {string} summary Summary of skill roll mods
	 *
	 * @returns {[string, number]} An array of [newSummary: string, encumbranceMod: number]
	 */
	function getSummaryModifierForEncumbrance(summary) {
	
		let encumbranceMod = 0;
	
		let newSummary = summary;
	
		[-1, -2, -3, -4].forEach(mod => {
	
			let enumbranceDesc = `${mod} Encumbered`;
	
			if (summary.includes(enumbranceDesc)) {
	
				encumbranceMod = mod;
	
				// remove the string from the summary
				newSummary = summary.replace(enumbranceDesc + '\n', "");
	
			}
	
		});
	
		return [newSummary, encumbranceMod];
	}
	
	
	["shield", "magic"].forEach(type => {
	
		on(`change:defense_apply_${type}_db`, (event) => {
	
			applyDefenseBonus(type);
	
		});
	
	});
	
	/**
	* Apply defense bonus to section and roll modifier tool
	*/
	function applyDefenseBonus(type) {
	
		const fields = [
			`defense_apply_${type}_db`,
			`defense_roll_modifier_summary`,
			`defense_roll_modifier`,
		];
	
		getAttrs(fields, values => {
	
			let applyDB = Number(values[`defense_apply_${type}_db`]);
	
			let summary = values.defense_roll_modifier_summary;
	
			let currentModifier = Number(values.defense_roll_modifier);
	
			let newSummary = "";
	
			let originalDB = 0;
	
			// clear out any encumbrance modifiers
			[newSummary, originalDB] = getSummaryModifierForDefenseBonus(summary, type);
	
			// if value for originalDB, update currentModifier
			if (originalDB > 0) {
	
				// remove DB modifier
				currentModifier -= originalDB;
	
			}
	
			if (applyDB > 0) {
	
				// captilize 
				let dbType = type.charAt(0).toUpperCase() + type.slice(1);
	
				let defenseBonusDesc = `+${applyDB} ${dbType} DB`;
	
				newSummary += defenseBonusDesc + '\n';
	
				currentModifier += applyDB;
	
			}
	
			let rollModifierStatus = "neutral";

			if (currentModifier > 0) {
				rollModifierStatus = "positive";
			} else if (currentModifier < 0) {
				rollModifierStatus = "negative";
			}
				
			const updates = {};
	
			updates[`${type}_db`] = applyDB;
	
			updates[`defense_roll_modifier_summary`] = newSummary;

			updates[`defense_roll_modifier_status`] = rollModifierStatus;
	
			updates[`defense_roll_modifier`] = currentModifier;
	
			setAttrs(updates, { silent: true }, () => {
	
				totalRollModifiersDialogBox("defense");
	
			});
	
		});
	
	}
	
	/**
	* Parses the summary text to remove defense bonus text and return
	* the db value
	*
	* @param {string} summary Summary of skill roll mods
	* @param {string} type    Type of defense bonus: shield | magic
	*
	* @returns {[string, number]} An array of [newSummary: string, originalDB: number]
	*/
	function getSummaryModifierForDefenseBonus(summary, type) {
	
		let originalDB = 0;
	
		let newSummary = summary;
	
		// captilize 
		type = type.charAt(0).toUpperCase() + type.slice(1);
	
		["+1", "+2", "+3", "+4", "+5"].forEach(mod => {
	
			let dbDesc = `${mod} ${type} DB`;
	
			if (summary.includes(dbDesc)) {
	
				originalDB = Number(mod);
	
				// remove the string from the summary
				newSummary = summary.replace(dbDesc + '\n', "");
	
			}
	
		});
	
		return [newSummary, originalDB];
	}
	
	// close roll modifiers, no updates
	on("clicked:import_gca", (event) => {
	
		setAttrs({ "import_message": "Processing... If message doesn't clear, an error occurred." });
	
		importGCA();
	
	});
	
	on("clicked:import_reset", (event) => {
	
		setAttrs({
			"import_message": "Start Import",
			"json_data": ""
		});
	
	});
	
	/**
	 * Import GCA JSON into character sheet
	 */
	function importGCA() {
	
		getAttrs(["json_data", "import_notes"], values => {
	
			let data = String(values.json_data).trim();
	
			let importNotes = Boolean(values.import_notes);
	
			let success = true;
	
			let message = "";
	
			let jsonData;
	
			if (data) {
	
				try {
	
					jsonData = JSON.parse(data);
	
					// check for GCA signature
					let programName = String(jsonData.Character.Author.Program);
	
					if (programName.toLowerCase() != "gurps character assistant") {
	
						success = false;
	
						message = "Invalid GCA4 Data. Program name was not set to GURPS Character Assistant."
	
					}
	
				} catch (ex) {
	
					success = false;
	
					message = "Invalid JSON Data. " + ex.message;
	
				}
	
	
			} else {
	
				success = false;
	
				message = "Please copy/paste JSON Data into text area.";
	
			}
	
			if (success) {
	
				let importNotes = Boolean(values.import_notes);
	
				let uniqueKeys = {};
	
				importCharacterSheetWithGCA(uniqueKeys, jsonData, importNotes);

	
			} else {
	
				setAttrs({ "import_message": message });
	
			}
	
		});
	
	}
	
	/**
	 * Search for a matching idkey, if it exists return row ID
	 * Otherwise generate a new row id
	 * example:
	 * uniqueKeys = {
	 *    123: "-asdv35darev33",
	 *    456: "-kdidi786dev33",
	 * }
	 * 
	 * @param {object} uniqueKeys Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {string} idkey      Search uniqueKeys for idkey
	 * 
	 * @returns {string}
	 */
	function generateOrGetRowId(uniqueKeys, idkey) {
	
		let rowId;
	
		if (!isEmpty(uniqueKeys) && uniqueKeys.hasOwnProperty(idkey)) {
	
			rowId = uniqueKeys[idkey];
		} else {
	
			rowId = generateRowID();
	
		}
	
		return rowId;
	
	}
	
	/**
	 * Determines if an object is empty
	 * see: https://coderwall.com/p/_g3x9q/how-to-check-if-javascript-object-is-empty
	 * 
	 * @param {object} obj Object to check
	 * 
	 * @returns {boolean}
	 */
	function isEmpty(obj) {
	
		for (let key in obj) {
			if (obj.hasOwnProperty(key))
				return false;
		}
	
		return true;
	}
	
	/**
	 * Start processing GCA json data and update character sheet
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique key and associated row id. Passed by reference
	 * @param {JSON}    jsonData    GCA json data
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function importCharacterSheetWithGCA(uniqueKeys, jsonData, importNotes) {
	
		// keeps track of running totals
		let runningTotals = {
			"stun_check_mod": 0,
			"knockdown_check_mod": 0,
			"unconscious_check_mod": 0,
			"death_check_mod": 0,
			"apply_size_modifier": 0,
			"import_message": "Import has completed. Please wait a minute or two for Roll20 to finish processing the data.",
			"json_data": "",
			"templates": [],
			"templateNotes": "",
			"templateNames": "",
		};
	
		/*
		Example:
		templates: [{
						name: "Dwarf (Dungeon Fantasy)",
						notes: "Dwarves are essentially hardy-but-stumpy humans...",
						keys: [181, 182, 183, 184, 185, 187, 188, 189, 191, 192]
					}];
		keys are advantages/disadvantages for the template. 
		NOTE: Don't care about skills/spells/techniques. Just advantages/disadvantages need to be moved to racial traits table
		*/
	
		importGcaNonRepeatingFields(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
			importGcaAdvantages(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
				importGcaPerksQuirks(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
					importGcaDisadvantages(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
						importGcaSkills(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
							importGcaTechniques(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
								importGcaEquipment(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
									importGcaSpells(uniqueKeys, jsonData, runningTotals, importNotes, () => {
	
										// remove the unnecessary properties
										delete runningTotals.templates;
										delete runningTotals.templateNames;
										delete runningTotals.templateNotes;
	
										setAttrs(runningTotals, {silent: false}, totalAttributeCharacterPoints);
	
									});
	
								});
	
							});
	
						});
	
					});
	
				});
	
			});
	
		});
	
	}
	
	/**
	 * Update non-repeating fields, then process callback function
	 *
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      GCA4 json data
	 * @param {object}     runningTotals An object that keeps track of running totals
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      Function to run next
	 */
	function importGcaNonRepeatingFields(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let general = jsonData.Character.General;
	
		let attributes = jsonData.Character.Traits.Attribute;
	
		let advantages = getJsonArrayFromTrait(jsonData.Character.Traits.Advantage);
	
		let campaign = jsonData.Character.Campaign;
	
		let basePoints = Number(campaign.basepoints);
	
		const jsonTL = getTraitFromGcaAttributes(attributes, "Tech Level");
	
		let baseTL = Number(campaign.basetl);
	
		let characterTL = baseTL;
	
		let miscNotes = "";
	
		if (jsonData.Character.Notes) {
			miscNotes = jsonData.Character.Notes;
		}
	
		let jsonSM = getTraitFromGcaAttributes(attributes, "Size Modifier");
	
		let sizeModifier = 0;
	
		let jsonStatus = getTraitFromGcaAttributes(attributes, "Status");
	
		let status = 0;
	
		let jsonMonthlyPay = getTraitFromGcaAttributes(attributes, "Monthly Pay");
	
		let monthlyPay = "0";
	
		let jsonRemainingFunds = getTraitFromGcaAttributes(attributes, "Remaining Funds");
	
		let remainingFunds = "0";
	
		let jsonCostOfLiving = getTraitFromGcaAttributes(attributes, "Cost of Living");
	
		let costOfLiving = "0";
	
		if (jsonSM && jsonSM.score) {
			sizeModifier = jsonSM.score;
		}
	
		if (sizeModifier > 0) {
			runningTotals.apply_size_modifier = 1;
		}
	
		if (jsonStatus && jsonStatus.score) {
			status = jsonStatus.score;
		}
	
		if (jsonTL && jsonTL.score) {
			characterTL = Number(jsonTL.score);
		}
	
		if (jsonMonthlyPay && jsonMonthlyPay.score) {
	
			monthlyPay = formatNumber(jsonMonthlyPay.score);
	
		}
	
		if (jsonRemainingFunds && jsonRemainingFunds.score) {
	
			remainingFunds = formatNumber(jsonRemainingFunds.score);
	
		}
	
		if (jsonCostOfLiving && jsonCostOfLiving.score) {
	
			costOfLiving = formatNumber(jsonCostOfLiving.score);
	
		}
	
		let [strPts, strMod] = getCharacterPointsModFromGcaAttributes(attributes, "ST");
	
		let [dexPts, dexMod] = getCharacterPointsModFromGcaAttributes(attributes, "DX");
	
		let [intPts, intMod] = getCharacterPointsModFromGcaAttributes(attributes, "IQ");
	
		let [htPts, htMod] = getCharacterPointsModFromGcaAttributes(attributes, "HT");
	
		let [hpPts, hpMod] = getCharacterPointsModFromGcaAttributes(attributes, "Hit Points");
	
		let [fatPts, fatMod] = getCharacterPointsModFromGcaAttributes(attributes, "Fatigue Points");
	
		let [perPts, perMod] = getCharacterPointsModFromGcaAttributes(attributes, "Perception");
	
		let [visionPts, visionMod] = getCharacterPointsModFromGcaAttributes(attributes, "Acute Vision");
	
		let [hearPts, hearMod] = getCharacterPointsModFromGcaAttributes(attributes, "Acute Hearing");
	
		let [tastePts, tasteMod] = getCharacterPointsModFromGcaAttributes(attributes, "Acute Taste and Smell");
	
		let [touchPts, touchMod] = getCharacterPointsModFromGcaAttributes(attributes, "Acute Touch");
	
		let [willPts, willMod] = getCharacterPointsModFromGcaAttributes(attributes, "Will");
	
		let [fearPts, fearMod] = getCharacterPointsModFromGcaAttributes(attributes, "Fearlessness");
	
		// TODO: Howto update running total using fearMod
	
		let [speedPts, speedMod] = getCharacterPointsModFromGcaAttributes(attributes, "Basic Speed");
	
		// don't use moveMod for Basic Move, since that is derived from rounding down speed
		let [movePts, moveMod] = getCharacterPointsModFromGcaAttributes(attributes, "Basic Move");
	
		let racialUpdates = getTemplatesFromGca(uniqueKeys, jsonData, runningTotals);
	
		if (runningTotals.templateNotes) {
	
			miscNotes += "\n\nTemplate(s):\n\n" + runningTotals.templateNotes;
	
		}
	
		let notes = {
			general_appearance: general.appearance,
			income: monthlyPay,
			stash: remainingFunds,
			cost_of_living: costOfLiving,
			misc_notes: miscNotes,
		};
	
		let updates = {
			fullname: general.name,
			playername: general.playername,
			race: general.race,
			template_names: runningTotals.templateNames,
			height: general.height,
			weight: general.weight,
			size: sizeModifier,
			age: general.age,
			total_points: basePoints,
			campaign_tl: baseTL,
			tl: characterTL,
			status: status,
			wealth: "Average",
			strength_points: strPts,
			strength_mod: strMod,
			dexterity_points: dexPts,
			dexterity_mod: dexMod,
			intelligence_points: intPts,
			intelligence_mod: intMod,
			health_points: htPts,
			health_mod: htMod,
			hit_points_points: hpPts,
			hit_points_mod: hpMod,
			fatigue_points_points: fatPts,
			fatigue_points_mod: fatMod,
			perception_points: perPts,
			perception_mod: perMod,
			vision_points: visionPts,
			vision_mod: visionMod,
			hearing_points: hearPts,
			hearing_mod: hearMod,
			taste_smell_points: tastePts,
			taste_smell_mod: tasteMod,
			touch_points: touchPts,
			touch_mod: touchMod,
			willpower_points: willPts,
			willpower_mod: willMod,
			fear_check_points: fearPts,
			basic_speed_points: speedPts,
			basic_speed_mod: speedMod,
			basic_move_points: movePts
		};
	
		importNaturalAttacksFromGca(uniqueKeys, updates, attributes, importNotes);
	
		let updatesMerged;
	
		// check for merging in notes and racial traits
		if (importNotes && !isEmpty(racialUpdates)) {
			updatesMerged = { ...updates, ...notes, ...racialUpdates };
		} else if (importNotes) {
			updatesMerged = { ...updates, ...notes };
		} else if (racialUpdates) {
			updatesMerged = { ...updates, ...racialUpdates };
		} else {
			updatesMerged = { ...updates };
		}
	
		setAttrs(updatesMerged, null, callback);
	
	}
	
	/**
	 * Add commas to a number. 
	 * see: https://blog.abelotech.com/posts/number-currency-formatting-javascript/
	 * 
	 * @param {number} num Number to format
	 * 
	 * @returns {string}
	 */
	function formatNumber(num) {
		if (!num) {
			return "";
		}
		return num.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
	}
	
	/**
	 * Get the character points and modifier for an attribute
	 *
	 * @param {object} attributes JSON Attribute data. Array of elements
	 * @param {string} name       Name of the field to get CP for.
	 *
	 * @returns {[number, number]} An array of [points: number, modifier: number]
	 */
	function getCharacterPointsModFromGcaAttributes(attributes, name) {
	
		let points = 0;
	
		let modifier = 0;
	
		if (attributes) {
	
			// loop through the attributes
			attributes.forEach(attribute => {
	
				if (String(name).toLowerCase() === String(attribute.name).toLowerCase()) {
	
					points = Number(attribute.points);
	
					let baseScore = Number(attribute.basescore);
	
					let score = Number(attribute.score);
	
					modifier = score - baseScore;
	
				}
	
			});
	
		}
	
		if (isNaN(points)) {
			points = 0;
		}
	
		return [points, modifier];
	}
	
	/**
	 * Find a matching trait based name
	 * 
	 * @param {object} attributes A list of attributes
	 * @param {string} name       Name of attribute to find
	 * 
	 * @returns {object} Json element 
	 */
	function getTraitFromGcaAttributes(attributes, name) {
	
		let trait;
	
		attributes.forEach(attribute => {
	
			if (String(attribute.name).toLowerCase() === String(name).toLowerCase()) {
	
				trait = attribute;
	
			}
	
		});
	
		return trait;
	
	}
	
	/**
	 * Get the character points for an advantage
	 *
	 * @param {object} advantages JSON Advantages data. Array of elements
	 * @param {string} name       Name of the field to get CP for.
	 *
	 * @returns {number}
	 */
	function getCharacterPointsFromGcaAdvantages(advantages, name) {
	
		let points = 0;
	
		if (advantages) {
	
			// loop through the advantages
			advantages.forEach(advantage => {
	
				if (String(name).toLowerCase() === String(advantage.name).toLowerCase()) {
	
					points = Number(advantage.points);
	
				}
	
			});
	
		}
	
		if (isNaN(points)) {
			points = 0;
		}
	
		return points;
	}
	
	const GCA_NATURAL_MELEE_ATTACKS = [
		"Bite",
		"Punch",
		"Kick",
	];
	
	/**
	 * Import natural attacks like punch and bite to melee/range tables
	 * Based on standard attributes from GCA4
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  updates     Object of Roll20 fields to update. Passed by reference
	 * @param {object}    attributes  A list of CGA attributes
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function importNaturalAttacksFromGca(uniqueKeys, updates, attributes, importNotes) {
	
		GCA_NATURAL_MELEE_ATTACKS.forEach(name => {
	
			let trait = getTraitFromGcaAttributes(attributes, name);
	
			if (trait) {
	
				getMeleeAttackFromGcaTrait(uniqueKeys, updates, trait, importNotes, true);
	
				getRangedAttackFromGcaTrait(uniqueKeys, updates, trait, importNotes);
	
				getDefenseFromGcaTrait(uniqueKeys, updates, trait);
			}
	
		});
	
	}
	
	const GCA_IGNORED_ADVANTAGES = [
		"Acute Vision",
		"Acute Hearing",
		"Acute Taste and Smell",
		"Acute Touch",
		"Fearlessness",
	];
	
	/**
	 * If a trait, like Advantage only has one advantage, 
	 * then the JSON is NOT an array. We have to convert that 
	 * element to an array
	 * NOTE: Classic single or array issue with json
	 * 
	 * @param {object} trait A trait(s) like advantages, perks, etc.
	 * 
	 * @returns {object}
	 */
	function getJsonArrayFromTrait(trait) {
	
		let traits;
	
		if (Array.isArray(trait)) {
			traits = trait;
		} else if (trait) {
			// convert to an array
			traits = [trait];
		}
	
		return traits;
	
	}
	
	/**
	 * Gets templates from GCA. If found, runningTotals with template data
	 * Returns Repeating Racial Records to add, if template provides 
	 * additional attribute updates not covered by advantages/disadvantages
	 * 
	 * @param {object} uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} jsonData      GCA JSON data
	 * @param {object} runningTotals Object that tracks running totals and changes. Passed by reference
	 * 
	 * @returns {object} Repeating Racial Records
	 */
	function getTemplatesFromGca(uniqueKeys, jsonData, runningTotals) {
	
		let templates = getJsonArrayFromTrait(jsonData.Character.Traits.Template);
	
		let arrNames = [];
	
		let arrNotes = [];
	
		let templateToAdd;
	
		let racialUpdates = {};
	
		if (templates && templates.length) {
	
			templates.forEach(template => {
	
				let name = template.name;
	
				if (template.nameext) {
					name += ` (${template.nameext})`;
				}
	
				arrNames.push(name);
	
				let notes = getGcaNotesForTemplate(template);
	
				arrNotes.push(notes);
	
				let keys = [];
	
				if (template.pkids) {
					// get rid of spaces, just in case
					let ids = template.pkids.replaceAll(", ", ",");
	
					keys = ids.split(",");
				}
	
				templateToAdd = {
					name: name,
					notes: notes,
					keys: keys
				};
	
				runningTotals.templates.push(templateToAdd);
	
				// check for additional racial row to get added
				// this fixes offset issues with stat updates 
				if (template.premodspoints) {
	
					getGcaRacialUpdates(uniqueKeys, racialUpdates, template, name);
	
				}
	
			});
	
			let templateNames = arrNames.join("|");
	
			let templateNotes = arrNotes.join("\n\n");
	
			runningTotals.templateNames = templateNames;
	
			runningTotals.templateNotes = templateNotes;
	
		}
	
		return racialUpdates;
	
	}
	
	/**
	 * Gets repeating racial record that accounts for attribute updates 
	 * not covered advantage/disadvantages
	 * example: Dwarf Gives: +1 to ST:HT, +3 to ST:Fatigue Points, -1 to ST:Basic Move
	 * 
	 * @param {object} uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} racialUpdates Object for updating repeating_racial table. Passed by reference
	 * @param {object} template      GCA4 json object
	 * @param {string} templateName  Name of template that "gives" attributes
	 * 
	 * @returns {object}
	 */
	function getGcaRacialUpdates(uniqueKeys, racialUpdates, template, templateName) {
	
		let idkey = template.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_racial_${rowId}`;
	
		racialUpdates[`${baseFieldName}_idkey`] = idkey;
	
		let gives = template.gives;
	
		gives = gives.replaceAll("ST:", "");
	
		racialUpdates[`${baseFieldName}_name`] = templateName + " gives: " + template.gives;
	
		racialUpdates[`${baseFieldName}_points`] = template.premodspoints;
	
		racialUpdates[`${baseFieldName}_ref`] = template.page;
	
		return racialUpdates;
	}
	
	/**
	 * If trait has melee stats, create entry on melee table
	 *
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 * @param {boolean} force       Force function to process single melee attack
	 */
	function getMeleeAttackFromGcaTrait(uniqueKeys, rows, trait, importNotes, force = false) {
	
		if (trait.mode && trait.mode.includes("|") && trait.charreach && trait.charreach != "|") {
	
			getMultipleMeleeAttackModesFromGcaTrait(uniqueKeys, rows, trait, importNotes);
	
		} else if (force || (trait.charreach && trait.charreach !== "|")) {
	
			getSingleMeleeAttackModeFromGcaTrait(uniqueKeys, rows, trait, importNotes);
	
		}
	
	}
	
	
	/**
	 * If trait only has a single attack mode, use this function
	 *
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 * 
	 * @returns {object}
	 */
	function getSingleMeleeAttackModeFromGcaTrait(uniqueKeys, rows, trait, importNotes) {
	
		let idkey = trait.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_melee_${rowId}`;
	
		let fullName = trait.name;
	
		if (trait.nameext && trait.nameext != trait.name) {
	
			fullName += ` (${trait.nameext})`;
	
		}
	
		if (trait.levelnames) {
	
			let levelName = getGcaLevelName(trait);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		let reach = "c";
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		let damage = getDamageDieFromGca(trait.chardamage);
	
		rows[`${baseFieldName}_damage`] = damage;
	
		rows[`${baseFieldName}_type`] = getDamageTypeFromGca(trait.chardamtype);
	
		if (trait.charreach) {
	
			reach = trait.charreach;
	
		}
	
		rows[`${baseFieldName}_reach`] = reach;
	
		rows[`${baseFieldName}_skill`] = String(trait.charskillscore);
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getRangedMeleeNotesFromGca(trait);
		}
	
		if (trait.chararmordivisor) {
	
			rows[`${baseFieldName}_armor_divisor`] = trait.chararmordivisor;
	
		}
	
	}
	
	/**
	 * The melee attack has several modes
	 * Need a row for each attack mode
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getMultipleMeleeAttackModesFromGcaTrait(uniqueKeys, rows, trait, importNotes) {
	
		// example: "mode": "Staff swing|Staff thrust|Sword swing|Sword thrust"
		let arrModes = trait.mode.split("|");
	
		// example: "chardamage": "1d+1|1d|1d+1|1d-1",
		let arrDamage = trait.chardamage.split("|");
	
		// example: "chardamtype": "cr|cr|cr|cr",
		let arrDamType = trait.chardamtype.split("|");
	
		let damageNote = "";
	
		// example: "charreach": "1,2|1,2|1,2|2"
		let arrReach;
	
		if (trait.charreach) {
			arrReach = trait.charreach.split("|")
		}
	
		// example: "charskillscore": "11|11|5|5"
		let arrSkillLevel = [];
	
		if (trait.charskillscore) {
			arrSkillLevel = trait.charskillscore.split("|");
		}
	
		// example: "charskillused": "\"SK:Staff\"|\"SK:Staff\"|\"ST:DX\"-5|\"ST:DX\"-5"
		let arrSkillUsed = [];
	
		if (trait.charskillused) {
			arrSkillUsed = trait.charskillused.split("|");
		}
	
		// example: "chararmordivisor": "|3",
		let arrDivisor = [];
	
		if (trait.chararmordivisor) {
			arrDivisor = trait.chararmordivisor.split("|");
		}
	
		// tracks which mode to use
		let index = 0;
	
		arrModes.forEach(mode => {
	
			if (String(mode).toLowerCase() === "thrown") {
				return;
			}
	
			// add a mode id to uniquely identify each attach mode
			let idkey = trait.IDKey.trim() + `-mode-${index}`;
	
			let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
			let baseFieldName = `repeating_melee_${rowId}`;
	
			let fullName = trait.name;
	
			if (trait.nameext && trait.nameext != trait.name) {
	
				fullName += ` (${trait.nameext})`;
	
			}
	
			fullName += ` (${mode})`;
	
			rows[`${baseFieldName}_idkey`] = idkey;
	
			rows[`${baseFieldName}_name`] = fullName;
	
			let damage = "";
	
			let damageNote = "";
	
			if (arrDamage && arrDamage.length === 1) {
				damageNote = arrDamage[0];
				damage = arrDamage[0];
			} else if (arrDamage && arrDamage.length > 1) {
				damageNote = arrDamage[index];
				damage = arrDamage[index];
			}
	
			// replace "d" with "d6"
			damage = damage.replace("d", "d6");
	
			let damageType = "spec";
	
			if (arrDamType && arrDamType.length === 1) {
				damageType = arrDamType[0];
			} else if (arrDamType && arrDamType.length > 1) {
				damageType = arrDamType[index];
			}
	
			rows[`${baseFieldName}_damage`] = damage;
	
			rows[`${baseFieldName}_type`] = getDamageTypeFromGca(damageType);
	
			let reach = "c";
	
			if (arrReach && arrReach.length === 1) {
				reach = arrReach[0];
			} else if (arrReach && arrReach.length > 1) {
				reach = arrReach[index];
			}
	
			rows[`${baseFieldName}_reach`] = reach;
	
			let skillLevel = "10";
	
			if (arrSkillLevel && arrSkillLevel.length === 1) {
				skillLevel = arrSkillLevel[0];
			} else if (arrSkillLevel && arrSkillLevel.length > 1) {
				skillLevel = arrSkillLevel[index];
			}
	
			rows[`${baseFieldName}_skill`] = skillLevel;
	
			let damageNotes = `${damageNote} (${damageType})`;
	
			if (importNotes) {
				rows[`${baseFieldName}_notes`] = getRangedMeleeNotesFromGca(trait, arrSkillUsed[index], damageNotes);
			}
	
			let divisor = 1;
	
			if (arrDivisor && arrDivisor.length === 1) {
				divisor = Number(arrDivisor[0]);
			} else if (arrDivisor && arrDivisor.length > 1) {
				divisor = Number(arrDivisor[index]);
			}
	
			if (isNaN(divisor) || divisor < 1) {
				divisor = 1;
			}
	
			rows[`${baseFieldName}_armor_divisor`] = divisor;
	
			index++;
	
		});
	
	}
	
	/**
	 * If trait has ranged stats, create entry on ranged table
	 *
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. Passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getRangedAttackFromGcaTrait(uniqueKeys, rows, trait, importNotes) {
	
		if (trait.mode && trait.mode.includes("|") && trait.characc && trait.characc != "|") {
	
			getMultipleRangedAttackModesFromGcaTrait(uniqueKeys, rows, trait, importNotes);
	
		} else if (trait.characc && trait.characc != "|") {
	
			getSingleRangedAttackModeFromGcaTrait(uniqueKeys, rows, trait, importNotes);
	
		}
	
	}
	
	/**
	 * If trait only has a single attack mode, use this function
	 *
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. Passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getSingleRangedAttackModeFromGcaTrait(uniqueKeys, rows, trait, importNotes) {
	
		let idkey = trait.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_ranged_${rowId}`;
	
		let fullName = trait.name;
	
		if (trait.nameext && trait.namext != trait.name) {
	
			fullName += ` (${trait.nameext})`;
	
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		let damage = getDamageDieFromGca(trait.chardamage);
	
		rows[`${baseFieldName}_damage`] = damage;
	
		rows[`${baseFieldName}_type`] = getDamageTypeFromGca(trait.chardamtype);
	
		if (trait.characc) {
			rows[`${baseFieldName}_acc`] = trait.characc;
		} else {
			rows[`${baseFieldName}_acc`] = 0;
		}
	
		rows[`${baseFieldName}_range`] = getRangeFromGca(trait);
	
		if (trait.charskillscore) {
			rows[`${baseFieldName}_skill`] = trait.charskillscore;
		}
	
		if (trait.charrof) {
			rows[`${baseFieldName}_rof`] = trait.charrof;
		}
	
		if (trait.charshots) {
			rows[`${baseFieldName}_shots`] = trait.charshots;
		}
	
		if (trait.bulk) {
			rows[`${baseFieldName}_bulk`] = trait.bulk;
		}
	
		if (trait.charrcl) {
			rows[`${baseFieldName}_recoil`] = trait.charrcl;
		}
	
		if (trait.chararmordivisor) {
	
			rows[`${baseFieldName}_armor_divisor`] = trait.chararmordivisor;
	
		}
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getRangedMeleeNotesFromGca(trait);
		}
	
	}
	
	/**
	 * The ranged attack has several modes
	 * Need a row for each attack mode
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object of properties to update/add rows. Passed by reference
	 * @param {object}  trait       JSON data for the trait
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getMultipleRangedAttackModesFromGcaTrait(uniqueKeys, rows, trait, importNotes) {
	
		// example: "mode": "Staff swing|Staff thrust|Sword swing|Sword thrust"
		let arrModes = trait.mode.split("|");
	
		// example: "chardamage": "1d+1|1d|1d+1|1d-1",
		let arrDamage;
	
		if (trait.chardamage) {
			arrDamage = trait.chardamage.split("|");
		}
	
		// example: "chardamtype": "cr|cr|cr|cr",
		let arrDamType;
	
		if (trait.chardamtype) {
			arrDamType = trait.chardamtype.split("|")
		}
	
		// example: "chararmordivisor": "|3",
		let arrDivisor = [];
	
		if (trait.chararmordivisor) {
			arrDivisor = trait.chararmordivisor.split("|");
		}
	
		// example: "charskillscore": "11|11|5|5"
		let arrSkillLevel = [];
	
		if (trait.charskillscore) {
			arrSkillLevel = trait.charskillscore.split("|");
		}
	
		// i.e: "characc": "4|4",
		let arrAcc;
	
		if (trait.characc) {
			arrAcc = trait.characc.split("|");
		}
	
		// i.e: "charrcl": "3|3",
		let arrRecoil;
	
		if (trait.charrcl) {
			arrRecoil = trait.charrcl.split("|")
		}
	
		// "charrof": "3|3",
		let arrRof;
	
		if (trait.charrof) {
			arrRof = trait.charrof.split("|")
		}
	
		// "charshots": "20+1(3)|20+1(3)",
		let arrShots;
	
		if (trait.charshots) {
			arrShots = trait.charshots.split("|");
		}
	
		// "charskillused": "\"SK:Guns (Pistol)\"|\"SK:Guns (Pistol)\"",
		let arrSkillUsed = trait.charskillused.split("|");
	
		// "charrangehalfdam": "180|180",
		let arrHalfRange;
	
		if (trait.charrangehalfdam) {
			arrHalfRange = trait.charrangehalfdam.split("|");
		}
	
		// "charrangemax": "2000|2000",
		let arrMaxRange;
	
		if (trait.charrangemax) {
			arrMaxRange = trait.charrangemax.split("|")
		}
	
		let arrBulk;
	
		if (trait.bulk) {
			arrBulk = trait.bulk.split("|");
		}
	
		let damageNote = "";
	
		// tracks which mode to use
		let index = 0;
	
		arrModes.forEach(mode => {
	
			if (String(mode).toLowerCase() === "swing" || String(mode).toLowerCase() === "thrust") {
				return;
			}
	
			let idkey = trait.IDKey.trim() + `-mode-${index}`;
	
			let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
			let baseFieldName = `repeating_ranged_${rowId}`;
	
			let fullName = trait.name;
	
			if (trait.nameext && trait.nameext != trait.name) {
	
				fullName += ` (${trait.nameext})`;
	
			}
	
			fullName += ` (${mode})`;
	
			rows[`${baseFieldName}_idkey`] = idkey;
	
			rows[`${baseFieldName}_name`] = fullName;
	
			let damage = "0";
	
			let damageNote = "";
	
			let damageTypeNote = "";
	
			if (arrDamage && arrDamage.length === 1) {
	
				damage = arrDamage[0];
	
				damageNote = arrDamage[0];
	
				// replace "d" with "d6"
				damage = damage.replace("d", "d6");
	
				rows[`${baseFieldName}_damage`] = damage;
	
			} else if (arrDamage && arrDamage.length > 1) {
	
				damage = arrDamage[index];
	
				damageNote = arrDamage[index];
	
				// replace "d" with "d6"
				damage = damage.replace("d", "d6");
	
				rows[`${baseFieldName}_damage`] = damage;
	
			}
	
			if (arrDamType && arrDamType.length === 1) {
	
				damageTypeNote = arrDamType[0];
	
				rows[`${baseFieldName}_type`] = getDamageTypeFromGca(arrDamType[0]);
	
			} else if (arrDamType && arrDamType.length > 1) {
	
				damageTypeNote = arrDamType[index];
	
				rows[`${baseFieldName}_type`] = getDamageTypeFromGca(arrDamType[index]);
	
			}
	
			if (arrAcc && arrAcc.length === 1) {
				rows[`${baseFieldName}_acc`] = arrAcc[0];
			} else if (arrAcc && arrAcc.length > 1) {
				rows[`${baseFieldName}_acc`] = arrAcc[index];
			}
	
			let halfRange = "";
	
			if (arrHalfRange && arrHalfRange.length === 1) {
				halfRange = arrHalfRange[0];
			} else if (arrHalfRange && arrHalfRange.length > 1) {
				halfRange = arrHalfRange[index];
			}
	
			let maxRange = "";
	
			if (arrMaxRange && arrMaxRange.length === 1) {
				maxRange = arrMaxRange[0];
			} else if (arrMaxRange && arrMaxRange.length > 1) {
				maxRange = arrMaxRange[index];
			}
	
			rows[`${baseFieldName}_range`] = getRangeFromHalfMax(halfRange, maxRange);
	
	
			let skillLevel = "10";
	
			if (arrSkillLevel && arrSkillLevel.length === 1) {
				skillLevel = arrSkillLevel[0];
			} else if (arrSkillLevel && arrSkillLevel.length > 1) {
				skillLevel = arrSkillLevel[index];
			}
	
			rows[`${baseFieldName}_skill`] = skillLevel;
	
			if (arrRof && arrRof.length === 1) {
				rows[`${baseFieldName}_rof`] = arrRof[0];
			} else if (arrRof && arrRof.length > 1) {
				rows[`${baseFieldName}_rof`] = arrRof[index];
			}
	
			if (arrShots && arrShots.length === 1) {
				rows[`${baseFieldName}_shots`] = arrShots[0];
			} else if (arrShots && arrShots.length > 1) {
				rows[`${baseFieldName}_shots`] = arrShots[index];
			}
	
			if (arrBulk && arrBulk.length === 1) {
				rows[`${baseFieldName}_bulk`] = arrBulk[0];
			} else if (arrBulk && arrBulk.length > 1) {
				rows[`${baseFieldName}_bulk`] = arrBulk[index];
			}
	
			if (arrRecoil && arrRecoil.length === 1) {
				rows[`${baseFieldName}_recoil`] = arrRecoil[0];
			} else if (arrRecoil && arrRecoil.length > 1) {
				rows[`${baseFieldName}_recoil`] = arrRecoil[index];
			}
	
			let divisor = 1;
	
			if (arrDivisor && arrDivisor.length === 1) {
				divisor = Number(arrDivisor[0]);
			} else if (arrDivisor && arrDivisor.length > 1) {
				divisor = Number(arrDivisor[index]);
			}
	
			if (isNaN(divisor) || divisor < 1) {
				divisor = 1;
			}
	
			rows[`${baseFieldName}_armor_divisor`] = divisor;
	
			let damageNotes = `${damageNote} (${damageTypeNote})`;
	
			if (importNotes) {
				rows[`${baseFieldName}_notes`] = getRangedMeleeNotesFromGca(trait, skillLevel, damageNotes);
			}
	
			index++;
	
		});
	
	}
	
	/**
	 * Check if trait has any defense mods
	 *
	 * @param {object} uniqueKeys Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} rows       Object of properties to update/add rows. Passed by reference
	 * @param {object} trait      JSON data for the trait
	 */
	function getDefenseFromGcaTrait(uniqueKeys, rows, trait) {
	
		// determine defen
		let parryDefense = getDefenseForGcaTrait(trait, "parry");
	
		let blockDefense = getDefenseForGcaTrait(trait, "block");
	
		// it could be possible a trait has block & parry
		if (parryDefense === "multi") {
	
			getMultipleDefenseModesFromGcaTrait(uniqueKeys, rows, trait, "parry");
	
		} else if (parryDefense === "single") {
	
			getSingleDefenseModeFromGcaTrait(uniqueKeys, rows, trait, "parry");
	
		}
	
		// it could be possible a trait has block & parry
		if (blockDefense === "multi") {
	
			getMultipleDefenseModesFromGcaTrait(uniqueKeys, rows, trait, "block");
	
		} else if (blockDefense === "single") {
	
			getSingleDefenseModeFromGcaTrait(uniqueKeys, rows, trait, "block");
	
		}
	
	}
	
	/**
	 * Determines the defense type of a trait based on parry or block
	 * if it is single, multi, or not present
	 * 
	 * @param {object} trait GCA json data
	 * @param {string} checkFor What type of defense to check for. parry | block
	 *
	 * @returns {string} Returns single|multi|empty if none
	 */
	function getDefenseForGcaTrait(trait, checkFor = "parry") {
	
		let defenseType;
	
		let parry;
	
		let blocklevel;
	
		if (checkFor.toLowerCase() === "parry") {
	
			if (trait.charparryscore) {
	
				parry = trait.charparryscore;
	
				// unset if value is "no"
				if (parry.toLowerCase() === "no" || parry == 0) {
					parry = null;
				}
	
			}
	
			if (parry && parry.includes("|")) {
	
				defenseType = "multi";
	
			} else if (parry) {
	
				defenseType = "single";
	
			}
	
		}
	
		if (checkFor.toLowerCase() === "block") {
	
			if (trait.blocklevel) {
	
				blocklevel = String(trait.blocklevel);
	
				// unset if value is "no"
				if (blocklevel.toLowerCase() === "no" || blocklevel == "0") {
					blocklevel = null;
				}
	
			}
	
			if (blocklevel && blocklevel.includes("|")) {
	
				defenseType = "multi";
	
			} else if (blocklevel) {
	
				defenseType = "single";
	
			}
	
		}
	
		return defenseType;
	
	}
	
	/**
	 * If trait only has a single defense mode, use this function
	 * Currenlty only handles parry and block
	 *
	 * @param {object} uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} rows        Object of properties to update/add rows. Passed by reference
	 * @param {object} trait       JSON data for the trait
	 * @param {string} defenseType parry|block. Used to help determine defense type drop-down value
	 */
	function getSingleDefenseModeFromGcaTrait(uniqueKeys, rows, trait, defenseType) {
	
		let idkey = trait.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_defense_${rowId}`;
	
		let fullName = trait.name;
	
		if (trait.nameext && trait.nameext != trait.name) {
	
			fullName += ` (${trait.nameext})`;
	
		}
	
		let skill;
	
		let defenseDropDownValue;
	
		let defenseInfo;
	
		if (String(defenseType).toLowerCase() === "parry") {
	
			[skill, defenseDropDownValue, defenseInfo] = getParryDefenseInfoFromGca(trait.charparryscore, trait.name);
	
		} else {
	
			skill = Number(trait.blocklevel);
	
			defenseDropDownValue = "Block";
	
			defenseInfo = "";
	
		}
	
		// if no skill value, LEAVE!
		if (!skill || isNaN(skill)) {
			return;
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_skill`] = skill;
	
		rows[`${baseFieldName}_type`] = defenseDropDownValue;
	
		rows[`${baseFieldName}_info`] = defenseInfo;
	
	}
	
	/**
	* The ranged attack has several modes
	* Need a row for each attack mode
	* 
	* @param {object} uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	* @param {object} rows        Object of properties to update/add rows. Passed by reference
	* @param {object} trait       JSON data for the trait
	* @param {string} defenseType parry|block. Used to help determine defense type drop-down value
	*/
	function getMultipleDefenseModesFromGcaTrait(uniqueKeys, rows, trait, defenseType) {
	
		// example: "mode": "Staff swing|Staff thrust|Sword swing|Sword thrust"
		let arrModes = trait.mode.split("|");
	
		// "charparryscore": "10|10|No",
		let arrParry;
	
		if (String(defenseType).toLowerCase() === "parry" && trait.charparryscore) {
			arrParry = trait.charparryscore.split("|");
		}
	
		// "charparryscore": "10|No|No",
		let arrBlock;
	
		if (String(defenseType).toLowerCase() === "block" && trait.blocklevel) {
			arrBlock = trait.blocklevel.split("|");
		}
	
		let skill;
	
		let defenseDropDownValue;
	
		let defenseInfo;
	
		let parryScore;
	
		// tracks which mode to use
		let index = 0;
	
		arrModes.forEach(mode => {
	
			// reset values because for loop;
			parryScore = null;
	
			skill = null;
	
			defenseDropDownValue = "";
	
			defenseInfo = "";
	
			if (String(defenseType).toLowerCase() === "parry") {
	
				parryScore = arrParry[index];
	
				[skill, defenseDropDownValue, defenseInfo] = getParryDefenseInfoFromGca(parryScore, trait.name);
	
			} else {
	
				skill = Number(arrBlock[index]);
	
				defenseDropDownValue = "Block";
	
				defenseInfo = "";
	
			}
	
			// if no skill, get out of loop
			if (!skill || isNaN(skill)) {
				return;
			}
	
			let idkey = trait.IDKey.trim() + `-mode-${index}`;
	
			let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
			let baseFieldName = `repeating_defense_${rowId}`;
	
			let fullName = trait.name;
	
			if (trait.nameext && trait.nameext != trait.name) {
	
				fullName += ` (${trait.nameext})`;
	
			}
	
			fullName += ` (${mode})`;
	
			rows[`${baseFieldName}_idkey`] = idkey;
	
			rows[`${baseFieldName}_name`] = fullName;
	
			rows[`${baseFieldName}_skill`] = skill;
	
			rows[`${baseFieldName}_type`] = defenseDropDownValue;
	
			rows[`${baseFieldName}_info`] = defenseInfo;
	
			index++;
	
		});
	
	}
	
	/**
	 * Get parry defense information based on parry score
	 * i.e.: score of 12U returns [12, U, Parry] 
	 * 
	 * @param {string} parryScore Value to evaluate
	 * @param {string} name       Name of trait. Punch | Brawling = Unarmed Parry
	 * 
	 * @returns {[number, string, string]} An array of [skill: number, dropDownValue: string, defenseInfo: string]
	 */
	function getParryDefenseInfoFromGca(parryScore, name) {
	
		let skill;
	
		let dropDownValue;
	
		let defenseInfo = "";
	
		// check for unbalanced parry
		if (parryScore && parryScore.includes("U")) {
	
			defenseInfo = "U";
	
			// just need number
			skill = Number(parryScore.replace("U", ""));
	
		} else if (parryScore && parryScore.includes("F")) {
	
			defenseInfo = "F";
	
			// just need number
			skill = Number(parryScore.replace("F", ""));
	
		} else {
	
			skill = Number(parryScore);
	
		}
	
		// check skill is a number
		if (!skill || isNaN(skill)) {
	
			skill = null;
	
		};
	
		if (String(name).toLowerCase() === "punch" || String(name).toLowerCase() === "brawling" || String(name).toLowerCase() === "karate") {
			dropDownValue = "Unarmed Parry";
		} else {
			dropDownValue = "Parry";
		}
	
		return [skill, dropDownValue, defenseInfo];
	
	}
	
	/**
	 * Get Damage Die roll for use with Roll20
	 * Will convert variable die rolls to Roll20 macro prompt
	 */
	function getDamageDieFromGca(damageDie) {
	
		let dieRoll = "";
	
		if (!damageDie) {
			return dieRoll;
		}
	
		if (damageDie && damageDie.includes("~")) {
	
			// example: ~1d+1
			// remove ~
			damageDie = damageDie.replace("~", "");
	
			// array = [1, +1]
			let arrDamageDie = damageDie.split("d");
	
			let baseDie = 1;
	
			let dieModifier = "0";
	
			if (arrDamageDie.length === 1) {
	
				baseDie = arrDamageDie[0];
	
			} else if (arrDamageDie.length === 2) {
	
				baseDie = arrDamageDie[0];
	
				dieModifier = arrDamageDie[0];
	
			}
	
			dieRoll = getNumberOfDicePrompt(baseDie, Number(dieModifier));
	
		} else {
	
			dieRoll = damageDie.replace("d", "d6");
		}
	
		return dieRoll;
	
	}
	
	/**
	 * Returns a Roll20 prompt macro to select number of dice for a roll
	 * example: GCA4 Roll = ~2d+1. 
	 *          baseDie = 1
	 * 			dieModifier = 1
	 * 			return a macro: ?{# of Dice|1d6|2d6|3d6|4d6|5d6}
	 * 
	 * @param {number} baseDie Base die roll
	 * @param {number} dieModifier Modifier applied to the die roll
	 * @param {number} optionCount Number of options to include in the drop-down
	 * 
	 * @returns {string} Roll20 Macro Prompt
	 */
	function getNumberOfDicePrompt(baseDie, dieModifier, optionCount = 9) {
	
		let prompt;
	
		let arrOptions = [];
	
		let option;
	
		let optionDie;
	
		let optionDieMod;
	
		let options;
	
		// makee sure baseDie is a number
		baseDie = Number(baseDie);
		if (isNaN(baseDie)) {
			baseDie = 1;
		}
	
		dieModifier = Number(dieModifier);
		if (isNaN(dieModifier)) {
			dieModifier = 0;
		}
	
		if (optionCount < 0) {
			optionCount = 1;
		}
	
		// create the options
		for (let counter = 1; counter <= optionCount; counter++) {
	
			optionDie = counter * baseDie;
	
			optionDieMod = counter * dieModifier;
	
			if (optionDieMod === 0) {
	
				option = `${optionDie}d6`;
	
			} else if (optionDieMod > 0) {
	
				option = `${optionDie}d6+${optionDieMod}`;
	
			} else {
	
				option = `${optionDie}d6-${optionDieMod}`;
	
			}
	
			arrOptions.push(option);
	
		}
	
	
		options = arrOptions.join("|");
	
		prompt = `?{# of Die|${options}}`;
	
		return prompt;
	
	}
	
	
	/**
	 * Gets ranged/melee notes GCA4 trait
	 * 
	 * @param {object} trait     JSON data for the trait
	 * @param {string} skillUsed  Used for multimode attack. Replaces trait.charskillused
	 * @param {string} damageNote Used for multimode attack. Replaces trait.damage && trait.damtype
	 * 
	 * @returns {string}
	 */
	function getRangedMeleeNotesFromGca(trait, skillUsed = "", damageNote = "") {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (trait.usernotes) {
			arrNotes.push(trait.usernotes + "\n");
		}
	
		if (skillUsed) {
	
			arrNotes.push("Skill: " + skillUsed + "\n");
	
		} else if (trait.charskillused) {
	
			arrNotes.push("Skill: " + trait.charskillused + "\n");
	
		}
	
		if (damageNote) {
	
			arrNotes.push(`Damage: ${damageNote}` + "\n");
	
		} else if (trait.damage && trait.damtype) {
	
			arrNotes.push(`Damage: ${trait.damage} (${trait.damtype})` + "\n");
	
		} else if (trait.damage) {
	
			arrNotes.push(`Damage: ${trait.damage}` + "\n");
	
		}
	
		if (trait.gives) {
			arrNotes.push("Gives: " + trait.gives + "\n");
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	}
	
	/**
	 * Gets defense notes GCA4 trait
	 * 
	 * @param {object} trait     JSON data for the trait
	 * 
	 * @returns {string}
	 */
	function getDefenseNotesFromGca(trait) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (trait.usernotes) {
			arrNotes.push(trait.usernotes + "\n");
		}
	
		if (trait.charskillused) {
	
			arrNotes.push("Skill: " + trait.charskillused + "\n");
	
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	}
	
	/**
	 * Gets ranged value from GCA4 trait
	 * 
	 * @param {object} trait JSON data for the trait
	 * 
	 * @returns {string}
	 */
	function getRangeFromGca(trait) {
	
		let range = "";
	
		if (trait.charrangehalfdam && trait.charrangemax) {
	
			range = trait.charrangehalfdam + "/" + trait.charrangemax;
	
		} else if (trait.charrangehalfdam) {
	
			range = trait.charrangehalfdam;
	
		} else if (trait.charrangemax) {
	
			range = trait.charrangemax;
	
		}
	
		return range;
	
	}
	
	/**
	 * Returns the range of a weapon
	 * 
	 * @param {string} halfRange Half damage range
	 * @param {string} maxRange  Maximum range
	 * 
	 * @returns {string}
	 */
	function getRangeFromHalfMax(halfRange, maxRange) {
	
		let range = "";
	
		if (halfRange && maxRange) {
	
			range = halfRange + "/" + maxRange;
	
		} else if (halfRange) {
	
			range = halfRange;
	
		} else if (maxRange) {
	
			range = maxRange;
	
		}
	
		return range;
	
	}
	
	/**
	 * Gets the roll20 damage type based GCA4 damage type
	 * 
	 * @param {string} gcaDamageType GCA4 damage type
	 */
	function getDamageTypeFromGca(gcaDamageType) {
	
		let type = "";
	
		if (!gcaDamageType) {
			return type;
		}
	
		// if damage type contains a space, there's an additional damage type present
		// example: damage type = cr exp = Crush Explosive. 
		// we only want "cr"
	
		if (gcaDamageType.includes(" ")) {
	
			let arrType = gcaDamageType.split(" ");
	
			gcaDamageType = arrType[0];
	
		}
	
		switch (gcaDamageType) {
	
			case "aff":
				type = "Affliction (aff)";
				break;
	
			case "burn":
				type = "Burning (burn)";
				break;
	
			case "cor":
				type = "Corrosion (cor)";
				break;
	
			case "cr":
				type = "Crushing (cr)";
				break;
	
			case "cut":
				type = "Cutting (cut)";
				break;
	
			case "fat":
				type = "Fatigue (fat)";
				break;
	
			case "imp":
				type = "Impaling (imp)";
				break;
	
			case "pi-":
				type = "Small Piercing (pi-)";
				break;
	
			case "pi":
				type = "Piercing (pi)";
				break;
	
			case "pi+":
				type = "Large Piercing (pi+)";
				break;
	
			case "pi++":
				type = "Huge Piercing (pi++)";
				break;
	
			case "knock":
				type = "Knockback (knock)";
				break;
	
			case "tox":
				type = "Toxic (tox)";
				break;
	
			case "spec":
			default:
				type = "Special (spec)";
				break;
	
	
		}
	
		return type;
	
	}
	
	
	/**
	 * Loops advantages and add advantages
	 * TODO: Check to see if advantage already exists, then update
	 * 
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      Json DATA from GCA4 file
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      A function to run after updating is complete
	 */
	function importGcaAdvantages(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let advantages = getJsonArrayFromTrait(jsonData.Character.Traits.Advantage);
	
		// rows is passed by reference
		let rows = {};
	
		let saveRows = false;
	
		if (advantages && advantages.length) {
	
			advantages.forEach(advantage => {
	
				let name = advantage.name;
	
				let basedon = "";
	
				if (advantage.basedon) {
					basedon = advantage.basedon;
				}
	
				if (!GCA_IGNORED_ADVANTAGES.includes(name)) {
	
					saveRows = true;
	
					if (basedon == "Language - Native" || basedon == "Language - Native (Spoken)" || basedon == "Language - Native (Written)") {
	
						getGcaValuesForNativeLanguage(rows, name, basedon, advantage);
	
					} else if (basedon == "Language" || basedon == "Language (Spoken)" || basedon == "Language (Written)") {
	
						getGcaValuesForRepeatingLanguage(uniqueKeys, rows, name, basedon, advantage);
	
					} else if (basedon && basedon.includes("Cultural Familiarity")) {
	
						getGcaValuesForCulturalFamiliarity(uniqueKeys, rows, name, advantage);
	
					} else {
	
						getGcaAdvantageRow(uniqueKeys, rows, name, advantage, runningTotals, importNotes);
	
						getMeleeAttackFromGcaTrait(uniqueKeys, rows, advantage, importNotes);
	
						getRangedAttackFromGcaTrait(uniqueKeys, rows, advantage, importNotes);
	
						getDefenseFromGcaTrait(uniqueKeys, rows, advantage);
					}
	
					getGcaModifiersForAdvantage(rows, name, advantage, runningTotals);
	
				}
	
			});
	
		}
	
		if (saveRows) {
	
			setAttrs(rows, null, callback);
	
		} else {
	
			callback();
	
		}
	
	}
	
	/**
	 * Updates the rows value with an row for advantages
	 * 
	 * @param {object}  uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows          Object of properties to update/add rows. passed by Ref
	 * @param {string}  name          Name of the advantage
	 * @param {object}  advantage     JSON data for the advantage
	 * @param {object}  runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean} importNotes   Option to also import notes.
	 */
	function getGcaAdvantageRow(uniqueKeys, rows, name, advantage, runningTotals, importNotes) {
	
		let idkey = advantage.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_traits_${rowId}`;
	
		let fullName = name;
	
		let levelName;
	
		let templateName = getGcaTemplateName(idkey, runningTotals);
	
		if (templateName) {
	
			// save to racial table instead.
			baseFieldName = `repeating_racial_${rowId}`;
	
			// if more than one template, prepend the template name
			if (runningTotals.templates.length > 1) {
	
				fullName = `[${templateName}] ${fullName}`;
			}
	
		}
	
		if (advantage.nameext) {
	
			fullName += ` (${advantage.nameext})`;
	
		}
	
		if (advantage.levelnames) {
	
			levelName = getGcaLevelName(advantage);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		if (advantage.level) {
			rows[`${baseFieldName}_trait_level`] = Number(advantage.level);
		}
	
		if (advantage.points) {
			rows[`${baseFieldName}_points`] = Number(advantage.points);
		} else {
			rows[`${baseFieldName}_points`] = 0;
		}
	
		if (advantage.page) {
			rows[`${baseFieldName}_ref`] = advantage.page;
		}
	
		let notes = getGcaAdvantageNotes(advantage);
	
		if (importNotes && notes) {
			rows[`${baseFieldName}_notes`] = notes;
		}
	
		let controlRating = 0;
	
		if (levelName) {
	
			controlRating = getControlRatingByLevelName(levelName);
	
		}
	
		if (controlRating === 0) {
	
			controlRating = getControlRatingByModifier(advantage);
	
		}
	
		if (controlRating > 0) {
			rows[`${baseFieldName}_foa`] = controlRating;
		}
	
	}
	
	/**
	 * Attempts to get an associated template name to the unique key
	 * If no match, returns false
	 *
	 * @param {string} idkey GCA4 unique primary key to search for
	 * @param {object} runningTotals GCA4 import totals. Passed by reference. 
	 * 
	 * @returns {string | boolean }
	 */
	function getGcaTemplateName(idkey, runningTotals) {
	
		let name = false;
	
		// for info on runningTotals see: function importCharacterSheetWithGCA(
		if (runningTotals.templates && runningTotals.templates.length) {
	
			runningTotals.templates.forEach(template => {
	
				if (template.keys && template.keys.includes(idkey)) {
					name = template.name;
				}
	
			});
	
		}
	
		return name;
	
	}
	
	/**
	 * Adds the row values for native language fields. 
	 * Currently, non-repeating
	 * 
	 * @param {object} rows      Object of row properties. Passed by reference
	 * @param {string} name      Name of advantage
	 * @param {string} basedon   Language based on
	 * @param {object} advantage JSON data for advantage
	 */
	function getGcaValuesForNativeLanguage(rows, name, basedon, advantage) {
	
		basedon = String(basedon).toLowerCase();
	
		let writtenLevel = -3;
	
		let spokenLevel = -3;
	
		if (basedon && basedon.includes("spoken")) {
	
			spokenLevel = getLanguageValueFromGca(advantage.level);
	
			writtenLevel = -3;
	
		} else if (basedon && basedon.includes("written")) {
	
			spokenLevel = -3;
	
			writtenLevel = getLanguageValueFromGca(advantage.level);
	
		} else {
	
			spokenLevel = getLanguageValueFromGca(advantage.level);
	
			writtenLevel = spokenLevel;
	
		}
	
		let fullName = name;
	
		if (advantage.nameext) {
	
			fullName += ` (${advantage.nameext})`;
	
		}
	
		rows["name_native_language"] = fullName
	
		rows["native_language_idkey"] = advantage.IDKey;
	
		rows["native_language_spoken"] = spokenLevel;
	
		rows["native_language_written"] = writtenLevel;
	
	}
	
	/**
	 * Get the Roll20 language level from GCA4 level
	 * 
	 * @param {string} gcaLevel  The value for the GCA4 language level
	 * @param {boolean}   repeating Get value for repeating language
	 * 
	 * @returns {number}
	 */
	function getLanguageValueFromGca(gcaLevel, repeating = false) {
	
		const gcaLevelNumber = Number(gcaLevel);
	
		let roll20Level;
	
		if (repeating) {
	
			roll20Level = gcaLevelNumber;
	
		} else {
	
			switch (gcaLevelNumber) {
	
				case 1:
					roll20Level = -2
					break;
	
				case 2:
					roll20Level = -1;
					break;
	
				case 3:
					roll20Level = 0;
					break;
	
				default:
					roll20Level = -3;
					break;
	
			}
	
		}
	
		return roll20Level;
	}
	
	/**
	 * Adds the row values for repeating language fields. 
	 * 
	 * @param {object} uniqueKeys Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} rows       Object of row properties. Passed by reference
	 * @param {string} name       Name of advantage
	 * @param {string} basedon    Language based on
	 * @param {object} advantage  JSON data for advantage
	 */
	function getGcaValuesForRepeatingLanguage(uniqueKeys, rows, name, basedon, advantage) {
	
		basedon = basedon ? String(basedon).toLowerCase() : "";
	
		let idkey = advantage.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_languages_${rowId}`;
	
		let writtenLevel = "-3";
	
		let spokenLevel = "-3";
	
		if (basedon.includes("spoken")) {
	
			spokenLevel = getLanguageValueFromGca(advantage.level, true) || "";
	
			writtenLevel = "0";
	
		} else if (basedon.includes("written")) {
	
			spokenLevel = "0";
	
			writtenLevel = getLanguageValueFromGca(advantage.level, true);
	
		} else {
	
			spokenLevel = getLanguageValueFromGca(advantage.level, true);
	
			writtenLevel = spokenLevel;
	
		}
	
		let fullName = name;
	
		if (advantage.nameext) {
	
			fullName += ` (${advantage.nameext})`;
	
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_spoken`] = spokenLevel;
	
		rows[`${baseFieldName}_written`] = writtenLevel;
	
		return rows;
	
	}
	
	/**
	 * Adds the row values for repeating cultural Familiarities fields. 
	 * 
	 * @param {object} uniqueKeys Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object} rows       Object of row properties. passed by reference
	 * @param {string} name       Name of advantage
	 * @param {object} advantage  JSON data for advantage
	 */
	function getGcaValuesForCulturalFamiliarity(uniqueKeys, rows, name, advantage) {
	
		let idkey = advantage.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName = `repeating_cultures_${rowId}`;
	
		let fullName = name;
	
		if (advantage.nameext) {
	
			fullName += ` (${advantage.nameext})`;
	
		}
	
		let points = 0;
	
		if (advantage.points) {
			points = Number(advantage.points);
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_points`] = points;
	
	}
	
	/**
	 * Get notes for GCA4 advantage OR disadvantage
	 * 
	 * @param {object} advantage JSON object for an GCA4 advantage
	 */
	function getGcaAdvantageNotes(advantage) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (advantage.basedon && advantage.basedon != advantage.name) {
			arrNotes.push("Based On: " + advantage.basedon + "\n");
		}
	
		if (advantage.usernotes) {
			arrNotes.push(advantage.usernotes + "\n");
		}
	
		if (advantage.description) {
			arrNotes.push("Description: " + advantage.description + "\n");
		}
	
		let modNote = getGcaModifierNotes(advantage);
	
		if (modNote) {
			arrNotes.push(modNote);
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	}
	
	/**
	 * Gets modifier notes, if any
	 * 
	 * @param {object} advantage JSON object for an GCA4 advantage
	 */
	function getGcaModifierNotes(advantage) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (advantage.Modifier && advantage.Modifier.length) {
	
			for (let i = 0; i < advantage.Modifier.length; i++) {
	
				let modifier = advantage.Modifier[i];
	
				let theNote = `${modifier.name}, ${modifier.value}`;
	
				let subNote = "";
	
				// if there's sub-modifiers, get them
				if (modifier.Modifier) {
	
					subNote = getGcaModifierNotes(advantage);
	
					theNote += `(${subNote})`;
	
				}
	
				arrNotes.push(theNote);
	
			}
	
		} else if (advantage.Modifier) {
	
			let theNote = `${advantage.Modifier.name}, ${advantage.Modifier.value}`;
	
			let subNote = "";
	
			// if there's sub-modifiers, get them
			if (advantage.Modifier.Modifier) {
	
				subNote = getGcaModifierNotes(advantage.Modifier);
	
				theNote += `(${subNote})`;
	
			}
	
			arrNotes.push(theNote);
	
		}
	
		if (arrNotes.length) {
			notes = "Modifiers:\n" + arrNotes.join("\n") + "\n";
		}
	
		return notes;
	
	}
	
	/**
	 * Find additional bonuses and check boxes based on advantage name
	 * 
	 * @param {object} rows          Current set of rows. passed by reference
	 * @param {string} name          Name of the advantage
	 * @param {object} advantage     GCA4 JSON advantage data
	 * @param {object} runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 */
	function getGcaModifiersForAdvantage(rows, name, advantage, runningTotals) {
	
		let nameCompare = String(name).toLowerCase();
	
		switch (nameCompare) {
	
			case "combat reflexes":
				rows["combat_reflexes"] = 1;
				break;
	
			case "lifting st":
				rows["lift_st_mod"] = advantage.level;
				break;
	
			case "striking st":
				rows["striking_st_mod"] = advantage.level;
				break;
	
			case "magery":
				rows["spell_bonus"] = advantage.level;
				break;
	
			case "wealth":
				rows["wealth"] = getGcaLevelName(advantage, "Average");
				break;
	
			case "fit":
				runningTotals.unconscious_check_mod += 1;
				runningTotals.death_check_mod += 1;
				break;
	
			case "very fit":
				runningTotals.unconscious_check_mod += 2;
				runningTotals.death_check_mod += 2;
				break;
	
			case "hard to kill":
				let deathMod = Number(advantage.level);
				if (isNaN(deathMod)) {
					deathMod = 0;
				}
				runningTotals.death_check_mod += deathMod;
				break;
	
			case "hard to subdue":
				let subdueMod = Number(advantage.level);
				if (isNaN(subdueMod)) {
					subdueMod = 0;
				}
				runningTotals.unconscious_check_mod += subdueMod;
				break;
	
			case "high pain threshold":
				runningTotals.stun_check_mod += 3;
				runningTotals.knockdown_check_mod += 3;
				break;
	
		}
	
	}
	
	/**
	 * Find additional modifiers and check boxes based on disadvantage name
	 * Updates the runningTotals by reference
	 * 
	 * @param {object}  rows          Current set of rows. Passed by reference
	 * @param {string}  name          Name of the disadvantage
	 * @param {object}  disadvantage  GCA4 json object
	 * @param {object}  runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean=} importNotes   Option to also import notes. possible future updates may need field
	  */
	function getGcaModifiersDisadvantage(rows, name, disadvantage, runningTotals, importNotes) {
	
		let nameCompare = String(name).toLowerCase();
	
		switch (nameCompare) {
	
			case "wealth":
				rows["wealth"] = getGcaLevelName(disadvantage, "Average");
				break;
	
			case "low pain threshold":
				runningTotals.stun_check_mod += -3;
				runningTotals.knockdown_check_mod += -4;
				break;
	
		}
	
	}
	
	/**
	 * Updates Perks and Quirks
	 * TODO: Check to see if Perk or Quirk already exists, then update
	 * 
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      Json DATA from GCA4 file
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      A function to run after updating is complete
	 */
	function importGcaPerksQuirks(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let perks = getJsonArrayFromTrait(jsonData.Character.Traits.Perks);
	
		let quirks = getJsonArrayFromTrait(jsonData.Character.Traits.Quirk);
	
		let rows = {};
	
		if (perks && perks.length) {
	
			perks.forEach(perk => {
	
				let name = perk.name;
	
				getGcaValuesForPerksQuirks(uniqueKeys, "perk", rows, name, perk, runningTotals, importNotes);
	
			});
	
		}
	
		if (quirks && quirks.length) {
	
			quirks.forEach(quirk => {
	
				let name = quirk.name;
	
				getGcaValuesForPerksQuirks(uniqueKeys, "quirk", rows, name, quirk, runningTotals, importNotes);
	
			});
	
		}
	
		setAttrs(rows, null, callback);
	
	}
	
	
	/**
	 * Get the row values for repeating perks or quirks
	 * 
	 * @param {object}  uniqueKeys     Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {string}  type          Type = perk | quirk
	 * @param {object}  rows          Rows for setAttr() function. passed by reference
	 * @param {string}  name          Name of the quirk or perk
	 * @param {object}  perkOrQuirk   object of perk or quirk
	 * @param {object}  runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean} importNotes   Option to also import notes.
	 */
	function getGcaValuesForPerksQuirks(uniqueKeys, type, rows, name, perkOrQuirk, runningTotals, importNotes) {
	
		let idkey = perkOrQuirk.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let baseFieldName;
	
		let fullName = name;
	
		let templateName = getGcaTemplateName(idkey, runningTotals);
	
		if (templateName) {
	
			// save to racial table instead.
			baseFieldName = `repeating_racial_${rowId}`;
	
			// if more than one template, prepend the template name
			if (runningTotals.templates.length > 1) {
	
				fullName = `[${templateName}] ${fullName}`;
			}
	
		} else if (type === "perk") {
	
			baseFieldName = `repeating_perks_${rowId}`;
	
		} else {
	
			baseFieldName = `repeating_quirks_${rowId}`;
	
		}
	
		if (perkOrQuirk.nameext) {
	
			fullName += ` (${perkOrQuirk.nameext})`;
	
		}
	
		let points = 0;
	
		if (perkOrQuirk.points) {
			points = Number(perkOrQuirk.points);
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_points`] = points;
	
		if (perkOrQuirk.page) {
			rows[`${baseFieldName}_ref`] = perkOrQuirk.page;
		}
	
		if (importNotes && perkOrQuirk.usernotes) {
			rows[`${baseFieldName}_notes`] = perkOrQuirk.usernotes;
		}
	
	}
	
	/**
	 * Import GCA4 disadvantages
	 * TODO: Add Update feature. Currently only does insert
	 *  
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      Json DATA from GCA4 file
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      A function to run after updating is complete
	 */
	function importGcaDisadvantages(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let disadvantages = getJsonArrayFromTrait(jsonData.Character.Traits.Disadvantage);
	
		let rows = {};
	
		if (disadvantages && disadvantages.length) {
	
			disadvantages.forEach(disadvantage => {
	
				let name = disadvantage.name;
	
				getGcaValuesForDisadvantage(uniqueKeys, rows, name, disadvantage, runningTotals, importNotes);
	
				getGcaModifiersDisadvantage(rows, name, disadvantage, runningTotals, importNotes);
	
			});
	
		}
	
		setAttrs(rows, null, callback);
	
	}
	
	/**
	 * Get row values for the disadvantage
	 * check for additional non-repeating values based on name 
	 * 
	 * @param {object}  uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows          Rows for setAttr() function. Passed by Reference
	 * @param {string}  name          Name of the quirk or perk
	 * @param {object}  disadvantage  object disadvantage
	 * @param {object}  runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean} importNotes   Option to also import notes.
	 */
	function getGcaValuesForDisadvantage(uniqueKeys, rows, name, disadvantage, runningTotals, importNotes) {
		let idkey = disadvantage.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let fullName = name;
	
		let levelName;
	
		let baseFieldName = `repeating_disadvantages_${rowId}`;
	
		let templateName = getGcaTemplateName(idkey, runningTotals);
	
		if (templateName) {
	
			// save to racial table instead.
			baseFieldName = `repeating_racial_${rowId}`;
	
			// if more than one template, prepend the template name
			if (runningTotals.templates.length > 1) {
	
				fullName = `[${templateName}] ${fullName}`;
			}
	
		}
	
		if (disadvantage.nameext) {
	
			fullName += ` (${disadvantage.nameext})`;
	
		}
	
		if (disadvantage.levelnames) {
	
			levelName = getGcaLevelName(disadvantage);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		let points = 0;
	
		if (disadvantage.points) {
			points = Number(disadvantage.points);
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_points`] = points;
	
		if (disadvantage.page) {
			rows[`${baseFieldName}_ref`] = disadvantage.page;
		}
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getGcaAdvantageNotes(disadvantage);
		}
	
		if (disadvantage.level) {
			rows[`${baseFieldName}_trait_level`] = disadvantage.level;
		}
	
		let controlRating = 0;
	
		if (levelName) {
	
			controlRating = getControlRatingByLevelName(levelName);
	
		}
	
		if (controlRating === 0) {
	
			controlRating = getControlRatingByModifier(disadvantage);
	
		}
	
		if (controlRating > 0) {
			rows[`${baseFieldName}_control_rating`] = controlRating;
		}
	
		getGcaValuesByDisadvantageName(rows, name, disadvantage);
	
	}
	
	/**
	 * Get control or frequency number from level name
	 * 
	 * @param {string} levelName Name of level
	 * 
	 * @returns {number}
	 */
	function getControlRatingByLevelName(levelName) {
	
		let rating = 0;
	
		if (levelName && levelName.includes("6 or less")) {
	
			rating = 6;
	
		} else if (levelName && levelName.includes("9 or less")) {
	
			rating = 9;
	
		} else if (levelName && levelName.includes("12 or less")) {
	
			rating = 12;
	
		} else if (levelName && levelName.includes("15 or less")) {
	
			rating = 15;
	
		}
	
		return rating;
	
	}
	
	/**
	 * Search Modifiers of an attribute for control
	 * or frequency values
	 * 
	 * @param {object} attribute Advantage or disadvantage to search modifiers
	 * 
	 * @returns {number}
	 */
	function getControlRatingByModifier(attribute) {
	
		let rating = 0;
	
		let shortName = "";
	
		if (attribute.Modifier && attribute.Modifier.length) {
	
			for (let i = 0; i < attribute.Modifier.length; i++) {
	
				let modifier = attribute.Modifier[i];
	
				if (modifier.shortname && modifier.shortname.includes("or less")) {
	
					shortName = modifier.shortname;
	
				}
	
			}
	
		} else if (attribute.Modifier) {
	
			shortName = attribute.Modifier.shortname;
	
		}
	
		if (shortName && shortName.includes("6 or less")) {
	
			rating = 6;
	
		} else if (shortName && shortName.includes("9 or less")) {
	
			rating = 9;
	
		} else if (shortName && shortName.includes("12 or less")) {
	
			rating = 12;
	
		} else if (shortName && shortName.includes("15 or less")) {
	
			rating = 15;
	
		}
	
		return rating;
	
	}
	
	/**
	 * Get any special non-repeating fields based on disadvantage name
	 * 
	 * @param {object} rows         Rows for setAttr() function. Pass by reference
	 * @param {string} name         Name of the quirk or perk
	 * @param {object} disadvantage object of perk or quirk
	 * 
	 * @returns {object}
	 */
	function getGcaValuesByDisadvantageName(rows, name, disadvantage) {
	
		let nameCheck = String(name).toLowerCase();
	
		switch (nameCheck) {
	
			case "appearance":
	
				if (disadvantage.points) {
					rows["appearance"] = disadvantage.points;
				}
	
				break;
	
			default:
				// do nothing
				break;
	
		}
	
	}
	
	/**
	 * Parses the level name for a GCA4 attribute
	 * Such as advantage, disadvantage, perk, and quirk
	 * 
	 * @param {object} attribute    JSON object for GCA4 attribute: advantage, disadvantage, etc.
	 * @param {string} defaultValue Default value if no value is found
	 * 
	 * @returns {string}
	 */
	function getGcaLevelName(attribute, defaultValue = "") {
	
		let name = defaultValue;
	
		if (attribute && attribute.levelnames && attribute.levelnames.includes(",") && attribute.level) {
	
			// get rid of spaces between commas (seems to change from advantage to advantage)
			let levelNames = String(attribute.levelnames).replaceAll(", ", ",");
	
			let arrNames = levelNames.split(",");
	
			let level = Number(attribute.level);
	
			// NOTE: Appearance index needs to start at 1 so we can ignore "average"
			if (String(attribute.name).toLowerCase() !== "appearance" && String(attribute.name).toLowerCase() !== "wealth") {
				level = level - 1;
			}
	
			name = arrNames[level];
	
		}
	
		return name;
	
	}
	
	/**
	 * Import GCA4 Skills
	 * TODO: Add Update feature. Currently only does insert
	 *  
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      Json DATA from GCA4 file
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      A function to run after updating is complete
	 */
	function importGcaSkills(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let skills = getJsonArrayFromTrait(jsonData.Character.Traits.Skill);
	
		let rows = {};
	
		if (skills && skills.length) {
	
			skills.forEach(skill => {
	
				let name = skill.name;
	
				if (skill.type && !skill.type.includes("Tech")) {
	
					getGcaValuesForSkill(uniqueKeys, rows, name, skill, importNotes);
	
					getMeleeAttackFromGcaTrait(uniqueKeys, rows, skill, importNotes);
	
					getRangedAttackFromGcaTrait(uniqueKeys, rows, skill, importNotes);
	
					getDefenseFromGcaTrait(uniqueKeys, rows, skill);
	
				}
	
			});
	
		}
	
		setAttrs(rows, null, callback);
	
	}
	
	/**
	 * Get values for repeating skill
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Rows for setAttr() function. Passed by reference
	 * @param {string}  name        Name of the skill
	 * @param {object}  skill       object for skill
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getGcaValuesForSkill(uniqueKeys, rows, name, skill, importNotes) {
	
		let idkey = skill.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let fullName = name;
	
		let baseFieldName = `repeating_skills_${rowId}`;
	
		let levelName;
	
		if (skill.nameext) {
	
			fullName += ` (${skill.nameext})`;
	
		}
	
		if (skill.levelnames) {
	
			levelName = getGcaLevelName(skill);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		let points = 0;
	
		if (skill.points) {
			points = Number(skill.points);
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_points`] = points;
	
		if (skill.page) {
			rows[`${baseFieldName}_ref`] = skill.page;
		}
	
		if (skill.tl) {
			rows[`${baseFieldName}_tl`] = skill.tl;
		}
	
		let [attributeValue, difficultyValue] = getSkillAttributeDifficultyForGca(skill.type);
	
		rows[`${baseFieldName}_base`] = attributeValue;
	
		rows[`${baseFieldName}_difficulty`] = difficultyValue;
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getGcaNotesForSkillTechnique(skill);
		}
	
		// check for modifiers
		if (skill.level && skill.baselevel) {
	
			let skillLevel = Number(skill.level);
	
			let baseSkillLevel = Number(skill.baselevel);
	
			if (skillLevel !== baseSkillLevel) {
	
				let skillMod = skillLevel - baseSkillLevel;
	
				rows[`${baseFieldName}_bonus`] = skillMod;
	
			}
		}
	
	}
	
	/**
	 * Returns an array of attribute and difficulty drop-down values
	 * 
	 * @param {string} skillType Skill type: attribute/difficulty level
	 * 
	 * @returns {[string, string]} An array of [attributeValue: string, difficultyValue: number]
	 */
	function getSkillAttributeDifficultyForGca(skillType) {
	
		// type = DX/A
		let arrType = String(skillType).split("/");
	
		let attribute = arrType[0];
	
		let difficulty = arrType[1];
	
		let attributeValue;
	
		let difficultyValue;
	
		switch (attribute) {
	
			case "ST":
				attributeValue = "@{strength}";
				break;
	
			case "DX":
				attributeValue = "@{dexterity}";
				break;
	
			case "IQ":
				attributeValue = "@{intelligence}";
				break;
	
			case "HT":
				attributeValue = "@{health}";
				break;
	
			case "Will":
				attributeValue = "@{willpower}";
				break;
	
			case "Per":
				attributeValue = "@{perception}";
				break;
	
			default:
				attributeValue = "@{dexterity}";
				break;
	
		}
	
		switch (difficulty) {
	
			case "E":
				difficultyValue = "-1";
				break;
	
			case "A":
				difficultyValue = "-2";
				break;
	
			case "H":
				difficultyValue = "-3";
				break;
	
			case "VH":
				difficultyValue = "-4";
				break;
	
			case "WC":
				difficultyValue = "-5 + 1";
				break;
	
			default:
				difficultyValue = "-2";
				break;
		}
	
		return [attributeValue, difficultyValue];
	
	}
	
	/**
	 * Get any additional notes for skill/technique
	 * 
	 * @param {object}  skillOrTechnique JSON object for skill or technique
	 * @param {boolean} useBasedOn       If true, include basedon notes.
	 * 
	 * @returns {string}
	 */
	function getGcaNotesForSkillTechnique(skillOrTechnique, useBasedOn = true) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (useBasedOn && skillOrTechnique.basedon && skillOrTechnique.basedon != skillOrTechnique.name) {
			arrNotes.push("Based On: " + skillOrTechnique.basedon + "\n");
		}
	
		if (skillOrTechnique.usernotes) {
			arrNotes.push(skillOrTechnique.usernotes + "\n");
		}
	
		if (skillOrTechnique.description) {
			arrNotes.push(skillOrTechnique.description + "\n");
		}
	
		if (skillOrTechnique.gives) {
			arrNotes.push("Gives: " + skillOrTechnique.gives + "\n");
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	
	}
	
	/**
	 * Import GCA4 Techniques
	 * TODO: Add Update feature. Currently only does insert
	 *  
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      Json DATA from GCA4 file
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      A function to run after updating is complete
	 */
	function importGcaTechniques(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let skills = getJsonArrayFromTrait(jsonData.Character.Traits.Skill);
	
		let rows = {};
	
		if (skills && skills.length) {
	
			skills.forEach(skill => {
	
				let name = skill.name;
	
				if (skill.type && skill.type.includes("Tech")) {
	
					getGcaValuesForTechniques(uniqueKeys, rows, name, skill, skills, importNotes);
	
					getMeleeAttackFromGcaTrait(uniqueKeys, rows, skill, importNotes);
	
					getRangedAttackFromGcaTrait(uniqueKeys, rows, skill, importNotes);
	
					getDefenseFromGcaTrait(uniqueKeys, rows, skill);
	
				}
	
			});
	
		}
	
		setAttrs(rows, null, callback);
	
	}
	
	/**
	* Get values for repeating skill techniques
	* 
	* @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	* @param {object}  rows        Rows for setAttr() function. passed by reference
	* @param {string}  name        Name of the skill
	* @param {object}  skill       object for skill
	* @param {object}  skills      All the json skills from GCA4
	* @param {boolean} importNotes Option to also import notes.
	*/
	function getGcaValuesForTechniques(uniqueKeys, rows, name, skill, skills, importNotes) {
	
		let idkey = skill.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let fullName = name;
	
		let baseFieldName = `repeating_techniquesrevised_${rowId}`;
	
		let points = 0;
	
		if (skill.points) {
			points = Number(skill.points);
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_points`] = points;
	
		if (skill.page) {
			rows[`${baseFieldName}_ref`] = skill.page;
		}
	
		// NOTE: attributeValue is not needed, it just identifies the skill as a technique
		let difficultyValue = getTechniqueDifficultyFromGca(skill.type);
	
		rows[`${baseFieldName}_default`] = getGcaTechniqueDefaultValue(skill);
	
		rows[`${baseFieldName}_max_modifier`] = getGcaTechniqueMaxValue(skill);
	
		let baseSkill = getGcaTechniqueBaseSkillInfo(skill, skills);
	
		if (baseSkill) {
	
			let parentName = baseSkill.name;
	
			if (baseSkill.nameext) {
				parentName += ` (${baseSkill.nameext})`;
			}
	
			rows[`${baseFieldName}_parent`] = parentName;
	
			rows[`${baseFieldName}_base_level`] = baseSkill.level;
	
		}
	
		rows[`${baseFieldName}_difficulty`] = difficultyValue;
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getGcaNotesForSkillTechnique(skill, false);
		}
	
	}
	
	/**
	 * Parses the default value of a technique
	 * 
	 * @param {object} skill JSON object for skill
	 * 
	 * @returns {number}
	 */
	function getGcaTechniqueDefaultValue(skill) {
	
		// example: "default": "\"SK:Brawling::level\" - 1",
		let techDefault = "";
	
		if (skill.default) {
			techDefault = skill.default;
		}
	
		let arrDefault;
	
		let defaultValue = 0;
	
		if (techDefault && techDefault.includes(" - ")) {
	
			arrDefault = techDefault.split(" - ");
	
			defaultValue = -1 * Number(arrDefault[1]);
	
		} else if (techDefault && techDefault.includes(" + ")) {
	
			arrDefault = techDefault.split(" + ");
	
			defaultValue = Number(arrDefault[1]);
	
		}
	
		return defaultValue;
	}
	
	/**
	 * Parses upto field to determine max value modifier
	 * 
	 * @param {object} skill JSON object for skill
	 * 
	 * @returns {number}
	*/
	function getGcaTechniqueMaxValue(skill) {
	
		// example: "upto": "prereq + 4",
		let upto = "";
	
		if (skill.upto) {
			upto = skill.upto;
		}
	
		let arrUpto;
	
		let maxValue = 0;
	
		if (upto && upto.includes(" - ")) {
	
			arrUpto = upto.split(" - ");
	
			maxValue = -1 * Number(arrUpto[1]);
	
		} else if (upto && upto.includes(" + ")) {
	
			arrUpto = upto.split(" + ");
	
			maxValue = Number(arrUpto[1]);
	
		}
	
		return maxValue;
	
	}
	
	/**
	 * Tries to find the base skill for technique
	 * returns matching skill object
	 * 
	 * @param {object} skill  Skill technique to find base skill for
	 * @param {object} skills A list of skills from GCA4
	 * 
	 * @returns {object} baseSkill
	 */
	function getGcaTechniqueBaseSkillInfo(skill, skills) {
	
		let baseSkill;
	
		skills.forEach(searchSkill => {
	
			if (searchSkill.IDKey.trim() === skill.deffromid.trim()) {
				baseSkill = searchSkill;
			}
	
		});
	
		return baseSkill;
	}
	
	/**
	 * Get the difficulty level of technique
	 * 
	 * @param {string} skillType skill type. example: Tech/A
	 */
	function getTechniqueDifficultyFromGca(skillType) {
	
		let difficulty = "Average";
	
		if (skillType === "Tech/H") {
			difficulty = "Hard";
		}
	
		return difficulty;
	
	}
	
	/**
	 * Import GCA4 Equipment 
	 * TODO: Add ability to update existing equipment
	 * 
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      GCA4 JSON data
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      Function to run after importing
	 */
	function importGcaEquipment(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let items = getJsonArrayFromTrait(jsonData.Character.Traits.Equipment);
	
		let rows = {};
	
		if (items && items.length) {
	
			items.forEach(item => {
	
				let name = item.name;
	
				getGcaValuesForEquipment(uniqueKeys, rows, name, item, importNotes);
	
				getMeleeAttackFromGcaTrait(uniqueKeys, rows, item, importNotes);
	
				getRangedAttackFromGcaTrait(uniqueKeys, rows, item, importNotes);
	
				getDefenseFromGcaTrait(uniqueKeys, rows, item);
	
			});
	
		}
	
		setAttrs(rows, null, callback);
	
	}
	
	/**
	 * Get the row values for GCA4 equipment
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object for updating repeating table. passed by reference
	 * @param {string}  name        Name of equipment
	 * @param {object}  item        JSON object of equipment
	 * @param {boolean} importNotes Option to also import notes.
	 */
	function getGcaValuesForEquipment(uniqueKeys, rows, name, item, importNotes) {
	
		let idkey = item.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let fullName = name;
	
		let baseFieldName = `repeating_item_${rowId}`;
	
		if (item.nameext) {
	
			fullName += ` (${item.nameext})`;
	
		}
	
		if (item.levelnames) {
	
			let levelName = getGcaLevelName(item);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		if (item.location) {
			rows[`${baseFieldName}_location`] = item.location;
		}
	
		if (item.techlvl) {
			rows[`${baseFieldName}_tl`] = item.techlvl;
		}
	
		if (item.lc) {
			rows[`${baseFieldName}_legality_class`] = item.lc;
		}
	
		if (item.page) {
			rows[`${baseFieldName}_ref`] = item.page;
		}
	
		if (item.count) {
			rows[`${baseFieldName}_count`] = Number(item.count);
		}
	
		if (item.basecost) {
			let cost = Number(item.basecost);

			// round to 2 decimal places
			cost = Number(Math.round(cost * 100) / 100).toFixed(2);

			rows[`${baseFieldName}_cost`] = cost;
		}
	
		if (item.baseweight) {
			let weight = Number(item.baseweight);

			// round to 3 decimal places
			weight = Number(Math.round(weight * 100) / 100).toFixed(3);

			rows[`${baseFieldName}_weight`] = weight;
		}
	
		if (importNotes) {
			rows[`${baseFieldName}_notes`] = getGcaNotesForEquipment(item);
		}
	
	}
	
	/**
	 * Get any additional notes for equipment
	 * 
	 * @param {object} item JSON object for item
	 *
	 * @returns {string}
	 */
	function getGcaNotesForEquipment(item) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (item.usernotes) {
			arrNotes.push(item.usernotes + "\n");
		}
	
		if (item.description) {
			arrNotes.push(item.description + "\n");
		}
	
		if (item.gives) {
			arrNotes.push("Gives: " + item.gives + "\n");
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	
	}
	
	/**
	 * Get any additional notes for template
	 * 
	 * @param {object} item JSON object for item
	 *
	 * @returns {string}
	 */
	function getGcaNotesForTemplate(item) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (item.gives) {
			arrNotes.push("Gives: " + item.gives + "\n");
		}
	
		if (item.features) {
			arrNotes.push("Features: " + item.features + "\n");
		}
	
		if (item.usernotes) {
			arrNotes.push(item.usernotes + "\n");
		}
	
		if (item.description) {
			arrNotes.push(item.description + "\n");
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	
	}
	
	/**
	 * Import GCA4 Spells 
	 * TODO: Add ability to update existing spells
	 * 
	 * @param {object}     uniqueKeys    Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}     jsonData      GCA4 JSON data
	 * @param {object}     runningTotals An object that keeps track of running totals. NOTE: passed by reference
	 * @param {boolean}    importNotes   Option to also import notes.
	 * @param {() => void} callback      Function to run after importing
	 */
	function importGcaSpells(uniqueKeys, jsonData, runningTotals, importNotes, callback) {
	
		// make sure we have a valid function
		callback = callback || noop;
	
		let spells = getJsonArrayFromTrait(jsonData.Character.Traits.Spell);
	
		let rows = {};
	
		getAttrs(["spell_bonus"], values => {
	
			let magery = Number(values.spell_bonus);
	
			if (spells && spells.length) {
	
				spells.forEach(spell => {
	
					let name = spell.name;
	
					getGcaValuesForSpell(uniqueKeys, rows, name, spell, magery, importNotes);
	
					getMeleeAttackFromGcaTrait(uniqueKeys, rows, spell, importNotes);
	
					getRangedAttackFromGcaTrait(uniqueKeys, rows, spell, importNotes);
	
					getDefenseFromGcaTrait(uniqueKeys, rows, spell);
	
				});
	
			}
	
			setAttrs(rows, null, callback);
	
		});
	
	}
	
	/**
	 * Get the row values for GCA4 Spell
	 * 
	 * @param {object}  uniqueKeys  Key values pairs for unique idkey and associated row id. Passed by reference
	 * @param {object}  rows        Object for updating repeating table. passed by reference
	 * @param {string}  name        Name of spell
	 * @param {object}  spell       JSON object of spell
	 * @param {number}  magery      Magery level of character
	 * @param {boolean} importNotes Option to also import notes.
	 * 
	 * @returns {object}
	 */
	function getGcaValuesForSpell(uniqueKeys, rows, name, spell, magery, importNotes) {
	
		let idkey = spell.IDKey.trim();
	
		let rowId = generateOrGetRowId(uniqueKeys, idkey);
	
		let fullName = name;
	
		let baseFieldName = `repeating_spells_${rowId}`;
	
		if (spell.nameext) {
	
			fullName += ` (${spell.nameext})`;
	
		}
	
		if (spell.levelnames) {
	
			let levelName = getGcaLevelName(spell);
	
			if (levelName) {
				fullName += ` (${levelName})`;
			}
	
		}
	
		rows[`${baseFieldName}_idkey`] = idkey;
	
		rows[`${baseFieldName}_name`] = fullName;
	
		rows[`${baseFieldName}_level`] = spell.level;
	
		rows[`${baseFieldName}_difficulty`] = getSpellDifficultyFromGca(spell.type);
	
		let spellModifier = 0;
	
		let spellBaseLevel = 0;
	
		if (spell.baselevel) {
	
			spellModifier = Number(spell.level) - (Number(spell.baselevel) + magery);
	
		}
	
		rows[`${baseFieldName}_spell_modifier`] = spellModifier;
	
		rows[`${baseFieldName}_points`] = Number(spell.points);
	
		let [spellClass, resistedby] = getSpellClassResistedByFromGca(spell);
	
		rows[`${baseFieldName}_spell_resisted_by`] = resistedby;
	
		rows[`${baseFieldName}_spell_class`] = spellClass;
	
		if (spell.duration) {
			rows[`${baseFieldName}_duration`] = spell.duration;
		}
	
		if (spell.castingcost) {
			rows[`${baseFieldName}_cost`] = spell.castingcost;
		}
	
		if (spell.time) {
			rows[`${baseFieldName}_casttime`] = spell.time;
		}
	
		if (spell.cat) {
			rows[`${baseFieldName}_spell_college`] = spell.cat;
		}
	
		if (importNotes) {
			rows[`${baseFieldName}_spell_notes`] = getSpellNotesFromGcaSpell(spell);
		}
	
		if (spell.ref) {
	
			rows[`${baseFieldName}_ref`] = spell.page;
	
		}
	
	}
	
	/**
	 * Get the spell difficulty based on spell type
	 * 
	 * @param {string} spellType Spell Type: IQ/H | IQ/VH
	 * 
	 * @returns {number}
	 */
	function getSpellDifficultyFromGca(spellType) {
	
		let difficulty = -3;
	
		if (spellType === "IQ/VH") {
			difficulty = -4;
		}
	
		return difficulty;
	}
	
	/**
	 * Get the spell's class and resisted by (if any)
	 * from spell.class property
	 * 
	 * @param {object} spell GCA4 Spell JSON object
	 * 
	 * @returns {[string, string]} An array of [spellClass: string, resistedby: string]
	 */
	function getSpellClassResistedByFromGca(spell) {
	
		let spellClass;
	
		let resistedby = "";
	
		// example: "class": "Regular/R-HT",
		if (spell.class && spell.class.includes("/R-")) {
	
			let arrClass = spell.class.split("/R-");
	
			spellClass = String(arrClass[0]);
	
			resistedby = arrClass[1];
	
		} else {
	
			spellClass = String(spell.class);
	
		}
	
		return [spellClass, resistedby];
	}
	
	/**
	 * Compiles spell notes from GCA4 Spell object
	 * 
	 * @param {object} spell GCA4 spell object
	 * 
	 * @returns {string}
	 */
	function getSpellNotesFromGcaSpell(spell) {
	
		let arrNotes = [];
	
		let notes = "";
	
		if (spell.usernotes) {
			arrNotes.push(spell.usernotes + "\n");
		}
	
		if (spell.description) {
			arrNotes.push(spell.description + "\n");
		}
	
		if (spell.needs) {
			arrNotes.push("Needs: " + spell.needs + "\n");
		}
	
		if (spell.gives) {
			arrNotes.push("Gives: " + spell.gives + "\n");
		}
	
		if (arrNotes.length) {
			notes = arrNotes.join("\n");
		}
	
		return notes;
	
	}
	
	/*** MODIFIER PROMPT OPTIONS ***/
	
	// if roll option in header changes, update the sheet option
	on("change:roll_option_header", event => {
	
		getAttrs(["roll_option_header"], values => {
	
			let option = values.roll_option_header;
	
			setAttrs({ roll_option: option });
	
		});
	
	});
	
	// check for roll options and changes to custom roll macro
	on("change:custom_roll_macro change:roll_option", event => {
	
		getAttrs(["roll_option", "custom_roll_macro"], values => {
	
			let rollOption = values.roll_option;
	
			rollOption = rollOption.trim();
	
			let customMacro = values.custom_roll_macro;
	
			customMacro = customMacro.trim();
	
			let rollMacro = "";
	
			if (rollOption === "deprecated") {
	
				rollMacro = "/w gm --l ";
	
			} else if (rollOption === "private") {
	
				rollMacro = "/w gm ";
	
			} else if (rollOption === "custom") {
	
				rollMacro = customMacro;
	
			}
	
			setAttrs({ roll: rollMacro }, { silent: true }, () => {
	
				setAttrs({ roll_option_header: rollOption });
	
			});
	
		});
	
	});
	
	/**
	 * Needed to add a new attr_roll_option to handle
	 * a custom roll macro. This code makes sure the 
	 * correct roll option is selected when the sheet opens.
	 */
	function syncRollOptions() {
	
		getAttrs(["roll"], values => {
	
			let rollValue = String(values.roll);
	
			let rollOption = "";
	
			rollValue = rollValue.trim();
	
			if (rollValue === "") {
				rollOption = "public";
			} else if (rollValue === "/w gm --l") {
				rollOption = "deprecated";
			} else if (rollValue === "/w gm") {
				rollOption = "private";
			} else {
				rollOption = "custom";
			}
	
			setAttrs({ roll_option: rollOption, roll_option_header: rollOption }, { silent: true });
	
		});
	
	}
	
	/*** MODIFIER PROMPT OPTIONS ***/
	
	// if modifier option in header changes, update the sheet option
	on("change:modifier_option_header", event => {
	
		getAttrs(["modifier_option_header"], values => {
	
			updateModifierPromptValues(values.modifier_option_header);
	
		});
	
	});
	
	// check for modifier options
	on("change:modifier_option", event => {
	
		getAttrs(["modifier_option"], values => {
	
			updateModifierPromptValues(values.modifier_option);
	
		});
	
	});
	
	/**
	 * Sync the values for modifier, modifier_option,
	 * and modifier_option_header if a new prompt option is selected
	 * 
	 * @param {string} option Values: 0 = no, 1 = single, 2 = extended
	 */
	function updateModifierPromptValues(option) {
	
		// no prompt
		let promptMacro = "0";
	
		if (option === "1") {
	
			// single prompt
			promptMacro = "[[?{Modifier|0}]]";
	
		} else if (option === "2") {
	
			// extended prompt
			promptMacro = "[[?{Modifier|0}]] +[[?{Shock|0}]] + [[?{Reeling or Staggered|0}]] + [[?{Off-Hand|0}]] + [[?{Familiarity|0}]]";
	
		}
	
		setAttrs({
			modifier: promptMacro,
			modifier_option: option,
			modifier_option_header: option
		}, { silent: true });
	
	}
	
	/**
	 * Needed to add a new attr_modifier_option to handle
	 * skill modifier prompts. This code makes sure the 
	 * correct roll option is selected when the sheet opens.
	 */
	function syncModifierPromptOptions() {
	
		getAttrs(["modifier"], values => {
	
			let modValue = values.modifier;
	
			let option = "0";
	
			modValue = modValue.trim();
	
			// check for old modifier prompt values and fix
			if (modValue === "?{Modifier|0}") {
	
				modValue = "[[?{Modifier|0}]]";
	
			} else if (modValue === "?{Modifier|0} + ?{Shock|0} + ?{Reeling or Staggered|0} + ?{Off-Hand|0} + ?{Familiarity|0}") {
	
				modValue = "[[?{Modifier|0}]] +[[?{Shock|0}]] + [[?{Reeling or Staggered|0}]] + [[?{Off-Hand|0}]] + [[?{Familiarity|0}]]";
	
			}
	
			if (modValue === "[[?{Modifier|0}]]") {
				option = "1";
			} else if (modValue === "[[?{Modifier|0}]] +[[?{Shock|0}]] + [[?{Reeling or Staggered|0}]] + [[?{Off-Hand|0}]] + [[?{Familiarity|0}]]") {
				option = "2";
			}
	
			setAttrs({
				modifier: modValue,
				modifier_option: option,
				modifier_option_header: option
			}, { silent: true });
	
		});
	
	}

	// check to see if we need to update slam hit points
	on("change:hit_points_max", (event) => {

		updateSlamHitPoints();

	});

	function updateSlamHitPoints() {

		getAttrs(["hit_points_max"], values => {

			let hitPoints = Number(values.hit_points_max);

			if (Number.isNaN(hitPoints)) {
				hitPoints = 10;
			}

			const slamST = Math.floor(hitPoints/2);

			// get the damageType object (strength, thrust, swing)
			let damageType = getDamageType(slamST);
	
			setAttrs({
				slam_hit_points: hitPoints,
				falling_hit_points: hitPoints,
				collision_hit_points: hitPoints,
				slam_overrun_st: slamST,
				slam_overrun_damage: damageType.thrust
			});

		});

	}

	// check for slam modifier skill change
	on("change:slam_link_type change:slam_skill_row_id", event => {
	
		updateLinkedSlamSkill(null);

	});

	function updateLinkedSlamSkill(callback) {

		// check if we need to set default value
		callback = callback || noop;

		getAttrs(["slam_link_type", "slam_skill_row_id", "slam_skill_modifier"], values => {

			let rowType = values.slam_link_type;
	
			let skillRowId = values.slam_skill_row_id;
	
			let skillMod = +values.slam_skill_modifier;
	
			let { updateMethod, repeatingTableToUse } = getLinkedSkillUpdateMethod(rowType);
	
			let skillName = "";
	
			let skillLevel = "";
	
			let updateFields = {};
	
			// if updating using a repeating field AND no row id, clear the fields
			if (updateMethod == "nothing" || (updateMethod != "attribute" && skillRowId.length === 0)) {
	
				updateFields["slam_skill_row_id_message"] = "";
	
				updateFields["slam_skill_row_id_level"] = "";
	
				setAttrs(updateFields, null, callback);
	
			} else if (updateMethod == "attribute") {
	
				updateLinkedSlamSkillByAttribute(rowType, callback);
	
			} else {
	
				updateLinkedSlamSkillByTable(repeatingTableToUse, skillRowId, rowType, callback);
	
			}

		});
		
	}

	/**
	 * Update the linked slam skill by using an attribute stat
	 *
	 * @param {string}      rowType  The attribute to use for setting weapon skill level
	 * @param {() => void=} callback Callback function 
	 */
	 function updateLinkedSlamSkillByAttribute(rowType, callback) {
		callback = callback || noop;
	
		let fieldName;
	
		switch (rowType) {
			case "DX":
				fieldName = "dexterity";
				break;
	
			default:
				fieldName = null;
				break;
		}
	
		let skillLevel = "";

		let updateFields = {};

		if (fieldName) {

			// update the skill level for knockback save.
			getAttrs([fieldName], function (skillValues) {
				
				skillLevel = +skillValues[fieldName];

				updateFields["slam_skill_row_id_message"] = rowType;

				updateFields["slam_skill_row_id_level"] = skillLevel;

				setAttrs(updateFields, null, callback);

			});

		} else {

			updateFields["slam_skill_row_id_message"] = "";

			updateFields["slam_skill_row_id_level"] = "";

			setAttrs(updateFields, null, callback);

		}

	}

	/**
	 * Update the Slam based on a repeating item
	 *
	 * @param {string} repeatingTableToUse Name of table that contains the row id
	 * @param {string} skillRowId          The Row that has the information we need for name and skill level to use
	 * @param {string} rowType             Type of knockback defense
	 * @param {() => void=} callback       An optional call back function  
	 */
	 function updateLinkedSlamSkillByTable(repeatingTableToUse, skillRowId, rowType, callback) {
		// if it's a good row id, let's update stuff
		let skillFieldName = `${repeatingTableToUse}_${skillRowId}_level`;
	
		let skillFieldNameOfSkill = `${repeatingTableToUse}_${skillRowId}_name`;
	
		// update the skill level for weapon.
		getAttrs([skillFieldName, skillFieldNameOfSkill], function (skillValues) {
	
			let skillLevel = +skillValues[skillFieldName];
	
			let updateFields = {};
	
			// check for valid skill level
			if (skillLevel > 0) {
	
				updateFields["slam_skill_row_id_message"] = skillValues[skillFieldNameOfSkill];
	
				updateFields["slam_skill_row_id_level"] = skillLevel;
	
				setAttrs(updateFields, null, callback);
	
			} else {
	
				// show an error message
				updateFields["slam_skill_row_id_message"] = `Could not find ${rowType}.`;
	
				setAttrs(updateFields, { silent: true }, callback);
	
			}
	
		});
	}

	/**
	 * Checks to see if the slam skill is linked to this rowId
	 *
	 * @param {string} rowId Row ID of a skill or the Attribute that might be linked to a weapon
	 */
	function updateSlamLinkedToRow(rowId) {
	
		let fields = ["slam_row_type", "slam_skill_row_id"];

		getAttrs(fields, values => {

			let updateFields = {};

			// convert the values object into an array
			let entries = Object.entries(values);

			// loop through each entry
			for (const [field, value] of entries) {

				// NOTE: This match based on either skill/technique ID or against an attribute
				// the field name lets us know which.
				if (value == rowId) {

					updateLinkedSlamSkill();

					break; // we found a match, no reason to continue

				}

			}

		});

	}

	on("change:slam_skill_row_id_level change:slam_skill_modifier", (event) => {

		updateSlamSkill();

	});

	function updateSlamSkill() {

		let fields = ["slam_skill_row_id_level", "slam_skill_modifier", "slam_skill_level"];

		getAttrs(fields, values => {

			let selectedSkillLevel = Number(values.slam_skill_row_id_level);

			let skillModifier = Number(values.slam_skill_modifier);

			let currentSkillLevel = Number(values.slam_skill_level);

			if (isNaN(skillModifier)) {
				skillModifier = 0;
			}

			if (isNaN(currentSkillLevel)) {
				currentSkillLevel = 0;
			}

			let finalSkillLevel = 0;

			if (isNaN(selectedSkillLevel)) {

				// if they didn't use a selectedSkill then use the current skill level
				finalSkillLevel = currentSkillLevel + skillModifier;

			} else {

				// otherwise use the selectedSkillLevel (such as linked to DX, Skill, or Technique)
				finalSkillLevel = selectedSkillLevel + skillModifier;
			}

			let updateFields = {
				slam_skill_level: finalSkillLevel
			};

			setAttrs(updateFields, { silent: true });

		});

	}

	// handle slam damage
	on("change:slam_velocity change:slam_hit_points change:slam_shield_db change:slam_damage_divisor", function (event) {
	
		let strDmg = "";
	
		getAttrs(["slam_velocity", "slam_hit_points", "slam_shield_db", "slam_damage_divisor"], function (values) {
	
			const hitPoints = Number(values.slam_hit_points);

			const shieldDamageBonus = Number(values.slam_shield_db);

			const customDamageModifier = shieldDamageBonus;
	
			const isHardObject = false;

			const damageDivisor = Number(values.slam_damage_divisor) ?? 1;
	
			strDmg = getCollisionDamage(values.slam_velocity, hitPoints, customDamageModifier, damageDivisor);
	
			setAttrs({
				slam_damage: strDmg
			});
	
		});
	
	});

	on("change:slam_flying_tackle change:slam_pounce", (event) => {

		const triggerName = event.triggerName;

		getAttrs(["slam_flying_tackle", "slam_pounce"], values => {

			let modifier = 0;

			if (values.slam_flying_tackle === "1" || values.slam_pounce === "1") {
				modifier = 4;
			}

			let modifierDescription = "";

			let flyingTackleChecked = "0";

			let pounceChecked = "0";

			// TODO: Convert to use translation code
			if (triggerName == "slam_flying_tackle" && values.slam_flying_tackle === "1") {
				flyingTackleChecked = "1";
				pounceChecked = "0";
				modifierDescription = "+4 to hit from flying tackle. Fall prone next to target.";
			} else if (triggerName == "slam_pounce" && values.slam_pounce === "1") {
				flyingTackleChecked = "0";
				pounceChecked = "1";
				modifierDescription = "+4 to hit from pounce. Make a DX, Acrobatics, or Jumping roll to stay on feet.";
			}

			setAttrs({
				slam_option_modifier_value: modifier,
				slam_option_modifier_description: modifierDescription,
				slam_flying_tackle: flyingTackleChecked,
				slam_pounce: pounceChecked
			}, { silent: true });

		});

	});

	// when button is clicked, show the updates tab
	on("clicked:wound_notes_reset", event => {

		resetWoundModifierNotes();

	});

	function resetWoundModifierNotes() {

		const woundNotesCutting = getNotesByCode("wound_notes_cutting");
		const woundNotesImpaling = getNotesByCode("wound_notes_impaling");
		const woundNotesCrushing = getNotesByCode("wound_notes_crushing");
		const woundNotesPiercingMinus = getNotesByCode("wound_notes_piercing_minus");
		const woundNotesPiercing = getNotesByCode("wound_notes_piercing");
		const woundNotesPiercingPlus = getNotesByCode("wound_notes_piercing_plus");
		const woundNotesPiercingPlusPlus = getNotesByCode("wound_notes_piercing_plus_plus");
		const woundNotesAffliction = getNotesByCode("wound_notes_affliction");
		const woundNotesBurn = getNotesByCode("wound_notes_burn");
		const woundNotesCorrosion = getNotesByCode("wound_notes_corrosion");
		const woundNotesFatigue = getNotesByCode("wound_notes_fatigue");
		const woundNotesToxic = getNotesByCode("wound_notes_toxic");
		const woundNotesSpecial = getNotesByCode("wound_notes_special");
		const woundNotesKnockback = getNotesByCode("wound_notes_knockback");

		const attribs = {
			damage_type_note_cut: woundNotesCutting,
			damage_type_note_imp: woundNotesImpaling,
			damage_type_note_cr: woundNotesCrushing,
			damage_type_note_pi_minus: woundNotesPiercingMinus,
			damage_type_note_pi: woundNotesPiercing,
			damage_type_note_pi_plus: woundNotesPiercingPlus,
			damage_type_note_pi_plus_plus: woundNotesPiercingPlusPlus,
			damage_type_note_aff: woundNotesAffliction,
			damage_type_note_burn: woundNotesBurn,
			damage_type_note_cor: woundNotesCorrosion,
			damage_type_note_fat: woundNotesFatigue,
			damage_type_note_tox: woundNotesToxic,
			damage_type_note_spec: woundNotesSpecial,
			damage_type_note_knockback: woundNotesKnockback
		};

		setAttrs(attribs);

	}

	// reset success/fail notes for spells
	// when button is clicked, show the updates tab
	on("clicked:spell_notes_reset", event => {

		resetSpellRollNotes();

	});

	const resetSpellRollNotes = () => {

		const spellCriticalSuccessNotes = getNotesByCode("spell_critical_success_notes");

		const spellFailNotes = getNotesByCode("spell_fail_notes");

		const spellCriticalFailureNotes = getNotesByCode("spell_critical_failure_notes");

		const notesToUpdate = {
			spell_critical_success_notes: spellCriticalSuccessNotes,
			spell_fail_notes: spellFailNotes,
			spell_critical_failure_notes: spellCriticalFailureNotes
		}

		setAttrs(notesToUpdate);
		
	}

	// reset fright check notes
	on("clicked:fright_check_notes_reset", event => {

		resetFrightCheckRollNotes();

	});

	const resetFrightCheckRollNotes = () => {

		const frightCheckSuccessNotes = getNotesByCode("fright_check_success_notes");

		const frightCheckFailNotes = getNotesByCode("fright_check_fail_notes");

		const frightCheckCriticalSuccessNotes = getNotesByCode("fright_check_critical_success_notes");

		const frightCheckCriticalFailureNotes = getNotesByCode("fright_check_critical_failure_notes");

		const notesToUpdate = {
			fright_check_success_notes: frightCheckSuccessNotes,
			fright_check_fail_notes: frightCheckFailNotes,
			fright_check_critical_success_notes: frightCheckCriticalSuccessNotes,
			fright_check_critical_failure_notes: frightCheckCriticalFailureNotes
		}

		setAttrs(notesToUpdate);

	}

	// reset unstun/recover from physical stun check notes
	on("clicked:unstun_check_notes_reset", event => {

		resetUnstunCheckRollNotes();

	});

	const resetUnstunCheckRollNotes = () => {

		const unstunCheckSuccessNotes = getNotesByCode("unstun_check_success_notes");

		const unstunCheckFailNotes = getNotesByCode("unstun_check_fail_notes");

		const unstunCheckCriticalSuccessNotes = getNotesByCode("unstun_check_critical_success_notes");

		const unstunCheckCriticalFailureNotes = getNotesByCode("unstun_check_critical_failure_notes");

		const notesToUpdate = {
			unstun_check_success_notes: unstunCheckSuccessNotes,
			unstun_check_fail_notes: unstunCheckFailNotes,
			unstun_check_critical_success_notes: unstunCheckCriticalSuccessNotes,
			unstun_check_critical_failure_notes: unstunCheckCriticalFailureNotes
		}

		setAttrs(notesToUpdate);

	}

	// reset knockdown/stun check notes
	on("clicked:knockdown_check_notes_reset", event => {

		resetKnockdownCheckRollNotes();

	});

	const resetKnockdownCheckRollNotes = () => {

		const knockdownCheckSuccessNotes = getNotesByCode("knockdown_check_success_notes");

		const knockdownCheckFailNotes = getNotesByCode("knockdown_check_fail_notes");

		const knockdownCheckCriticalSuccessNotes = getNotesByCode("knockdown_check_critical_success_notes");

		const knockdownCheckCriticalFailureNotes = getNotesByCode("knockdown_check_critical_failure_notes");

		const notesToUpdate = {
			knockdown_check_success_notes: knockdownCheckSuccessNotes,
			knockdown_check_fail_notes: knockdownCheckFailNotes,
			knockdown_check_critical_success_notes: knockdownCheckCriticalSuccessNotes,
			knockdown_check_critical_failure_notes: knockdownCheckCriticalFailureNotes
		}

		setAttrs(notesToUpdate);

	}

	// reset unconscious check notes
	on("clicked:unconscious_check_notes_reset", event => {

		resetUnconsciousCheckRollNotes();

	});

	const resetUnconsciousCheckRollNotes = () => {

		const unconsciousCheckSuccessNotes = getNotesByCode("unconscious_check_success_notes");

		const unconsciousCheckFailNotes = getNotesByCode("unconscious_check_fail_notes");

		const unconsciousCheckCriticalSuccessNotes = getNotesByCode("unconscious_check_critical_success_notes");

		const unconsciousCheckCriticalFailureNotes = getNotesByCode("unconscious_check_critical_failure_notes");

		const notesToUpdate = {
			unconscious_check_success_notes: unconsciousCheckSuccessNotes,
			unconscious_check_fail_notes: unconsciousCheckFailNotes,
			unconscious_check_critical_success_notes: unconsciousCheckCriticalSuccessNotes,
			unconscious_check_critical_failure_notes: unconsciousCheckCriticalFailureNotes
		}

		setAttrs(notesToUpdate);

	}

	// reset death check notes
	on("clicked:death_check_notes_reset", event => {

		resetDeathCheckRollNotes();

	});

	const resetDeathCheckRollNotes = () => {

		const deathCheckSuccessNotes = getNotesByCode("death_check_success_notes");

		const deathCheckFailNotes = getNotesByCode("death_check_fail_notes");

		const deathCheckCriticalSuccessNotes = getNotesByCode("death_check_critical_success_notes");

		const deathCheckCriticalFailureNotes = getNotesByCode("death_check_critical_failure_notes");

		const notesToUpdate = {
			death_check_success_notes: deathCheckSuccessNotes,
			death_check_fail_notes: deathCheckFailNotes,
			death_check_critical_success_notes: deathCheckCriticalSuccessNotes,
			death_check_critical_failure_notes: deathCheckCriticalFailureNotes
		}

		setAttrs(notesToUpdate);

	}

	// resync character sheet
	on("clicked:resync", event => {
	
		setAttrs({resync_state: "clicked"}, () => {

			resyncRepeatingSkills();

			resyncRepeatingTechniques();

			resyncRepeatingItems();

			resyncRepeatingSpells();

			totalAttributeCharacterPoints();

			updateRacialCharacterPoints();

			updateTechLevelPoints();

			updateLanguagePoints();

			resetResyncButtonSate();

		});

	});

	let resetResyncButtonSate = () => {

		setTimeout(() => {

			setAttrs({resync_state: "normal"});

		}, 1000);
		
	}

	/**
	 * Loop through each skill, set sync field = 1 (true)
	 * this forces the skill to recalculate the value.
	 */ 
	let resyncRepeatingSkills = () => {

		getSectionIDs("repeating_skills", ids => {

			// DEBUG: console.groupCollapsed("--resyncRepeatingSkills--");
		
			ids.forEach(rowId => {
				
				const syncFieldName = `repeating_skills_${rowId}_sync`;

				// force the value to 1, to resync the skill
				let attribs = {};

				attribs[syncFieldName] = 1;

				// DEBUG: console.info(`update linked items for rowId: ${rowId}`);
				// DEBUG: console.info(attribs);

				setAttrs(attribs, null, updateSectionSkillsLinkedToUpdatedRow(rowId));

			});

			
			console.groupEnd();

		});

	}

	/**
	 * Loop through each technique, set sync field = 1 (true)
	 * this forces the technique to recalculate the value.
	 */ 
	let resyncRepeatingTechniques = () => {

		getSectionIDs("repeating_techniquesrevised", ids => {

			// DEBUG: console.groupCollapsed("--resyncRepeatingTechniques--");

			ids.forEach(rowId => {
				
				const syncFieldName = `repeating_techniquesrevised_${rowId}_skill_row_id_toggle`;

				// force the value to 1, to resync the technique
				let attribs = {};

				attribs[syncFieldName] = 1;

				// DEBUG: console.info(`update linked items for rowId: ${rowId}`);
				
				setAttrs(attribs, null, updateSectionSkillsLinkedToUpdatedRow(rowId));

			});

			console.groupEnd();
		
		});

	}

	/**
	 * Recalculate the weight and value of all items. 
	 * Should NOT be run silent, so the totals can be calculated
	 */ 
	let resyncRepeatingItems = () => {

		getSectionIDs("repeating_item", ids => {

			console.info("--resyncRepeatingItems--");

			ids.forEach(rowId => {

				const countField = `repeating_item_${rowId}_count`;

				const costField = `repeating_item_${rowId}_cost`;

				const weightField = `repeating_item_${rowId}_weight`;

				const carriedField = `repeating_item_${rowId}_carried`;

				const totalWeightField = `repeating_item_${rowId}_weighttotal`;

				const totalCostField = `repeating_item_${rowId}_costtotal`; 

				const values = [
					countField,
					costField,
					weightField,
					carriedField
				];

				getAttrs(values, values => {

					const totalWeight = Number(Math.round(values[countField] * values[weightField] * values[carriedField] * 1000) / 1000).toFixed(3);

					const totalCost = Number(Math.round(values[countField] * values[costField] * 100) / 100).toFixed(2);

					let attribs = {};

					attribs[totalWeightField] = totalWeight;

					attribs[totalCostField] = totalCost;

					setAttrs(attribs);

				});

			});

		});

	}

	/**
	 * Loop through each spell, set sync field = 1 (true)
	 * this forces the spell to recalculate the value.
	 */ 
	let resyncRepeatingSpells = () => {

		getSectionIDs("repeating_spells", ids => {

			// DEBUG: console.groupCollapsed("--resyncRepeatingSpells--");

			ids.forEach(rowId => {
				
				const syncFieldName = `repeating_spells_${rowId}_sync`;

				// force the value to 1, to resync the skill
				let attribs = {};

				attribs[syncFieldName] = 1;

				// DEBUG: console.info(`update linked items for rowId: ${rowId}`);

				setAttrs(attribs, null, updateSectionSkillsLinkedToUpdatedRow(rowId));

			});

			
			console.groupEnd();

		});

	}

	// close roll modifiers, no updates
	on("clicked:import_json", async (event) => {
	
		let attribs = {
			import_json_state: "clicked",
			import_json_message: "Processing..."
		};

		await setAttrsAsync(attribs);

		await importCharacterJson();
	
	});

	on("clicked:import_delete_tables", async (event) => {

		const values = await getAttrsAsync(["import_confirm_delete_tables"]);

		const canDelete = values.import_confirm_delete_tables === "1";

		if (canDelete) {
			await clearRepeatingSectionAsync("repeating_languages");	
			await clearRepeatingSectionAsync("repeating_cultures");	
			await clearRepeatingSectionAsync("repeating_traits");	
			await clearRepeatingSectionAsync("repeating_perks");	
			await clearRepeatingSectionAsync("repeating_quirks");	
			await clearRepeatingSectionAsync("repeating_disadvantages");	
			await clearRepeatingSectionAsync("repeating_racial");	
			await clearRepeatingSectionAsync("repeating_skills");	
			await clearRepeatingSectionAsync("repeating_techniquesrevised");	
			await clearRepeatingSectionAsync("repeating_defense");	
			await clearRepeatingSectionAsync("repeating_melee");	
			await clearRepeatingSectionAsync("repeating_ranged");	
			await clearRepeatingSectionAsync("repeating_item");	
			await clearRepeatingSectionAsync("repeating_spells");
			setAttrsAsync({import_confirm_delete_tables: 0});	
		}

	});

	on("clicked:import_json_reset", (event) => {
	
		setAttrs({
			import_json_state: "normal",
			import_json_message: "Start Import",
			character_json_data: ""
		});
	
	});

	let importCharacterJson = async () => {

		let values = await getAttrsAsync(["character_json_data", "import_delete_tables"]);

		const deleteTables = values.import_delete_tables === "1";

		let data = String(values.character_json_data).trim();

		let success = true;

		let message = "";

		// schema file
		let character;

		if (data) {

			try {

				character = JSON.parse(data);
				
			} catch (ex) {
				
				success = false;

				message = "Invalid JSON Data. " + ex.message;

			}
		} else {

			success = false;

			message = "Please copy/paste JSON Data into text area.";

		}

		if (success) {

			// TODO: figure out async/await
			let uniqueKeys = await getUniqueKeysForCharacter();

			await importAttributes(character);

			await importRepeatingLanguages(character, uniqueKeys);

			await importRepeatingCultures(character, uniqueKeys);

			await importRepeatingTraits(character, uniqueKeys);

			await importRepeatingPerks(character, uniqueKeys);

			await importRepeatingQuirks(character, uniqueKeys);

			await importRepeatingDisadvantages(character, uniqueKeys);

			await importRepeatingRacial(character, uniqueKeys);

			await importRepeatingSkills(character, uniqueKeys);

			await importRepeatingTechniquesrevised(character, uniqueKeys);

			await importRepeatingDefense(character, uniqueKeys);

			await importRepeatingMelee(character, uniqueKeys);

			await importRepeatingRanged(character, uniqueKeys);

			await importRepeatingItem(character, uniqueKeys);

			await importRepeatingSpells(character, uniqueKeys);

			// very last attribute to get updated
			const applyCombatReflexes = character.CombatReflexes ? "1" : "0";

			await setAttrsAsync({combat_reflexes: applyCombatReflexes});

			// finally re-total attribute totals. 
			await totalAttributeCharacterPointsAsync();
			
			setAttrs({ 
				import_json_state: "normal",
				import_json_message: "Import has completed! Please wait a minute or two for Roll20 to finish processing the data.",
				character_json_data: ""
				});

		} else {

			setAttrs({ "import_json_message": message });

		}

	}

	/**
	 * Delete all rows from a repeating section
	 * 
	 * @param string table Example: repeating_item
	 * 
	 */
	let clearRepeatingSectionAsync = async (table) => {
	
		let ids = await getSectionIDsAsync(table);
		
		if (ids.length === 0) {
			return;
		}
		
		// loop through the rows
		for (let i = 0; i < ids.length; i++) {
	
			let rowId = ids[i];

			removeRepeatingRow(`${table}_${rowId}`);
		}

	}

	let getUniqueKeysForCharacter = async () => {

		let uniqueKeys = {};

		await getUniqueKeysByTableAsync("repeating_languages", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_cultures", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_traits", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_perks", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_quirks", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_disadvantages", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_racial", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_skills", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_techniquesrevised", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_defense", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_melee", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_ranged", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_item", uniqueKeys);

		await getUniqueKeysByTableAsync("repeating_spells", uniqueKeys);

		return uniqueKeys;

	}

	let getUniqueKeysByTableAsync = async (table, uniqueKeys) => {

		let ids = await getSectionIDsAsync(table);
		
		if (ids.length === 0) {
			return;
		}

		// get the idkey for each row.
		let fields = [];

		for (let i = 0; i < ids.length; i++) {

			fields.push(`${table}_${ids[i]}_idkey`);

		}

		let values = await getAttrsAsync(fields);

		// loop through each row
		for (let key in values) {

			let idkey;

			let rowId;

			if (values.hasOwnProperty(key)) {

				idkey = values[key];

				// get row id from the key name
				// example: repeating_melee_KEYHERE_idkey
				rowId = getRowIdFromRowFieldKey(key, table);

				if (idkey && rowId) {

					// add new key/value pair!
					uniqueKeys[idkey] = rowId;

				}

			}

		}

	}

	let importAttributes = async (character) => {

		const applySizeModifier = character.ApplySizeModifier ? "1" : "0";
		const flightChecked = character.FlightChecked ? "1" : "0";
		const amphibiousChecked = character.AmphibiousChecked ? "1" : "0";
		
		const baseAttributes = {
			fullname: character.CharacterName,
			playername: character.Playername,
			nickname: character.Nickname,
			race: character.Race,
			gender: character.Gender,
			size: parseInt(character.Size),
			apply_size_modifier: applySizeModifier,
			reactions: character.Reactions,
			campaign_tl: parseInt(character.CampaignTl),
			tl: parseInt(character.Tl),
			tl_pts: parseInt(character.TlPts),
			status: character.Status,
			wealth: character.Wealth,
			income: character.Income,
			cost_of_living: character.CostOfLiving,
			stash: character.Stash,
			age: character.Age,
			height: character.Height,
			weight: parseFloat(character.Weight),
			appearance: parseInt(character.Appearance),
			general_appearance: character.GeneralAppearance,
			strength_points: parseInt(character.StrengthPoints),
			dexterity_points: parseInt(character.DexterityPoints),
			intelligence_points: parseInt(character.IntelligencePoints),
			health_points: parseInt(character.HealthPoints)
		};

		const baseAttributeMods = {
			strength_mod: parseInt(character.StrengthMod),
			dexterity_mod: parseInt(character.DexterityMod),
			intelligence_mod: parseInt(character.IntelligenceMod),
			health_mod: parseInt(character.HealthMod),
		};

		const secondaryAttributesPoints = {
			perception_points: parseInt(character.PerceptionPoints),
			vision_points: parseInt(character.VisionPoints),
			hearing_points: parseInt(character.HearingPoints),
			taste_smell_points: parseInt(character.TasteSmellPoints),
			touch_points: parseInt(character.TouchPoints),
			willpower_points: parseInt(character.WillpowerPoints),
			fear_check_points: parseInt(character.FearCheckPoints),
			unconscious_check_points: parseInt(character.UnconsciousCheckPoints),
			death_check_points: parseInt(character.death_check_points),
			basic_speed_points: parseInt(character.BasicSpeedPoints),
			basic_move_points: parseInt(character.BasicMovePoints),
			enhanced_ground_move_points: parseInt(character.EnhancedGroundMovePoints),
			lift_st_points: parseInt(character.LiftStPoints),
			striking_st_points: parseInt(character.StrikingStPoints),
			hit_points_points: parseInt(character.HitPointsPoints),
			hit_points: parseInt(character.HitPoints),
			fatigue_points_points: parseInt(character.FatiguePointsPoints),
			fatigue_points: parseInt(character.FatiguePoints),
			flight_checked: flightChecked,
			flight_points: parseInt(character.FlightPoints),
			basic_air_move_points: parseInt(character.BasicAirMovePoints),
			enhanced_air_move_points: parseInt(character.EnhancedAirMovePoints),
			amphibious_checked: amphibiousChecked,
			amphibious_points: parseInt(character.AmphibiousPoints),
			basic_water_move_points: parseInt(character.BasicWaterMovePoints),
			enhanced_water_move_points: parseInt(character.EnhancedWaterMovePoints),
			super_jump_points: parseInt(character.SuperJumpPoints)
		};

		const secondaryAttributesMods = {
			perception_mod: parseInt(character.PerceptionMod),
			vision_mod: parseInt(character.VisionMod),
			hearing_mod: parseInt(character.HearingMod),
			taste_smell_mod: parseInt(character.TasteSmellMod),
			touch_mod: parseInt(character.TouchMod),
			willpower_mod: parseInt(character.WillpowerMod),
			fear_check_mod: parseInt(character.FearCheckMod),
			stun_check_mod: parseInt(character.StunCheckMod),
			knockdown_check_mod: parseInt(character.KnockdownCheckMod),
			unconscious_check_mod: parseInt(character.UnconsciousCheckMod),
			death_check_mod: parseInt(character.DeathCheckMod),
			basic_speed_mod: Number(character.BasicSpeedMod),
			basic_move_mod: parseInt(character.BasicMoveMod),
			enhanced_ground_move_mod: Number(character.EnhancedGroundMoveMod),
			dodge_mod: parseInt(character.DodgeMod),
			lift_st_mod: parseInt(character.LiftStMod),
			striking_st_mod: parseInt(character.StrikingStMod),
			hit_points_mod: parseInt(character.HitPointsMod),
			fatigue_points_mod: parseInt(character.FatiguePointsMod),
			basic_air_move_mod: parseInt(character.BasicAirMoveMod),
			enhanced_air_level: Number(character.EnhancedAirLevel),
			basic_water_move_mod: parseInt(character.BasicWaterMoveMod),
			enhanced_water_level: Number(character.EnhancedWaterLevel),
			super_jump_entered_level: parseInt(character.SuperJumpEnteredLevel),
			spell_bonus: parseInt(character.SpellBonus)
		};

		await setAttrsAsync(baseAttributes);

		await setAttrsAsync(baseAttributeMods);

		await setAttrsAsync(secondaryAttributesPoints);

		await setAttrsAsync(secondaryAttributesMods);

	}

	let importRepeatingLanguages = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingLanguages, async (language) => {

			let attributes = {};

			if (language.IsNative) {

				// use the non-repeating native language
				if (language.Idkey == null || language.Idkey == undefined) {
					attributes["native_language_idkey"] = "";
				} else {
					attributes["native_language_idkey"] = language.Idkey;
				}

				attributes["name_native_language"] = language.Name;

				attributes["native_language_spoken"] = parseInt(language.Spoken);

				attributes["native_language_written"] = parseInt(language.Written);

			} else {

				let rowId = generateOrGetRowId(uniqueKeys, language.Idkey);

				let baseFieldName = `repeating_languages_${rowId}`;
			
				attributes[`${baseFieldName}_idkey`] = language.Idkey;
	
				attributes[`${baseFieldName}_name`] = language.Name;
	
				attributes[`${baseFieldName}_spoken`] = parseInt(language.Spoken);

				attributes[`${baseFieldName}_written`] = parseInt(language.Written);

			}
			
			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingCultures = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingCultures, async (culture) => {
			
			let rowId = generateOrGetRowId(uniqueKeys, culture.Idkey);

			let baseFieldName = `repeating_cultures_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = culture.Idkey;
	
			attributes[`${baseFieldName}_name`] = culture.Name;
	
			attributes[`${baseFieldName}_points`] = parseInt(culture.Points);

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingTraits = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingTraits, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_traits_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_trait_level`] = trait.TraitLevel;

			attributes[`${baseFieldName}_foa`] = trait.Foa;

			attributes[`${baseFieldName}_points`] = parseInt(trait.Points);

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingPerks = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingPerks, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_perks_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_foa`] = trait.Foa;

			attributes[`${baseFieldName}_points`] = parseInt(trait.Points);

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingQuirks = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingQuirks, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_quirks_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_control_rating`] = trait.ControlRating;

			attributes[`${baseFieldName}_points`] = parseInt(trait.Points);

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingDisadvantages = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingDisadvantages, async(trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_disadvantages_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_trait_level`] = trait.TraitLevel;

			attributes[`${baseFieldName}_control_rating`] = trait.ControlRating;

			attributes[`${baseFieldName}_points`] = parseInt(trait.Points);

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingRacial = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingRacial, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_racial_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_trait_level`] = trait.TraitLevel;

			attributes[`${baseFieldName}_control_rating`] = trait.ControlRating;

			attributes[`${baseFieldName}_points`] = parseInt(trait.Points);

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingSkills = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingSkills, async (skill) => {

			let rowId = generateOrGetRowId(uniqueKeys, skill.Idkey);

			let baseFieldName = `repeating_skills_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = skill.Idkey;

			attributes[`${baseFieldName}_name`] = skill.Name;

			attributes[`${baseFieldName}_tl`] = skill.Tl;

			attributes[`${baseFieldName}_base`] = skill.Base;

			attributes[`${baseFieldName}_difficulty`] = getSKillDifficultyValue(skill.Difficulty);

			attributes[`${baseFieldName}_bonus`] = parseInt(skill.Bonus);

			attributes[`${baseFieldName}_points`] = parseInt(skill.Points);

			attributes[`${baseFieldName}_ref`] = skill.Ref;

			attributes[`${baseFieldName}_skill_mod_notes`] = skill.SkillModNotes;

			attributes[`${baseFieldName}_notes`] = skill.Notes;

			await setAttrsAsync(attributes);

		});

	}

	/**
	 * Converts difficulty name to a number
	 * TODO: checks for wildcard! 
	 */
	let getSKillDifficultyValue = difficulty => {

		let difficultyValue = "-1";

		switch (difficulty) {
	
			case "A":
				difficultyValue = "-2";
				break;

			case "H":
				difficultyValue = "-3";
				break;

			case "VH":
				difficultyValue = "-4";
				break;

			case "WC":
				difficultyValue = "-5 + 1";
				break;

			case "T/H":
				difficultyValue = "0";
				break;

			case "E":
			default:
				difficultyValue = "-1";
				break;
		}

		return difficultyValue;

	}

	let importRepeatingTechniquesrevised = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingTechniquesrevised, async (skill) => {

			let rowId = generateOrGetRowId(uniqueKeys, skill.Idkey);

			let baseFieldName = `repeating_techniquesrevised_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = skill.Idkey;

			attributes[`${baseFieldName}_name`] = skill.Name;

			attributes[`${baseFieldName}_parent`] = skill.Parent;

			attributes[`${baseFieldName}_base_level`] = skill.BaseLevel;

			attributes[`${baseFieldName}_default`] = parseInt(skill.Default);

			attributes[`${baseFieldName}_max_modifier`] = parseInt(skill.MaxModifier);

			attributes[`${baseFieldName}_difficulty`] = getTechniqueDifficultyValue(skill.Difficulty);

			attributes[`${baseFieldName}_skill_modifier`] = parseInt(skill.SkillModifier);

			attributes[`${baseFieldName}_points`] = parseInt(skill.Points);

			attributes[`${baseFieldName}_ref`] = skill.Ref;

			attributes[`${baseFieldName}_skill_mod_notes`] = skill.SkillModNotes;

			attributes[`${baseFieldName}_notes`] = skill.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let getTechniqueDifficultyValue = difficulty => {

		let difficultyValue = "Average";

		switch (difficulty) {
	
			case "H":
				difficultyValue = "Hard";
				break;

			case "A":
			default:
				difficultyValue = "Average";
				break;
		}

		return difficultyValue;

	}

	let importRepeatingDefense = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingDefense, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_defense_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_type`] = trait.Type;

			attributes[`${baseFieldName}_info`] = trait.Info;

			attributes[`${baseFieldName}_skill`] = parseInt(trait.Skill);

			attributes[`${baseFieldName}_skill_mod`] = parseInt(trait.SkillMod);

			attributes[`${baseFieldName}_defense_mod_reason`] = trait.DefenseModReason;

			attributes[`${baseFieldName}_info_description`] = trait.InfoDescription;

			await setAttrsAsync(attributes);

		});

	}

	/**
	 * Will convert variable die rolls to Roll20 macro prompt
	 * if it starts with ~, then add macro to allow user to enter number of dice to roll
	 */
	let getDamageDieMacro = (damageDie) => {
	
		let dieRoll = damageDie;
	
		if (damageDie && damageDie.includes("~")) {
	
			// example: ~1d+1
			// remove ~
			damageDie = damageDie.replace("~", "");
	
			// array = [1, +1]
			let arrDamageDie = damageDie.split("d");
	
			let baseDie = 1;
	
			let dieModifier = "0";
	
			if (arrDamageDie.length === 1) {
	
				baseDie = arrDamageDie[0];
	
			} else if (arrDamageDie.length === 2) {
	
				baseDie = arrDamageDie[0];
	
				dieModifier = arrDamageDie[0];
	
			}
	
			dieRoll = getNumberOfDicePrompt(baseDie, Number(dieModifier), 12);
	
		}
	
		return dieRoll;
	
	}

	let importRepeatingMelee = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingMelee, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_melee_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_damage`] = getDamageDieMacro(trait.Damage);

			attributes[`${baseFieldName}_type`] = getDamageTypeFromGca(trait.Type);

			attributes[`${baseFieldName}_reach`] = trait.Reach;

			attributes[`${baseFieldName}_skill`] = parseInt(trait.Skill);

			attributes[`${baseFieldName}_armor_divisor`] = Number(trait.ArmorDivisor);

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingRanged = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingRanged, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let baseFieldName = `repeating_ranged_${rowId}`;

			const malfunctionVerify = trait.MalfunctionVerify ? "1" : "0";

			const malfunctionVeryReliable = trait.MalfunctionVeryReliable ? "1" : "0";

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_damage`] = getDamageDieMacro(trait.Damage);

			attributes[`${baseFieldName}_type`] = getDamageTypeFromGca(trait.Type);

			attributes[`${baseFieldName}_acc`] = trait.Acc;

			attributes[`${baseFieldName}_range`] = trait.Range;

			attributes[`${baseFieldName}_rof`] = trait.Rof;

			attributes[`${baseFieldName}_shots`] = trait.Shots;

			attributes[`${baseFieldName}_bulk`] = trait.Bulk;

			attributes[`${baseFieldName}_recoil`] = trait.Recoil;

			attributes[`${baseFieldName}_skill`] = parseInt(trait.Skill);

			attributes[`${baseFieldName}_malfunction`] = trait.Malfunction;

			attributes[`${baseFieldName}_malfunction_verify`] = malfunctionVerify;

			attributes[`${baseFieldName}_malfunction_very_reliable`] = malfunctionVeryReliable;

			attributes[`${baseFieldName}_armor_divisor`] = Number(trait.ArmorDivisor);

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingItem = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingItem, async (trait) => {

			let rowId = generateOrGetRowId(uniqueKeys, trait.Idkey);

			let cost = Number(trait.Cost) || 0;

			// round to 2 decimal places
			cost = Number(Math.round(cost * 100) / 100).toFixed(2);

			let weight = Number(trait.Weight) || 0;

			// round to 3 decimal places
			weight = Number(Math.round(weight * 100) / 100).toFixed(3);

			let baseFieldName = `repeating_item_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = trait.Idkey;

			attributes[`${baseFieldName}_name`] = trait.Name;

			attributes[`${baseFieldName}_tl`] = trait.Tl;

			attributes[`${baseFieldName}_legality_class`] = trait.LegalityClass;

			attributes[`${baseFieldName}_ref`] = trait.Ref;

			attributes[`${baseFieldName}_count`] = parseInt(trait.Count);

			attributes[`${baseFieldName}_cost`] = cost;

			attributes[`${baseFieldName}_weight`] = weight;

			attributes[`${baseFieldName}_notes`] = trait.Notes;

			attributes[`${baseFieldName}_carried`] = trait.Carried || "0";

			await setAttrsAsync(attributes);

		});

	}

	let importRepeatingSpells = async (character, uniqueKeys) => {

		await asyncForEach(character.RepeatingSpells, async (skill) => {

			let rowId = generateOrGetRowId(uniqueKeys, skill.Idkey);

			let baseFieldName = `repeating_spells_${rowId}`;

			let attributes = {};

			attributes[`${baseFieldName}_idkey`] = skill.Idkey;

			attributes[`${baseFieldName}_name`] = skill.Name;

			attributes[`${baseFieldName}_difficulty`] = getSKillDifficultyValue(skill.Difficulty);

			attributes[`${baseFieldName}_spell_modifier`] = parseInt(skill.SpellModifier);

			attributes[`${baseFieldName}_points`] = parseInt(skill.Points);

			attributes[`${baseFieldName}_spell_resisted_by`] = skill.SpellResistedBy;

			attributes[`${baseFieldName}_duration`] = skill.Duration;

			attributes[`${baseFieldName}_cost`] = skill.Cost;

			attributes[`${baseFieldName}_ref`] = skill.Ref;

			attributes[`${baseFieldName}_casttime`] = skill.Casttime;

			attributes[`${baseFieldName}_maintain`] = skill.Maintain;

			attributes[`${baseFieldName}_spell_class`] = skill.SpellClass;

			attributes[`${baseFieldName}_spell_college`] = skill.SpellCollege;

			if (skill.SpellCollegeSecondary) {
				attributes[`${baseFieldName}_spell_college_secondary`] = skill.SpellCollegeSecondary;
			}

			attributes[`${baseFieldName}_spell_mod_notes`] = skill.SpellModNotes;

			attributes[`${baseFieldName}_notes`] = skill.SpellNotes;

			await setAttrsAsync(attributes);

		});

	}

	/* Character Point Total Methods */
	const arrCheckForAttributes = [
		"strength_points",
		"dexterity_points",
		"intelligence_points",
		"health_points",
		"perception_points",
		"vision_points",
		"hearing_points",
		"taste_smell_points",
		"touch_points",
		"willpower_points",
		"fear_check_points",
		"hit_points_points",
		"fatigue_points_points",
		"energy_points_points",
		"user_pool1_points",
		"user_pool2_points",
		"basic_speed_points",
		"basic_move_points",
		"striking_st_points",
		"lift_st_points",
		"enhanced_ground_move_points",
		"flight_points",
		"basic_air_move_points",
		"enhanced_air_move_points",
		"amphibious_points",
		"basic_water_move_points",
		"enhanced_water_move_points",
		"super_jump_points",
		"unconscious_check_points",
		"death_check_points",
	];

	// get on change string
	const onChangeAttributes = arrCheckForAttributes.map(attribute => {
		return `change:${attribute}`;
	}).join(" ");

	on(onChangeAttributes, (event) => {

		// only run if player instigated the change
		if (event.sourceType === "player") {
			totalAttributeCharacterPoints();
		}

	});

	function totalAttributeCharacterPoints() {

		getAttrs(arrCheckForAttributes, (values) => {

			let positivePointTotal = 0;

			let negativePointTotal = 0;

			// https://atomizedobjects.com/blog/javascript/how-to-use-foreach-with-an-object-in-javascript/ 
			Object.entries(values).forEach(([key, value]) => {

				let characterPoints = Number(value) || 0;

				if (characterPoints < 0) {
					negativePointTotal += characterPoints;

				} else {
					positivePointTotal += characterPoints;
					
				}

			});

			let updateFields = {
				attribute_positive_total: positivePointTotal,
				attribute_negative_total: negativePointTotal,

			};

			setAttrs(updateFields);

		});

	}

	let totalAttributeCharacterPointsAsync = async () => {

		let values = await getAttrsAsync(arrCheckForAttributes);

		let positivePointTotal = 0;


		let negativePointTotal = 0;

		// https://atomizedobjects.com/blog/javascript/how-to-use-foreach-with-an-object-in-javascript/ 
		Object.entries(values).forEach(([key, value]) => {

			let characterPoints = Number(value) || 0;

			if (characterPoints < 0) {
				negativePointTotal += characterPoints;

			} else {
				positivePointTotal += characterPoints;
				
			}

		});

		let updateFields = {
			attribute_positive_total: positivePointTotal,
			attribute_negative_total: negativePointTotal,

		};

		await setAttrsAsync(updateFields);
		
	}



	on("change:racial_points", (event) => {

		updateRacialCharacterPoints();

	});

	function updateRacialCharacterPoints() {

		getAttrs(["racial_points"], (values) => {

			const racialPoints = Number(values.racial_points) || 0;

			const racialPointsPositive = racialPoints >= 0 ? racialPoints : 0;

			const racialPointsNegative = racialPoints < 0 ? racialPoints : 0;

			setAttrs({
				racial_points_advantage: racialPointsPositive,
				racial_points_disadvantage: racialPointsNegative
			});

		});

	}

	on("change:tl_pts", event => {

		updateTechLevelPoints();

	});

	function updateTechLevelPoints() {

		getAttrs(["tl_pts"], (values) => {

			const tlPoints = Number(values.tl_pts) || 0;

			const tlPointsPositive = tlPoints >= 0 ? tlPoints : 0;

			const tlPointsNegative = tlPoints < 0 ? tlPoints : 0;

			setAttrs({
				tech_level_points_advantage: tlPointsPositive,
				tech_level_points_disadvantage: tlPointsNegative
			});

		});

	}

	on("change:languages_points", event => {

		updateLanguagePoints();

	});

	function updateLanguagePoints() {

		getAttrs(["languages_points"], (values) => {

			const languagePoints = Number(values.languages_points) || 0;

			const languagePointsPositive = languagePoints >= 0 ? languagePoints : 0;

			const languagePointsNegative = languagePoints < 0 ? languagePoints : 0;

			setAttrs({
				language_points_advantage: languagePointsPositive,
				language_points_disadvantage: languagePointsNegative
			});

		});

	}

	on("clicked:repeating_ranged:duplicate", event => {

		let rowId = getRowIdFromEventInfo(event, "repeating_ranged");

		duplicateRangedCombat(rowId);

	});

	/**
	 * duplicate the selected ranged combat row
	 *
	 * @param string originalRowId Not needed, but available for possible use
	 */
	const duplicateRangedCombat = (originalRowId) => {

		const rowAttributes = [
			"repeating_ranged_name",
			"repeating_ranged_damage",
			"repeating_ranged_type",
			"repeating_ranged_minimum_damage_note",
			"repeating_ranged_acc",
			"repeating_ranged_range",
			"repeating_ranged_rof",
			"repeating_ranged_shots",
			"repeating_ranged_bulk",
			"repeating_ranged_recoil",
			"repeating_ranged_skill",
			"repeating_ranged_ranged_row_type",
			"repeating_ranged_ranged_skill_row_id",
			"repeating_ranged_ranged_skill_row_id_modifier",
			"repeating_ranged_ranged_skill_row_id_message",
			"repeating_ranged_ranged_skill_row_id_level",
			"repeating_ranged_reason_for_mod",
			"repeating_ranged_malfunction",
			"repeating_ranged_malf_max_value",
			"repeating_ranged_malfunction_verify",
			"repeating_ranged_malfunction_very_reliable",
			"repeating_ranged_armor_divisor",
			"repeating_ranged_ref",
			"repeating_ranged_private_notes",
			"repeating_ranged_notes",
			"repeating_ranged_damage_notes",
			"repeating_ranged_success_notes",
			"repeating_ranged_critical_success_notes",
			"repeating_ranged_fail_notes",
			"repeating_ranged_critical_fail_notes"			
		];

		getAttrs(rowAttributes, values => {

			const id = generateRowID();

			const baseFieldName = `repeating_ranged_${id}`; 

			let fields = {};
			fields[`${baseFieldName}_name`] = values.repeating_ranged_name + " copy";
			fields[`${baseFieldName}_damage`] = values.repeating_ranged_damage;
			fields[`${baseFieldName}_type`] = values.repeating_ranged_type;
			fields[`${baseFieldName}_minimum_damage_note`] = values.repeating_ranged_minimum_damage_note;
			fields[`${baseFieldName}_acc`] = values.repeating_ranged_acc;
			fields[`${baseFieldName}_range`] = values.repeating_ranged_range;
			fields[`${baseFieldName}_rof`] = values.repeating_ranged_rof;
			fields[`${baseFieldName}_shots`] = values.repeating_ranged_shots;
			fields[`${baseFieldName}_bulk`] = values.repeating_ranged_bulk;
			fields[`${baseFieldName}_recoil`] = values.repeating_ranged_recoil;
			fields[`${baseFieldName}_skill`] = values.repeating_ranged_skill;
			fields[`${baseFieldName}_ranged_row_type`] = values.repeating_ranged_ranged_row_type;
			fields[`${baseFieldName}_ranged_skill_row_id`] = values.repeating_ranged_ranged_skill_row_id;
			fields[`${baseFieldName}_ranged_skill_row_id_modifier`] = values.repeating_ranged_ranged_skill_row_id_modifier;
			fields[`${baseFieldName}_ranged_skill_row_id_message`] = values.repeating_ranged_ranged_skill_row_id_message;
			fields[`${baseFieldName}_ranged_skill_row_id_level`] = values.repeating_ranged_ranged_skill_row_id_level;
			fields[`${baseFieldName}_reason_for_mod`] = values.repeating_ranged_reason_for_mod;
			fields[`${baseFieldName}_malfunction`] = values.repeating_ranged_malfunction;
			fields[`${baseFieldName}_malf_max_value`] = values.repeating_ranged_malf_max_value;
			fields[`${baseFieldName}_malfunction_verify`] = values.repeating_ranged_malfunction_verify;
			fields[`${baseFieldName}_malfunction_very_reliable`] = values.repeating_ranged_malfunction_very_reliable;
			fields[`${baseFieldName}_armor_divisor`] = values.repeating_ranged_armor_divisor;
			fields[`${baseFieldName}_ref`] = values.repeating_ranged_ref;
			fields[`${baseFieldName}_private_notes`] = values.repeating_ranged_private_notes;
			fields[`${baseFieldName}_notes`] = values.repeating_ranged_notes;
			fields[`${baseFieldName}_damage_notes`] = values.repeating_ranged_damage_notes;
			fields[`${baseFieldName}_success_notes`] = values.repeating_ranged_success_notes;
			fields[`${baseFieldName}_critical_success_notes`] = values.repeating_ranged_critical_success_notes;
			fields[`${baseFieldName}_fail_notes`] = values.repeating_ranged_fail_notes;
			fields[`${baseFieldName}_critical_fail_notes`] = values.repeating_ranged_critical_fail_notes;
			
			setAttrs(fields, { silent: true });
			
		});

	}

	on("clicked:repeating_melee:duplicate", event => {

		let rowId = getRowIdFromEventInfo(event, "repeating_melee");

		duplicateMeleeCombat(rowId);

	});

	/**
	 * duplicate the selected melee combat row
	 *
	 * @param string originalRowId Not needed, but available for possible use
	 */
	const duplicateMeleeCombat = (originalRowId) => {

		const rowAttributes = [
			"repeating_melee_name",
			"repeating_melee_damage",
			"repeating_melee_type",
			"repeating_melee_damage_type_note",
			"repeating_melee_minimum_damage_note",
			"repeating_melee_reach",
			"repeating_melee_skill",
			"repeating_melee_melee_row_type",
			"repeating_melee_melee_skill_row_id",
			"repeating_melee_melee_skill_row_id_modifier",
			"repeating_melee_melee_skill_row_id_message",
			"repeating_melee_melee_skill_row_id_level",
			"repeating_melee_reason_for_mod",
			"repeating_melee_armor_divisor",
			"repeating_melee_ref",
			"repeating_melee_private_notes",
			"repeating_melee_notes",
			"repeating_melee_damage_notes",
			"repeating_melee_success_notes",
			"repeating_melee_critical_success_notes",
			"repeating_melee_fail_notes",
			"repeating_melee_critical_fail_notes"			
		];

		getAttrs(rowAttributes, values => {

			const id = generateRowID();

			const baseFieldName = `repeating_melee_${id}`; 

			let fields = {};
			fields[`${baseFieldName}_name`] = values.repeating_melee_name + " copy";
			fields[`${baseFieldName}_damage`] = values.repeating_melee_damage;
			fields[`${baseFieldName}_type`] = values.repeating_melee_type;
			fields[`${baseFieldName}_damage_type_note`] = values.repeating_melee_damage_type_note;
			fields[`${baseFieldName}_minimum_damage_note`] = values.repeating_melee_minimum_damage_note;
			fields[`${baseFieldName}_reach`] = values.repeating_melee_reach;
			fields[`${baseFieldName}_skill`] = values.repeating_melee_skill;
			fields[`${baseFieldName}_melee_row_type`] = values.repeating_melee_melee_row_type;
			fields[`${baseFieldName}_melee_skill_row_id`] = values.repeating_melee_melee_skill_row_id;
			fields[`${baseFieldName}_melee_skill_row_id_modifier`] = values.repeating_melee_melee_skill_row_id_modifier;
			fields[`${baseFieldName}_melee_skill_row_id_message`] = values.repeating_melee_melee_skill_row_id_message;
			fields[`${baseFieldName}_melee_skill_row_id_level`] = values.repeating_melee_melee_skill_row_id_level;
			fields[`${baseFieldName}_reason_for_mod`] = values.repeating_melee_reason_for_mod;
			fields[`${baseFieldName}_armor_divisor`] = values.repeating_melee_armor_divisor;
			fields[`${baseFieldName}_ref`] = values.repeating_melee_ref;
			fields[`${baseFieldName}_private_notes`] = values.repeating_melee_private_notes;
			fields[`${baseFieldName}_notes`] = values.repeating_melee_notes;
			fields[`${baseFieldName}_damage_notes`] = values.repeating_melee_damage_notes;
			fields[`${baseFieldName}_success_notes`] = values.repeating_melee_success_notes;
			fields[`${baseFieldName}_critical_success_notes`] = values.repeating_melee_critical_success_notes;
			fields[`${baseFieldName}_fail_notes`] = values.repeating_melee_fail_notes;
			fields[`${baseFieldName}_critical_fail_notes`] = values.repeating_melee_critical_fail_notes;
			
			setAttrs(fields, { silent: true });
			
		});

	}

	on("change:repeating_disadvantages:whisper_mode", event => {

		const newValue = Number(event.newValue);

		const isChecked = newValue === 1;

		getAttrs(["roll"], values => {

			let rollMacro = "/w gm";

			// if "unchecked"
			if (!isChecked) {

				// use the current roll prompt
				rollMacro = values.roll;

			} 

			setAttrs({repeating_disadvantages_disadvantage_roll: rollMacro});

		});
		

	});

	/* ------- CHASE CONTROL SHEET ------- */
	const chaseRangeBandData = new Map([
		["close", { name: "Close", start: "0-5 yards", rangePenaltyRange: "0 to -2", rangePenalty: 0, description: "Can touch rival, at least some of the time." }],
		["short", { name: "Short", start: "6-20 yards", rangePenaltyRange: "-3 to -6", rangePenalty: -3, description: "Can talk to enemy, or toss things at him." }],
		["medium", { name: "Medium", start: "21-100 yards", rangePenaltyRange: "-7 to -10", rangePenalty: -7, description: "Can only shout at rival; need a gun to attack him." }],
		["long", { name: "Long", start: "101-500 yards", rangePenaltyRange: "-11 to -14", rangePenalty: -11, description: "Opponent is out of earshot, at scoped rifle range." }],
		["extreme", { name: "Extreme", start: "500+ yards", rangePenaltyRange: "-15 or worse", rangePenalty: -15, description: "Rival difficult or impossible to see or shoot." }],
		["escape", { name: "Escape!", start: "Beyond Extreme!", rangePenaltyRange: "None, combat over", rangePenalty: -30, description: "Quarry has escaped, chase is over!" }],
	]);

	const chaseManeuverData = new Map([
		["attack", { 
			name: "Attack", 
			description: "Stop and make a careful ranged attack.", 
			conditions: "", 
			actions: "Everyone on your side with a ranged weapon may roll an attack, adding their weapon Acc.", 
			chaseRolls: "Static maneuver.", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["disembark-embark", { 
			name: "Disembark/Embark", 
			description: "Leave or enter a vehicle or building. If pursuer doesn't pick Disembark/Embark then you can perform a Mobility Escape next round. If embarking, next round you have the option to select the Take Control maneuver.", 
			conditions: "Must be in a vehicle to leave one, or have access to a vehicle to board one; latter requires suitable scenery or Lucky Break.", 
			actions: "Passengers can attack with ranged weapons. If Embarking, next round you can attempt the Take Control maneuver.", 
			chaseRolls: "Static maneuver.", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["take-control", { 
			name: "Take Control", 
			description: "Take Control. In the book, this is also Disembark/Embark. To help avoid confusion, Take Control was created as a new maneuver.", 
			conditions: "", 
			actions: "Make a Vehicle control roll to start or hotwire a vehicle, on failure try again next turn. Passengers can attack with ranged weapons.", 
			chaseRolls: "Static maneuver.", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["emergency-action", { 
			name: "Emergency Action", 
			description: "Regain control after a wipeout.", 
			conditions: "If you experienced a close call last round, you must do this (or Stop); otherwise you can't choose this maneuver.", 
			actions: "", 
			chaseRolls: "-5", 
			chaseMod: -5,
			chaseOptions: []
		}],
		["force", { 
			name: "Force", 
			description: "Attempt to force target off the road.", 
			conditions: "Round starts at Close range and you're able to strike your rival.", 
			actions: "Roll vehicle operation skill to hit. Target may attempt to dodge. On hit, target must make control roll at -1/+1 per 5 points by which your vehicle's ST is higher/lower than target's vehicle ST. Failure causes target to check for a Wipeout. Passengers can attack with ranged weapons.", 
			chaseRolls: "-2", 
			chaseMod: -2,
			chaseOptions: []
		}],
		["hide", { 
			name: "Hide", 
			description: "Attempt to use scenery to prevent pursuer from seeing you.", 
			conditions: "Round starts at Medium range or greater; Suitable scenery or Lucky Break.", 
			actions: "", 
			chaseRolls: "-10 at medium range, -5 at Long range, or 0 at Extreme range. On foot make chase against Stealth. If you win, pursuer loses sight of you! You may opt to escape or become the pursuer, selecting Short, Medium, or Long range. If you lose, Pursuer is automatically at Close range.", 
			chaseMod: -10,
			chaseOptions: [
				{key: "medium", name: "Medium range", value: -10},
				{key: "long", name: "Long range", value: -5},
				{key: "extreme", name: "Extreme range", value: -5},
			]
		}],
		["mobility-escape", { 
			name: "Mobility Escape", 
			description: "Escape by going where your pursuer can't.", 
			conditions: "Either a mismatched chase (e.g., air vs land) or suitable Scenery or Lucky Break.", 
			actions: "", 
			chaseRolls: "If your pursuer can't follow, their maneuver is treated as static, on this and future rounds. Pursuer can use Lucky Break to avoid the forced static maneuver.", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["mobility-pursuit", { 
			name: "Mobility Pursuit", 
			description: "Cut off your quarry by taking a route that they cannot; fly over buildings with helicopter to thwart motorcyclist.", 
			conditions: "Either a mismatched chase or suitable scenery or Lucky Break.", 
			actions: "", 
			chaseRolls: "+5. If you win, must choose a reduced range.", 
			chaseMod: 5,
			chaseOptions: []
		}],
		["move", { 
			name: "Move", 
			description: "Move using sheer skill and speed.", 
			conditions: "None", 
			actions: "None, nobody attacks (take Move and Attack for that)", 
			chaseRolls: "", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["move-attack", { 
			name: "Move and Attack", 
			description: "Attack your rival while continuing flight or pursuit.", 
			conditions: "", 
			actions: "Everyone on your side with a ranged weapon may roll an attack, but only heroes with Gunslinger add Acc. At Close range, melee attacks are possible; if anyone successfully grapples, the chase ends immediately.", 
			chaseRolls: "-2 for pedestrians, or for a vehicle operator who attacks while driving.", 
			chaseMod: -2,
			chaseOptions: [
				{key: "pedestrian", name: "Pedestrian", value: -2},
				{key: "operator-attack", name: "Operator Attacks", value: -2},
				{key: "operator-only", name: "Operator only moves", value: 0},
			]
		}],
		["ram", { 
			name: "Ram", 
			description: "Attempt to collide with or run down your quarry.", 
			conditions: "Round starts at Close range and you're in a vehicle that could strike your rival.", 
			actions: "Roll against vehicle operation skill to hit. The target may attempt to dodge. Each vehicle does damage equal to the Vehicle's ST subtracted by the other vehicle's DR. A pedestrian uses ST + HP. If your quarry did a reverse this round damage is doubled to both of you. People inside each vehicle take a nominal 1 HP of general bruising, ignore DR. Any vehicle involved in a Ram must make an umodified vehicle skill roll; on a failure, check for Wipeout. Passengers can attack with ranged weapons.", 
			chaseRolls: "-2", 
			chaseMod: -2,
			chaseOptions: []
		}],
		["reverse", { 
			name: "Reverse", 
			description: "Turn sharply and come back at your pursuer!", 
			conditions: "", 
			actions: "", 
			chaseRolls: "-10. On foot, you can opt to make your Chase Roll against Acrobatics. In all cases, regardless of the Quick Contest of Chase Rolls, failing your roll sends you to Wipeouts. If you win and don't wipe out, you're the pursuer next round! Win or lose, range automatically becomes Close.", 
			chaseMod: -10,
			chaseOptions: []
		}],
		["stop", { 
			name: "Stop", 
			description: "Stop dead, ending the chase.", 
			conditions: "", 
			actions: "If you're the pursuer, let your quarry escape. If you're the quarry, stop the chase and start combat or other interaction.", 
			chaseRolls: "Don't roll - the chase is over.", 
			chaseMod: 0,
			chaseOptions: []
		}],
		["stunt", { 
			name: "Stunt", 
			description: "Do something risky to outmaneuver your rival: jump a ramp, drive against traffic, etc. Describe it!", 
			conditions: "", 
			actions: "Roll against the skill you're using for the chase, at any even penalty you like (-2, -4, etc.). Driving the wrong way in traffic is -10 or worse! On foot, you must choose a move from Climbing or Parkour; minimum penalty is the one listed for that feat, and your Stunt roll is against Acrobatics, Climbing, or Jumping. In all cases, failure sends you to wipeouts.", 
			chaseRolls: "+1 to your Chase Roll per -2 on your Stunt roll.", 
			chaseMod: 1,
			chaseOptions: []
		}],
		["stunt-escape", { 
			name: "Stunt Escape", 
			description: "Escape pursuit with a flashy move; e.g., drop from an overpass onto a truck during a foot chase, or take a car down an alleyway on two wheels.", 
			conditions: "Suitable scenery or Lucky Break.", 
			actions: "Declare that you're using scenery or Lucky Break to escape. Roll against the skill you're using for the chase, at any even penalty you like (-2, -4, etc.). Driving the wrong way in traffic is -10 or worse! On foot, you must choose a move from Climbing or Parkour; minimum penalty is the one listed for that feat, and your Stunt roll is against Acrobatics, Climbing, or Jumping. In all cases, failure sends you to wipeouts.", 
			chaseRolls: "+1 to your Chase Roll per -2 on your Stunt roll. If your pursuer responds with Stunt at the same penalty or worse, he receives his Stunt bonus; if he has superior mobility and responds with Mobility Pursuit, he gets +5. If pursuer picks any other maneuver, the pursuer must treat it as static on this and all future rounds.", 
			chaseMod: 1,
			chaseOptions: []
		}]
	]);

	on("change:chase_sequence", event => {

		let sequence = event.newValue ?? "none";

		processChaseSequence(sequence);

	});

	const processChaseSequence = (sequence) => {

		if (sequence == "next_round") {
			updateChaseRound();
		}

	}

	const updateChaseRound = () => {

		let fields = ["chase_round"];

		getAttrs(fields, values => {

			let currentRound = Number(values.chase_round) ?? 1;

			let nextRound = currentRound + 1;

			let keyValuePairs = {
				chase_round: nextRound,
				chase_sequence: "quarry_chooses",
				chase_quarry_maneuver: "none",
				chase_quarry_modifier: 0,
				chase_quarry_made_by: 0,
				chase_pursuer_maneuver: "none",
				chase_pursuer_modifier: 0,
				chase_pursuer_made_by: 0,
				chase_content_result: ""
			};

			setAttrs(keyValuePairs);

		});

	};

	on("change:chase_range_band", (event) => {

		const rangeBand = event.newValue ?? "none";

		updateRangeBandDescription(rangeBand);

	});

	const updateRangeBandDescription = (rangeBand) => {

		const chaseRangeBand = chaseRangeBandData.get(rangeBand);

		let rangeDescription = "";

		let description = "";

		if (chaseRangeBand) {

			rangeDescription = `${chaseRangeBand.rangePenaltyRange} (Default is ${chaseRangeBand.rangePenalty} or GM discretion for attack rolls)`;

			description = chaseRangeBand.description;

		}

		const updateValues = {
			chase_range_band_description_range: rangeDescription,
			chase_range_band_description: description
		};

		setAttrs(updateValues)

	}

	on("change:chase_quarry_maneuver change:chase_pursuer_maneuver", event => {

		const maneuver = event.newValue ?? "none";

		let type = "quarry";

		let sourceAttribute = event.sourceAttribute;

		if (sourceAttribute.includes("pursuer")) {
			type = "pursuer";
		}

		updateManuever(type, maneuver);

	});

	/**
	 * 
	 * @parm string type quarry|pursuer
	 * @param string maneuver The selected maneuver key
	 */
	const updateManuever = (type, maneuverKey) => {

		const selectedManeuver = chaseManeuverData.get(maneuverKey);

		let description = "Select a maneuver.";

		let conditions = "";

		let actions = "";

		let chaseRolls = "";

		let chaseMod = 0;

		if (selectedManeuver) {

			description = selectedManeuver.description;

			conditions = selectedManeuver.conditions;

			actions = selectedManeuver.actions;

			chaseRolls = selectedManeuver.chaseRolls;
			
			chaseMod = selectedManeuver.chaseMod;

		}

		const updateValues = {};

		updateValues[`${type}_maneuver_description`] = description;
		updateValues[`${type}_maneuver_conditions`] = conditions;
		updateValues[`${type}_maneuver_actions`] = actions;
		updateValues[`${type}_maneuver_chase_rolls`] = chaseRolls;
		updateValues[`chase_${type}_modifier`] = chaseMod;

		setAttrs(updateValues)

	}

	const chaseParticipants = ["quarry", "pursuer"];

	chaseParticipants.forEach( participant => {

		on(`change:chase_${participant}_modifier change:${participant}_handling change:chase_${participant}_chase_mod_table_total change:${participant}_speed_chase_mod`, event => {

			updateChaseModifiers(participant);

		});

	});
		
	const updateChaseModifiers = (participant) => {

		let fields = [
			`chase_${participant}_modifier`, 
			`${participant}_handling`,
			`chase_${participant}_chase_mod_table_total`,
			`${participant}_speed_chase_mod`
		];

		getAttrs(fields, values => {

			let modifier = Number(values[`chase_${participant}_modifier`]) ?? 0;

			let handling = Number(values[`${participant}_handling`]) ?? 0;

			let tableTotal = Number(values[`chase_${participant}_chase_mod_table_total`]) ?? 0;

			let speedMod = Number(values[`${participant}_speed_chase_mod`]) ?? 0;

			let total = modifier + handling + tableTotal + speedMod;

			let keyValues = {};

			keyValues[`chase_${participant}_final_modifier`] = total;

			setAttrs(keyValues);

		});

	};
	
	chaseParticipants.forEach( participant => {

		on(`change:repeating_chase-${participant}-modifiers:mod`, event => {

			sumRepeating(`repeating_chase-${participant}-modifiers`, 'mod', function (total) {
			
				let keyValues = {};

				keyValues[`chase_${participant}_chase_mod_table_total`] = total;

				setAttrs(keyValues);

			});
	
		});

	});
	
	chaseParticipants.forEach( participant => {

		on(`change:${participant}_speed`, event => {

			let speed = event.newValue ?? 0;

			updateParticipantSpeedModifier(participant, speed);
	
		});

	});

	const updateParticipantSpeedModifier = (participant, speed) => {
		
		let speedMod = Math.abs(getModBySpeedRange(speed));

		let keyValues = {};

		keyValues[`${participant}_speed_chase_mod`] = speedMod;

		setAttrs(keyValues);
		
	};

	chaseParticipants.forEach( participant => {

		on(`change:chase_${participant}_modifier change:${participant}_handling change:${participant}_speed_chase_mod change:chase_${participant}_chase_mod_table_total`, event => {

			updateChaseRollDescription(participant);
	
		});

	});

	const updateChaseRollDescription = participant => {

		const fields = [
			`chase_${participant}_modifier`,
			`${participant}_handling`,
			`${participant}_speed_chase_mod`,
			`chase_${participant}_chase_mod_table_total`
		];

		getAttrs(fields, values => {

			let chaseMod = Number(values[`chase_${participant}_modifier`]) ?? 0;
			let handlingMod = Number(values[`${participant}_handling`]) ?? 0;
			let speedMod = Number(values[`${participant}_speed_chase_mod`]) ?? 0;
			let tableMod = Number(values[`chase_${participant}_chase_mod_table_total`]) ?? 0;

			let description = `Chase Modifier: ${chaseMod}
Handling Modifier: ${handlingMod}
Speed Modifier: ${speedMod}
Chase Modifier Table: ${tableMod}`;

			let keyValues = {};

			keyValues[`chase_${participant}_modifier_description`] = description;

			setAttrs(keyValues);

		});

	}

	on("clicked:chase_get_result", event => {
		getChaseResults();
	});

	const getChaseResults = () => {

		let fields = [
			"chase_quarry_made_by",
			"chase_pursuer_made_by",
			"quarry_is_static",
			"pursuer_is_static",
		];

		getAttrs(fields, values => {

			let quarryRollBy = Number(values.chase_quarry_made_by) ?? 0;

			let pursuerRollBy = Number(values.chase_pursuer_made_by) ?? 0;

			let quarryIsStatic = values.quarry_is_static == "1";

			let pursuerIsStatic = values.pursuer_is_static == "1";

			// positive value, quarry rolled better. negative value pursuer rolled better
			let difference = quarryRollBy - pursuerRollBy;

			let winner = "Quarry";

			if (quarryIsStatic == true && pursuerIsStatic == true) {
				winner = "Tie";
			} else if (quarryIsStatic == false && pursuerIsStatic == false && difference < 0) {
				winner = "Pursuer";
			} else if (quarryIsStatic == true && pursuerIsStatic == false) {
				winner = "Pursuer";
				if (difference > 0) {
					difference = 0;
				}
			} else if (quarryIsStatic == false && pursuerIsStatic == true) {
				winner = "Quarry";
				if (difference < 0) {
					difference = 0;
				}
			}

			let victoryDifference = Math.abs(difference);
			
			let result = "Tie, no change to range band.";

			if (quarryIsStatic == true && pursuerIsStatic == true) {

				result = `Quarry and Pursuer are static, no change to range band.`;
			
			} else if (quarryIsStatic == true || pursuerIsStatic == true) {

				if (0 <= victoryDifference && victoryDifference <= 4) {
					result = `${winner} won by ${victoryDifference}, they may shift range band by one step in either direction because opponent is static, unless instructed otherwise.`;
				} else if (5 <= victoryDifference && victoryDifference <= 9) {
					result = `${winner} won by ${victoryDifference}, they may shift range band by two steps in either direction because opponent is static, unless instructed otherwise.`;
				} else if (victoryDifference >= 10) {
					result = `${winner} won by ${victoryDifference}, they may shift range band by three steps in either direction because opponent is static, unless instructed otherwise.`;
				}

			} else {

				if (1 <= victoryDifference && victoryDifference <= 4) {
					result = `${winner} won by ${victoryDifference}, no change to range band.`;
				} else if (5 <= victoryDifference && victoryDifference <= 9) {
					result = `${winner} won by ${victoryDifference}, they may shift range band by one step in either direction, unless instructed otherwise.`;
				} else if (victoryDifference >= 10) {
					result = `${winner} won by ${victoryDifference}, they may shift range band by two steps in either direction, unless instructed otherwise.`;
				}

			}
			
			let keyValues = {
				chase_content_result: result
			};

			setAttrs(keyValues);

		});

	};

	on("clicked:chase_reset", (event) => {
		chaseResetForm();
	});

	const chaseResetForm = () => {

		let keyValuePairs = {
			chase_round: 1,
			chase_sequence: "none",
			chase_range_band: "none",
			chase_quarry_maneuver: "none",
			chase_quarry_modifier: 0,
			chase_quarry_made_by: 0,
			chase_pursuer_maneuver: "none",
			chase_pursuer_modifier: 0,
			chase_pursuer_made_by: 0,
			chase_content_result: ""
		};

		setAttrs(keyValuePairs);

	};

	on("change:team_effort_starting_level change:team_effort_group_size change:team_effort_knows_skill", event => {
		setTeamEffortFinalSkillLevel();
	});

	const setTeamEffortFinalSkillLevel = () => {

		let fields = [
			"team_effort_starting_level",
			"team_effort_group_size",
			"team_effort_knows_skill"
		];

		getAttrs(fields, values => {

			let startLevel = Number(values.team_effort_starting_level) ?? 3;

			let groupSize = Number(values.team_effort_group_size) ?? 1;

			let groupSizePenalty = -1 * groupSize;

			let knowsSkill = Number(values.team_effort_knows_skill) ?? 1;

			let finalMod = (-1 * groupSize) + knowsSkill;

			let finalSkill = startLevel - groupSize + knowsSkill;

			let description = `Group Size: ${groupSizePenalty}
Characters with Skill: ${knowsSkill}`;

			let keyValues = {
				team_effort_final_level: finalSkill,
				team_effort_modifier: finalMod,
				team_effort_modifier_description: description
			};

			setAttrs(keyValues);

		});

	};

	on("change:extra_effort_will_modifier change:extra_effort_fatigue_modifier change:extra_effort_motivated change:extra_effort_attribute", event => {
		setExtraEffortFinalModifier();
	});

	const setExtraEffortFinalModifier = () => {

		let fields = [
			"extra_effort_will_modifier",
			"extra_effort_fatigue_modifier",
			"extra_effort_motivated",
			"extra_effort_attribute",
		];

		getAttrs(fields, values => {

			let willMod = Number(values.extra_effort_will_modifier) ?? 0;

			let fatigueMod = Number(values.extra_effort_fatigue_modifier) ?? 0;

			let motivated = values.extra_effort_motivated == "1" ? 5 : 0;

			let baseAttribute = Number(values.extra_effort_attribute) ?? 0;

			let finalMod = willMod + fatigueMod + motivated;

			let percentageMod = Math.abs(willMod) * .05;

			let displayPercentageMod = (percentageMod * 100).toFixed(0);

			let adjustedAttribute = baseAttribute + (baseAttribute * percentageMod);

			// round to 2 decimals
			adjustedAttribute = Number(Math.round(adjustedAttribute * 100) / 100).toFixed(2);
	
			let keyValues = {
				extra_effort_final_modifier: finalMod,
				extra_effort_adjusted_attribute: adjustedAttribute,
				extra_effort_display_percentage: displayPercentageMod
			};

			setAttrs(keyValues);

		});

	};

	/**
	 * Check to see if any old macros need to move over 
	 * to the new system
	 */
	const moveOldMacros = () => {

		let fields = [
			"old_macros_moved",
			"skills_custom_macro",
			"custom_macro_defense",
			"custom_macro_melee",
			"custom_macro_ranged",
			"spell_custom_macro"
		];

		getAttrs(fields, values => {

			let hasMoved = values.old_macros_moved == "true";

			let macroSkill = values.skills_custom_macro ?? "";

			let macroDefense = values.custom_macro_defense ?? "";

			let macroMelee = values.custom_macro_melee ?? "";

			let macroRanged = values.custom_macro_ranged ?? "";

			let macroSpell = values.spell_custom_macro;

			if (hasMoved) {
				return;
			}

			let keyValues = {
				old_macros_moved: "true"
			};

			if (macroSkill) {
				keyValues["custom_skill_macro_one_code"] = macroSkill;
			}

			if (macroDefense) {
				keyValues["custom_skill_macro_two_code"] = macroDefense;
			}

			if (macroMelee) {
				keyValues["custom_skill_macro_three_code"] = macroMelee;
			}

			if (macroRanged) {
				keyValues["custom_skill_macro_four_code"] = macroRanged;
			}

			if (macroSpell) {
				keyValues["custom_skill_macro_five_code"] = macroRanged;
			}

			setAttrs(keyValues);

		});

	}

	const setDefaultChatStyle = () => {

		getAttrs(["sheetstyle", "chatstyle_new"], values => {

			let sheetStyle = values.sheetstyle ?? "4";

			let chatStyleNew = values.chatstyle_new == "true" ? true : false;

			if (chatStyleNew) {

				let keyValues = {
					chatstyle: sheetStyle,
					chatstyle_new: "false"
				};

				setAttrs(keyValues);

			}

		});

	}

	const repeatingMacroSections = ["skills", "techniquesrevised", "defense", "melee", "ranged", "spells"];

	repeatingMacroSections.forEach( section => {

		on(`change:repeating_${section}:macro_one_checked change:repeating_${section}:macro_two_checked change:repeating_${section}:macro_three_checked change:repeating_${section}:macro_four_checked change:repeating_${section}:macro_five_checked change:repeating_${section}:macro_six_checked`, event => {

			if (!event.triggerName) {
				return;
			}

			// "repeating_skills_-mtyesgj4ck8yqh-ds9t_macro_two_checked"
			let sourceAttribute = event.sourceAttribute;

			let isChecked = event.newValue == "1";

			let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);

			updateCustomMacroForSection(section, rowId, fieldName, isChecked);

		});

	});

	const updateCustomMacroForSection = (section, rowId, fieldName, isChecked) => {

		let macroNumber = getMacroNumber(fieldName);

		let macroNameField = `custom_skill_macro_${macroNumber}_name`;

		let macroCodeField = `custom_skill_macro_${macroNumber}_code`;

		let fields = [
			macroNameField,
			macroCodeField
		];

		getAttrs(fields, values => {
			
			let macroName = values[macroNameField] ?? "";

			let macroCode = values[macroCodeField] ?? "";

			let sectionMacroCode = "";

			if (isChecked) {

				sectionMacroCode = macroCode;

			}

			let keyValues = {};

			keyValues[`${section}_${rowId}_macro_${macroNumber}_name`] = macroName;

			keyValues[`${section}_${rowId}_macro_${macroNumber}`] = sectionMacroCode;

			setAttrs(keyValues);

		});

	};

	const getMacroNumber = fieldName => {

		let number = 0;

		const numbers = [
			{ number: 1, name: "one"}, 
			{ number: 2, name: "two"}, 
			{ number: 3, name: "three"}, 
			{ number: 4, name: "four"}, 
			{ number: 5, name: "five"}, 
			{ number: 6, name: "six"}, 	
		];

		numbers.forEach (numberObject => {

			if (fieldName.includes(numberObject.name)) {
				number = numberObject.name;
			}

		});

		return number;
	};

	const macroSkillCounts= [
		"one", 
		"two",
		"three",
		"four",
		"five",
		"six"
	];

	const macroSkillActiveDefenses = [
		"dodge",
		"dodge_retreat",
		"dodge_drop",
		"knockback"
	];
	
	macroSkillCounts.forEach(count => {

		on(`change:custom_skill_macro_${count}_name`, event => {

			let skillName = event.newValue ?? "missing";

			repeatingMacroSections.forEach(section => {
				updateMacroSkillNames(section, skillName, count);
			});

			macroSkillActiveDefenses.forEach(defense => {

				updateActiveDefenseMacroNames(defense, skillName, count);

			});

		});

	});

	const updateMacroSkillNames = (section, skillName, count) => {

		getSectionIDs(section, ids => {

			if (ids.length == 0) {
				return;
			}

			let keyValues = {};

			ids.forEach(id => {

				// build the field name, example: repeating_skills_{id}_custom_skill_macro_one_name
				let fieldName = `repeating_${section}_${id}_macro_${count}_name`;

				// set the field to the skill name
				keyValues[fieldName] = skillName;

			});

			setAttrs(keyValues);

		});

	};

	macroSkillCounts.forEach(count => {

		on(`change:custom_skill_macro_${count}_code`, event => {

			let code = event.newValue ?? "";

			repeatingMacroSections.forEach(section => {
				updateMacroSkillCode(section, code, count);
			});

			macroSkillActiveDefenses.forEach(defense => {

				updateActiveDefenseMacros(defense, code, count);

			});

		});

	});

	const updateMacroSkillCode = (section, code, count) => {

		getSectionIDs(section, ids => {

			if (ids.length == 0) {
				return;
			}

			ids.forEach(id => {

				let checkboxFieldName = `repeating_${section}_${id}_macro_${count}_checked`;

				getAttrs([checkboxFieldName], values => {

					let isChecked = values[checkboxFieldName] == "1";

					let codeToUse = "";

					// if checked, use the macro code
					if (isChecked) {
						codeToUse = code;
					}

					// build the field name, example: repeating_skills_{id}_custom_skill_macro_one_name
					let fieldName = `repeating_${section}_${id}_macro_${count}`;

					let keyValues = {};

					// set the field to the skill name
					keyValues[fieldName] = codeToUse;
								
					setAttrs(keyValues);

				});

			});

		});

	};

	const updateActiveDefenseMacroNames = (defense, skillName, count) => {

		// field to udpate: defense_dodge_macro_one_name
		let codeFieldName = `defense_${defense}_macro_${count}_name`;

		let keyValues = {};

		keyValues[codeFieldName] = skillName;

		setAttrs(keyValues);

	}

	const updateActiveDefenseMacros = (defense, code, count) => {
		
		// get the value, looking for: defense_dodge_macro_one_checked
		let checkedFieldName = `defense_${defense}_macro_${count}_checked`;

		let fields = [checkedFieldName];

		getAttrs(fields, values => {

			let isChecked = values[checkedFieldName] == "1";

			let codeToUse = "";

			if (isChecked) {
				codeToUse = code;
			}

			// field to udpate: defense_dodge_macro_one
			let codeFieldName = `defense_${defense}_macro_${count}`;

			let keyValues = {};

			keyValues[codeFieldName] = codeToUse;

			setAttrs(keyValues);

		});

	};

	// we need to check for changes to each type of active defense
	// for each macro, which is number one through six.
	macroSkillActiveDefenses.forEach(defense => {

		macroSkillCounts.forEach(count => {
			
			// looking for: defense_dodge_macro_one_checked
			on(`change:defense_${defense}_macro_${count}_checked`, event => {

				// get global field names and values for the macros
				let macroNameFieldName = `custom_skill_macro_${count}_name`;
				
				let macroCodeFieldName = `custom_skill_macro_${count}_code`;
				
				let fields = [macroNameFieldName, macroCodeFieldName];

				let isChecked = event.newValue == "1";

				getAttrs(fields, values => {

					let name = values[macroNameFieldName] ?? "missing";

					let codeToUse = "";

					if (isChecked) {
						codeToUse = values[macroCodeFieldName];
					}

					// set the name and code
					let keyValues = {};

					keyValues[`defense_${defense}_macro_${count}_name`] = name;

					keyValues[`defense_${defense}_macro_${count}`] = codeToUse;

					setAttrs(keyValues);

				});

			});

		});

	});

	const hearingSteps = new Map([
		["step-none", {step: 0, name: "", translationCode: "", range: 0, endRange: 0, rangeDisplay: "", rangeDisplay: "", decibels: 0, isStealth: false}],
		["step-1", {step: 1, name: "Quiet Breathing", translationCode: "quiet-breathing-option", range: 0.028, endRange: 0.055, rangeDisplay: "1 inch", rangeDisplay: "1\"", decibels: 10, isStealth: false}],
		["step-1-stealth", {step: 1, name: "Critical success on Stealth", translationCode: "critical-success-stealth-option", range: 0.028, endRange: 0.055, rangeDisplay: "1 inch", decibels: 10, isStealth: true}],
		["step-2", {step: 2, name: "Very quiet room", translationCode: "very-quiet-room-option", range: 0.055, endRange: 0.125, rangeDisplay: "2 inches", decibels: 20, isStealth: false}],
		["step-3", {step: 3, name: "Whisper", translationCode: "whisper-option", range: 0.125, endRange: 0.25, rangeDisplay: "4.5 inches", decibels: 30, isStealth: false}],
		["step-4", {step: 4, name: "Leaves rustling, library", translationCode: "leaves-rustling-option", range: 0.25, endRange: 0.5, rangeDisplay: "9 inches", decibels: 40, isStealth: false}],
		["step-4-stealth", {step: 4, name: "Success on stealth", translationCode: "success-stealth-option", range: 0.25, endRange: 0.5, rangeDisplay: "9 inches", decibels: 40, isStealth: true}],
		["step-5", {step: 5, name: "Quiet conversation", translationCode: "quiet-conversation-option", range: 0.5, endRange: 1, rangeDisplay: "1.5 feet", decibels: 50, isStealth: false}],
		["step-6", {step: 6, name: "Conversation, cocking pistol", translationCode: "conversation-cocking-pistol-option", range: 1, endRange: 2, rangeDisplay: "1 yard", decibels: 60, isStealth: false}],
		["step-6-stealth", {step: 6, name: "Failure on Stealth", translationCode: "fail-stealth-option", range: 1, endRange: 2, rangeDisplay: "1 yard", decibels: 60, isStealth: true}],
		["step-7", {step: 7, name: "Light traffic, vacuum cleaner", translationCode: "light-traffic-vacuum-option", range: 2, endRange: 4, rangeDisplay: "2 yards", decibels: 70, isStealth: false}],
		["step-8", {step: 8, name: "Loud conversation", translationCode: "loud-conversation-option", range: 4, endRange: 8, rangeDisplay: "4 yards", decibels: 80, isStealth: false}],
		["step-9", {step: 9, name: "Shout, gasoline engine", translationCode: "shout-gas-engine-option", range: 8, endRange: 16, rangeDisplay: "8 yards", decibels: 90, isStealth: false}],
		["step-9-stealth", {step: 9, name: "Critical failure on Stealth", translationCode: "critical-failure-stealth-option", range: 8, endRange: 16, rangeDisplay: "8 yards", decibels: 90, isStealth: true}],
		["step-10", {step: 10, name: "Silenced pistol, orchestra", translationCode: "silenced-pistol-orchestra-option", range: 16, endRange: 32, rangeDisplay: "16 yards", decibels: 100, isStealth: false}],
		["step-11", {step: 11, name: "Chainsaw, car horn, rock concert", translationCode: "chainsaw-horn-concert-option", range: 32, endRange: 64, rangeDisplay: "32 yards", decibels: 110, isStealth: false}],
		["step-12", {step: 12, name: "Jackhammer", translationCode: "jackhammer-option", range: 64, endRange: 128, rangeDisplay: "64 yards", decibels: 120, isStealth: false}],
		["step-13", {step: 13, name: "Jet takeoff, loud hand clapping, siren", translationCode: "applause-siren-option", range: 128, endRange: 256, rangeDisplay: "128 yards", decibels: 130, isStealth: false}],
		["step-14", {step: 14, name: "Very loud rock band, light pistol, bat sonar", translationCode: "light-pistol-option", range: 256, endRange: 512, rangeDisplay: "256 yards", decibels: 140, isStealth: false}],
		["step-15", {step: 15, name: "Smithy, heavy pistol", translationCode: "smithy-option", range: 512, endRange: 1024, rangeDisplay: "512 yards", decibels: 150, isStealth: false}],
		["step-16", {step: 16, name: "Stun grenade", translationCode: "stun-grenade-option", range: 1024, endRange: 1760, rangeDisplay: "1024 yards", decibels: 160, isStealth: false}],
		["step-17", {step: 17, name: "Jet engine", translationCode: "jet-engine-option", range: 1760, endRange: 3520, rangeDisplay: "1 mile", decibels: 170, isStealth: false}],
		["step-18", {step: 18, name: "Tank gun", translationCode: "tank-gun-option", range: 3520, endRange: 7040, rangeDisplay: "2 miles", decibels: 180, isStealth: false}],
		["step-19", {step: 19, name: "Step 19", translationCode: "step-nineteen-option", range: 7040, endRange: 14080, rangeDisplay: "4 miles", decibels: 190, isStealth: false}],
		["step-20", {step: 20, name: "Explosive shockwave", translationCode: "explosive-shockwave-option", range: 14080, endRange: 28160, rangeDisplay: "8 miles", decibels: 200, isStealth: false}],
		["step-21", {step: 21, name: "Artillery", translationCode: "artillery-option", range: 28160, endRange: 56320, rangeDisplay: "16 miles", decibels: 210, isStealth: false}],
		["step-22", {step: 22, name: "Dolphin sonar", translationCode: "dolphin-sonar-option", range: 56320, endRange: 999999, rangeDisplay: "32 miles", decibels: 220, isStealth: false}],
	]);

	// key is decibel. If sound is equal to or greater than the key, apply the pain effect
	const hearingPainEffects = [
		{step: 13, decibels: 130, range: 128, name: "Moderate Pain", description: "-2 to all DX, IQ, skill, and self-control rolls."},
		{step: 15, decibels: 150, range: 512, name: "Severe Pain", description: "-4 to all DX, IQ, skill, and self-control rolls."},
		{step: 17, decibels: 170, range: 512, name: "Terrible Pain", description: "-6 to all DX, IQ, skill, and self-control rolls."},
	];

	on("change:hearing_sound_source_sort_by", event => {

		resetHearingDropDowns();

	});

	const resetHearingDropDowns = () => {

		const keyValues = {
			hearing_sound_source: "step-none"
		};

		setAttrs(keyValues);

	}

	on("change:hearing_sound_source change:hearing_distance change:hearing_tunnel_width change:hearing_protected", event => {

		updateHearingFields();

	});

	const updateHearingFields = () => {
		
		let fields = [
			"hearing_sound_source",
			"hearing_distance",
			"hearing_tunnel_width",
			"hearing_protected"
		];

		getAttrs(fields, values => {

			let hearingStepKey = values.hearing_sound_source ?? "";

			let hearingStepData = hearingSteps.get(hearingStepKey);

			let distance = Number(values.hearing_distance) ?? 1;

			let tunnelWidth = Number(values.hearing_tunnel_width) ?? 0;

			let applyTunnelRule = tunnelWidth > 0 && distance > tunnelWidth;

			let listenerStep = getHearingStepBasedOnRange(distance);

			let stepDifference = hearingStepData.step - listenerStep;

			let protectedHearingMod = values.hearing_protected == "1" ? 5 : 0;

			let hearingEffects = [];

			let exposureEffect = getHearingExposureEffect(hearingStepData, distance, protectedHearingMod);

			if (exposureEffect) {
				hearingEffects.push(exposureEffect);
			}

			let painEffect = getHearingPainEffect(hearingStepData, distance);

			if (painEffect) {
				hearingEffects.push(painEffect);
			}

			let injuryEffect = getHearingInjuryEffect(hearingStepData, distance, protectedHearingMod);

			if (injuryEffect) {
				hearingEffects.push(injuryEffect);
			}

			let effects = hearingEffects.join("\n");

			let hearingModifier = stepDifference;

			if (applyTunnelRule) {
				hearingModifier = Math.floor(stepDifference/2);
			}

			let keyValues = {
				hearing_sound_base_range: hearingStepData.rangeDisplay,
				hearing_step_difference: stepDifference,
				hearing_effects: effects,
				hearing_modifier: hearingModifier
			};

			setAttrs(keyValues);

		});
		
	}

	const getHearingStepBasedOnRange = (distance) => {

		let step = 6;

		let matchFound = false;

		for (const [key, stepData] of hearingSteps) {

			if (matchFound == false && stepData.range <= distance && distance < stepData.endRange) {
				step = stepData.step;
				matchFound = true;
			}

		}

		return step;

	}

	const getHearingExposureEffect = (hearingStepData, distance, protectedHearingMod) => {

		let effect = "";

		let healthRoll = "HT";

		let healthMod = 0;

		let decibelMod = 0;

		let arrModifiers = [];

		let modifiers = "";

		if (hearingStepData.decibels >= 100 && distance <= hearingStepData.range) {

			if (hearingStepData.decibels > 130) {

				decibelMod = Math.floor( (hearingStepData.decibels - 130) / 10) * -1;

				arrModifiers.push(`${decibelMod} decibel level penalty.`);
				
			}

			if (protectedHearingMod > 0) {
				arrModifiers.push("+5 for Protected Hearing.");
			}

			if (arrModifiers.length) {
				modifiers = "Modifiers: " + arrModifiers.join(" ");
			}

			healthMod = decibelMod + protectedHearingMod;

			if (healthMod < 0) {
				healthRoll = `HT${healthMod}`;
			} else if (healthMod > 0) {
				healthRoll = `HT+${healthMod}`;
			}

			effect = `Suffer tinnitus and Hard of Hearing for the remainder of the day, then roll vs ${healthRoll} to avoid long term Hard of Hearing effects. On failure, it lasts 1d6 months. On critical failure, it is permanent. ${modifiers}`;

		}

		return effect;

	}

	const getHearingPainEffect = (hearingStepData, distance) => {

		let effect = "";

		if (distance <= hearingStepData.range ) {
			
			let entry = hearingPainEffects.find(painEffect => {
				
				return painEffect.decibels <= hearingStepData.decibels;

			});

			if (entry) {
				effect = `${entry.name}. ${entry.description}`;
			}
		}

		return effect;

	}

	const getHearingInjuryEffect = (hearingStepData, distance, protectedHearingMod) => {

		let effect = "";

		if (distance <= hearingStepData.range && hearingStepData.decibels >= 190) {
			
			let healthRoll = "HT";

			let decibelMod = Math.round((hearingStepData.decibels - 190)/10) * -5;

			let healthMod = decibelMod + protectedHearingMod;

			if (healthMod < 0) {
				healthRoll = `HT${healthMod}`;
			} else if (healthMod > 0) {
				healthRoll = `HT+${healthMod}`;
			}

			effect = `Roll vs ${healthRoll} to avoid ear injury! Failure results in Deafness for 1d6 months, and critical failure is a ruptured eardrum and permanent Deafness.`;
			
		}

		return effect;

	}

	/**
     * Helper - the data passed through in an action button needs these characters escaped
	 * I've used a mongrel escape sequence to avoid triggering anything internal in Roll20
	 * This may not be a complete list of characters that need escaping! If you have heavily
	 * punctuated text, it might break the passthrough!
	 * see: https://app.roll20.net/forum/permalink/10346884/
	 */
	const rollEscape = {
		
		chars: {
			'"': '%quot;',
			',': '%comma;',
			':': '%colon;',
			'}': '%rcub;',
			'{': '%lcub;',
		},
		
		escape(str) {
			str = (typeof(str) === 'object') ? JSON.stringify(str) : (typeof(str) === 'string') ? str : null;
			return (str) ? `${str}`.replace(new RegExp(`[${Object.keys(this.chars)}]`, 'g'), (r) => this.chars[r]) : null;
		},
		unescape(str) {
			str = `${str}`.replace(new RegExp(`(${Object.values(this.chars).join('|')})`, 'g'), (r) => Object.entries(this.chars).find(e=>e[1]===r)[0]);
			return JSON.parse(str);
		}
	}

	// define buttons we want to look for events when roll is clicked
	const rollButtons = [
		"repeating_skills:skillroll", 
		"repeating_techniquesrevised:skillroll",
		"repeating_defense:skillroll",
		"repeating_melee:skillroll",
		"repeating_ranged:skillroll",
		"repeating_spells:skillroll",
		"roll_attribute_strength", 
		"roll_attribute_dexterity",
		"roll_attribute_intelligence",
		"roll_attribute_health",
		"roll_attribute_perception",
		"roll_attribute_vision",
		"roll_attribute_hearing",
		"roll_attribute_smell",
		"roll_attribute_touch",
		"roll_attribute_willpower",
		"roll_attribute_fright_check",
		"roll_attribute_stun_check",
		"roll_attribute_knockdown_check",
		"roll_attribute_unconscious_check",
		"roll_attribute_death_check",
		"roll_active_defense_dodge",
		"roll_active_defense_dodge_retreat",
		"roll_active_defense_dodge_drop",
		"roll_active_defense_knockback",
		"roll_attack_melee_slam",
		"roll_attack_ranged_fragmentation_damage",
		"roll_skill_team_effort",
		"roll_attribute_object_health",
		"roll_skill_object_repair",
		"roll_skill_stealth",
		"roll_skill_vision",
		"roll_skill_hearing",
		"roll_skill_cold",
		"roll_skill_heat",
		"roll_skill_breaking_bindings",
		"roll_skill_drinking",
		"roll_skill_hangover",
		"roll_skill_sober_up",
	];

	rollButtons.forEach( button => {

		on(`clicked:${button}`, async (event) => {

			const source = event.triggerName ?? "";

			if (source.includes("repeating_skills")) {

				await rollRepeatingSkillRoll(event);

			} else if (source.includes("repeating_techniquesrevised")) {

				await rollRepeatingTechniques(event);

			} else if (source.includes("repeating_defense")) {

				await rollRepeatingDefense(event);

			} else if (source.includes("repeating_melee")) {

				await rollRepeatingMelee(event);

			} else if (source.includes("repeating_ranged")) {

				await rollRepeatingRanged(event);

			} else if (source.includes("repeating_spells")) {

				await rollRepeatingSpells(event);

			} else if (source.includes("roll_attribute")) {

				await rollAttributeSkillRoll(event);

			} else if (source.includes("roll_active_defense")) {

				// TODO: change if we need custom stuff for defenses
				await rollAttributeSkillRoll(event);

			} else if (source.includes("roll_attack_melee")) {

				// TODO: change if we need custom stuff for melee attacks
				await rollAttributeSkillRoll(event);

			} else if (source.includes("roll_attack_ranged")) {
				
				await rollAttackRangedSkillRoll(event);

			} else if (source.includes("roll_skill_cold")) {
				
				// TODO: change if we need custom stuff for skills
				await rollColdSkillRollCold(event);

			} else if (source.includes("roll_skill_heat")) {
				
				// TODO: change if we need custom stuff for skills
				await rollHeatSkillRollCold(event);

			} else if (source.includes("roll_skill")) {
				
				// TODO: change if we need custom stuff for skills
				await rollAttributeSkillRoll(event);

			} 

		});

	});

	const rollAttributeSkillRoll = async (event) => {

		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollAttributeSkillRoll: Data Error", event);
			return;
		}

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const rollColdSkillRollCold = async (event) => {

		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollColdSkillRollCold: Data Error", event);
			return;
		}

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const rollHeatSkillRollCold = async (event) => {

		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollHeatSkillRollCold: Data Error", event);
			return;
		}

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const rollAttackRangedSkillRoll = async (event) => {

		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollAttributeSkillRoll: Data Error", event);
			return;
		}

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}} {{hits=[[0]]}}";

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;
		
		// check for shots fired and recoil
		const recoil = skillRoll.results?.recoil?.result || 0;

		const max = skillRoll.results?.shotFired?.result || 0;

		let hits = 0;

		if (recoil > 0) {
			hits = Math.floor(difference / recoil) + 1;
		}

		// check for max, hits can't exceed the max value.
		if (max > 0 && hits > max) {
			hits = max;
		}

		let customData = {
			rollDifference: difference,
			hits: hits
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const getNumberOfHits = (recoil, max, difference) => {

		let hits = 0;

		if (difference >= 0 && recoil > 0) {
			hits = Math.floor(difference / recoil) + 1;
		}

		// check for max, hits can't exceed the max value.
		if (max > 0 && hits > max) {
			hits = max;
		}

		return hits;
	}

	const rollRepeatingSkillRoll = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollAttributeSkillRoll: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let skillRollData = await getRepeatingSkillsRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const globalSkillFields = [
		"skill_roll_max_nine_value",
		"skill_roll_max_nine",
		"skill_roll_trait_summary",	
	];

	const skillFields = [
		"name",
		"tl",
		"level",
		"notes",
		"show_notes",
		"ref",
		"skill_success_note",
		"skill_critical_success_note",
		"skill_fail_note",
		"skill_critical_fail_note",
		"show_skill_mod_notes",
		"skill_mod_description_notes",
		"show_skill_conditionals",
		"skill_conditional_notes",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingSkillsRollData = async (rowId) => {

		let fields = skillFields.map(field => `repeating_skills_${rowId}_${field}`);

		let globalValues = await getAttrsAsync(globalSkillFields);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let name = values[`repeating_skills_${rowId}_name`] ?? "";

		let tl = values[`repeating_skills_${rowId}_tl`] ?? "";

		let level = values[`repeating_skills_${rowId}_level`] ?? "10";

		let skillRollMaxNine = globalValues[`skill_roll_max_nine`] ?? "0";

		let skillRollMaxNineValue = globalValues[`skill_roll_max_nine_value`] ?? "100";

		let skillRollTraitSummary = globalValues[`skill_roll_trait_summary`] ?? "";

		let notes = values[`repeating_skills_${rowId}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let showNotes = values[`repeating_skills_${rowId}_show_notes`] ?? "0";

		let ref = values[`repeating_skills_${rowId}_ref`] ?? "";

		let skillSuccessNote = values[`repeating_skills_${rowId}_skill_success_note`] ?? "";
		skillSuccessNote = skillSuccessNote.replace(/\n/g, '\\n');

		let skillCriticalSuccessNote = values[`repeating_skills_${rowId}_skill_critical_success_note`] ?? "";
		skillCriticalSuccessNote = skillCriticalSuccessNote.replace(/\n/g, '\\n');

		let skillFailNote = values[`repeating_skills_${rowId}_skill_fail_note`] ?? "";
		skillFailNote = skillFailNote.replace(/\n/g, '\\n');

		let skillCriticalFailNote = values[`repeating_skills_${rowId}_skill_critical_fail_note`] ?? "";
		skillCriticalFailNote = skillCriticalFailNote.replace(/\n/g, '\\n');

		let showSkillModNotes = values[`repeating_skills_${rowId}_show_skill_mod_notes`] ?? "";
		showSkillModNotes = showSkillModNotes.replace(/\n/g, '\\n');

		let skillModDescriptionNotes = values[`repeating_skills_${rowId}_skill_mod_description_notes`] ?? "";
		skillModDescriptionNotes = skillModDescriptionNotes.replace(/\n/g, '\\n');

		let showSkillConditionals = values[`repeating_skills_${rowId}_show_skill_conditionals`] ?? "";
		showSkillConditionals = showSkillConditionals.replace(/\n/g, '\\n');

		let skillConditionalNotes = values[`repeating_skills_${rowId}_skill_conditional_notes`] ?? "";
		skillConditionalNotes = skillConditionalNotes.replace(/\n/g, '\\n');

		let macroOneChecked = values[`repeating_skills_${rowId}_macro_one_checked`] ?? "0";

		let macroOne = values[`repeating_skills_${rowId}_macro_one`] ?? "";

		let macroTwoChecked = values[`repeating_skills_${rowId}_macro_two_checked`] ?? "0";

		let macroTwo = values[`repeating_skills_${rowId}_macro_two`] ?? "";

		let macroThreeChecked = values[`repeating_skills_${rowId}_macro_three_checked`] ?? "0";

		let macroThree = values[`repeating_skills_${rowId}_macro_three`] ?? "";

		let macroFourChecked = values[`repeating_skills_${rowId}_macro_four_checked`] ?? "0";

		let macroFour = values[`repeating_skills_${rowId}_macro_four`] ?? "";

		let macroFiveChecked = values[`repeating_skills_${rowId}_macro_five_checked`] ?? "0";

		let macroFive = values[`repeating_skills_${rowId}_macro_five`] ?? "";

		let macroSixChecked = values[`repeating_skills_${rowId}_macro_six_checked`] ?? "0";

		let macroSix = values[`repeating_skills_${rowId}_macro_six`] ?? "";

		let rollDataArray = [];

		if (name) {
			rollDataArray.push(`{{skillName=${name}}}`);
		} 
		
		if(tl) {
			rollDataArray.push(`{{skillNameTechLevel=${tl}}} `);
		}
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{skill_roll_modifier}, ${skillRollMaxNineValue} }kl1]]}}`);

		if (skillRollMaxNine) {
			rollDataArray.push(`{{maxNine=[[${skillRollMaxNine}]]}}`);
		}

		if (skillRollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${skillRollTraitSummary}}}`);
		}
		
		if (notes) {
			rollDataArray.push(`{{notes=${notes}}}`);
		}

		rollDataArray.push(`{{showNotes=[[${showNotes}]]}}`);

		if (ref) {
			rollDataArray.push(`{{bookReference=${ref}}}`);
		}

		if (skillSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${skillSuccessNote}}}`);
		}

		if (skillCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${skillCriticalSuccessNote}}}`);
		}

		if (skillFailNote) {
			rollDataArray.push(`{{customFailNote=${skillFailNote}}}`);
		}

		if (skillCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${skillCriticalFailNote}}}`);
		}

		if (showSkillModNotes) {
			rollDataArray.push(`{{noteBoxOneShow=[[${showSkillModNotes}]]}}`);
		}

		if (skillModDescriptionNotes) {
			rollDataArray.push(`{{noteBoxOneContent=${skillModDescriptionNotes}}}`);
		}

		if (showSkillConditionals) {
			rollDataArray.push(`{{noteBoxTwoShow=[[${showSkillConditionals}]]}}`);
		}

		if (skillConditionalNotes) {
			rollDataArray.push(`{{noteBoxTwoContent=${skillConditionalNotes}}}`);
		}

		
		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return rollData;

	}

	const rollRepeatingTechniques = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollRepeatingTechniques: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let skillRollData = await getRepeatingTechniquesRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);


	}

	const globalTechniqueFields = [
		"technique_roll_max_nine_value",
		"technique_roll_max_nine",
		"technique_roll_trait_summary",	
	];

	const techniqueFields = [
		"name",
		"parent",
		"level",
		"notes",
		"show_notes_revised",
		"ref",
		"skill_success_note",
		"skill_critical_success_note",
		"skill_fail_note",
		"skill_critical_fail_note",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingTechniquesRollData = async (rowId) => {

		const sectionName = `repeating_techniquesrevised_${rowId}`;

		let fields = techniqueFields.map(field => `${sectionName}_${field}`);

		let globalValues = await getAttrsAsync(globalTechniqueFields);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let name = values[`${sectionName}_name`] ?? "";

		let parent = values[`${sectionName}_parent`] ?? "";

		let level = values[`${sectionName}_level`] ?? "10";

		let techniqueRollMaxNine = globalValues[`technique_roll_max_nine`] ?? "0";

		let techniqueRollMaxNineValue = globalValues[`technique_roll_max_nine_value`] ?? "100";

		let techniqueRollTraitSummary = globalValues[`technique_roll_trait_summary`] ?? "";

		let notes = values[`${sectionName}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let showNotes = values[`${sectionName}_show_notes_revised`] ?? "0";

		let ref = values[`${sectionName}_ref`] ?? "";

		let skillSuccessNote = values[`${sectionName}_skill_success_note`] ?? "";
		skillSuccessNote = skillSuccessNote.replace(/\n/g, '\\n');

		let skillCriticalSuccessNote = values[`${sectionName}_skill_critical_success_note`] ?? "";
		skillCriticalSuccessNote = skillCriticalSuccessNote.replace(/\n/g, '\\n');

		let skillFailNote = values[`${sectionName}_skill_fail_note`] ?? "";
		skillFailNote = skillFailNote.replace(/\n/g, '\\n');

		let skillCriticalFailNote = values[`${sectionName}_skill_critical_fail_note`] ?? "";
		skillCriticalFailNote = skillCriticalFailNote.replace(/\n/g, '\\n');

		let macroOneChecked = values[`${sectionName}_macro_one_checked`] ?? "0";

		let macroOne = values[`${sectionName}_macro_one`] ?? "";

		let macroTwoChecked = values[`${sectionName}_macro_two_checked`] ?? "0";

		let macroTwo = values[`${sectionName}_macro_two`] ?? "";

		let macroThreeChecked = values[`${sectionName}_macro_three_checked`] ?? "0";

		let macroThree = values[`${sectionName}_macro_three`] ?? "";

		let macroFourChecked = values[`${sectionName}_macro_four_checked`] ?? "0";

		let macroFour = values[`${sectionName}_macro_four`] ?? "";

		let macroFiveChecked = values[`${sectionName}_macro_five_checked`] ?? "0";

		let macroFive = values[`${sectionName}_macro_five`] ?? "";

		let macroSixChecked = values[`${sectionName}_macro_six_checked`] ?? "0";

		let macroSix = values[`${sectionName}_macro_six`] ?? "";

		let rollDataArray = [];

		if (name) {
			rollDataArray.push(`{{skillName=${name}}}`);
		} 
		
		if(parent) {
			rollDataArray.push(`{{parentName=${parent}}} `);
		}
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{technique_roll_modifier}, ${techniqueRollMaxNineValue} }kl1]]}}`);

		if (techniqueRollMaxNine) {
			rollDataArray.push(`{{maxNine=[[${techniqueRollMaxNine}]]}}`);
		}

		if (techniqueRollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${techniqueRollTraitSummary}}}`);
		}
		
		if (notes) {
			rollDataArray.push(`{{notes=${notes}}}`);
		}

		rollDataArray.push(`{{showNotes=[[${showNotes}]]}}`);

		if (ref) {
			rollDataArray.push(`{{bookReference=${ref}}}`);
		}

		if (skillSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${skillSuccessNote}}}`);
		}

		if (skillCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${skillCriticalSuccessNote}}}`);
		}

		if (skillFailNote) {
			rollDataArray.push(`{{customFailNote=${skillFailNote}}}`);
		}

		if (skillCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${skillCriticalFailNote}}}`);
		}

		
		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return rollData;

	}

	const rollRepeatingDefense = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollRepeatingDefense: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let skillRollData = await getRepeatingDefenseRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const globalDefenseFields = [
		"defense_roll_max_nine_value",
		"defense_roll_max_nine",
		"defense_roll_trait_summary",	
	];

	const defenseFields = [
		"defense_type",
		"defense_combat_reflexes_bonus",
		"type",
		"name",
		"skill",
		"skill_mod",
		"level",
		"show_notes",
		"info_description",
		"notes",
		"raw_success_note",
		"raw_critical_success_note",
		"raw_fail_note",
		"raw_critical_fail_note",
		"defense_success_note",
		"defense_critical_success_note",
		"defense_fail_note",
		"defense_critical_fail_note",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingDefenseRollData = async (rowId) => {

		const sectionName = `repeating_defense_${rowId}`;

		let fields = defenseFields.map(field => `${sectionName}_${field}`);

		let globalValues = await getAttrsAsync(globalDefenseFields);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let defenseType = values[`${sectionName}_defense_type`] ?? "Error";

		let skillName = values[`${sectionName}_type`] ?? "";

		let subSkillName = values[`${sectionName}_name`] ?? "";

		let baseSkillLevel = Number(values[`${sectionName}_skill`]) ?? 10;

		let skillLevelMod = Number(values[`${sectionName}_skill_mod`]) ?? 0;
		
		let combatReflexes = Number(values[`${sectionName}_defense_combat_reflexes_bonus`]) ?? 0;

		let level = baseSkillLevel + skillLevelMod + combatReflexes;

		let defenseRollMaxNine = globalValues[`defense_roll_max_nine`] ?? "0";

		let defenseRollMaxNineValue = globalValues[`defense_roll_max_nine_value`] ?? "100";

		let defenseRollTraitSummary = globalValues[`defense_roll_trait_summary`] ?? "";

		let showNotes = values[`${sectionName}_show_notes`] ?? "0";

		let notes = values[`${sectionName}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let infoDescription = values[`${sectionName}_info_description`] ?? "";
		infoDescription = infoDescription.replace(/\n/g, '\\n');

		let finalNotesArray = [];

		if (notes) {
			finalNotesArray.push(notes);
		}  
		
		if (infoDescription) {
			finalNotesArray.push(infoDescription);
		}

		let finalNotes = finalNotesArray.join("\\n");

		let rawSuccessNote = values[`${sectionName}_raw_success_note`] ?? "";
		
		let rawCriticalSuccessNote = values[`${sectionName}_raw_critical_success_note`] ?? "";

		let rawFailNote = values[`${sectionName}_raw_fail_note`] ?? "";

		let rawCriticalFailNote = values[`${sectionName}_raw_critical_fail_note`] ?? "";

		let defenseSuccessNote = values[`${sectionName}_defense_success_note`] ?? "";
		defenseSuccessNote = defenseSuccessNote.replace(/\n/g, '\\n');

		let defenseCriticalSuccessNote = values[`${sectionName}_defense_critical_success_note`] ?? "";
		defenseCriticalSuccessNote = defenseCriticalSuccessNote.replace(/\n/g, '\\n');

		let defenseFailNote = values[`${sectionName}_defense_fail_note`] ?? "";
		defenseFailNote = defenseFailNote.replace(/\n/g, '\\n');

		let defenseCriticalFailNote = values[`${sectionName}_defense_critical_fail_note`] ?? "";
		defenseCriticalFailNote = defenseCriticalFailNote.replace(/\n/g, '\\n');

		let macroOneChecked = values[`${sectionName}_macro_one_checked`] ?? "0";

		let macroOne = values[`${sectionName}_macro_one`] ?? "";

		let macroTwoChecked = values[`${sectionName}_macro_two_checked`] ?? "0";

		let macroTwo = values[`${sectionName}_macro_two`] ?? "";

		let macroThreeChecked = values[`${sectionName}_macro_three_checked`] ?? "0";

		let macroThree = values[`${sectionName}_macro_three`] ?? "";

		let macroFourChecked = values[`${sectionName}_macro_four_checked`] ?? "0";

		let macroFour = values[`${sectionName}_macro_four`] ?? "";

		let macroFiveChecked = values[`${sectionName}_macro_five_checked`] ?? "0";

		let macroFive = values[`${sectionName}_macro_five`] ?? "";

		let macroSixChecked = values[`${sectionName}_macro_six_checked`] ?? "0";

		let macroSix = values[`${sectionName}_macro_six`] ?? "";

		let rollDataArray = [];

		if (defenseType) {
			rollDataArray.push(`{{defenseType=${defenseType}}}`);
		}

		if (skillName) {
			rollDataArray.push(`{{type=Defense Roll ${skillName}}}`);
			rollDataArray.push(`{{skillName=${skillName}}}`);
		}

		if (subSkillName) {
			rollDataArray.push(`{{subSkillName=using ${subSkillName}}}`);
		} 
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{defense_roll_modifier}, ${defenseRollMaxNineValue} }kl1]]}}`);

		if (defenseRollMaxNine) {
			rollDataArray.push(`{{maxNine=[[${defenseRollMaxNine}]]}}`);
		}

		if (defenseRollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${defenseRollTraitSummary}}}`);
		}
		
		rollDataArray.push(`{{showNotes=[[${showNotes}]]}}`);

		if (finalNotes) {
			rollDataArray.push(`{{notes=${finalNotes}}}`);
		}

		if (defenseSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${defenseSuccessNote}}}`);
		}

		if (defenseCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${defenseCriticalSuccessNote}}}`);
		}

		if (defenseFailNote) {
			rollDataArray.push(`{{customFailNote=${defenseFailNote}}}`);
		}

		if (defenseCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${defenseCriticalFailNote}}}`);
		}

		if (rawSuccessNote) {
			rollDataArray.push(`{{rawSuccessNote=${rawSuccessNote}}}`);
		}

		if (rawCriticalSuccessNote) {
			rollDataArray.push(`{{rawCriticalSuccessNote=${rawCriticalSuccessNote}}}`);
		}

		if (rawFailNote) {
			rollDataArray.push(`{{rawFailNote=${rawFailNote}}}`);
		}

		if (rawCriticalFailNote) {
			rollDataArray.push(`{{rawCriticalFailNote=${rawCriticalFailNote}}}`);
		}

		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return rollData;

	}

	const rollRepeatingMelee = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollRepeatingMelee: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let skillRollData = await getRepeatingMeleeRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const globalMeleeFields = [
		"melee_roll_max_nine_value",
		"melee_roll_max_nine",
		"melee_roll_trait_summary",
		"melee_roll_hit_location",
		"melee_roll_maneuver",
		"melee_roll_allout_attack",
	];

	const meleeFields = [
		"name",
		"ref",
		"skill",
		"reach",
		"notes",
		"success_notes",
		"critical_success_notes",
		"fail_notes",
		"critical_fail_notes",
		"show_raw_defensive_notes",
		"raw_hit_notes",
		"raw_critical_hit_notes",
		"raw_miss_notes",
		"raw_critical_miss_notes",
		"weapon_weight",
		"parrying_weapon_weight",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingMeleeRollData = async (rowId) => {

		const sectionName = `repeating_melee_${rowId}`;

		let fields = meleeFields.map(field => `${sectionName}_${field}`);

		let globalValues = await getAttrsAsync(globalMeleeFields);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let skillName = values[`${sectionName}_name`] ?? "";

		let bookReference = values[`${sectionName}_ref`] ?? "";

		let level = values[`${sectionName}_skill`] ?? "10";

		let meleeRollMaxNine = globalValues[`melee_roll_max_nine`] ?? "0";

		let meleeRollMaxNineValue = globalValues[`melee_roll_max_nine_value`] ?? "100";

		let meleeRollTraitSummary = globalValues[`melee_roll_trait_summary`] ?? "";

		let hitLocation = globalValues[`melee_roll_hit_location`] ?? "";

		let maneuver = globalValues[`melee_roll_maneuver`] ?? "";

		let allOutAttack = globalValues[`melee_roll_allout_attack`] ?? "";

		let reach = values[`${sectionName}_reach`] ?? "";

		let notes = values[`${sectionName}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let customSuccessNote = values[`${sectionName}_success_notes`] ?? "";

		let customCriticalSuccessNote = values[`${sectionName}_critical_success_notes`] ?? "";

		let customFailNote = values[`${sectionName}_fail_notes`] ?? "";

		let customCriticalFailNote = values[`${sectionName}_critical_fail_notes`] ?? "";

		let rawSuccessNote = values[`${sectionName}_raw_hit_notes`] ?? "";
		
		let rawCriticalSuccessNote = values[`${sectionName}_raw_critical_hit_notes`] ?? "";

		let rawFailNote = values[`${sectionName}_raw_miss_notes`] ?? "";

		let rawCriticalFailNote = values[`${sectionName}_raw_critical_miss_notes`] ?? "";

		let weaponWeight = values[`${sectionName}_weapon_weight`] ?? "0";

		let parryingWeaponWeight = values[`${sectionName}_parrying_weapon_weight`] ?? "0";

		let macroOneChecked = values[`${sectionName}_macro_one_checked`] ?? "0";

		let macroOne = values[`${sectionName}_macro_one`] ?? "";

		let macroTwoChecked = values[`${sectionName}_macro_two_checked`] ?? "0";

		let macroTwo = values[`${sectionName}_macro_two`] ?? "";

		let macroThreeChecked = values[`${sectionName}_macro_three_checked`] ?? "0";

		let macroThree = values[`${sectionName}_macro_three`] ?? "";

		let macroFourChecked = values[`${sectionName}_macro_four_checked`] ?? "0";

		let macroFour = values[`${sectionName}_macro_four`] ?? "";

		let macroFiveChecked = values[`${sectionName}_macro_five_checked`] ?? "0";

		let macroFive = values[`${sectionName}_macro_five`] ?? "";

		let macroSixChecked = values[`${sectionName}_macro_six_checked`] ?? "0";

		let macroSix = values[`${sectionName}_macro_six`] ?? "";

		let rollDataArray = [];

		if (skillName) {
			rollDataArray.push(`{{skillName=${skillName}}}`);
		}

		if (bookReference) {
			rollDataArray.push(`{{bookReference=${bookReference}}}`);
		}
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{melee_roll_modifier} + @{melee_quick_mod_total}, ${meleeRollMaxNineValue} }kl1]]}}`);

		if (meleeRollMaxNine) {
			rollDataArray.push(`{{maxNine=[[${meleeRollMaxNine}]]}}`);
		}
		
		if (meleeRollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${meleeRollTraitSummary}}}`);
		}

		if (hitLocation) {
			rollDataArray.push(`{{hitLocation=${hitLocation}}}`);
		}

		if (maneuver) {
			rollDataArray.push(`{{maneuver=${maneuver}}}`);
		}

		if (allOutAttack) {
			rollDataArray.push(`{{allOutAttack=${allOutAttack}}}`);
		}

		if (reach) {
			rollDataArray.push(`{{reach=${reach}}}`);
		}
		
		if (notes) {
			rollDataArray.push(`{{notes=${notes}}}`);
		}

		if (customSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${customSuccessNote}}}`);
		}

		if (customCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${customCriticalSuccessNote}}}`);
		}

		if (customFailNote) {
			rollDataArray.push(`{{customFailNote=${customFailNote}}}`);
		}

		if (customCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${customCriticalFailNote}}}`);
		}

		if (rawSuccessNote) {
			rollDataArray.push(`{{rawSuccessNote=${rawSuccessNote}}}`);
		}

		if (rawCriticalSuccessNote) {
			rollDataArray.push(`{{rawCriticalSuccessNote=${rawCriticalSuccessNote}}}`);
		}

		if (rawFailNote) {
			rollDataArray.push(`{{rawFailNote=${rawFailNote}}}`);
		}

		if (rawCriticalFailNote) {
			rollDataArray.push(`{{rawCriticalFailNote=${rawCriticalFailNote}}}`);
		}

		if (weaponWeight > 0) {
			rollDataArray.push(`{{weaponWeight=${weaponWeight}}}`);
		}

		if (parryingWeaponWeight > 0) {
			rollDataArray.push(`{{parryingWeaponWeight=${parryingWeaponWeight}}}`);
		}

		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return rollData;

	}

	const rollRepeatingRanged = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollRepeatingRanged: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let [skillRollData, recoil] = await getRepeatingRangedRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}} {{hits=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		const max = skillRoll.results?.shotsFired?.result || 0;

		hits = getNumberOfHits(recoil, max, difference);

		let customData = {
			rollDifference: difference,
			hits: hits
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const globalRangedFields = [
		"ranged_roll_max_nine_value",
		"ranged_roll_max_nine",
		"ranged_roll_trait_summary",
		"ranged_roll_hit_location",
		"ranged_roll_maneuver",
		"ranged_roll_allout_attack",
	];

	const rangedFields = [
		"name",
		"ref",
		"skill",
		"notes",
		"rof",
		"shots_fired_macro",
		"recoil",
		"malfunction",
		"malfunction_verify",
		"malfunction_very_reliable",
		"success_notes",
		"critical_success_notes",
		"fail_notes",
		"critical_fail_notes",
		"show_raw_defensive_notes",
		"raw_hit_notes",
		"raw_critical_hit_notes",
		"raw_miss_notes",
		"raw_critical_miss_notes",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingRangedRollData = async (rowId) => {

		const sectionName = `repeating_ranged_${rowId}`;

		let fields = rangedFields.map(field => `${sectionName}_${field}`);

		let globalValues = await getAttrsAsync(globalRangedFields);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let skillName = values[`${sectionName}_name`] ?? "";

		let bookReference = values[`${sectionName}_ref`] ?? "";

		let level = values[`${sectionName}_skill`] ?? "10";

		let rangedRollMaxNine = globalValues[`ranged_roll_max_nine`] ?? "0";

		let rangedRollMaxNineValue = globalValues[`ranged_roll_max_nine_value`] ?? "100";

		let rangedRollTraitSummary = globalValues[`ranged_roll_trait_summary`] ?? "";

		let hitLocation = globalValues[`ranged_roll_hit_location`] ?? "";

		let maneuver = globalValues[`ranged_roll_maneuver`] ?? "";

		let allOutAttack = globalValues[`ranged_roll_allout_attack`] ?? "";

		let notes = values[`${sectionName}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let rof = values[`${sectionName}_rof`] ?? "1";

		let shotsFired = values[`${sectionName}_shots_fired_macro`] ?? "";

		let recoil = values[`${sectionName}_recoil`] ?? "-1";

		let malfunction = values[`${sectionName}_malfunction`] ?? "0";

		let verifyMalfunction = values[`${sectionName}_malfunction_verify`] ?? "0";

		let veryReliable = values[`${sectionName}_malfunction_very_reliable`] ?? "0";

		let customSuccessNote = values[`${sectionName}_success_notes`] ?? "";

		let customCriticalSuccessNote = values[`${sectionName}_critical_success_notes`] ?? "";

		let customFailNote = values[`${sectionName}_fail_notes`] ?? "";

		let customCriticalFailNote = values[`${sectionName}_critical_fail_notes`] ?? "";

		let rawSuccessNote = values[`${sectionName}_raw_hit_notes`] ?? "";
		
		let rawCriticalSuccessNote = values[`${sectionName}_raw_critical_hit_notes`] ?? "";

		let rawFailNote = values[`${sectionName}_raw_miss_notes`] ?? "";

		let rawCriticalFailNote = values[`${sectionName}_raw_critical_miss_notes`] ?? "";

		let macroOneChecked = values[`${sectionName}_macro_one_checked`] ?? "0";

		let macroOne = values[`${sectionName}_macro_one`] ?? "";

		let macroTwoChecked = values[`${sectionName}_macro_two_checked`] ?? "0";

		let macroTwo = values[`${sectionName}_macro_two`] ?? "";

		let macroThreeChecked = values[`${sectionName}_macro_three_checked`] ?? "0";

		let macroThree = values[`${sectionName}_macro_three`] ?? "";

		let macroFourChecked = values[`${sectionName}_macro_four_checked`] ?? "0";

		let macroFour = values[`${sectionName}_macro_four`] ?? "";

		let macroFiveChecked = values[`${sectionName}_macro_five_checked`] ?? "0";

		let macroFive = values[`${sectionName}_macro_five`] ?? "";

		let macroSixChecked = values[`${sectionName}_macro_six_checked`] ?? "0";

		let macroSix = values[`${sectionName}_macro_six`] ?? "";

		let rollDataArray = [];

		if (skillName) {
			rollDataArray.push(`{{skillName=${skillName}}}`);
		}

		if (bookReference) {
			rollDataArray.push(`{{bookReference=${bookReference}}}`);
		}
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{ranged_roll_modifier} + @{range_quick_mod_total}, ${rangedRollMaxNineValue} }kl1]]}}`);

		if (rangedRollMaxNine) {
			rollDataArray.push(`{{maxNine=[[${rangedRollMaxNine}]]}}`);
		}

		if (rangedRollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${rangedRollTraitSummary}}}`);
		}

		if (hitLocation) {
			rollDataArray.push(`{{hitLocation=${hitLocation}}}`);
		}

		if (maneuver) {
			rollDataArray.push(`{{maneuver=${maneuver}}}`);
		}

		if (allOutAttack) {
			rollDataArray.push(`{{allOutAttack=${allOutAttack}}}`);
		}

		if (notes) {
			rollDataArray.push(`{{notes=${notes}}}`);
		}

		if (rof) {
			rollDataArray.push(`{{rof=${rof}}}`);
		}

		if (shotsFired) {
			rollDataArray.push(`{{shotsFired=${shotsFired}}}`);
		}

		let recoilValue = 0;

		if (recoil) {
			rollDataArray.push(`{{recoil=${recoil}}}`);
			recoilValue = Number(recoil);
		}

		if (malfunction) {
			rollDataArray.push(`{{malfunction=[[${malfunction}]]}}`);
		}

		if (verifyMalfunction) {
			rollDataArray.push(`{{verifyMalfunction=[[${verifyMalfunction}]]}}`);
		}

		if (veryReliable) {
			rollDataArray.push(`{{veryReliable=[[${veryReliable}]]}}`);
		}

		if (customSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${customSuccessNote}}}`);
		}

		if (customCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${customCriticalSuccessNote}}}`);
		}

		if (customFailNote) {
			rollDataArray.push(`{{customFailNote=${customFailNote}}}`);
		}

		if (customCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${customCriticalFailNote}}}`);
		}

		if (rawSuccessNote) {
			rollDataArray.push(`{{rawSuccessNote=${rawSuccessNote}}}`);
		}

		if (rawCriticalSuccessNote) {
			rollDataArray.push(`{{rawCriticalSuccessNote=${rawCriticalSuccessNote}}}`);
		}

		if (rawFailNote) {
			rollDataArray.push(`{{rawFailNote=${rawFailNote}}}`);
		}

		if (rawCriticalFailNote) {
			rollDataArray.push(`{{rawCriticalFailNote=${rawCriticalFailNote}}}`);
		}

		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return [rollData, recoilValue];

	}

	const rollRepeatingSpells = async (event) => {

		if (!event.triggerName) {
			return;
		}
		
		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollRepeatingSpells: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let skillRollData = await getRepeatingSpellsRollData(rowId);

		rollData += skillRollData;

		// append the rollDifference
		rollData += " {{rollDifference=[[0]]}}";

		// TODO: append result status; critical_success, success, fail, critical_fail, malfunction

		const skillRoll = await startRoll(rollData);

		const effectiveSkill = skillRoll.results.effectiveSkill.result;

		const roll = skillRoll.results.rollResult.result;

		const difference = effectiveSkill - roll;

		let customData = {
			rollDifference: difference
		};

		finishRoll(skillRoll.rollId, customData);

	}

	const spellFields = [
		"name",
		"ref",
		"level",
		"rule_of_16_value",
		"spell_roll_trait_summary",
		"show_notes",
		"notes",
		"casttime",
		"duration",
		"cost",
		"maintain",
		"spell_resisted_by",
		"spell_class",
		"spell_success_note",
		"spell_critical_success_note",
		"spell_fail_note",
		"spell_critical_fail_note",
		"show_spell_notes",
		"spell_notes",
		"macro_one_checked",
		"macro_one",
		"macro_two_checked",
		"macro_two",
		"macro_three_checked",
		"macro_three",
		"macro_four_checked",
		"macro_four",
		"macro_five_checked",
		"macro_five",
		"macro_six_checked",
		"macro_six",
	];

	const getRepeatingSpellsRollData = async (rowId) => {

		const sectionName = `repeating_spells_${rowId}`;

		let fields = spellFields.map(field => `${sectionName}_${field}`);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let skillName = values[`${sectionName}_name`] ?? "";

		let bookReference = values[`${sectionName}_ref`] ?? "";

		let level = values[`${sectionName}_level`] ?? "10";

		let rule16Value = values[`${sectionName}_rule_of_16_value`] ?? "100";

		let rollTraitSummary = values[`${sectionName}_spell_roll_trait_summary`] ?? "";

		let showNotes = values[`${sectionName}_show_notes`] ?? "0";

		let notes = values[`${sectionName}_notes`] ?? "";
		notes = notes.replace(/\n/g, '\\n');

		let castingTime = values[`${sectionName}_casttime`] ?? "";

		let castingDuration = values[`${sectionName}_duration`] ?? "";

		let castingCost = values[`${sectionName}_cost`] ?? "";

		let castingMaintain = values[`${sectionName}_maintain`] ?? "";

		let spellResisted = values[`${sectionName}_spell_resisted_by`] ?? "";

		let castingClass = values[`${sectionName}_spell_class`] ?? "";

		let showSpellNotes = values[`${sectionName}_show_spell_notes`] ?? "0";

		let spellNotes = values[`${sectionName}_spell_notes`] ?? "";

		let customSuccessNote = values[`${sectionName}_spell_success_note`] ?? "";

		let customCriticalSuccessNote = values[`${sectionName}_spell_critical_success_note`] ?? "";

		let customFailNote = values[`${sectionName}_spell_fail_note`] ?? "";

		let customCriticalFailNote = values[`${sectionName}_spell_critical_fail_note`] ?? "";

		let macroOneChecked = values[`${sectionName}_macro_one_checked`] ?? "0";

		let macroOne = values[`${sectionName}_macro_one`] ?? "";

		let macroTwoChecked = values[`${sectionName}_macro_two_checked`] ?? "0";

		let macroTwo = values[`${sectionName}_macro_two`] ?? "";

		let macroThreeChecked = values[`${sectionName}_macro_three_checked`] ?? "0";

		let macroThree = values[`${sectionName}_macro_three`] ?? "";

		let macroFourChecked = values[`${sectionName}_macro_four_checked`] ?? "0";

		let macroFour = values[`${sectionName}_macro_four`] ?? "";

		let macroFiveChecked = values[`${sectionName}_macro_five_checked`] ?? "0";

		let macroFive = values[`${sectionName}_macro_five`] ?? "";

		let macroSixChecked = values[`${sectionName}_macro_six_checked`] ?? "0";

		let macroSix = values[`${sectionName}_macro_six`] ?? "";

		let rollDataArray = [];

		if (skillName) {
			rollDataArray.push(`{{skillName=${skillName}}}`);
		}

		if (bookReference) {
			rollDataArray.push(`{{bookReference=${bookReference}}}`);
		}
		
		rollDataArray.push(`{{effectiveSkill=[[{${level} + @{modifier} + @{spell_roll_modifier}, ${rule16Value} }kl1]]}}`);

		rollDataArray.push(`{{{{rule16Value=[[${rule16Value}]]}}} }}`);

		if (rollTraitSummary) {
			rollDataArray.push(`{{rollTraitSummary=${rollTraitSummary}}}`);
		}

		if (showNotes) {
			rollDataArray.push(`{{showNotes=[[${showNotes}]]}}`);
		}

		if (notes) {
			rollDataArray.push(`{{notes=${notes}}}`);
		}

		if (castingTime) {
			rollDataArray.push(`{{castingTime=${castingTime}}}`);
		}

		if (castingDuration) {
			rollDataArray.push(`{{castingDuration=${castingDuration}}}`);
		}

		if (castingCost) {
			rollDataArray.push(`{{castingCost=${castingCost}}}`);
		}

		if (castingMaintain) {
			rollDataArray.push(`{{castingMaintain=${castingMaintain}}}`);
		}

		if (spellResisted) {
			rollDataArray.push(`{{castingResist=${spellResisted}}}`);
		}

		if (castingClass) {
			rollDataArray.push(`{{castingClass=${castingClass}}}`);
		}

		rollDataArray.push(`{{showSpellNotes=[[${showSpellNotes}]]}} `);

		if (spellNotes) {
			rollDataArray.push(`{{spellNotes=${spellNotes}}}`);
		}

		if (customSuccessNote) {
			rollDataArray.push(`{{customSuccessNote=${customSuccessNote}}}`);
		}

		if (customCriticalSuccessNote) {
			rollDataArray.push(`{{customCriticalSuccessNote=${customCriticalSuccessNote}}}`);
		}

		if (customFailNote) {
			rollDataArray.push(`{{customFailNote=${customFailNote}}}`);
		}

		if (customCriticalFailNote) {
			rollDataArray.push(`{{customCriticalFailNote=${customCriticalFailNote}}}`);
		}

		rollDataArray.push(`{{showCustomMacroOne=[[${macroOneChecked}]]}}`);

		if (macroOne) {
			rollDataArray.push(`{{customMacroOne=${macroOne}}}`);
		}

		rollDataArray.push(`{{showCustomMacroTwo=[[${macroTwoChecked}]]}}`);

		if (macroTwo) {
			rollDataArray.push(`{{customMacroTwo=${macroTwo}}}`);
		}

		rollDataArray.push(`{{showCustomMacroThree=[[${macroThreeChecked}]]}}`);

		if (macroThree) {
			rollDataArray.push(`{{customMacroThree=${macroThree}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFour=[[${macroFourChecked}]]}}`);

		if (macroFour) {
			rollDataArray.push(`{{customMacroFour=${macroFour}}}`);
		}

		rollDataArray.push(`{{showCustomMacroFive=[[${macroFiveChecked}]]}}`);

		if (macroFive) {
			rollDataArray.push(`{{customMacroFive=${macroFive}}}`);
		}

		rollDataArray.push(`{{showCustomMacroSix=[[${macroSixChecked}]]}}`);

		if (macroSix) {
			rollDataArray.push(`{{customMacroSix=${macroSix}}}`);
		}

		let rollData = rollDataArray.join(" ");

		return rollData;

	}

	const travelTerrainTypes = new Map([
		["arctic", {name: "Arctic", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x0.20 on loose snow or x0.50 on slippery ice", defaultSpeedModifier: 0.20 }],
		["arctic-skating", {name: "Arctic (ice), skating", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x1.25 on a level surface, Move x0.50 anywhere else. Must have ice.", defaultSpeedModifier: 1.25 }],
		["arctic-skiing", {name: "Arctic (snow), skiing", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x1.00 in general, Move x0.50 on uphill treks. Must have snow", defaultSpeedModifier: 1.0 }],
		["arctic-snowshoeing", {name: "Arctic, snowshoeing", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x0.50 for all terrain types.", defaultSpeedModifier: 0.5 }],
		["desert", {name: "Desert", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x0.20 on loose sand to x1.25 on hard-packed sand (avg. x0.50)", defaultSpeedModifier: 0.5 }],
		["desert-sandshoeing", {name: "Desert (sand), sandshoeing", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x0.50 for all terrain types.", defaultSpeedModifier: 0.5 }],
		["island-beach", {name: "Island/Beach", foraging: "2d6-7 (avg. 0)", tracking: -2, travelSpeedModifier: "x0.20 on loose sand to x1.25 on hard rock (avg. x0.50)", defaultSpeedModifier: 0.5 }],
		["jungle", {name: "Jungle", foraging: "2d6-7 (avg. 0)", tracking: 0, travelSpeedModifier: "x0.20", defaultSpeedModifier: 0.2 }],
		["mountain", {name: "Mountain", foraging: "1d6-7 (avg. -4)", tracking: -2, travelSpeedModifier: "x0.20", defaultSpeedModifier: 0.2 }],
		["plains", {name: "Plains", foraging: "2d6-7 (avg. 0)", tracking: 0, travelSpeedModifier: "x0.50 if hilly to x1.25 if completely level (avg. x1.00)", defaultSpeedModifier: 1.0 }],
		["swampland", {name: "Swampland", foraging: "2d6-7 (avg. 0)", tracking: -4, travelSpeedModifier: "x0.20", defaultSpeedModifier: 0.2 }],
		["woodlands", {name: "Woodlands", foraging: "2d6-7 (avg. 0)", tracking: 0, travelSpeedModifier: "x0.20 in dense forest to x1.00 in light forest (avg. x0.50)", defaultSpeedModifier: 0.5 }],
	]);

	const travelWeatherOptions = new Map([
		["perfect", {name: "Perfect", percentage: 10}],
		["passable", {name: "Passable", percentage: 0}],
		["bad", {name: "Bad", percentage: -50}],
		["dire", {name: "Dire", percentage: -75}],
	]);

	on("change:travel_terrain", event => {

		updateTerrainDescriptionSetDefault(event);

	});

	const updateTerrainDescriptionSetDefault = (event) => {

		const terrain = event.newValue;

		const terrainData = travelTerrainTypes.get(terrain);

		if (terrainData) {

			const keyValues = {
				travel_terrain_name: terrainData.name,
				travel_terrain_foraging: terrainData.foraging,
				travel_terrain_tracking: terrainData.tracking,
				travel_terrain_travel_speed: terrainData.travelSpeedModifier,
				travel_terrain_modifier: terrainData.defaultSpeedModifier
			};

			setAttrs(keyValues);

		}

	}

	let travelBaseFields = [
		"travel_move",
		"travel_terrain_modifier",
		"travel_weather",
	];

	travelBaseFields.forEach(field => {

		on(`change:${field}`, event => {

			updateTravelBaseSpeed(event);

		});

	});

	const updateTravelBaseSpeed = (event) => {

		getAttrs(travelBaseFields, values => {

			let move = Number(values.travel_move) ?? 0;

			let terrainMod = Number(values.travel_terrain_modifier) ?? 1;

			if (terrainMod <= 0) {
				terrainMod = 1;
			}

			let weatherOption = travelWeatherOptions.get(values.travel_weather);

			let weatherPercentage = 0;

			if (weatherOption) {
				weatherPercentage = weatherOption.percentage;
			}

			let baseSpeed = move * terrainMod;

			let updatedSpeed = baseSpeed * (1 + weatherPercentage / 100);

			let roundedSpeed = Math.round(updatedSpeed * 100) / 100;

			let keyValues = {
				travel_base_speed: roundedSpeed.toFixed(2)
			};

			setAttrs(keyValues);

		});

	}

	const travelMitigationOptionFields = [
		"apply",
		"percent"
	];

	travelMitigationOptionFields.forEach( field => {

		on(`change:repeating_travel-mitigation-options:${field}`, event => {

			totalMitigationOptionPercentages(event);

		});

	});

	const totalMitigationOptionPercentages = event => {

		const sectionName = "travel-mitigation-options";

		getSectionIDs(sectionName, ids => {

			let fields = [];

			ids.forEach(id => {

				fields.push(`repeating_${sectionName}_${id}_apply`);

				fields.push(`repeating_${sectionName}_${id}_percent`);

			});

			getAttrs(fields, values => {

				let totalPercentage = 0;

				let keyValues = {};

				ids.forEach(id => {

					let applyFieldName = `repeating_${sectionName}_${id}_apply`;

					let percentFieldName = `repeating_${sectionName}_${id}_percent`;
					
					let applyPercentage = values[applyFieldName] == "1";

					let percentage = Number(values[percentFieldName]);

					if (applyPercentage) {
						totalPercentage += percentage;
					}

				});

				let displayValue = "0%";

				if (totalPercentage >= 0) {
					displayValue = `+${totalPercentage}%`;
				} else {
					displayValue = `${totalPercentage}%`;
				}
				
				keyValues["travel_mitigators_total_percentage"] = totalPercentage;

				keyValues["travel_mitigators_total_percentage_display"] =  displayValue;
					
				setAttrs(keyValues);

			});

		})

	}

	const travelFinalFields = [
		"travel_base_speed",
		"travel_mitigators_total_percentage",
	];

	travelFinalFields.forEach( field => {

		on(`change:${field}`, event => {

			updateTravelFinalSpeed(event);

		});

	});

	const updateTravelFinalSpeed = (event) => {

		getAttrs(travelFinalFields, values => {

			let baseSpeed = Number(values.travel_base_speed) ?? 1;

			let percentage = Number(values.travel_mitigators_total_percentage) ?? 0;

			let updatedSpeed = baseSpeed * (1 + percentage / 100);

			let roundedSpeed = Math.round(updatedSpeed * 100) / 100;

			let milesPerHour = Math.round(updatedSpeed / 2 * 100) / 100;

			let kmPerHour = milesPerHour * 1.609344;

			kmPerHour = Math.round(kmPerHour * 100) / 100;

			let keyValues = {
				travel_final_speed: roundedSpeed.toFixed(2),
				travel_miles_per_hour: milesPerHour.toFixed(2),
				travel_kilometer_per_hour: kmPerHour.toFixed(2)
			};

			setAttrs(keyValues);

		});

	}

	const travelTotalMileFields = [
		"travel_miles_per_hour",
		"travel_hours_per_day",
	];

	travelTotalMileFields.forEach(field => {

		on(`change:${field}`, event => {
			updateTravelTotalMiles(event);
		});

	});

	const updateTravelTotalMiles = (event) => {

		getAttrs(travelTotalMileFields, values => {

			let milesPerHour = Number(values.travel_miles_per_hour) ?? 0;

			let hours = Number(values.travel_hours_per_day) ?? 0;

			let miles = milesPerHour * hours;

			let roundedMiles = Math.round(miles * 100) / 100;

			let kilometers = miles * 1.609344;

			kilometers = Math.round(kilometers * 100) / 100;

			let keyValues = {
				travel_total_miles: roundedMiles.toFixed(2),
				travel_total_kilometers: kilometers.toFixed(2)
			};

			setAttrs(keyValues);

		});

		

	}

	const travelSkllRollNote = "Roll each day. Success adds 10%, failure subtracts 10%, and critical failure subtracts 20% or yields interesting results.";

	const travelSkillTeamEffort = "If this is a group, use the Team Effort rules, you can use the available tool on this character sheet. B185"; 

	const travelMitigators = [
		{name: "Hiking skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Riding skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Driving skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Piloting skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Boating skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Seamanship skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Teamster skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Skating skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Skiing skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Sandshoeing skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Swimming skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Climbing skill", notes: `${travelSkllRollNote} ${travelSkillTeamEffort}`, percentage: 10},
		{name: "Navigation skill", notes: `${travelSkllRollNote}`, percentage: 10},
		{name: "Area Knowledge skill", notes: `A guide that knows the area can use this skill instead of navigation. ${travelSkllRollNote}`, percentage: 10},
	];

	on("clicked:travel_add_mitigators", event => {

		addTravelMitigatorsToTable();

	});

	const addTravelMitigatorsToTable = () => {

		let keyValues = {};

		travelMitigators.forEach(mitigator => {

			let id = generateRowID();

			let key = `repeating_travel-mitigation-options_${id}`;

			keyValues[`${key}_name`] = mitigator.name;

			keyValues[`${key}_notes`] = mitigator.notes;

			keyValues[`${key}_percent`] = mitigator.percentage;

		});

		setAttrs(keyValues);

	}

	const climbingTypes = [
		{key: "ladder-up", translationCode: "ladder-up-option", name: "Ladder up", modifierDescription: "No roll", modifier: "no-roll", combatSpeedDescription: "3 rungs/sec", combatSpeedDescriptionMetric: "3 rungs/sec", combatSpeedInFeet: 3, normalSpeedDescription: "1 rung/sec", normalSpeedDescriptionMetric: "1 rung/sec", normalSpeedInFeet: 1 },
		{key: "ladder-down", translationCode: "ladder-down-option", name: "Ladder down", modifierDescription: "No roll", modifier: "no-roll", combatSpeedDescription: "2 rungs/sec", combatSpeedDescriptionMetric: "2 rungs/sec", combatSpeedInFeet: 2, normalSpeedDescription: "1 rung/sec", normalSpeedDescriptionMetric: "1 rung/sec", normalSpeedInFeet: 1 },
		{key: "tree", translationCode: "ordindary-tree-option", name: "Ordindary tree", modifierDescription: "+5", modifier: 5, combatSpeedDescription: "1 ft/sec", combatSpeedDescriptionMetric: ".305 m/sec", combatSpeedInFeet: 1, normalSpeedDescription: "1 ft/3 sec", normalSpeedDescriptionMetric: ".305 m/3 sec", normalSpeedInFeet: .33333 },
		{key: "mountain", translationCode: "ordinary-mountain-option", name: "Ordinary mountain", modifierDescription: "0", modifier: 0, combatSpeedDescription: "1 ft/2 sec", combatSpeedDescriptionMetric: ".305 m/2 sec", combatSpeedInFeet: .5, normalSpeedDescription: "10 ft/min", normalSpeedDescriptionMetric: "3.05 m/min", normalSpeedInFeet: .16666 },
		{key: "vertical-stone-wall", translationCode: "vertical-stone-wall-option", name: "Vertical stone wall", modifierDescription: "-3", modifier: -3, combatSpeedDescription: "1 ft/5 sec", combatSpeedDescriptionMetric: ".305 m/5 sec", combatSpeedInFeet: .2, normalSpeedDescription: "4 ft/min", normalSpeedDescriptionMetric: "1.22 m/min", normalSpeedInFeet: .06666 },
		{key: "modern-building", translationCode: "modern-building-option", name: "Modern building", modifierDescription: "-3", modifier: -3, combatSpeedDescription: "1 ft/10 sec", combatSpeedDescriptionMetric: ".305 m/10 sec", combatSpeedInFeet: .1, normalSpeedDescription: "2 ft/min", normalSpeedDescriptionMetric: ".610 m/min", normalSpeedInFeet: .03333 },
		{key: "rope-up", translationCode: "rope-up-option", name: "Rope-up", modifierDescription: "-2", modifier: -2, combatSpeedDescription: "1 ft/sec", combatSpeedDescriptionMetric: "0.305 m/sec", combatSpeedInFeet: 1, normalSpeedDescription: "20 ft/min", normalSpeedDescriptionMetric: "6.10 m/min", normalSpeedInFeet: .33333 },
		{key: "rope-down-no-equipment", translationCode: "rope-down-no-equipment-option", name: "Rope-down w/o equipment", modifierDescription: "-1", modifier: -1, combatSpeedDescription: "2 ft/sec", combatSpeedDescriptionMetric: "0.61 m/sec", combatSpeedInFeet: 2, normalSpeedDescription: "30 ft/min", normalSpeedDescriptionMetric: "9.14 m/min", normalSpeedInFeet: .5 },
		{key: "rope-down-with-equipment", translationCode: "rope-down-with-equipment-option", name: "Rope-down w/ equipment", modifierDescription: "-1", modifier: -1, combatSpeedDescription: "12 ft/sec", combatSpeedDescriptionMetric: "3.66 m/sec", combatSpeedInFeet: 12, normalSpeedDescription: "12 ft/sec", normalSpeedDescriptionMetric: "3.66 m/sec", normalSpeedInFeet: 12 },
	];

	const climbingTypeFields = [
		"climbing_tool_type_of_climb",
		"climbing_tool_in_combat",
		"use_metric_distances",
	];

	climbingTypeFields.forEach(field => {

		on(`change:${field}`, event => {

			updateClimbingTypeInfo();

		});

	});

	const updateClimbingTypeInfo = () => {

		getAttrs(climbingTypeFields, values => {

			let useMetric = values.use_metric_distances == "1";

			let inCombat = values.climbing_tool_in_combat == "1";

			let key = values.climbing_tool_type_of_climb;

			let climbingType = climbingTypes.find(type => type.key == key);

			if (climbingType) {

				let speedDescription = climbingType.normalSpeedDescription;

				// NOTE: Don't worry about metric, we'll convert that later based on height
				let speed = climbingType.normalSpeedInFeet;

				if (inCombat) {
					speed = climbingType.combatSpeedInFeet;
				}

				let modifierDescription = climbingType.modifierDescription;

				let modifier = climbingType.modifier;

				// check for correct speed description
				if (useMetric && inCombat) {
					speedDescription = climbingType.combatSpeedDescriptionMetric;
					
				} else if (useMetric) {
					speedDescription = climbingType.normalSpeedDescriptionMetric;
					
				} else if (inCombat) {
					speedDescription = climbingType.combatSpeedDescription;
				}

				let keyValues = {
					climbing_tool_speed_in_feet: speed,
					climbing_tool_speed_description: speedDescription,
					climbing_tool_type_of_climb_modifier: modifier,
					climbing_tool_type_of_climb_modifier_description: modifierDescription
				};

				setAttrs(keyValues);

			}

		});

	}

	const climbingModifierFields = [
		"climbing_tool_type_of_climb_modifier",
		"climbing_tool_encumbrance",
		"climbing_tool_custom_modifier"
	];

	climbingModifierFields.forEach(field => {

		on(`change:${field}`, event => {

			updateClimbingModifier();

		});

	});

	const updateClimbingModifier = () => {

		getAttrs(climbingModifierFields, values => {

			let hasRoll = values.climbing_tool_type_of_climb_modifier != "no-roll";

			let finalModifier = "No roll";

			if (hasRoll) {

				let baseMod = Number(values.climbing_tool_type_of_climb_modifier) ?? 0;

				let encumbrance = Number(values.climbing_tool_encumbrance) ?? 0;

				let customMod = Number(values.climbing_tool_custom_modifier) ?? 0;

				finalModifier = baseMod + encumbrance + customMod;

			}

			let keyValues = {
				climbing_tool_final_modifier: finalModifier
			};

			setAttrs(keyValues);

		});

	}

	const climbingTimeFields = [
		"climbing_tool_speed_in_feet",
		"climbing_tool_height",
		"climbing_tool_height_meters",
		"use_metric_distances"
	];

	climbingTimeFields.forEach(field => {

		on(`change:${field}`, event => {
			updateClimbingTime();	
		});

	});

	const updateClimbingTime = () => {

		let fields = climbingTimeFields.concat(["climbing_tool_type_of_climb_modifier"]);

		getAttrs(fields, values => {

			let useMetric = values.use_metric_distances == "1";

			let hasRoll = values.climbing_tool_type_of_climb_modifier != "no-roll";

			// feet per second
			let speed = Number(values.climbing_tool_speed_in_feet) ?? 0;

			// height in feet
			let height = Number(values.climbing_tool_height) ?? 0;

			if (useMetric) {
				let meters = Number(values.climbing_tool_height_meters) ?? 0;
				
				// convert meters to feet
				height = meters * 3.28084;

			}

			let timeInSeconds = height / speed;

			let timeInMinutes = timeInSeconds / 60;

			let timeInHours = timeInMinutes / 60;

			let description = Math.round(timeInSeconds) + " sec";

			let numberOfRolls = 1 + Math.floor(timeInMinutes / 5);

			// check for no rolls
			if (hasRoll == false) {
				numberOfRolls = "No rolls";
			}

			if (timeInHours >= 1) {
				let hours = Math.floor(timeInHours);
				let minutes = Math.round((timeInHours % 1) * 60);
				description = `${hours} hrs ${minutes} min`;
			} else if (timeInMinutes >= 1) {
				let minutes = Math.floor(timeInMinutes);
				let seconds = Math.round((timeInMinutes % 1) * 60);
				description = `${minutes} min ${seconds} sec`;
			}

			let keyValues = {
				climbing_tool_travel_time: description,
				climbing_tool_number_of_rolls: numberOfRolls
			};

			setAttrs(keyValues);

		});

	}

	const diggingTools = [
		{key: "iron-steel", name: "Iron or steel tools", modifier: "1"},
		{key: "wooden", name: "Wooden tools", modifier: ".5"},
		{key: "improvised", name: "Improvised tools", modifier: ".25"},
		{key: "custom", name: "Custom modifier", modifier: ".125"},
	];

	on("change:digging_tool_implentation", event => {

		const key = event.newValue ?? "iron-steel";

		updateDiggingToolInfo(key);

	});

	const updateDiggingToolInfo = (key) => {

		let tool = diggingTools.find(tool => tool.key == key);

		if (tool) {

			let keyValues = {
				digging_tool_custom_modifier: tool.modifier
			};

			setAttrs(keyValues);

		}

	}

	const diggingActions = [
		{key: "shovel-loose-soil", name: "Shovel loose soil, sand, etc", digRateMultiplier: 2, fatigueRate: 1 },
		{key: "shovel-ordinary-soil", name: "Shovel ordinary soil", digRateMultiplier: 1, fatigueRate: 2 },
		{key: "pick-ordinary-soil", name: "Pick ordinary soil", digRateMultiplier: 4, fatigueRate: 2 },
		{key: "pick-hard-soil", name: "Pick hard soil", digRateMultiplier: 2, fatigueRate: 3 },
		{key: "shovel-hard-soil", name: "Shovel hard soil", digRateMultiplier: 2, fatigueRate: 3 },
		{key: "pick-shovel-hard-soil", name: "Pick & shovel hard soil", digRateMultiplier: .6, fatigueRate: 3 },
		{key: "pick-hard-rock", name: "Pick hard rock", digRateMultiplier: 1, fatigueRate: 4 },
		{key: "shovel-hard-rock", name: "Shovel hard rock", digRateMultiplier: 1, fatigueRate: 4 },
	];

	on("change:digging_tool_action", event => {

		const key = event.newValue ?? "shovel-loose-soil";

		updateDiggingToolRates(key);

	});

	const updateDiggingToolRates = key => {

		let action = diggingActions.find(action => action.key == key);

		if (action) {

			let keyValues = {
				digging_tool_digging_rate_multiplier: action.digRateMultiplier,
				digging_tool_fatigue_per_hour: action.fatigueRate,
				digging_tool_fatigue_description: `${action.fatigueRate} FP/hr`,
			};

			setAttrs(keyValues);
			
		}

	}

	const digRateFields = [
		"digging_tool_basic_lift",
		"digging_tool_custom_modifier",
		"digging_tool_digging_rate_multiplier",
		"use_metric_distances",
	];

	digRateFields.forEach(field => {

		on(`change:${field}`, event => {

			updateDigRate();

		});

	});

	const updateDigRate = () => {

		getAttrs(digRateFields, values => {

			let useMetric = values.use_metric_distances == "1";

			let basicLift = Number(values.digging_tool_basic_lift) ?? 0;

			let modifier = Number(values.digging_tool_custom_modifier) ?? 0;

			let rateMultiplier = Number(values.digging_tool_digging_rate_multiplier) ?? 0;

			let rate = basicLift * modifier * rateMultiplier;

			let rateDescription = `${rate} cf/hr`;

			if (useMetric) {

				// convert cubic feet per hour to cubic meters per hour
				let metricRate = convertCubicFeetToCubicMeters(rate);

				// round to decimal places
				metricRate = Math.round(metricRate * 100) / 100;

				rateDescription = `${metricRate} m³/hr`;
			}

			let keyValues = {
				digging_tool_digging_rate_cubic_feet_hour: rate,
				digging_tool_digging_rate_description: rateDescription
			};

			setAttrs(keyValues);

		});

	}

	const convertCubicFeetToCubicMeters = (cubicFeetPerHour) => {
		const conversionFactor = 0.0283168;
		return cubicFeetPerHour * conversionFactor;
	}

	const digHourFields = [
		"digging_tool_hours",
		"digging_tool_digging_rate_cubic_feet_hour",
		"digging_tool_fatigue_per_hour",
		"use_metric_distances",
	];

	digHourFields.forEach(field => {

		on(`change:${field}`, event => {

			updateDigHours();

		})

	});

	const updateDigHours = () => {
		
		getAttrs(digHourFields, values => {

			let useMetric = values.use_metric_distances == "1";

			let hours = Number(values.digging_tool_hours) ?? 0;

			let digRate = Number(values.digging_tool_digging_rate_cubic_feet_hour) ?? 0;

			let fatigueRate = Number(values.digging_tool_fatigue_per_hour) ?? 0;

			let volume = hours * digRate;

			let fatigue = hours * fatigueRate;

			let volumeForHoursDescription = `${volume} cf`;

			if (useMetric) {

				// convert cubic feet to cubic meters
				let metricVolume = convertCubicFeetToCubicMeters(volume);

				// round to decimal places
				metricVolume = Math.round(metricVolume * 100) / 100;

				volumeForHoursDescription = `${metricVolume} m³`;

			}

			let keyValues = {
				digging_tool_total_volume_for_hours: volume,
				digging_tool_total_volume_for_hours_description: volumeForHoursDescription,
				digging_tool_total_fatigue_for_hours: fatigue,
				digging_tool_total_fatigue_for_hours_description: `${fatigue} FP`
			};

			setAttrs(keyValues);

		});

	}

	const digAreaFields = [
		"digging_tool_height",
		"digging_tool_width",
		"digging_tool_depth",
		"digging_tool_digging_rate_cubic_feet_hour",
		"use_metric_distances",
	];

	digAreaFields.forEach(field => {

		on(`change:${field}`, event => {

			updateDigArea();

		});

	});

	const updateDigArea = () => {

		getAttrs(digAreaFields, values => {

			let useMetric = values.use_metric_distances == "1";

			let height = Number(values.digging_tool_height) ?? 0;

			let width = Number(values.digging_tool_width) ?? 0;

			let depth = Number(values.digging_tool_depth) ?? 0;

			let volume = height * width * depth;

			let digRate = Number(values.digging_tool_digging_rate_cubic_feet_hour) ?? 0;

			let hours = volume / digRate;

			let volumeForDimensionsDescription = `${volume} cf`;

			if (useMetric) {

				// convert digrate to cubic meters
				let digRateMetric = convertCubicFeetToCubicMeters(digRate);

				hours = volume / digRateMetric;
				
				volumeForDimensionsDescription = `${volume} m³`;
			}

			// round to one decimal places
			hours = Math.round(hours * 10) / 10;

			let keyValues = {
				digging_tool_total_volume_for_dimensions: volume,
				digging_tool_total_volume_for_dimensions_description: volumeForDimensionsDescription,
				digging_tool_total_hours_for_dimensions: hours,
				digging_tool_total_hours_for_dimensions_description: `${hours} hours`
			};

			setAttrs(keyValues);

		});

	}

	on("change:use_metric_distances", event => {

		let isChecked = event.newValue == "1";

		let metricTitle = "";

		if (isChecked) {
			metricTitle = "Metric";
		}

		let keyValues = {
			metric_title: metricTitle
		};

		setAttrs(keyValues);

	});

	const objectMeasureFields = [
		"object_measure",
		"object_measure_unit"
	];

	objectMeasureFields.forEach(field => {

		on(`change:${field}`, event => {

			updateObjectMeasure();

		});

	});

	const updateObjectMeasure = () => {

		getAttrs(objectMeasureFields, values => {

			let measure = Number(values.object_measure) ?? 0;

			let unit = values.object_measure_unit ?? "yards";

			let yards = convertMeasureToYards(measure, unit);

			let modifier = getSizeModifierByMeasurement(yards);

			let keyValues = {
				object_size_modifier: modifier
			};

			setAttrs(keyValues);

		});

	}

	const convertMeasureToYards = (measure, unit) => {

		let yards = 0;

		if (unit == "yards") {
			yards = measure;
		} else if (unit == "inches") {
			yards = measure / 36;
		} else if (unit == "feet") {
			yards = measure / 3;
		} else if (unit == "meters") {
			yards = measure * 1.0936133;
		}

		return yards;

	}

	const objectMaterials = [
		{key: "wooden-plastic", name: "Wooden/Plastic", damageResistance: 2},
		{key: "small-metal", name: "Small Metal", damageResistance: 4},
		{key: "metal-wood", name: "Metal/Wood (gun)", damageResistance: 4},
		{key: "composite", name: "Composite (axe)", damageResistance: 4},
		{key: "solid-metal", name: "Solid Metal (sword/crowbar)", damageResistance: 6},
		{key: "quarter-inch-armor", name: "1/4\" mild steel armor", damageResistance: 14},
	];

	on("change:object_material", event => {

		let materialKey = event.newValue ?? "metal-wood";

		let material = objectMaterials.find(entry => entry.key == materialKey);

		let damageResistance = 0;

		if (material) {
			damageResistance = material.damageResistance;
		}

		let keyValues = {
			object_damage_resistance: damageResistance
		};

		setAttrs(keyValues);

	});

	const injuryTolerance = [
		{key: "unliving", name: "Unliving (complex machine)", health: 10, hitPointsMultiplier: 4},
		{key: "homogenous", name: "Homogenous (weapons, tools)", health: 12, hitPointsMultiplier: 8},
		{key: "diffuse", name: "Diffuse (nets, mattresses)", health: 10, hitPointsMultiplier: 4},
	];

	let objectHealthFields = [
		"object_injury_tolerance",
		"object_health_mod",
	];

	objectHealthFields.forEach(field => {

		on(`change:${field}`, event => {

			updateObjectHealthFields();

		});

	});

	const updateObjectHealthFields = () => {

		getAttrs(objectHealthFields, values => {

			let toleranceKey = values.object_injury_tolerance;

			let tolerance = injuryTolerance.find(entry => entry.key == toleranceKey );

			let healthMod = Number(values.object_health_mod) ?? 0;

			let health = 10;

			let hitPointsMultiplier = 4;

			if (tolerance) {
				health = tolerance.health +  healthMod;
				hitPointsMultiplier = tolerance.hitPointsMultiplier;
			}

			let keyValues = {
				object_health: health,
				object_hit_points_multiplier: hitPointsMultiplier
			};

			setAttrs(keyValues);

		});

	}

	let objectHitPointsFields = [
		"object_weight",
		"object_weight_units",
		"object_hit_points_multiplier",
		"object_hit_points_mod"
	];

	objectHitPointsFields.forEach(field => {

		on(`change:${field}`, event => {

			updateObjectHitPoints();

		});

	});

	const updateObjectHitPoints = () => {

		getAttrs(objectHitPointsFields, values => {

			let weight = Number(values.object_weight) ?? 1;

			let weightUnits = values.object_weight_units ?? "pounds";

			if (weightUnits == "kilograms") {
				// convert kilograms to pounds
				weight = weight * 2.20462;
			}

			let factor = Number(values.object_hit_points_multiplier) ?? 4;

			let hitPointsMod = Number(values.object_hit_points_mod) ?? 0;

			let hitPoints = Math.ceil(factor * Math.cbrt(weight)) + hitPointsMod;

			let majorWoundThreshold = Math.floor(hitPoints/2);

			let realingThreshold = Math.floor(hitPoints/3);

			let destroyedHitPoints = -5 * hitPoints;

			let destroyedThresholds = [];

			// if object has 10 HP. it is automatically destroyed at -50 HP
			// for each 10 HP increment below 0, object must make HT to avoid being destroyed.
			// in this example, object should check on -10, -20, -30, and -40.
			for (increment = 1; increment <= 4; increment++) {

				let destroyedHitPointsCheck = -1 * increment * hitPoints;

				destroyedThresholds.push(destroyedHitPointsCheck);

			}

			let destroyedThresholdsDescription = destroyedThresholds.join(", ");

			let keyValues = {
				object_hit_points: hitPoints,
				object_hit_points_max: hitPoints,
				object_major_wound: majorWoundThreshold,
				object_hit_points_realing_threshold: realingThreshold,
				object_hit_points_destroyed: destroyedHitPoints,
				object_hit_points_destroyed_thresholds: destroyedThresholdsDescription
			};

			setAttrs(keyValues);

		});

	}

	const objectSkillRepairFields = [
		"repair_type",
		"repair_object_cost",
		"repair_equipment",
		"repair_missing_equipment",
		"repair_damaged_equipment",
		"repair_extra_time",
		"repair_haste",
		"repair_skill",
		"repair_skill_custom_modifier"
	];

	objectSkillRepairFields.forEach(field => {

		on(`change:${field}`, event => {

			updateObjectSkillRepair();

		});

	});

	const updateObjectSkillRepair = () => {

		getAttrs(objectSkillRepairFields, values => {

			let repairTypeModifier = 0;

			if (values.repair_type == "major") {
				repairTypeModifier = -2;
			}

			let costModifier = getObjectCostSkillModifier(values.repair_object_cost);

			let equipmentMod = getEquipmentSkillModifier(values.repair_equipment);

			let missingEquipment = Number(values.repair_missing_equipment) ?? 0;

			let missingEquipmentModifier = -1 * missingEquipment;

			let damagedEquipmentModifier = Number(values.repair_damaged_equipment) ?? 0;

			let extraTimeMultiplier = Number(values.repair_extra_time) ?? 1;

			let extraTimeModifier = getExtraTimeSkillModifier(extraTimeMultiplier);

			let hastePercentage = Number(values.repair_haste) ?? 0;

			let hasteModifier = -1 * (hastePercentage/10);

			let baseRepairTime = 30;

			let finalRepairTime = 30;

			if (extraTimeMultiplier > 1) {
				finalRepairTime = baseRepairTime * extraTimeMultiplier;
			} else if (hastePercentage > 0) {
				finalRepairTime = baseRepairTime * (1 - hastePercentage/100);
			}

			let skill = Number(values.repair_skill) ?? 10;

			let customSkillModifier = Number(values.repair_skill_custom_modifier) ?? 0;

			let repairSkillModifier = costModifier + equipmentMod + missingEquipmentModifier + damagedEquipmentModifier + extraTimeModifier + hasteModifier + repairTypeModifier;

			let finalSkill = skill + repairSkillModifier + customSkillModifier;

			let keyValues = {
				repair_skill_modifier: repairSkillModifier,
				repair_skill_final: finalSkill,
				repair_final_time: finalRepairTime 
			};

			setAttrs(keyValues);
			
		});

	}

	const getObjectCostSkillModifier = cost => {

		let modifier = 1;

		if (cost == "ten-thousand") {
			modifier = 0;
		} else if (cost == "one-hundred-thousand") {
			modifier = -1;
		} else if (cost == "one-million") {
			modifier = -2;
		} else if (cost == "over-one-million") {
			modifier = -3;
		}

		return modifier;

	}

	const getEquipmentSkillModifier = quality => {

		let modifier = 0;

		switch(quality) {
			case "no-equipment-tech":
				modifier = -10;
				break;
			case "no-equipment":
				modifier = -5;
				break;
			case "improvised-tech":
				modifier = -5;
				break;
			case "improvised":
				modifier = -2;
				break;
			case "basic":
				modifier = 0;
				break;
			case "good":
				modifier = 1;
				break;
			case "fine":
				modifier = 2;
				break;
			case "best":
				modifier = 3;
				break;
		}

		return modifier;
	}

	const getExtraTimeSkillModifier = extraTimeMultiplier => {

		let modifier = 0;

		switch(extraTimeMultiplier) {
			case 1:
				modifier = 0;
				break;
			case 2:
				modifier = 1;
				break;
			case 4:
				modifier = 2;
				break;
			case 8:
				modifier = 3;
				break;
			case 15:
				modifier = 4;
				break;
			case 30:
				modifier = 5;
				break;
		}

		return modifier;

	}

	on("change:stealth_vs_perception_distance_vision", event => {

		let distance = Number(event.newValue) ?? 1;

		updateStealthVsPerceptionDistanceMod(distance);

	});

	const updateStealthVsPerceptionDistanceMod = distance => {

		let modifier = getModBySpeedRange(distance);

		let keyValues = {
			stealth_vs_perception_distance_vision_modifier: modifier
		};

		setAttrs(keyValues);
	}

	let stealthSkillFields = [
		"stealth_vs_perception_stealth_skill",
		"stealth_vs_perception_encumbrance",
		"stealth_vs_perception_stealth_custom_modifier",
		"stealth_vs_perception_move_over_1",
		"stealth_vs_perception_discriminatory_smell",
	];

	stealthSkillFields.forEach(field => {

		on(`change:${field}`, event => {

			updateStealthVsPerceptionStealthSkill();

		});

	});

	const updateStealthVsPerceptionStealthSkill = () => {

		getAttrs(stealthSkillFields, values => {

			let baseSkill = Number(values.stealth_vs_perception_stealth_skill) ?? 10;

			let encumbrance = Number(values.stealth_vs_perception_encumbrance) ?? 0;

			let modifier = Number(values.stealth_vs_perception_stealth_custom_modifier) ?? 0;

			let isMoving = values.stealth_vs_perception_move_over_1 == "1";

			let hasDiscriminatorySmell = values.stealth_vs_perception_discriminatory_smell == "1";

			let movingPenalty = 0;

			if (isMoving) {
				movingPenalty = -5;
			}

			let discriminatorySmellPenalty = 0;

			if (hasDiscriminatorySmell) {
				discriminatorySmellPenalty = -5;
			}

			let totalModifiers = encumbrance + modifier + movingPenalty + discriminatorySmellPenalty;

			let finalSkill = baseSkill + totalModifiers;

			let keyValues = {
				stealth_vs_perception_stealth_mod_total: totalModifiers,
				stealth_vs_perception_stealth_skill_final: finalSkill
			};

			setAttrs(keyValues);

		});

	}

	const stealthVsVisionFields = [
		"stealth_vs_perception_perception_skill",
		"stealth_vs_perception_acute_vision",
		"stealth_vs_perception_conceal_vision_mod",
		"stealth_vs_perception_surveillance_vision_mod",
		"stealth_vs_perception_custom_vision_mod",
		"stealth_vs_perception_distance_vision_modifier",
		"stealth_vs_perception_size_modifier",
		"stealth_vs_perception_darkness_modifier",
		"stealth_vs_perception_hyperspectral_vision",
		"stealth_vs_perception_in_plain_sight",
	];

	stealthVsVisionFields.forEach(field => {

		on(`change:${field}`, event => {

			updateStealthVsPerceptionVisionSkill();

		});

	});

	const updateStealthVsPerceptionVisionSkill = () => {

		getAttrs(stealthVsVisionFields, values => {

			let baseSkill = Number(values.stealth_vs_perception_perception_skill) ?? 10;

			let acuteVision = Number(values.stealth_vs_perception_acute_vision) ?? 0;

			let concealMod = Number(values.stealth_vs_perception_conceal_vision_mod) ?? 0;

			let surveillanceMod = Number(values.stealth_vs_perception_surveillance_vision_mod) ?? 0;

			let customMod = Number(values.stealth_vs_perception_custom_vision_mod) ?? 0;

			let distanceMod = Number(values.stealth_vs_perception_distance_vision_modifier) ?? 0;

			let sizeMod = Number(values.stealth_vs_perception_size_modifier) ?? 0;

			let darknessMod = Number(values.stealth_vs_perception_darkness_modifier) ?? 0;

			let hasHyperspectralVision = values.stealth_vs_perception_hyperspectral_vision == "1";

			let hyperspectralMod = 0;

			if (hasHyperspectralVision) {
				hyperspectralMod = 3;
			}

			let inPlainSight = values.stealth_vs_perception_in_plain_sight == "1";

			let plainSightMod = 0;

			if (inPlainSight) {
				plainSightMod = 10;
			}

			let totalModifiers = acuteVision + concealMod + surveillanceMod + customMod + distanceMod + sizeMod + darknessMod + hyperspectralMod + plainSightMod;

			let finalSkill = baseSkill + totalModifiers;

			let keyValues = {
				stealth_vs_perception_vision_mod_total: totalModifiers,
				stealth_vs_perception_vision_skill: finalSkill
			};

			setAttrs(keyValues);

		});

	}

	const stealthVsHearingFields = [
		"stealth_vs_perception_perception_skill",
		"stealth_vs_perception_acute_hearing",
		"stealth_vs_perception_conceal_hearing_mod",
		"stealth_vs_perception_surveillance_hearing_mod",
		"stealth_vs_perception_custom_hearing_mod",
		"stealth_vs_perception_distance_hearing_mod",
		"stealth_vs_perception_discriminatory_hearing",
		"stealth_vs_perception_hard_of_hearing",
	];

	stealthVsHearingFields.forEach(field => {

		on(`change:${field}`, event => {

			updateStealthVsPerceptionHearingSkill();

		});

	});

	const updateStealthVsPerceptionHearingSkill = () => {

		getAttrs(stealthVsHearingFields, values => {

			let baseSkill = Number(values.stealth_vs_perception_perception_skill) ?? 10;

			let acuteHearing = Number(values.stealth_vs_perception_acute_hearing) ?? 0;

			let concealMod = Number(values.stealth_vs_perception_conceal_hearing_mod) ?? 0;

			let surveillanceMod = Number(values.stealth_vs_perception_surveillance_hearing_mod) ?? 0;

			let customMod = Number(values.stealth_vs_perception_custom_hearing_mod) ?? 0;

			let distanceMod = Number(values.stealth_vs_perception_distance_hearing_mod) ?? 0;

			let hasDiscriminatoryHearing = values.stealth_vs_perception_discriminatory_hearing == "1";

			let discriminatoryMod = 0;

			if (hasDiscriminatoryHearing) {
				discriminatoryMod = 4;
			}

			let isHardOfHearing = values.stealth_vs_perception_hard_of_hearing == "1";

			let hardOfHearingMod = 0;

			if (isHardOfHearing) {
				hardOfHearingMod = -4;
			}

			let totalModifiers = acuteHearing + concealMod + surveillanceMod + customMod + distanceMod + discriminatoryMod + hardOfHearingMod;

			let finalSkill = baseSkill + totalModifiers;

			let keyValues = {
				stealth_vs_perception_hearing_mod_total: totalModifiers,
				stealth_vs_perception_hearing_skill: finalSkill
			};

			setAttrs(keyValues);

		});
	}

	on("change:repeating_ranged:rof change:repeating_ranged:recoil", event => {

		updateRangedShotsFiredMacro();

	});

	const updateRangedShotsFiredMacro = () => {

		let fields = [
			`repeating_ranged_rof`,
			`repeating_ranged_recoil`
		];

		getAttrs(fields, values => {

			let rof = values.repeating_ranged_rof ?? "1";

			// convert rof to an integer
			let rofNumber = parseInt(rof);

			let recoil = Number(values.repeating_ranged_recoil) ?? 1;

			let macro = "";

			// check if rofNumber is a valid number
			if (!isNaN(rofNumber) && rofNumber > 1 && recoil > 0) {
				macro = `[[?{Shots fired up to ${rof}|0}]]`;
			}

			let keyValues = {
				[`repeating_ranged_shots_fired_macro`]: macro
			};

			setAttrs(keyValues);

		});

	}

	/**
	 * Loop through all the ranged weapons and update the shots fired macro
	 */
	const updateAllRangedShotsFiredMacro = () => {

		getSectionIDs("repeating_ranged", ids => {

			ids.forEach(id => {

				updateRangedShotsFiredMacroByRowId(id);

			});

		});

	}

	/**
	 * Update the shots fired macro for a specific ranged weapon
	 * @param {String} id 
	 */
	const updateRangedShotsFiredMacroByRowId = id => {

		getAttrs([`repeating_ranged_${id}_rof`, `repeating_ranged_${id}_recoil`], values => {

			let rof = values[`repeating_ranged_${id}_rof`] ?? "1";

			// convert rof to an integer
			let rofNumber = parseInt(rof);

			let recoil = Number(values[`repeating_ranged_${id}_recoil`]) ?? 1;

			let macro = "";

			// check if rofNumber is a valid number
			if (!isNaN(rofNumber) && rofNumber > 1 && recoil > 0) {
				macro = `[[?{Shots fired up to ${rof}|0}]]`;
			}

			let keyValues = {
				[`repeating_ranged_${id}_shots_fired_macro`]: macro
			};

			setAttrs(keyValues);

		});

	}

	on("clicked:hit_location_open clicked:hit_location_close", event => {

		let isOpen = event.triggerName == "clicked:hit_location_open";

		toggleHitLocationNotes(isOpen);	

	});

	const toggleHitLocationNotes = isOpen => {

		getSectionIDs("repeating_hitlocation", ids => {

			let keyValues = {};

			ids.forEach(id => {

				let key = `repeating_hitlocation_${id}_toggle_notes`;

				let value = isOpen ? "1" : "0";

				keyValues[key] = value;

			});

			setAttrs(keyValues);

		});

	}

	const quickModAreas = ["melee", "range"];


	quickModAreas.forEach(area => {

		on(`change:repeating_${area}-quick-modifier:apply`, event => {

			updateQuickModifiers(area);

		});

	});
	
	const updateQuickModifiers = (area) => {

		getSectionIDs(`repeating_${area}-quick-modifier`, ids => {

			let fields = [];

			ids.forEach(id => {

				let applyField = `repeating_${area}-quick-modifier_${id}_apply`;

				let nameField = `repeating_${area}-quick-modifier_${id}_name`;

				let modifierField = `repeating_${area}-quick-modifier_${id}_modifier`;

				fields.push(applyField, nameField, modifierField);

			});

			getAttrs(fields, values => {

				let totalMod = 0;

				let summaryArray = [];

				let showInRoll = 0;

				ids.forEach(id => {

					let apply = values[`repeating_${area}-quick-modifier_${id}_apply`] == "1";

					if (apply) {

						showInRoll = 1;

						let name = values[`repeating_${area}-quick-modifier_${id}_name`] ?? "";

						let modifier = Number(values[`repeating_${area}-quick-modifier_${id}_modifier`]) ?? 0;

						totalMod += modifier;

						summaryArray.push(`${name} (${modifier})`);

					}

				});

				let summary = summaryArray.join(", ");

				let keyValues = {};

				keyValues[`${area}_quick_mod_show_in_roll`] = showInRoll;

				keyValues[`${area}_quick_mod_total`] = totalMod;

				keyValues[`${area}_quick_mod_summary`] = summary;

				setAttrs(keyValues);

			});

		});
	}

	on("change:cold_exposure_temperature change:cold_exposure_lower_comfort_zone", event => {

		if (event.sourceType == "player" ) {

			let fieldName = event.sourceAttribute;

			let fieldValue = event.newValue;
			
			updateColdExposureFahrenheitValues(fieldName, fieldValue);
			
		}

	});

	const updateColdExposureFahrenheitValues = (fieldName, fieldValue) => {

		let fields = ["cold_exposure_temperature_unit_type"];

		getAttrs(fields, values => {

			let unitType = values.cold_exposure_temperature_unit_type;

			if (unitType == "celsius") {
				// convert fieldValue from celsius to farhenheit
				fieldValue = Math.round((fieldValue * 9/5) + 32);
			}

			let keyValues = {};

			keyValues[`${fieldName}_fahrenheit`] = fieldValue;

			setAttrs(keyValues);

		});
	}

	on("change:cold_exposure_temperature_unit_type", event => {

		const unitType = event.newValue;

		updateColdExposureUnitType(unitType);
	});

	const updateColdExposureUnitType = unitType => {

		let unitTypeDisplay = "";

		if (unitType == "fahrenheit") {
			unitTypeDisplay = "°F";
		} else if (unitType == "celsius") {
			unitTypeDisplay = "°C";	
		}

		let fields = ["cold_exposure_temperature", "cold_exposure_lower_comfort_zone"];

		getAttrs(fields, values => {
			
			let currentTemp = Number(values.cold_exposure_temperature) ?? 34;

			let currentTempFahrenheit = 34;

			let comfortZone = Number(values.cold_exposure_lower_comfort_zone) ?? 35;

			let comfortZoneFahrenheit = 35;

			if (unitType == "fahrenheit") {
				// convert currentTemp from celsius to fahrenheit and round to nearest integer
				currentTemp = Math.round((currentTemp * 9/5) + 32);
				comfortZone = Math.round((comfortZone * 9/5) + 32);

				// store the fahrenheit values
				currentTempFahrenheit = currentTemp;
				comfortZoneFahrenheit = comfortZone;

			} else if (unitType == "celsius") {
				
				// store the fahrenheit values
				currentTempFahrenheit = currentTemp;
				comfortZoneFahrenheit = comfortZone;

				// convert currentTemp from fahrenheit to celsius and round to nearest integer
				currentTemp = Math.round((currentTemp - 32) * 5/9);
				comfortZone = Math.round((comfortZone - 32) * 5/9);
				
			}

			let keyValues = {
				cold_exposure_temperature: currentTemp,
				cold_exposure_temperature_fahrenheit: currentTempFahrenheit,
				cold_exposure_lower_comfort_zone: comfortZone,
				cold_exposure_lower_comfort_zone_fahrenheit: comfortZoneFahrenheit,
				cold_exposure_current_unit_type: unitType,
				cold_exposure_current_unit_type_display: unitTypeDisplay
			};
	
			setAttrs(keyValues);
		});

	}

	on("change:cold_exposure_wind change:cold_exposure_thermal_shock", event => {

		updateColdExposureFrequency();

		if (event.sourceAttribute == "cold_exposure_thermal_shock") {

			let applyThermalShock = event.newValue == "1";

			updateColdExposureSuccessFailNotes(applyThermalShock);
		}

	});

	const updateColdExposureFrequency = () => {

		let fields = ["cold_exposure_wind", "cold_exposure_thermal_shock"];

		getAttrs(fields, values => {

			let applyThermalShock = values.cold_exposure_thermal_shock == "1";

			let windLevel = values.cold_exposure_wind;

			let frequency = "30";

			if (applyThermalShock) {
				frequency = "1";
			} else if (windLevel == "calm") {
				frequency = "30";
			} else if (windLevel == "light") {
				frequency = "15";
			} else if (windLevel == "strong") {
				frequency = "10";
			} 
			
			let keyValues = {
				cold_exposure_frequency: frequency
			};

			setAttrs(keyValues);

		});

	}

	const updateColdExposureSuccessFailNotes = (applyThermalShock) => {

		let successNote = "No fatigue loss.";

		let criticalSuccessNote = "No fatigue loss.";

		let failNote = "Lose 1 FP.";

		let criticalFailNote = "Lose 1 FP.";

		if (applyThermalShock) {
			successNote = "Lose 1 FP.";
			criticalSuccessNote = "Lose 1 FP or GM discretion.";
			failNote = "Lose 1 FP per margin of failure.";
			criticalFailNote = "Lose 1 FP per margin of failure.";
		}

		let keyValues = {
			cold_exposure_success_note: successNote,
			cold_exposure_critical_success_note: criticalSuccessNote,
			cold_exposure_fail_note: failNote,
			cold_exposure_critical_fail_note: criticalFailNote
		};

		setAttrs(keyValues);

	}

	on("change:cold_exposure_current_unit_type change:cold_exposure_temperature_fahrenheit change:cold_exposure_lower_comfort_zone_fahrenheit change:cold_exposure_temperature_tolerance change:cold_exposure_temperature_tolerance_health", event => {
		updateColdExposureEffectiveComfortZone();
	});

	const updateColdExposureEffectiveComfortZone = () => {

		let fields = [
			"cold_exposure_lower_comfort_zone_fahrenheit", 
			"cold_exposure_temperature_tolerance",
			"cold_exposure_current_unit_type_display",
			"cold_exposure_temperature_tolerance_health",
			"cold_exposure_temperature_fahrenheit",
			"cold_exposure_current_unit_type"
		];

		getAttrs(fields, values => {

			let unitType = values.cold_exposure_current_unit_type;

			let lowerComfortZone = Number(values.cold_exposure_lower_comfort_zone_fahrenheit) ?? 35;

			let tolerance = Number(values.cold_exposure_temperature_tolerance) ?? 0;

			let health = Number(values.cold_exposure_temperature_tolerance_health) ?? 10;

			let unitTypeDisplay = values.cold_exposure_current_unit_type_display;

			let toleranceModifier = -1 * tolerance * health;

			let effectiveComfortZone = lowerComfortZone + toleranceModifier;

			let currentTemp = Number(values.cold_exposure_temperature_fahrenheit) ?? 34;

			let effectiveComfortZoneDisplay = `${effectiveComfortZone} ${unitTypeDisplay}`;

			if (unitType == "celsius") {
				let effectiveComfortZoneCelsius = Math.floor((effectiveComfortZone - 32) * 5/9);
				effectiveComfortZoneDisplay = `${effectiveComfortZoneCelsius} °C`;
			}

			let mustRoll = "1";

			let mustRollText = "must roll";

			if (currentTemp >= effectiveComfortZone) {
				mustRoll = "0";
				mustRollText = "no roll needed";
			}

			let keyValues = {
				cold_exposure_effective_comfort_zone: effectiveComfortZone,
				cold_exposure_effective_comfort_zone_display: effectiveComfortZoneDisplay,
				cold_exposure_must_roll: mustRoll,
				cold_exposure_must_roll_text: mustRollText
			};

			setAttrs(keyValues);

		});
	}

	on("change:cold_exposure_temperature change:cold_exposure_temperature_unit_type", event => {
		updateTemperatureModifier();
	});

	const updateTemperatureModifier = () => {

		let fields = ["cold_exposure_temperature", "cold_exposure_temperature_unit_type"];

		getAttrs(fields, values => {

			let baseTemp = Number(values.cold_exposure_temperature) ?? 34;

			let unitType = values.cold_exposure_temperature_unit_type;

			if (unitType == "celsius") {
				// convert baseTemp from celsius to fahrenheit
				baseTemp = (baseTemp * 9/5) + 32;
			}

			let tempMod = 0;

			// formula: if baseTemp is less 0°F, than subtract 1 from tempMod for every full 10° below 0°F
			if (baseTemp < 0) {
				tempMod = Math.ceil(baseTemp / 10);
			}

			let keyValues = {
				cold_exposure_temperature_modifier: tempMod
			};

			setAttrs(keyValues);

		});

	}

	on("change:cold_exposure_temperature_modifier change:cold_exposure_clothing change:cold_exposure_wet_clothes change:cold_exposure_health_modifier", event => {
		updateColdExposureTotalModifier();
	});

	const updateColdExposureTotalModifier = () => {

		let fields = [
			"cold_exposure_temperature_modifier",
			"cold_exposure_clothing",
			"cold_exposure_wet_clothes",
			"cold_exposure_health_modifier"
		];

		getAttrs(fields, values => {

			let tempMod = Number(values.cold_exposure_temperature_modifier) ?? 0;

			let clothing = Number(values.cold_exposure_clothing) ?? 0;

			let wetClothes = values.cold_exposure_wet_clothes == "1" ? -5 : 0;

			let healthMod = Number(values.cold_exposure_health_modifier) ?? 0;

			let totalMod = tempMod + clothing + wetClothes + healthMod;

			let arrSummary = [];

			if (tempMod < 0) {
				arrSummary.push(`Temperature: ${tempMod}`);
			}

			if (clothing != 0) {
				arrSummary.push(`Clothing: ${clothing}`);
			}

			if (wetClothes != 0) {
				arrSummary.push(`Wet Clothes: ${wetClothes}`);
			}

			if (healthMod != 0) {
				arrSummary.push(`Health: ${healthMod}`);
			}

			let summary = arrSummary.join(", ");

			let keyValues = {
				cold_exposure_health_modifier_total: totalMod,
				cold_exposure_modifier_summary: summary
			};

			setAttrs(keyValues);

		});

	}

	on("change:cold_exposure_health_level change:cold_exposure_health_modifier_total", event => {
		updateColdExposureEffectiveHealth();
	});

	const updateColdExposureEffectiveHealth = () => {

		let fields = ["cold_exposure_health_level", "cold_exposure_health_modifier_total"];
	
		getAttrs(fields, values => {

			let healthLevel = Number(values.cold_exposure_health_level) ?? 10;

			let healthMod = Number(values.cold_exposure_health_modifier_total) ?? 0;

			let effectiveHealth = healthLevel + healthMod;

			let keyValues = {
				cold_exposure_effective_health_level: effectiveHealth
			};

			setAttrs(keyValues);

		});

	}

	on("change:heat_exposure_temperature change:heat_exposure_upper_comfort_zone change:heat_exposure_lower_comfort_zone", event => {

		if (event.sourceType == "player" ) {

			let fieldName = event.sourceAttribute;

			let fieldValue = event.newValue;
			
			updateHeatExposureFahrenheitValues(fieldName, fieldValue);
			
		}

	});

	const updateHeatExposureFahrenheitValues = (fieldName, fieldValue) => {

		let fields = ["heat_exposure_temperature_unit_type"];

		getAttrs(fields, values => {

			let unitType = values.heat_exposure_temperature_unit_type;

			if (unitType == "celsius") {
				// convert fieldValue from celsius to farhenheit
				fieldValue = Math.round((fieldValue * 9/5) + 32);
			}

			let keyValues = {};

			keyValues[`${fieldName}_fahrenheit`] = fieldValue;

			setAttrs(keyValues);

		});
	}

	on("change:heat_exposure_temperature_unit_type", event => {

		const unitType = event.newValue;

		updateHeatExposureUnitType(unitType);
	});

	const updateHeatExposureUnitType = unitType => {

		let unitTypeDisplay = "";

		if (unitType == "fahrenheit") {
			unitTypeDisplay = "°F";
		} else if (unitType == "celsius") {
			unitTypeDisplay = "°C";	
		}

		let fields = ["heat_exposure_temperature", "heat_exposure_upper_comfort_zone", "heat_exposure_lower_comfort_zone"];

		getAttrs(fields, values => {
			
			let currentTemp = Number(values.heat_exposure_temperature) ?? 90;

			let currentTempFahrenheit = 90;

			let comfortZone = Number(values.heat_exposure_upper_comfort_zone) ?? 90;

			let comfortZoneFahrenheit = 90;

			let lowerComfortZone = Number(values.heat_exposure_lower_comfort_zone) ?? 35;

			let lowerComfortZoneFahrenheit = 35;

			if (unitType == "fahrenheit") {
				// convert currentTemp from celsius to fahrenheit and round to nearest integer
				currentTemp = Math.round((currentTemp * 9/5) + 32);
				comfortZone = Math.round((comfortZone * 9/5) + 32);
				lowerComfortZone = Math.round((lowerComfortZone * 9/5) + 32);

				// store the fahrenheit values
				currentTempFahrenheit = currentTemp;
				comfortZoneFahrenheit = comfortZone;
				lowerComfortZoneFahrenheit = lowerComfortZone;

			} else if (unitType == "celsius") {
				
				// store the fahrenheit values
				currentTempFahrenheit = currentTemp;
				comfortZoneFahrenheit = comfortZone;
				lowerComfortZoneFahrenheit = lowerComfortZone;

				// convert currentTemp from fahrenheit to celsius and round to nearest integer
				currentTemp = Math.round((currentTemp - 32) * 5/9);
				comfortZone = Math.round((comfortZone - 32) * 5/9);
				lowerComfortZone = Math.round((lowerComfortZone - 32) * 5/9);
				
			}

			let keyValues = {
				heat_exposure_temperature: currentTemp,
				heat_exposure_temperature_fahrenheit: currentTempFahrenheit,
				heat_exposure_upper_comfort_zone: comfortZone,
				heat_exposure_upper_comfort_zone_fahrenheit: comfortZoneFahrenheit,
				heat_exposure_lower_comfort_zone: lowerComfortZone,
				heat_exposure_lower_comfort_zone_fahrenheit: lowerComfortZoneFahrenheit,
				heat_exposure_current_unit_type: unitType,
				heat_exposure_current_unit_type_display: unitTypeDisplay
			};
	
			setAttrs(keyValues);
		});

	}

	on("change:heat_exposure_current_unit_type change:heat_exposure_temperature_fahrenheit change:heat_exposure_lower_comfort_zone_fahrenheit change:heat_exposure_upper_comfort_zone_fahrenheit change:heat_exposure_temperature_tolerance change:heat_exposure_temperature_tolerance_health", event => {
		updateHeatExposureEffectiveComfortZone();
	});

	const updateHeatExposureEffectiveComfortZone = () => {

		let fields = [
			"heat_exposure_upper_comfort_zone_fahrenheit", 
			"heat_exposure_lower_comfort_zone_fahrenheit", 
			"heat_exposure_temperature_tolerance",
			"heat_exposure_current_unit_type_display",
			"heat_exposure_temperature_tolerance_health",
			"heat_exposure_temperature_fahrenheit",
			"heat_exposure_current_unit_type"
		];

		getAttrs(fields, values => {

			let unitType = values.heat_exposure_current_unit_type;

			let lowerComfortZone = Number(values.heat_exposure_lower_comfort_zone_fahrenheit) ?? 35;

			let upperComfortZone = Number(values.heat_exposure_upper_comfort_zone_fahrenheit) ?? 90;

			let tolerance = Number(values.heat_exposure_temperature_tolerance) ?? 0;

			let health = Number(values.heat_exposure_temperature_tolerance_health) ?? 10;

			let unitTypeDisplay = values.heat_exposure_current_unit_type_display;

			let toleranceModifier = -1 * tolerance * health;

			let effectiveComfortZone = upperComfortZone + toleranceModifier;

			let currentTemp = Number(values.heat_exposure_temperature_fahrenheit) ?? 90;

			let effectiveComfortZoneDisplay = `${effectiveComfortZone} ${unitTypeDisplay}`;

			if (unitType == "celsius") {
				let effectiveComfortZoneCelsius = Math.floor((effectiveComfortZone - 32) * 5/9);
				effectiveComfortZoneDisplay = `${effectiveComfortZoneCelsius} °C`;
			}

			let mustRoll = "1";

			let mustRollText = "must roll";

			if (currentTemp < effectiveComfortZone - 10) {
				mustRoll = "0";
				mustRollText = "no roll needed";
			}

			let intenseHeatThreshold = 6 * (upperComfortZone - lowerComfortZone);

			let intenseHeatThresholdDisplay = `${intenseHeatThreshold} ${unitTypeDisplay}`;

			if (unitType == "celsius") {
				let intenseHeatThresholdCelsius = Math.floor((intenseHeatThreshold - 32) * 5/9);
				intenseHeatThresholdDisplay = `${intenseHeatThresholdCelsius} °C`;
			}

			let keyValues = {
				heat_exposure_effective_comfort_zone: effectiveComfortZone,
				heat_exposure_intense_heat_threshold: intenseHeatThreshold,
				heat_exposure_intense_heat_threshold_display: intenseHeatThresholdDisplay,
				heat_exposure_effective_comfort_zone_display: effectiveComfortZoneDisplay,
				heat_exposure_must_roll: mustRoll,
				heat_exposure_must_roll_text: mustRollText
			};

			setAttrs(keyValues);

		});
	}

	on("change:heat_exposure_temperature_fahrenheit change:heat_exposure_effective_comfort_zone", event => {
		updateHeatTemperatureModifier();
	});

	const updateHeatTemperatureModifier = () => {

		let fields = ["heat_exposure_temperature_fahrenheit", "heat_exposure_effective_comfort_zone"];

		getAttrs(fields, values => {

			let baseTemp = Number(values.heat_exposure_temperature_fahrenheit) ?? 80;

			let effectiveTempZone = Number(values.heat_exposure_effective_comfort_zone) ?? 90;

			let modifierTempZone = effectiveTempZone - 10;

			let tempMod = 0;

			// formula: if baseTemp is over the effectiveTempZone, than subtract 1 from tempMod for every full 10° above the effectiveTempZone
			if (baseTemp > modifierTempZone) {
				tempMod = -1 * Math.floor((baseTemp - modifierTempZone) / 10);
			}

			let keyValues = {
				heat_exposure_temperature_modifier: tempMod
			};

			setAttrs(keyValues);

		});

	}

	on("change:heat_exposure_temperature_modifier change:heat_exposure_encumbrance change:heat_exposure_health_modifier", event => {
		updateHeatExposureTotalModifier();
	});

	const updateHeatExposureTotalModifier = () => {

		let fields = [
			"heat_exposure_temperature_modifier",
			"heat_exposure_encumbrance",
			"heat_exposure_health_modifier"
		];

		getAttrs(fields, values => {

			let tempMod = Number(values.heat_exposure_temperature_modifier) ?? 0;

			let encumberance = Number(values.heat_exposure_encumbrance) ?? 0;

			let healthMod = Number(values.heat_exposure_health_modifier) ?? 0;

			let totalMod = tempMod + encumberance + healthMod;

			let arrSummary = [];

			if (tempMod < 0) {
				arrSummary.push(`Temperature: ${tempMod}`);
			}

			if (encumberance != 0) {
				arrSummary.push(`Encumbrance: ${encumberance}`);
			}

			if (healthMod != 0) {
				arrSummary.push(`Health: ${healthMod}`);
			}

			let summary = arrSummary.join(", ");

			let keyValues = {
				heat_exposure_health_modifier_total: totalMod,
				heat_exposure_modifier_summary: summary
			};

			setAttrs(keyValues);

		});

	}

	on("change:heat_exposure_health_level change:heat_exposure_health_modifier_total", event => {
		updateHeatExposureEffectiveHealth();
	});

	const updateHeatExposureEffectiveHealth = () => {

		let fields = ["heat_exposure_health_level", "heat_exposure_health_modifier_total"];
	
		getAttrs(fields, values => {

			let healthLevel = Number(values.heat_exposure_health_level) ?? 10;

			let healthMod = Number(values.heat_exposure_health_modifier_total) ?? 0;

			let effectiveHealth = healthLevel + healthMod;

			let keyValues = {
				heat_exposure_effective_health_level: effectiveHealth
			};

			setAttrs(keyValues);

		});

	}

	on("change:heat_exposure_temperature change:heat_exposure_intense_heat_threshold", event => {

		updateHeatExposureFrequency();

	});

	const updateHeatExposureFrequency = () => {

		let fields = ["heat_exposure_temperature", "heat_exposure_intense_heat_threshold"];

		getAttrs(fields, values => {

			let currentTemp = Number(values.heat_exposure_temperature) ?? 90;

			let intenseHeatThreshold = Number(values.heat_exposure_intense_heat_threshold) ?? 90;

			let frequency = "30";

			let isIntenseHeat = 0;

			if (currentTemp > intenseHeatThreshold) {
				frequency = "1";
				isIntenseHeat = 1;
			}

			let keyValues = {
				heat_exposure_frequency: frequency,
				is_intense_heat: isIntenseHeat
			};

			setAttrs(keyValues);

		});

	}

	on("clicked:sort_spells", async (event) => {

		await sortIndentSpellsAsync();
		
	});

	/**
	 * We're going to generate a spell tree and use that to find
	 * child items of the parentId and then update the indent level
	 * see: https://typeofnan.dev/an-easy-way-to-build-a-tree-with-object-references/
	 */
	let sortIndentSpellsAsync = async () => {

		let treeData = await getTreeData("spells");

		// before making the tree, let's sort everything
		// see: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
		treeData = treeData.sort((item1, item2) => {

			const item1Name = item1.name.toUpperCase();

			const item2Name = item2.name.toUpperCase();

			if (item1Name < item2Name) {
				return -1;
			}

			if (item1Name > item2Name) {
				return 1;
			}

			// names must be equeal
			return 0;

		});

		const spellTree = getTreeStructure(treeData);

		// this will get the row ids in the correct order.
		const spellRowIds = getRowIdsUsingTree([], spellTree);

		// get all the indent levels of each item.
		// indent must start at -1 because we have a "root" level that 
		// is the base of the tree but not used.
		const spellIndentLevels = getIndentLevelsUsingTree("spells", {}, spellTree, -1);

		// now update the indent levels
		await setAttrsAsync(spellIndentLevels);

		setSectionOrder("spells", spellRowIds);

	};

	on("change:repeating_spells:parent_id", event => {

		if (event.sourceType === "player") {

			let parentId = event.newValue;

			let childId = getRowIdFromEventInfo(event, "repeating_spells");

			if (!isEmpty(parentId) && !isEmpty(childId)) {

				updateSpellIndentLevel(parentId, childId);
			}

		}		
		
	});

	function updateSpellIndentLevel(parentId, childId) {

		const parentNameField = `repeating_spells_${parentId}_name`;

		const childIndentField = `repeating_spells_${childId}_indent_level`;

		getAttrs([parentNameField], values => {

			const parentName = values[parentNameField];

			if (!isEmpty(parentName)) {

				let updateFields = {};

				// for now just indent one level
				updateFields[childIndentField] = 1;

				setAttrs(updateFields);

			}
			
		});

	}

	on("change:fragmentation_range", event => {

		const range = Number(event.newValue) || 0;

		updateFragmentationRangeModifier(range);

	});

	const updateFragmentationRangeModifier = range => {

		const rangeModifier = getModBySpeedRange(range);

		setAttrs({
			fragmentation_range_modifier: rangeModifier
		});

	}

	on("change:fragmentation_posture", event => {
		
		const posture = event.newValue;

		updateFragmentationPostureModifier(posture);
	});

	const updateFragmentationPostureModifier = posture => {

		let postureModifier = 0;

		if (posture != "standing") {
			postureModifier = -2;
		}

		setAttrs({
			fragmentation_posture_modifier: postureModifier
		});

	}

	on("change:fragmentation_skill change:fragmentation_range_modifier change:fragmentation_posture_modifier change:fragmentation_size_modifier", event => {

		updateFragmentationTotalModifier();

	});

	const updateFragmentationTotalModifier = () => {

		getAttrs([
			"fragmentation_skill",
			"fragmentation_range_modifier",
			"fragmentation_posture_modifier",
			"fragmentation_size_modifier"
		], values => {

			let skill = Number(values.fragmentation_skill) || 0;

			let rangeModifier = Number(values.fragmentation_range_modifier) || 0;

			let postureModifier = Number(values.fragmentation_posture_modifier) || 0;

			let sizeModifier = Number(values.fragmentation_size_modifier) || 0;

			let totalModifier = skill + rangeModifier + postureModifier + sizeModifier;

			let modifierSummary = [];

			if (rangeModifier != 0) {
				modifierSummary.push(`Range: ${rangeModifier}`);
			}

			if (postureModifier != 0) {
				modifierSummary.push(`Posture: ${postureModifier}`);
			}

			if (sizeModifier != 0) {
				modifierSummary.push(`Size: ${sizeModifier}`);
			}

			let summary = modifierSummary.join(", ");

			setAttrs({
				fragmentation_skill_final: totalModifier,
				fragmentation_modifier_summary: summary
			});

		});

	}

	on("change:binding_supports_weight change:bindings_weight_units", event => {
		updateBindingWeight();
	});

	const updateBindingWeight = () => {

		getAttrs([
			"binding_supports_weight",
			"bindings_weight_units"
		], values => {

			let supportsWeight = Number(values.binding_supports_weight) || 0;

			let weightUnits = values.bindings_weight_units;

			let weight = supportsWeight;

			if (weightUnits == "kilograms") {
				weight = Math.round(supportsWeight * 2.20462);
			}

			setAttrs({
				binding_supports_weight_pounds: weight
			});

		});

	}

	on("change:binding_supports_weight_pounds", event => {

		updateBindingSupportStrength();
	});

	const updateBindingSupportStrength = () => {

		getAttrs([
			"binding_supports_weight_pounds"
		], values => {

			let supportsWeight = Number(values.binding_supports_weight_pounds) || 0;

			// strength = square root of (supporsWeight / 4)
			let strength = Math.round(Math.sqrt(supportsWeight / 4));
			
			setAttrs({
				binding_supports_strength: strength
			});

		});

	}

	on("change:binding_coils", event => {
		updateBindingCoilStrengthModifier();
	});

	const updateBindingCoilStrengthModifier = () => {
		
		getAttrs([
			"binding_coils"
		], values => {

			let coils = Number(values.binding_coils) || 0;

			// for every coil after the first one, add one to strengthModifier
			let strengthModifier = coils - 1;
			
			setAttrs({
				binding_coils_strength_mod: strengthModifier
			});

		});
	}

	on("change:binding_supports_strength change:binding_coils_strength_mod", event => {
		updateBindingTotalStrength();
	});

	const updateBindingTotalStrength = () => {

		getAttrs([
			"binding_supports_strength",
			"binding_coils_strength_mod"
		], values => {

			let supportsStrength = Number(values.binding_supports_strength) || 0;

			let coilsStrengthMod = Number(values.binding_coils_strength_mod) || 0;

			let totalStrength = supportsStrength + coilsStrengthMod;

			setAttrs({
				binding_strength: totalStrength
			});

		});

	}

	// these fields affect the final skill level
	const drinkingIntoxicationSkillFields = [
		"drinking_intoxication_drinks_consumed",
		"drinking_intoxication_strength_level",
		"drinking_intoxication_base_skill_level",
		"drinking_intoxication_base_skill_level_modifier", 
		"drinking_intoxication_eaten",
		"drinking_intoxication_perk",
		"drinking_intoxication_strength_level"
	];

	drinkingIntoxicationSkillFields.forEach(field => {

		on(`change:${field}`, event => {

			updateDrinkingIntoxicationSkill();

		});

	});

	const updateDrinkingIntoxicationSkill = () => {

		getAttrs(drinkingIntoxicationSkillFields, values => {

			let drinksConsumed = Number(values.drinking_intoxication_drinks_consumed) || 0;

			let baseSkill = Number(values.drinking_intoxication_base_skill_level) || 10;

			let baseSkillModifier = Number(values.drinking_intoxication_base_skill_level_modifier) || 0;

			let eatenValues = {
				"eaten": 0,
				"recently": 1,
				"empty": -2
			};

			// find eaten modifier, where values.drinking_intoxication_eaten has the key to match to eatenValues
			let eaten = eatenValues[values.drinking_intoxication_eaten] || 0;

			let perkValues = {
				"none": 0,
				"tolerant": 2,
				"intolerant": -2
			};
			
			let perk = perkValues[values.drinking_intoxication_perk] || 0;

			let strengthLevel = Number(values.drinking_intoxication_strength_level) || 10;

			// drink modifier = -1 per drink over strengthLevel/4
			let shouldRoll = drinksConsumed > (strengthLevel / 4);

			let drinkModifier = -1 * Math.floor(drinksConsumed - (strengthLevel / 4));

			let finalSkill = baseSkill + baseSkillModifier + drinkModifier + eaten + perk;

			let totalModifier = baseSkillModifier + drinkModifier + eaten + perk;

			let summaryItems = [];

			if (drinkModifier != 0) {
				summaryItems.push(`Drink Modifier: ${drinkModifier}`);
			}

			if (baseSkillModifier != 0) {
				summaryItems.push(`Base Skill Modifier: ${baseSkillModifier}`);
			}

			if (eaten != 0) {
				summaryItems.push(`Eaten: ${eaten}`);
			}

			if (perk != 0) {
				summaryItems.push(`Tolerance Modifier: ${perk}`);
			}

			let summaryDescription = summaryItems.join("\n");

			setAttrs({
				drinking_intoxication_should_roll: shouldRoll ? "1" : "0",
				drinking_intoxication_roll: finalSkill,
				drinking_intoxication_skill_total_modifier: totalModifier,
				drinking_intoxication_skill_modifier_summary: summaryDescription
			});

		});

	}

	on("change:drinking_intoxication_state", event => {
		
		const state = event.newValue;

		updateDrinkingIntoxicationState(state);
		
	});

	const updateDrinkingIntoxicationState = state => {

		let stateDescription = "";

		if (state == "sober") {
			stateDescription = "You're Sober.";
		} else if (state == "tipsy") {
			stateDescription = "You're slighly intoxicated; -1 to DX and IQ, and -2 to self-control rolls except Cowardice. Reduce Shyness by one level. B428.";
		} else if (state == "drunk") {
			stateDescription = "You're slighly intoxicated; -2 to DX and IQ, and -4 to self-control rolls except those to resist Cowardice. Reduce Shyness by two levels, if you have it. B428.\n\nWhen you become drunk, make a HT+4 roll. On a failure, you are also hallucinating, see Pink Elephants B428.";
		} else if (state == "unconscious") {
			stateDescription = "You're knocked out, just as if you had suffered injury. B429. When you fall unconscious, make a HT roll. On success, you vomit up the alcohol INSTEAD of passing out, treat this as retching (B429). On a critical failure, you pass out AND retch, treat this as choking (B428).";
		} else if (state == "coma") {
			stateDescription = "You collapse just as if you had been wounded to -1xHP or below and passed out; see Recovering from Unconsciousness (B423). You get a single HT roll to awaken after 12 hours. On a failure, you won't recover without medical treatment. Until you receive treatment, roll vs HT every 12 hours. On any failure, you die!";
		}

		setAttrs({
			drinking_intoxication_state_description: stateDescription
		});

	}

	const drinkingIntoxicationSoberingFields = [
		"drinking_intoxication_sobering_up_health",
		"drinking_intoxication_hangover_roll_modifier",
		"drinking_intoxication_sober_up_roll_modifier"
	];

	drinkingIntoxicationSoberingFields.forEach(field => {

		on(`change:${field}`, event => {

			updateDrinkingIntoxicationSobering();

		});

	});

	const updateDrinkingIntoxicationSobering = () => {

		getAttrs(drinkingIntoxicationSoberingFields, values => {

			let health = Number(values.drinking_intoxication_sobering_up_health) || 10;

			let hangoverModifier = Number(values.drinking_intoxication_hangover_roll_modifier) || 0;

			let soberUpModifier = Number(values.drinking_intoxication_sober_up_roll_modifier) || 0;

			let hangoverRoll = health + hangoverModifier;

			let soberUpRoll = health + soberUpModifier;

			let superUpModifierSummary = "";

			if (soberUpModifier != 0) {
				superUpModifierSummary = `Sober Up Modifier: ${soberUpModifier}`;
			}

			let hangoverModifierSummary = "";

			if (hangoverModifier != 0) {
				hangoverModifierSummary = `Hangover Modifier: ${hangoverModifier}`;
			}

			setAttrs({
				drinking_intoxication_hangover_roll: hangoverRoll,
				drinking_intoxication_hangover_roll_modifier_summary: hangoverModifierSummary,
				drinking_intoxication_sober_up_roll: soberUpRoll,
				drinking_intoxication_sober_up_roll_modifier_summary: soberUpModifier,
			});

		});

	}

	on("change:drinking_intoxication_total_drinks_consumed", event => {

		const totalDrinks = Number(event.newValue) || 0;

		let hoursToSober = totalDrinks/2;

		// round to one decimal place
		hoursToSober = Math.round(hoursToSober * 10) / 10;

		setAttrs({
			drinking_intoxication_sober_up_hours: hoursToSober
		});

	});

	/** Roll Damage Button. Used to calculate Blunt Trauma Damage. */
	const damageButtons = [
		"repeating_melee:rolldamage",
		"repeating_ranged:rolldamage",
	];

	damageButtons.forEach(button => {

		on(`clicked:${button}`, async (event) => {

			const source = event.triggerName ?? "";
			
			if (source.includes("repeating_melee")) {
				await rollMeleeRangedDamageRoll(event);
			} else if (source.includes("repeating_ranged")) {
				await rollMeleeRangedDamageRoll(event);
			}

		}); // closing parenthesis for the 'on' function

	}); // closing parenthesis for the 'forEach' function
	

	// Melee and Ranged tables use the same fields
	const rollMeleeRangedDamageRoll = async (event) => {

		if (!event.triggerName) {
			return;
		}

		let [section, rowId, fieldName] = getSectionRowIdFromChangeEvent(event);
		
		let rollData = event.htmlAttributes.value ?? "";

		if (!rollData) {
			// something's wrong
			console.log("rollMeleeDamageRoll: Data Error", event);
			return;
		}

		// get the roll fields and add to rollData
		let [meleeDamageRollData, damageType] = await getRepeatingMeleeDamageRollData(rowId, section);

		rollData += meleeDamageRollData;

		// append the rollDifference
		rollData += " {{bluntTrauma=[[0]]}}";

		const damageRoll = await startRoll(rollData);

		const damage = damageRoll.results.damageRoll.result;

		const bluntTraumaDamage = getBluntTrauma(damageType, damage);

		let customData = {
			bluntTrauma: bluntTraumaDamage
		};

		finishRoll(damageRoll.rollId, customData);
	}

	const getBluntTrauma = (damageType, damageAmount) => {
		let bluntTrauma;
		if (damageType.includes("(cr)")) {
			bluntTrauma = Math.floor(damageAmount / 5);
		} else if (damageType.includes("(cut)") || damageType.includes("(imp)") || damageType.includes("(pi")) {
			bluntTrauma = Math.floor(damageAmount / 10);
		} else {
			bluntTrauma = 0;
		}
		return bluntTrauma;
	}

	// NOTE: These fields should not be present in the button value.
	const meleeDamageFields = [
		"name",
		"damage",
		"minimum_damage",
		"type",
		"damage_type_note",
		"damage_notes",
		"armor_divisor"
	];

	const getRepeatingMeleeDamageRollData = async (rowId, section) => {

		console.log("section:", section);

		let fields = meleeDamageFields.map(field => `${section}_${rowId}_${field}`);

		let values = await getAttrsAsync(fields);

		// get all the values we need
		let name = values[`${section}_${rowId}_name`] ?? "";

		let damage = values[`${section}_${rowId}_damage`] ?? "";

		let minDamage = values[`${section}_${rowId}_minimum_damage`] ?? "";

		let type = values[`${section}_${rowId}_type`] ?? "";

		let damageTypeNote = values[`${section}_${rowId}_damage_type_note`] ?? "";

		let damageNotes = values[`${section}_${rowId}_damage_notes`] ?? "";
		damageNotes = damageNotes.replace(/\n/g, '\\n');

		let armorDivisor = values[`${section}_${rowId}_armor_divisor`] ?? "";

		let rollDataArray = [];

		if (name) {
			rollDataArray.push(`{{skillName=${name}}}`);
		} else {
			rollDataArray.push(`{{skillName=Melee Damage}}`);
		}

		if (damage && minDamage) {
			// {{damageRoll=[[ { 1d6-2, {0} }kh1 ]]}} 
			rollDataArray.push(`{{damageRoll=[[ { ${damage}, {${minDamage}} }kh1 ]]}}`);
		} else if (damage) {
			rollDataArray.push(`{{damageRoll=[[ ${damage} ]]}}`);
		}

		if (type) {
			rollDataArray.push(`{{damageType=${type}}}`);
		}

		if (damageTypeNote) {
			rollDataArray.push(`{{damageTypeNote=${damageTypeNote}}}`);
		}

		if (damageNotes) {
			rollDataArray.push(`{{notes=${damageNotes}}}`);
		}

		if (armorDivisor) {
			rollDataArray.push(`{{armorDivisor=[[${armorDivisor}]]}}`);
		}
		
		let rollData = rollDataArray.join(" ");

		return [rollData, type];

	}

	/* damage calculation tool */
	const damageTypeToolFields = [
		"damage_method",
		"damage_modifier",
		"damage_die_modifier",
		"apply_dice_adds"
	];

	const damgeTypeSections = [
		"repeating_melee",
		"repeating_ranged"
	];

	// loop through each damageTypeSections
	damgeTypeSections.forEach(sectionName => {

		// now log a change event for each field
		damageTypeToolFields.forEach(fieldName => {

			on(`change:${sectionName}:${fieldName}`, event => {

				updateDamageTypeTool(sectionName, fieldName);

			});

		})

	});

	const updateDamageTypeTool = (sectionName, fieldName) => {

		let fields = damageTypeToolFields.map(field => `${sectionName}_${field}`);

		// add thrust and swing
		fields.push(`thrust`);
		fields.push(`swing`);

		getAttrs(fields, values => {

			let method = values[`${sectionName}_damage_method`] ?? "";

			let rollData = "";

			// if method is none or empty, return;
			if (method == "thrust" || method == "swing") {
			
				let thrustDamageRoll = values.thrust ?? "";

				let swingDamageRoll = values.swing ?? "";

				let baseDamageRoll = thrustDamageRoll;

				if (method == "swing") {
					baseDamageRoll = swingDamageRoll;
				}

				if (baseDamageRoll != "") {
					
					let modifier = Number(values[`${sectionName}_damage_modifier`]) || 0;

					let dieModifier = Number(values[`${sectionName}_damage_die_modifier`]) || 0;
	
					let applyDiceAdds = values[`${sectionName}_apply_dice_adds`] == "1";
	
					rollData = getCalculatedDamage(baseDamageRoll, modifier, dieModifier, applyDiceAdds);

				}
				
			}

			let keyValues = {
				[`${sectionName}_calculated_damage_roll`]: rollData,
				[`${sectionName}_damage`]: rollData
			};

			setAttrs(keyValues);

		});

	}

	const getCalculatedDamage = (baseRoll, flatModifier, dieModifier, applyDiceAdds) => {

		// Split the baseRoll into its components (number of dice, dice type, and modifier)
		const rollParts = baseRoll.match(/(\d+)d(\d+)([+-]?\d+)?/);
		let numberOfDice = parseInt(rollParts[1], 10);
		const diceType = `d${rollParts[2]}`;
		let originalModifier = 0; // Default modifier is 0
	  
		// Check if there is a modifier in the roll
		if (rollParts[3]) {
		  originalModifier = parseInt(rollParts[3], 10);
		}
	  
		// if there's a dieModifier value, we're going to get a modifier = numberOfDice * dieModifier
		let dieModifierValue = numberOfDice * dieModifier;

		// now we need to get calculate the final modifier. 
		let finalModifier = originalModifier + flatModifier + dieModifierValue;

		// check for applyDiceAdds
		if (applyDiceAdds && finalModifier >= 4) {

			// if finalModifier is 4 to 6, finalModifier = finalModifier - 4 but add 1 to numberOfDice
			// if finalModifier is 7 or higher, finalModifier = finalModifier - 7 but add 1 to numberOfDice
			if (finalModifier >= 7) {
				finalModifier -= 7;
				numberOfDice += 1;
			} else {
				finalModifier -= 4;
				numberOfDice += 1;
			}
		}

		// now we need to put it all back together
		let calculatedDamage = `${numberOfDice}${diceType}${finalModifier !== 0 ? (finalModifier > 0 ? "+" : "") + finalModifier : ""}`;

		return calculatedDamage;

	}

	// if thrust or swing changes, loop through each record in repeating_melee and repeating_ranged
	// if the record has method = thrust or swing, then update the calculated damage roll
	on("change:thrust change:swing", event => {

		triggerDamageToolForRepeatingSection();

	});

	const triggerDamageToolForRepeatingSection = () => {

		damgeTypeSections.forEach(sectionName => {

			getSectionIDs(sectionName, ids => {

				ids.forEach(id => {

					let fields = [
						`${sectionName}_${id}_damage_method`,
						`${sectionName}_${id}_calculated_damage_roll`
					];

					getAttrs(fields, values => {

						let method = values[`${sectionName}_${id}_damage_method`] ?? "";

						if (method == "thrust" || method == "swing") {

							updateDamageTypeToolForRowId(sectionName, id);

						}

					});

				});

			});

		});

	}

	const updateDamageTypeToolForRowId = (sectionName, id) => {

		let fields = damageTypeToolFields.map(field => `${sectionName}_${id}_${field}`);

		// add thrust and swing
		fields.push(`thrust`);
		fields.push(`swing`);

		getAttrs(fields, values => {

			let method = values[`${sectionName}_${id}_damage_method`] ?? "";

			let rollData = "";

			// if method is none or empty, return;
			if (method == "thrust" || method == "swing") {
			
				let thrustDamageRoll = values.thrust ?? "";

				let swingDamageRoll = values.swing ?? "";

				let baseDamageRoll = thrustDamageRoll;

				if (method == "swing") {
					baseDamageRoll = swingDamageRoll;
				}

				if (baseDamageRoll != "") {
					
					let modifier = Number(values[`${sectionName}_${id}_damage_modifier`]) || 0;

					let dieModifier = Number(values[`${sectionName}_${id}_damage_die_modifier`]) || 0;
	
					let applyDiceAdds = values[`${sectionName}_${id}_apply_dice_adds`] == "1";
	
					rollData = getCalculatedDamage(baseDamageRoll, modifier, dieModifier, applyDiceAdds);

				}
				
			}

			let keyValues = {
				[`${sectionName}_${id}_calculated_damage_roll`]: rollData,
				[`${sectionName}_${id}_damage`]: rollData
			};

			setAttrs(keyValues);

		});

	}

</script>
