<main>
	 <img src="https://i.imgur.com/FGiyoPX.jpeg" class="bg_image" alt="pic failed">
	 <input type="hidden" name="attr_version"  value="1">
	 
	 <!-- Set up the Tabs -->
	<input type="hidden" class="tabstoggle" name="attr_sheet_tab"  value="tab1">
	<div class="tab-buttons">
		<button type="action" name="act_tab1" >Character</button>
		<button type="action" name="act_tab2" >Skills</button>
		<button type="action" name="act_tab3" >Superpowers</button>
		<button type="action" name="act_tab4" >Social</button>
		<button type="action" name="act_tab5" >Combat</button>
		<button type="action" name="act_tab6" >GM Tools</button>		
	</div>
	<!-- Tab 1 -->
<div class="tab1 tab">
	
	<div class="tab1-container">
			<!-- Character info section -->
		<section class="biography">
			<h2>CHARACTER</h2>
			<div class="character-info">	
				
			<!-- Selector for which identity of character will be used in roll template -->
				<input type="radio" class="id-select" name="attr_select_id" value="1">
				<input type="radio" class="id-select" name="attr_select_id" value="2">
				<input type="radio" class="id-select" name="attr_select_id" value="3">
				
				<h4>Vigilante Name</h4>
				<h4>Civilian Name</h4>
				<h4>Assumed Identity</h4>
			
				<input type="text"  name="attr_character_name" />
				<input type="text"  name="attr_civ_name" />
				<input type="text"  name="attr_alias" />
			
					<input type="hidden" name="attr_name" value="Unnamed">
			
				<h4>Age</h4>
				<h4>Occupation</h4>
				<h4>High Concept</h4>
			
				<input type="number" name="attr_age" />
				<input type="text"  name="attr_occupation" />
				<input type="text"  name="attr_concept" />
			
				<h4>Height</h4>
				<h4>Weight</h4>
				<h4>Hair</h4>
			
				<input type="number" name="attr_height" />
				<input type="number" name="attr_weight" />
				<input type="text"  name="attr_hair" />
			
				<h4>Issues</h4>
				<h4>Total EXP</h4>
				<h4>Unspent EXP</h4>
			
			
				<input type="number" name="attr_adventure" />
				<input type="number" name="attr_totalexp" />
				<input type="number" name="attr_exp" />
			</div>

		</section>	<!-- Section for Abilities -->
		<section class=	"ability">
			<h2 class="ability-header">ABILITIES</h2>
			<div class= "ability-scores">
						
					
						<h4>Ability</h4>
						<h4>Rank</h4>
						<h4>Difficulty</h4>
						<h4>TN Mod</h4>
					
				
				
					
						<span>Strength</span>
						<select name="attr_strength">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_strDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_strength_tnmod" readonly>
					
					
						<span>Agility</span>
						<select name="attr_agility">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_agiDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_agility_tnmod" readonly>
					
					
						<span>Reaction</span>
						<select name="attr_reaction">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_reaDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_reaction_tnmod" readonly>
					
					
						<span>Endurance</span>
						<select name="attr_endurance">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_endDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_endurance_tnmod" readonly>
					
					
						<span>Perception</span>
						<select name="attr_perception">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_perDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_perception_tnmod" readonly>
					
					
						<span>Charisma</span>
						<select name="attr_charisma">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_chaDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_charisma_tnmod" readonly>
					
					
						<span>Logic</span>
						<select name="attr_logic">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_logDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_logic_tnmod" readonly>
					
					
						<span>Intuition</span>
						<select name="attr_intuition">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_intDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_intuition_tnmod" readonly>
					
					
						<span>Willpower</span>
						<select name="attr_willpower">
							<option value="1">1</option>
							<option value="2" selected="selected">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
						</select>
						<select name="attr_wilDC">
							<option value="A">A</option>
							<option value="B">B</option>
							<option value="C">C</option>
							<option value="D">D</option>
							<option value="E">E</option>
							<option value="F">F</option>
							<option value="G">G</option>
							<option value="H">H</option>
							<option value="I" selected="selected">I</option>
							<option value="J">J</option>
							<option value="K">K</option>
							<option value="L">L</option>
						</select>
						<input type="number" name="attr_willpower_tnmod" readonly>
					
					
			</div>	
				<!-- Setting up Ability + Ability roll  -->
			<div class=	"ability-roll">	
				
					
						<h4>Ability 1</h4>
						<h4>Ability 2</h4>
						<h4>Dice Mod</h4>
						<h4 class="wide">TN#</h4>
					
				
					
						<select name="attr_abi_pick1">
							<option value="0" selected="selected">None</option>
							<option value="strength">Strength</option>
							<option value="agility">Agility</option>
							<option value="reaction">Reaction</option>
							<option value="endurance">Endurance</option>
							<option value="perception">Perception</option>
							<option value="charisma">Charisma</option>
							<option value="logic">Logic</option>
							<option value="intuition" >Intuition</option>
							<option value="willpower">Willpower</option>
						</select> 
						<select name="attr_abi_pick2">
							<option value="0" selected="selected">None</option>
							<option value="strength">Strength</option>
							<option value="agility">Agility</option>
							<option value="reaction">Reaction</option>
							<option value="endurance">Endurance</option>
							<option value="perception">Perception</option>
							<option value="charisma">Charisma</option>
							<option value="logic">Logic</option>
							<option value="intuition" >Intuition</option>
							<option value="willpower">Willpower</option>
						</select> 
						
						<input type="number" name="attr_abi_dm" />
						
						<select name="attr_abitn">
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8"selected="selected">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
							<option value="11">11</option>
							<option value="12">12</option>
						</select>
						
						<button type="roll" value="&{template:gotham90} {{title=@{abi_pick1} + @{abi_pick2} vs @{abitn}}} {{subtitle=@{name}}} {{color=orange}} {{Successes:= [[@{abi_dicepool}d12sd>@{abi_doublescc}f<@{abi_f} + @{abi_dicepool}]]}}" name=Ability_roll">Ability Roll</button>
						
					
						<input type="hidden" name="attr_abi_dicepool"/>
						<input type="hidden" name="attr_abi_doublescc"/>
						<input type="hidden" name="attr_abi_f"/>
								
			</div>
		</section>	<!-- Stats for Hero Costume  -->
		<section class="costume">
			<h2>COSTUME</h2>
			<div class="costume-desc">
				<h4>Costume Look </h4> 
				<h4>Armor Type</h4>
				
				<input type="text" name="attr_costume">
				<select name="attr_armortype">
						<option value="1">1: No Armor</option>
						<option value="2">2: Ballistic</option>
						<option value="3">3: Heavy Armor</option>
						<option value="4">4: Hard Skin</option>
						<option value="5">5: Super</option>						
				</select>
				
			</div>
			<div class="costume-row">
				<h4>Enhancement</h4>
				<h4>GP Cost</h4>
				<h4>Effect</h4>
			</div>
			<fieldset class="repeating_costume">
					<div class="costume-row">
						<input type="text" name="attr_enhancement">
						<input type="number" name="attr_enhancementcost">
						<input type="text" name="attr_enhancementeffect"> 
					</div>
			</fieldset>
		</section>	<!-- Gadgets in use and gadget reseach info  -->
		<section class="gadgets">
			<h2 class="gadgets-header">GADGETS</h2>
			<div class="current-gadgets">
				<h3> Gadgets in Use </h3>
				<fieldset class="repeating_gadgets">
					<textarea name="gadget_desc" placeholder="A gadget's description here"></textarea>
				</fieldset>
			</div>
			<div class="gadget-research">
				<h3> Gadget Research </h3>
				<div class="gadget-row">
					<h4>Base Difficulty: </h4>
					<select name="attr_gadgetbasedc">
						<option value="A">A</option>
						<option value="B">B</option>
						<option value="C">C</option>
						<option value="D">D</option>
						<option value="E">E</option>
						<option value="F">F</option>
						<option value="G">G</option>
						<option value="H" selected="selected">H</option>
						<option value="I" >I</option>
						<option value="J">J</option>
						<option value="K">K</option>
						<option value="L">L</option>
					</select>
					<h4>Current Difficulty:</h4>
					<select name="attr_gadgetcurdc">
						<option value="A">A</option>
						<option value="B">B</option>
						<option value="C">C</option>
						<option value="D">D</option>
						<option value="E">E</option>
						<option value="F">F</option>
						<option value="G">G</option>
						<option value="H" selected="selected">H</option>
						<option value="I" >I</option>
						<option value="J">J</option>
						<option value="K">K</option>
						<option value="L">L</option>
					</select>
				</div>
				<textarea class="gadget-resources" name="gadget_resources" placeholder="Available resources for research here"></textarea>
				<textarea name="gadget_project" placeholder="Ongoing research projects here"></textarea>
				
			</div>
		</section>		<!-- Advantages of this character.  -->
		<section class="advantages">
			<h2>ADVANTAGES</h2>
			<div>
				<fieldset class=repeating_advantages">
					<textarea class="adv-textarea" name="adv_desc" placeholder="Advantage's description "></textarea>
				</fieldset>
			</div>
		</section>	<!-- Disadvantages -->
		<section class="disadvantages">
			<h2>DISADVANTAGES</h2>
			<div>
				<fieldset class=repeating_advantages">
					<textarea class="adv-textarea" name="disadv_desc"  placeholder="Disdvantage's description "></textarea>
				</fieldset>
			</div>
		</section>
	</div>
</div>	<!-- Tab 1 ends. Tab 2 begins  -->
<div class="tab2 tab">
	<div class="tab2-container">		<!-- List of characters skills and setup for Skill + Ability roll for each. -->
		<section class="skills">
			<h2> SKILLS</h2>
			
			<div class="skill-row">
				<h4>Name </h4>
				<h4>Rank </h4>
				<h4>Difficulty </h4>				
				<h4>TN Mod </h4>
				<h4>Ability </h4>
				<h4>Dice Mod </h4>
				<h4>TN </h4>
				<h4>Roll </h4>
			</div>
			<fieldset class="repeating_skills">
				<div class="skill-row">
					<input type="text" name="attr_skillname"/>
					<input type="number" name="attr_skillrank"/>
					<select name="attr_skilldc">
						<option value="A">A</option>
						<option value="B">B</option>
						<option value="C">C</option>
						<option value="D">D</option>
						<option value="E">E</option>
						<option value="F">F</option>
						<option value="G" selected="selected">G</option>
						<option value="H">H</option>
						<option value="I" >I</option>
						<option value="J">J</option>
						<option value="K">K</option>
						<option value="L">L</option>
					</select>
					<input type="number" name="attr_skilltnmod" readonly>
					<select name="attr_skillpick">
						<option value="0" selected="selected">None</option>
						<option value="strength">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					
					<input type="number" name="attr_skilldm">
					<select  name="attr_skilltn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8"selected="selected">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
					<button type="roll" value="&{template:gotham90} {{title=@{skillname} + @{skillpick} vs @{skilltn}}} {{subtitle=@{name}}} {{color=green}} {{Successes:= [[@{skilldicepool}d12sd>@{skilldoublescc}f<@{skillf} + @{skilldicepool}]]}}" name=skill_roll">Skill Roll</button>

					
					<input type="hidden" name="attr_skilldicepool"/>
					<input type="hidden" name="attr_skilldoublescc"/>
					<input type="hidden" name="attr_skillf"/>
				</div>
			</fieldset>
		</section>
	</div>
</div>								<!-- Tab 2 ends. Tab 3 begins. -->
<div class="tab3 tab">
	<div class="tab3-container">		<!-- Section for Superpowers. -->
		<section class="superpowers">
			
									<!-- As not all characters have Superpowers, toggle for showing 0, 1 or 2 Superpower packages. -->
			<div class="superheader">
				<h2>Superpowers</h2>
				<div class="power-select">
					<h4 class="center">Show 0</h4>
					<h4 class="center">Show 1</h4>
					<h4 class="center">Show 2</h4>
					<input type="radio" name="attr_p_select" class="p_select" value="0">			
					<input type="radio" name="attr_p_select" class="p_select" value="1">			
					<input type="radio" name="attr_p_select" class="p_select" value="2">
				</div>
			</div>			
					<input type="hidden" class="m1-toggle" name="attr_m1_toggle" value="0">					
			<div class="mastery1 mastery">			<!-- Mastery Power for 1st package -->
				<div class="mastery-header">
					<input type="text" name="attr_mastery1"/>
					<a class="button ch-button" href="#popup1">About Charging</a>
				</div>				
					<div id="popup1" class="overlay">
						<div class="popup">
							<h3>Charging a Power</h3>
							<a class="close" href="#">Ã—</a>
							<div class="content">
								You can charge up a power by adding Alterations to it. Each Alteration inflicts 4 Stun damage
								to your character. You can mitigate this with successes of a Charging roll. Base TN of that roll
								is 4,6 or 8 to Tiers A, B and C. Each Alteration beyond first is +1 TN. Every 2 alterations adds
								+1 AP cost to this action.
							</div>
						</div>
					</div>
				<div class="mastery-stats">
					
						<h4>Rank</h4>
						<h4>Difficulty</h4>
						<h4>TN Mod</h4>
					
						<input type="number" name="attr_mastery1_rank">
						<select name="attr_mastery1_dc">
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C">C</option>
								<option value="D">D</option>
								<option value="E">E</option>
								<option value="F">F</option>
								<option value="G">G</option>
								<option value="H">H</option>
								<option value="I" selected="selected" >I</option>
								<option value="J">J</option>
								<option value="K">K</option>
								<option value="L">L</option>
						</select>
						
						<input type="number" name="attr_mastery1_tnmod" readonly>
													
				</div>
				<div class="mastery-origin">
					
						<h4>Tier</h4>
						<h4>Origin</h4>
					
						<select name="attr_mastery1_tier">
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C" selected="selected">C</option>
						</select>						
						<input type="text" name="attr_mastery_origin"/>
					
				</div>	<!-- Setup for charging roll when a character boosts up a power. Mastery rank + Willpower  -->
				<div class="mastery-charge">
					
						<h4>Alterations</h4>
						<h4>Dice Mod</h4>
						<h4>TN</h4>
											
					
						<input type="number" class="col1" name="attr_mastery1_alterations">
						<input type="number" name="attr_mastery1_dm">
						<select name="attr_mastery1_tn">
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8"selected="selected">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
						</select>
						<button type="roll" value="&{template:gotham90} {{title=Charging roll vs @{mastery1_tn}}} {{subtitle=@{name} charges up a Power with @{mastery1_alterations} alterations.}} {{color=purple}} {{name=@{name}}} {{charging= [[4 * (@{mastery1_alterations}) - (@{m1dicepool}d12sd>@{m1_doublescc}f<@{m1_f} + @{m1dicepool})]]}}" name=m1charge_roll">Charging</button>
					
								<input type="hidden" name="attr_m1dicepool"/>
								<input type="hidden" name="attr_m1_doublescc"/>
								<input type="hidden" name="attr_m1_f"/>
				</div>
				<div class="mastery-descriptions">
					
						<h4>Description</h4>
						<h4>General Limitations</h4>
						
						<textarea name="Description_mastery"  placeholder="SFX and functionality of this power set."></textarea>
						<textarea class="m-lim" name="Limitations_mastery"  placeholder="General limitations to this power set."></textarea>
				</div>
			</div>
					<input type="hidden" class="p1-toggle" name="attr_p1_toggle" value="0">
			<div class="power1-wrapper">	<!-- A repeating section for Powers belonging in this package Also Power rank + Ability roll -->
			<fieldset class="repeating_powers1">
			<div class="power1 power">
				<div class="p-name"><input type="text" name="attr_power1"/></div>
				
					<h4 class="col1">Rank</h4>
					<h4>Difficulty</h4>
					<h4>TN Mod</h4>
					<h4>Ability</h4>
					<h4>Dice Mod</h4>
					<h4>TN</h4>
					<h4>Power Roll</h4>
				
					<input type="number" name="attr_power1rank">
					<select name="attr_power1dc">
						<option value="A">A</option>
						<option value="B">B</option>
						<option value="C">C</option>
						<option value="D">D</option>
						<option value="E">E</option>
						<option value="F">F</option>
						<option value="G">G</option>
						<option value="H">H</option>
						<option value="I" selected="selected" >I</option>
						<option value="J">J</option>
						<option value="K">K</option>
						<option value="L">L</option>
					</select>
					<input type="number" name="attr_power1tnmod" readonly>
					<select name="attr_power1pick">
						<option value="strength">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower"selected="selected">Willpower</option>
					</select>
					<input type="number" name="attr_power1dm">
					<select name="attr_power1tn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8"selected="selected">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
					<button type="roll" value="&{template:gotham90} {{title=@{power1} + @{power1pick} vs @{power1tn}}} {{subtitle=@{name}}} {{color=violet}} {{Successes:= [[@{power1dicepool}d12sd>@{power1doublescc}f<@{power1f} + @{power1dicepool}]]}}" name=power1_roll">Power Roll</button>
					
						<input type="hidden" name="attr_power1dicepool"/>
						<input type="hidden" name="attr_power1doublescc"/>
						<input type="hidden" name="attr_power1f"/>
				
					<h4 class="p-des">Description</h4>
					<h4 class="p-lim">Limitations</h4>
					<h4 class="p-alt">Alterations</h4>
				
					<textarea class="p-des" name="Description_power1"  placeholder="SFX and functionality of this power."></textarea>
					<textarea class="p-lim" name="Limitations_power1"  placeholder="Limitations on this particular power."></textarea>
					<textarea class="p-alt" name="Alterations_power1"  placeholder="Possible alterations when Charging Up this power"></textarea>
				
			</div>
			</fieldset>
			</div>		<!-- Power package #2 for those character who opted to take two packages. -->
					<input type="hidden" class="m2-toggle" name="attr_m2_toggle" value="0">
			<div class="mastery2 mastery">
				<div class="mastery-header">
					<input type="text" name="attr_mastery2"/>
				</div>	
					
				
				<div class="mastery-stats">
					
						<h4>Rank</h4>
						<h4>Difficulty</h4>
						<h4>TN Mod</h4>
					
						<input type="number" name="attr_mastery2_rank">
						<select name="attr_mastery2_dc">
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C">C</option>
								<option value="D">D</option>
								<option value="E">E</option>
								<option value="F">F</option>
								<option value="G">G</option>
								<option value="H">H</option>
								<option value="I" selected="selected" >I</option>
								<option value="J">J</option>
								<option value="K">K</option>
								<option value="L">L</option>
						</select>
						
						<input type="number" name="attr_mastery2_tnmod" readonly>
													
				</div>
				<div class="mastery-origin">
					
						<h4>Tier</h4>
						<h4>Origin</h4>
					
						<select name="attr_mastery2_tier">
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C" selected="selected">C</option>
						</select>						
						<input type="text" name="attr_mastery2_origin"/>
					
				</div>
				<div class="mastery-charge">
					
						<h4>Alterations</h4>
						<h4>Dice Mod</h4>
						<h4>TN</h4>
						<h4>Charge Roll</h4>
					
					
						<input type="number" name="attr_mastery2_alterations">
						<input type="number" name="attr_mastery2_dm">
						<select name="attr_mastery2_tn">
								<option value="2">2</option>
								<option value="3">3</option>
								<option value="4">4</option>
								<option value="5">5</option>
								<option value="6">6</option>
								<option value="7">7</option>
								<option value="8"selected="selected">8</option>
								<option value="9">9</option>
								<option value="10">10</option>
								<option value="11">11</option>
								<option value="12">12</option>
						</select>
						<button type="roll" value="&{template:gotham90} {{title=Charging roll vs @{mastery2_tn}}} {{subtitle=@{name} charges up a Power with @{mastery2_alterations} alterations.}} {{color=purple}} {{name=@{name}}} {{charging= [[4 * (@{mastery2_alterations}) - (@{m2dicepool}d12sd>@{m2_doublescc}f<@{m2_f} + @{m2dicepool})]]}}" name=m2charge_roll">Charging</button>
					
								<input type="hidden" name="attr_m2dicepool"/>
								<input type="hidden" name="attr_m2_doublescc"/>
								<input type="hidden" name="attr_m2_f"/>
				</div>
				<div class="mastery-descriptions">
					
						<h4>Description</h4>
						<h4>General Limitations</h4>
						
						<textarea name="Description_mastery2"  placeholder="SFX and functionality of this power set."></textarea>
						<textarea class="m-lim" name="Limitations_mastery2"  placeholder="General limitations to this power set."></textarea>
				</div>
			</div>
					<input type="hidden" class="p2-toggle" name="attr_p2_toggle" value="0">
			<div class="power2-wrapper">
			<fieldset class="repeating_powers2">
			<div class="power2 power">
				<div class="p-name"><input type="text" name="attr_power2"/></div>
				
					<h4 class="col1">Rank</h4>
					<h4>Difficulty</h4>
					<h4>TN Mod</h4>
					<h4>Ability</h4>
					<h4>Dice Mod</h4>
					<h4>TN</h4>
					<h4>Power Roll</h4>
				
					<input type="number" name="attr_power2rank">
					<select name="attr_power2dc">
						<option value="A">A</option>
						<option value="B">B</option>
						<option value="C">C</option>
						<option value="D">D</option>
						<option value="E">E</option>
						<option value="F">F</option>
						<option value="G">G</option>
						<option value="H">H</option>
						<option value="I" selected="selected" >I</option>
						<option value="J">J</option>
						<option value="K">K</option>
						<option value="L">L</option>
					</select>
					<input type="number" name="attr_power2tnmod" readonly>
					<select name="attr_power2pick">
						<option value="strength">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower"selected="selected">Willpower</option>
					</select>
					<input type="number" name="attr_power2dm">
					<select name="attr_power2tn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8"selected="selected">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
					<button type="roll" value="&{template:gotham90} {{title=@{power2} + @{power2pick} vs @{power2tn}}} {{subtitle=@{name}}} {{color=violet}} {{Successes:= [[@{power2dicepool}d12sd>@{power2doublescc}f<@{power2f} + @{power2dicepool}]]}}" name=power2_roll">Power Roll</button>
					
						<input type="hidden" name="attr_power2dicepool"/>
						<input type="hidden" name="attr_power2doublescc"/>
						<input type="hidden" name="attr_power2f"/>
				
					<h4 class="p-des">Description</h4>
					<h4 class="p-lim">Limitations</h4>
					<h4 class="p-alt">Alterations</h4>
				
					<textarea class="p-des" name="Description_power2"  placeholder="SFX and functionality of this power."></textarea>
					<textarea class="p-lim" name="Limitations_power2"  placeholder="Limitations on this particular power."></textarea>
					<textarea class="p-alt" name="Alterations_power2"  placeholder="Possible alterations when Charging Up this power"></textarea>
				
			</div>
			</fieldset>	
			</div>
		</section>
	</div>
</div>
						<!-- End of Tab 3. Start of Tab 4. -->
<div class="tab4 tab">
	<div class="tab4-container">	<!-- Section for characters reputation levels with various groups and associated perks.  -->
		<section class=	"reputation">
		
				<h2 class="rep-header">REPUTATIONS</h2>
					<div class="fame">
						<h3>Fame</h3>
						<h4>This is your reputation amongst the people of Gotham City.</h4>
						<div class="rep-meter">
							<h4>Fame Points</h4>
							<input type="radio" class="dot reset" name="attr_fame" value="0" checked="checked" />
							<input type="radio" class="dot" name="attr_fame" value="1" />
							<input type="radio" class="dot" name="attr_fame" value="2" />
							<input type="radio" class="dot" name="attr_fame" value="3" />
							<input type="radio" class="dot" name="attr_fame" value="4" />
							<input type="radio" class="dot" name="attr_fame" value="5" />
							<input type="radio" class="dot" name="attr_fame" value="6" />
							<input type="radio" class="dot" name="attr_fame" value="7" />
							<input type="radio" class="dot" name="attr_fame" value="8" />
							<input type="radio" class="dot" name="attr_fame" value="9" />
							<input type="radio" class="dot" name="attr_fame" value="10" />
						</div>
						<div class="rep-level">
							<h4>Fame level: </h4>
							<input type="number" name="attr_famelvl" />
							<details>
								 <textarea  name="attr_fame_traits"  placeholder="Fame perks earned"></textarea>
								 <summary>
									<span>Show Fame Perks</span>
								 </summary>
							</details>
						</div>	
						
					</div>
					<div class="herorep">
						<h3>Hero Community</h3>
						<h4>Your reputation with fellow Superheroes and their close affiliates.</h4>
						
						<div class="rep-meter">
							<h4>Reputation Points</h4>
							<input type="radio" class="dot reset" name="attr_herorep" value="0" checked="checked" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="1" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="2" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="3" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="4" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="5" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="6" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="7" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="8" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="9" /><span></span>
							<input type="radio" class="dot" name="attr_herorep" value="10" /><span></span>
						</div>
						<div class="rep-level">
							<h4>Reputation level: </h4> 
							<input type="number" name="attr_heroreplvl" />
							<details>
								 <textarea  name="attr_herorep_traits"  placeholder="Hero reputation perks earned"></textarea>
								 <summary>
									<span>Show Reputation Perks</span>
								 </summary>
							</details>
						</div>							
					</div>
					<div class="lawrep">
						<h3>Law Enforcement</h3>
						<h4>Your reputation with GCPD, FBI, justice system and the like.</h4>
						<div class="rep-meter">
							<h4>Reputation Points</h4>
							<input type="radio" class="dot reset" name="attr_lawrep" value="0" checked="checked" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="1" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="2" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="3" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="4" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="5" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="6" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="7" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="8" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="9" /><span></span>
							<input type="radio" class="dot" name="attr_lawrep" value="10" /><span></span>
						</div>
						<div class="rep-level">
							<span>Reputation level: </span> 
							<input type="number" name="attr_lawreplvl" />
							<details>
								 <textarea  name="attr_lawrep_traits"  placeholder="Law Enforcement reputation perks earned"></textarea>
								 <summary>
									<h4>Show Reputation Perks</h4>
								 </summary>
							</details>
						</div>							
					</div>
					<div class="crimerep">
						<h3>Underworld</h3>
						<h4>Your reputation with the criminal element.</h4>
						<div class="rep-meter">
							<h4>Reputation Points</h4>
							<input type="radio" class="dot reset" name="attr_crimerep" value="0" checked="checked" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="1" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="2" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="3" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="4" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="5" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="6" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="7" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="8" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="9" /><span></span>
							<input type="radio" class="dot" name="attr_crimerep" value="10" /><span></span>
						</div>
						<div class="rep-level">
							<h4>Reputation level: </h4> 
							<input type="number" name="attr_crimelvl" />
							<details>
								 <textarea  name="attr_crimerep_traits"  placeholder="Underworld reputation perks earned"></textarea>
								 <summary>
									<span>Show Reputation Perks</span>
								 </summary>
							</details>
						</div>						
						
					</div>
					<div class="infamy">
						<h3>Infamy</h3>
						<h4>Notoriety earned by excessive violence, cruelty and incompetence.</h4>
						<div class="rep-meter">
							<span>Infamy Points</span>
							<input type="radio" class="dot reset" name="attr_infamy" value="0" checked="checked" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="1" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="2" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="3" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="4" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="5" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="6" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="7" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="8" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="9" /><span></span>
							<input type="radio" class="dot" name="attr_infamy" value="10" /><span></span>
						</div>
						<div class="rep-level">
							<span>Infamy level: </span> 
							<input type="number" name="attr_infamylvl" />
							<details>
								 <textarea  name="attr_infamy_traits"  placeholder="Infamy perks earned"></textarea>
								 <summary>
									<span>Show Reputation Perks</span>
								 </summary>
							</details>
						</div>	
						
					</div>
					
		</section>			<!-- Drama points and character plans which affect exp system. -->
		<section class="drama">
			<h3>DRAMA, PLANS AND GOALS	</h3>
			<h4>Unspent Drama Points</h4>
			<div class="drama-meter">
							
							<input type="radio" class="dot reset" name="attr_drama" value="0" checked="checked" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="1" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="2" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="3" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="4" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="5" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="6" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="7" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="8" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="9" /><span></span>
							<input type="radio" class="dot" name="attr_drama" value="10" /><span></span>
			</div>
			<h4>Current Plans and Goals </h4>
			<div><textarea name="drama_plans" placeholder="Your character's plans and goals here"></textarea></div>
			<details>
				 <textarea name="drama_uses" placeholder="Some uses for DP"></textarea>
				 <summary>
						<span>Show Ways to Spend Drama Points</span>
				 </summary>
			</details>
			
		</section>			<!-- People that are important to the character for various reasons -->
		<section class="contacts">
			<h3> CONTACTS AND RELATIONSHIPS </h3>
			<div class="contacts-row">
				<h4>Name </h4>
				<h4>Role </h4>
				<h4>Relationship </h4>
			</div>
			<fieldset class="repeating_contacts">	
			<div class="contacts-row">
				<input type="text" name="attr_contact_name"/>
				<input type="text" name="attr_contact_role"/>
				<input type="text" name="attr_contact_relationship"/>
			</div>
			</fieldset>
		</section>
	</div>
</div> 				<!-- End of Tab 4. Start of Tab 5 -->
<div class="tab5 tab">
	<div class="tab5-container">		<!-- Health meters for physical and stun damage -->
		<section class="health">
			<h3> HEALTH AND INJURIES </h3>
			<div class="health-row">
				<h4>Resilience </h4>
				<h4>Toughness </h4>
			
				<input type="number" name="attr_resilience">
				<input type="number" name="attr_toughness">

			</div>
				<input type="hidden" name="attr_health_squares"/>
				<input type="hidden" name="attr_stun_squares"/>
			<div class="health-and-stun">		<!-- Physical meters have Endurance + Resilience squares. Rest are hidden.  -->
				<div class="health-meters">
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health1" value="0">
						<input class="square" type="radio" name="attr_health1" value="1">
							<input type="hidden" name="attr_h11" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="2">
							<input type="hidden" name="attr_h12" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="3">
							<input type="hidden" name="attr_h13" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="4">
							<input type="hidden" name="attr_h14" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="5">
							<input type="hidden" name="attr_h15" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="6">
							<input type="hidden" name="attr_h16" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="7">
							<input type="hidden" name="attr_h17" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="8">
							<input type="hidden" name="attr_h18" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="9">
							<input type="hidden" name="attr_h19" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health1" value="10">
							<input type="hidden" name="attr_h110" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health2" value="0">
						<input class="square" type="radio" name="attr_health2" value="1">
							<input type="hidden" name="attr_h21" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="2">
							<input type="hidden" name="attr_h22" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="3">
							<input type="hidden" name="attr_h23" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="4">
							<input type="hidden" name="attr_h24" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="5">
							<input type="hidden" name="attr_h25" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="6">
							<input type="hidden" name="attr_h26" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="7">
							<input type="hidden" name="attr_h27" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="8">
							<input type="hidden" name="attr_h28" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="9">
							<input type="hidden" name="attr_h29" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health2" value="10">
							<input type="hidden" name="attr_h210" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health3" value="0">
						<input class="square" type="radio" name="attr_health3" value="1">
							<input type="hidden" name="attr_h31" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="2">
							<input type="hidden" name="attr_h32" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="3">
							<input type="hidden" name="attr_h33" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="4">
							<input type="hidden" name="attr_h34" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="5">
							<input type="hidden" name="attr_h35" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="6">
							<input type="hidden" name="attr_h36" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="7">
							<input type="hidden" name="attr_h37" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="8">
							<input type="hidden" name="attr_h38" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="9">
							<input type="hidden" name="attr_h39" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health3" value="10">
							<input type="hidden" name="attr_h310" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health4" value="0">
						<input class="square" type="radio" name="attr_health4" value="1">
							<input type="hidden" name="attr_h41" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="2">
							<input type="hidden" name="attr_h42" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="3">
							<input type="hidden" name="attr_h43" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="4">
							<input type="hidden" name="attr_h44" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="5">
							<input type="hidden" name="attr_h45" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="6">
							<input type="hidden" name="attr_h46" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="7">
							<input type="hidden" name="attr_h47" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="8">
							<input type="hidden" name="attr_h48" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="9">
							<input type="hidden" name="attr_h49" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health4" value="10">
							<input type="hidden" name="attr_h410" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health5" value="0">
						<input class="square" type="radio" name="attr_health5" value="1">
							<input type="hidden" name="attr_h51" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="2">
							<input type="hidden" name="attr_h52" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="3">
							<input type="hidden" name="attr_h53" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="4">
							<input type="hidden" name="attr_h54" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="5">
							<input type="hidden" name="attr_h55" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="6">
							<input type="hidden" name="attr_h56" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="7">
							<input type="hidden" name="attr_h57" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="8">
							<input type="hidden" name="attr_h58" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="9">
							<input type="hidden" name="attr_h59" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health5" value="10">
							<input type="hidden" name="attr_h510" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health6" value="0">
						<input class="square" type="radio" name="attr_health6" value="1">
							<input type="hidden" name="attr_h61" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="2">
							<input type="hidden" name="attr_h62" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="3">
							<input type="hidden" name="attr_h63" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="4">
							<input type="hidden" name="attr_h64" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="5">
							<input type="hidden" name="attr_h65" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="6">
							<input type="hidden" name="attr_h66" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="7">
							<input type="hidden" name="attr_h67" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="8">
							<input type="hidden" name="attr_h68" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="9">
							<input type="hidden" name="attr_h69" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_health6" value="10">
							<input type="hidden" name="attr_h610" value="0"/>
					</div>
					<div class="meter-row reverse">
						<input checked="checked" class="square reset" type="radio" name="attr_health7" value="0">
						<input class="square" type="radio" name="attr_health7" value="1">
					</div>
				</div>
				<div class="health-status">
					<h4 class="center"> FINE </h4>
					<h4 class="center"> +0 </h4>
					<h4 class="center"> +1 </h4>
					<h4 class="center"> +2 </h4>
					<h4 class="center"> DOWN </h4>
					<h4 class="center"> OUT </h4>
					<h4 class="center"> DEAD </h4>
				</div>						<!-- Stun meters have Willpower + Toughness squares. Rest are hidden. -->
				<div class="health-meters stun-meters">
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun1" value="0">
						<input class="square" type="radio" name="attr_stun1" value="1">
							<input type="hidden" name="attr_s11" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="2">
							<input type="hidden" name="attr_s12" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="3">
							<input type="hidden" name="attr_s13" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="4">
							<input type="hidden" name="attr_s14" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="5">
							<input type="hidden" name="attr_s15" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="6">
							<input type="hidden" name="attr_s16" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="7">
							<input type="hidden" name="attr_s17" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="8">
							<input type="hidden" name="attr_s18" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="9">
							<input type="hidden" name="attr_s19" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun1" value="10">
							<input type="hidden" name="attr_s110" value="0"/>
					</div>
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun2" value="0">
						<input class="square" type="radio" name="attr_stun2" value="1">
							<input type="hidden" name="attr_s21" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="2">
							<input type="hidden" name="attr_s22" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="3">
							<input type="hidden" name="attr_s23" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="4">
							<input type="hidden" name="attr_s24" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="5">
							<input type="hidden" name="attr_s25" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="6">
							<input type="hidden" name="attr_s26" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="7">
							<input type="hidden" name="attr_s27" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="8">
							<input type="hidden" name="attr_s28" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="9">
							<input type="hidden" name="attr_s29" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun2" value="10">
							<input type="hidden" name="attr_s210" value="0"/>
					</div>
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun3" value="0">
						<input class="square" type="radio" name="attr_stun3" value="1">
							<input type="hidden" name="attr_s31" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="2">
							<input type="hidden" name="attr_s32" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="3">
							<input type="hidden" name="attr_s33" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="4">
							<input type="hidden" name="attr_s34" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="5">
							<input type="hidden" name="attr_s35" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="6">
							<input type="hidden" name="attr_s36" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="7">
							<input type="hidden" name="attr_s37" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="8">
							<input type="hidden" name="attr_s38" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="9">
							<input type="hidden" name="attr_s39" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun3" value="10">
							<input type="hidden" name="attr_s310" value="0"/>
					</div>
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun4" value="0">
						<input class="square" type="radio" name="attr_stun4" value="1">
							<input type="hidden" name="attr_s41" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="2">
							<input type="hidden" name="attr_s42" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="3">
							<input type="hidden" name="attr_s43" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="4">
							<input type="hidden" name="attr_s44" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="5">
							<input type="hidden" name="attr_s45" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="6">
							<input type="hidden" name="attr_s46" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="7">
							<input type="hidden" name="attr_s47" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="8">
							<input type="hidden" name="attr_s48" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="9">
							<input type="hidden" name="attr_s49" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun4" value="10">
							<input type="hidden" name="attr_s410" value="0"/>
					</div>
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun5" value="0">
						<input class="square" type="radio" name="attr_stun5" value="1">
							<input type="hidden" name="attr_s51" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="2">
							<input type="hidden" name="attr_s52" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="3">
							<input type="hidden" name="attr_s53" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="4">
							<input type="hidden" name="attr_s54" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="5">
							<input type="hidden" name="attr_s55" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="6">
							<input type="hidden" name="attr_s56" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="7">
							<input type="hidden" name="attr_s57" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="8">
							<input type="hidden" name="attr_s58" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="9">
							<input type="hidden" name="attr_s59" class="squaretoggle" value="0"/>
						<input class="square" type="radio" name="attr_stun5" value="10">
							<input type="hidden" name="attr_s510" value="0"/>
					</div>
					<div class="meter-row">
						<input checked="checked" class="square reset" type="radio" name="attr_stun6" value="0">
						<input class="square" type="radio" name="attr_stun6" value="1">
					</div>
				</div>	
			</div>		<!-- Section for Resist Injury roll and list of injuries suffered. -->
			<div class="injuries">
				<h3> INJURIES</h3>
				<div class="injury-check">
					<h4>Injury Margin</h4>
					<h4 class="adjust">Dice Mod</h4>
					<h4 class="adjust">TN</h4>
				</div>
				<div class="injury-check">
					<input type="number" name="attr_injury_margin">
					<input type="number" name="attr_injury_dm">
					<select name="attr_injury_tn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7" selected="selected">7</option>
						<option value="8">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
					<button type="roll" value="&{template:gotham90} {{title=Resist Injury vs @{injury_tn}}} {{subtitle=@{name}}} {{color=white}} {{name=@{name}}} {{injury=[[@{injury_margin} - (@{injury_dicepool}d12sd>@{injury_doublescc}f<@{injury_f} + @{injury_dicepool})]]}}" name=injury_roll">Injury Check</button>
				</div>
				<input type="hidden" name="injury_dicepool" value="1">
				<input type="hidden" name="injury_doublescc" value="12">
				<input type="hidden" name="injury_f" value="6">
				<div class="injury-row">
					<h4>Injured Bodypart</h4>
					<h4>Severity</h4>
					<h4>Effect</h4>
				</div>
				<fieldset class="repeating_injuries">
				<div class="injury-row">
					<input type="text" name="attr_injury">
					<select name="attr_injury_type">
						<option value="1">Regular</option>
						<option value="2">Niggling</option>
						<option value="3">Permanent</option>
					</select>
					<input type="text" name="attr_injuryeffect">
				</div>
				</fieldset>
			</div>
		</section>		<!-- Initiative roll for turn order tracker. -->
		<section class="initiative">
			<h3>INITIATIVE</h3>
			<div class="initiative-row">
				<h4 class="adjust">Mod From Last Round:</h4>
				<input type="number" name="attr_init_mod">
				<button type="roll" value="&{template:gotham90} {{title=Initiative Roll}} {{subtitle=@{name}}} {{color=silver}} {{Resulting AP:= [[ (@{reaction}+@{intuition})d12sd>11 + @{init_mod} +8 &{tracker}]]}}" name=init_roll">Initiative</button>
			</div>
		</section>
		<section class="attack">	<!-- Attack and Damage rolls setup. -->
			<h3>ATTACK AND DAMAGE</h3>
			<div class="attack-buttons">
				<button type="roll" value="&{template:gotham90} {{title=@{attack_name} + @{attack_pick} vs @{attack_tn}}} {{subtitle=@{name} is attacking.}} {{color=red}} {{Successes:= [[ @{attack_dicepool}d12sd>@{attack_doublescc}f<@{attack_f} + @{attack_dicepool}]]}}" name=attack_roll">Attack</button>
				<button type="roll" value="&{template:gotham90} {{title=Damage Roll vs @{damage_tn}}} {{subtitle=@{name} inflicts damage with @{attack_name} attack.}} {{color=brown}} {{Damage Type:= @{damage_type}}} {{@{damage_style} Damage: = [[@{damage_dicepool}d12sd>@{damage_tn}]]}}" name=damage_roll">Damage</button>
			</div>
						<input type="hidden" name="attr_attack_dicepool" value="0">
						<input type="hidden" name="attr_attack_doublescc" value="11">
						<input type="hidden" name="attr_attack_f" value="6">
						<input type="hidden" name="attr_damage_dicepool" value="0">
						<input type="hidden" name="attr_attack_name" value="fist">
						
			<div class="attack-modifiers">
				<h4>Ability</h4>
				<h4>+Dice</h4>
				<h4 class="adjust">TN</h4>
				<h4>Type</h4>
				<h4>St/Ph</h4>
				<h4>+Dice</h4>
				<h4 class="adjust">TN</h4>
				<select name="attr_attack_pick">
					<option value="strength">Strength</option>
					<option value="agility" selected="selected">Agility</option>
					<option value="reaction">Reaction</option>
					<option value="endurance">Endurance</option>
					<option value="perception">Perception</option>
					<option value="charisma">Charisma</option>
					<option value="logic">Logic</option>
					<option value="intuition" >Intuition</option>
					<option value="willpower">Willpower</option>
				</select>
				<input type="number" name="attr_attack_dm">
				<select name="attr_attack_tn">
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8"selected="selected">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
				<select name="attr_damage_type">
					<option value="Blunt">Blunt</option>
					<option value="Piercing">Piercing</option>
					<option value="Cutting">Cutting</option>
					<option value="Firearms">Firearms</option>
					<option value="Fire">Fire</option>
					<option value="Electricity">Electricity</option>
					<option value="Energy">Energy</option>
					<option value="Acid">Acid</option>
					<option value="Magical">Magical</option>
					<option value="Psychic">Psychic</option>
					<option value="Sonic">Sonic</option>
				</select>
				<select name="attr_damage_style">
					<option value="stun">Stun</option>
					<option value="physical">Physical</option>
				</select>
				<input type="number" name="attr_damage_dm">
				<select name="attr_damage_tn">
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8"selected="selected">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
			</div>
			
						<!-- Listing stats of all attacks the character has. Overlap with skill section for convenience.  -->
						<!-- Selected attack will be highlighted in red. -->
			<div class="weapons">
				<h4>Pick</h4>
				<div class="weapon">					
					<h4>Attack</h4>
					<h4>Rank</h4>
					<h4>Dmg Stat</h4>
					<h4>Bonus</h4>
					<h4>Type</h4>
					<h4>Armor Tn</h4>
				</div>
				<input type="radio" name="attr_attack_choice" class="w-pick" value="1">
				<div class="weapon">	
					<input type="text" name="attr_attack_name_1">
					<input type="number" name="attr_attack_rank_1">
					<select name="attr_damage_stat_1">
						<option value="0">None</option>
						<option value="strength" selected="selected">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					<input type="number" name="attr_dmg_bonus_1">
					<select name="attr_damage_type_1">
						<option value="Blunt">Blunt</option>
						<option value="Piercing">Piercing</option>
						<option value="Cutting">Cutting</option>
						<option value="Firearms">Firearms</option>
						<option value="Fire">Fire</option>
						<option value="Electricity">Electricity</option>
						<option value="Energy">Energy</option>
						<option value="Acid">Acid</option>
						<option value="Magical">Magical</option>
						<option value="Psychic">Psychic</option>
						<option value="Sonic">Sonic</option>
					</select>
					<input type="text" name="attr_armor_tn_1">
				</div>
				<input type="radio" name="attr_attack_choice" class="w-pick" value="2">
				<div class="weapon">
					<input type="text" name="attr_attack_name_2">
					<input type="number" name="attr_attack_rank_2">
					<select name="attr_damage_stat_2">
						<option value="0">None</option>
						<option value="strength" selected="selected">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					<input type="number" name="attr_dmg_bonus_2">
					<select name="attr_damage_type_2">
						<option value="blunt">Blunt</option>
						<option value="piercing">Piercing</option>
						<option value="cutting">Cutting</option>
						<option value="firearms">Firearms</option>
						<option value="fire">Fire</option>
						<option value="electricity">Electricity</option>
						<option value="energy">Energy</option>
						<option value="acid">Acid</option>
						<option value="magical">Magical</option>
						<option value="psychic">Psychic</option>
						<option value="sonic">Sonic</option>
					</select>
					<input type="text" name="attr_armor_tn_2">
				</div>
				<input type="radio" name="attr_attack_choice" class="w-pick" value="3">
				<div class="weapon">
					<input type="text" name="attr_attack_name_3">
					<input type="number" name="attr_attack_rank_3">
					<select name="attr_damage_stat_3">
						<option value="0">None</option>
						<option value="strength" selected="selected">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					<input type="number" name="attr_dmg_bonus_3">
					<select name="attr_damage_type_3">
						<option value="blunt">Blunt</option>
						<option value="piercing">Piercing</option>
						<option value="cutting">Cutting</option>
						<option value="firearms">Firearms</option>
						<option value="fire">Fire</option>
						<option value="electricity">Electricity</option>
						<option value="energy">Energy</option>
						<option value="acid">Acid</option>
						<option value="magical">Magical</option>
						<option value="psychic">Psychic</option>
						<option value="sonic">Sonic</option>
					</select>
					<input type="text" name="attr_armor_tn_3">
				</div>
				<input type="radio" name="attr_attack_choice" class="w-pick" value="4">
				<div class="weapon">
					<input type="text" name="attr_attack_name_4">
					<input type="number" name="attr_attack_rank_4">
					<select name="attr_damage_stat_4">
						<option value="0">None</option>
						<option value="strength" selected="selected">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					<input type="number" name="attr_dmg_bonus_4">
					<select name="attr_damage_type_4">
						<option value="blunt">Blunt</option>
						<option value="piercing">Piercing</option>
						<option value="cutting">Cutting</option>
						<option value="firearms">Firearms</option>
						<option value="fire">Fire</option>
						<option value="electricity">Electricity</option>
						<option value="energy">Energy</option>
						<option value="acid">Acid</option>
						<option value="magical">Magical</option>
						<option value="psychic">Psychic</option>
						<option value="sonic">Sonic</option>
					</select>
					<input type="text" name="attr_armor_tn_4">
				</div>
				<input type="radio" name="attr_attack_choice" class="w-pick" value="5">
				<div class="weapon">
					<input type="text" name="attr_attack_name_5">
					<input type="number" name="attr_attack_rank_5">
					<select name="attr_damage_stat_5">
						<option value="0">None</option>
						<option value="strength" selected="selected">Strength</option>
						<option value="agility">Agility</option>
						<option value="reaction">Reaction</option>
						<option value="endurance">Endurance</option>
						<option value="perception">Perception</option>
						<option value="charisma">Charisma</option>
						<option value="logic">Logic</option>
						<option value="intuition" >Intuition</option>
						<option value="willpower">Willpower</option>
					</select>
					<input type="number" name="attr_dmg_bonus_5">
					<select name="attr_damage_type_5">
						<option value="blunt">Blunt</option>
						<option value="piercing">Piercing</option>
						<option value="cutting">Cutting</option>
						<option value="firearms">Firearms</option>
						<option value="fire">Fire</option>
						<option value="electricity">Electricity</option>
						<option value="energy">Energy</option>
						<option value="acid">Acid</option>
						<option value="magical">Magical</option>
						<option value="psychic">Psychic</option>
						<option value="sonic">Sonic</option>
					</select>
					<input type="text" name="attr_armor_tn_5">
				</div>
			</div>
			
		</section>		<!-- Setup for defense roll. -->
		<section class="defense">
			<h3>DEFENSE</h3>
			<div class="defense-row">
				<h4>Ability</h4>
				<h4>Dice Mod</h4>
				<div>TN</div>
				<select name="attr_defense_pick" id="d1">
					<option value="strength">Strength</option>
					<option value="agility">Agility</option>
					<option value="reaction" selected="selected">Reaction</option>
					<option value="endurance">Endurance</option>
					<option value="perception">Perception</option>
					<option value="charisma">Charisma</option>
					<option value="logic">Logic</option>
					<option value="intuition" >Intuition</option>
					<option value="willpower">Willpower</option>
				</select>
				<input type="number" name="attr_defense_dm">
				<select name="attr_defense_tn">
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8"selected="selected">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select>
				<button type="roll" name=defense_roll" value="&{template:gotham90} {{title=@{defense_name} + @{defense_pick} vs @{defense_tn}}} {{subtitle=@{name} is defending. }} {{color=blue}} {{Defense roll:= [[@{defense_dicepool}d12sd>@{defense_doublescc}f<@{defense_f} + @{defense_dicepool}]] successes}} ">Defense</button>
			</div>
				<input type="hidden" name="attr_defense_name" value="Dodge">
				<input type="hidden" name="attr_defense_dicepool" value="1">
				<input type="hidden" name="attr_defense_doublescc" value="12"> 
				<input type="hidden" name="attr_defense_f" value="7">
			<div class="defense-skills">	<!-- List of available defenses. Selected on highlighted in blue. -->
				<input type="radio" name="attr_defense_choice" class="d-pick" value="1">
				<div class="d-skill">
					<input type="text" name="attr_d_name_1">
					<input type="number" name="attr_d_rank_1">
				</div>
				<input type="radio" id="d2" name="attr_defense_choice" class="d-pick" value="2">
				<div class="d-skill">
					<input type="text" name="attr_d_name_2">
					<input type="number" name="attr_d_rank_2">
				</div>
				<input type="radio" id="d3" name="attr_defense_choice" class="d-pick" value="3">
				<div class="d-skill">
					<input type="text" name="attr_d_name_3">
					<input type="number" name="attr_d_rank_3">
				</div>
				<input type="radio" id="d4" name="attr_defense_choice" class="d-pick" value="4">
				<div class="d-skill">
					<input type="text" name="attr_d_name_4">
					<input type="number" name="attr_d_rank_4">
				</div>
			</div>
			
		</section>
	</div>
</div>	<!-- Tab 5 ends. Tab 6 begins. -->
<div class="tab6 tab">
	<div class="tab6-container">	<!-- GM Tools to make it possible to run whole game with one character sheet. -->
		<section class="gm-tools">
			<h3>Title of the Roll</h3>		<!-- Selecting title row of roll template.  -->
			<div class="roll-titles">
				<input type="radio" name="attr_roll_title" class="roll-title" value="1">
				<input type="text" name="attr_roll_title_1">
				<input type="radio" name="attr_roll_title" class="roll-title" value="2">
				<input type="text" name="attr_roll_title_2">
				<input type="radio" name="attr_roll_title" class="roll-title" value="3">
				<input type="text" name="attr_roll_title_3">
				<input type="radio" name="attr_roll_title" class="roll-title" value="4">
				<input type="text" name="attr_roll_title_4">
				<input type="radio" name="attr_roll_title" class="roll-title" value="5">
				<input type="text" name="attr_roll_title_5">
				<input type="radio" name="attr_roll_title" class="roll-title" value="6">
				<input type="text" name="attr_roll_title_6">
				<input type="radio" name="attr_roll_title" class="roll-title" value="7">
				<input type="text" name="attr_roll_title_7">
				<input type="radio" name="attr_roll_title" class="roll-title" value="8">
				<input type="text" name="attr_roll_title_8">
				<input type="radio" name="attr_roll_title" class="roll-title" value="9">
				<input type="text" name="attr_roll_title_9">
				<input type="radio" name="attr_roll_title" class="roll-title" value="10">
				<input type="text" name="attr_roll_title_10">
				<input type="radio" name="attr_roll_title" class="roll-title" value="11">
				<input type="text" name="attr_roll_title_11">
				<input type="radio" name="attr_roll_title" class="roll-title" value="12">
				<input type="text" name="attr_roll_title_12">
			</div>
			<div class="dice-roller">	<!-- Setting up dice mechanis of all NPC rolls -->
				<div class="npc-roll-stats">				
					<h4>Dicepool</h4>
					<h4>TN</h4>
					<h4>Damage SCC</h4>
					<h4>Damage Type</h4>					
					<h4>Stun/Phys</h4>
					<h4>Init Mod</h4>
					<h4>Alterations</h4>
					<h4>IM</h4>
					<input type="number" name="attr_npc_dicepool">
					<select name="attr_npc_tn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8"selected="selected">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>
					<input type="number" name="attr_npc_dmgscc">
					<select name="attr_npc_dmgtype">
						<option value="blunt">Blunt</option>
						<option value="piercing">Piercing</option>
						<option value="cutting">Cutting</option>
						<option value="firearms">Firearms</option>
						<option value="fire">Fire</option>
						<option value="electricity">Electricity</option>
						<option value="energy">Energy</option>
						<option value="acid">Acid</option>
						<option value="magical">Magical</option>
						<option value="psychic">Psychic</option>
						<option value="sonic">Sonic</option>
					</select>
					<select name="attr_npc_dmgstyle">
						<option value="stun">Stun</option>
						<option value="physical">Physical</option>
					</select>
					<input type="number" name="attr_npc_initmod">
					<input type="number" name="attr_npc_alterations">
					<input type="number" name="attr_npc_injurymargin">
				</div>						
				<div class="npc-buttons">
					<button type="roll" name=npc_basic_roll" value="&{template:gotham90} {{title=@{check_title}}} {{subtitle=@{npc_name}}} {{color=green}} {{Successes:=[[@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool}]]}}">Generic</button>
					<button type="roll" name=npc_attack_roll" value="&{template:gotham90} {{title=@{check_title}}} {{subtitle=@{npc_name} is Attacking.}} {{color=red}} {{Successes:=[[@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool}]]}}">Attack</button>
					<button type="roll" name=npc_damage_roll" value="&{template:gotham90} {{title=Damage Roll vs @{npc_tn}}} {{subtitle=@{npc_name} inflicts damage with @{check_title} attack.}} {{color=brown}} {{Damage Type:= @{npc_dmgtype}}} {{@{npc_dmgstyle} Damage: = [[@{npc_damage}d12sd>@{npc_tn}]]}}">Damage</button>
					<button type="roll" name=npc_defense_roll" value="&{template:gotham90} {{title=@{check_title}}} {{subtitle=@{npc_name} is Defending.}} {{color=blue}} {{Successes:=[[@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool}]]}}">Defense</button>
					<button type="roll" name=npc_initiative_roll" value="&{template:gotham90} {{title=Initiative Roll}} {{subtitle=@{npc_name}}} {{color=silver}} {{Resulting AP:= [[ (@{npc_dicepool})d12sd>11 + @{npc_initmod} +8 &{tracker}]]}}">Initiative</button>
					<button type="roll" name=npc_charging_roll" value="&{template:gotham90} {{title=Charging roll vs @{npc_tn}}} {{subtitle=@{npc_name} charges up a Power with @{npc_alterations} alterations.}} {{color=purple}} {{name=@{npc_name}}} {{charging= [[4 * @{mastery1_alterations} - (@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool})]]}}">Charging</button>
					<button type="roll" name=npc_injury_roll" value="&{template:gotham90} {{title=Resist Injury vs @{npc_tn}}} {{subtitle=@{npc_name}}} {{color=white}} {{name=@{npc_name}}} {{injury=[[@{npc_injurymargin} - (@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool})]]}}">Injury</button>					
				</div>
					<input type="hidden" name="attr_check_title">	
					<input type="hidden" name="attr_npc_name">					
					<input type="hidden" name="attr_npc_doublescc">
					<input type="hidden" name="attr_npc_f">
					<input type="hidden" name="attr_npc_damage">
				
			</div>				<!-- List of NPC names to display in roll template. Selected on is highlighted. -->
			<h3>Acting NPC</h3>
			<div class="npc-list">	
				<h4>Pick</h4>
				<div class="npc">
					<h4>Name</h4>
					<h4>Base Dmg</h4>
					<h4>Notes</h4>
				</div>
				<h4 class="col3">Pick</h4>
				<div class="npc col4">
					<h4>Name</h4>
					<h4>Base Dmg</h4>
					<h4>Notes</h4>
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice" value="1">
				<div class="npc">
					<input type="text" name="attr_npc_name_1">
					<input type="number" name="attr_npc_dmg_1">
					<input type="text" name="attr_npc_notes_1">
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice col3" value="2">
				<div class="npc col4">
					<input type="text" name="attr_npc_name_2">
					<input type="number" name="attr_npc_dmg_2">
					<input type="text" name="attr_npc_notes_2">
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice" value="3">
				<div class="npc">
					<input type="text" name="attr_npc_name_3">
					<input type="number" name="attr_npc_dmg_3">
					<input type="text" name="attr_npc_notes_3">
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice col3" value="4">
				<div class="npc col4">
					<input type="text" name="attr_npc_name_4">
					<input type="number" name="attr_npc_dmg_4">
					<input type="text" name="attr_npc_notes_4">
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice" value="5">
				<div class="npc">
					<input type="text" name="attr_npc_name_5">
					<input type="number" name="attr_npc_dmg_5">
					<input type="text" name="attr_npc_notes_5">
				</div>
				<input type="radio" name="attr_npc_choice" class="npc-choice col3" value="6">
				<div class="npc col4">
					<input type="text" name="attr_npc_name_6">
					<input type="number" name="attr_npc_dmg_6">
					<input type="text" name="attr_npc_notes_6">
				</div>
			</div>		<!-- When necessary NPC vs NPC checks can be made with one opposed roll.  -->
			<h3>NPC #2 and Opposed Roll</h3>
			<div class="contested">
				<div class="contested-roll">
					<h4>Title</h4>
					<h4>Dice#</h4>
					<h4>TN #2</h4>
					
					<input class="col1" type="text" name="attr_opposed_title">
					<input type="number" name="attr_contested_dicepool">
					<select name="attr_contested_tn">
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
						<option value="5">5</option>
						<option value="6">6</option>
						<option value="7">7</option>
						<option value="8"selected="selected">8</option>
						<option value="9">9</option>
						<option value="10">10</option>
						<option value="11">11</option>
						<option value="12">12</option>
					</select>	
					<button type="roll" name=npc_opposed_roll" value="&{template:gotham90} {{title=@{check_title} vs @{opposed_title}}} {{subtitle=@{npc_name} against @{npc2_name}}} {{color=black}} {{name=@{npc_name}}} {{name2=@{npc2_name}}} {{opposed1=[[@{npc_dicepool}d12sd>@{npc_doublescc}f<@{npc_f} + @{npc_dicepool}]]}} {{opposed2=[[@{contested_dicepool}d12sd>@{npc2_doublescc}f<@{npc2_f} + @{contested_dicepool}]]}}">Opposed</button>
				</div>
						<input type="hidden" name="attr_npc2_name">
						<input type="hidden" name="attr_npc2_doublescc">
						<input type="hidden" name="attr_npc2_f">
				
				<div class="contested-npc col2">	<!-- List of names NPC #2 in opposed roll template. Chosen one is highlighted.  -->
					<input type="radio" name="attr_contested_name" class="contested-name" value="1">
					<input type="text" name="attr_contested_name_1">
					<input type="radio" name="attr_contested_name" class="contested-name" value="2">
					<input type="text" name="attr_contested_name_2">
					<input type="radio" name="attr_contested_name" class="contested-name" value="3">
					<input type="text" name="attr_contested_name_3">
					<input type="radio" name="attr_contested_name" class="contested-name" value="4">
					<input type="text" name="attr_contested_name_4">
					<input type="radio" name="attr_contested_name" class="contested-name" value="5">
					<input type="text" name="attr_contested_name_5">
					<input type="radio" name="attr_contested_name" class="contested-name" value="6">
					<input type="text" name="attr_contested_name_6">
				</div>	
			</div>
			
					<!-- Simple health trackers for NPCs. -->
		</section>
		<section class="npc-health">
			<h3>NPC Health</h3>
			<div class="npc-roster">
				<div class="npc-group col1">
					<div class="npc-health-info">
						<h4>Name</h4>
						<h4>Damage</h4>
						<h4 class="adjust">+1/+2/Down</h4>
					</div>
					<fieldset class="repeating_npc-health1">
						<div class="npc-health-info">
							<input type="text" name="attr_npc_id">
							<input type="number" name="attr_npc_hit">
							<input type="text" name="attr_npc_thresholds">
						</div>
					</fieldset>
				</div>
				<div class="npc-group col2">
					<div class="npc-health-info">
						<h4>Name</h4>
						<h4>Damage</h4>
						<h4 class="adjust">+1/+2/Down</h4>
					</div>
					<fieldset class="repeating_npc-health2">
						<div class="npc-health-info">
							<input type="text" name="attr_npc_id">
							<input type="number" name="attr_npc_hit">
							<input type="text" name="attr_npc_thresholds">
						</div>
					</fieldset>
				</div>
				<div class="npc-group col3">
					<div class="npc-health-info">
						<h4>Name</h4>
						<h4>Damage</h4>
						<h4 class="adjust">+1/+2/Down</h4>
					</div>
					<fieldset class="repeating_npc-health3">
						<div class="npc-health-info">
							<input type="text" name="attr_npc_id">
							<input type="number" name="attr_npc_hit">
							<input type="text" name="attr_npc_thresholds">
						</div>
					</fieldset>
				</div>	
			</div>
		</section>
		<section class="scenario">
			<h3>Scenario Notes</h3>
			<textarea class="notes" name="attr_scenario_notes">			
		</section>
	</div>
</div>		<!-- Tab 6 ends. Roll template begins. -->
		<rolltemplate class="sheet-rolltemplate-gotham90">
		  <div class="sheet-container sheet-color-{{color}}">
			<div class="sheet-header">
			  {{#title}}<div class="sheet-title">{{title}}<img class="sheet-logo" src="https://i.imgur.com/mWMCqyU.png" alt="player token"> </div>{{/title}}
			  {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
			</div>
			<div class="sheet-content">
			  {{#allprops() title subtitle desc color opposed1 opposed2  charging name name2 injury}}
			  <div class="sheet-key">{{key}}</div>
			  <div class="sheet-value">{{value}}</div>
			  {{/allprops() title subtitle desc color opposed1 opposed2  charging name name2 injury}}
			  {{#rollTotal() opposed1 opposed2}}
			     <div class="sheet-desc"> Result is a tie: {{opposed1}} to {{opposed2}}.</div>
			  {{/rollTotal() opposed1 opposed2}}
			  {{#rollGreater() opposed1 opposed2}}
			    <div class="sheet-desc"> {{name}} wins with {{opposed1}} to {{opposed2}}.</div>	
			  {{/rollGreater() opposed1 opposed2}}
			  {{#rollGreater() opposed2 opposed1}}
			    <div class="sheet-desc"> {{name2}} wins with {{opposed2}} to {{opposed1}}.</div>	
			  {{/rollGreater() opposed2 opposed1}}
			  {{#rollGreater() charging 0}}
				<div class="sheet-desc"> Charging up costs {{name}} {{charging}} Stun.</div>					
			  {{/rollGreater() charging 0}}
			  {{#rollLess() charging 1}}
				<div class="sheet-desc">{{name}} charged up without taking any Stun! {{charging}}</div>
			  {{/rollLess() charging 1}}
			  {{#rollLess() injury 1}}
			    <div class="sheet-desc">Luckily {{name}} avoided injury! {{injury}}</div>
			  {{/rollLess() injury 1}}
			  {{#rollBetween() injury 1 7}}
			    <div class="sheet-desc">Unfortunaly {{name}} suffered an injury. {{injury}}</div>
			  {{/rollBetween() injury 1 7}}
			  {{#rollBetween() injury 8 15}}
			   <div class="sheet-desc">Oh no! {{name}} suffered 2 injuries. {{injury}}</div>
			  {{/rollBetween() injury 8 15}}
			  {{#rollGreater() injury 15}}
			   <div class="sheet-desc">Sheesh! {{name}} suffered 3 injuries and is lucky to be alive. {{injury}}</div>
			  {{/rollGreater() injury 15}}
			  {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}			  
			</div>
		  </div>
		</rolltemplate>
	
</main>
		
		
<script type="text/worker">

const int = score => parseInt(score, 10) || 0;
	
	//Calculating Target Number modifiers for each ability score. 
const stats = ["strength", "agility", "reaction", "endurance", "perception", "charisma", "logic", "intuition", "willpower"];
stats.forEach(stat => {
    on(`change:${stat}`, () => {
        getAttrs([stat], values => {
            const stat_base = int(values[stat]);
            console.log(stat_base + " abi change");
            let tnmodi = "0";
            if (stat_base >= 10) tnmodi = "-3";
            else if (stat_base >= 9) tnmodi = "-2";
            else if (stat_base >= 7) tnmodi = "-1";
            else tnmod = "0";
            
            
            setAttrs({
                [`${stat}_tnmod`]: tnmodi
            });
        });
    });
});	
	//  Buttons to determine which tab is open 
	const buttonlist = ["tab1","tab2","tab3", "tab4", "tab5","tab6"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
			console.log(button);
            setAttrs({
                sheet_tab: button
            });
        });
    });
		// Sets togglevalues that determine whether 0, 1 or 2 superpower packages are displayed
	on(`change:p_select`, function(eventinfo) {
		let next = eventinfo.newValue;
		if (next=="0"){
			setAttrs({
                m1_toggle: 1,
				p1_toggle: 1,
				m2_toggle: 1,
				p2_toggle: 1
            });
		}
		else {
			if(next=="1"){
				setAttrs({
					m1_toggle: 0,
					p1_toggle: 0,
					m2_toggle: 1,
					p2_toggle: 1
				});
			}
			else {
				if(next="2") {
					setAttrs({
						m1_toggle: 0,
						p1_toggle: 0,
						m2_toggle: 0,
						p2_toggle: 0
					});
			 }
			}
		}
	});
			/* Let's player select which identity to display in roll templates: Vigilante name, legal name or 
			   some other assumed identity  */
	on(`change:select_id`, function(eventinfo) {
	let next = eventinfo.newValue;
		getAttrs(['character_name', 'civ_name', 'alias'], function(values) {
			let new_name;
			if(next == "1") {
				new_name = values.character_name;
			}
			else {
				if(next == "2") {
					new_name = values.civ_name;
				}
				else {
					if(next == "3") {
						new_name = values.alias;
					}
				}
			}
			setAttrs({
					name: new_name
			}); 
		});
	});
		// Calculating the size of dicepool for an ability roll.  
	on(`change:abi_pick1 change:abi_pick2 change:abi_dm`, function() {
		getAttrs(['abi_pick1', 'abi_pick2', 'abi_dm'], function(values) {
			let pick1 = values.abi_pick1;
			let pick2 = values.abi_pick2;
			let dm = int(values.abi_dm);
			setaDicepool(pick1, pick2,dm);
		});
	});
function setaDicepool(ability1, ability2, dicemod) {
	getAttrs([`${ability1}`,`${ability2}`], function(v) {
		console.log(v[ability1] + " setaDicepool");
		console.log(v[ability2] + " setaDicepool");
		console.log(int(v[ability1]));
		console.log(int(v[ability2]));
		let dicepool = int(v[ability1]) + int(v[ability2]) + dicemod;
		console.log(dicepool + " dp");
		setAttrs({
					abi_dicepool: dicepool
			}); 
	});
};	

		// Setting thresholds for double success and failure for dice mechanics in ability roll.
	on(`change:abitn`, function(eventinfo) {
		
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					abi_doublescc: doubles,
					abi_f: f
					});	
		
	}); 
		// Setting thresholds for double success and failure for dice mechanics in skill roll.  
	on(`change:repeating_skills:skilltn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					repeating_skills_skilldoublescc: doubles,
					repeating_skills_skillf: f
			});	
		
	}); 
		// Setting thresholds for double success and failure for dice mechanics in charging roll.
	on(`change:mastery1_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					m1_doublescc: doubles,
					m1_f: f
					});	
	});
	on(`change:mastery2_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					m2_doublescc: doubles,
					m2_f: f
					});	
	});
		// Setting thresholds for double success and failure for dice mechanics in superpower roll.
	on(`change:repeating_powers1:power1tn`, function(eventinfo) {
		let tn = int(eventinfo.newValue);
		let doubles = 13;
		doubles = getDoubles(tn);
		let f = tn -1;
		setAttrs({
				repeating_powers1_power1doublescc: doubles,
				repeating_powers1_power1f: f
		});	
	});
	on(`change:repeating_powers2:power2tn`, function(eventinfo) {
		let tn = int(eventinfo.newValue);
		let doubles = 13;
		doubles = getDoubles(tn);
		let f = tn -1;
		setAttrs({
				repeating_powers2_power2doublescc: doubles,
				repeating_powers2_power2f: f
		});	
	});
	
		// Returns corresponding threshold for double success for given target number.
	function getDoubles(raja) {
		if (raja <= 2)
			return(9);
		else if (raja <=4)
			return(10);
		else if (raja <=6)
			return(11);
		else if (raja <=9)
			return(12);
		else return(13);
	
	} 
		//  Calculating the size of dicepool for a skill roll. Also sets the target number 
		//	modifier for a skill.
	on(`change:repeating_skills:skillrank change:repeating_skills:skillpick change:repeating_skills:skilldm`, function() {
		getAttrs(['repeating_skills_skillrank','repeating_skills_skillpick','repeating_skills_skilldm'], function(values) {
			let rank = int(values.repeating_skills_skillrank);
			let dm = int(values.repeating_skills_skilldm);
			let pick = values.repeating_skills_skillpick;
			setsDicepool(pick, rank, dm);
			});
	}); 

function setsDicepool(ability, rank, dicemod) {
	getAttrs([`${ability}`], function(v) {
		console.log(v[ability] + " setDicepool");
		console.log(int(v[ability]));
		let dicepool = int(v[ability]) + rank + dicemod;
		console.log(dicepool + " dp");
		let tnmod = "0";
		if (rank >= 10) tnmod = "-3";
           else if (rank >= 9) tnmod = "-2";
           else if (rank >= 7) tnmod = "-1";
		setAttrs({
					repeating_skills_skilldicepool: dicepool,
					repeating_skills_skilltnmod: tnmod
			}); 
	});
};
		// Calculating the size of dicepool for a charging roll. Also sets the target number
		// modifier for Mastery power of a superpower package.
	on(`change:willpower change:mastery1_rank change:mastery1_dm`, function() {
		getAttrs(['willpower', 'mastery1_rank', 'mastery1_dm'], function(values) {
			let rank = int(values.mastery1_rank);
			let will = int(values.willpower);
			let dm = int(values.mastery1_dm);
			let dicepool = rank + will + dm;
			let tnmod = "0";
				if (rank >= 10) tnmod = "-3";
				else if (rank >= 9) tnmod = "-2";
				else if (rank >= 7) tnmod = "-1";
			setAttrs({
					m1dicepool: dicepool,
					mastery1_tnmod: tnmod
			});
		});
	});
	on(`change:willpower change:mastery2_rank change:mastery2_dm`, function() {
		getAttrs(['willpower', 'mastery2_rank', 'mastery2_dm'], function(values) {
			let rank = int(values.mastery2_rank);
			let will = int(values.willpower);
			let dm = int(values.mastery2_dm);
			let dicepool = rank + will + dm;
			let tnmod = "0";
				if (rank >= 10) tnmod = "-3";
				else if (rank >= 9) tnmod = "-2";
				else if (rank >= 7) tnmod = "-1";
			setAttrs({
					m2dicepool: dicepool,
					mastery2_tnmod: tnmod
			});
		});
	});
	//  Calculating the size of dicepool for a power roll. Also sets the target number 
	//	modifier for a superpower.
	on(`change:repeating_powers1:power1rank change:repeating_powers1:power1pick change:repeating_powers1:power1dm`, function() {
		getAttrs(['repeating_powers1_power1rank','repeating_powers1_power1pick','repeating_powers1_power1dm'], function(values) {
			let rank = int(values.repeating_powers1_power1rank);
			let dm = int(values.repeating_powers1_power1dm);
			let pick = values.repeating_powers1_power1pick;
			setp1Dicepool(pick, rank, dm);
			});
	}); 
function setp1Dicepool(ability, rank, dicemod) {
	getAttrs([`${ability}`], function(v) {
		console.log(v[ability] + " setDicepool");
		console.log(int(v[ability]));
		let dicepool = int(v[ability]) + rank + dicemod;
		console.log(dicepool + " dp");
		let tnmod = "0";
		if (rank >= 10) tnmod = "-3";
           else if (rank >= 9) tnmod = "-2";
           else if (rank >= 7) tnmod = "-1";
		setAttrs({
					repeating_powers1_power1dicepool: dicepool,
					repeating_powers1_power1tnmod: tnmod
		}); 
	});
};
	on(`change:repeating_powers2:power2rank change:repeating_powers2:power2pick change:repeating_powers2:power2dm`, function() {
		getAttrs(['repeating_powers2_power2rank','repeating_powers2_power2pick','repeating_powers2_power2dm'], function(values) {
			let rank = int(values.repeating_powers2_power2rank);
			let dm = int(values.repeating_powers2_power2dm);
			let pick = values.repeating_powers2_power2pick;
			setp2Dicepool(pick, rank, dm);
			});
	}); 
function setp2Dicepool(ability, rank, dicemod) {
	getAttrs([`${ability}`], function(v) {
		console.log(v[ability] + " setDicepool");
		console.log(int(v[ability]));
		let dicepool = int(v[ability]) + rank + dicemod;
		console.log(dicepool + " dp");
		let tnmod = "0";
		if (rank >= 10) tnmod = "-3";
           else if (rank >= 9) tnmod = "-2";
           else if (rank >= 7) tnmod = "-1";
		setAttrs({
					repeating_powers2_power2dicepool: dicepool,
					repeating_powers2_power2tnmod: tnmod
		}); 
	});
};

	// Calculate the hidden values for how many squares should health and stun meters have.
	on(`change:willpower change:endurance change:resilience change:toughness`, function() {
		getAttrs(['willpower', 'endurance', 'resilience', 'toughness'], function(values) {
			let health = int(values.endurance) + int(values.resilience);
			let stun = int(values.willpower) + int(values.toughness);
			if (health < 1) health = 1;
			if (health > 10) health = 10;
			if (stun < 1) stun = 1;
			if (stun > 10) stun = 10;
			
			setAttrs({
						health_squares: health,
						stun_squares: stun
			});
		});
	});
	
	// Set togglevalues to display correct amount of health squares in meter  	
		on(`change:health_squares`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
				 
		setAttrs({
			["h1" + prev]: 0, ["h2" + prev]: 0, ["h3" + prev]: 0, 
			["h4" + prev]: 0, ["h5" + prev]: 0, ["h6" + prev]: 0,
			["h1" + next]: 1, ["h2" + next]: 1, ["h3" + next]: 1, 
			["h4" + next]: 1, ["h5" + next]: 1, ["h6" + next]: 1
		})
	})
	
	// Set togglevalues to display correct amount of stun squares in meter
	on(`change:stun_squares`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
				 
		setAttrs({
			["s1" + prev]: 0, ["s2" + prev]: 0, ["s3" + prev]: 0, 
			["s4" + prev]: 0, ["s5" + prev]: 0,
			["s1" + next]: 1, ["s2" + next]: 1, ["s3" + next]: 1, 
			["s4" + next]: 1, ["s5" + next]: 1 
		})
	}) 
	// Sets dicepool for injury checks.
	on(`change:willpower change:endurance change:injury_dm`, function() {
		getAttrs(['willpower', 'endurance', 'injury_dm'], function(values) {
			let injury_pool = int(values.willpower) + int(values.endurance) + int(values.injury_dm);
			setAttrs({
				injury_dicepool: injury_pool
			});
		});
	});
			// Setting thresholds for double success and failure for dice mechanics in injury check.
	on(`change:injury_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					injury_doublescc: doubles,
					injury_f: f
					});	
	});
	
	// Sets dicepools for attack and damage rolls when a new weapon is selected.	
	on(`change:attack_choice`, function(eventinfo) {
		let next = eventinfo.newValue;
		let new_name = "attack_name_" + next;
		let new_rank = "attack_rank_" + next;
		let new_dmgstat = "damage_stat_" + next;
		let new_bonus = "dmg_bonus_" + next;
		getAttrs([`${new_name}`,`${new_rank}`,`${new_dmgstat}`, `${new_bonus}`,'attack_pick','attack_dm', 'damage_dm'], function(values) {
			let name = values[new_name];
			let rank = int(values[new_rank]);
			let dmg_stat = values[new_dmgstat];
			let dmg_bonus = int(values[new_bonus]);
			let attack_stat = values.attack_pick;
			let attack_dm = int(values.attack_dm);
			let damage_dm = int(values.damage_dm);
			if(dmg_stat == "0") {
				getAttrs([`${attack_stat}`], function(v) {
					let attack_pool = int(v[attack_stat]) + rank + attack_dm;
					let damage_pool = dmg_bonus + damage_dm;
					setAttrs({
						attack_name : name,
						attack_dicepool: attack_pool,
						damage_dicepool: damage_pool
					});
				});
			}
			else {
				getAttrs([`${attack_stat}`,`${dmg_stat}`], function(v) {
					let attack_pool = int(v[attack_stat]) + rank + attack_dm;
					let damage_pool = int(v[dmg_stat]) + dmg_bonus + damage_dm;
					setAttrs({
						attack_name : name,
						attack_dicepool: attack_pool,
						damage_dicepool: damage_pool
					});
				});
			}
		});
	});
	

	
		// Updates attack and damage rolls if weapon row 1 is active and something relevant changed.
	on(`change:attack_name_1 change:attack_rank_1 change:damage_stat_1 change:dmg_bonus_1`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`attack_choice`], function(values) {
			if (values.attack_choice !="1") return;
			if (source == "attack_name_1") {
				setAttrs({
					attack_name : next
				})
			}
			else {
				if(source == "attack_rank_1") {
					setAttackpool(next,prev);
				}
				if(source == "dmg_bonus_1") {
					setDamagepool(next,prev)
				}
				if (source == "damage_stat_1") {
					setDamagestatpool(next, prev)
				} 	
				
			}	
		});
	})
		// Updates attack and damage rolls if weapon row 2 is active and something relevant changed.
	on(`change:attack_name_2 change:attack_rank_2 change:damage_stat_2 change:dmg_bonus_2`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`attack_choice`], function(values) {
			if (values.attack_choice !="2") return;
			if (source == "attack_name_1") {
				setAttrs({
					attack_name : next
				})
			}
			else {
				if(source == "attack_rank_1") {
					setAttackpool(next,prev);
				}
				if(source == "dmg_bonus_1") {
					setDamagepool(next,prev)
				}
				if (source == "damage_stat_1") {
					setDamagestatpool(next, prev)
				} 	
				
			}	
		});
	})
		// Updates attack and damage rolls if weapon row 3 is active and something relevant changed.
	on(`change:attack_name_3 change:attack_rank_3 change:damage_stat_3 change:dmg_bonus_3`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`attack_choice`], function(values) {
			if (values.attack_choice !="1") return;
			if (source == "attack_name_1") {
				setAttrs({
					attack_name : next
				})
			}
			else {
				if(source == "attack_rank_1") {
					setAttackpool(next,prev);
				}
				if(source == "dmg_bonus_1") {
					setDamagepool(next,prev)
				}
				if (source == "damage_stat_1") {
					setDamagestatpool(next, prev)
				} 	
				
			}	
		});
	})
		// Updates attack and damage rolls if weapon row 4 is active and something relevant changed.
	on(`change:attack_name_4 change:attack_rank_4 change:damage_stat_4 change:dmg_bonus_4`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`attack_choice`], function(values) {
			if (values.attack_choice !="1") return;
			if (source == "attack_name_1") {
				setAttrs({
					attack_name : next
				})
			}
			else {
				if(source == "attack_rank_1") {
					setAttackpool(next,prev);
				}
				if(source == "dmg_bonus_1") {
					setDamagepool(next,prev)
				}
				if (source == "damage_stat_1") {
					setDamagestatpool(next, prev)
				} 	
				
			}	
		});
	});
		// Updates attack and damage rolls if weapon row 5 is active and something relevant changed.
	on(`change:attack_name_5 change:attack_rank_5 change:damage_stat_5 change:dmg_bonus_5`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`attack_choice`], function(values) {
			if (values.attack_choice !="1") return;
			if (source == "attack_name_1") {
				setAttrs({
					attack_name : next
				})
			}
			else {
				if(source == "attack_rank_1") {
					setAttackpool(next,prev);
				}
				if(source == "dmg_bonus_1") {
					setDamagepool(next,prev)
				}
				if (source == "damage_stat_1") {
					setDamagestatpool(next, prev)
				} 	
				
			}	
		});
	});
		// Updating dicepool for attack rolls when given +/- additional dice.
	on(`change:attack_dm`, function(eventinfo) {
		let prev = int(eventinfo.previousValue);
		let next = int(eventinfo.newValue);
		setAttackpool(next,prev);
	});
		// Setting up dicepool for attack rolls when associated ability changes.
	on(`change:attack_pick`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		console.log(prev);
		console.log("attack_pick " + next);
		getAttrs([`${prev}`, `${next}`,`attack_dicepool`], function(values) {
			let attack_pool = int(values.attack_dicepool) + int(values[next]) - int(values[prev]);
			console.log("attack_pick " + values[next] + " " + values.attack_dicepool + " " + attack_pool  );
			setAttrs({
				attack_dicepool: attack_pool
			});
		})
	})	
		// Setting up dicepool for damage rolls when general damage modifier changes.
	on(`change:damage_dm`, function(eventinfo) {
		let prev = int(eventinfo.previousValue);
		let next = int(eventinfo.newValue);
		console.log(prev);
		console.log("damage_dm " + next);
		setDamagepool(next, prev);
	}); 
	
	
function setAttackpool(next, prev) {
	getAttrs([`attack_dicepool`], function(v) {
			let attack_pool = int(v.attack_dicepool) - int(prev) + int(next);
			setAttrs({
				attack_dicepool: attack_pool
			});
		});
};
function setDamagepool(next, prev) {
	getAttrs([`damage_dicepool`], function(v) {
			let damage_pool = int(v.damage_dicepool) - int(prev) + int(next);
			console.log("damage_dicepool "+ next +" " + v.damage_dicepool + " " + damage_pool);
			setAttrs({
				damage_dicepool: damage_pool
			});
		});
};
function setDamagestatpool(next,prev) {
	if (next == "0") { 
		getAttrs([`damage_dicepool`,`${prev}`], function(v) {
			let damage_pool = int(v.damage_dicepool) - int(v[prev]);
			setAttrs({
				damage_dicepool: damage_pool
			});
		})
	}
	else {
		if (prev == "0") {
			getAttrs([`damage_dicepool`,`${next}`], function(v) {
			let damage_pool = int(v.damage_dicepool) + int(v[next]);
			setAttrs({
				damage_dicepool: damage_pool
			});
		})
		}
		else {
			getAttrs([`damage_dicepool`,`${next}`,`${prev}`], function(v) {
			let damage_pool = int(v.damage_dicepool) + int(v[next]) - int(v[prev]);			
			setAttrs({
				damage_dicepool: damage_pool
			});
		})
		}
	}
}
		// Setting thresholds for double success and failure for dice mechanics in attack roll.
	on(`change:attack_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					attack_doublescc: doubles,
					attack_f: f
					});	
	});
	// Sets dicepool for defense roll when a new skill is selected.
	on(`change:defense_choice`, function(eventinfo) {	
		let next = eventinfo.newValue;
		let new_name = "d_name_" + next;
		let new_rank = "d_rank_" + next;
		getAttrs([`${new_name}`,`${new_rank}`, `defense_pick`,`defense_dm`], function(values) {
			let name = values[new_name];
			let rank = int(values[new_rank]);
			console.log(rank);
			let defense_stat = values.defense_pick;
			let dicemod = int(values.defense_dm);
			getAttrs([`${defense_stat}`], function(v) {
				let defense_pool = int(v[defense_stat]) + rank + dicemod;
				setAttrs({
					defense_name: name,
					defense_dicepool: defense_pool
				});
			});
		});
	});

		// Updates defense roll if defense skill 1 is active and something changed.
	on(`change:d_name_1 change:d_rank_1`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`defense_choice`], function(values) {
			if (values.defense_choice !="1") return;
			if (source == "d_name_1") {
				setAttrs({
					defense_name : next
				})
			}
			else {
				if(source == "d_rank_1") {
					setDefensepool(next,prev);
				}				
			}	
		});
	})
		// Updates defense roll if defense skill 2 is active and something changed.
	on(`change:d_name_2 change:d_rank_2`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`defense_choice`], function(values) {
			if (values.defense_choice !="2") return;
			if (source == "d_name_2") {
				setAttrs({
					defense_name : next
				})
			}
			else {
				if(source == "d_rank_2") {
					setDefensepool(next,prev);
				}				
			}	
		});
	})
	// Updates defense roll if defense skill 3 is active and something changed.
	on(`change:d_name_3 change:d_rank_3`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`defense_choice`], function(values) {
			if (values.defense_choice !="3") return;
			if (source == "d_name_3") {
				setAttrs({
					defense_name : next
				})
			}
			else {
				if(source == "d_rank_3") {
					setDefensepool(next,prev);
				}				
			}	
		});
	})
	// Updates defense roll if defense skill 4 is active and something changed.
	on(`change:d_name_4 change:d_rank_4`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		let source = eventinfo.sourceAttribute;
		console.log(prev);
		console.log(next);
		console.log(source);
		getAttrs([`defense_choice`], function(values) {
			if (values.defense_choice !="4") return;
			if (source == "d_name_4") {
				setAttrs({
					defense_name : next
				})
			}
			else {
				if(source == "d_rank_4") {
					setDefensepool(next,prev);
				}				
			}	
		});
	})
	// Updating dicepool for defense rolls when given +/- additional dice.
	on(`change:defense_dm`, function(eventinfo) {
		let prev = int(eventinfo.previousValue);
		let next = int(eventinfo.newValue);
		setDefensepool(next,prev);
	});
		// Setting up dicepool for defense rolls when associated ability changes.
	on(`change:defense_pick`, function(eventinfo) {
		let prev = eventinfo.previousValue;
		let next = eventinfo.newValue;
		console.log(prev);
		console.log("defense_pick " + next);
		getAttrs([`${prev}`, `${next}`,`defense_dicepool`], function(values) {
			let defense_pool = int(values.defense_dicepool) + int(values[next]) - int(values[prev]);
			console.log("defense_pick " + values[next] + " " + values.defense_dicepool + " " + defense_pool  );
			setAttrs({
				defense_dicepool: defense_pool
			});
		})
	})	
	
function setDefensepool(next, prev) {
	getAttrs([`defense_dicepool`], function(v) {
			let defense_pool = int(v.defense_dicepool) - int(prev) + int(next);
			setAttrs({
				defense_dicepool: defense_pool
			});
		});
};
		// Setting thresholds for double success and failure for dice mechanics in attack roll.
	on(`change:defense_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					defense_doublescc: doubles,
					defense_f: f
					});	
	});
	on(`change:roll_title`, function(eventinfo) {
		let next = "roll_title_" + eventinfo.newValue;
		console.log(next);
		getAttrs([`${next}`], function(values) {
			let new_title = values[next];
			console.log(new_title);
			setAttrs({
				check_title: new_title
			});
		});
	});
	const titlelist = ["roll_title_1","roll_title_2","roll_title_3", "roll_title_4", "roll_title_5","roll_title_6","roll_title_7", "roll_title_8","roll_title_9","roll_title_10","roll_title_11","roll_title_12"];
    titlelist.forEach(title => {
        on(`change:${title}`, function(eventinfo) {
			let next = eventinfo.newValue;
			getAttrs([`roll_title`], function(v) {
				let active = "roll_title_" + v.roll_title;
				if (active == title) {
					setAttrs({
						check_title: next
					});
				}
			});
		});
	});
	/*
	on(`change:roll_title_1 change:roll_title_2 change:roll_title_3 change:roll_title_4 change:roll_title_5 change:roll_title_6`, function(eventinfo) {
		let source = eventinfo.sourceAttribute;
		let next = eventinfo.newValue;
		getAttrs([`roll_title`], function(v) {
			let active = "roll_title_" + v.roll_title;
			if (source == active) {
				getAttrs([`${source}`], function(v) {
					let new_title = v[source];
					setAttrs({
						check_title: new_title
					});
				});
			}
		});
	}); */
	on(`change:npc_choice`, function(eventinfo) {
		let next_name = "npc_name_" + eventinfo.newValue;
		let next_dmg = "npc_dmg_" + eventinfo.newValue;
		getAttrs([`${next_name}`, `${next_dmg}`, `npc_dmgscc`], function(values) {
			let new_name = values[next_name];
			let basedmg = int(values[next_dmg]);
			let dmgscc = int(values.npc_dmgscc);
			let dicepool = basedmg + dmgscc;
			setAttrs({
				npc_name: new_name,
				npc_damage: dicepool
			});
		});
	});
				
	on(`change:npc_name_1 change:npc_name_2 change:npc_name_3 change:npc_name_4 change:npc_name_5 change:npc_name_6`, function(eventinfo) {
		let source = eventinfo.sourceAttribute;
		let next = eventinfo.newValue;
		console.log(source + " " + next);
		getAttrs([`npc_choice`], function(values) {
			let active = "npc_name_" + values.npc_choice;
			if (source == active) {
				getAttrs([`${source}`], function(v) {
					let new_name = v[source];
					setAttrs({
						npc_name: new_name
					});
				});
			}
		});	
	});
	on(`change:npc_dmgscc`, function(eventinfo) {
		let next = int(eventinfo.newValue);
		let prev = int(eventinfo.previousValue);
		getAttrs([`npc_damage`], function(values) {
			let damagepool = int(values.npc_damage) + next - prev;
			console.log(damagepool + " " + next + " " + prev);
			setAttrs({
						npc_damage: damagepool
					});
		});
	});
	on(`change:npc_dmg_1 change:npc_dmg_2 change:npc_dmg_3 change:npc_dmg_4 change:npc_dmg_5 change:npc_dmg_6`, function(eventinfo) {
		let source = eventinfo.sourceAttribute;
		let next = eventinfo.newValue;
		console.log(source + " " + next);
		getAttrs([`npc_choice`], function(values) {
			let active = "npc_dmg_" + values.npc_choice;
			if (source == active) {
				getAttrs([`${source}`, `npc_dmgscc`], function(v) {
					let damagepool = int(v[source]) + int(v.npc_dmgscc) ;
					setAttrs({
						npc_damage: damagepool
					});
				});
			}
		});	
	});
	on(`change:npc_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					npc_doublescc: doubles,
					npc_f: f
					});	
	});
	on(`change:contested_name`, function(eventinfo) {
		let next = "contested_name_" + eventinfo.newValue;
		console.log(next);
		getAttrs([`${next}`], function(values) {
			let new_name2 = values[next];
			console.log(new_name2);
			setAttrs({
				npc2_name: new_name2
			});
		});
	});
	on(`change:contested_name_1 change:contested_name_2 change:contested_name_3 change:contested_name_4 change:contested_name_5 change:contested_name_6`, function(eventinfo) {
		let source = eventinfo.sourceAttribute;
		let next = eventinfo.newValue;
		console.log(source + " " + next);
		getAttrs([`contested_name`], function(values) {
			let active = "contested_name_" + values.contested_name;
			if (source == active) {
				getAttrs([`${source}`], function(v) {
					let new_name2 = v[source];
					setAttrs({
						npc2_name: new_name2
					});
				});
			}
		});	
	});
	on(`change:contested_tn`, function(eventinfo) {
			let tn = int(eventinfo.newValue);
			let doubles = 13;
			doubles = getDoubles(tn);
			let f = tn -1;
			setAttrs({
					npc2_doublescc: doubles,
					npc2_f: f
					});	
	});
</script>
