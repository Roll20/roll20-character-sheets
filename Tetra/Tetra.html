<script type="text/worker">
on("change:force", function() {
	getAttrs(["force"], function(values) 
	{
		const force = parseInt(values["force"], 10)||0;
		var result = "0";
		
		switch(force)
		{
			case 1:
				result = "d4";
				break;
			case 2:
				result = "d6";
				break;
			case 3:
				result = "d8";
				break;
			case 4:
				result = "d10";
				break;
			case 5:
				result = "d12";
				break;
			case 6:
				result = "d20";
				break;
		}
		
		setAttrs({
			forceD: result
		});
	});
});

on("change:sens", function() {
	getAttrs(["sens"], function(values) 
	{
		const sens = parseInt(values["sens"], 10)||0;
		var result = "0";
		
		switch(sens)
		{
			case 1:
				result = "d4";
				break;
			case 2:
				result = "d6";
				break;
			case 3:
				result = "d8";
				break;
			case 4:
				result = "d10";
				break;
			case 5:
				result = "d12";
				break;
			case 6:
				result = "d20";
				break;
		}
		
		setAttrs({
			sensD: result
		});
	});
});

on("change:intuition", function() {
	getAttrs(["intuition"], function(values) 
	{
		const intuition = parseInt(values["intuition"], 10)||0;
		var result = "0";
		
		switch(intuition)
		{
			case 1:
				result = "d4";
				break;
			case 2:
				result = "d6";
				break;
			case 3:
				result = "d8";
				break;
			case 4:
				result = "d10";
				break;
			case 5:
				result = "d12";
				break;
			case 6:
				result = "d20";
				break;
		}
		
		setAttrs({
			intuitionD: result
		});
	});
});

on("change:esprit", function() {
	getAttrs(["esprit"], function(values) 
	{
		const esprit = parseInt(values["esprit"], 10)||0;
		var result = "0";
		
		switch(esprit)
		{
			case 1:
				result = "d4";
				break;
			case 2:
				result = "d6";
				break;
			case 3:
				result = "d8";
				break;
			case 4:
				result = "d10";
				break;
			case 5:
				result = "d12";
				break;
			case 6:
				result = "d20";
				break;
		}
		
		setAttrs({
			espritD: result
		});
	});
});

on("change:armure change:intuition", function() {
	getAttrs(["armure", "intuition"], function(values) 
	{
		const armure = parseInt(values["armure"], 10)||0;
		const intuition = parseInt(values["intuition"], 10)||0;
		var defense = 0;
		var vitesse = 0;
		
		if(armure == 1)
			defense = 1;
			
		if(armure == 2)
		{
			defense = 2;
			vitesse = intuition-1;
		}
		
		setAttrs({
			malusVitesse: vitesse,
			bonusDefense: defense
		});
	});
});
</script>

<input type="hidden" name="attr_malusVitesse" value="0" />
<input type="hidden" name="attr_bonusDefense" value="0" />

<div class="header">
	<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo.png" class="logo" alt="Logo" />

	<div class="identite">
		<label>
			<span>Nom :</span>
			<input type="text" name="attr_character_name" />
		</label>
		<label>
			<span>Profession :</span>
			<input type="text" name="attr_profession" />
		</label>
	</div>
	
	<label class="blason">
		<input type="hidden" name="attr_blason" value="1" />
		<input type="radio" name="attr_blason" value="1" checked />
		<input type="radio" name="attr_blason" value="2" />
		<input type="radio" name="attr_blason" value="3" />
		<input type="radio" name="attr_blason" value="4" />
		<input type="radio" name="attr_blason" value="5" />
		<input type="radio" name="attr_blason" value="6" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra%20blanc_cadremetal.png" alt="Blason" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra%20archipel%20des%20lunes_cadremetal.png" alt="Blason" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra%20percenuages_cadremetal.png" alt="Blason" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra%20royaume%20de%20tetra_cadremetal.png" alt="Blason" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra%20sombrecoeur_cadremetal.png" alt="Blason" />
		<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/blason_tetra_sablebrulant_cadremetal.png" alt="Blason" />
	</label>
</div>

<div class="options">
	<label>
		<input type="checkbox" name="attr_options" value="1" />
		<span>y</span>
	</label>
	<input type="hidden" name="attr_options" value="0" />
	<div>
		<select name="attr_gm">
			<option value="">Jets publics</option>
			<option value="/w gm">Jets privés</option>
		</select>
	</div>
</div>

<div class="container">
	<div class="cHeader">
		<div class="stats">
			<div>
				<input type="hidden" name="attr_force" value="1" />
				<button type="roll" name="roll_force" value="@{gm} &{template:base} {{name=@{character_name}}} {{subname=Force}} {{resultat=[[1@{forceD}]]}} {{dice=[[@{force}]]}} {{D6=[[1D6]]}} {{D8=[[1D8]]}} {{D10=[[1D10]]}} {{D12=[[1D12]]}} {{D20=[[1D20]]}}"><span>Force</span></button>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_feu.png" />
					<input type="number" name="attr_force" min="1" max="6" value="1" />
				</label>
				<input type="text" name="attr_forceD" value="d4" readonly />
			</div>
			
			<div>
				<input type="hidden" name="attr_sens" value="1" />
				<button type="roll" name="roll_sens" value="@{gm} @{gm} &{template:base} {{name=@{character_name}}} {{subname=Sens}} {{resultat=[[1@{sensD}]]}} {{dice=[[@{sens}]]}} {{D6=[[1D6]]}} {{D8=[[1D8]]}} {{D10=[[1D10]]}} {{D12=[[1D12]]}} {{D20=[[1D20]]}}"><span>Sens</span></button>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_eau.png" />
					<input type="number" name="attr_sens" min="1" max="6" value="1" />
				</label>
				<input type="text" name="attr_sensD" value="d4" readonly />
			</div>
			
			<div>
				<input type="hidden" name="attr_intuition" value="1" />
				<button type="roll" name="roll_intuition" value="@{gm} @{gm} &{template:base} {{name=@{character_name}}} {{subname=Intuition}} {{resultat=[[1@{intuitionD}]]}} {{dice=[[@{intuition}]]}} {{D6=[[1D6]]}} {{D8=[[1D8]]}} {{D10=[[1D10]]}} {{D12=[[1D12]]}} {{D20=[[1D20]]}}"><span>Intuition</span></button>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_terre.png" />
					<input type="number" name="attr_intuition" min="1" max="6" value="1" />
				</label>
				<input type="text" name="attr_intuitionD" value="d4" readonly />
			</div>
			
			<div>
				<input type="hidden" name="attr_esprit" value="1" />
				<button type="roll" name="roll_esprit" value="@{gm} @{gm} &{template:base} {{name=@{character_name}}} {{subname=Esprit}} {{resultat=[[1@{espritD}]]}} {{dice=[[@{esprit}]]}} {{D6=[[1D6]]}} {{D8=[[1D8]]}} {{D10=[[1D10]]}} {{D12=[[1D12]]}} {{D20=[[1D20]]}}"><span>Esprit</span></button>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_air.png" />
					<input type="number" name="attr_esprit" min="1" max="6" value="1" />
				</label>
				<input type="text" name="attr_espritD" value="d4" readonly />
			</div>
		</div>
		
		<div class="dStats">
			<div>
				<span>Santé</span>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_sante.png" />
					<input type="number" name="attr_sante_max" value="@{force}" disabled />
				</label>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_santedepense.png" />
					<input type="number" name="attr_sante" value="1" min="0" />
				</label>
			</div>
			
			<div>
				<span>Défense</span>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_defense.png" />
					<input type="number" name="attr_defense_max" value="@{sens}+@{bonusDefense}" disabled />
				</label>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_armure.png" />
					<input type="number" name="attr_defense" value="1" min="0" />
				</label>
			</div>
			
			<div>
				<button type="roll" name="roll_vitesse" value="@{gm} @{gm} &{template:base} {{name=@{character_name}}} {{subname=Initiative}} {{resultat=[[1@{intuitionD}+@{vitesse} &{tracker}]]}} {{dice=[[@{intuition}]]}} {{D6=[[1D6+@{vitesse}]]}} {{D8=[[1D8+@{vitesse}]]}} {{D10=[[1D10+@{vitesse}]]}} {{D12=[[1D12+@{vitesse}]]}} {{D20=[[1D20+@{vitesse}]]}}" title="Initiative"><span>Vitesse</span></button>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_vitesse.png" />
					<input type="number" name="attr_vitesse" value="@{intuition}-@{malusVitesse}" disabled />
				</label>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_marche.png" />
					<input type="number" name="attr_marche" value="@{vitesse}+3" disabled />
				</label>
			</div>
			
			<div>
				<span>Volonté</span>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_volonte.png" />
					<input type="number" name="attr_volonte_max" value="@{esprit}" disabled />
				</label>
				<label>
					<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/logo_volontedepense.png" />
					<input type="number" name="attr_volonte" value="1" min="0" />
				</label>
			</div>
		</div>
	</div>

	<div class="cTop">
		<div class="equipement">
			<h1>Équipement :</h1>
			<label>
				<input type="checkbox" name="attr_armure" value="1" />
				<span title="Porte une armure légère"></span>
			</label>
			<label>
				<input type="checkbox" name="attr_armure" value="2" />
				<span title="Porte une armure lourde"></span>
			</label>
			<fieldset class="repeating_equipement">
				<div class="autoex autoex24">
					<textarea name="attr_equipement"></textarea>
					<span name="attr_equipement"></span>
				</div>
			</fieldset>
		</div>
		
		<div class="details">
			<label>
				<span>Origine : </span>
				<input type="text" name="attr_origine" />
			</label>
			
			<label>
				<span>Académie : </span>
				<input type="text" name="attr_academie" />
			</label>
			
			<label>
				<span>Don : </span>
				<div class="autoex autoex24">
					<textarea name="attr_don"></textarea>
					<span name="attr_don"></span>
				</div>
			</label>
			
			<label>
				<span>Héritage : </span>
				<div class="autoex autoex24">
					<textarea name="attr_heritage"></textarea>
					<span name="attr_heritage"></span>
				</div>
			</label>
		</div>
	</div>
	
	<div class="cBottom">
		<fieldset class="repeating_pouvoirs">
			<label>
				<input type="hidden" name="attr_papillon" value="1" />
				<input type="radio" name="attr_papillon" value="1" checked />
				<input type="radio" name="attr_papillon" value="2" />
				<input type="radio" name="attr_papillon" value="3" />
				<input type="radio" name="attr_papillon" value="4" />
				<input type="radio" name="attr_papillon" value="5" />
				<input type="radio" name="attr_papillon" value="6" />
				<input type="radio" name="attr_papillon" value="7" />
				<span></span>
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_blanc.png" title="Cliquez pour afficher/changer le papillon" />
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_bleu%20fonce.png" title="Cliquez pour afficher/changer le papillon" />
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_orange.png" title="Cliquez pour afficher/changer le papillon" />
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_rose.png" title="Cliquez pour afficher/changer le papillon" />
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_rouge%20grand.png" title="Cliquez pour afficher/changer le papillon" />
				<img src="https://raw.githubusercontent.com/Zakarik/roll20-character-sheets/Tetra/Tetra/img/papillon_vert.png" title="Cliquez pour afficher/changer le papillon" />
			</label>
			<label>
				<span>Pouvoir</span>
				<input type="text" name="attr_nom" />
			</label>
			<div class="autoex autoex24">
				<textarea name="attr_description"></textarea>
				<span name="attr_description"></span>
			</div>
		</fieldset>
	</div>
</div>

<rolltemplate class="sheet-rolltemplate-base">
	<h1>{{name}}</h1>
	<h2>{{subname}}</h2>
	<div>
		<span>Résultat</span>
		<span>{{resultat}}</span>
	</div>
	{{#rollWasCrit() resultat}}
		{{#rollTotal() dice 1}}
			<div>
				<span>Exploit</span>
				<span class="exploit">{{D6}}</span>
			</div>
			{{#rollWasCrit() D6}}
				<div>
					<span>Exploit</span>
					<span class="exploit">{{D8}}</span>
				</div>
				{{#rollWasCrit() D8}}
					<div>
						<span>Exploit</span>
						<span class="exploit">{{D10}}</span>
					</div>
					{{#rollWasCrit() D10}}
						<div>
							<span>Exploit</span>
							<span class="exploit">{{D12}}</span>
						</div>
						{{#rollWasCrit() D12}}
							<div>
								<span>Exploit</span>
								<span class="exploit">{{D20}}</span>
							</div>
						{{/rollWasCrit() D12}}
					{{/rollWasCrit() D10}}
				{{/rollWasCrit() D8}}
			{{/rollWasCrit() D6}}
		{{/rollTotal() dice 1}}
		{{#rollTotal() dice 2}}
			<div>
				<span>Exploit</span>
				<span class="exploit">{{D8}}</span>
			</div>
			{{#rollWasCrit() D8}}
				<div>
					<span>Exploit</span>
					<span class="exploit">{{D10}}</span>
				</div>
				{{#rollWasCrit() D10}}
					<div>
						<span>Exploit</span>
						<span class="exploit">{{D12}}</span>
					</div>
					{{#rollWasCrit() D12}}
						<div>
							<span>Exploit</span>
							<span class="exploit">{{D20}}</span>
						</div>
					{{/rollWasCrit() D12}}
				{{/rollWasCrit() D10}}
			{{/rollWasCrit() D8}}
		{{/rollTotal() dice 2}}
		{{#rollTotal() dice 3}}
			<div>
				<span>Exploit</span>
				<span class="exploit">{{D10}}</span>
			</div>
			{{#rollWasCrit() D10}}
				<div>
					<span>Exploit</span>
					<span class="exploit">{{D12}}</span>
				</div>
				{{#rollWasCrit() D12}}
					<div>
						<span>Exploit</span>
						<span class="exploit">{{D20}}</span>
					</div>
				{{/rollWasCrit() D12}}
			{{/rollWasCrit() D10}}
		{{/rollTotal() dice 3}}
		{{#rollTotal() dice 4}}
			<div>
				<span>Exploit</span>
				<span class="exploit">{{D12}}</span>
			</div>
			{{#rollWasCrit() D12}}
				<div>
					<span>Exploit</span>
					<span class="exploit">{{D20}}</span>
				</div>
			{{/rollWasCrit() D12}}
		{{/rollTotal() dice 4}}
		{{#rollTotal() dice 5}}
			<div>
				<span>Exploit</span>
				<span class="exploit">{{D20}}</span>
			</div>
		{{/rollTotal() dice 5}}
	{{/rollWasCrit() resultat}}
	{{#rollWasCrit() resultat}}
		<div class="exploit">
			<span>Exploit !</span>
			<span>(Si initiative, pensez à corriger manuellement le turn order)</span>
		</div>
	{{/rollWasCrit() resultat}}
</rolltemplate>