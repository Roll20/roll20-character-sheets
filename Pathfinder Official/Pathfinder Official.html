<!-- === SHEETS === -->
<input type="checkbox" class="npc_toggle" name="attr_npc" value="1" style="display: none;" />
<input type="hidden" name="attr_mancer_confirm_flag" value="0" class="mancer_confirm_flag" />

<div class="statblock"><!-- NPC SHEET -->
    <input type="hidden" class="optional-flag0" name="attr_build-flag-npc" value="0" />
    <div class="optional blk building">
        <div class="buildingtext">
            <span data-18n="building-npc">BUILDING NPC ...</span>
            <img style="width: 270px;" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/logo.png" />
        </div>
    </div>
    <div class="head-info compendium-drop-target bestiary">
        <input type="hidden" name="attr_npcdrop_name" accept="Name" />
        <input type="hidden" name="attr_npcdrop_uniq" accept="uniqueName" />
        <input type="hidden" name="attr_npcdrop_category" accept="Category" />
        <input type="hidden" name="attr_npcdrop_data" accept="data" /> <!-- catch-all the rest -->
        <input checked="checked" class="options-flag" name="attr_options-flag-npc" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
        <input type="hidden" class="npc_expansion" name="attr_npc_expansion" value="0" />
        <div class="blacklabel pnty" style="width: 100%;">  <!-- Display Name and CR -->
            <div style="margin-left:14px;">
                <span class="big" style="margin-right:6px;" name="attr_character_name"></span>
                <input type="hidden" name="attr_npc_fromcompendium" class="fromcompendium" value="" />
                <button class="myrol" type="compendium" name="attr_npc_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
            </div>
            <div class="npc-icons">
                <div class="big">
                    <span data-i18n="cr-u">CR</span>
                    <span name="attr_npc_cr" title="@{npc_cr}"></span>
                    <input type="hidden" class="optional-flag" name="attr_npc_mr" value="" /><div class="optional inl">
                            / <span data-i18n="mr-u">MR</span>
                            <span name="attr_npc_mr" title="@{npc_mr}"></span>
                    </div>
                </div>
                <input type="hidden" name="attr_npc_icon_type" value="" class="npctype" />
                <span class="npctype"></span>
                <input type="hidden" name="attr_npc_icon_terrain" value="" class="npcterrain" />
                <span class="npcterrain"></span>
                <input type="hidden" name="attr_npc_icon_climate" value="" class="npcclimate" />
                <span class="npcclimate"></span>
            </div>
        </div>  <!-- END Display name and CR -->
        <div class="options" style="margin-bottom: 6px;"> <!-- NPC options / base entry -->
            <div class="topspace myrow">
                <span class="lbl" data-i18n="name">Name</span>
                <input type="text" name="attr_character_name" class="underlined" spellcheck="false" title="@{character_name}" />
                <span class="lbl margindent" data-i18n="cr-u">CR</span>
                <input type="text" name="attr_npc_cr" class="underlined small" spellcheck="false" title="@{npc_cr}" />
                <span class="lbl margindent" data-i18n="mr-u">MR</span>
                <input type="text" name="attr_npc_mr" value="" class="underlined small" spellcheck="false" title="@{npc_mr}" />
                <span class="lbl margindent" data-i18n="xp-u">XP</span>
                <input type="text" name="attr_xp" class="underlined medium" title="@{attr_xp}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="race-class-and-level">Race, Class, Level</span>
                <input type="text" name="attr_class" class="underlined type" spellcheck="false" title="@{class}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="alignment">Alignment</span>
                <input type="text" name="attr_npc_alignment" class="underlined small upper" spellcheck="false" title="@{npc_alignment}" />
                <span class="lbl margindent" data-i18n="size">Size</span>
                <select class="size underlined" name="attr_size" title="@{size}">
                    <option value="fine" data-i18n="fine">Fine</option>
                    <option value="diminutive" data-i18n="diminutive">Diminutive</option>
                    <option value="tiny" data-i18n="tiny">Tiny</option>
                    <option value="small" data-i18n="small">Small</option>
                    <option value="medium" data-i18n="medium" selected="selected">Medium</option>
                    <option value="large" data-i18n="large">Large</option>
                    <option value="huge" data-i18n="huge">Huge</option>
                    <option value="gargantuan" data-i18n="gargantuan">Gargantuan</option>
                    <option value="colossal" data-i18n="colossal">Colossal</option>
                </select>
                <span class="lbl margindent" data-i18n="type">Type</span>
                <input type="text" name="attr_npc_type" class="underlined type" title="@{npc_type}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="initiative">Initiative</span>
                <input type="number" name="attr_initiative" class="nospin underlined sml" value="0" title="@{initiative}" />
                <span class="lbl margindent" data-i18n="notes">Notes</span>
                <input type="text" name="attr_initiative_notes" class="underlined senses" spellcheck="false" title="@{initiative_notes}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="senses">Senses</span>
                <input type="text" name="attr_senses" class="underlined senses" spellcheck="false" title="@{senses}" />
                <span class="lbl margindent" data-i18n="perception">Perception</span>
                <input type="number" name="attr_perception" class="nospin underlined sml" value="0" title="@{perception}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="aura">Aura</span>
                <input type="text" name="attr_aura" class="underlined aura" spellcheck="false" title="@{aura}" />
            </div>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="defense">Defense</span> </div>  <!-- input DEFENSE -->
            <div class="myrow">
                <span class="lbl" data-i18n="ac-u">AC</span>
                <input type="number" name="attr_ac" class="nospin underlined sml" value="10" title="@{ac}" />
                <span class="lbl margindent" data-i18n="touch">Touch</span>
                <input type="number" name="attr_ac_touch" class="nospin underlined sml" value="10" title="@{ac_touch}" />
                <span class="lbl margindent" data-i18n="flat-footed">Flat-footed</span>
                <input type="number" name="attr_ac_flatfooted" class="nospin underlined sml" value="10" title="@{ac_flatfooted}" />
                <input type="text" name="attr_ac_notes" class="underlined" title="@{ac_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="hp-u">HP</span>
                <input type="number" name="attr_hp" class="nospin underlined sml" value="0" title="@{hp}" />
                <span class="lbl">/</span>
                <input type="number" name="attr_hp_max" class="nospin underlined sml" value="0" title="@{hp_max}" />
                <input type="text" name="attr_hp_notes" class="underlined" title="@{hp_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl margindent" data-i18n="hp-roll">HP Roll</span>
                <input type="text" name="attr_hd_roll" class="underlined smlmed" spellcheck="false" placeholder="1d6+1" title="@{hd_roll}" />
                <span class="lbl margindent" data-i18n="hd-u">HD</span>
                <input type="text" name="attr_hd" class="underlined smlmed" spellcheck="false" placeholder="1d6" title="@{hd}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="fort">Fort</span>
                <input type="number" name="attr_fortitude" class="nospin underlined sml" value="0" title="@{fortitude}" />
                <span class="lbl margindent" data-i18n="ref">Ref</span>
                <input type="number" name="attr_reflex" class="nospin underlined sml" value="0" title="@{reflex}" />
                <span class="lbl margindent" data-i18n="will">Will</span>
                <input type="number" name="attr_will" class="nospin underlined sml" value="0" title="@{will}" />
                <span class="lbl margindent" data-i18n="modifiers">Modifiers</span>
                <input type="text" name="attr_saves_modifiers" class="underlined" spellcheck="false" title="@{saves_modifiers}" />
                <span class="lbl margindent" data-i18n="sr-u">SR</span>
                <input type="number" name="attr_sr" class="nospin underlined sml" value="0" title="@{sr}" />
            </div>
            <div class="myrow">
                <span class="lbl right w100" data-i18n="defensive-abilities">Defensive Abilities</span>
                <input type="text" name="attr_defensive_abilities" class="underlined" spellcheck="false" title="@{defensive_abilities}" />
                <span class="lbl margindent right w50" data-i18n="dr-u">DR</span>
                <input type="text" name="attr_npc_dr" class="underlined" spellcheck="false" title="@{npc_dr}" />
            </div>
            <div class="myrow">
                <span class="lbl right w100" data-i18n="immune">Immune</span>
                <input type="text" name="attr_immune" class="underlined" spellcheck="false" title="@{immune}" />
                <span class="lbl margindent right w50" data-i18n="resist">Resist</span>
                <input type="text" name="attr_resist" class="underlined" spellcheck="false" title="@{resist}" />
            </div>
            <div class="myrow">
                <span class="lbl right w100" data-i18n="weaknesses">Weaknesses</span>
                <input type="text" name="attr_weaknesses" class="underlined" spellcheck="false" title="@{weaknesses}" />
            </div>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="offense">Offense</span> </div>  <!-- input OFFENSE -->
            <div class="myrow">
                <span class="lbl" data-i18n="speed">Speed</span>
                <input type="text" name="attr_npc_speed" class="underlined" spellcheck="false" title="@{npc_speed}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="space">Space</span>
                <input type="text" name="attr_space" class="underlined" spellcheck="false" title="@{space}" />
                <span class="lbl margindent" data-i18n="reach">Reach</span>
                <input type="text" name="attr_reach" class="underlined" spellcheck="false" title="@{reach}" />
            </div>
            <div class="myrow"> <!-- BABs AND SPECIAL ATTACKS -->
                <input class="pseudocheck" type="checkbox" name="attr_meleeattacks_flag" value="1" title="@{meleeattacks_flag}" checked="checked" /><span></span>
                <span class="lbl" data-i18n="melee">Melee</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_rangedattacks_flag" value="1" title="@{rangedattacks_flag}" checked="checked" /><span></span>
                <span class="lbl" data-i18n="ranged">Ranged</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_specialattacks_flag" value="1" title="@{specialattacks_flag}" checked="checked" /><span></span>
                <span class="lbl" data-i18n="special-attacks">Special Attacks</span>
            </div>
            <div class="myrow">
                <span class="lbl margindent" data-i18n="misc">Misc</span> / <span class="lbl" data-i18n="notes">Notes</span>
                <input type="text" name="attr_specialattacks_notes" class="underlined aura" spellcheck="false" title="@{specialattacks_notes}">
            </div>
            <div class="myrow"> <!-- SPELL-LIKE -->
                <input class="pseudocheck" type="checkbox" name="attr_spellabilities_flag" value="1" title="@{spellabilities_flag}" /><span></span>
                <span class="lbl" data-i18n="spell-like-abilities">Spell-Like Abilities</span>
                <span class="lbl margindent" data-i18n="caster-level">Caster Level</span>
                <input type="number" name="attr_caster2_level" class="nospin underlined sml" value="0" title="@{caster2_level}" />
                <span class="lbl margindent" data-i18n="concentration">Concentration</span>
                <input type="number" name="attr_caster2_concentration" class="nospin underlined sml" value="0" title="@{caster2_concentration}" />
            </div>
            <div class="myrow">
                <span class="lbl margindent" data-i18n="misc">Misc</span> / <span class="lbl" data-i18n="notes">Notes</span>
                <input type="text" name="attr_npc_spellabilities_notes" class="underlined aura" spellcheck="false" title="@{npc_spellabilities_notes}">
            </div>
            <div class="myrow"> <!-- SPELLS -->
                <input class="pseudocheck" type="checkbox" name="attr_spells_flag" value="1" title="@{spells_flag}" /><span></span>
                <span class="lbl" data-i18n="spells">Spells</span>
                <span class="lbl margindent" data-i18n="caster-level">Caster Level</span>
                <input type="number" name="attr_caster1_level" class="nospin underlined sml" value="0" title="@{caster1_level}" />
                <span class="lbl margindent" data-i18n="concentration">Concentration</span>
                <input type="number" name="attr_caster1_concentration" class="nospin underlined sml" value="0" title="@{caster1_concentration}" />
            </div>
            <div class="myrow padindent"> <!-- Spells per day -->
                <span class="lbl" data-i18n="spells-per-day">Spells per day</span>
                <span class="lbl margindent">1</span>
                <input type="number" name="attr_caster1_spells_perday_level_1" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_1}" />
                <span class="lbl margindent">2</span>
                <input type="number" name="attr_caster1_spells_perday_level_2" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_2}" />
                <span class="lbl margindent">3</span>
                <input type="number" name="attr_caster1_spells_perday_level_3" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_3}" />
                <span class="lbl margindent">4</span>
                <input type="number" name="attr_caster1_spells_perday_level_4" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_4}" />
                <span class="lbl margindent">5</span>
                <input type="number" name="attr_caster1_spells_perday_level_5" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_5}" />
                <span class="lbl margindent">6</span>
                <input type="number" name="attr_caster1_spells_perday_level_6" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_6}" />
                <span class="lbl margindent">7</span>
                <input type="number" name="attr_caster1_spells_perday_level_7" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_7}" />
                <span class="lbl margindent">8</span>
                <input type="number" name="attr_caster1_spells_perday_level_8" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_8}" />
                <span class="lbl margindent">9</span>
                <input type="number" name="attr_caster1_spells_perday_level_9" class="nospin underlined sml" value="0" title="@{caster1_spells_perday_level_9}" />
            </div>
            <div class="myrow padindent"> <!-- schools -->
                <span class="lbl" data-i18n="bloodlines-domains-schools:">Bloodlines, Domains, Schools... :</span>
                <input type="text" name="attr_caster1_spells_notes" class="underlined senses" spellcheck="false" title="@{caster1_spells_notes}" />
            </div>
            <div class="myrow">
                <span class="lbl margindent" data-i18n="misc">Misc</span> / <span class="lbl" data-i18n="notes">Notes</span>
                <input type="text" name="attr_npc_spells_notes" class="underlined aura" spellcheck="false" title="@{npc_spells_notes}">
            </div>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="tactics">Tactics</span> </div>  <!-- input TACTICS -->
            <div class="autoex">
                <span name="attr_tactics"></span>
                <textarea name="attr_tactics" spellcheck="false" data-i18n-placeholder="tactics" placeholder="tactics" title="@{tactics}"></textarea>
            </div>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="statistics">Statistics</span> </div>  <!-- input STATISTICS -->
            <div class="myrow">
                <span class="lbl" data-i18n="str-u">STR</span>
                <input type="number" name="attr_strength" class="nospin underlined sml" value="0" title="@{strength}" />
                <span class="lbl margindent" data-i18n="dex-u">DEX</span>
                <input type="number" name="attr_dexterity" class="nospin underlined sml" value="0" title="@{dexterity}" />
                <span class="lbl margindent" data-i18n="con-u">CON</span>
                <input type="number" name="attr_constitution" class="nospin underlined sml" value="0" title="@{constitution}" />
                <span class="lbl margindent" data-i18n="int-u">INT</span>
                <input type="number" name="attr_intelligence" class="nospin underlined sml" value="0" title="@{intelligence}" />
                <span class="lbl margindent" data-i18n="wis-u">WIS</span>
                <input type="number" name="attr_wisdom" class="nospin underlined sml" value="0" title="@{wisdom}" />
                <span class="lbl margindent" data-i18n="cha-u">CHA</span>
                <input type="number" name="attr_charisma" class="nospin underlined sml" value="0" title="@{charisma}" />
            </div>
            <div class="myrow">
                <span class="lbl" data-i18n="base-atk">Base Atk</span>
                <input type="number" name="attr_bab" class="nospin underlined sml" value="0" title="@{bab}" />
                <span class="lbl margindent" data-i18n="cmb-u">CMB</span>
                <input type="number" name="attr_cmb_mod" class="nospin underlined sml" value="0" title="@{cmb_mod}" />
                <input type="text" name="attr_cmb_notes" class="underlined medium" title="@{cmb_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl margindent" data-i18n="cmd-u">CMD</span>
                <input type="number" name="attr_cmd_mod" class="nospin underlined sml" value="0" title="@{cmd_mod}" />
                <input type="text" name="attr_cmd_notes" class="underlined medium" title="@{cmd_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="skills">Skills</span>
                <span class="lbl margindent" data-i18n="racial-modifiers">Racial Modifiers</span>
                <input type="text" name="attr_skills_racial_modifiers" class="underlined senses" spellcheck="false" title="@{skills_racial_modifiers}" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="acrobatics">Acrobatics</span>
                <input type="number" name="attr_acrobatics" class="nospin underlined sml" value="0" title="@{acrobatics}" />
                <input type="text" name="attr_acrobatics_notes" class="underlined medium" title="@{acrobatics_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="appraise">Appraise</span>
                <input type="number" name="attr_appraise" class="nospin underlined sml" value="0" title="@{appraise}" />
                <input type="text" name="attr_appraise_notes" class="underlined medium" title="@{appraise_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="bluff">Bluff</span>
                <input type="number" name="attr_bluff" class="nospin underlined sml" value="0" title="@{bluff}" />
                <input type="text" name="attr_bluff_notes" class="underlined medium" title="@{bluff_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="climb">Climb</span>
                <input type="number" name="attr_climb" class="nospin underlined sml" value="0" title="@{climb}" />
                <input type="text" name="attr_climb_notes" class="underlined medium" title="@{climb_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="craft">Craft</span>
                <input type="number" name="attr_craft" class="nospin underlined sml" value="0" title="@{craft}" />
                <input type="text" name="attr_craft_notes" class="underlined medium" title="@{craft_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="diplomacy">Diplomacy</span>
                <input type="number" name="attr_diplomacy" class="nospin underlined sml" value="0" title="@{diplomacy}" />
                <input type="text" name="attr_diplomacy_notes" class="underlined medium" title="@{diplomacy_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="disable_device">Disable Device*</span>
                <input type="number" name="attr_disable_device" class="nospin underlined sml" value="0" title="@{disable_device}" />
                <input type="text" name="attr_disable_device_notes" class="underlined medium" title="@{disable_device_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="disguise">Disguise</span>
                <input type="number" name="attr_disguise" class="nospin underlined sml" value="0" title="@{disguise}" />
                <input type="text" name="attr_disguise_notes" class="underlined medium" title="@{disguise_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="escape_artist">Escape Artist</span>
                <input type="number" name="attr_escape_artist" class="nospin underlined sml" value="0" title="@{escape_artist}" />
                <input type="text" name="attr_escape_artist_notes" class="underlined medium" title="@{escape_artist_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="fly">Fly</span>
                <input type="number" name="attr_fly" class="nospin underlined sml" value="0" title="@{fly}" />
                <input type="text" name="attr_fly_notes" class="underlined medium" title="@{fly_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="handle_animal">Handle Animal*</span>
                <input type="number" name="attr_handle_animal" class="nospin underlined sml" value="0" title="@{handle_animal}" />
                <input type="text" name="attr_handle_animal_notes" class="underlined medium" title="@{handle_animal_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="heal">Heal</span>
                <input type="number" name="attr_heal" class="nospin underlined sml" value="0" title="@{heal}" />
                <input type="text" name="attr_heal_notes" class="underlined medium" title="@{heal_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="intimidate">Intimidate</span>
                <input type="number" name="attr_intimidate" class="nospin underlined sml" value="0" title="@{intimidate}" />
                <input type="text" name="attr_intimidate_notes" class="underlined medium" title="@{intimidate_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="knowledge_arcana">Knowledge (Arcana)*</span>
                <input type="number" name="attr_knowledge_arcana" class="nospin underlined sml" value="0" title="@{knowledge_arcana}" />
                <input type="text" name="attr_knowledge_arcana_notes" class="underlined medium" title="@{knowledge_arcana_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="k_dungeoneering">K. (Dungeoneering)*</span>
                <input type="number" name="attr_knowledge_dungeoneering" class="nospin underlined sml" value="0" title="@{knowledge_dungeoneering}" />
                <input type="text" name="attr_knowledge_dungeoneering_notes" class="underlined medium" title="@{knowledge_dungeoneering_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="k_engineering">K. (Engineering)*</span>
                <input type="number" name="attr_knowledge_engineering" class="nospin underlined sml" value="0" title="@{knowledge_engineering}" />
                <input type="text" name="attr_knowledge_engineering_notes" class="underlined medium" title="@{knowledge_engineering_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="k_geography">K. (Geography)*</span>
                <input type="number" name="attr_knowledge_geography" class="nospin underlined sml" value="0" title="@{knowledge_geography}" />
                <input type="text" name="attr_knowledge_geography_notes" class="underlined medium" title="@{knowledge_geography_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="k_history">K. (History)*</span>
                <input type="number" name="attr_knowledge_history" class="nospin underlined sml" value="0" title="@{knowledge_history}" />
                <input type="text" name="attr_knowledge_history_notes" class="underlined medium" title="@{knowledge_history_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="k_local">K. (Local)*</span>
                <input type="number" name="attr_knowledge_local" class="nospin underlined sml" value="0" title="@{knowledge_local}" />
                <input type="text" name="attr_knowledge_local_notes" class="underlined medium" title="@{knowledge_local_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="k_nature">K. (Nature)*</span>
                <input type="number" name="attr_knowledge_nature" class="nospin underlined sml" value="0" title="@{knowledge_nature}" />
                <input type="text" name="attr_knowledge_nature_notes" class="underlined medium" title="@{knowledge_nature_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="k_nobility">K. (Nobility)*</span>
                <input type="number" name="attr_knowledge_nobility" class="nospin underlined sml" value="0" title="@{knowledge_nobility}" />
                <input type="text" name="attr_knowledge_nobility_notes" class="underlined medium" title="@{knowledge_nobility_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="k_planes">K. (Planes)*</span>
                <input type="number" name="attr_knowledge_planes" class="nospin underlined sml" value="0" title="@{knowledge_planes}" />
                <input type="text" name="attr_knowledge_planes_notes" class="underlined medium" title="@{knowledge_planes_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="k_religion">K. (Religion)*</span>
                <input type="number" name="attr_knowledge_religion" class="nospin underlined sml" value="0" title="@{knowledge_religion}" />
                <input type="text" name="attr_knowledge_religion_notes" class="underlined medium" title="@{knowledge_religion_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="linguistics">Linguistics*</span>
                <input type="number" name="attr_linguistics" class="nospin underlined sml" value="0" title="@{linguistics}" />
                <input type="text" name="attr_linguistics_notes" class="underlined medium" title="@{linguistics_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="perception">Perception</span>
                <input type="number" name="attr_perception" class="nospin underlined sml" value="0" title="@{perception}" />
                <input type="text" name="attr_perception_notes" class="underlined medium" title="@{perception_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="perform">Perform</span>
                <input type="number" name="attr_perform" class="nospin underlined sml" value="0" title="@{perform}" />
                <input type="text" name="attr_perform_notes" class="underlined medium" title="@{perform_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="profession">Profession*</span>
                <input type="number" name="attr_profession" class="nospin underlined sml" value="0" title="@{profession}" />
                <input type="text" name="attr_profession_notes" class="underlined medium" title="@{profession_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="ride">Ride</span>
                <input type="number" name="attr_ride" class="nospin underlined sml" value="0" title="@{ride}" />
                <input type="text" name="attr_ride_notes" class="underlined medium" title="@{ride_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="sense_motive">Sense Motive</span>
                <input type="number" name="attr_sense_motive" class="nospin underlined sml" value="0" title="@{sense_motive}" />
                <input type="text" name="attr_sense_motive_notes" class="underlined medium" title="@{sense_motive_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="sleight_of_hand">Sleight of Hand*</span>
                <input type="number" name="attr_sleight_of_hand" class="nospin underlined sml" value="0" title="@{sleight_of_hand}" />
                <input type="text" name="attr_sleight_of_hand_notes" class="underlined medium" title="@{sleight_of_hand_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="spellcraft">Spellcraft*</span>
                <input type="number" name="attr_spellcraft" class="nospin underlined sml" value="0" title="@{spellcraft}" />
                <input type="text" name="attr_spellcraft_notes" class="underlined medium" title="@{spellcraft_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="stealth">Stealth</span>
                <input type="number" name="attr_stealth" class="nospin underlined sml" value="0" title="@{stealth}" />
                <input type="text" name="attr_stealth_notes" class="underlined medium" title="@{stealth_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="survival">Survival</span>
                <input type="number" name="attr_survival" class="nospin underlined sml" value="0" title="@{survival}" />
                <input type="text" name="attr_survival_notes" class="underlined medium" title="@{survival_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl skill" data-i18n="swim">Swim</span>
                <input type="number" name="attr_swim" class="nospin underlined sml" value="0" title="@{swim}" />
                <input type="text" name="attr_swim_notes" class="underlined medium" title="@{swim_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
                <span class="lbl skill" data-i18n="use_magic_device">Use Magic Device*</span>
                <input type="number" name="attr_use_magic_device" class="nospin underlined sml" value="0" title="@{use_magic_device}" />
                <input type="text" name="attr_use_magic_device_notes" class="underlined medium" title="@{use_magic_device_notes}" data-i18n-placeholder="notes" placeholder="Notes" />
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="skills-notes">Skills Notes</span>
                <input type="text" name="attr_skills_notes" class="underlined senses" spellcheck="false" title="@{skills_notes}" />
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="languages">Languages</span>
                <input type="text" name="attr_languages" class="underlined aura" spellcheck="false" title="@{languages}" />
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="sq-u" data-i18n-title="special-qualities" title="Special Qualities">SQ</span>
                <input type="text" name="attr_sq" class="underlined aura" spellcheck="false" title="@{sq}" />
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="combat-gear">Combat Gear</span>
                <div class="autoex">
                    <span name="attr_combat_gear"></span>
                    <textarea name="attr_combat_gear" class="underlined" spellcheck="false" data-i18n-placeholder="combat-gear" placeholder="Combat Gear" title="@{combat_gear}"></textarea>
                </div>
            </div>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="ecology">Ecology</span> </div>  <!-- input ECOLOGY -->
            <div class="autoex">
                <span name="attr_environment"></span>
                <textarea name="attr_environment" class="underlined" spellcheck="false" data-i18n-placeholder="environment" placeholder="Environment" title="@{environment}"></textarea>
            </div>
            <span class="lbl" data-i18n="environment">Environment</span>
            <div class="topspace autoex">
                <span name="attr_organization"></span>
                <textarea name="attr_organization" class="underlined" spellcheck="false" data-i18n-placeholder="organization" placeholder="Organization" title="@{organization}"></textarea>
            </div>
            <span class="lbl" data-i18n="organization">Organization</span>
            <div class="topspace autoex">
                <span name="attr_treasure"></span>
                <textarea name="attr_treasure" class="underlined" spellcheck="false" data-i18n-placeholder="treasure" placeholder="Treasure" title="@{treasure}"></textarea>
            </div>
            <span class="lbl" data-i18n="treasure">Treasure</span>
            <div class="topspace autoex">
                <span name="attr_background"></span>
                <textarea name="attr_background" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{background}"></textarea>
            </div>
            <span class="lbl" data-i18n="description">Description</span>
            <div class="topspace myrow bold greybg padindent"> <span data-i18n="tab-configuration">Configuration</span> </div>  <!-- input CONFIGURATION -->
            <div class="myrow">
                <span class="lbl bold" data-i18n="general">General</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_npc" value="1" title="@{npc}" /><span></span><span class="lbl" data-i18n="npc-monster-statblock">NPC/Monster Statblock</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_special_abilities_flag" value="1" title="@{special_abilities_flag}" /><span></span><span class="lbl" data-i18n="show-special-abilities">Show Special Abilities</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_ecology_flag" value="1" title="@{ecology_flag}" checked="checked" /><span></span><span class="lbl" data-i18n="show-ecology">Show Ecology</span>
            </div>
            <div class="myrow">
                <span class="lbl bold" data-i18n="rolls">Rolls</span>
                <span class="spacer"></span>
                <input class="pseudocheck" type="checkbox" name="attr_rollshowchar" value="[[1]]" title="@{rollshowchar}" checked="checked" /><span></span><span class="lbl" data-i18n="show-character-name">Show character name</span>
                <span class="lbl margindent" data-i18n="whisp-rolls-gm:">Whisper Rolls to GM:</span>
                <select name="attr_whispertype" class="underlined" title="@{whispertype}">
                    <option value="" data-i18n="never-whisper-roll" selected="selected">Never Whisper Rolls</option>
                    <option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }" data-i18n="query-whisper-roll">Query Whisper</option>
                    <option value="/w gm " data-i18n="always-whisper-roll">Always Whisper Rolls</option>
                </select>
            </div>
        </div>   <!-- END NPC options / base entry -->
        <div class="npc-display">  <!-- Display HEAD INFO -->
            <div class="myrow bold">
                <span class="bold" data-i18n="xp-u">XP</span>
                <span class="bold" name="attr_xp"></span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_class" value="" /><div class="myrow optional blk"> <span name="attr_class"></span> </div>
            <div class="myrow">
                <span class="upper" name="attr_npc_alignment"></span>
                <span name="attr_size_display"></span>
                <span name="attr_npc_type"></span>
            </div>
            <div class="myrow">
                <button class="myrol" type="roll" name="roll_npc_initiative" data-i18n-title="initiative-roll" title="Initiative roll" value="@{whispertype} &{template:npc} {{name=^{initiative}}} {{type=initiative}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{initiative}[MOD] &{tracker}]]}} {{shownotes=[[1]]}}} {{notes=@{initiative_notes}}}"><span class="bold" data-i18n="init">Init</span>&nbsp;<span name="attr_initiative"></span></button>
                <span name="attr_initiative_notes"></span>;
                <span class="bold" data-i18n="senses">Senses</span>
                <span name="attr_senses"></span>;
                <button class="myrol" type="roll" name="roll_npc_perception" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{perception}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{perception}[MOD]]]}}"><span class="bold" data-i18n="perception">Perception</span>&nbsp;<span name="attr_perception"></span></button>
            </div>
            <input type="hidden" class="optional-flag" name="attr_aura" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="aura">Aura</span>
                <span name="attr_aura"></span>
            </div>
        </div>  <!-- END Display HEAD INFO -->
        <div class="npc-display">  <!-- Display DEFENSE -->
            <div class="myrow">
                <span class="npc-section" data-i18n="defense">Defense</span>
                <span class="bold" data-i18n="ac-u">AC</span>
                <span name="attr_ac"></span>,
                <span data-i18n="touch">Touch</span>
                <span name="attr_ac_touch"></span>,
                <span data-i18n="flat-footed">Flat-footed</span>
                <span name="attr_ac_flatfooted"></span>
                <input type="hidden" class="optional-flag" name="attr_ac_notes" value="" /><span class="optional inl">(<span name="attr_ac_notes"></span>)</span>
            </div>
            <div class="myrow">
                <span class="bold" data-i18n="hp-u">HP</span> <input type="number" name="attr_hp" class="nospin underlined sml" value="0" title="@{hp}" /> / <span name="attr_hp_max" title="@{hp_max}"></span>
                <input type="hidden" class="optional-flag" name="attr_hp_notes" value="" /><span class="optional inl">(<span name="attr_hp_notes"></span>)</span>
                <button class="myrol" type="roll" name="roll_npc_hp" data-i18n-title="roll-hp" title="Roll HP" value="@{whispertype} &{template:npc} {{name=^{hit-points}}} {{type=hp}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[@{hd_roll}]]}}">(<span name="attr_hd_roll"></span>)</button>
                <span class="bold margindent" data-i18n="hit-dice">Hit Dice</span>
                <button class="myrol" type="roll" name="roll_npc_hd" data-i18n-title="roll-hd" title="Roll HD" value="@{whispertype} &{template:npc} {{name=^{hit-dice}}} {{type=hp}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[@{hd}]]}}"><span name="attr_hd"></span></button>
                <span class="bold margindent" data-i18n="sr-u">SR</span>
                <span name="attr_sr"></span>
            </div>
            <div class="myrow">
                <button class="myrol" type="roll" name="roll_npc_fortitude" data-i18n-title="fortitude-roll" title="Fortitude roll" value="@{whispertype} &{template:npc} {{name=^{fortitude}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{fortitude}[MOD]]]}}"><span class="bold" data-i18n="fort">Fort</span>
                    <span name="attr_fortitude"></span>,</button>
                <button class="myrol" type="roll" name="roll_npc_reflex" data-i18n-title="reflex-roll" title="Reflex roll" value="@{whispertype} &{template:npc} {{name=^{reflex}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{reflex}[MOD]]]}}"><span class="bold" data-i18n="ref">Ref</span>
                    <span name="attr_reflex"></span>,</button>
                <button class="myrol" type="roll" name="roll_npc_will" data-i18n-title="will-roll" title="Will roll" value="@{whispertype} &{template:npc} {{name=^{will}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{will}[MOD]]]}}"><span class="bold" data-i18n="will">Will</span>
                    <span name="attr_will"></span></button>
                <input type="hidden" class="optional-flag" name="attr_saves_modifiers" value="" /><span class="optional inl">(<span name="attr_saves_modifiers"></span>)</span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_defensive_abilities" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="defensive-abilities">Defensive Abilities</span>
                <span name="attr_defensive_abilities"></span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_npc_dr" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="dr-u">DR</span>
                <span name="attr_npc_dr"></span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_immune" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="immune">Immune</span>
                <span name="attr_immune"></span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_resist" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="resist">Resist</span>
                <span name="attr_resist"></span>
            </div>
            <input type="hidden" class="optional-flag" name="attr_weaknesses" value="" /><div class="myrow optional blk">
                <span class="bold" data-i18n="weaknesses">Weaknesses</span>
                <span name="attr_weaknesses"></span>
            </div>
        </div>  <!-- END Display DEFENSE -->
    </div>
    <div class="npc-display"> <!-- Display OFFENSE -->
        <span class="npc-section" data-i18n="offense">Offense</span>
        <div class="myrow">
            <span class="bold" data-i18n="speed">Speed</span>
            <span name="attr_npc_speed"></span>
        </div>
        <input type="hidden" class="optional-flag" name="attr_space" value="" /><div class="optional inl">
            <span class="bold" data-i18n="space">Space</span>
            <span name="attr_space"></span>
        </div>
        <input type="hidden" class="optional-flag" name="attr_reach" value="" /><div class="optional inl">
            <span class="bold" data-i18n="reach">Reach</span>
            <span name="attr_reach"></span>
        </div>
        <input type="hidden" class="optional-flag0" name="attr_meleeattacks_flag" value="1" /><div class="optional blk npcatk melee"> <!-- MELEE ATTACKS -->
            <span class="bold" data-i18n="melee">Melee</span>
            <fieldset class="repeating_npcatk-melee">
                <div class="attack">
                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                    <button class="myrol underl" type="roll" name="roll_attack" data-i18n-title="attack-damage-roll" title="Attack & Damage roll" value="@{whispertype} &{template:npc} {{name=@{atkname}}} {{type=attackdamage}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{attack=1}} @{multipleatk} @{descflag}"><span name="attr_atkdisplay"></span></button>
                    <div class="options">
                        <div class="myrow">
                            <span class="lbl" data-i18n="name">Name</span>
                            <input type="text" name="attr_atkname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_npcatk-melee_$id_atkname}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <span class="lbl" data-i18n="attack:">Attack:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkmod" value="0" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod}" />
                            <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkcritrange" value="20" title="@{repeating_npcatk-melee_$id_atkcritrange}" />
                            <span class="spacer"></span>
                            <input class="pseudocheck" type="checkbox" name="attr_multipleatk_flag" value="1" title="@{repeating_npcatk-melee_$id_multipleatk_flag}" /><span></span>
                            <span class="lbl" data-i18="multiple-attacks">Multiple attacks</span>
                            <input type="hidden" name="attr_multipleatk" value="" />
                        </div>
                        <input type="hidden" class="optional-flag0" name="attr_multipleatk_flag" value="0" /><div class="optional blk">
                            <span class="lbl margindent">#2:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod2" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod2}" />
                            <span class="lbl margindent">#3:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod3" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod3}" />
                            <span class="lbl margindent">#4:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod4" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod4}" />
                            <span class="lbl margindent">#5:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod5" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod5}" />
                            <span class="lbl margindent">#6:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod6" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod6}" />
                            <span class="lbl margindent">#7:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod7" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod7}" />
                            <span class="lbl margindent">#8:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod8" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod8}" />
                            <span class="lbl margindent">#9:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod9" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod9}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_dmgflag" value="1" title="@{repeating_npcatk-melee_$id_dmgflag}" checked="checked" /><span></span>
                            <span class="lbl atk" data-i18n="damage:">Damage:</span>
                            <input type="text" name="attr_dmgbase" class="underlined smlmed" spellcheck="false" placeholder="1d6" title="@{repeating_npcatk-melee_$id_dmgbase}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmgtype" class="underlined medium" spellcheck="false" data-i18n-placeholder="slashing" placeholder="Slashing" title="@{repeating_npcatk-melee_$id_dmgtype}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmgcritmulti" value="2" title="@{repeating_npcatk-melee_$id_dmgcritmulti}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_dmg2flag" value="1" title="@{repeating_npcatk-melee_$id_dmg2flag}" /><span></span>
                            <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                            <input type="text" name="attr_dmg2base" class="underlined smlmed" spellcheck="false" placeholder="1d4" title="@{repeating_npcatk-melee_$id_dmg2base}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmg2type" class="underlined medium" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_npcatk-melee_$id_dmg2type}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmg2critmulti" value="1" title="@{repeating_npcatk-melee_$id_dmg2critmulti}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{atkdesc}}}" title="@{repeating_npcatk-melee_$id_descflag}" /><span></span>
                            <span class="lbl atk" data-i18n="description:">Description:</span>
                            <div class="autoex">
                                <span name="attr_atkdesc"></span>
                                <textarea name="attr_atkdesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_npcatk-melee_$id_atkdesc}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div> <!-- END MELEE ATTACKS -->
        <input type="hidden" class="optional-flag0" name="attr_rangedattacks_flag" value="1" /><div class="optional blk npcatk ranged"> <!-- RANGED ATTACKS -->
            <span class="bold" data-i18n="ranged">Ranged</span>
            <fieldset class="repeating_npcatk-ranged">
                <div class="attack">
                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                    <button class="myrol underl" type="roll" name="roll_attack" data-i18n-title="attack-damage-roll" title="Attack & Damage roll" value="@{whispertype} &{template:npc} {{name=@{atkname}}} {{type=attackdamage}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{attack=1}} @{multipleatk} @{descflag} {{range=@{atkrange}}}"><span name="attr_atkdisplay"></span></button>
                    <div class="options">
                        <div class="myrow">
                            <span class="lbl" data-i18n="name">Name</span>
                            <input type="text" name="attr_atkname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_npcatk-ranged_$id_atkname}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <span class="lbl" data-i18n="attack:">Attack:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkmod" value="0" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod}" />
                            <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkcritrange" value="20" title="@{repeating_npcatk-melee_$id_atkcritrange}" />
                            <span class="spacer"></span>
                            <input class="pseudocheck" type="checkbox" name="attr_multipleatk_flag" value="1" title="@{repeating_npcatk-melee_$id_multipleatk_flag}" /><span></span>
                            <span class="lbl" data-i18="multiple-attacks">Multiple attacks</span>
                            <input type="hidden" name="attr_multipleatk" value="" />
                        </div>
                        <input type="hidden" class="optional-flag0" name="attr_multipleatk_flag" value="0" /><div class="optional blk">
                            <span class="lbl margindent">#2:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod2" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod2}" />
                            <span class="lbl margindent">#3:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod3" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod3}" />
                            <span class="lbl margindent">#4:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod4" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod4}" />
                            <span class="lbl margindent">#5:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod5" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod5}" />
                            <span class="lbl margindent">#6:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod6" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod6}" />
                            <span class="lbl margindent">#7:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod7" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod7}" />
                            <span class="lbl margindent">#8:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod8" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod8}" />
                            <span class="lbl margindent">#9:</span>
                            <input type="text" class="underlined sml" name="attr_atkmod9" value="" spellcheck="false" title="@{repeating_npcatk-melee_$id_atkmod9}" />
                        </div>
                        <div class="myrow">
                            <span class="lbl w50 right" data-i18n="range:">Range:</span>
                            <input type="text" name="attr_atkrange" class="underlined medium" spellcheck="false" data-i18n-placeholder="range-place" placeholder="10 feet" title="@{repeating_npcatk-ranged_$id_atkrange}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_dmgflag" value="1" title="@{repeating_npcatk-ranged_$id_dmgflag}" checked="checked" /><span></span>
                            <span class="lbl atk" data-i18n="damage:">Damage:</span>
                            <input type="text" name="attr_dmgbase" class="underlined smlmed" spellcheck="false" placeholder="1d6" title="@{repeating_npcatk-ranged_$id_dmgbase}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmgtype" class="underlined medium" spellcheck="false" data-i18n-placeholder="slashing" placeholder="Slashing" title="@{repeating_npcatk-ranged_$id_dmgtype}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmgcritmulti" value="2" title="@{repeating_npcatk-ranged_$id_dmgcritmulti}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_dmg2flag" value="1" title="@{repeating_npcatk-ranged_$id_dmg2flag}" /><span></span>
                            <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                            <input type="text" name="attr_dmg2base" class="underlined smlmed" spellcheck="false" placeholder="1d4" title="@{repeating_npcatk-ranged_$id_dmg2base}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmg2type" class="underlined medium" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_npcatk-ranged_$id_dmg2type}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmg2critmulti" value="1" title="@{repeating_npcatk-ranged_$id_dmg2critmulti}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{atkdesc}}}" title="@{repeating_npcatk-ranged_$id_descflag}" /><span></span>
                            <span class="lbl atk" data-i18n="description:">Description:</span>
                            <div class="autoex">
                                <span name="attr_atkdesc"></span>
                                <textarea name="attr_atkdesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_npcatk-ranged_$id_atkdesc}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div> <!-- END RANGED ATTACKS -->
        <input type="hidden" class="optional-flag0" name="attr_specialattacks_flag" value="1" /><div class="optional blk npcatk special"> <!-- SPECIAL ATTACKS -->
            <span class="bold" data-i18n="special-attacks">Special Attacks</span>
            <fieldset class="repeating_npcatk-special">
                <div class="attack">
                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                    <button class="myrol underl" type="roll" name="roll_attack" data-i18n-title="attack-damage-roll" title="Attack & Damage roll" value="@{whispertype} &{template:npc} {{name=@{atkname}}} {{type=attackdamage}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} @{rangeflag} @{areaflag} @{effectflag} @{atksaveflag} @{atkflag} @{dmgflag} @{dmg2flag} @{descflag}"><span name="attr_atkname"></span></button>
                    <input type="hidden" class="optional-flag" name="attr_perday_max" value="" /><span class="optional inl">(<input type="number" class="nospin spsml center" name="attr_perday" value="0" data-i18n-title="#-used" title="# used" />/<span name="attr_perday_max" data-i18n-title="max-#-per-day" title="Max # per day"></span>)</span>
                    <div class="options">
                        <div class="myrow">
                            <span class="lbl" data-i18n="name">Name</span>
                            <input type="text" name="attr_atkname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_npcatk-special_$id_atkname}" />
                            <input type="text" class="underlined spsml center margindent" name="attr_perday_max" value="" spellcheck="false" title="@{repeating_npcatk-special_$id_perday_max}" />
                            <span class="lbl" data-i18n="per-day">per day</span>
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_atkflag" value="{{attack=1}}{{roll=[[1d20cs>@{atkcritrange}+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}{{critconfirm=[[1d20cs20+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}" title="@{repeating_npcatk-special_$id_atkflag}" /><span></span>
                            <span class="lbl" data-i18n="attack:">Attack:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkmod" value="0" spellcheck="false" title="@{repeating_npcatk-special_$id_atkmod}" />
                            <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkcritrange" value="20" title="@{repeating_npcatk-special_$id_atkcritrange}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_rangeflag" value="{{range=@{atkrange}}}" title="@{repeating_npcatk-special_$id_rangeflag}" /><span></span>
                            <span class="lbl" data-i18n="range:">Range:</span>
                            <input type="text" name="attr_atkrange" class="underlined medium" spellcheck="false" data-i18n-placeholder="range-place" placeholder="10 feet" title="@{repeating_npcatk-special_$id_atkrange}" />
                            <span class="spacer"></span>
                            <input class="pseudocheck" type="checkbox" name="attr_areaflag" value="{{area=@{atkarea}}}" title="@{repeating_npcatk-special_$id_areaflag}" /><span></span>
                            <span class="lbl" data-i18n="area:">Area:</span>
                            <input type="text" name="attr_atkarea" class="underlined medium" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_npcatk-special_$id_atkarea}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_effectflag" value="{{effect=@{atkeffect}}}" title="@{repeating_npcatk-special_$id_effectflag}" /><span></span>
                            <span class="lbl" data-i18n="effect:">Effect:</span>
                            <input type="text" name="attr_atkeffect" class="underlined senses" spellcheck="false" title="@{repeating_npcatk-special_$id_atkeffect}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_atksaveflag" value="{{save=1}}{{savedc=@{atkdc}}}{{saveeffect=@{atksave}}}" title="@{repeating_npcatk-special_$id_atksaveflag}" /><span></span>
                            <span class="lbl" data-i18n="saving-throw:">Saving Throw:</span>
                            <input type="text" name="attr_atksave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_npcatk-special_$id_atksave}" />
                            <span class="lbl margindent" data-i18n="dc-u">DC</span>
                            <input type="number" class="nospin underlined sml" name="attr_atkdc" value="0" title="@{repeating_npcatk-special_$id_atkdc}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_dmgflag" value="{{damage=1}}{{dmg1flag=1}}{{dmg1=[[@{dmgbase}[MOD]+@{rollmod_damage}[BONUS]]]}}{{dmg1type=@{dmgtype}}}{{dmg1crit=[[(@{dmgbase}[MOD]+@{rollmod_damage}[BONUS])*@{dmgcritmulti}]]}}" title="@{repeating_npcatk-special_$id_dmgflag}" /><span></span>
                            <span class="lbl atk" data-i18n="damage:">Damage:</span>
                            <input type="text" name="attr_dmgbase" class="underlined smlmed" spellcheck="false" placeholder="1d6" title="@{repeating_npcatk-special_$id_dmgbase}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmgtype" class="underlined medium" spellcheck="false" data-i18n-placeholder="slashing" placeholder="Slashing" title="@{repeating_npcatk-special_$id_dmgtype}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmgcritmulti" value="2" title="@{repeating_npcatk-special_$id_dmgcritmulti}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}{{dmg2=[[@{dmg2base}[MOD]+@{rollmod_damage}[BONUS]]]}}{{dmg2type=@{dmg2type}}}{{dmg2crit=[[(@{dmg2base}[MOD]+@{rollmod_damage}[BONUS])*@{dmg2critmulti}]]}}" title="@{repeating_npcatk-special_$id_dmg2flag}" /><span></span>
                            <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                            <input type="text" name="attr_dmg2base" class="underlined smlmed" spellcheck="false" placeholder="1d4" title="@{repeating_npcatk-special_$id_dmg2base}" />
                            <span class="lbl"><span data-i18n="notes">Notes</span>/<span data-i18n="type:">Type:</span></span>
                            <input type="text" name="attr_dmg2type" class="underlined medium" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_npcatk-special_$id_dmg2type}" />
                            <span class="lbl" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span>
                            <input type="number" class="nospin underlined sml" name="attr_dmg2critmulti" value="1" title="@{repeating_npcatk-special_$id_dmg2critmulti}" />
                        </div>
                        <div class="myrow grtopbrd">
                            <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{atkdesc}}}" title="@{repeating_npcatk-special_$id_descflag}" checked="checked" /><span></span>
                            <span class="lbl atk" data-i18n="description:">Description:</span>
                            <div class="autoex">
                                <span name="attr_atkdesc"></span>
                                <textarea name="attr_atkdesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_npcatk-special_$id_atkdesc}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            <input type="hidden" class="optional-flag" name="attr_specialattacks_notes" value="" /><span class="optional inl static" name="attr_specialattacks_notes"></span>
        </div> <!-- END SPECIAL ATTACKS -->
        <input type="hidden" class="optional-flag0" name="attr_spellabilities_flag" value="1" /><div class="optional blk npcatk spelllike"> <!-- SPELL-LIKE ABILITIES -->
            <div class="compendium-drop-target">
                <input type="hidden" name="attr_npcsplike_name" accept="Name" />
                <input type="hidden" name="attr_npcsplike_uniq" accept="uniqueName" />
                <input type="hidden" name="attr_npcsplike_category" accept="Category" />
                <input type="hidden" name="attr_npcsplike_data" accept="data" /> <!-- catch-all the rest -->
                <div class="myrow">
                    <span class="bold" data-i18n="spell-like-abilities">Spell-Like Abilities</span>
                    (<span data-i18n="cl-u">CL</span> <span name="attr_caster2_level"></span>;
                    <button class="myrol" type="roll" name="roll_npc_spelllike_concentration" data-i18n-title="concentration-roll" title="Concentration roll" value="@{whispertype} &{template:npc} {{name=^{concentration}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{caster2_concentration}[MOD]]]}}"><span data-i18n="concentration">Concentration</span> +<span name="attr_caster2_concentration"></span></button>)
                </div>
                <fieldset class="repeating_spell-like"> <!-- REPEATING SPELL-LIKE -->
                    <input type="hidden" name="attr_spelllevel" value="like" />
                    <input type="hidden" name="attr_spellcaster" value="2" />
                    <div class="spell right">
                        <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                        <div class="myrow">
                            <input type="hidden" name="attr_rollcontent" />
                            <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span></button><input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">&nbsp;(<input type="number" class="nospin spsml center" name="attr_perday" value="0" data-i18n-title="#-used" title="# used" />/<span name="attr_perday_max" data-i18n-title="max-#-per-day" title="Max # per day"></span>)</span>,
                        </div>
                        <div class="options">
                            <div class="myrow">
                                <span class="lbl" data-i18n="name">Name</span>
                                <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-like_$id_spellname}" />
                                <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                <button class="myrol" type="compendium" name="attr_fromcompendium"  data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                <span class="spacer"></span>
                                <select name="attr_timesperday">
                                    <option value="constant" data-18n="constant">constant</option>
                                    <option value="at-will" data-18n="at-will" checked="checked">at will</option>
                                    <option value="per-hour" data-18n="per-hour">per hour</option>
                                    <option value="per-day" data-18n="per-day">per day</option>
                                    <option value="per-week" data-18n="per-week">per week</option>
                                    <option value="per-month" data-18n="per-month">per month</option>
                                    <option value="per-year" data-18n="per-year">per year</option>
                                    <option value="every-hours" data-18n="every-hours">every X hours</option>
                                </select>
                                <input type="number" class="nospin underlined spsml" name="attr_perday_max" value="1" title="@{repeating_spell-like_$id_perday_max}" />
                            </div>
                            <div class="myrow grtopbrd">
                                <span class="lbl std right" data-i18n="school:">School:</span>
                                <div class="autoex std">
                                    <span name="attr_spellschool"></span>
                                    <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-like_$id_spellschool}"></textarea>
                                </div>
                                <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                <div class="autoex std">
                                    <span name="attr_spellclasslevel"></span>
                                    <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-like_$id_spellclasslevel}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-like_$id_spellcastingtime}" />
                            </div>
                            <div class="myrow grtopbrd">
                                <span class="lbl std right" data-i18n="range:">Range:</span>
                                <div class="autoex std">
                                    <span name="attr_spellrange"></span>
                                    <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-like_$id_spellrange}"></textarea>
                                </div>
                                <span class="lbl std right" data-i18n="area:">Area:</span>
                                <div class="autoex std">
                                    <span name="attr_spellarea"></span>
                                    <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-like_$id_spellarea}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                <div class="autoex std">
                                    <span name="attr_spelltargets"></span>
                                    <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-like_$id_spelltargets}"></textarea>
                                </div>
                            </div>
                            <div class="myrow grtopbrd">
                                <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                <div class="autoex std">
                                    <span name="attr_spelleffect"></span>
                                    <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-like_$id_spelleffect}"></textarea>
                                </div>
                                <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                <div class="autoex std">
                                    <span name="attr_spellduration"></span>
                                    <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-like_$id_spellduration}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-like_$id_spellsaveflag}" /><span></span>
                                <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-like_$id_spellsave}" />
                                <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                <input type="hidden" name="attr_spelldc" value="0" />
                                <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-like_$id_spelldc}" />
                            </div>
                            <div class="myrow">
                                <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-like_$id_spellresistanceflag}" /><span></span>
                                <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-like_$id_spellresistance}" />
                            </div>
                            <div class="myrow grtopbrd">
                                <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-like_$id_spellatkflag}" /><span></span>
                                <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                <input type="hidden" name="attr_spellatktype" value="0" />
                                <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-like_$id_spellatkmod}" />
                                <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-like_$id_spellatkcritrange}" />
                                <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-like_$id_spelldmgcritmulti}" />
                            </div>
                            <div class="myrow grtopbrd">
                                <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-like_$id_spelldmgflag}" /><span></span>
                                <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-like_$id_spelldmg}" />
                                <span class="lbl right typ" data-i18n="type:">Type:</span>
                                <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-like_$id_spelldmgtype}" />
                                <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-like_$id_spelldmg2flag}" /><span></span>
                                <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-like_$id_spelldmg2}" />
                                <span class="lbl right typ" data-i18n="type:">Type:</span>
                                <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-like_$id_spelldmg2type}" />
                            </div>
                            <div class="myrow grtopbrd">
                                <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-like_$id_spelldescflag}" /><span></span>
                                <span class="lbl atk" data-i18n="description:">Description:</span>
                                <div class="autoex">
                                    <span name="attr_spelldesc"></span>
                                    <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-like_$id_spelldesc}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset> <!-- END REPEATING SPELL-LIKE -->
            </div>
            <input type="hidden" class="optional-flag" name="attr_npc_spellabilities_notes" value="" /><span class="optional inl static" name="attr_npc_spellabilities_notes"></span>
        </div> <!-- END SPELL-LIKE ABILITIES -->
        <input type="hidden" class="optional-flag0" name="attr_spells_flag" value="1" /><div class="optional blk npcatk spells"> <!-- SPELLS -->
            <div class="myrow">
                <span class="bold" data-i18n="spells-prepared">Spells Prepared</span>
                (<span data-i18n="cl-u">CL</span> <span name="attr_caster1_level"></span>; <button class="myrol" type="roll" name="roll_npc_spell_concentration" data-i18n-title="concentration-roll" title="Concentration roll" value="@{whispertype} &{template:npc} {{name=^{concentration}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{caster1_concentration}[MOD]]]}}"><span data-i18n="concentration">Concentration</span> +<span name="attr_caster1_concentration"></span></button>)
                <span class="blk" name="attr_caster1_spells_notes"></span>
            </div>
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_9" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 9 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl9_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl9_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl9_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl9_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="9th">9th</span> (<span name="attr_caster1_spells_prepared_level_9"></span>/<span name="attr_caster1_spells_total_level_9"></span>)</span>
                    <fieldset class="repeating_spell-9"> <!-- REPEATING 9 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="9" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-9_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-9_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-9_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-9_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-9_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-9_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-9_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-9_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-9_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-9_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-9_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-9_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-9_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-9_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-9_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-9_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-9_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-9_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-9_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-9_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-9_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-9_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-9_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-9_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-9_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-9_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-9_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 9 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 9 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_8" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 8 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl8_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl8_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl8_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl8_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="8th">8th</span> (<span name="attr_caster1_spells_prepared_level_8"></span>/<span name="attr_caster1_spells_total_level_8"></span>)</span>
                    <fieldset class="repeating_spell-8"> <!-- REPEATING 8 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="8" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-8_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-8_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-8_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-8_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-8_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-8_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-8_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-8_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-8_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-8_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-8_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-8_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-8_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-8_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-8_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-8_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-8_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-8_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-8_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-8_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-8_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-8_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-8_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-8_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-8_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow  grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-8_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-8_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 8 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 8 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_7" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 7 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl7_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl7_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl7_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl7_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="7th">7th</span> (<span name="attr_caster1_spells_prepared_level_7"></span>/<span name="attr_caster1_spells_total_level_7"></span>)</span>
                    <fieldset class="repeating_spell-7"> <!-- REPEATING 7 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="7" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-7_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-7_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-7_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-7_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-7_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-7_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-7_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-7_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-7_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-7_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-7_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-7_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-7_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-7_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-7_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-7_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-7_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-7_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-7_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-7_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-7_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-7_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-7_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-7_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-7_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-7_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-7_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 7 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 7 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_6" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 6 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl6_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl6_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl6_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl6_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="6th">6th</span> (<span name="attr_caster1_spells_prepared_level_6"></span>/<span name="attr_caster1_spells_total_level_6"></span>)</span>
                    <fieldset class="repeating_spell-6"> <!-- REPEATING 6 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="6" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-6_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-6_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-6_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-6_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-6_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-6_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-6_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-6_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-6_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-6_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-6_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-6_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-6_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-6_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-6_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-6_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-6_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-6_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-6_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-6_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-6_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-6_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-6_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-6_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-6_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-6_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-6_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 6 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 6 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_5" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 5 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl5_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl5_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl5_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl5_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="5th">5th</span> (<span name="attr_caster1_spells_prepared_level_5"></span>/<span name="attr_caster1_spells_total_level_5"></span>)</span>
                    <fieldset class="repeating_spell-5"> <!-- REPEATING 5 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="5" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-5_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-5_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-5_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-5_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-5_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-5_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-5_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-5_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-5_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-5_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-5_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-5_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-5_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-5_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-5_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-5_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-5_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-5_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-5_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-5_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d5" title="@{repeating_spell-5_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-5_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-5_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-5_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-5_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-5_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-5_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 5 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 5 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_4" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 4 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl4_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl4_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl4_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl4_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="4th">4th</span> (<span name="attr_caster1_spells_prepared_level_4"></span>/<span name="attr_caster1_spells_total_level_4"></span>)</span>
                    <fieldset class="repeating_spell-4"> <!-- REPEATING 4 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="4" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-4_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-4_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-4_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-4_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-4_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-4_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-4_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-4_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-4_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-4_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-4_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-4_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-4_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-4_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-4_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-4_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-4_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-4_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-4_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-4_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-4_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-4_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-4_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-4_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-4_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-4_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-4_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 4 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 4 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_3" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 3 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl3_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl3_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl3_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl3_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="3rd">3rd</span> (<span name="attr_caster1_spells_prepared_level_3"></span>/<span name="attr_caster1_spells_total_level_3"></span>)</span>
                    <fieldset class="repeating_spell-3"> <!-- REPEATING 3 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="3" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-3_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-3_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-3_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-3_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-3_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-3_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-3_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-3_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-3_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-3_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-3_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-3_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-3_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-3_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-3_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-3_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-3_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-3_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-3_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-3_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-3_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-3_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-3_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-3_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-3_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-3_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-3_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 3 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 3 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_2" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 2 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl2_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl2_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl2_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl2_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="2nd">2nd</span> (<span name="attr_caster1_spells_prepared_level_2"></span>/<span name="attr_caster1_spells_total_level_2"></span>)</span>
                    <fieldset class="repeating_spell-2"> <!-- REPEATING 2 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="2" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-2_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-2_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-2_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-2_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-2_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-2_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-2_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-2_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-2_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-2_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-2_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-2_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-2_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-2_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-2_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-2_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-2_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-2_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-2_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-2_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-2_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-2_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-2_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-2_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-2_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-2_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-2_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 2 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 2 -->
            <input type="hidden" class="optional-flag0" name="attr_caster1_spells_perday_level_1" value="0" /><div class="optional blk grtopbrd"> <!-- Spells lvl 1 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl1_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl1_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl1_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl1_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep"><span data-i18n="1st">1st</span> (<span name="attr_caster1_spells_prepared_level_1"></span>/<span name="attr_caster1_spells_total_level_1"></span>)</span>
                    <fieldset class="repeating_spell-1"> <!-- REPEATING 1 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="1" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span>
                                    <input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">(<span name="attr_spellprepared"></span>)</span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-1_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    <div class="dots margindent">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-1_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-1_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-1_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-1_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-1_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-1_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-1_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-1_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-1_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-1_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-1_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-1_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-1_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-1_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-1_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-1_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-1_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-1_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-1_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-1_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-1_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-1_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-1_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-1_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-1_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-1_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 1 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 1 -->
            <div class="myrow grtopbrd"> <!-- Spells lvl 0 -->
                <div class="compendium-drop-target">
                    <input type="hidden" name="attr_npcspl0_name" accept="Name" />
                    <input type="hidden" name="attr_npcspl0_uniq" accept="uniqueName" />
                    <input type="hidden" name="attr_npcspl0_category" accept="Category" />
                    <input type="hidden" name="attr_npcspl0_data" accept="data" /> <!-- catch-all the rest -->
                    <span class="greybg prep">0 (<span data-i18n="at-will">at will</span>)</span>
                    <fieldset class="repeating_spell-0"> <!-- REPEATING 0 LVL SPELL -->
                        <input type="hidden" name="attr_spelllevel" value="0" />
                        <input type="hidden" name="attr_spellcaster" value="1" />
                        <div class="spell right">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                            <div class="myrow">
                                <input type="hidden" name="attr_rollcontent" />
                                <button class="myrol underl" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span name="attr_spelldisplay"></span></button>
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span class="lbl" data-i18n="name">Name</span>
                                    <input type="text" name="attr_spellname" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-0_$id_spellname}" />
                                    <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                    <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="school:">School:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellschool"></span>
                                        <textarea name="attr_spellschool" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-0_$id_spellschool}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellclasslevel"></span>
                                        <textarea name="attr_spellclasslevel" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-0_$id_spellclasslevel}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                    <input type="text" name="attr_spellcastingtime" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-0_$id_spellcastingtime}" />
                                    <span class="lbl std right" data-i18n="components:">Components:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellcomponent"></span>
                                        <textarea name="attr_spellcomponent" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-0_$id_spellcomponent}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="range:">Range:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellrange"></span>
                                        <textarea name="attr_spellrange" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-0_$id_spellrange}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="area:">Area:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellarea"></span>
                                        <textarea name="attr_spellarea" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-0_$id_spellarea}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelltargets"></span>
                                        <textarea name="attr_spelltargets" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-0_$id_spelltargets}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow grtopbrd">
                                    <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                    <div class="autoex std">
                                        <span name="attr_spelleffect"></span>
                                        <textarea name="attr_spelleffect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d5+@{caster1_level}]] HP" title="@{repeating_spell-0_$id_spelleffect}"></textarea>
                                    </div>
                                    <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                    <div class="autoex std">
                                        <span name="attr_spellduration"></span>
                                        <textarea name="attr_spellduration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-0_$id_spellduration}"></textarea>
                                    </div>
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-0_$id_spellsaveflag}" /><span></span>
                                    <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                    <input type="hidden" name="attr_spellsave_fromcompendium" value="" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-0_$id_spellsave}" />
                                    <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                    <input type="hidden" name="attr_spelldc_mod" value="0" />
                                    <input type="number" class="nospin underlined sml" name="attr_spelldc" value="0" title="@{repeating_spell-0_$id_spelldc}" />
                                </div>
                                <div class="myrow">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-0_$id_spellresistanceflag}" /><span></span>
                                    <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                    <input type="hidden" name="attr_spellresistance_fromcompendium" value="" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-0_$id_spellresistance}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-0_$id_spellatkflag}" /><span></span>
                                    <input type="hidden" name="attr_spellatk_fromcompendium" value="" />
                                    <span class="lbl atk" data-i18n="attack:">Attack:</span>
                                    <input type="hidden" name="attr_spellatktype" value="0" />
                                    <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-0_$id_spellatkmod}" />
                                    <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                    <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-0_$id_spellatkcritrange}" />
                                    <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                    <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-0_$id_spelldmgcritmulti}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-0_$id_spelldmgflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                    <input type="hidden" name="attr_spelldmg_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-0_$id_spelldmg}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmgtype" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-0_$id_spelldmgtype}" />
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-0_$id_spelldmg2flag}" /><span></span>
                                    <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                    <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" />
                                    <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-0_$id_spelldmg2}" />
                                    <span class="lbl right typ" data-i18n="type:">Type:</span>
                                    <input type="text" name="attr_spelldmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-0_$id_spelldmg2type}" />
                                </div>
                                <div class="myrow grtopbrd">
                                    <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-0_$id_spelldescflag}" /><span></span>
                                    <span class="lbl atk" data-i18n="description:">Description:</span>
                                    <div class="autoex">
                                        <span name="attr_spelldesc"></span>
                                        <textarea name="attr_spelldesc" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-0_$id_spelldesc}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset> <!-- END REPEATING 0 LVL SPELL -->
                </div>
            </div><!-- END Spells lvl 0 -->
            <input type="hidden" class="optional-flag" name="attr_npc_spells_notes" value="" /><span class="optional inl static" name="attr_npc_spells_notes"></span>
        </div> <!-- END SPELLS -->
    </div> <!-- END Display OFFENSE -->
    <input type="hidden" class="optional-flag" name="attr_tactics" value="" /><div class="npc-display optional blk"> <!-- Display TACTICS -->
        <span class="npc-section" data-i18n="tactics">Tactics</span>
        <span name="attr_tactics"></span>
    </div>
    <div class="npc-display"> <!-- Display STATISTICS -->
        <span class="npc-section" data-i18n="statistics">Statistics</span>
        <div class="myrow">
            <button class="myrol" type="roll" name="roll_npc_str" data-i18n-title="strength-roll" title="Strength roll" value="@{whispertype} &{template:npc} {{name=^{strength}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{strength_mod}[MOD]]]}}"><span class="bold" data-i18n="str-u">STR</span>
            <span name="attr_strength"></span> (<span name="attr_strength_mod"></span>)</button>,
            <button class="myrol" type="roll" name="roll_npc_dex" data-i18n-title="dexterity-roll" title="Dexterity roll" value="@{whispertype} &{template:npc} {{name=^{dexterity}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{dexterity_mod}[MOD]]]}}"><span class="bold" data-i18n="dex-u">DEX</span>
            <span name="attr_dexterity"></span> (<span name="attr_dexterity_mod"></span>)</button>,
            <button class="myrol" type="roll" name="roll_npc_con" data-i18n-title="constitution-roll" title="Constitution roll" value="@{whispertype} &{template:npc} {{name=^{constitution}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{constitution_mod}[MOD]]]}}"><span class="bold" data-i18n="con-u">CON</span>
            <span name="attr_constitution"></span> (<span name="attr_constitution_mod"></span>)</button>,
            <button class="myrol" type="roll" name="roll_npc_int" data-i18n-title="intelligence-roll" title="Intelligence roll" value="@{whispertype} &{template:npc} {{name=^{intelligence}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{intelligence_mod}[MOD]]]}}"><span class="bold" data-i18n="int-u">INT</span>
            <span name="attr_intelligence"></span> (<span name="attr_intelligence_mod"></span>)</button>,
            <button class="myrol" type="roll" name="roll_npc_wis" data-i18n-title="wisdom-roll" title="wisdom roll" value="@{whispertype} &{template:npc} {{name=^{wisdom}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{wisdom_mod}[MOD]]]}}"><span class="bold" data-i18n="wis-u">WIS</span>
            <span name="attr_wisdom"></span> (<span name="attr_wisdom_mod"></span>)</button>,
            <button class="myrol" type="roll" name="roll_npc_cha" data-i18n-title="charisma-roll" title="charisma roll" value="@{whispertype} &{template:npc} {{name=^{charisma}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{charisma_mod}[MOD]]]}}"><span class="bold" data-i18n="cha-u">CHA</span>
            <span name="attr_charisma"></span> (<span name="attr_charisma_mod"></span>)</button>
        </div>
        <div class="myrow">
            <span class="bold" data-i18n="base-atk">Base Atk</span> <span name="attr_bab"></span> ;
            <button class="myrol" type="roll" name="roll_npc_cmb" value="@{whispertype} &{template:npc} {{name=^{combat-maneuver}}} {{type=attack}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20cs20+@{cmb_mod}[MOD]]]}}"><span class="bold" data-i18n="cmb-u" data-i18n-title="combat-maneuver-bonus" title="Combat Maneuver Bonus">CMB</span> <span name="attr_cmb_mod"></span></button>
            <input type="hidden" class="optional-flag" name="attr_cmb_notes" value="" /><span class="optional inl">(<span name="attr_cmb_notes"></span>)</span>
            ; <span class="bold" data-i18n="cmd-u">CMD</span> <span name="attr_cmd_mod"></span>
            <input type="hidden" class="optional-flag" name="attr_cmd_notes" value="" /><span class="optional inl">(<span name="attr_cmd_notes"></span>)</span>
        </div>
        <div class="myrow npcatk feats"> <!-- Feats -->
            <div class="compendium-drop-target">
                <input type="hidden" name="attr_npcfeat_name" accept="Name" />
                <input type="hidden" name="attr_npcfeat_uniq" accept="uniqueName" />
                <input type="hidden" name="attr_npcfeat_category" accept="Category" />
                <input type="hidden" name="attr_npcfeat_data" accept="data" /> <!-- catch-all the rest -->
                <span class="bold" data-i18n="feats">Feats</span>
                <fieldset class="repeating_feats">
                    <div class="feat">
                        <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                        <button class="myrol underl" type="roll" name="roll_feat" data-i18n-title="show-feat" title="Show Feat" value="@{whispertype} &{template:npc} {{name=@{name}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{feattype=^{@{type}}}} {{prerequisites=@{prerequisites}}} {{benefits=@{benefits}}} {{normal=@{normal}}} {{special=@{special}}} @{descflag}"><span name="attr_name"></span></button>
                        <div class="options">
                            <div class="myrow">
                                <span class="lbl" data-i18n="name">Name</span>
                                <input type="text" name="attr_name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_feats_$id_name}" />
                                <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                                <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                <span class="lbl margindent" data-i18n="type">Type</span>
                                <input type="hidden" name="attr_type_fromcompendium" value="" />
                                <select class="underlined" name="attr_type" title="@{repeating_feats_$id_type}">
                                    <option value="general" data-i18n="general" selected="selected">General</option>
                                    <option value="combat" data-i18n="combat">Combat</option>
                                    <option value="critical" data-i18n="critical">Critical</option>
                                    <option value="grit" data-i18n="grit">Grit</option>
                                    <option value="item creation" data-i18n="item creation">Item creation</option>
                                    <option value="metamagic" data-i18n="metamagic">Metamagic</option>
                                    <option value="monster" data-i18n="monster">Monster</option>
                                    <option value="panache" data-i18n="panache">Panache</option>
                                    <option value="performance" data-i18n="performance">Performance</option>
                                    <option value="style" data-i18n="style">Style</option>
                                    <option value="teamwork" data-i18n="teamwork">Teamwork</option>
                                    <option value="misc" data-i18n="misc">Misc</option>
                                </select>
                            </div>
                            <div class="myrow grtopbrd">
                                <span class="lbl std right" data-i18n="prerequisites:">Prerequisites:</span>
                                <div class="autoex std">
                                    <span name="attr_prerequisites"></span>
                                    <textarea name="attr_prerequisites" class="underlined" spellcheck="false" title="@{repeating_feats_$id_prerequisites}"></textarea>
                                </div>
                                <span class="lbl std right" data-i18n="benefits:">Benefits:</span>
                                <div class="autoex std">
                                    <span name="attr_benefits"></span>
                                    <textarea name="attr_benefits" class="underlined" spellcheck="false" title="@{repeating_feats_$id_benefits}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="normal:">Normal:</span>
                                <div class="autoex std">
                                    <span name="attr_normal"></span>
                                    <textarea name="attr_normal" class="underlined" spellcheck="false" title="@{repeating_feats_$id_normal}"></textarea>
                                </div>
                                <span class="lbl std right" data-i18n="special:">Special:</span>
                                <div class="autoex std">
                                    <span name="attr_special"></span>
                                    <textarea name="attr_special" class="underlined" spellcheck="false" title="@{repeating_feats_$id_special}"></textarea>
                                </div>
                            </div>
                            <div class="myrow grtopbrd">
                                <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{description}}}" title="@{repeating_feats_$id_descflag}" checked="checked" /><span></span>
                                <span class="lbl atk" data-i18n="description:">Description:</span>
                                <div class="autoex">
                                    <span name="attr_description"></span>
                                    <textarea name="attr_description" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_feats_$id_description}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>  <!-- END Feats -->
        <div class="myrow">
            <span class="bold" data-i18n="skills">Skills</span>
            <input type="hidden" class="optional-flag0" name="attr_acrobatics_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_acrobatics" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{acrobatics}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{acrobatics}[MOD]]]}} {{abilitytype=@{acrobatics_notes}}}"><span data-i18n="acrobatics">Acrobatics</span> <span name="attr_acrobatics_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_appraise" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_appraise" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{appraise}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{appraise}[MOD]]]}} {{abilitytype=@{appraise_notes}}}"><span data-i18n="appraise">Appraise</span> <span name="attr_appraise_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_bluff_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_bluff" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{bluff}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{bluff}[MOD]]]}} {{abilitytype=@{bluff_notes}}}"><span data-i18n="bluff">Bluff</span> <span name="attr_bluff_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_climb_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_climb" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{climb}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{climb}[MOD]]]}} {{abilitytype=@{climb_notes}}}"><span data-i18n="climb">Climb</span> <span name="attr_climb_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_craft_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_craft" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{craft}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{craft}[MOD]]]}} {{abilitytype=@{craft_notes}}}"><span data-i18n="craft">Craft</span> <span name="attr_craft_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_diplomacy_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_diplomacy" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{diplomacy}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{diplomacy}[MOD]]]}} {{abilitytype=@{diplomacy_notes}}}"><span data-i18n="diplomacy">Diplomacy</span> <span name="attr_diplomacy_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_disable_device_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_disabledevice" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{disable_device}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{disable_device}[MOD]]]}} {{abilitytype=@{disable_device_notes}}}"><span data-i18n="disable_device">Disable Device</span> <span name="attr_disable_device_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_disguise_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_disguise" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{disguise}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{disguise}[MOD]]]}} {{abilitytype=@{disguise_notes}}}"><span data-i18n="disguise">Disguise</span> <span name="attr_disguise_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_escape_artist_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_escapeartist" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{escape_artist}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{escape_artist}[MOD]]]}} {{abilitytype=@{escape_artist_notes}}}"><span data-i18n="escape_artist">Escape Artist</span> <span name="attr_escape_artist_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_fly_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_fly" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{fly}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{fly}[MOD]]]}} {{abilitytype=@{fly_notes}}}"><span data-i18n="fly">Fly</span> <span name="attr_fly_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_handle_animal_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_handleanimal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{handle_animal}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{handle_animal}[MOD]]]}} {{abilitytype=@{handle_animal_notes}}}"><span data-i18n="handle_animal">Handle Animal</span> <span name="attr_handle_animal_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_heal_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_heal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{heal}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{heal}[MOD]]]}} {{abilitytype=@{heal_notes}}}"><span data-i18n="heal">Heal</span> <span name="attr_heal_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_intimidate_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_intimidate" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{intimidate}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{intimidate}[MOD]]]}} {{abilitytype=@{intimidate_notes}}}"><span data-i18n="intimidate">Intimidate</span> <span name="attr_intimidate_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_arcana_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgearcana" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_arcana}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_arcana}[MOD]]]}} {{abilitytype=@{knowledge_arcana_notes}}}"><span data-i18n="knowledge_arcana">Knowledge Arcana</span> <span name="attr_knowledge_arcana_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_dungeoneering_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgedungeoneering" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_dungeoneering}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_dungeoneering}[MOD]]]}} {{abilitytype=@{knowledge_dungeoneering_notes}}}"><span data-i18n="knowledge_dungeoneering">Knowledge Dungeoneering</span> <span name="attr_knowledge_dungeoneering_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_engineering_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgeengineering" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_engineering}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_engineering}[MOD]]]}} {{abilitytype=@{knowledge_engineering_notes}}}"><span data-i18n="knowledge_engineering">Knowledge Engineering</span> <span name="attr_knowledge_engineering_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_geography_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgegeography" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_geography}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_geography}[MOD]]]}} {{knowledge_geography=@{acrobatics_notes}}}"><span data-i18n="knowledge_geography">Knowledge Geography</span> <span name="attr_knowledge_geography_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_history_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgehistory" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_history}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_history}[MOD]]]}} {{abilitytype=@{knowledge_history_notes}}}"><span data-i18n="knowledge_history">Knowledge History</span> <span name="attr_knowledge_history_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_local_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgelocal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_local}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_local}[MOD]]]}} {{abilitytype=@{knowledge_local_notes}}}"><span data-i18n="knowledge_local">Knowledge Local</span> <span name="attr_knowledge_local_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_nature_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgenature" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_nature}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_nature}[MOD]]]}} {{abilitytype=@{knowledge_nature_notes}}}"><span data-i18n="knowledge_nature">Knowledge Nature</span> <span name="attr_knowledge_nature_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_nobility_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgenobility" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_nobility}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_nobility}[MOD]]]}} {{abilitytype=@{knowledge_nobility_notes}}}"><span data-i18n="knowledge_nobility">Knowledge Nobility</span> <span name="attr_knowledge_nobility_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_planes_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgeplanes" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_planes}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_planes}[MOD]]]}} {{abilitytype=@{knowledge_planes_notes}}}"><span data-i18n="knowledge_planes">Knowledge Planes</span> <span name="attr_knowledge_planes_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_knowledge_religion_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_knowledgereligion" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{knowledge_religion}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_religion}[MOD]]]}} {{abilitytype=@{knowledge_religion_notes}}}"><span data-i18n="knowledge_religion">Knowledge Religion</span> <span name="attr_knowledge_religion_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_linguistics_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_linguistics" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{linguistics}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{linguistics}[MOD]]]}} {{abilitytype=@{linguistics_notes}}}"><span data-i18n="linguistics">Linguistics</span> <span name="attr_linguistics_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_perception_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_perception" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{perception}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{perception}[MOD]]]}} {{abilitytype=@{perception_notes}}}"><span data-i18n="perception">Perception</span> <span name="attr_perception_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_perform_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_perform" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{perform}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{perform}[MOD]]]}} {{abilitytype=@{perform_notes}}}"><span data-i18n="perform">Perform</span> <span name="attr_perform_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_profession_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_profession" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{profession}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{profession}[MOD]]]}} {{abilitytype=@{profession_notes}}}"><span data-i18n="profession">Profession</span> <span name="attr_profession_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_ride_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_ride" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{ride}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{ride}[MOD]]]}} {{abilitytype=@{ride_notes}}}"><span data-i18n="ride">Ride</span> <span name="attr_ride_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_sense_motive_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_sensemotive" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{sense_motive}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{sense_motive}[MOD]]]}} {{abilitytype=@{sense_motive_notes}}}"><span data-i18n="sense_motive">Sense Motive</span> <span name="attr_sense_motive_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_sleight_of_hand_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_sleightofhand" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{sleight_of_hand}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{sleight_of_hand}[MOD]]]}} {{abilitytype=@{sleight_of_hand_notes}}}"><span data-i18n="sleight_of_hand">Sleight Of Hand</span> <span name="attr_sleight_of_hand_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_spellcraft_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_spellcraft" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{spellcraft}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{spellcraft}[MOD]]]}} {{abilitytype=@{spellcraft_notes}}}"><span data-i18n="spellcraft">Spellcraft</span> <span name="attr_spellcraft_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_stealth_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_stealth" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{stealth}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{stealth}[MOD]]]}} {{abilitytype=@{stealth_notes}}}"><span data-i18n="stealth">Stealth</span> <span name="attr_stealth_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_survival_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_survival" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{survival}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{survival}[MOD]]]}} {{abilitytype=@{survival_notes}}}"><span data-i18n="survival">Survival</span> <span name="attr_survival_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_swim_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_swim" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{swim}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{swim}[MOD]]]}} {{abilitytype=@{swim_notes}}}"><span data-i18n="swim">Swim</span> <span name="attr_swim_display"></span></button>,</span>
            <input type="hidden" class="optional-flag0" name="attr_use_magic_device_flag" value="0" /><span class="optional inl"><button class="myrol" type="roll" name="roll_npc_usemagicdevice" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:npc} {{name=^{use_magic_device}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{use_magic_device}[MOD]]]}} {{abilitytype=@{use_magic_device_notes}}}"><span data-i18n="use_magic_device">Use Magic Device</span> <span name="attr_use_magic_device_display"></span></button>,</span>
            <input type="hidden" class="optional-flag" name="attr_skills_racial_modifiers" value="" /><span class="optional inl"><span class="bold" data-i18n="racial-modifiers">Racial Modifiers</span>&nbsp;<span name="attr_skills_racial_modifiers"></span></span>
            <input type="hidden" class="optional-flag" name="attr_skills_notes" value="" /><span class="optional inl"><span class="bold" data-i18n="notes">Notes</span>&nbsp;<span name="attr_skills_notes"></span></span>
        </div>
        <div class="myrow">
            <span class="bold" data-i18n="languages">Languages</span>
            <span name="attr_languages"></span>
        </div>
        <input type="hidden" class="optional-flag" name="attr_sq" value="" /><div class="myrow optional blk">
            <span class="bold" data-i18n="sq-u">SQ</span>
            <span name="attr_sq"></span>
        </div>
        <input type="hidden" class="optional-flag" name="attr_combat_gear" value="" /><div class="myrow optional blk">
            <span class="bold" data-i18n="combat-gear">Combat Gear</span>
            <span name="attr_combat_gear"></span>
        </div>
    </div> <!-- END Display STATISTICS -->
    <input type="hidden" class="optional-flag0" name="attr_special_abilities_flag" value="0" /><div class="specabilities optional blk"> <!-- Display SPECIAL ABILITIES -->
        <div class="npc-display">
            <div class="myrow"> <span class="npc-section" data-i18n="special-abilities">Special Abilities</span> </div>
            <fieldset class="repeating_abilities">
                <div class="ability">
                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                    <button class="myrol underl" type="roll" name="roll_ability" data-i18n-title="show-ability" title="Show Ability" value="@{whispertype} &{template:npc} {{name=@{name}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{abilitytype=@{type}}} @{descflag}"><span class="bold" name="attr_name"></span>
                        <input type="hidden" class="optional-flag" name="attr_type" value="" /><span class="optional inl bold">(<span name="attr_type"></span>)</span></button>
                    <span style="display: inline;" name="attr_description"></span>
                    <div class="options">
                        <div class="myrow">
                            <span class="lbl" data-i18n="name">Name</span>
                            <input type="text" name="attr_name" class="underlined large" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_abilities_$id_name}" />
                            <input type="hidden" name="attr_fromcompendium" class="fromcompendium" value="" />
                            <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                            <span class="lbl margindent" data-i18n="type">Type</span>
                            <input type="text" name="attr_type" class="underlined small" spellcheck="false" data-i18n-placeholder="type" placeholder="Type" title="@{repeating_abilities_$id_type}" />
                        </div>
                        <div class="myrow">
                            <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{description}}}" title="@{repeating_abilities_$id_descflag}" checked="checked" /><span></span>
                            <span class="lbl atk" data-i18n="description:">Description:</span>
                            <div class="autoex">
                                <span name="attr_description"></span>
                                <textarea name="attr_description" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_abilities_$id_description}"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div> <!-- END Display SPECIAL ABILITIES -->
    <input type="hidden" class="optional-flag0" name="attr_ecology_flag" value="1" /><div class="optional blk"> <!-- Display ECOLOGY -->
        <div class="npc-display">
            <span class="npc-section" data-i18n="ecology">Ecology</span>
            <div class="myrow">
                <span class="bold" data-i18n="environment">Environment</span>
                <span name="attr_environment"></span>
            </div>
            <div class="myrow">
                <span class="bold" data-i18n="organization">Organization</span>
                <span name="attr_organization"></span>
            </div>
            <div class="myrow">
                <span class="bold" data-i18n="treasure">Treasure</span>
                <span name="attr_treasure"></span>
            </div>
            <div class="myrow">
                <span class="bold" data-i18n="description">Description</span>
                <span name="attr_background"></span>
            </div>
        </div>
    </div> <!-- END Display ECOLOGY -->
</div><!-- END NPC SHEET -->

<div class="fullpc"> <!-- PC SHEET -->
    <div class="myrow"> <!-- top row -->
        <div class="conditions-container"> <!-- Conditions -->
            <input class="pictocheck option" name="attr_options-flag-conditions" type="checkbox" data-i18n-title="show-hide-conditions" title="Show/hide conditions" /><span class="lab condcheck" style="text-align: left;" data-i18n="conditions:">Conditions:</span>
            <span name="attr_conditions_display" class="lab conditions-display"></span>
            <div  class="options conditions">
                <div class="subcol">
                    <input class="labelcheck" type="checkbox" name="attr_condition_bleed" value="1" title="@{condition_bleed}" /><span class="lbl" data-i18n="bleed">Bleed</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_dazed" value="1" title="@{condition_dazed}" /><span class="lbl" data-i18n="dazed">Dazed</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_dying" value="1" title="@{condition_dying}" /><span class="lbl" data-i18n="dying">Dying</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_fascinated" value="1" title="@{condition_fascinated}" /><span class="lbl" data-i18n="fascinated">Fascinated</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_grappled" value="1" title="@{condition_grappled}" /><span class="lbl" data-i18n="grappled">Grappled</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_nauseated" value="1" title="@{condition_nauseated}" /><span class="lbl" data-i18n="nauseated">Nauseated</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_pinned" value="1" title="@{condition_pinned}" /><span class="lbl" data-i18n="pinned">Pinned</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_stable" value="1" title="@{condition_stable}" /><span class="lbl" data-i18n="stable">Stable</span>
                </div>
                <div class="subcol margindent">
                    <input class="labelcheck" type="checkbox" name="attr_condition_blinded" value="1" title="@{condition_blinded}" /><span class="lbl" data-i18n="blinded">Blinded</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_dazzled" value="1" title="@{condition_dazzled}" /><span class="lbl" data-i18n="dazzled">Dazzled</span><br/>
                    <input type="number" name="attr_condition_energy_drained" class="nospin underlined spsml" value="0" title="@{condition_energy_drained}" /><input type="hidden" name="attr_condition_energy_drained" value="0" /><span class="lbl" data-i18n="energy_drained">Energy Drained</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_fatigued" value="1" title="@{condition_fatigued}" /><span class="lbl" data-i18n="fatigued">Fatigued</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_helpless" value="1" title="@{condition_helpless}" /><span class="lbl" data-i18n="helpless">Helpless</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_panicked" value="1" title="@{condition_panicked}" /><span class="lbl" data-i18n="panicked">Panicked</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_prone" value="1" title="@{condition_prone}" /><span class="lbl" data-i18n="prone">Prone</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_staggered" value="1" title="@{condition_staggered}" /><span class="lbl" data-i18n="staggered">Staggered</span>
                </div>
                <div class="subcol margindent">
                    <input class="labelcheck" type="checkbox" name="attr_condition_confused" value="1" title="@{condition_confused}" /><span class="lbl" data-i18n="confused">Confused</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_deafened" value="1" title="@{condition_deafened}" /><span class="lbl" data-i18n="deafened">Deafened</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_entangled" value="1" title="@{condition_entangled}" /><span class="lbl" data-i18n="entangled">Entangled</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_frightened" value="1" title="@{condition_frightened}" /><span class="lbl" data-i18n="frightened">Frightened</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_incorporeal" value="1" title="@{condition_incorporeal}" /><span class="lbl" data-i18n="incorporeal">Incorporeal</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_paralyzed" value="1" title="@{condition_paralyzed}" /><span class="lbl" data-i18n="paralyzed">Paralyzed</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_shaken" value="1" title="@{condition_shaken}" /><span class="lbl" data-i18n="shaken">Shaken</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_stunned" value="1" title="@{condition_stunned}" /><span class="lbl" data-i18n="stunned">Stunned</span>
                </div>
                <div class="subcol margindent">
                    <input class="labelcheck" type="checkbox" name="attr_condition_cowering" value="1" title="@{condition_cowering}" /><span class="lbl" data-i18n="cowering">Cowering</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_disabled" value="1" title="@{condition_disabled}" /><span class="lbl" data-i18n="disabled">Disabled</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_exhausted" value="1" title="@{condition_exhausted}" /><span class="lbl" data-i18n="exhausted">Exhausted</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_flat-footed" value="1" title="@{condition_flat-footed}" /><span class="lbl" data-i18n="flat-footed">Flat-Footed</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_invisible" value="1" title="@{condition_invisible}" /><span class="lbl" data-i18n="invisible">Invisible</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_petrified" value="1" title="@{condition_petrified}" /><span class="lbl" data-i18n="petrified">Petrified</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_sickened" value="1" title="@{condition_sickened}" /><span class="lbl" data-i18n="sickened">Sickened</span><br/>
                    <input class="labelcheck" type="checkbox" name="attr_condition_unconscious" value="1" title="@{condition_unconscious}" /><span class="lbl" data-i18n="unconscious">Unconscious</span>
                </div>
                <div class="myrow"><input class="pictocheck" type="checkbox" name="attr_conditions_reset" value="1" title="@{conditions_reset}" /><span class="lbl reset" data-i18n="clear-conditions">Clear Conditions</span></div>
            </div>
        </div>  <!-- END Conditions -->
        <div class="col1third"><img style="width: 270px;" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/logo.png" /></div> <!-- logo -->
        <div class="col2third" style="padding-top: 4px;"> <!-- identity -->
            <div class="myrow">
                <div class="identity">
                    <input type="text" name="attr_character_name" class="underlined" spellcheck="false" title="@{character_name}" />
                    <span data-i18n="character-name">character name</span>
                </div>
                <div class="identity">
                    <select class="alignment underlined" name="attr_alignment" title="@{alignment}">
                        <option value="lawful good" data-i18n="lawful-good">lawful good</option>
                        <option value="neutral good" data-i18n="neutral-good">neutral good</option>
                        <option value="chaotic good" data-i18n="chaotic-good">chaotic good</option>
                        <option value="lawful neutral" data-i18n="lawful-neutral">lawful neutral</option>
                        <option value="neutral" data-i18n="neutral" selected="selected">neutral</option>
                        <option value="chaotic neutral" data-i18n="chaotic-neutral">chaotic neutral</option>
                        <option value="lawful evil" data-i18n="lawful-evil">lawful evil</option>
                        <option value="neutral evil" data-i18n="neutral-evil">neutral evil</option>
                        <option value="chaotic evil" data-i18n="chaotic-evil">chaotic evil</option>
                    </select>
                    <span data-i18n="alignment">alignment</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_player" class="underlined" spellcheck="false" title="@{player}" />
                    <span data-i18n="player">player</span>
                </div>
            </div>
            <div class="myrow">
                <div class="identity">
                    <span class="pseudoattr greybg underlined" style="width: 210px;" name="attr_class" title="@{class}"></span>
                    <span data-i18n="class">Class</span>
                </div>
                <div class="identity">
                    <span class="pseudoattr greybg underlined center" style="width: 35px;" name="attr_level" title="@{level}"></span>
                    <span data-i18n="level">Level</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_deity" class="underlined medium" spellcheck="false" title="@{deity}" />
                    <span data-i18n="deity">Deity</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_homeland" class="underlined medium" spellcheck="false" title="@{homeland}" />
                    <span data-i18n="homeland">Homeland</span>
                </div>
            </div>
            <div class="myrow">
                <div class="identity">
                    <input type="text" name="attr_race" class="underlined medium" spellcheck="false" title="@{race}" />
                    <span data-i18n="race">Race</span>
                </div>
                <div class="identity">
                    <select class="size underlined" name="attr_size" title="@{size}">
                        <option value="fine" data-i18n="fine">Fine</option>
                        <option value="diminutive" data-i18n="diminutive">Diminutive</option>
                        <option value="tiny" data-i18n="tiny">Tiny</option>
                        <option value="small" data-i18n="small">Small</option>
                        <option value="medium" data-i18n="medium" selected="selected">Medium</option>
                        <option value="large" data-i18n="large">Large</option>
                        <option value="huge" data-i18n="huge">Huge</option>
                        <option value="gargantuan" data-i18n="gargantuan">Gargantuan</option>
                        <option value="colossal" data-i18n="colossal">Colossal</option>
                    </select>
                    <span data-i18n="size">Size</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_gender" class="underlined small" spellcheck="false" title="@{gender}" />
                    <span data-i18n="gender">Gender</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_age" class="underlined small" spellcheck="false" title="@{age}" />
                    <span data-i18n="age">Age</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_height" class="underlined small" spellcheck="false" title="@{height}" />
                    <span data-i18n="height-char">Height</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_weight" class="underlined small" spellcheck="false" title="@{weight}" />
                    <span data-i18n="weight-char">Weight</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_hair" class="underlined small" spellcheck="false" title="@{hair}" />
                    <span data-i18n="hair">Hair</span>
                </div>
                <div class="identity">
                    <input type="text" name="attr_eyes" class="underlined small" spellcheck="false" title="@{eyes}" />
                    <span data-i18n="eyes">Eyes</span>
                </div>
            </div>
        </div> <!-- END identity -->
    </div> <!-- END top row -->
    <!-- PSEUDO TABS -->
    <input type="radio" name="attr_tabcurrent" class="tabmain" value="tabmain" /><span data-i18n="tab-main">Main</span>
    <input type="radio" name="attr_tabcurrent" class="tabadd" value="tabadd" /><span data-i18n="tab-additional">Additional</span>
    <input type="hidden" name="attr_caster_flag" class="optional-flag0" value="0" /><input type="radio" name="attr_tabcurrent" class="tabspell optional inl" value="tabspell" /><span class="optional inl" data-i18n="tab-spells">Spells</span>
    <input type="radio" name="attr_tabcurrent" class="tabconf" value="tabconf" checked="checked" /><span data-i18n="tab-configuration">Configuration</span>
    <div class="tabmain"> <!-- TAB MAIN -->
        <div class="colhalf"> <!-- tab1 col1 -->
            <input type="hidden" name="attr_attack_condition" value="0" class="condition-flag attacks" />
            <div class="abilities"> <!-- ABILITIES -->
                <div class="myrow labline top">
                    <span class="lab" data-i18n="ability-name" data-i18n-title="ability-name" title="Ability Name">Ability Name</span>
                    <span class="lab" data-i18n="score" data-i18n-title="ability-score" title="Score">Score</span>
                    <span class="lab" data-i18n="modifier" data-i18n-title="ability-modifier" title="Modifier">Modifier</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <input type="hidden" name="attr_ability_check_condition" value="0" class="condition-flag" />
                <div class="ability"> <!-- strength -->
                    <input class="options-flag" name="attr_options-flag-str" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_strength" data-i18n-title="strength-roll" title="Strength roll" value="@{whispertype} &{template:pc} {{name=^{strength}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{strength_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{strength_notes}}} {{conditionsflag=[[@{ability_check_condition}+@{strength_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="str">str</span></button>
                            <span class="sml" data-i18n="strength" data-i18n-title="strength" title="Strength">Strength</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <input type="hidden" name="attr_strength_condition" value="0" class="redbrd" />
                        <div class="boxed redbrd">
                            <input type="number" name="attr_strength_base" value="10" class="nospin baseattr" title="@{strength}" />
                            <input type="hidden" name="attr_strength" value="10" />
                            <input type="hidden" name="attr_strength_bonus" value="0" class="attr-flag" />
                            <span name="attr_strength" class="pseudoattr finalattr"></span>
                        </div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_strength_half_mod" value="0" />
                            <input type="hidden" name="attr_strength_oneandahalf_mod" value="0" />
                            <span name="attr_strength_mod" class="pseudoattr" title="@{strength_mod}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_strength_bonus" class="nospin boxed" value="0" title="@{strength_bonus}" /></div>
                    </div>
                    <div class="options">
                        <span class="lab" data-i18n="condition">Condition</span><div class="boxed greybg"><span name="attr_strength_condition" class="pseudoattr redtxt" title="@{strength_condition}"></span></div>
                        <div class="autoex">
                            <span name="attr_strength_notes"></span>
                            <textarea name="attr_strength_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END strength -->
                <div class="ability"> <!-- dexterity -->
                    <input class="options-flag" name="attr_options-flag-dex" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_dexterity" data-i18n-title="dexterity-roll" title="Dexterity roll" value="@{whispertype} &{template:pc} {{name=^{dexterity}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{dexterity_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{dexterity_notes}}} {{conditionsflag=[[@{ability_check_condition}+@{dexterity_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="dex">dex</span></button>
                            <span class="sml" data-i18n="dexterity" data-i18n-title="dexterity" title="Dexterity">Dexterity</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <input type="hidden" name="attr_dexterity_condition" value="0" class="redbrd" />
                        <div class="boxed redbrd">
                            <input type="number" name="attr_dexterity_base" value="10" class="nospin baseattr" title="@{dexterity}" />
                            <input type="hidden" name="attr_dexterity" value="10" />
                            <input type="hidden" name="attr_dexterity_bonus" value="0" class="attr-flag" />
                            <span name="attr_dexterity" class="pseudoattr finalattr"></span>
                        </div>
                        <input type="hidden" name="attr_dexterity_condition_nobonus" value="0" class="redbrd" />
                        <div class="boxed greybg redbrd">
                            <input type="hidden" name="attr_dexterity_half_mod" value="0" />
                            <input type="hidden" name="attr_dexterity_oneandahalf_mod" value="0" />
                            <span name="attr_dexterity_mod" class="pseudoattr" title="@{dexterity_mod}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_dexterity_bonus" class="nospin boxed" value="0" title="@{dexterity_bonus}" /></div>
                    </div>
                    <div class="options">
                        <span class="lab" data-i18n="condition">Condition</span><div class="boxed greybg"><span name="attr_dexterity_condition" class="pseudoattr redtxt" title="@{dexterity_condition}"></span></div>
                        <div class="autoex">
                            <span name="attr_dexterity_notes"></span>
                            <textarea name="attr_dexterity_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END dexterity -->
                <div class="ability"> <!-- constitution -->
                    <input class="options-flag" name="attr_options-flag-con" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_constitution" data-i18n-title="constitution-roll" title="Constitution roll" value="@{whispertype} &{template:pc} {{name=^{constitution}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{constitution_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{constitution_notes}}} {{conditionsflag=[[@{ability_check_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="con">con</span></button>
                            <span class="sml" data-i18n="constitution" data-i18n-title="constitution" title="Constitution">Constitution</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed">
                            <input type="number" name="attr_constitution_base" value="10" class="nospin baseattr" title="@{constitution}" />
                            <input type="hidden" name="attr_constitution" value="10" />
                            <input type="hidden" name="attr_constitution_bonus" value="0" class="attr-flag" />
                            <span name="attr_constitution" class="pseudoattr finalattr"></span>
                        </div>
                        <div class="boxed greybg"><span name="attr_constitution_mod" class="pseudoattr" title="@{constitution_mod}"></span></div>
                        <div class="boxed"><input type="number" name="attr_constitution_bonus" class="nospin boxed" value="0" title="@{constitution_bonus}" /></div>
                    </div>
                    <div class="options">
                        <div class="autoex">
                            <span name="attr_constitution_notes"></span>
                            <textarea name="attr_constitution_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END constitution -->
                <div class="ability"> <!-- intelligence -->
                    <input class="options-flag" name="attr_options-flag-int" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_intelligence" data-i18n-title="intelligence-roll" title="Intelligence roll" value="@{whispertype} &{template:pc} {{name=^{intelligence}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{intelligence_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{intelligence_notes}}} {{conditionsflag=[[@{ability_check_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="int">int</span></button>
                            <span class="sml" data-i18n="intelligence" data-i18n-title="intelligence" title="Intelligence">Intelligence</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed">
                            <input type="number" name="attr_intelligence_base" value="10" class="nospin baseattr" title="@{intelligence}" />
                            <input type="hidden" name="attr_intelligence" value="10" />
                            <input type="hidden" name="attr_intelligence_bonus" value="0" class="attr-flag" />
                            <span name="attr_intelligence" class="pseudoattr finalattr"></span>
                        </div>
                        <div class="boxed greybg"><span name="attr_intelligence_mod" class="pseudoattr" title="@{intelligence_mod}"></span></div>
                        <div class="boxed"><input type="number" name="attr_intelligence_bonus" class="nospin boxed" value="0" title="@{intelligence_bonus}" /></div>
                    </div>
                    <div class="options">
                        <div class="autoex">
                            <span name="attr_intelligence_notes"></span>
                            <textarea name="attr_intelligence_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END intelligence -->
                <div class="ability"> <!-- wisdom -->
                    <input class="options-flag" name="attr_options-flag-wis" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_wisdom" data-i18n-title="wisdom-roll" title="Wisdom roll" value="@{whispertype} &{template:pc} {{name=^{wisdom}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{wisdom_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{wisdom_notes}}} {{conditionsflag=[[@{ability_check_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="wis">wis</span></button>
                            <span class="sml" data-i18n="wisdom" data-i18n-title="wisdom" title="Wisdom">Wisdom</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed">
                            <input type="number" name="attr_wisdom_base" value="10" class="nospin baseattr" title="@{wisdom}" />
                            <input type="hidden" name="attr_wisdom" value="10" />
                            <input type="hidden" name="attr_wisdom_bonus" value="0" class="attr-flag" />
                            <span name="attr_wisdom" class="pseudoattr finalattr"></span>
                        </div>
                        <div class="boxed greybg"><span name="attr_wisdom_mod" class="pseudoattr" title="@{wisdom_mod}"></span></div>
                        <div class="boxed"><input type="number" name="attr_wisdom_bonus" class="nospin boxed" value="0" title="@{wisdom_bonus}" /></div>
                    </div>
                    <div class="options">
                        <div class="autoex">
                            <span name="attr_wisdom_notes"></span>
                            <textarea name="attr_wisdom_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END wisdom -->
                <div class="ability"> <!-- charisma -->
                    <input class="options-flag" name="attr_options-flag-cha" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_charisma" data-i18n-title="charisma-roll" title="Charisma roll" value="@{whispertype} &{template:pc} {{name=^{charisma}}} {{type=ability}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{charisma_mod}[MOD]+(@{ability_check_condition})[CONDITION]+@{rollmod_ability}[BONUS]]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{charisma_notes}}} {{conditionsflag=[[@{ability_check_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="cha">cha</span></button>
                            <span class="sml" data-i18n="charisma" data-i18n-title="charisma" title="Charisma">Charisma</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed">
                            <input type="number" name="attr_charisma_base" value="10" class="nospin baseattr" title="@{charisma}" />
                            <input type="hidden" name="attr_charisma" value="10" />
                            <input type="hidden" name="attr_charisma_bonus" value="0" class="attr-flag" />
                            <span name="attr_charisma" class="pseudoattr finalattr"></span>
                        </div>
                        <div class="boxed greybg"><span name="attr_charisma_mod" class="pseudoattr" title="@{charisma_mod}"></span></div>
                        <div class="boxed"><input type="number" name="attr_charisma_bonus" class="nospin boxed" value="0" title="@{charisma_bonus}" /></div>
                    </div>
                    <div class="options">
                        <div class="autoex">
                            <span name="attr_charisma_notes"></span>
                            <textarea name="attr_charisma_notes" spellcheck="false" data-i18n-placeholder="notes-ability-placeholder" placeholder="Notes: +2 racial, +1 magic item..."></textarea>
                        </div>
                    </div>
                </div> <!-- END charisma -->
            </div>  <!-- END ABILITIES -->
            <div class="subcol hpinit">
                <div class="myrow center"> <!-- HP -->
                    <div class="blacklabel pnty">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <button class="myrol big" type="roll" name="roll_hitdice" data-i18n-title="hit-die-roll" title="Hit Die roll" value="@{whispertype} &{template:pc} {{name=^{hit-dice}}} {{type=hp}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d@{hitdietype}+@{constitution_mod}[MOD]]]}}"><span data-i18n="hit-points">Hit Points</span></button>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                </div>
                <div class="myrow hpvalues center labline">
                    <span class="lab" data-i18n="curr" data-i18n-title="current" title="Current">curr</span>
                    <span class="lab" data-i18n="max" data-i18n-title="maximum" title="Maximum">max</span>
                    <span class="lab" style="width: 35px;" data-i18n="cond" data-i18n-title="condition" title="Condition">cond</span>
                </div>
                <div class="myrow hpvalues center">
                    <input type="hidden" name="attr_hp_condition" value="0" class="redbrd" />
                    <div class="boxed redbrd">
                        <input type="hidden" name="attr_hp_base" value="0" />
                        <input type="number" name="attr_hp" class="nospin hp" value="0" title="@{hp}" />
                    </div>
                    <div class="boxed redbrd">
                        <input type="hidden" name="attr_hp_base_max" value="0" />
                        <input type="number" name="attr_hp_max" class="nospin hp" value="0" title="@{hp_max}" />
                    </div>
                    <div class="boxed greybg">
                        <span name="attr_hp_condition" class="pseudoattr redtxt" style="width: 31px;"></span>
                    </div>
                </div>
                <div class="myrow center" style="margin-top: 2px; white-space: nowrap;">
                    <span class="lab" data-i18n="temp" data-i18n-title="temporaray-hp" title="Temporaray HP">Temp</span>
                    <div class="boxed">
                        <input type="number" name="attr_hp_temp" class="nospin boxed" value="0" title="@{hp_temp}" />
                    </div>
                    <span class="lab" data-i18n="nonlethal" data-i18n-title="nonlethal-damage" title="Nonlethal Damage">nonlethal</span>
                    <div class="boxed">
                        <input type="number" name="attr_nonlethaldmg" class="nospin boxed" value="0" title="@{nonlethaldmg}" />
                    </div>
                </div>
                <div class="autoex hpvalues bordered spell">
                    <span name="attr_dr"></span>
                    <textarea name="attr_dr" spellcheck="false" data-i18n-placeholder="damage-reduction-immunities" placeholder="Damage Reduction, Immunities..." data-i18n-title="damage-reduction-immunities" title="Damage Reduction, Immunities..."></textarea>
                </div>
                 <!-- END HP -->
                <div class="topspace initiative"> <!-- INITIATIVE -->
                    <input class="options-flag" name="attr_options-flag-initiative" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                    <div class="myrow">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_initiative" data-i18n-title="initiative-roll" title="Initiative roll" value="@{whispertype} &{template:pc} {{name=^{initiative}}} {{type=initiative}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{initiative}[MOD]+(@{initiative_condition})[CONDITION]+@{rollmod_initiative}[BONUS] &{tracker}]]}} {{shownotes=@{rollnotes_initiative}}} {{notes=@{initiative_notes}}} {{conditionsflag=[[@{initiative_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="init">Init</span></button>
                            <span class="sml" data-i18n="initiative" data-i18n-title="initiative" title="Initiative">Initiative</span>
                            <input type="hidden" name="attr_initiative_condition" value="0" class="condition-flag" />
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_initiative_bonus" class="attr-flag" value="0" />
                            <span name="attr_initiative" class="pseudoattr" title="@{initiative}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_initiative_bonus" class="nospin boxed" value="0" title="@{initiative_bonus}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="lab" style="margin-left: 73px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                        <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    </div>
                    <div class="options">
                        <div class="myrow">
                            <span class="spacer">=</span>
                            <div class="boxed greybg"><span name="attr_dexterity_mod" class="pseudoattr" title="@{dexterity_mod}"></span></div>
                            <span class="spacer">+</span>
                            <div class="boxed"><input type="number" name="attr_initiative_misc" class="nospin boxed" value="0" title="@{initiative_misc}" /></div>
                        </div>
                        <div class="myrow labline bottom">
                            <span class="spacer"></span>
                            <span class="lab" data-i18n="dex" data-i18n-title="dexterity-modifier" title="Dexterity Modifier">dex</span>
                            <span class="spacer"></span>
                            <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                        </div>
                        <div class="autoex">
                            <span name="attr_initiative_notes"></span>
                            <textarea name="attr_initiative_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{initiative_notes}"></textarea>
                        </div>
                    </div>
                </div><!-- END initiative -->
            </div>
            <div class="topspace acvalues">
                <input class="options-flag" name="attr_options-flag-ac" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow"> <!-- AC -->
                    <input type="hidden" name="attr_ac_condition_note" value="" />
                    <input type="hidden" name="attr_ac_condition" value="0" class="redbrd" />
                    <div class="blacklabel sqr ac"><button class="myrol big" type="roll" name="roll_ac" value="@{whispertype} &{template:pc} {{smallname=^{armor-class}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{descflag=1}} {{desc=**^{ac-u}** [[@{ac}]] **^{touch}** [[@{ac_touch}]] **^{flat-footed}** [[@{ac_flatfooted}]]}} {{shownotes=@{rollnotes_ability}}} {{notes=@{ac_notes}}} {{conditionsnote=@{ac_condition_note}}}"><span data-i18n="ac-u" data-i18n-title="armor-class" title="Armor Class">AC</span></button></div>
                    <div class="boxed greybg redbrd">
                        <input type="hidden" name="attr_ac_bonus" class="attr-flag" value="0" />
                        <span name="attr_ac" class="pseudoattr" title="@{ac}"></span>
                    </div>
                    <div class="boxed"><input type="number" name="attr_ac_bonus" class="nospin boxed" value="0" title="@{ac_bonus}" /></div>
                    <div class="blacklabel sqr touch">
                        <span class="big" data-i18n="touch">Touch</span>
                        <span class="sml" data-i18n="armor-class" data-i18n-title="armor-class" title="Armor Class">Armor Class</span>
                    </div>
                    <div class="boxed greybg redbrd">
                        <input type="hidden" name="attr_ac_bonus" class="attr-flag" value="0" />
                        <span name="attr_ac_touch" class="pseudoattr" title="@{ac_touch}"></span>
                    </div>
                    <div class="blacklabel sqr flatfooted">
                        <span class="big" data-i18n="flat-footed">Flat-footed</span>
                        <span class="sml" data-i18n="armor-class" data-i18n-title="armor-class" title="Armor Class">Armor Class</span>
                    </div>
                    <div class="boxed greybg redbrd">
                        <input type="hidden" name="attr_ac_bonus" class="attr-flag" value="0" />
                        <span name="attr_ac_flatfooted" class="pseudoattr" title="@{ac_flatfooted}"></span>
                    </div>
                </div>
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 43px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    <span class="margindent" style="color: #BE202E; white-space: normal;" name="attr_ac_condition_note"></span>
                </div>
                <div class="options">
                    <div class="myrow">
                        <span class="spacer">=</span>
                        <span class="spacer">10</span>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_armor" class="pseudoattr" title="@{ac_armor}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_shield" class="pseudoattr" title="@{ac_shield}"></span></div>
                        <span class="spacer">+</span>
                        <input type="hidden" name="attr_ac_condition_nobonus" value="0" class="redbrd" /><div class="boxed greybg redbrd"><span name="attr_ac_ability_mod" class="pseudoattr" title="@{ac_ability_mod}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_size" class="pseudoattr" title="@{ac_size}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_condition" class="pseudoattr redtxt" title="@{ac_condition}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed"><input type="number" name="attr_ac_misc" class="nospin boxed" value="0" title="@{ac_misc}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="lab" style="margin-left: 43px;" data-i18n="armor" data-i18n-title="armor-bonus" title="Armor Bonus">Armor</span>
                        <span class="lab margindent" data-i18n="shield" data-i18n-title="shield-bonus" title="Shield Bonus">Shield</span>
                        <span class="lab margindent" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="lab margindent" data-i18n="size" data-i18n-title="size-modifier" title="Size Modifier">Size</span>
                        <span class="lab margindent" data-i18n="condition">Condition</span>
                        <span class="lab margindent" data-i18n="misc" data-i18n-title="misc-bonus" title="Misc Bonus">Misc</span>
                    </div>
                    <div class="myrow">
                        <span class="spacer margindent"></span>
                        <span class="spacer margindent">+</span>
                        <div class="boxed greybg"><span name="attr_ac_natural_bonus" class="pseudoattr" title="@{ac_natural_bonus}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed"><input type="number" name="attr_ac_natural" class="nospin boxed" value="0" title="@{ac_natural}" /></div>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_deflection_bonus" class="pseudoattr" title="@{ac_deflection_bonus}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed"><input type="number" name="attr_ac_deflection" class="nospin boxed" value="0" title="@{ac_deflection}" /></div>
                        <span class="spacer">+</span>
                        <div class="boxed greybg"><span name="attr_ac_dodge_bonus" class="pseudoattr" title="@{ac_dodge_bonus}"></span></div>
                        <span class="spacer">+</span>
                        <div class="boxed"><input type="number" name="attr_ac_dodge" class="nospin boxed" value="0" title="@{ac_dodge}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="lab" style="margin-left: 47px;" data-i18n="natural" data-i18n-title="natural-armor-from-acitems" title="Natural Armor from AC Items">Natural</span>
                        <span class="lab margindent" data-i18n="mod" data-i18n-title="natural-armor-modifier" title="Natural Armor Modifier">Mod</span>
                        <span class="lab margindent" data-i18n="deflection" data-i18n-title="deflection-from-acitems" title="Deflection from AC Items">Deflection</span>
                        <span class="lab margindent" data-i18n="mod" data-i18n-title="deflection-modifier" title="Deflection Modifier">Mod</span>
                        <span class="lab margindent" data-i18n="dodge" data-i18n-title="dodge-from-acitems" title="Dodge from AC Items">Dodge</span>
                        <span class="lab margindent" data-i18n="mod" data-i18n-title="dodge-modifier" title="Dodge Modifier">Mod</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_ac_notes"></span>
                        <textarea name="attr_ac_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{ac_notes}"></textarea>
                    </div>
                </div>
            </div>  <!-- END AC -->
            <div class="topspace saves"> <!-- SAVING THROWS -->
                <input class="options-flag fortitude" name="attr_options-flag-fortitude" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <input class="options-flag reflex" name="attr_options-flag-reflex" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <input class="options-flag will" name="attr_options-flag-will" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow">
                    <input type="hidden" name="attr_saves_condition" value="0" class="condition-flag" />
                    <div class="save fortitude">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_fortitude" data-i18n-title="fortitude-roll" title="Fortitude roll" value="@{whispertype} &{template:pc} {{name=^{fortitude}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{fortitude}[MOD]+(@{saves_condition})[CONDITION]+@{rollmod_save}[BONUS]]]}} {{shownotes=@{rollnotes_save}}} {{notes=@{fortitude_notes}}} {{conditionsflag=[[@{saves_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="fort-u">FORT</span></button>
                            <span class="sml" data-i18n="fortitude" data-i18n-title="fortitude" title="Fortitude">Fortitude</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_fortitude_bonus" class="attr-flag" value="0" />
                            <span name="attr_fortitude" class="pseudoattr" title="@{fortitude}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_fortitude_bonus" class="nospin boxed" value="0" title="@{fortitude_bonus}" /></div>
                    </div>
                    <div class="save reflex">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_reflex" data-i18n-title="reflex-roll" title="Reflex roll" value="@{whispertype} &{template:pc} {{name=^{reflex}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{reflex}[MOD]+(@{saves_condition})[CONDITION]+@{rollmod_save}[BONUS]]]}} {{shownotes=@{rollnotes_save}}} {{notes=@{reflex_notes}}} {{conditionsflag=[[@{saves_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="ref-u">REF</span></button>
                            <span class="sml" data-i18n="reflex" data-i18n-title="reflex" title="Reflex">Reflex</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_reflex_bonus" class="attr-flag" value="0" />
                            <span name="attr_reflex" class="pseudoattr" title="@{reflex}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_reflex_bonus" class="nospin boxed" value="0" title="@{reflex_bonus}" /></div>
                    </div>
                    <div class="save will">
                        <div class="blacklabel sqr">
                            <button class="myrol big" type="roll" name="roll_will" data-i18n-title="will-roll" title="Will roll" value="@{whispertype} &{template:pc} {{name=^{will}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{will}[MOD]+(@{saves_condition})[CONDITION]+@{rollmod_save}[BONUS]]]}} {{shownotes=@{rollnotes_save}}} {{notes=@{will_notes}}} {{conditionsflag=[[@{saves_condition}]]}} {{conditions=@{conditions_display}}}"><span data-i18n="will-u">WILL</span></button>
                            <span class="sml" data-i18n="will" data-i18n-title="will" title="Will">Will</span>
                            <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                        </div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_will_bonus" class="attr-flag" value="0" />
                            <span name="attr_will" class="pseudoattr" title="@{will}"></span>
                        </div>
                        <div class="boxed"><input type="number" name="attr_will_bonus" class="nospin boxed" value="0" title="@{will_bonus}" /></div>
                    </div>
                </div>
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 65px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    <span class="lab" style="margin-left: 65px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    <span class="lab" style="margin-left: 65px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <div class="options-fortitude">
                    <div class="myrow">
                        <span class="spacer" data-i18n="fort-u" data-i18n-title="fortitude" title="Fortitude">FORT</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_fortitude_base" class="pseudoattr" title="@{fortitude_base}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_fortitude_ability_mod" class="pseudoattr" title="@{fortitude_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_fortitude_misc" class="nospin boxed" value="0" title="@{fortitude_misc}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="spacer invisible" data-i18n="fort-u" data-i18n-title="fortitude" title="Fortitude">FORT</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="base" data-i18n-title="base-modifier" title="Base Modifier">Base</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_fortitude_notes"></span>
                        <textarea name="attr_fortitude_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{fortitude_notes}"></textarea>
                    </div>
                </div>
                <div class="options-reflex">
                    <div class="myrow center">
                        <span class="spacer" data-i18n="ref-u" data-i18n-title="reflex" title="Reflex">REF</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_reflex_base" class="pseudoattr" title="@{reflex_base}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_reflex_ability_mod" class="pseudoattr" title="@{reflex_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_reflex_misc" class="nospin boxed" value="0" title="@{reflex_misc}" /></div>
                    </div>
                    <div class="myrow center labline bottom">
                        <span class="spacer invisible" data-i18n="ref-u" data-i18n-title="reflex" title="Reflex">REF</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="base" data-i18n-title="base-modifier" title="Base Modifier">Base</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_reflex_notes"></span>
                        <textarea name="attr_reflex_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{reflex_notes}"></textarea>
                    </div>
                </div>
                <div class="options-will">
                    <div class="myrow right">
                        <span class="spacer" data-i18n="will-u" data-i18n-title="will" title="Will">WILL</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_will_base" class="pseudoattr" title="@{will_base}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_will_ability_mod" class="pseudoattr" title="@{will_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_will_misc" class="nospin boxed" value="0" title="@{will_misc}" /></div>
                    </div>
                    <div class="myrow right labline bottom">
                        <span class="spacer invisible" data-i18n="will-u" data-i18n-title="will" title="Will">WILL</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="base" data-i18n-title="base-modifier" title="Base Modifier">Base</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_will_notes"></span>
                        <textarea name="attr_will_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{will_notes}"></textarea>
                    </div>
                </div>
            </div> <!-- END SAVING THROWS -->
            <div class="topspace babs"> <!-- BABS -->
                <input class="options-flag bab" name="attr_options-flag-bab" type="checkbox" value="1" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                <input class="options-flag cmb" name="attr_options-flag-cmb" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow">
                    <div class="blacklabel pnty bab">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="base-attack-bonus">Base Attack Bonus</span>
                    </div>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_bab" title="@{bab}" /></div>
                    <div class="blacklabel pnty cmb">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <button class="myrol big only" type="roll" name="roll_cmb" value="@{whispertype} &{template:pc} {{name=^{combat-maneuver}}} {{type=attack}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20cs20+@{cmb_mod}[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}} {{shownotes=@{rollnotes_attack}}} {{notes=@{cmb_notes}}} {{conditionsflag=[[@{attack_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{cmb_condition_note} @{attack_condition_note}}}"><span data-i18n="cmb-u" data-i18n-title="combat-maneuver-bonus" title="Combat Maneuver Bonus">CMB</span></button>
                        <span class="picto attacks" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                    </div>
                    <div class="boxed greybg">
                        <input type="hidden" name="attr_cmb_bonus" class="attr-flag" value="0" />
                        <span name="attr_cmb_mod" class="pseudoattr" title="@{cmb_mod}"></span>
                    </div>
                    <div class="boxed">
                        <input type="number" name="attr_cmb_bonus" class="nospin boxed" value="0" title="@{cmb_bonus}" />
                    </div>
                </div>
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 340px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <div class="options-bab">
                    <div class="autoex">
                        <span name="attr_bab_notes"></span>
                        <textarea name="attr_bab_notes" spellcheck="false" data-i18n-placeholder="bab-notes" placeholder="BAB Notes" title="@{bab_notes}"></textarea>
                    </div>
                </div>
                <div class="options-cmb">
                    <div class="myrow right">
                        <span class="spacer" data-i18n="cmb-u" data-i18n-bonus="combat-maneuver-bonus" title="Combat Maneuver Bonus">CMB</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_bab" class="pseudoattr" title="@{bab}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_cmb_ability_mod" class="pseudoattr" title="@{cmb_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_cmb_size" class="pseudoattr" title="@{cmb_size}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_cmb_misc" class="nospin boxed" value="0" title="@{cmb_misc}" /></div>
                    </div>
                    <div class="myrow right labline bottom">
                        <span class="spacer invisible" data-i18n="cmb-u" data-i18n-bonus="combat-maneuver-bonus" title="Combat Maneuver Bonus">CMB</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="bab-u" data-i18n-title="base-attack-bonus" title="Base Attack Bonus">BAB</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="size" data-i18n-title="size-modifier" title="Size Modifier">Size</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_cmb_notes"></span>
                        <textarea name="attr_cmb_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{cmb_notes}"></textarea>
                    </div>
                </div>
            </div> <!-- END BABS -->
            <div class="attackmods"> <!-- ATTACK MODS (MELEE RANGED) -->
                <input class="options-flag melee" name="attr_options-flag-melee" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <input class="options-flag ranged" name="attr_options-flag-ranged" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow">
                    <div class="blacklabel pnty melee">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <button class="myrol big only" type="roll" name="roll_melee" data-i18n-title="basic-melee-attack-roll" title="Basic Melee Attack Roll" value="@{whispertype} &{template:pc} {{name=^{melee}}} {{type=attack}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20cs20+@{melee_mod}[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}} {{shownotes=@{rollnotes_attack}}} {{notes=@{melee_notes}}} {{conditionsflag=[[@{attack_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{attack_condition_note}}}"><span data-i18n="melee">Melee</span></button>
                        <span class="picto attacks" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                    </div>
                    <div class="boxed greybg"><input type="hidden" name="attr_melee_bonus" class="attr-flag" value="0" /><span name="attr_melee_mod" class="pseudoattr" title="@{melee_mod}"></span></div>
                    <div class="boxed"><input type="number" name="attr_melee_bonus" class="nospin boxed" value="0" title="@{melee_bonus}" /></div>
                    <div class="blacklabel pnty ranged">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <button class="myrol big only" type="roll" name="roll_ranged" data-i18n-title="basic-ranged-attack-roll" title="Basic Ranged Attack Roll" value="@{whispertype} &{template:pc} {{name=^{ranged}}} {{type=attack}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20cs20+@{ranged_mod}[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}} {{shownotes=@{rollnotes_attack}}} {{notes=@{ranged_notes}}} {{conditionsflag=[[@{attack_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{attack_condition_note}}}"><span data-i18n="ranged">Ranged</span></button>
                        <span class="picto attacks" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                    </div>
                    <div class="boxed greybg"><input type="hidden" name="attr_ranged_bonus" class="attr-flag" value="0" /><span name="attr_ranged_mod" class="pseudoattr" title="@{ranged_mod}"></span></div>
                    <div class="boxed"><input type="number" name="attr_ranged_bonus" class="nospin boxed" value="0" title="@{ranged_bonus}" /></div>
                </div>
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 125px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    <span class="lab" style="margin-left: 128px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <div class="options-melee">
                    <div class="myrow">
                        <span class="spacer" data-i18n="melee">Melee</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_bab" class="pseudoattr" title="@{bab}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_melee_ability_mod" class="pseudoattr" title="@{melee_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_bab_size" class="pseudoattr" title="@{bab_size}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_melee_misc" class="nospin boxed" value="0" title="@{melee_misc}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="spacer invisible" data-i18n="melee">Melee</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="bab-u" data-i18n-title="base-attack-bonus" title="Base Attack Bonus">BAB</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="size" data-i18n-title="size-modifier" title="Size Modifier">Size</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_melee_notes"></span>
                        <textarea name="attr_melee_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{melee_notes}"></textarea>
                    </div>
                </div>
                <div class="options-ranged">
                    <div class="myrow right">
                        <span class="spacer" data-i18n="ranged">Ranged</span>
                        <span class="spacer">=</span> <div class="boxed greybg"><span name="attr_bab" class="pseudoattr" title="@{bab}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_ranged_ability_mod" class="pseudoattr" title="@{ranged_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_bab_size" class="pseudoattr" title="@{bab_size}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_ranged_misc" class="nospin boxed" value="0" title="@{ranged_misc}" /></div>
                    </div>
                    <div class="myrow right labline bottom">
                        <span class="spacer invisible" data-i18n="ranged">Ranged</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="bab-u" data-i18n-title="base-attack-bonus" title="Base Attack Bonus">BAB</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="size" data-i18n-title="size-modifier" title="Size Modifier">Size</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_ranged_notes"></span>
                        <textarea name="attr_ranged_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{ranged_notes}"></textarea>
                    </div>
                </div>
            </div>  <!-- END ATTACK MODS (MELEE RANGED) -->
            <div class="defenses"> <!-- DEFENSES -->
                <input class="options-flag cmd" name="attr_options-flag-cmd" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <input class="options-flag sr" name="attr_options-flag-sr" type="checkbox" value="1" data-i18n-title="show-hide-notes" title="Show/hide notes"><span>y</span>
                <div class="myrow">
                    <div class="blacklabel pnty cmd">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="cmd-u" data-i18n-bonus="combat-maneuver-defense" title="Combat Maneuver Defense">CMD</span>
                    </div>
                    <input type="hidden" name="attr_cmd_condition" value="0" class="redbrd" />
                    <div class="boxed greybg redbrd">
                        <input type="hidden" name="attr_cmd_bonus" class="attr-flag" value="0" />
                        <span name="attr_cmd_mod" class="pseudoattr" title="@{cmd_mod}"></span>
                    </div>
                    <div class="boxed"><input type="number" name="attr_cmd_bonus" class="nospin boxed" value="0" title="@{cmd_bonus}" /></div>
                    <div class="blacklabel pnty sr">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="spell-resistance">Spell Resistance</span>
                    </div>
                    <div class="boxed"><input type="number" name="attr_sr" class="nospin boxed" value="0" title="@{sr}" /></div>
                </div>
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 86px;" data-i18n="total" data-i18n-title="total" title="Total">Total</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <div class="options-cmd">
                    <div class="myrow">
                        <span class="spacer">=</span> <span class="spacer">10</span>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_bab" class="pseudoattr" title="@{bab}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_strength_mod" class="pseudoattr" title="@{strength_mod}"></span></div>
                        <span class="spacer">+</span> <input type="hidden" name="attr_ac_condition_nobonus" value="0" class="redbrd" /><div class="boxed greybg redbrd"><span name="attr_ac_ability_mod" class="pseudoattr" title="@{ac_ability_mod}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_cmb_size" class="pseudoattr" title="@{cmb_size}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_cmd_condition" class="pseudoattr redtxt" title="@{cmd_condition}"></span></div>
                        <span class="spacer">+</span> <div class="boxed"><input type="number" name="attr_cmd_misc" class="nospin boxed" value="0" title="@{cmd_misc}" /></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="spacer" style="margin-left: 30px;"></span> <span class="lab" data-i18n="bab-u" data-i18n-title="base-attack-bonus" title="Base Attack Bonus">BAB</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="str-u" data-i18n-title="strength-modifier" title="Strength Modifier">STR</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="size" data-i18n-title="size-modifier" title="Size Modifier">Size</span>
                        <span class="lab margindent" data-i18n="condition">Condition</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    </div>
                    <div class="myrow">
                        <span class="spacer margindent">+</span> <div class="boxed greybg"><span name="attr_ac_deflection_bonus" class="pseudoattr" title="@{ac_deflection_bonus}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_ac_deflection" class="pseudoattr" title="@{ac_deflection}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_ac_dodge_bonus" class="pseudoattr" title="@{ac_dodge_bonus}"></span></div>
                        <span class="spacer">+</span> <div class="boxed greybg"><span name="attr_ac_dodge" class="pseudoattr" title="@{ac_dodge}"></span></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="spacer margindent"></span> <span class="lab" data-i18n="deflection" data-i18n-title="deflection-from-acitems" title="Deflection from AC Items">Deflection</span>
                        <span class="lab margindent" data-i18n="mod" data-i18n-title="deflection-modifier" title="Deflection Modifier">Mod</span>
                        <span class="spacer"></span> <span class="lab" data-i18n="dodge" data-i18n-title="dodge-from-acitems" title="Dodge from AC Items">Dodge</span>
                        <span class="lab margindent" data-i18n="mod" data-i18n-title="dodge-modifier" title="Dodge Modifier">Mod</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_cmd_notes"></span>
                        <textarea name="attr_cmd_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{cmd_notes}"></textarea>
                    </div>
                </div>
                <div class="options-sr">
                    <div class="autoex">
                        <span name="attr_sr_snotes"></span>
                        <textarea name="attr_sr_notes" spellcheck="false" data-i18n-placeholder="sr-notes" placeholder="SR Notes" title="@{sr_notes}"></textarea>
                    </div>
                </div>
            </div> <!-- END DEFENSES -->
            <div class="topspace attacks"> <!-- WEAPONS / ATTACKS -->
                <div class="blacklabel right">
                    <span class="picto attacks" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only weapon-title" data-i18n="weapons-attacks">Weapons / Attacks</span>
                    <span class="med only atk-title" data-i18n="atk-u" >ATK</span>
                    <span class="med only damage-title" data-i18n="dmg-u" >DMG</span>
                    <span class="med only ammo-title" data-i18n="ammo" >Ammo</span>
                </div>
                <div class="bordered titled inbox">
                    <div class="myrow"> <!-- REPEATING ATTACK -->
                        <fieldset class="repeating_attacks">
                            <div class="attack right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <div class="weapon">
                                        <button class="myrol" style="width: 100%;" type="roll" name="roll_fullattack" data-i18n-title="full-attack-damage-roll" title="Full Attack & Damage roll" value="@{rollbase}"><span class="pseudoattr greybg underlined" style="width: 100%;" name="attr_atkname"></span></button>
                                    </div>
                                    <div class="atk">
                                        <div class="greybg underlined center">
                                            <button class="myrol" type="roll" name="roll_attack1" data-i18n-title="attack-roll-1" title="Attack roll #1" value="@{rollbase_atk}"><span class="pseudoattr" name="attr_atkbonusdisplay"></span></button>
                                            <button class="myrol" type="roll" name="roll_attack2" data-i18n-title="attack-roll-2" title="Attack roll #2" value="@{rollbase_atk1}"><span class="pseudoattr" name="attr_atkbonusdisplay1"></span></button>
                                            <button class="myrol" type="roll" name="roll_attack3" data-i18n-title="attack-roll-3" title="Attack roll #3" value="@{rollbase_atk2}"><span class="pseudoattr" name="attr_atkbonusdisplay2"></span></button>
                                            <button class="myrol" type="roll" name="roll_attack4" data-i18n-title="attack-roll-4" title="Attack roll #4" value="@{rollbase_atk3}"><span class="pseudoattr" name="attr_atkbonusdisplay3"></span></button>
                                        </div>
                                        <span class="pseudoattr vs block" name="attr_atkdisplay"></span>
                                    </div>
                                    <div class="damage">
                                        <div class="greybg underlined center"><button class="myrol" type="roll" name="roll_damage" data-i18n-title="damage-roll" title="Damage roll" value="@{rollbase_dmg}"><span class="pseudoattr" name="attr_atkdmgdisplay"></span></button></div>
                                        <div class="greybg underlined center"><button class="myrol" type="roll" name="roll_damage2" data-i18n-title="damage-roll" title="Damage roll" value="@{rollbase_dmg}"><span class="pseudoattr" name="attr_atkdmgdisplay2"></span></button></div>
                                    </div>
                                    <input type="number" class="underlined ammo" name="attr_atkammo" value="0" title="@{repeating_attacks_$id_atkammo}" />
                                </div>
                                <div class="options right">
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span> <input type="text" name="attr_atkname" accept="Name" class="underlined name" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_attacks_$id_atkname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" /><button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl" data-i18n="category:">Category:</span> <input type="text" name="attr_category" accept="Weapon Category" class="underlined dmgbase" spellcheck="false" title="@{repeating_attacks_$id_category}" />
                                        <span class="lbl margindent" data-i18n="type:">Type:</span> <input type="text" name="attr_type" accept="Weapon Type" class="underlined dmgbase" spellcheck="false" title="@{repeating_attacks_$id_type}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_atkflag" value="{{attack=1}}" title="@{repeating_attacks_$id_atkflag}" checked="checked" /><span></span>
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_atktype" title="@{repeating_attacks_$id_atktype}">
                                            <option value="melee" selected="selected" data-i18n="melee">Melee</option>
                                            <option value="ranged" data-i18n="ranged">Ranged</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="bab" data-i18n="bab-full">BAB Full</option>
                                            <option value="bab_max" data-i18n="bab-max">BAB Max</option>
                                            <option value="fob" data-i18n="fob">Flurry of Blows</option>
                                            <option value="0">-</option>
                                        </select>
                                        <span class="lbl">+</span> <select class="underlined" name="attr_atktype2" title="@{repeating_attacks_$id_atktype2}">
                                            <option value="0" selected="selected">-</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                        </select>
                                        <span class="lbl">+</span> <input type="text" class="underlined dmgbase" name="attr_atkmod" value="0" spellcheck="false" title="@{repeating_attacks_$id_atkmod}" />
                                        <span class="lbl" data-i18n="vs">vs</span> <select class="underlined vs" name="attr_atkvs" title="@{repeating_attacks_$id_atkvs}">
                                            <option value="ac" selected="selected" data-i18n="ac-u">AC</option>
                                            <option value="touch" data-i18n="touch">Touch</option>
                                            <option value="flatfooted" data-i18n="flat-footed">Flat-footed</option>
                                            <option value="fftouch" data-i18n="ff-touch">FF Touch</option>
                                            <option value="cmd" data-i18n="cmd-u">CMD</option>
                                            <option value="cmb" data-i18n="cmb-opposed">CMB (opposed)</option>
                                            <option value="fortitude" data-i18n="fortitude">Fortitude</option>
                                            <option value="reflex" data-i18n="reflex">Reflex</option>
                                            <option value="will" data-i18n="will">Will</option>
                                            <option value="other" data-i18n="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span> <input type="hidden" name="attr_compendium_critical_range" accept="Critical Range" value="" />
                                        <input type="number" class="nospin underlined" name="attr_atkcritrange" value="20" title="@{repeating_attacks_$id_atkcritrange}" />
                                        <span class="lbl margindent" data-i18n="range:">Range:</span> <input type="text" name="attr_atkrange" accept="Range" class="underlined medium" spellcheck="false" data-i18n-placeholder="range-place" placeholder="10 feet" title="@{repeating_attacks_$id_atkrange}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_dmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_attacks_$id_dmgflag}" checked="checked" /><span></span>
                                        <input type="hidden" name="attr_compendium_dmg_medium" accept="Damage (Medium)" value="" />
                                        <input type="hidden" name="attr_compendium_dmg_small" accept="Damage (Small)" value="" />
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span> <input type="text" name="attr_dmgbase" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_attacks_$id_dmgbase}" />
                                        <span class="lbl">+</span> <select class="underlined dmg" name="attr_dmgattr" title="@{repeating_attacks_$id_dmgattr}">
                                            <option value="strength" selected="selected" data-i18n="str-u">STR</option>
                                            <option value="strength_oneandahalf" data-i18n="str-two-handed">STR (Two-Handed)</option>
                                            <option value="strength_half" data-i18n="str-off-hand">STR (Off-Hand)</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="dexterity_oneandahalf" data-i18n="dex-two-handed">DEX (Two-Handed)</option>
                                            <option value="dexterity_half" data-i18n="dex-off-hand">DEX (Off-Hand)</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0">-</option>
                                        </select>
                                        <span class="lbl">+</span> <input type="text" name="attr_dmgmod" class="underlined dmgbase" spellcheck="false" placeholder="0" title="@{repeating_attacks_$id_dmgmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl" data-i18n="type:">Type:</span> <input type="text" name="attr_dmgtype" accept="Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="slashing" placeholder="Slashing" title="@{repeating_attacks_$id_dmgtype}" />
                                        <input type="hidden" name="attr_compendium_critical_damage" accept="Critical Damage" value="" />
                                        <span class="lbl margindent" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span> <input type="number" class="nospin underlined" name="attr_dmgcritmulti" value="2" title="@{repeating_attacks_$id_dmgcritmulti}" />
                                    </div>
                                    <div class="myrow padindent"><span class="lbl" data-i18n="bonus-dice-no-crit:">Bonus dice (no crit):</span> <input type="text" name="attr_dmgbonusdice" value="" class="underlined dmgbase" spellcheck="false" title="@{repeating_attacks_$id_dmgbonusdice}" /></div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_dmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_attacks_$id_dmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span> <input type="text" name="attr_dmg2base" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_attacks_$id_dmg2base}" />
                                        <span class="lbl">+</span> <select class="underlined dmg" name="attr_dmg2attr" title="@{repeating_attacks_$id_dmg2attr}">
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="strength_oneandahalf" data-i18n="str-two-handed">STR (Two-Handed)</option>
                                            <option value="strength_half" data-i18n="str-off-hand">STR (Off-Hand)</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="dexterity_oneandahalf" data-i18n="dex-two-handed">DEX (Two-Handed)</option>
                                            <option value="dexterity_half" data-i18n="dex-off-hand">DEX (Off-Hand)</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span> <input type="text" name="attr_dmg2mod" class="underlined dmgbase" spellcheck="false" placeholder="0" title="@{repeating_attacks_$id_dmg2mod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl" data-i18n="type:">Type:</span> <input type="text" name="attr_dmg2type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_attacks_$id_dmg2type}" />
                                        <span class="lbl margindent" data-i18n="critical-multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Critical Multiplier:</span> <input type="number" class="nospin underlined" name="attr_dmg2critmulti" value="1" title="@{repeating_attacks_$id_dmg2critmulti}" />
                                    </div>
                                    <div class="myrow padindent"><span class="lbl" data-i18n="bonus-dice-no-crit:">Bonus dice (no crit):</span> <input type="text" name="attr_dmg2bonusdice" value="" class="underlined dmgbase" spellcheck="false" title="@{repeating_attacks_$id_dmg2bonusdice}" /></div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}" title="@{repeating_attacks_$id_descflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_atkdesc"></span>
                                            <textarea name="attr_atkdesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_attacks_$id_atkdesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_attacks_$id_notes}"></textarea>
                                    </div>
                                </div>
                                <input type="hidden" name="attr_rollbase" /><input type="hidden" name="attr_rollbase_atk" /><input type="hidden" name="attr_rollbase_atk1" /><input type="hidden" name="attr_rollbase_atk2" /><input type="hidden" name="attr_rollbase_atk3" /><input type="hidden" name="attr_rollbase_dmg" />
                            </div>
                        </fieldset>
                    </div> <!-- END REPEATING ATTACK -->
                </div>
            </div> <!-- END ATTACKS -->
            <div class="topspace speeds"> <!-- SPEEDS -->
                <input class="options-flag" name="attr_options-flag-speed" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow"> <!-- LAND SPEED -->
                    <div class="blacklabel sqr land"><span class="big" data-i18n="speed">Speed</span></div>
                    <input type="hidden" name="attr_speed_condition" value="0" class="redbrd" />
                    <div class="boxed greybg redbrd">
                        <input type="hidden" name="attr_speed_bonus" class="attr-flag" value="0" />
                        <span name="attr_speed" class="pseudoattr" title="@{speed}"></span>
                    </div>
                    <div class="boxed"><input type="number" name="attr_speed_bonus" class="nospin boxed" value="0" title="@{speed_bonus}" /></div>
                    <input type="hidden" name="attr_speed_condition_norun" value="0" class="redbrd" />
                    <div class="boxed greybg margindent redbrd">
                        <input type="hidden" name="attr_speed_bonus" class="attr-flag" value="0" />
                        <span name="attr_speed_run" class="pseudoattr" title="@{speed_run}"></span>
                    </div>
                    <div class="boxed greybg"><input type="hidden" name="attr_speed_bonus" class="attr-flag" value="0" /><span name="attr_speed_swim" class="pseudoattr" title="@{speed_swim}"></span></div>
                    <div class="boxed greybg"><input type="hidden" name="attr_speed_bonus" class="attr-flag" value="0" /><span name="attr_speed_climb" class="pseudoattr" title="@{speed_climb}"></span></div>
                    <div class="boxed margindent"><input type="number" name="attr_speed_fly" class="nospin boxed" value="0" title="@{speed_fly}" /></div>
                    <div class="boxed"><input type="number" name="attr_speed_other" class="nospin boxed" value="0" title="@{speed_other}" /></div>
                </div> <!-- END LAND SPEED -->
                <div class="myrow labline bottom">
                    <span class="lab" style="margin-left: 73px;" data-i18n="land" data-i18n-title="land" title="Land">Land</span>
                    <span class="lab" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                    <span class="lab margindent" data-i18n="run" data-i18n-title="run" title="Run">Run</span>
                    <span class="lab" data-i18n="swim" data-i18n-title="swim" title="Swim">Swim</span>
                    <span class="lab" data-i18n="climb" data-i18n-title="climb" title="Climb">Climb</span>
                    <span class="lab margindent" data-i18n="fly" data-i18n-title="fly" title="Fly">Fly</span>
                    <span class="lab" data-i18n="other" data-i18n-title="other" title="Other">Other</span>
                </div>
                <div class="options">
                    <div class="myrow">
                        <div class="boxed greybg"><span name="attr_speed_base" class="pseudoattr" title="@{speed_base}"></span></div>
                        <span class="lab">= Min(</span> <div class="boxed greybg"><span name="attr_speed_character" class="pseudoattr" title="@{speed_character}"></span></div>
                        <div class="boxed greybg"><span name="attr_speed_armor" class="pseudoattr" title="@{speed_armor}"></span></div>
                        <div class="boxed greybg"><span name="attr_speed_encumbrance" class="pseudoattr" title="@{speed_encumbrance}"></span></div>
                        <span class="lbl">)</span>
                        <div class="boxed greybg margindent"><span class="pseudoattr" title="@{speed_run_factor}">x<span name="attr_speed_run_factor"></span></span></div>
                        <span class="lab">= Min(</span>
                        <div class="boxed greybg"><span class="pseudoattr" title="@{armor_run_factor}">x<span name="attr_armor_run_factor"></span></span></div>
                        <div class="boxed greybg"><span class="pseudoattr" title="@{encumbrance_run_factor}">x<span name="attr_encumbrance_run_factor"></span></span></div>
                        <span class="lbl">)</span>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="lab" data-i18n="speed" data-i18n-title="speed" title="Speed">Speed</span>
                        <span class="lab">&nbsp;</span>
                        <span class="lab" data-i18n="base" title="Race + Class(es)">Base</span>
                        <span class="lab" data-i18n="armor" data-i18n-title="armor" title="Armor">Armor</span>
                        <span class="lab" data-i18n="load" data-i18n-title="load" title="Load">Load</span>
                        <span class="lbl">&nbsp;</span>
                        <span class="lab margindent" data-i18n="run" data-i18n-title="run" title="Run">Run</span>
                        <span class="lab">&nbsp;</span>
                        <span class="lab" data-i18n="armor" data-i18n-title="armor" title="Armor">Armor</span>
                        <span class="lab" data-i18n="load" data-i18n-title="load" title="Load">Load</span>
                    </div>
                    <div class="autoex">
                        <span name="attr_speed_notes"></span>
                        <textarea name="attr_speed_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{speed_notes}"></textarea>
                    </div>
                </div>
            </div> <!-- END SPEEDS -->
            <div class="topspace myrow center languages"> <!-- SENSES -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <button class="myrol big" type="roll" name="roll_senses" value="@{whispertype} &{template:pc} {{smallname=^{senses}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{descflag=1}} {{desc=@{senses}}}"><span data-i18n="senses">Senses</span></button>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="autoex">
                        <span name="attr_senses"></span>
                        <textarea name="attr_senses" spellcheck="false" data-i18n-placeholder="senses" placeholder="Senses" title="@{senses}"></textarea>
                    </div>
                </div>
            </div> <!-- END LANGUAGES -->
            <div class="topspace myrow center languages"> <!-- LANGUAGES -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big" data-i18n="languages">Languages</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="autoex">
                        <span name="attr_languages"></span>
                        <textarea name="attr_languages" spellcheck="false" data-i18n-placeholder="languages" placeholder="Languages" title="@{languages}"></textarea>
                    </div>
                </div>
            </div> <!-- END LANGUAGES -->
        </div>  <!-- END tab1 col1 -->
        <div class="colhalf"> <!-- tab1 col2 -->
            <div class="myrow center skills"> <!-- SKILLS -->
                <input type="hidden" name="attr_skill_check_penalty" value="0" />
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big" data-i18n="skills">Skills</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    <input type="hidden" name="attr_skill_condition" value="0" class="condition-flag" />
                    <span class="picto" data-i18n-title="condition-to-roll" title="Condition(s) applied to the roll">Y</span>
                </div>
                <div class="myrow labline right top">
                    <span class="lab class" data-i18n="c.-u" data-i18n-title="class-skill" title="Class Skill">C.</span>
                    <span class="lab name" data-i18n="skill-names" data-i18n-title="skill-names" title="Skill names">Skill names</span>
                    <span class="lab total" data-i18n="total" data-i18n-title="total-bonus" title="Total Bonus">Total</span>
                    <span class="lab ability" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                    <span class="lab ranks" data-i18n="ranks" data-i18n-title="ranks" title="Ranks">Ranks</span>
                    <span class="lab misc" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                    <span class="lab temp" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span>
                </div>
                <div data-i18n-list="skills-list"> <!-- Skill sorting -->
                    <div class="myrow skill" data-i18n-list-item="acrobatics"> <!-- ACROBATICS -->
                        <input type="hidden" name="attr_acrobatics_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-acrobatics" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_acrobatics_classkill" value="1" title="@{acrobatics_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_acrobatics" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{acrobatics}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{acrobatics}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{acrobatics_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="acrobatics">Acrobatics</span></button>
                                <input type="hidden" name="attr_acrobatics_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_acrobatics" title="@{acrobatics}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_acrobatics_ability_mod" title="@{acrobatics_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_acrobatics_ranks" class="nospin number underlined" value="0" title="@{acrobatics_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_acrobatics_misc" class="nospin number underlined" value="0" title="@{acrobatics_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_acrobatics_bonus" class="nospin number underlined" value="0" title="@{acrobatics_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_acrobatics_ability" title="@{acrobatics_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_acrobatics_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_acrobatics_armor_penalty" value="1" title="@{acrobatics_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_acrobatics_notes"></span>
                                    <textarea name="attr_acrobatics_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{acrobatics_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END ACROBATICS -->
                    <div class="myrow skill" data-i18n-list-item="appraise"> <!-- APPRAISE -->
                        <input type="hidden" name="attr_appraise_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-appraise" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_appraise_classkill" value="1" title="@{appraise_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_appraise" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{appraise}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{appraise}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{appraise_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="appraise">Appraise</span></button>
                                <input type="hidden" name="attr_appraise_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_appraise" title="@{appraise}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_appraise_ability_mod" title="@{appraise_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_appraise_ranks" class="nospin number underlined" value="0" title="@{appraise_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_appraise_misc" class="nospin number underlined" value="0" title="@{appraise_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_appraise_bonus" class="nospin number underlined" value="0" title="@{appraise_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_appraise_ability" title="@{appraise_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_appraise_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_appraise_armor_penalty" value="1" title="@{appraise_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_appraise_notes"></span>
                                    <textarea name="attr_appraise_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{appraise_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END APPRAISE -->
                    <div class="myrow skill" data-i18n-list-item="bluff"> <!-- bluff -->
                        <input type="hidden" name="attr_bluff_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-bluff" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_bluff_classkill" value="1" title="@{bluff_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_bluff" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{bluff}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{bluff}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{bluff_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="bluff">Bluff</span></button>
                                <input type="hidden" name="attr_bluff_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_bluff" title="@{bluff}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_bluff_ability_mod" title="@{bluff_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_bluff_ranks" class="nospin number underlined" value="0" title="@{bluff_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_bluff_misc" class="nospin number underlined" value="0" title="@{bluff_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_bluff_bonus" class="nospin number underlined" value="0" title="@{bluff_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_bluff_ability" title="@{bluff_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_bluff_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_bluff_armor_penalty" value="1" title="@{bluff_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_bluff_notes"></span>
                                    <textarea name="attr_bluff_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{bluff_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END bluff -->
                    <div class="myrow skill" data-i18n-list-item="climb"> <!-- climb -->
                        <input type="hidden" name="attr_climb_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-climb" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_climb_classkill" value="1" title="@{climb_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_climb" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{climb}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{climb}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{climb_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="climb">Climb</span></button>
                                <input type="hidden" name="attr_climb_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_climb" title="@{climb}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_climb_ability_mod" title="@{climb_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_climb_ranks" class="nospin number underlined" value="0" title="@{climb_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_climb_misc" class="nospin number underlined" value="0" title="@{climb_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_climb_bonus" class="nospin number underlined" value="0" title="@{climb_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_climb_ability" title="@{climb_ability}">
                                        <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_climb_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_climb_armor_penalty" value="1" title="@{climb_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_climb_notes"></span>
                                    <textarea name="attr_climb_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{climb_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END climb -->
                    <div class="myrow skill" data-i18n-list-item="craft"> <!-- craft -->
                        <input type="hidden" name="attr_craft_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-craft" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_craft_classkill" value="1" title="@{craft_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_craft" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{craft} (@{craft_name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{craft}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{craft_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl craft" data-i18n="craft">Craft</span></button>
                                <input type="text" name="attr_craft_name" class="craft underlined" data-i18n-placeholder="group" placeholder="Group" title="@{craft_name}" />
                                <input type="hidden" name="attr_craft_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_craft" title="@{craft}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_craft_ability_mod" title="@{craft_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_craft_ranks" class="nospin number underlined" value="0" title="@{craft_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_craft_misc" class="nospin number underlined" value="0" title="@{craft_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_craft_bonus" class="nospin number underlined" value="0" title="@{craft_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_craft_ability" title="@{craft_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_craft_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_craft_armor_penalty" value="1" title="@{craft_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_craft_notes"></span>
                                    <textarea name="attr_craft_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{craft_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END craft -->
                    <div data-i18n-list-item="craft-rep">
                        <input type="hidden" name="attr_craft_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <fieldset class="repeating_skillcraft"> <!-- repeating craft -->
                                <div class="myrow skill">
                                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                                    <div class="myrow right">
                                        <input class="pseudocheck" type="checkbox" name="attr_classkill" value="1" title="@{repeating_skillcraft_$id_classkill}" /><span></span>
                                        <button class="myrol" type="roll" name="roll_skill" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{craft} (@{name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{skill}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl craft" data-i18n="craft">Craft</span></button>
                                        <input type="text" name="attr_name" class="craft underlined" data-i18n-placeholder="group" placeholder="Group" title="@{repeating_skillcraft_$id_name}" />
                                        <input type="hidden" name="attr_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_skill" title="@{repeating_skillcraft_$id_skill}"></span>
                                        <input type="hidden" name="attr_skill" />
                                        <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ability_mod" title="@{repeating_skillcraft_$id_ability_mod}"></span>
                                        <span class="lbl">+</span> <input type="number" name="attr_ranks" class="nospin number underlined" value="0" title="@{repeating_skillcraft_$id_ranks}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_misc" class="nospin number underlined" value="0" title="@{repeating_skillcraft_$id_misc}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_bonus" class="nospin number underlined" value="0" title="@{repeating_skillcraft_$id_bonus}" />
                                    </div>
                                    <div class="options">
                                        <div class="myrow">
                                            <span data-i18n="ability">Ability</span>: <select name="attr_ability" title="@{repeating_skillcraft_$id_ability}">
                                                <option value="strength" data-i18n="strength">Strength</option>
                                                <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                                <option value="constitution" data-i18n="constitution">Constitution</option>
                                                <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                                <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                                <option value="charisma" data-i18n="charisma">Charisma</option>
                                            </select>
                                            <input type="hidden" class="skillability" name="attr_ability" /> <div class="skillability">
                                                <span class="spacer"></span>
                                                <input class="pseudocheck" type="checkbox" name="attr_armor_penalty" value="1" title="@{repeating_skillcraft_$id_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                            </div>
                                        </div>
                                        <div class="autoex">
                                            <span name="attr_notes"></span>
                                            <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_skillcraft_$id_notes}"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>  <!-- END repeating craft -->
                        </div>
                    </div>
                    <div class="myrow skill" data-i18n-list-item="diplomacy"> <!-- diplomacy -->
                        <input type="hidden" name="attr_diplomacy_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-diplomacy" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_diplomacy_classkill" value="1" title="@{diplomacy_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_diplomacy" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{diplomacy}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{diplomacy}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{diplomacy_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="diplomacy">Diplomacy</span></button>
                                <input type="hidden" name="attr_diplomacy_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_diplomacy" title="@{diplomacy}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_diplomacy_ability_mod" title="@{diplomacy_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_diplomacy_ranks" class="nospin number underlined" value="0" title="@{diplomacy_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_diplomacy_misc" class="nospin number underlined" value="0" title="@{diplomacy_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_diplomacy_bonus" class="nospin number underlined" value="0" title="@{diplomacy_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_diplomacy_ability" title="@{diplomacy_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_diplomacy_ability" /> <div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_diplomacy_armor_penalty" value="1" title="@{diplomacy_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_diplomacy_notes"></span>
                                    <textarea name="attr_diplomacy_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{diplomacy_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END diplomacy -->
                    <div class="myrow skill" data-i18n-list-item="disable_device"> <!-- disable_device -->
                        <input type="hidden" name="attr_disable_device_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-disable_device" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_disable_device_classkill" value="1" title="@{disable_device_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_disabledevice" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{disable_device}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{disable_device}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{disable_device_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="disable_device">Disable Device*</span></button>
                                <input type="hidden" name="attr_disable_device_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_disable_device" title="@{disable_device}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_disable_device_ability_mod" title="@{disable_device_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_disable_device_ranks" class="nospin number underlined" value="0" title="@{disable_device_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_disable_device_misc" class="nospin number underlined" value="0" title="@{disable_device_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_disable_device_bonus" class="nospin number underlined" value="0" title="@{disable_device_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_disable_device_ability" title="@{disable_device_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_disable_device_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_disable_device_armor_penalty" value="1" title="@{disable_device_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_disable_device_notes"></span>
                                    <textarea name="attr_disable_device_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{disable_device_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END disable_device -->
                    <div class="myrow skill" data-i18n-list-item="disguise"> <!-- disguise -->
                        <input type="hidden" name="attr_disguise_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-disguise" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_disguise_classkill" value="1" title="@{disguise_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_disguise" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{disguise}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{disguise}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{disguise_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="disguise">Disguise</span></button>
                                <input type="hidden" name="attr_disguise_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_disguise" title="@{disguise}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_disguise_ability_mod" title="@{disguise_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_disguise_ranks" class="nospin number underlined" value="0" title="@{disguise_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_disguise_misc" class="nospin number underlined" value="0" title="@{disguise_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_disguise_bonus" class="nospin number underlined" value="0" title="@{disguise_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_disguise_ability" title="@{disguise_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_disguise_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_disguise_armor_penalty" value="1" title="@{disguise_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_disguise_notes"></span>
                                    <textarea name="attr_disguise_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{disguise_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END disguise -->
                    <div class="myrow skill" data-i18n-list-item="escape_artist"> <!-- escape_artist -->
                        <input type="hidden" name="attr_escape_artist_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-escape_artist" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_escape_artist_classkill" value="1" title="@{escape_artist_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_escapeartist" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{escape_artist}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{escape_artist}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{escape_artist_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="escape_artist">Escape Artist</span></button>
                                <input type="hidden" name="attr_escape_artist_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_escape_artist" title="@{escape_artist}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_escape_artist_ability_mod" title="@{escape_artist_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_escape_artist_ranks" class="nospin number underlined" value="0" title="@{escape_artist_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_escape_artist_misc" class="nospin number underlined" value="0" title="@{escape_artist_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_escape_artist_bonus" class="nospin number underlined" value="0" title="@{escape_artist_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_escape_artist_ability" title="@{escape_artist_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_escape_artist_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_escape_artist_armor_penalty" value="1" title="@{escape_artist_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_escape_artist_notes"></span>
                                    <textarea name="attr_escape_artist_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{escape_artist_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END escape_artist -->
                    <div class="myrow skill" data-i18n-list-item="fly"> <!-- fly -->
                        <input type="hidden" name="attr_fly_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-fly" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_fly_classkill" value="1" title="@{fly_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_fly" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{fly}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{fly}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{fly_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="fly">Fly</span></button>
                                <input type="hidden" name="attr_fly_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_fly" title="@{fly}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_fly_ability_mod" title="@{fly_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_fly_ranks" class="nospin number underlined" value="0" title="@{fly_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_fly_misc" class="nospin number underlined" value="0" title="@{fly_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_fly_bonus" class="nospin number underlined" value="0" title="@{fly_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_fly_ability" title="@{fly_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_fly_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_fly_armor_penalty" value="1" title="@{fly_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_fly_notes"></span>
                                    <textarea name="attr_fly_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{fly_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END fly -->
                    <div class="myrow skill" data-i18n-list-item="handle_animal"> <!-- handle_animal -->
                        <input type="hidden" name="attr_handle_animal_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-handle_animal" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_handle_animal_classkill" value="1" title="@{handle_animal_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_handleanimal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{handle_animal}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{handle_animal}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{handle_animal_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="handle_animal">Handle Animal*</span></button>
                                <input type="hidden" name="attr_handle_animal_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_handle_animal" title="@{handle_animal}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_handle_animal_ability_mod" title="@{handle_animal_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_handle_animal_ranks" class="nospin number underlined" value="0" title="@{handle_animal_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_handle_animal_misc" class="nospin number underlined" value="0" title="@{handle_animal_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_handle_animal_bonus" class="nospin number underlined" value="0" title="@{handle_animal_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_handle_animal_ability" title="@{handle_animal_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_handle_animal_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_handle_animal_armor_penalty" value="1" title="@{handle_animal_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_handle_animal_notes"></span>
                                    <textarea name="attr_handle_animal_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{handle_animal_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END handle_animal -->
                    <div class="myrow skill" data-i18n-list-item="heal"> <!-- heal -->
                        <input type="hidden" name="attr_heal_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-heal" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_heal_classkill" value="1" title="@{heal_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_heal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{heal}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{heal}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{heal_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="heal">Heal</span></button>
                                <input type="hidden" name="attr_heal_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_heal" title="@{heal}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_heal_ability_mod" title="@{heal_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_heal_ranks" class="nospin number underlined" value="0" title="@{heal_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_heal_misc" class="nospin number underlined" value="0" title="@{heal_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_heal_bonus" class="nospin number underlined" value="0" title="@{heal_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_heal_ability" title="@{heal_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_heal_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_heal_armor_penalty" value="1" title="@{heal_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_heal_notes"></span>
                                    <textarea name="attr_heal_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{heal_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END heal -->
                    <div class="myrow skill" data-i18n-list-item="intimidate"> <!-- intimidate -->
                        <input type="hidden" name="attr_intimidate_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-intimidate" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_intimidate_classkill" value="1" title="@{intimidate_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_intimidate" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{intimidate}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{intimidate}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{intimidate_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="intimidate">Intimidate</span></button>
                                <input type="hidden" name="attr_intimidate_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_intimidate" title="@{intimidate}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_intimidate_ability_mod" title="@{intimidate_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_intimidate_ranks" class="nospin number underlined" value="0" title="@{intimidate_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_intimidate_misc" class="nospin number underlined" value="0" title="@{intimidate_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_intimidate_bonus" class="nospin number underlined" value="0" title="@{intimidate_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_intimidate_ability" title="@{intimidate_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_intimidate_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_intimidate_armor_penalty" value="1" title="@{intimidate_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_intimidate_notes"></span>
                                    <textarea name="attr_intimidate_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{intimidate_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END intimidate -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_arcana"> <!-- knowledge_arcana -->
                        <input type="hidden" name="attr_knowledge_arcana_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_arcana" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_arcana_classkill" value="1" title="@{knowledge_arcana_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgearcana" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_arcana}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_arcana}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_arcana_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_arcana">Knowledge (Arcana)*</span></button>
                                <input type="hidden" name="attr_knowledge_arcana_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_arcana" title="@{knowledge_arcana}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_arcana_ability_mod" title="@{knowledge_arcana_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_arcana_ranks" class="nospin number underlined" value="0" title="@{knowledge_arcana_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_arcana_misc" class="nospin number underlined" value="0" title="@{knowledge_arcana_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_arcana_bonus" class="nospin number underlined" value="0" title="@{knowledge_arcana_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_arcana_ability" title="@{knowledge_arcana_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_arcana_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_arcana_armor_penalty" value="1" title="@{knowledge_arcana_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_arcana_notes"></span>
                                    <textarea name="attr_knowledge_arcana_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_arcana_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_arcana -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_dungeoneering"> <!-- knowledge_dungeoneering -->
                        <input type="hidden" name="attr_knowledge_dungeoneering_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_dungeoneering" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_dungeoneering_classkill" value="1" title="@{knowledge_dungeoneering_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgedungeoneering" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_dungeoneering}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_dungeoneering}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_dungeoneering_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_dungeoneering">Knowledge (Dungeoneering)*</span></button>
                                <input type="hidden" name="attr_knowledge_dungeoneering_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_dungeoneering" title="@{knowledge_dungeoneering}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_dungeoneering_ability_mod" title="@{knowledge_dungeoneering_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_dungeoneering_ranks" class="nospin number underlined" value="0" title="@{knowledge_dungeoneering_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_dungeoneering_misc" class="nospin number underlined" value="0" title="@{knowledge_dungeoneering_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_dungeoneering_bonus" class="nospin number underlined" value="0" title="@{knowledge_dungeoneering_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_dungeoneering_ability" title="@{knowledge_dungeoneering_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_dungeoneering_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_dungeoneering_armor_penalty" value="1" title="@{knowledge_dungeoneering_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_dungeoneering_notes"></span>
                                    <textarea name="attr_knowledge_dungeoneering_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_dungeoneering_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_dungeoneering -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_engineering"> <!-- knowledge_engineering -->
                        <input type="hidden" name="attr_knowledge_engineering_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_engineering" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_engineering_classkill" value="1" title="@{knowledge_engineering_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgeengineering" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_engineering}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_engineering}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_engineering_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_engineering">Knowledge (Engineering)*</span></button>
                                <input type="hidden" name="attr_knowledge_engineering_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_engineering" title="@{knowledge_engineering}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_engineering_ability_mod" title="@{knowledge_engineering_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_engineering_ranks" class="nospin number underlined" value="0" title="@{knowledge_engineering_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_engineering_misc" class="nospin number underlined" value="0" title="@{knowledge_engineering_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_engineering_bonus" class="nospin number underlined" value="0" title="@{knowledge_engineering_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_engineering_ability" title="@{knowledge_engineering_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_engineering_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_engineering_armor_penalty" value="1" title="@{knowledge_engineering_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_engineering_notes"></span>
                                    <textarea name="attr_knowledge_engineering_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_engineering_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_engineering -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_geography"> <!-- knowledge_geography -->
                        <input type="hidden" name="attr_knowledge_geography_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_geography" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_geography_classkill" value="1" title="@{knowledge_geography_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgegeography" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_geography}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_geography}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_geography_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_geography">Knowledge (Geography)*</span></button>
                                <input type="hidden" name="attr_knowledge_geography_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_geography" title="@{knowledge_geography}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_geography_ability_mod" title="@{knowledge_geography_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_geography_ranks" class="nospin number underlined" value="0" title="@{knowledge_geography_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_geography_misc" class="nospin number underlined" value="0" title="@{knowledge_geography_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_geography_bonus" class="nospin number underlined" value="0" title="@{knowledge_geography_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_geography_ability" title="@{knowledge_geography_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_geography_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_geography_armor_penalty" value="1" title="@{knowledge_geography_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_geography_notes"></span>
                                    <textarea name="attr_knowledge_geography_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_geography_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_geography -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_history"> <!-- knowledge_history -->
                        <input type="hidden" name="attr_knowledge_history_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_history" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_history_classkill" value="1" title="@{knowledge_history_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgehistory" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_history}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_history}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_history_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_history">Knowledge (History)*</span></button>
                                <input type="hidden" name="attr_knowledge_history_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_history" title="@{knowledge_history}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_history_ability_mod" title="@{knowledge_history_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_history_ranks" class="nospin number underlined" value="0" title="@{knowledge_history_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_history_misc" class="nospin number underlined" value="0" title="@{knowledge_history_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_history_bonus" class="nospin number underlined" value="0" title="@{knowledge_history_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_history_ability" title="@{knowledge_history_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_history_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_history_armor_penalty" value="1" title="@{knowledge_history_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_history_notes"></span>
                                    <textarea name="attr_knowledge_history_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_history_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_history -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_local"> <!-- knowledge_local -->
                        <input type="hidden" name="attr_knowledge_local_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_local" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_local_classkill" value="1" title="@{knowledge_local_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgelocal" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_local}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_local}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_local_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_local">Knowledge (Local)*</span></button>
                                <input type="hidden" name="attr_knowledge_local_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_local" title="@{knowledge_local}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_local_ability_mod" title="@{knowledge_local_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_local_ranks" class="nospin number underlined" value="0" title="@{knowledge_local_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_local_misc" class="nospin number underlined" value="0" title="@{knowledge_local_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_local_bonus" class="nospin number underlined" value="0" title="@{knowledge_local_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_local_ability" title="@{knowledge_local_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_local_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_local_armor_penalty" value="1" title="@{knowledge_local_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_local_notes"></span>
                                    <textarea name="attr_knowledge_local_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_local_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_local -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_nature"> <!-- knowledge_nature -->
                        <input type="hidden" name="attr_knowledge_nature_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_nature" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_nature_classkill" value="1" title="@{knowledge_nature_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgenature" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_nature}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_nature}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_nature_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_nature">Knowledge (Nature)*</span></button>
                                <input type="hidden" name="attr_knowledge_nature_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_nature" title="@{knowledge_nature}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_nature_ability_mod" title="@{knowledge_nature_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nature_ranks" class="nospin number underlined" value="0" title="@{knowledge_nature_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nature_misc" class="nospin number underlined" value="0" title="@{knowledge_nature_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nature_bonus" class="nospin number underlined" value="0" title="@{knowledge_nature_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_nature_ability" title="@{knowledge_nature_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_nature_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_nature_armor_penalty" value="1" title="@{knowledge_nature_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_nature_notes"></span>
                                    <textarea name="attr_knowledge_nature_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_nature_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_nature -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_nobility"> <!-- knowledge_nobility -->
                        <input type="hidden" name="attr_knowledge_nobility_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_nobility" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_nobility_classkill" value="1" title="@{knowledge_nobility_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgenobility" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_nobility}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_nobility}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_nobility_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_nobility">Knowledge (Nobility)*</span></button>
                                <input type="hidden" name="attr_knowledge_nobility_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_nobility" title="@{knowledge_nobility}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_nobility_ability_mod" title="@{knowledge_nobility_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nobility_ranks" class="nospin number underlined" value="0" title="@{knowledge_nobility_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nobility_misc" class="nospin number underlined" value="0" title="@{knowledge_nobility_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_nobility_bonus" class="nospin number underlined" value="0" title="@{knowledge_nobility_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_nobility_ability" title="@{knowledge_nobility_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_nobility_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_nobility_armor_penalty" value="1" title="@{knowledge_nobility_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_nobility_notes"></span>
                                    <textarea name="attr_knowledge_nobility_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_nobility_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_nobility -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_planes"> <!-- knowledge_planes -->
                        <input type="hidden" name="attr_knowledge_planes_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_planes" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_planes_classkill" value="1" title="@{knowledge_planes_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgeplanes" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_planes}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_planes}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_planes_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_planes">Knowledge (Planes)*</span></button>
                                <input type="hidden" name="attr_knowledge_planes_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_planes" title="@{knowledge_planes}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_planes_ability_mod" title="@{knowledge_planes_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_planes_ranks" class="nospin number underlined" value="0" title="@{knowledge_planes_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_planes_misc" class="nospin number underlined" value="0" title="@{knowledge_planes_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_planes_bonus" class="nospin number underlined" value="0" title="@{knowledge_planes_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_planes_ability" title="@{knowledge_planes_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_planes_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_planes_armor_penalty" value="1" title="@{knowledge_planes_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_planes_notes"></span>
                                    <textarea name="attr_knowledge_planes_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_planes_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_planes -->
                    <div class="myrow skill" data-i18n-list-item="knowledge_religion"> <!-- knowledge_religion -->
                        <input type="hidden" name="attr_knowledge_religion_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-knowledge_religion" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_knowledge_religion_classkill" value="1" title="@{knowledge_religion_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_knowledgereligion" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge_religion}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{knowledge_religion}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{knowledge_religion_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="knowledge_religion">Knowledge (Religion)*</span></button>
                                <input type="hidden" name="attr_knowledge_religion_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_knowledge_religion" title="@{knowledge_religion}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_knowledge_religion_ability_mod" title="@{knowledge_religion_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_religion_ranks" class="nospin number underlined" value="0" title="@{knowledge_religion_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_religion_misc" class="nospin number underlined" value="0" title="@{knowledge_religion_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_knowledge_religion_bonus" class="nospin number underlined" value="0" title="@{knowledge_religion_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_knowledge_religion_ability" title="@{knowledge_religion_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_knowledge_religion_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_knowledge_religion_armor_penalty" value="1" title="@{knowledge_religion_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_knowledge_religion_notes"></span>
                                    <textarea name="attr_knowledge_religion_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{knowledge_religion_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END knowledge_religion -->
                    <div data-i18n-list-item="knowledge-rep">
                        <input type="hidden" name="attr_knowledge_custom_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <fieldset class="repeating_skillknowledge"> <!-- repeating knowledge -->
                                <div class="myrow skill">
                                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                                    <div class="myrow right">
                                        <input class="pseudocheck" type="checkbox" name="attr_classkill" value="1" title="@{repeating_skillknowledge_$id_classkill}" /><span></span>
                                        <button class="myrol" type="roll" name="roll_skill" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{knowledge} (@{name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{skill}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl knowledge" data-i18n="knowledge">Knowledge</span></button>
                                        <input type="text" name="attr_name" class="knowledge underlined" data-i18n-placeholder="field-of-study" placeholder="Field of study" title="@{repeating_skillknowledge_$id_name}" />
                                        <input type="hidden" name="attr_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_skill" title="@{repeating_skillknowledge_$id_skill}"></span>
                                        <input type="hidden" name="attr_skill" />
                                        <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ability_mod" title="@{repeating_skillknowledge_$id_ability_mod}"></span>
                                        <span class="lbl">+</span> <input type="number" name="attr_ranks" class="nospin number underlined" value="0" title="@{repeating_skillknowledge_$id_ranks}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_misc" class="nospin number underlined" value="0" title="@{repeating_skillknowledge_$id_misc}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_bonus" class="nospin number underlined" value="0" title="@{repeating_skillknowledge_$id_bonus}" />
                                    </div>
                                    <div class="options">
                                        <div class="myrow">
                                            <span data-i18n="ability">Ability</span>: <select name="attr_ability" title="@{repeating_skillknowledge_$id_ability}">
                                                <option value="strength" data-i18n="strength">Strength</option>
                                                <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                                <option value="constitution" data-i18n="constitution">Constitution</option>
                                                <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                                <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                                <option value="charisma" data-i18n="charisma">Charisma</option>
                                            </select>
                                            <input type="hidden" class="skillability" name="attr_ability" /><div class="skillability">
                                                <span class="spacer"></span>
                                                <input class="pseudocheck" type="checkbox" name="attr_armor_penalty" value="1" title="@{repeating_skillknowledge_$id_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                            </div>
                                        </div>
                                        <div class="autoex">
                                            <span name="attr_notes"></span>
                                            <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_skillknowledge_$id_notes}"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>  <!-- END repeating knowledge -->
                        </div>
                    </div>
                    <div class="myrow skill" data-i18n-list-item="linguistics"> <!-- linguistics -->
                        <input type="hidden" name="attr_linguistics_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-linguistics" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_linguistics_classkill" value="1" title="@{linguistics_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_linguistics" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{linguistics}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{linguistics}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{linguistics_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="linguistics">Linguistics*</span></button>
                                <input type="hidden" name="attr_linguistics_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_linguistics" title="@{linguistics}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_linguistics_ability_mod" title="@{linguistics_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_linguistics_ranks" class="nospin number underlined" value="0" title="@{linguistics_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_linguistics_misc" class="nospin number underlined" value="0" title="@{linguistics_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_linguistics_bonus" class="nospin number underlined" value="0" title="@{linguistics_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_linguistics_ability" title="@{linguistics_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_linguistics_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_linguistics_armor_penalty" value="1" title="@{linguistics_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_linguistics_notes"></span>
                                    <textarea name="attr_linguistics_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{linguistics_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END linguistics -->
                    <div class="myrow skill" data-i18n-list-item="perception"> <!-- perception -->
                        <input type="hidden" name="attr_perception_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-perception" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_perception_classkill" value="1" title="@{perception_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_perception" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{perception}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{perception}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{perception_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note} @{perception_condition_note}}}"><span class="lbl name" data-i18n="perception">Perception</span></button>
                                <input type="hidden" name="attr_perception_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_perception" title="@{perception}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_perception_ability_mod" title="@{perception_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_perception_ranks" class="nospin number underlined" value="0" title="@{perception_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_perception_misc" class="nospin number underlined" value="0" title="@{perception_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_perception_bonus" class="nospin number underlined" value="0" title="@{perception_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_perception_ability" title="@{perception_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_perception_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_perception_armor_penalty" value="1" title="@{perception_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_perception_notes"></span>
                                    <textarea name="attr_perception_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{perception_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END perception -->
                    <div class="myrow skill" data-i18n-list-item="perform"> <!-- perform -->
                        <input type="hidden" name="attr_perform_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-perform" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_perform_classkill" value="1" title="@{perform_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_perform" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{perform} (@{perform_name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{perform}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{perform_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl perform" data-i18n="perform">Perform</span></button>
                                <input type="text" name="attr_perform_name" class="perform underlined" data-i18n-placeholder="category" placeholder="Category" title="@{perform_name}" />
                                <input type="hidden" name="attr_perform_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_perform" title="@{perform}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_perform_ability_mod" title="@{perform_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_perform_ranks" class="nospin number underlined" value="0" title="@{perform_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_perform_misc" class="nospin number underlined" value="0" title="@{perform_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_perform_bonus" class="nospin number underlined" value="0" title="@{perform_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_perform_ability" title="@{perform_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_perform_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_perform_armor_penalty" value="1" title="@{perform_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_perform_notes"></span>
                                    <textarea name="attr_perform_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{perform_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END perform -->
                    <div data-i18n-list-item="perform-rep">
                        <input type="hidden" name="attr_perform_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <fieldset class="repeating_skillperform"> <!-- repeating perform -->
                                <div class="myrow skill">
                                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                                    <div class="myrow right">
                                        <input class="pseudocheck" type="checkbox" name="attr_classkill" value="1" title="@{classkill}" /><span></span>
                                        <button class="myrol" type="roll" name="roll_skill" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{perform} (@{name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{skill}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl perform" data-i18n="perform">Perform</span></button>
                                        <input type="text" name="attr_name" class="perform underlined" data-i18n-placeholder="category" placeholder="Category" title="@{repeating_skillperform_$id_name}" />
                                        <input type="hidden" name="attr_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_skill" title="@{repeating_skillperform_$id_skill}"></span>
                                        <input type="hidden" name="attr_skill" />
                                        <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ability_mod" title="@{repeating_skillperform_$id_ability_mod}"></span>
                                        <span class="lbl">+</span> <input type="number" name="attr_ranks" class="nospin number underlined" value="0" title="@{repeating_skillperform_$id_ranks}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_misc" class="nospin number underlined" value="0" title="@{repeating_skillperform_$id_misc}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_bonus" class="nospin number underlined" value="0" title="@{repeating_skillperform_$id_bonus}" />
                                    </div>
                                    <div class="options">
                                        <div class="myrow">
                                            <span data-i18n="ability">Ability</span>: <select name="attr_ability" title="@{repeating_skillperform_$id_ability}">
                                                <option value="strength" data-i18n="strength">Strength</option>
                                                <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                                <option value="constitution" data-i18n="constitution">Constitution</option>
                                                <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                                <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                                <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                            </select>
                                            <input type="hidden" class="skillability" name="attr_ability" /><div class="skillability">
                                                <span class="spacer"></span>
                                                <input class="pseudocheck" type="checkbox" name="attr_armor_penalty" value="1" title="@{repeating_skillperform_$id_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                            </div>
                                        </div>
                                        <div class="autoex">
                                            <span name="attr_notes"></span>
                                            <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_skillperform_$id_notes}"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>  <!-- END repeating perform -->
                        </div>
                    </div>
                    <div class="myrow skill" data-i18n-list-item="profession"> <!-- profession -->
                        <input type="hidden" name="attr_profession_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-profession" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_profession_classkill" value="1" title="@{profession_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_profession" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{profession} (@{profession_name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{profession}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{profession_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl profession" data-i18n="profession">Profession*</span></button>
                                <input type="text" name="attr_profession_name" class="profession underlined" data-i18n-placeholder="job" placeholder="Job" title="@{profession_name}" />
                                <input type="hidden" name="attr_profession_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_profession" title="@{profession}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_profession_ability_mod" title="@{profession_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_profession_ranks" class="nospin number underlined" value="0" title="@{profession_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_profession_misc" class="nospin number underlined" value="0" title="@{profession_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_profession_bonus" class="nospin number underlined" value="0" title="@{profession_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_profession_ability" title="@{profession_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_profession_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_profession_armor_penalty" value="1" title="@{profession_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_profession_notes"></span>
                                    <textarea name="attr_profession_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{profession_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END profession -->
                    <div data-i18n-list-item="profession-rep">
                        <input type="hidden" name="attr_profession_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <fieldset class="repeating_skillprofession"> <!-- repeating profession -->
                                <div class="myrow skill">
                                    <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                                    <div class="myrow right">
                                        <input class="pseudocheck" type="checkbox" name="attr_classkill" value="1" title="@{repeating_skillprofession_$id_classkill}" /><span></span>
                                        <button class="myrol" type="roll" name="roll_skill" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{profession} (@{name})}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{skill}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl profession" data-i18n="profession">Profession</span></button>
                                        <input type="text" name="attr_name" class="profession underlined" data-i18n-placeholder="job" placeholder="Job" title="@{repeating_skillprofession_$id_name}" />
                                        <input type="hidden" name="attr_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_skill" title="@{repeating_skillprofession_$id_skill}"></span>
                                        <input type="hidden" name="attr_skill" />
                                        <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ability_mod" title="@{repeating_skillprofession_$id_ability_mod}"></span>
                                        <span class="lbl">+</span> <input type="number" name="attr_ranks" class="nospin number underlined" value="0" title="@{repeating_skillprofession_$id_ranks}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_misc" class="nospin number underlined" value="0" title="@{repeating_skillprofession_$id_misc}" />
                                        <span class="lbl">+</span> <input type="number" name="attr_bonus" class="nospin number underlined" value="0" title="@{repeating_skillprofession_$id_bonus}" />
                                    </div>
                                    <div class="options">
                                        <div class="myrow">
                                            <span data-i18n="ability">Ability</span>: <select name="attr_ability" title="@{repeating_skillprofession_$id_ability}">
                                                <option value="strength" data-i18n="strength">Strength</option>
                                                <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                                <option value="constitution" data-i18n="constitution">Constitution</option>
                                                <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                                <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                                <option value="charisma" data-i18n="charisma">Charisma</option>
                                            </select>
                                            <input type="hidden" class="skillability" name="attr_ability" /><div class="skillability">
                                                <span class="spacer"></span>
                                                <input class="pseudocheck" type="checkbox" name="attr_armor_penalty" value="1" title="@{repeating_skillprofession_$id_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                            </div>
                                        </div>
                                        <div class="autoex">
                                            <span name="attr_notes"></span>
                                            <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_skillprofession_$id_notes}"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>  <!-- END repeating profession -->
                        </div>
                    </div>
                    <div class="myrow skill" data-i18n-list-item="ride"> <!-- ride -->
                        <input type="hidden" name="attr_ride_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-ride" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_ride_classkill" value="1" title="@{ride_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_ride" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{ride}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{ride}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{ride_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="ride">Ride</span></button>
                                <input type="hidden" name="attr_ride_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_ride" title="@{ride}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ride_ability_mod" title="@{ride_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_ride_ranks" class="nospin number underlined" value="0" title="@{ride_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_ride_misc" class="nospin number underlined" value="0" title="@{ride_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_ride_bonus" class="nospin number underlined" value="0" title="@{ride_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_ride_ability" title="@{ride_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_ride_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_ride_armor_penalty" value="1" title="@{ride_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_ride_notes"></span>
                                    <textarea name="attr_ride_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{ride_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END ride -->
                    <div class="myrow skill" data-i18n-list-item="sense_motive"> <!-- sense_motive -->
                        <input type="hidden" name="attr_sense_motive_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-sense_motive" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_sense_motive_classkill" value="1" title="@{sense_motive_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_sensemotive" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{sense_motive}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{sense_motive}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{sense_motive_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="sense_motive">Sense Motive</span></button>
                                <input type="hidden" name="attr_sense_motive_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_sense_motive" title="@{sense_motive}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_sense_motive_ability_mod" title="@{sense_motive_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_sense_motive_ranks" class="nospin number underlined" value="0" title="@{sense_motive_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_sense_motive_misc" class="nospin number underlined" value="0" title="@{sense_motive_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_sense_motive_bonus" class="nospin number underlined" value="0" title="@{sense_motive_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_sense_motive_ability" title="@{sense_motive_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_sense_motive_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_sense_motive_armor_penalty" value="1" title="@{sense_motive_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_sense_motive_notes"></span>
                                    <textarea name="attr_sense_motive_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{sense_motive_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END sense_motive -->
                    <div class="myrow skill" data-i18n-list-item="sleight_of_hand"> <!-- sleight_of_hand -->
                        <input type="hidden" name="attr_sleight_of_hand_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-sleight_of_hand" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_sleight_of_hand_classkill" value="1" title="@{sleight_of_hand_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_sleightofhand" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{sleight_of_hand}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{sleight_of_hand}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{sleight_of_hand_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="sleight_of_hand">Sleight of Hand*</span></button>
                                <input type="hidden" name="attr_sleight_of_hand_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_sleight_of_hand" title="@{sleight_of_hand}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_sleight_of_hand_ability_mod" title="@{sleight_of_hand_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_sleight_of_hand_ranks" class="nospin number underlined" value="0" title="@{sleight_of_hand_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_sleight_of_hand_misc" class="nospin number underlined" value="0" title="@{sleight_of_hand_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_sleight_of_hand_bonus" class="nospin number underlined" value="0" title="@{sleight_of_hand_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_sleight_of_hand_ability" title="@{sleight_of_hand_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_sleight_of_hand_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_sleight_of_hand_armor_penalty" value="1" title="@{sleight_of_hand_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_sleight_of_hand_notes"></span>
                                    <textarea name="attr_sleight_of_hand_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{sleight_of_hand_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END sleight_of_hand -->
                    <div class="myrow skill" data-i18n-list-item="spellcraft"> <!-- spellcraft -->
                        <input type="hidden" name="attr_spellcraft_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-spellcraft" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_spellcraft_classkill" value="1" title="@{spellcraft_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_spellcraft" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{spellcraft}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{spellcraft}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{spellcraft_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="spellcraft">Spellcraft*</span></button>
                                <input type="hidden" name="attr_spellcraft_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_spellcraft" title="@{spellcraft}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_spellcraft_ability_mod" title="@{spellcraft_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_spellcraft_ranks" class="nospin number underlined" value="0" title="@{spellcraft_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_spellcraft_misc" class="nospin number underlined" value="0" title="@{spellcraft_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_spellcraft_bonus" class="nospin number underlined" value="0" title="@{spellcraft_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_spellcraft_ability" title="@{spellcraft_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_spellcraft_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spellcraft_armor_penalty" value="1" title="@{spellcraft_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_spellcraft_notes"></span>
                                    <textarea name="attr_spellcraft_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{spellcraft_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END spellcraft -->
                    <div class="myrow skill" data-i18n-list-item="stealth"> <!-- stealth -->
                        <input type="hidden" name="attr_stealth_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-stealth" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_stealth_classkill" value="1" title="@{stealth_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_stealth" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{stealth}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{stealth}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{stealth_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="stealth">Stealth</span></button>
                                <input type="hidden" name="attr_stealth_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_stealth" title="@{stealth}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_stealth_ability_mod" title="@{stealth_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_stealth_ranks" class="nospin number underlined" value="0" title="@{stealth_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_stealth_misc" class="nospin number underlined" value="0" title="@{stealth_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_stealth_bonus" class="nospin number underlined" value="0" title="@{stealth_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_stealth_ability" title="@{stealth_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_stealth_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_stealth_armor_penalty" value="1" title="@{stealth_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_stealth_notes"></span>
                                    <textarea name="attr_stealth_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{stealth_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END stealth -->
                    <div class="myrow skill" data-i18n-list-item="survival"> <!-- survival -->
                        <input type="hidden" name="attr_survival_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-survival" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_survival_classkill" value="1" title="@{survival_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_survival" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{survival}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{survival}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{survival_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="survival">Survival</span></button>
                                <input type="hidden" name="attr_survival_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_survival" title="@{survival}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_survival_ability_mod" title="@{survival_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_survival_ranks" class="nospin number underlined" value="0" title="@{survival_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_survival_misc" class="nospin number underlined" value="0" title="@{survival_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_survival_bonus" class="nospin number underlined" value="0" title="@{survival_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_survival_ability" title="@{survival_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_survival_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_survival_armor_penalty" value="1" title="@{survival_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_survival_notes"></span>
                                    <textarea name="attr_survival_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{survival_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END survival -->
                    <div class="myrow skill" data-i18n-list-item="swim"> <!-- swim -->
                        <input type="hidden" name="attr_swim_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-swim" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_swim_classkill" value="1" title="@{swim_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_swim" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{swim}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{swim}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{swim_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="swim">Swim</span></button>
                                <input type="hidden" name="attr_swim_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_swim" title="@{swim}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_swim_ability_mod" title="@{swim_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_swim_ranks" class="nospin number underlined" value="0" title="@{swim_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_swim_misc" class="nospin number underlined" value="0" title="@{swim_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_swim_bonus" class="nospin number underlined" value="0" title="@{swim_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_swim_ability" title="@{swim_ability}">
                                        <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_swim_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_swim_armor_penalty" value="1" title="@{swim_armor_penalty}" checked="checked" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_swim_notes"></span>
                                    <textarea name="attr_swim_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{swim_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END swim -->
                    <div class="myrow skill" data-i18n-list-item="use_magic_device"> <!-- use_magic_device -->
                        <input type="hidden" name="attr_use_magic_device_view_flag" value="1" class="optional-flag0" /><div class="optional blk">
                            <input class="options-flag" name="attr_options-flag-use_magic_device" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                            <div class="myrow right">
                                <input class="pseudocheck" type="checkbox" name="attr_use_magic_device_classkill" value="1" title="@{use_magic_device_classkill}" /><span></span>
                                <button class="myrol" type="roll" name="roll_usemagicdevice" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=^{use_magic_device}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{use_magic_device}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{use_magic_device_notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl name" data-i18n="use_magic_device">Use Magic Device*</span></button>
                                <input type="hidden" name="attr_use_magic_device_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_use_magic_device" title="@{use_magic_device}"></span>
                                <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_use_magic_device_ability_mod" title="@{use_magic_device_ability_mod}"></span>
                                <span class="lbl">+</span> <input type="number" name="attr_use_magic_device_ranks" class="nospin number underlined" value="0" title="@{use_magic_device_ranks}" />
                                <span class="lbl">+</span> <input type="number" name="attr_use_magic_device_misc" class="nospin number underlined" value="0" title="@{use_magic_device_misc}" />
                                <span class="lbl">+</span> <input type="number" name="attr_use_magic_device_bonus" class="nospin number underlined" value="0" title="@{use_magic_device_bonus}" />
                            </div>
                            <div class="options">
                                <div class="myrow">
                                    <span data-i18n="ability">Ability</span>: <select name="attr_use_magic_device_ability" title="@{use_magic_device_ability}">
                                        <option value="strength" data-i18n="strength">Strength</option>
                                        <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                        <option value="constitution" data-i18n="constitution">Constitution</option>
                                        <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                        <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                                        <option value="charisma" data-i18n="charisma" selected="selected">Charisma</option>
                                    </select>
                                    <input type="hidden" class="skillability" name="attr_use_magic_device_ability" /><div class="skillability">
                                        <span class="spacer"></span>
                                        <input class="pseudocheck" type="checkbox" name="attr_use_magic_device_armor_penalty" value="1" title="@{use_magic_device_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                    </div>
                                </div>
                                <div class="autoex">
                                    <span name="attr_use_magic_device_notes"></span>
                                    <textarea name="attr_use_magic_device_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{use_magic_device_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>  <!-- END use_magic_device -->
                    <div data-i18n-list-item="custom-rep">
                        <fieldset class="repeating_skillcustom"> <!-- repeating custom skill -->
                            <div class="myrow skill">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" checked="checked" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                                <div class="myrow right">
                                    <input class="pseudocheck" type="checkbox" name="attr_classkill" value="1" title="@{repeating_skillcustom_$id_classkill}" /><span></span>
                                    <button class="myrol" type="roll" name="roll_skill" data-i18n-title="skill-roll" title="Roll Skill" value="@{whispertype} &{template:pc} {{name=@{name}}} {{type=skill}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{roll=[[1d20+@{skill}[MOD]+(@{skill_condition})[CONDITION]+@{rollmod_skill}[BONUS]]]}} {{shownotes=@{rollnotes_skill}}} {{notes=@{notes}}} {{conditionsflag=[[@{skill_condition}]]}} {{conditions=@{conditions_display}}} {{conditionsnote=@{skill_condition_note}}}"><span class="lbl custom only" name="attr_name"></span></button>
                                    <input type="hidden" name="attr_penalty_flag" class="attr-flag" value="0" /><span class="pseudoattr greybg underlined number" name="attr_skill" title="@{repeating_skillcustom_$id_skill}"></span>
                                    <input type="hidden" name="attr_skill" />
                                    <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_ability_mod" title="@{repeating_skillcustom_$id_ability_mod}"></span>
                                    <span class="lbl">+</span> <input type="number" name="attr_ranks" class="nospin number underlined" value="0" title="@{repeating_skillcustom_$id_ranks}" />
                                    <span class="lbl">+</span> <input type="number" name="attr_misc" class="nospin number underlined" value="0" title="@{repeating_skillcustom_$id_misc}" />
                                    <span class="lbl">+</span> <input type="number" name="attr_bonus" class="nospin number underlined" value="0" title="@{repeating_skillcustom_$id_bonus}" />
                                </div>
                                <div class="options">
                                    <div class="myrow">
                                        <span data-i18n="name">Name</span>: <input type="text" name="attr_name" class="underlined" data-i18n-placeholder="skill" placeholder="Skill" title="@{repeating_skillcustom_$id_name}" />
                                    </div>
                                    <div class="myrow">
                                        <span data-i18n="ability">Ability</span>: <select name="attr_ability" title="@{repeating_skillcustom_$id_ability}">
                                            <option value="strength" data-i18n="strength">Strength</option>
                                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                                            <option value="constitution" data-i18n="constitution">Constitution</option>
                                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                                            <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                                            <option value="charisma" data-i18n="charisma">Charisma</option>
                                        </select>
                                        <input type="hidden" class="skillability" name="attr_ability" /><div class="skillability">
                                            <span class="spacer"></span>
                                            <input class="pseudocheck" type="checkbox" name="attr_armor_penalty" value="1" title="@{repeating_skillcustom_$id_armor_penalty}" /><span></span><span data-i18n="apply-armor-encumbrance-penalty">Apply armor/encumbrance penalty</span>
                                        </div>
                                    </div>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_skillcustom_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset>  <!-- END repeating custom skill -->
                    </div>
                </div> <!-- END Skill sorting -->
                <div class="topspace myrow"> <!-- TOTAL RANKS & SKILLPOINTS -->
                    <div class="blacklabel pnty totalranks">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="total-ranks">Total Ranks</span>
                    </div>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_skills_ranks_total" title="@{skills_ranks_total}"></span></div>
                    <b>/</b>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_skills_ranks_total_max" title="@{skills_ranks_total_max}"></span></div>
                </div>  <!-- END TOTAL RANKS & SKILLPOINTS -->
            </div> <!-- END SKILLS -->
        </div>  <!-- END tab1 col2 -->
    </div> <!-- END TAB MAIN -->
    <div class="tabadd"> <!-- TAB ADDITIONNAL -->
        <div class="subcol"> <!-- AC ITEMS -->
            <div class="acitems"> <!-- AC ITEMS -->
                <div class="myrow right">
                    <div class="blacklabel right">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only item" data-i18n="ac-items">AC Items</span>
                        <span class="med only equipped" data-i18n="eq" data-i18n-title="equipped" title="Equipped">Eq</span>
                        <span class="med only ac" data-i18n="ac-u" data-i18n-title="ac-bonus" title="AC Bonus">AC</span>
                        <span class="med only flat" data-i18n="ff-u" data-i18n-title="flat-footed-bonus" title="Flat-footed Bonus">FF</span>
                        <span class="med only touch" data-i18n="tou" data-i18n-title="touch-bonus" title="Touch Bonus">Tou</span>
                        <span class="med only natural" data-i18n="nat" data-i18n-title="natural-bonus" title="Natural Bonus">Nat</span>
                        <span class="med only deflection" data-i18n="def" data-i18n-title="deflection-bonus" title="Deflection Bonus">Def</span>
                        <span class="med only dodge" data-i18n="dod" data-i18n-title="dodge-bonus" title="Dodge Bonus">Dod</span>
                        <span class="med only type" data-i18n="type">Type</span>
                        <span class="med only check" data-i18n="chk" data-i18n-title="check-penalty" title="Check Penalty">Chk</span>
                        <span class="med only max" data-i18n="dex" data-i18n-title="max-dex-bonus" title="Max Dex Bonus">Dex</span>
                        <span class="med only spellfailure" data-i18n="spl" data-i18n-title="spell-failure" title="Spell Failure">Spl</span>
                    </div>
                </div>
                <div class="bordered titled inboxright">
                    <div class="myrow"> <!-- REPEATING AC ITEMS -->
                        <fieldset class="repeating_acitems">
                            <div class="acitem right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes" /><span>y</span>
                                <div class="myrow right">
                                    <input type="text" name="attr_name" accept="Name" spellcheck="false" class="underlined name" title="@{repeating_acitems_$id_name}" data-i18n-placeholder="item" placeholder="Item" />
                                    <input class="pseudocheck" type="checkbox" name="attr_equipped" value="1" title="@{repeating_acitems_$id_equipped}" checked="checked" /><span></span>
                                    <input type="hidden" name="attr_compendium_ac_bonus" accept="Armor/Shield Bonus" />
                                    <input type="number" name="attr_ac_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_ac_bonus}" />
                                    <input type="number" name="attr_flatfooted_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_flatfooted_bonus}" />
                                    <input type="number" name="attr_touch_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_touch_bonus}" />
                                    <input type="number" name="attr_natural_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_natural_bonus}" />
                                    <input type="number" name="attr_deflection_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_deflection_bonus}" />
                                    <input type="number" name="attr_dodge_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_dodge_bonus}" />
                                    <input type="hidden" name="attr_compendium_armor_category" accept="Armor Category" />
                                    <select name="attr_type" title="@{repeating_acitems_$id_type}">
                                        <option value="light" data-i18n="light">Light</option>
                                        <option value="medium" data-i18n="medium" selected="selected">Medium</option>
                                        <option value="heavy" data-i18n="heavy">Heavy</option>
                                        <option value="shield" data-i18n="shield">Shield</option>
                                        <option value="misc" data-i18n="misc">Misc</option>
                                    </select>
                                    <input type="hidden" name="attr_compendium_check_penalty" accept="Armor Check Penalty" />
                                    <input type="number" name="attr_check_penalty" value="0" class="nospin underlined" title="@{repeating_acitems_$id_check_penalty}" />
                                    <input type="hidden" name="attr_compendium_max_dex_bonus"  accept="Maximum Dex Bonus" />
                                    <input type="number" name="attr_max_dex_bonus" value="0" class="nospin underlined" title="@{repeating_acitems_$id_max_dex_bonus}" />
                                    <input type="hidden" name="attr_compendium_spell_failure"  accept="Arcane Spell Failure Chance" />
                                    <input type="number" name="attr_spell_failure" value="0" class="nospin underlined" title="@{repeating_acitems_$id_spell_failure}" />
                                </div>
                                <div class="options right">
                                    <div class="myrow">
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                        <span class="lbl margindent" data-i18n="speed-20ft" >Speed 20 ft.</span>
                                        <input type="text" name="attr_speed20" accept="Speed 20ft." class="underlined speed" spellcheck="false" class="underlined" title="@{repeating_acitems_$id_speed20}" />
                                        <span class="lbl margindent" data-i18n="speed-30ft" >Speed 30 ft.</span>
                                        <input type="text" name="attr_speed30" accept="Speed 30ft." class="underlined speed" spellcheck="false" class="underlined" title="@{repeating_acitems_$id_speed30}" />
                                        <span class="lbl margindent" data-i18n="run" >Run</span> x
                                        <input type="number" name="attr_run_factor" value="4" class="nospin underlined sml"  title="@{repeating_acitems_$id_run_factor}" />
                                    </div>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_acitems_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div> <!-- END REPEATING AC ITEMS -->
                    <div class="myrow right" style="margin-top: 3px;"> <!-- Ac Items Totals -->
                        <span class="lab bold totals" data-i18n="totals-u">TOTALS</span>
                        <div class="boxed greybg"><span class="pseudoattr" name="attr_speed_armor" title="@{speed_armor}"></span></div>
                        <div class="boxed greybg"><span class="pseudoattr" title="@{armor_run_factor}">x<span name="attr_armor_run_factor"></span></span></div>
                        <div class="boxed greybg margindent"><span name="attr_ac_shield" class="pseudoattr" title="@{ac_shield}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_armor" class="pseudoattr" title="@{ac_armor}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_flatfooted_bonus" class="pseudoattr" title="@{ac_flatfooted_bonus}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_touch_bonus" class="pseudoattr" title="@{ac_touch_bonus}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_natural_bonus" class="pseudoattr" title="@{ac_natural_bonus}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_deflection_bonus" class="pseudoattr" title="@{ac_deflection_bonus}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_dodge_bonus" class="pseudoattr" title="@{ac_dodge_bonus}"></span></div>
                        <span class="spacer type"></span>
                        <div class="boxed greybg"><span name="attr_armor_check_penalty" class="pseudoattr" title="@{armor_check_penalty}"></span></div>
                        <div class="boxed greybg"><span name="attr_ac_ability_maximum" class="pseudoattr" title="@{ac_ability_maximum}"></span></div>
                        <div class="boxed greybg"><span name="attr_armor_spell_failure" class="pseudoattr" title="@{armor_spell_failure}"></span></div>
                    </div>
                    <div class="myrow labline bottom">
                        <span class="lab speed" data-i18n="speed">Speed</span>
                        <span class="lab" data-i18n="run">Run</span>
                        <span class="lab margindent" data-i18n="shield">Shield</span>
                        <span class="lab" data-i18n="armor">Armor</span>
                        <span class="lab">&nbsp;</span>
                        <span class="lab">&nbsp;</span>
                        <span class="lab" data-i18n="max">Max</span>
                        <span class="lab" data-i18n="max">Max</span>
                    </div>
                    <!-- End Ac Items Totals -->
                </div>
            </div> <!-- END AC ITEMS -->
        </div> <!-- END AC ITEMS -->
        <div class="subcol" style="width: 262px;max-width: 262px;"> <!-- XP AND MONEY -->
            <div class="myrow right"> <!-- XP -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" style="margin-right: 4px;" data-i18n="experience">Experience</span>
                    <span class="med only" data-i18n="points">Points</span>
                    <span class="med only" style="width: 80px;max-width: 80px;text-align: right;" data-i18n="next-level">Next Level</span>
                </div>
                <div class="bordered titled inboxright">
                    <div class="myrow right">
                        <input type="text" name="attr_xp" class="smlmed right" value="0" title="@{xp}" />
                        <input type="text" name="attr_xp_max" class="smlmed right" value="2000" title="@{xp_max}" />
                    </div>
                </div>
            </div> <!-- END XP -->
            <div class="topspace myrow center money"> <!-- MONEY -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="money">Money</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="myrow center">
                        <div class="subcol"><span class="lab block" data-i18n="cp-u">CP</span> <input type="number" class="nospin" name="attr_money_cp" value="0" title="@{money_cp}" /></div>
                        <div class="subcol"><span class="lab block" data-i18n="sp-u">SP</span> <input type="number" class="nospin" name="attr_money_sp" value="0" title="@{money_sp}" /></div>
                        <div class="subcol"><span class="lab block" data-i18n="gp-u">GP</span> <input type="number" class="nospin" name="attr_money_gp" value="0" title="@{money_gp}" /></div>
                        <div class="subcol"><span class="lab block" data-i18n="pp-u">PP</span> <input type="number" class="nospin" name="attr_money_pp" value="0" title="@{money_pp}" /></div>
                    </div>
                    <div class="autoex"><span name="attr_money_other"></span> <textarea name="attr_money_other" spellcheck="false" data-i18n-placeholder="other-valuables" placeholder="Other valuables" title="@{money_other}"></textarea></div>
                </div>
            </div> <!-- END MONEY -->
        </div> <!-- END XP AND MONEY -->
        <div class="topspace colhalf"> <!-- GEAR & ENCUMBRANCE -->
            <div class="gear"> <!-- GEAR -->
                <div class="myrow right">
                    <div class="blacklabel right title">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="gear">Gear</span>
                        <span class="med only qty" data-i18n="qty" data-i18n-title="quantity" title="Quantity">Qty</span>
                        <span class="med only weight" data-i18n="weight">Weight</span>
                    </div>
                </div>
                <div class="bordered titled inboxright">
                    <fieldset class="repeating_gear">
                        <div class="gearitem compendium-drop-target">
                            <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-notes" title="Show/hide notes" /><span>y</span>
                            <div class="myrow right">
                                <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                <input type="text" name="attr_name" accept="Name" class="underlined item" spellcheck="false" title="@{repeating_gear_$id_name}" />
                                <input type="number" name="attr_quantity" step="0.01" min="0" value="1" class="nospin underlined sml" spellcheck="false" title="@{repeating_gear_$id_quantity}" />
                                <input type="hidden" name="attr_compendium_weight" accept="Weight" />
                                <input type="number" name="attr_weight" step="0.01" min="0" value="0" class="nospin underlined sml margindent" spellcheck="false" title="@{repeating_gear_$id_weight}" />
                                <input type="hidden" name="attr_weight_total" value="0" />
                                <span class="pseudoattr greybg right underlined total" name="attr_weight_total" title="@{repeating_gear_$id_weight_total}"></span>
                            </div>
                            <div class="options right">
                                <div class="autoex">
                                    <span name="attr_notes"></span>
                                    <textarea name="attr_notes" accept="Content" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_gear_$id_notes}"></textarea>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <div class="myrow right gearitem">
                        <span class="lab" data-i18n="coins">Coins</span>
                        <input class="pseudocheck" type="checkbox" name="attr_encumbrance_coins_flag" value="1" data-i18n-title="coins-weight-t" title="If checked, adds weight from coins to the total gear weight." checked="checked" /><span></span>
                        <span class="pseudoattr greybg right underlined total margindent" name="attr_encumbrance_coins_weight" title="@{encumbrance_coins_weight}"></span>
                    </div>
                    <div class="blacklabel total right">
                        <span class="big" data-i18n="total-weight">Total Weight</span>
                        <input type="hidden" name="attr_encumbrance" value="light" class="overload" />
                        <span class="lbl margindent overload" name="attr_encumbrance_display"  title="@{encumbrance_display}"></span>
                        <span name="attr_encumbrance_gear_weight" class="pseudoattr right greybg wtotal margindent" title="@{encumbrance_gear_weight}"></span>
                    </div>
                </div>
            </div> <!-- END GEAR -->
            <div class="topspace myrow encumbrance"> <!-- ENCUMBRANCE -->
                <input class="options-flag" name="attr_options-flag-encumbrance" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                <div class="myrow center">
                    <span class="lab std right" data-i18n="light-load">Light Load</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_load_light" title="@{encumbrance_load_light}"></span></div>
                    <span class="lab std right margindent" data-i18n="medium-load">Medium Load</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_load_medium" title="@{encumbrance_load_medium}"></span></div>
                    <span class="lab std right margindent" data-i18n="heavy-load">Heavy Load</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_load_heavy" title="@{encumbrance_load_heavy}"></span></div>
                </div>
                <div class="topspace myrow center">
                    <span class="lab std right" data-i18n="lift-over-head">Lift Over Head</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_lift_head" title="@{encumbrance_lift_head}"></span></div>
                    <span class="lab std right margindent" data-i18n="lift-off-ground">Lift Off Ground</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_lift_ground" title="@{encumbrance_lift_ground}"></span></div>
                    <span class="lab std right margindent" data-i18n="drag-or-push">Drag Or Push</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_drag_push" title="@{encumbrance_drag_push}"></span></div>
                </div>
                <div class="topspace myrow center">
                    <span class="lab right" data-i18n="speed">Speed</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_speed_encumbrance" title="@{speed_encumbrance}"></span></div>
                    <span class="lab right margindent" data-i18n="run">Run</span>
                    <div class="boxed greybg"><span class="pseudoattr" title="@{encumbrance_run_factor}">x<span name="attr_encumbrance_run_factor"></span></span></div>
                    <span class="lab right margindent" data-i18n="check-penalty">Check penalty</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_check_penalty" title="@{encumbrance_check_penalty}"></span></div>
                    <span class="lab right margindent" data-i18n="max-dex-bonus">Max Dex Bonus</span>
                    <div class="boxed greybg"><span class="pseudoattr" name="attr_encumbrance_ability_maximum" title="@{encumbrance_ability_maximum}"></span></div>
                </div>
                <div class="options">
                    <div class="myrow">
                        <span class="lab" data-i18n="strength">Strength</span>
                        <span class="lab">(+)</span>
                        <div class="boxed"><input type="number" name="attr_encumbrance_load_bonus" class="nospin boxed" value="0" title="@{encumbrance_load_bonus}" /></div>
                        <span class="lab margindent" data-i18n="multiplier">Multiplier</span>
                        <span class="lab">(*)</span>
                        <div class="boxed"><input type="number" name="attr_encumbrance_load_multiplier" class="nospin boxed" step="0.01" value="1.0" title="@{encumbrance_load_multiplier}" /></div>
                    </div>
                    <div class="autoex">
                        <span name="attr_encumbrance_load_notes"></span>
                        <textarea name="attr_encumbrance_load_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{encumbrance_load_notes}"></textarea>
                    </div>
                </div>
            </div> <!-- ENCUMBRACE -->
            <div class="topspace myrow center"> <!-- ADDITIONAL GEAR -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="additional-gear">Additional Gear</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
            </div>
            <div class="bordered titled inbox">
                <div class="autoex">
                    <span name="attr_misc_notes"></span>
                    <textarea name="attr_misc_notes" spellcheck="false" data-i18n-placeholder="additional-gear" placeholder="Additional Gear" title="@{misc_notes}"></textarea>
                </div>
            </div> <!-- END NOTES -->
        </div> <!-- END GEAR & ENCUMBRANCE -->
        <div class="colhalf padindent"> <!-- FEATS & TRAITS & BRACKGROUND -->
            <div class="feats"> <!-- FEATS -->
                <div class="myrow center">
                    <div class="blacklabel pnty">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n="feats">Feats</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                </div>
                <fieldset class="repeating_feats">
                    <div class="feat underlined compendium-drop-target">
                        <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                        <button class="myrol margindent" type="roll" name="roll_feat" data-i18n-title="show-feat" title="Show Feat" value="@{whispertype} &{template:pc} {{name=@{name}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{shortdesc=@{descshort}}} {{feattype=^{@{type}}}} {{prerequisites=@{prerequisites}}} {{benefits=@{benefits}}} {{normal=@{normal}}} {{special=@{special}}} @{descflag}"><span class="pseudoattr"><span name="attr_name"></span> (<span name="attr_type" data-i18n-dynamic></span>)</span></button>
                        <span name="attr_descshort"></span>
                        <div class="options">
                            <div class="myrow">
                                <span class="lbl" data-i18n="name">Name</span> <input type="text" name="attr_name" accept="Feat Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_feats_$id_name}" />
                                <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" /><button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                <span class="lbl margindent" data-i18n="type">Type</span> <select class="underlined" name="attr_type" title="@{repeating_feats_$id_type}">
                                    <option value="general" data-i18n="general" selected="selected">General</option>
                                    <option value="combat" data-i18n="combat">Combat</option>
                                    <option value="critical" data-i18n="critical">Critical</option>
                                    <option value="grit" data-i18n="grit">Grit</option>
                                    <option value="item creation" data-i18n="item creation">Item creation</option>
                                    <option value="metamagic" data-i18n="metamagic">Metamagic</option>
                                    <option value="panache" data-i18n="panache">Panache</option>
                                    <option value="performance" data-i18n="performance">Performance</option>
                                    <option value="style" data-i18n="style">Style</option>
                                    <option value="teamwork" data-i18n="teamwork">Teamwork</option>
                                    <option value="misc" data-i18n="misc">Misc</option>
                                </select>
                                <input type="hidden" name="attr_type_fromcompendium" accept="Feat Type" value="" />
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="short-desc:" data-i18n-title="short description:" title="Short Description">Short Desc.:</span> <input type="text" name="attr_descshort" class="underlined std" spellcheck="false" title="@{repeating_feats_$id_descshort}" />
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="prerequisites:">Prerequisites:</span>
                                <div class="autoex std">
                                    <span name="attr_prerequisites"></span>
                                    <textarea name="attr_prerequisites" accept="Prerequisites" class="underlined" spellcheck="false" title="@{repeating_feats_$id_prerequisites}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="benefits:">Benefits:</span>
                                <div class="autoex std">
                                    <span name="attr_benefits"></span>
                                    <textarea name="attr_benefits" accept="Benefit" class="underlined" spellcheck="false" title="@{repeating_feats_$id_benefits}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="normal:">Normal:</span>
                                <div class="autoex std">
                                    <span name="attr_normal"></span>
                                    <textarea name="attr_normal" accept="Normal" class="underlined" spellcheck="false" title="@{repeating_feats_$id_normal}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="special:">Special:</span>
                                <div class="autoex std">
                                    <span name="attr_special"></span>
                                    <textarea name="attr_special" accept="Special" class="underlined" spellcheck="false" title="@{repeating_feats_$id_special}"></textarea>
                                </div>
                            </div>
                            <div class="myrow">
                                <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{description}}}" title="@{repeating_feats_$id_descflag}" checked="checked" /><span></span>
                                <span class="lbl atk" data-i18n="description:">Description:</span>
                                <div class="autoex">
                                    <span name="attr_description"></span>
                                    <textarea name="attr_description" accept="data-description" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_feats_$id_description}"></textarea>
                                </div>
                            </div>
                            <span class="lbl" data-i18n="notes:">Notes:</span>
                            <div class="autoex">
                                <span name="attr_notes"></span>
                                <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_attacks_$id_notes}"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div> <!-- END FEATS -->
            <div class="topspace traits"> <!-- TRAITS -->
                <div class="myrow center">
                    <div class="blacklabel pnty">
                        <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                        <span class="big only" data-i18n-title="features-traits-title" title="Race & Class features, Traits ..."><span data-i18n="features">Features</span> / <span data-i18n="traits">Traits</span></span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                </div>
                <fieldset class="repeating_abilities">
                    <div class="ability underlined compendium-drop-target">
                        <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                        <button class="myrol margindent" type="roll" name="roll_trait" data-i18n-title="show-ability" title="Show Ability" value="@{whispertype} &{template:pc} {{name=@{name}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{abilitytype=@{type}}}  {{shortdesc=@{descshort}}} @{descflag}"><span class="pseudoattr" name="attr_name"></span> <input type="hidden" class="optional-flag" name="attr_type" value="" /><span class="optional inl pseudoattr">(<span name="attr_type"></span>)</span></button>
                        <span name="attr_descshort"></span>
                        <input type="hidden" class="optional-flag" name="attr_perday_max" value="" /><span class="optional inl">- <input type="number" class="nospin spsml center" name="attr_perday" value="0" data-i18n-title="#-used" title="# used" />/<span name="attr_perday_max" data-i18n-title="max-#-per-day" title="Max # per day"></span> <span data-i18n="per-day">per day</span></span>
                        <div class="options">
                            <div class="myrow">
                                <span class="lbl" data-i18n="name">Name</span> <input type="text" name="attr_name" accept="Name" class="underlined large" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_abilities_$id_name}" />
                                <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                <input type="text" class="underlined spsml center margindent" name="attr_perday_max" value="" spellcheck="false" title="@{repeating_npcatk-special_$id_perday_max}" />
                                <span class="lbl" data-i18n="per-day">per day</span>
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="type">Type</span> <input type="text" name="attr_type" accept="Ability Type" class="underlined" spellcheck="false" data-i18n-placeholder="type" placeholder="Type" title="@{repeating_abilities_$id_type}" />
                            </div>
                            <div class="myrow">
                                <span class="lbl std right" data-i18n="short-desc:" data-i18n-title="short description:" title="Short Description">Short Desc.:</span> <input type="text" name="attr_descshort" class="underlined std" spellcheck="false" title="@{repeating_abilities_$id_descshort}" />
                            </div>
                            <div class="myrow">
                                <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{description}}}" title="@{repeating_abilities_$id_descflag}" checked="checked" /><span></span>
                                <span class="lbl atk" data-i18n="description:">Description:</span>
                                <div class="autoex">
                                    <span name="attr_description"></span>
                                    <textarea name="attr_description" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_abilities_$id_description}"></textarea>
                                </div>
                            </div>
                            <span class="lbl" data-i18n="notes:">Notes:</span>
                            <div class="autoex">
                                <span name="attr_notes"></span>
                                <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_attacks_$id_notes}"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div> <!-- END TRAITS -->
            <div class="topspace myrow center"> <!-- BACKGROUND -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="notes">Notes</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
            </div>
            <div class="bordered titled inbox">
                <div class="autoex">
                    <span name="attr_background"></span>
                    <textarea name="attr_background" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{background}"></textarea>
                </div>
            </div> <!-- END BACKGROUND -->
        </div> <!-- END FEATS & TRAITS & BRACKGROUND -->
    </div> <!-- END TAB ADDITIONNAL -->
    <div class="tabspell"> <!-- TAB SPELLS -->
        <div class="col1third"> <!-- misc magic -->
            <div class="myrow center spellcasting"> <!-- SPELLCASTING -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big" data-i18n="spellcasting">Spellcasting</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <input type="hidden" class="optional-flag0" name="attr_caster1_flag" value="0" /><div class="optional blk bordered titled inbox"> <!-- CASTER CLASS 1 -->
                    <div class="myrow">
                        <span class="roundblack">1</span> <span class="pseudoattr" name="attr_caster1_class" title="@{caster1_class}"></span> <span class="pseudoattr" name="attr_caster1_level" title="@{caster1_level}"></span>
                        <span class="lbl margindent" data-i18n="ability-mod">Ability mod</span> <span class="pseudoattr number greybg underlined" name="attr_caster1_ability_mod" title="@{caster1_ability_mod}"></span>
                    </div>
                    <div class="topspace concentration"> <!-- CONCENTRATION -->
                        <input class="options-flag" name="attr_options-flag-caster1-concentration" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                        <div class="myrow padindent">
                            <button class="myrol" type="roll" name="roll_caster1_concentration_roll" data-i18n-title="concentration-roll" title="Concentration roll" value="@{caster1_concentration_roll}"><span class="lbl" data-i18n="concentration">Concentration</span></button>
                            <input type="hidden" name="attr_caster1_concentration_roll" value="@{whispertype} &{template:pc} {{name=^{concentration}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{casterclass=@{caster1_class}}} {{level=@{caster1_level}}} {{roll=[[1d20+@{caster1_concentration}[MOD]+@{rollmod_save}[BONUS]]]}} {{shownotes=@{rollnotes_save}}} {{notes=@{caster1_concentration_notes}}}" />
                            <input type="hidden" name="attr_caster1_concentration_bonus" class="attr-flag" value="0" />
                            <span name="attr_caster1_concentration" class="pseudoattr number greybg underlined" title="@{caster1_concentration}"></span>
                            <span class="lab margindent" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span> <input type="number" name="attr_caster1_concentration_bonus" class="nospin underlined" value="0" title="@{caster1_concentration_bonus}" />
                        </div>
                        <div class="options padindent">
                            <div class="myrow padindent">
                                <span class="spacer">=</span> <span name="attr_caster1_level" class="pseudoattr number greybg underlined" title="@{caster1_level}"></span>
                                <span class="spacer">+</span> <span name="attr_caster1_ability_mod" class="pseudoattr number greybg underlined" title="@{caster1_ability_mod}"></span>
                                <span class="spacer">+</span> <input type="number" name="attr_caster1_concentration_misc" class="nospin underlined" value="0" title="@{caster1_concentration_misc}" />
                            </div>
                            <div class="myrow padindent labline bottom">
                                <span class="spacer"></span> <span class="lab" data-i18n="caster" data-i18n-title="caster-level" title="Caster Level">Caster</span>
                                <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                                <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                            </div>
                            <div class="autoex">
                                <span name="attr_caster1_concentration_notes"></span>
                                <textarea name="attr_caster1_concentration_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{caster1_concentration_notes}"></textarea>
                            </div>
                        </div>
                    </div> <!-- END CONCENTRATION -->
                    <div class="topspace myrow labline top perlevel">
                        <span class="lab" data-i18n="level" data-i18n-title="spell-level" title="Spell Level">Level</span>
                        <span class="lab" data-i18n="known" data-i18n-title="spells-known" title="Spells Known">Known</span>
                        <span class="lab" data-i18n="per-day" data-i18n-title="spells-per-day" title="Spells Per Day">per day</span>
                        <span class="lab" data-i18n="bonus" data-i18n-title="bonus-spells" title="Bonus Spells">Bonus</span>
                        <span class="lab" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                        <span class="lab" data-i18n="temp" data-i18n-title="save-dc-temp-adjustment" title="Save DC Temp Adjustment">Temp</span>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">0</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_0" value="0" title="@{caster1_spells_known_level_0}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_0" value="0" title="@{caster1_spells_perday_level_0}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_0" value="0" title="@{caster1_spells_bonus_level_0}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_0" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_0" class="pseudoattr" title="@{caster1_dc_level_0}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_0" value="0" title="@{caster1_dcbonus_level_0}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">1</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_1" value="0" title="@{caster1_spells_known_level_1}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_1" value="0" title="@{caster1_spells_perday_level_1}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_1" value="0" title="@{caster1_spells_bonus_level_1}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_1" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_1" class="pseudoattr" title="@{caster1_dc_level_1}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_1" value="0" title="@{caster1_dcbonus_level_1}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">2</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_2" value="0" title="@{caster1_spells_known_level_2}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_2" value="0" title="@{caster1_spells_perday_level_2}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_2" value="0" title="@{caster1_spells_bonus_level_2}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_2" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_2" class="pseudoattr" title="@{caster1_dc_level_2}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_2" value="0" title="@{caster1_dcbonus_level_2}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">3</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_3" value="0" title="@{caster1_spells_known_level_3}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_3" value="0" title="@{caster1_spells_perday_level_3}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_3" value="0" title="@{caster1_spells_bonus_level_3}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_3" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_3" class="pseudoattr" title="@{caster1_dc_level_3}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_3" value="0" title="@{caster1_dcbonus_level_3}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">4</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_4" value="0" title="@{caster1_spells_known_level_4}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_4" value="0" title="@{caster1_spells_perday_level_4}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_4" value="0" title="@{caster1_spells_bonus_level_4}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_4" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_4" class="pseudoattr" title="@{caster1_dc_level_4}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_4" value="0" title="@{caster1_dcbonus_level_4}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">5</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_5" value="0" title="@{caster1_spells_known_level_5}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_5" value="0" title="@{caster1_spells_perday_level_5}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_5" value="0" title="@{caster1_spells_bonus_level_5}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_5" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_5" class="pseudoattr" title="@{caster1_dc_level_5}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_5" value="0" title="@{caster1_dcbonus_level_5}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">6</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_6" value="0" title="@{caster1_spells_known_level_6}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_6" value="0" title="@{caster1_spells_perday_level_6}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_6" value="0" title="@{caster1_spells_bonus_level_6}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_6" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_6" class="pseudoattr" title="@{caster1_dc_level_6}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_6" value="0" title="@{caster1_dcbonus_level_6}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">7</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_7" value="0" title="@{caster1_spells_known_level_7}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_7" value="0" title="@{caster1_spells_perday_level_7}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_7" value="0" title="@{caster1_spells_bonus_level_7}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_7" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_7" class="pseudoattr" title="@{caster1_dc_level_7}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_7" value="0" title="@{caster1_dcbonus_level_7}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">8</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_8" value="0" title="@{caster1_spells_known_level_8}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_8" value="0" title="@{caster1_spells_perday_level_8}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_8" value="0" title="@{caster1_spells_bonus_level_8}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_8" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_8" class="pseudoattr" title="@{caster1_dc_level_8}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_8" value="0" title="@{caster1_dcbonus_level_8}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">9</span>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_known_level_9" value="0" title="@{caster1_spells_known_level_9}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_perday_level_9" value="0" title="@{caster1_spells_perday_level_9}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_spells_bonus_level_9" value="0" title="@{caster1_spells_bonus_level_9}" /></div>
                        <div class="boxed greybg"><input type="hidden" name="attr_caster1_dcbonus_level_9" class="attr-flag" value="0" /><span name="attr_caster1_dc_level_9" class="pseudoattr" title="@{caster1_dc_level_9}"></span></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster1_dcbonus_level_9" value="0" title="@{caster1_dcbonus_level_9}" /></div>
                    </div>
                    <span class="topspace lbl" data-i18n="bloodlines-domains-schools:">Bloodlines, Domains, Schools... :</span>
                    <div class="autoex">
                        <span name="attr_caster1_spells_notes"></span>
                        <textarea name="attr_caster1_spells_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{caster1_spells_notes}"></textarea>
                    </div>
                </div> <!-- END CASTER CLASS 1 -->
                <input type="hidden" class="optional-flag0" name="attr_caster2_flag" value="0" /><div class="optional blk bordered inbox"> <!-- CASTER CLASS 2 -->
                    <div class="myrow">
                        <span class="roundblack">2</span> <span class="pseudoattr" name="attr_caster2_class" title="@{caster2_class}"></span> <span class="pseudoattr" name="attr_caster2_level" title="@{caster2_level}"></span>
                        <span class="lbl margindent" data-i18n="ability-mod">Ability mod</span> <span class="pseudoattr number greybg underlined" name="attr_caster2_ability_mod" title="@{caster2_ability_mod}"></span>
                    </div>
                    <div class="topspace concentration"> <!-- CONCENTRATION -->
                        <input class="options-flag" name="attr_options-flag-caster2-concentration" type="checkbox" value="1" data-i18n-title="show-hide-options" title="Show/hide options"><span>y</span>
                        <div class="myrow padindent">
                            <button class="myrol" type="roll" name="roll_caster2_concentration_roll" data-i18n-title="concentration-roll" title="Concentration roll" value="@{caster2_concentration_roll}"><span class="lbl" data-i18n="concentration">Concentration</span></button>
                            <input type="hidden" name="attr_caster2_concentration_roll" value="@{whispertype} &{template:pc} {{name=^{concentration}}} {{type=save}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{casterclass=@{caster2_class}}} {{level=@{caster2_level}}} {{roll=[[1d20+@{caster2_concentration}[MOD]+@{rollmod_save}[BONUS]]]}} {{shownotes=@{rollnotes_save}}} {{notes=@{caster2_concentration_notes}}}" />
                            <input type="hidden" name="attr_caster2_concentration_bonus" class="attr-flag" value="0" />
                            <span name="attr_caster2_concentration" class="pseudoattr number greybg underlined" title="@{caster2_concentration}"></span>
                            <span class="lab margindent" data-i18n="temp" data-i18n-title="temp-adjustment" title="Temp Adjustment">Temp</span> <input type="number" name="attr_caster2_concentration_bonus" class="nospin underlined" value="0" title="@{caster2_concentration_bonus}" />
                        </div>
                        <div class="options padindent">
                            <div class="myrow padindent">
                                <span class="spacer">=</span> <span name="attr_caster2_level" class="pseudoattr number greybg underlined" title="@{caster2_level}"></span>
                                <span class="spacer">+</span> <span name="attr_caster2_ability_mod" class="pseudoattr number greybg underlined" title="@{caster2_ability_mod}"></span>
                                <span class="spacer">+</span> <input type="number" name="attr_caster2_concentration_misc" class="nospin underlined" value="0" title="@{caster2_concentration_misc}" />
                            </div>
                            <div class="myrow padindent labline bottom">
                                <span class="spacer"></span> <span class="lab" data-i18n="caster" data-i18n-title="caster-level" title="Caster Level">Caster</span>
                                <span class="spacer"></span> <span class="lab" data-i18n="ability" data-i18n-title="ability-modifier" title="Ability Modifier">Ability</span>
                                <span class="spacer"></span> <span class="lab" data-i18n="misc" data-i18n-title="misc-modifier" title="Misc Modifier">Misc</span>
                            </div>
                            <div class="autoex">
                                <span name="attr_caster2_concentration_notes"></span>
                                <textarea name="attr_caster2_concentration_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{caster2_concentration_notes}"></textarea>
                            </div>
                        </div>
                    </div> <!-- END CONCENTRATION -->
                    <div class="topspace myrow labline top perlevel">
                        <span class="lab" data-i18n="level" data-i18n-title="spell-level" title="Spell Level">Level</span>
                        <span class="lab" data-i18n="known" data-i18n-title="spells-known" title="Spells Known">Known</span>
                        <span class="lab" data-i18n="per-day" data-i18n-title="spells-per-day" title="Spells Per Day">per day</span>
                        <span class="lab" data-i18n="bonus" data-i18n-title="bonus-spells" title="Bonus Spells">Bonus</span>
                        <span class="lab" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                        <span class="lab" data-i18n="temp" data-i18n-title="save-dc-temp-adjustment" title="Save DC Temp Adjustment">Temp</span>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">0</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_0" value="0" title="@{caster2_spells_known_level_0}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_0" value="0" title="@{caster2_spells_perday_level_0}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_0" value="0" title="@{caster2_spells_bonus_level_0}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_0" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_0" class="pseudoattr" title="@{caster2_dc_level_0}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_0" value="0" title="@{caster2_dcbonus_level_0}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">1</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_1" value="0" title="@{caster2_spells_known_level_1}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_1" value="0" title="@{caster2_spells_perday_level_1}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_1" value="0" title="@{caster2_spells_bonus_level_1}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_1" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_1" class="pseudoattr" title="@{caster2_dc_level_1}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_1" value="0" title="@{caster2_dcbonus_level_1}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">2</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_2" value="0" title="@{caster2_spells_known_level_2}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_2" value="0" title="@{caster2_spells_perday_level_2}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_2" value="0" title="@{caster2_spells_bonus_level_2}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_2" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_2" class="pseudoattr" title="@{caster2_dc_level_2}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_2" value="0" title="@{caster2_dcbonus_level_2}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">3</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_3" value="0" title="@{caster2_spells_known_level_3}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_3" value="0" title="@{caster2_spells_perday_level_3}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_3" value="0" title="@{caster2_spells_bonus_level_3}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_3" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_3" class="pseudoattr" title="@{caster2_dc_level_3}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_3" value="0" title="@{caster2_dcbonus_level_3}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">4</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_4" value="0" title="@{caster2_spells_known_level_4}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_4" value="0" title="@{caster2_spells_perday_level_4}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_4" value="0" title="@{caster2_spells_bonus_level_4}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_4" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_4" class="pseudoattr" title="@{caster2_dc_level_4}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_4" value="0" title="@{caster2_dcbonus_level_4}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">5</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_5" value="0" title="@{caster2_spells_known_level_5}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_5" value="0" title="@{caster2_spells_perday_level_5}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_5" value="0" title="@{caster2_spells_bonus_level_5}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_5" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_5" class="pseudoattr" title="@{caster2_dc_level_5}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_5" value="0" title="@{caster2_dcbonus_level_5}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">6</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_6" value="0" title="@{caster2_spells_known_level_6}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_6" value="0" title="@{caster2_spells_perday_level_6}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_6" value="0" title="@{caster2_spells_bonus_level_6}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_6" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_6" class="pseudoattr" title="@{caster2_dc_level_6}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_6" value="0" title="@{caster2_dcbonus_level_6}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">7</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_7" value="0" title="@{caster2_spells_known_level_7}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_7" value="0" title="@{caster2_spells_perday_level_7}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_7" value="0" title="@{caster2_spells_bonus_level_7}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_7" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_7" class="pseudoattr" title="@{caster2_dc_level_7}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_7" value="0" title="@{caster2_dcbonus_level_7}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">8</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_8" value="0" title="@{caster2_spells_known_level_8}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_8" value="0" title="@{caster2_spells_perday_level_8}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_8" value="0" title="@{caster2_spells_bonus_level_8}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_8" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_8" class="pseudoattr" title="@{caster2_dc_level_8}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_8" value="0" title="@{caster2_dcbonus_level_8}" /></div>
                    </div>
                    <div class="myrow perlevel">
                        <span class="pseudoattr level center">9</span> <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_known_level_9" value="0" title="@{caster2_spells_known_level_9}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_perday_level_9" value="0" title="@{caster2_spells_perday_level_9}" /></div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_spells_bonus_level_9" value="0" title="@{caster2_spells_bonus_level_9}" /></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="attr_caster2_dcbonus_level_9" class="attr-flag" value="0" />
                            <span name="attr_caster2_dc_level_9" class="pseudoattr" title="@{caster2_dc_level_9}"></span>
                        </div>
                        <div class="boxed"><input type="number" class="nospin" name="attr_caster2_dcbonus_level_9" value="0" title="@{caster2_dcbonus_level_9}" /></div>
                    </div>
                    <span class="topspace lbl" data-i18n="bloodlines-domains-schools:">Bloodlines, Domains, Schools... :</span>
                    <div class="autoex">
                        <span name="attr_caster2_spells_notes"></span>
                        <textarea name="attr_caster2_spells_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{caster2_spells_notes}"></textarea>
                    </div>
                </div> <!-- END CASTER CLASS 2 -->
            </div> <!-- END SPELLCASTING -->
        </div> <!-- END misc magic -->
        <div class="col2third spells"> <!-- SPELLS -->
            <div class="myrow center">
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="spells">Spells</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="myrow"> <!-- LVL 0-1 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_0" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 0 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-0">Level 0</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_0" value="0" /><span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_0" title="@{caster1_spells_prepared_level_0}"></span>
                                <span class="lbl">/</span> <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_0" title="@{caster1_spells_total_level_0}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_0" value="0" /><span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_0" title="@{caster2_spells_prepared_level_0}"></span>
                                <span class="lbl">/</span> <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_0" title="@{caster2_spells_total_level_0}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-0"> <!-- REPEATING 0 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="0" /><input type="hidden" name="attr_rollconcentration" /><button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <input type="hidden" name="attr_rollcontent" />
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp" name="attr_spelldisplay"></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-0_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-0_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span> <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-0_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" /><button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-0_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-0_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span> <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-0_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-0_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-0_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-0_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-0_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-0_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-0_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-0_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span> <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-0_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span> <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-0_$id_spelldc_mod}" />
                                        <span class="lbl">=</span> <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-0_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-0_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span> <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-0_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-0_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span> <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-0_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span> <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-0_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span> <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-0_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span> <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-0_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-0_$id_spelldmgflag}" /><span></span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span> <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-0_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span> <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-0_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-0_$id_spelldmg2flag}" /><span></span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span> <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-0_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span> <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-0_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-0_$id_spelldescflag}" checked="checked" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-0_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-0_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 0 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 0 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_1" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 1 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-1">Level 1</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_1" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_1" title="@{caster1_spells_prepared_level_1}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_1" title="@{caster1_spells_total_level_1}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_1" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_1" title="@{caster2_spells_prepared_level_1}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_1" title="@{caster2_spells_total_level_1}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-1"> <!-- REPEATING 1 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="1" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-1_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-1_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-1_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-1_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-1_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-1_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-1_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-1_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-1_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-1_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-1_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-1_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-1_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-1_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-1_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-1_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-1_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-1_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-1_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-1_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-1_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-1_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-1_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-1_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-1_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-1_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-1_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-1_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-1_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-1_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-1_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-1_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-1_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 1 LVL SPELL -->
                    </div>  <!-- END SPELLS LEVEL 1 -->
                </div> <!-- END LVL 0-1 -->
                <div class="myrow"> <!-- LVL 2-3 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_2" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 2 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-2">Level 2</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_2" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_2" title="@{caster1_spells_prepared_level_2}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_2" title="@{caster1_spells_total_level_2}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_2" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_2" title="@{caster2_spells_prepared_level_2}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_2" title="@{caster2_spells_total_level_2}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-2"> <!-- REPEATING 2 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="2" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-2_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-2_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-2_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-2_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-2_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-2_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-2_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-2_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-2_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-2_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-2_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-2_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-2_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-2_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-2_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-2_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-2_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-2_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-2_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-2_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-2_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-2_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-2_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-2_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-2_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-2_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-2_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-2_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-2_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-2_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-2_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-2_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-2_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 2 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 2 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_3" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 3 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-3">Level 3</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_3" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_3" title="@{caster1_spells_prepared_level_3}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_3" title="@{caster1_spells_total_level_3}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_3" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_3" title="@{caster2_spells_prepared_level_3}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_3" title="@{caster2_spells_total_level_3}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-3"> <!-- REPEATING 3 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="3" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-3_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-3_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-3_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-3_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-3_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-3_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-3_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-3_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-3_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-3_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-3_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-3_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-3_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-3_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-3_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-3_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-3_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-3_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-3_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-3_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-3_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-3_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-3_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-3_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-3_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-3_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-3_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-3_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-3_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-3_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-3_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-3_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 3 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 3 -->
                </div> <!-- END LVL 2-3 -->
                <div class="myrow"> <!-- LVL 4-5 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_4" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 4 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-4">Level 4</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_4" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_4" title="@{caster1_spells_prepared_level_4}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_4" title="@{caster1_spells_total_level_4}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_4" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_4" title="@{caster2_spells_prepared_level_4}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_4" title="@{caster2_spells_total_level_4}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-4"> <!-- REPEATING 4 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="4" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-4_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-4_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-4_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-4_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-4_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-4_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-4_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-4_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-4_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-4_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-4_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-4_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-4_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-4_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-4_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-4_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-4_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-4_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-4_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-4_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-4_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-4_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-4_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-4_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-4_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-4_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-4_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-4_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-4_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-4_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-4_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-4_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 2 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 4 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_5" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 5 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-5">Level 5</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_5" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_5" title="@{caster1_spells_prepared_level_5}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_5" title="@{caster1_spells_total_level_5}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_5" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_5" title="@{caster2_spells_prepared_level_5}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_5" title="@{caster2_spells_total_level_5}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-5"> <!-- REPEATING 5 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="5" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-5_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-5_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-5_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-5_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-5_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-5_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-5_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-5_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-5_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-5_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-5_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-5_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-5_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-5_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-5_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-5_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-5_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-5_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-5_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-5_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-5_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-5_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-5_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-5_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-5_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-5_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-5_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-5_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-5_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-5_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-5_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-5_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 1 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 5 -->
                </div> <!-- END LVL 4-5 -->
                <div class="myrow"> <!-- LVL 6-7 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_6" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 6 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-6">Level 6</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_6" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_6" title="@{caster1_spells_prepared_level_6}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_6" title="@{caster1_spells_total_level_6}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_6" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_6" title="@{caster2_spells_prepared_level_6}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_6" title="@{caster2_spells_total_level_6}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-6"> <!-- REPEATING 6 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="6" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-6_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-6_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-6_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-6_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-6_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-6_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-6_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-6_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-6_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-6_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-6_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-6_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-6_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-6_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-6_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-6_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-6_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-6_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-6_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-6_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-6_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-6_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-6_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-6_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-6_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-6_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-6_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-6_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-6_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-6_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-6_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-6_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 6 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 6 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_7" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 7 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-7">Level 7</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_7" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_7" title="@{caster1_spells_prepared_level_7}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_7" title="@{caster1_spells_total_level_7}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_7" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_7" title="@{caster2_spells_prepared_level_7}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_7" title="@{caster2_spells_total_level_7}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-7"> <!-- REPEATING 7 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="7" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-7_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-7_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-7_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-7_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-7_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-7_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-7_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-7_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-7_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-7_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-7_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-7_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-7_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-7_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-7_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-7_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-7_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-7_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-7_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-7_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-7_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-7_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-7_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-7_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-7_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-7_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-7_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-7_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-7_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-7_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-7_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-7_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 7 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 7 -->
                </div> <!-- END LVL 6-7 -->
                <div class="myrow"> <!-- LVL 8-9 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_8" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 8 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-8">Level 8</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_8" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_8" title="@{caster1_spells_prepared_level_8}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_8" title="@{caster1_spells_total_level_8}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_8" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_8" title="@{caster2_spells_prepared_level_8}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_8" title="@{caster2_spells_total_level_8}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-8"> <!-- REPEATING 8 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="8" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-8_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-8_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-8_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-8_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-8_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-8_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-8_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-8_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-8_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-8_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-8_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-8_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-8_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-8_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-8_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-8_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-8_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-8_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-8_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-8_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-8_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-8_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-8_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-8_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-8_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-8_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-8_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-8_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-8_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-8_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-8_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-8_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 8 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 8 -->
                    <input type="hidden" name="attr_caster_spells_flag_level_9" value="0" class="optional-flag0" /><div class="col1third optional inl"> <!-- SPELLS LEVEL 9 -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="level-9">Level 9</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <div class="myrow right"> <!-- Prepared count -->
                            <span class="lbl" data-i18n="prepared" data-i18n-title="prepared-times" title="Prepared # times">Prepared</span>
                            <input type="hidden" name="attr_caster1_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">1</span>
                                <input type="hidden" class="attr-flag" name="attr_caster1_spells_prepared_flag_9" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_prepared_level_9" title="@{caster1_spells_prepared_level_9}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster1_spells_total_level_9" title="@{caster1_spells_total_level_9}"></span>
                            </div>
                            <input type="hidden" name="attr_caster2_flag" value="0" class="optional-flag0" /><div class="optional inl margindent">
                                <span class="roundblack margindent">2</span>
                                <input type="hidden" class="attr-flag" name="attr_caster2_spells_prepared_flag_9" value="0" />
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_prepared_level_9" title="@{caster2_spells_prepared_level_9}"></span>
                                <span class="lbl">/</span>
                                <span class="prepared pseudoattr sml greybg underlined center" name="attr_caster2_spells_total_level_9" title="@{caster2_spells_total_level_9}"></span>
                            </div>
                        </div> <!-- End Prepared count -->
                        <fieldset class="repeating_spell-9"> <!-- REPEATING 9 LVL SPELL -->
                            <input type="hidden" name="attr_spelllevel" value="9" />
                            <input type="hidden" name="attr_rollconcentration" />
                            <button type="roll" name="roll_concentration" style="display: none;" value="@{rollconcentration}"></button>
                            <input type="hidden" name="attr_rollcontent" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow right">
                                    <span class="roundblack" name="attr_spellcaster"></span>
                                    <button class="myrol" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp"><span name="attr_spelldisplay"></span><input type="hidden" name="attr_spelldomaineflag" value="0" class="domain-flag" /><span></span></span></button>
                                    <input type="hidden" class="attr-flag" name="attr_spellprepared" /><span></span>
                                    <div class="dots">
                                        <input type="radio" name="attr_spellprepared" value="0" checked="checked" data-i18n-title="click-reset" title="Click to reset" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="1" data-i18n-title="prepared-once" title="Prepared once" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="2" data-i18n-title="prepared-twice" title="Prepared twice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="3" data-i18n-title="prepared-thrice" title="Prepared thrice" /><span></span>
                                        <input type="radio" name="attr_spellprepared" value="4" data-i18n-title="prepared-four-times" title="Prepared four times" /><span></span>
                                    </div>
                                </div>
                                <div class="options right">
                                    <input type="hidden" name="attr_spellmulticasters-flag" value="0" class="optional-flag0" /><div class="optional blk">
                                        <span class="lbl" data-18n="spellcaster-class">Spellcaster class</span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="1" title="@{repeating_spell-9_$id_spellcaster}" checked="checked" /><span></span>
                                        <span class="lbl">1.</span><span class="lbl" name="attr_spellcaster1_class"></span>
                                        <input type="radio" name="attr_spellcaster" class="pseudocheck" value="2" title="@{repeating_spell-9_$id_spellcaster}" /><span></span>
                                        <span class="lbl">2.</span><span class="lbl" name="attr_spellcaster2_class"></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-9_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="domaine-spell">Domain Spell</span>
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldomaineflag" value="1" title="@{repeating_spell-0_$id_spelldomaineflag}" /><span></span>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-9_$id_spellschool}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-9_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-9_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="components:">Components:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellcomponent"></span>
                                            <textarea name="attr_spellcomponent" accept="Components" class="underlined" spellcheck="false" data-i18n-placeholder="spellcomponent-ph" placeholder="V, S, M (a ball of bat guano and sulfur)" title="@{repeating_spell-9_$id_spellcomponent}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-9_$id_spellrange}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-9_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-9_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-9_$id_spelleffect}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-9_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-9_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-9_$id_spellsave}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <span class="lbl">+</span>
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-9_$id_spelldc_mod}" />
                                        <span class="lbl">=</span>
                                        <span class="pseudoattr greybg underlined number" name="attr_spelldc" title="@{repeating_spell-9_$id_spelldc}"></span>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-9_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-9_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-9_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <select class="underlined type" name="attr_spellatktype" title="@{repeating_spell-9_$id_spellatktype}">
                                            <option value="melee" data-i18n="touch">Touch</option>
                                            <option value="ranged" data-i18n="ranged-touch">Ranged Touch</option>
                                            <option value="cmb" data-i18n="cmb-u">CMB</option>
                                            <option value="strength" data-i18n="str-u">STR</option>
                                            <option value="dexterity" data-i18n="dex-u">DEX</option>
                                            <option value="constitution" data-i18n="con-u">CON</option>
                                            <option value="intelligence" data-i18n="int-u">INT</option>
                                            <option value="wisdom" data-i18n="wis-u">WIS</option>
                                            <option value="charisma" data-i18n="cha-u">CHA</option>
                                            <option value="0" selected="selected">-</option>
                                        </select>
                                        <span class="lbl">+</span>
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-9_$id_spellatkmod}" />
                                    </div>
                                    <div class="myrow padindent">
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-9_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-9_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-9_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-9_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-9_$id_spelldmgtype}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-9_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-9_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-9_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-9_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-9_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-9_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING 9 LVL SPELL -->
                    </div> <!-- END SPELLS LEVEL 9 -->
                </div> <!-- END LVL 8-9 -->
                <div class="myrow"> <!-- SPELL-LIKE and METAMAGIC -->
                    <div class="col1third"> <!-- SPELL-LIKE ABILITIES -->
                        <div class="blacklabel pnty">
                            <span class="big only" data-i18n="spell-like">Spell-Like</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        <fieldset class="repeating_spell-like"> <!-- REPEATING SPELL-LIKE -->
                            <input type="hidden" name="attr_spelllevel" value="like" />
                            <input type="hidden" name="attr_spellcaster" value="2" />
                            <div class="spell right compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <div class="myrow">
                                    <input type="hidden" name="attr_rollcontent" />
                                    <button class="myrol margindent" type="roll" name="roll_spell" data-i18n-title="cast-spell" title="Cast spell" value="@{rollcontent}"><span class="pseudoattr greybg underlined spelldsp" name="attr_spelldisplay"></span></button><input type="hidden" class="optional-flag0" name="attr_spellprepared" value="0" /><span class="optional inl">&nbsp;<input type="number" class="nospin spsml center" name="attr_perday" value="0" data-i18n-title="#-used" title="# used" /><span class="pseudoattr">/</span><span class="pseudoattr" name="attr_perday_max" data-i18n-title="max-#-per-day" title="Max # per day"></span></span>
                                </div>
                                <div class="options">
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_spellname" accept="Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_spell-like_$id_spellname}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                        <span class="spacer"></span>
                                        <input type="radio" name="attr_timesperday" class="pseudocheck" value="constant" title="@{repeating_spell-like_$id_timesperday}" /><span></span>
                                        <span class="lbl" data-i18n="constant">constant</span>
                                        <input type="radio" name="attr_timesperday" class="pseudocheck" value="at-will" title="@{repeating_spell-like_$id_timesperday}" checked="checked" /><span></span>
                                        <span class="lbl" data-i18n="at-will">at will</span>
                                        <input type="radio" name="attr_timesperday" class="pseudocheck" value="per-day" title="@{repeating_spell-like_$id_timesperday}" /><span></span>
                                        <span class="lbl" data-i18n="per-day">per day</span>
                                        <input type="number" class="nospin underlined spsml" name="attr_perday_max" value="1" title="@{repeating_spell-like_$id_perday_max}" />
                                        <span class="lbl std right" data-i18n="type:">Type:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltype"></span>
                                            <textarea name="attr_spelltype" class="underlined" spellcheck="false" data-i18n-placeholder="type" placeholder="Type" title="@{repeating_spell-like_$id_type}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <span class="lbl std right" data-i18n="school:">School:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellschool"></span>
                                            <textarea name="attr_spellschool" accept="School" class="underlined" spellcheck="false" data-i18n-placeholder="spellschool-ph" placeholder="School/Domain/Elemental school..." title="@{repeating_spell-like_$id_spellschool}"></textarea>
                                        </div>
                                        <span class="lbl std right" data-i18n="class-level:">Class/Level:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellclasslevel"></span>
                                            <textarea name="attr_spellclasslevel" accept="Level" class="underlined" spellcheck="false" data-i18n-placeholder="spellclasslevel-ph" placeholder="Sorcerer/Wizard 3" title="@{repeating_spell-like_$id_spellclasslevel}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="casting-time:">Casting time:</span>
                                        <input type="text" name="attr_spellcastingtime" accept="Casting Time" class="underlined std" spellcheck="false" data-i18n-placeholder="spellcastingtime-ph" placeholder="1 standard action" title="@{repeating_spell-like_$id_spellcastingtime}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <span class="lbl std right" data-i18n="range:">Range:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellrange"></span>
                                            <textarea name="attr_spellrange" accept="Range" class="underlined" spellcheck="false" data-i18n-placeholder="spellrange-ph" placeholder="Long (400 ft. + 40 ft./level)" title="@{repeating_spell-like_$id_spellrange}"></textarea>
                                        </div>
                                        <span class="lbl std right" data-i18n="area:">Area:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellarea"></span>
                                            <textarea name="attr_spellarea" accept="Area" class="underlined" spellcheck="false" data-i18n-placeholder="spellarea-ph" placeholder="20-ft.-radius spread" title="@{repeating_spell-like_$id_spellarea}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl std right" data-i18n="targets:">Targets:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelltargets"></span>
                                            <textarea name="attr_spelltargets" accept="Target" class="underlined" spellcheck="false" data-i18n-placeholder="spelltargets-ph" placeholder="up to five creatures" title="@{repeating_spell-like_$id_spelltargets}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <span class="lbl std right" data-i18n="effect:">Effect:</span>
                                        <div class="autoex std">
                                            <span name="attr_spelleffect"></span>
                                            <textarea name="attr_spelleffect" accept="Effect" class="underlined" spellcheck="false" data-i18n-placeholder="spelleffect-ph" placeholder="Heal [[1d6+@{caster1_level}]] HP" title="@{repeating_spell-like_$id_spelleffect}"></textarea>
                                        </div>
                                        <span class="lbl std right" data-i18n="duration:">Duration:</span>
                                        <div class="autoex std">
                                            <span name="attr_spellduration"></span>
                                            <textarea name="attr_spellduration" accept="Duration" class="underlined" spellcheck="false" data-i18n-placeholder="spellduration-ph" placeholder="Instantaneous" title="@{repeating_spell-like_$id_spellduration}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellsaveflag" value="{{save=1}}" title="@{repeating_spell-like_$id_spellsaveflag}" /><span></span>
                                        <span class="lbl med" data-i18n="saving-throw:">Saving Throw:</span>
                                        <input type="hidden" name="attr_spellsave_fromcompendium" value="" accept="Saving Throw" /><input type="text" name="attr_spellsave" class="underlined med" spellcheck="false" data-i18n-placeholder="spellsave-ph" placeholder="Reflex Half" title="@{repeating_spell-like_$id_spellsave}" />
                                        <span class="lbl margindent" data-i18n="dc-u" data-i18n-title="spell-save-dc" title="Spell Save DC">DC</span>
                                        <input type="hidden" name="attr_spelldc" value="0" />
                                        <input type="number" class="nospin underlined sml" name="attr_spelldc_mod" value="0" title="@{repeating_spell-like_$id_spelldc}" />
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellresistanceflag" value="{{sr=1}}" title="@{repeating_spell-like_$id_spellresistanceflag}" /><span></span>
                                        <span class="lbl med" data-i18n="spell-resistance:">Spell Resistance:</span>
                                        <input type="hidden" name="attr_spellresistance_fromcompendium" value="" accept="Spell Resistance" /><input type="text" name="attr_spellresistance" class="underlined med" spellcheck="false" title="@{repeating_spell-like_$id_spellresistance}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_spellatkflag" value="{{attack=1}}" title="@{repeating_spell-like_$id_spellatkflag}" /><span></span>
                                        <input type="hidden" name="attr_spellatk_fromcompendium" value="" accept="Spell Attack" />
                                        <span class="lbl" data-i18n="attack:">Attack:</span>
                                        <input type="hidden" name="attr_spellatktype" value="0" />
                                        <input type="text" class="underlined dmgbase" name="attr_spellatkmod" value="0" spellcheck="false" title="@{repeating_spell-like_$id_spellatkmod}" />
                                        <span class="lbl margindent" data-i18n="critical-range:" data-i18n-title="critical-range" title="Critical Range">Critical Range:</span>
                                        <input type="number" class="nospin underlined" name="attr_spellatkcritrange" value="20" title="@{repeating_spell-like_$id_spellatkcritrange}" />
                                        <span class="lbl" data-i18n="multiplier:" data-i18n-title="critical-multiplier" title="Critical Multiplier">Multiplier:</span>
                                        <input type="number" class="nospin underlined" name="attr_spelldmgcritmulti" value="2" title="@{repeating_spell-like_$id_spelldmgcritmulti}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmgflag" value="{{damage=1}} {{dmg1flag=1}}" title="@{repeating_spell-like_$id_spelldmgflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage:">Damage:</span>
                                        <input type="hidden" name="attr_spelldmg_fromcompendium" value="" accept="Spell Damage" />
                                        <input type="text" name="attr_spelldmg" class="underlined dmgbase" spellcheck="false" placeholder="1d6" title="@{repeating_spell-like_$id_spelldmg}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmgtype" accept="Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="fire" placeholder="Fire" title="@{repeating_spell-like_$id_spelldmgtype}" />
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldmg2flag" value="{{damage=1}} {{dmg2flag=1}}" title="@{repeating_spell-like_$id_spelldmg2flag}" /><span></span>
                                        <span class="lbl atk" data-i18n="damage2:">Damage2:</span>
                                        <input type="hidden" name="attr_spelldmg2_fromcompendium" value="" accept="Secondary Spell Damage" />
                                        <input type="text" name="attr_spelldmg2" class="underlined dmgbase" spellcheck="false" placeholder="1d4" title="@{repeating_spell-like_$id_spelldmg2}" />
                                        <span class="lbl right typ" data-i18n="type:">Type:</span>
                                        <input type="text" name="attr_spelldmg2type" accept="Secondary Spell Damage Type" class="underlined dmgtype" spellcheck="false" data-i18n-placeholder="force" placeholder="Force" title="@{repeating_spell-like_$id_spelldmg2type}" />
                                    </div>
                                    <div class="myrow grtopbrd">
                                        <input class="pseudocheck" type="checkbox" name="attr_spelldescflag" value="{{descflag=[[1]]}}" checked="checked" title="@{repeating_spell-like_$id_spelldescflag}" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_spelldesc"></span>
                                            <textarea name="attr_spelldesc" accept="Content" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_spell-like_$id_spelldesc}"></textarea>
                                        </div>
                                    </div>
                                    <span class="lbl" data-i18n="notes:">Notes:</span>
                                    <div class="autoex">
                                        <span name="attr_notes"></span>
                                        <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_spell-like_$id_notes}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </fieldset> <!-- END REPEATING SPELL-LIKE -->
                    </div> <!-- END SPELL-LIKE ABILITIES -->
                    <div class="col1third" style="text-align: right;"> <!-- METAMAGIC -->
                        <div class="blacklabel right">
                            <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                            <span class="big only" data-i18n="metamagic">Metamagic</span>
                        </div>
                        <fieldset class="repeating_metamagic">
                            <div class="myrow metamagic underlined compendium-drop-target">
                                <input class="options-flag" name="attr_options-flag" type="checkbox" data-i18n-title="show-hide-options" title="Show/hide options" checked="checked"><span>y</span>
                                <button class="myrol margindent" type="roll" name="roll_feat" data-i18n-title="show-feat" title="Show Feat" value="@{whispertype} &{template:pc} {{name=@{name}}} {{type=feat}} {{showchar=@{rollshowchar}}} {{charname=@{character_name}}} {{feattype=^{metamagic}}} {{prerequisites=@{prerequisites}}} {{benefits=@{benefits}}} {{normal=@{normal}}} {{special=@{special}}} @{descflag}"><span class="pseudoattr" name="attr_name"></span></button>
                                <div class="options">
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="name">Name</span>
                                        <input type="text" name="attr_name" accept="Feat Name" class="underlined" spellcheck="false" data-i18n-placeholder="name" placeholder="Name" title="@{repeating_metamagic_$id_name}" />
                                        <input type="hidden" name="attr_fromcompendium" accept="uniqueName" class="fromcompendium" value="" />
                                        <button class="myrol" type="compendium" name="attr_fromcompendium" data-i18n-title="open-compendium-item" title="Open Compendium Item"></button>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="prerequisites:">Prerequisites:</span>
                                        <div class="autoex">
                                            <span name="attr_prerequisites"></span>
                                            <textarea name="attr_prerequisites" class="underlined" spellcheck="false" title="@{repeating_metamagic_$id_prerequisites}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="benefits:">Benefits:</span>
                                        <div class="autoex">
                                            <span name="attr_benefits"></span>
                                            <textarea name="attr_benefits" accept="Benefit" accept="Prerequisites" class="underlined" spellcheck="false" title="@{repeating_metamagic_$id_benefits}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="normal:">Normal:</span>
                                        <div class="autoex">
                                            <span name="attr_normal"></span>
                                            <textarea name="attr_normal" accept="Normal" class="underlined" spellcheck="false" title="@{repeating_metamagic_$id_normal}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="special:">Special:</span>
                                        <div class="autoex">
                                            <span name="attr_special"></span>
                                            <textarea name="attr_special" accept="Special" class="underlined" spellcheck="false" title="@{repeating_metamagic_$id_special}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <input class="pseudocheck" type="checkbox" name="attr_descflag" value="{{descflag=[[1]]}}{{desc=@{description}}}" title="@{repeating_metamagic_$id_descflag}" checked="checked" /><span></span>
                                        <span class="lbl atk" data-i18n="description:">Description:</span>
                                        <div class="autoex">
                                            <span name="attr_description"></span>
                                            <textarea name="attr_description" accept="data-description" class="underlined" spellcheck="false" data-i18n-placeholder="description" placeholder="Description" title="@{repeating_metamagic_$id_description}"></textarea>
                                        </div>
                                    </div>
                                    <div class="myrow">
                                        <span class="lbl" data-i18n="notes:">Notes:</span>
                                        <div class="autoex">
                                            <span name="attr_notes"></span>
                                            <textarea name="attr_notes" spellcheck="false" data-i18n-placeholder="notes" placeholder="Notes" title="@{repeating_attacks_$id_notes}"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div> <!-- END METAMAGIC -->
                </div> <!-- END SPELL-LIKE and METAMAGIC -->
            </div>
        </div> <!-- END SPELLS -->
    </div> <!-- END TAB SPELLS -->
    <div class="tabconf"> <!-- TAB CONFIGURATION -->
        <div> <!-- CLASSES -->
            <div class="blacklabel pnty">
                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                <span class="big only" data-i18n="classes">Classes</span>
                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
            </div>
            <div class="bordered titled inbox">
                <div class="multiclass labline"> <!-- HEADERS -->
                    <div class="multiclass-a">&nbsp;</div>
                    <div class="multiclass-b">&nbsp;</div>
                    <div class="multiclass-c" style="text-align: center;">
                        <span class="lab spellcasting" data-i18n="skill-ranks">Skill Ranks</span>
                    </div>
                    <div class="multiclass-d" style="text-align: center;">
                        <span class="lab spellcasting" data-i18n="spellcasting">Spellcasting</span>
                    </div>
                </div>
                <div class="multiclass labline bord help "> <!-- SUBHEADERS -->
                    <div class="multiclass-a">
                        <span class="roundblack" data-i18n-title="class-number" title="Class number">#</span>
                        <span class="lab class" data-i18n="class" data-i18n-title="class-name" title="Class name">Class</span>
                        <span class="lab fav" data-i18n="f-u" data-i18n-title="favored-class" title="Favored Class">F</span>
                        <span class="lab" data-i18n="lvl" data-i18n-title="level" title="Level">Lvl</span>
                    </div>
                    <div class="multiclass-b">
                        <span class="lab hd" data-i18n="hd-u" data-i18n-title="hit-dice" title="Hit Dice">HD</span>
                        <span class="lab" data-i18n="bab-u" data-i18n-title="base-attack-bonus" title="Base Attack Bonus">BAB</span>
                        <span class="lab" data-i18n="fort-u" data-i18n-title="fortitude" title="Fortitude">FORT</span>
                        <span class="lab" data-i18n="ref-u" data-i18n-title="reflex" title="Reflex">REF</span>
                        <span class="lab" data-i18n="will-u" data-i18n-title="will" title="Will">WILL</span>
                        <span class="lab" data-i18n="speed" data-i18n-title="speed-bonus:" title="Speed Bonus:">Speed</span>
                    </div>
                    <div class="multiclass-c">
                        <span class="sheet-lab" style="width: 40px;" data-i18n="ranks">Ranks</span>
                        <span class="sheet-lab" style="width: 40px;" data-i18n="int-u" data-i18n-title="intelligence" title="Intelligence">INT</span>
                        <span class="sheet-lab" style="width: 40px;" data-i18n-title="per-level" title="per level">Per Lvl</span>
                        <span class="sheet-lab" style="width: 50px;" data-i18n-title="level" title="Level">Lvl</span>
                        <span class="sheet-lab" style="width: 30px;">Total</span>
                    </div>
                    <div class="multiclass-d">
                        <span class="lab spell" data-i18n="sc-u" data-i18n-title="spellcasting" title="Spellcasting">SC</span>
                        <span class="lab" data-i18n="cl-u" data-i18n-title="caster-level" title="Caster Level">CL</span>
                        <span class="lab ability" data-i18n="ability" data-i18n-title="casting-ability" title="Casting Ability">Ability</span>
                        <span class="lab" data-i18n="dc-u" data-i18n-title="save-dc-misc-bonus" title="Save DC Misc Bonus">DC</span>
                        <span class="lab fail" data-i18n="sf-u" data-i18n-title="armor-spell-failure" title="Armor spell failure">SF</span>
                    </div>
                </div>
                <div class="multiclass"> <!-- CLASS 1 -->
                    <div class="multiclass-a">
                        <span class="roundblack">1</span>
                        <input type="text" name="attr_class1_name" spellcheck="false" class="underlined medium" title="@{class1_name}" />
                        <input type="radio" name="attr_class_favored" class="pseudocheck" value="1" checked="checked" title="@{class_favored}" /><span></span>
                        <input type="number" name="attr_class1_level" value="1" class="nospin underlined sml" title="@{class1_level}" />
                    </div>
                    <div class="multiclass-b">
                        <select name="attr_class1_hitdietype" class="underlined" title="@{class1_hitdietype}">
                            <option value="4">D4</option>
                            <option value="6">D6</option>
                            <option value="8" selected="selected">D8</option>
                            <option value="10">D10</option>
                            <option value="12">D12</option>
                        </select>
                        <input type="number" name="attr_class1_bab" value="0" class="nospin underlined sml" title="@{class1_bab}" />
                        <input type="number" name="attr_class1_fortitude" value="0" class="nospin underlined sml" title="@{class1_fortitude}" />
                        <input type="number" name="attr_class1_reflex" value="0" class="nospin underlined sml" title="@{class1_reflex}" />
                        <input type="number" name="attr_class1_will" value="0" class="nospin underlined sml" title="@{class1_will}" />
                        <input type="number" name="attr_class1_speed" value="0" class="nospin underlined sml" title="@{class1_speed}" />
                    </div>
                    <div class="multiclass-c">
                        (<input type="number" name="attr_class1_skillranks_base" value="0" class="nospin underlined sml" title="@{class1_skillranks_base}" />
                        +
                        <span name="attr_intelligence_mod" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{intelligence_mod}"></span>
                        = <input type="hidden" name="attr_class1_skillranks_perlevel" value="0" />
                        <span name="attr_class1_skillranks_perlevel" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class1_skillranks_perlevel}"></span>)
                        x <span name="attr_class1_level" class="pseudoattr greybg underlined center" style="width: 30px;" data-i18n-title="level" title="Level"></span>
                        = <input type="hidden" name="attr_class1_skillranks" value="0" />
                        <span name="attr_class1_skillranks" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class1_skillranks}"></span>
                    </div>
                    <div class="multiclass-d">
                        <span class="spell"> <input class="pseudocheck" type="checkbox" name="attr_caster1_flag" value="1" title="@{caster1_flag}" /><span></span> </span>
                        <input type="number" name="attr_caster1_level" value="0" class="nospin underlined sml" title="@{caster1_level}" />
                        <select name="attr_caster1_ability" class="underlined ability" title="@{caster1_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                        <input type="number" name="attr_caster1_dc_misc" value="0" class="nospin sml underlined" title="@{caster1_dc_misc}" />
                        <input class="pseudocheck" type="checkbox" name="attr_caster1_spell_failure" value="1" title="@{caster1_spell_failure}" checked="checked" /><span></span>
                    </div>
                </div>
                <div class="multiclass"> <!-- CLASS 2 -->
                    <div class="multiclass-a">
                        <span class="roundblack">2</span> <input type="text" name="attr_class2_name" spellcheck="false" class="underlined medium" title="@{class2_name}" />
                        <input type="radio" name="attr_class_favored" class="pseudocheck" value="2" title="@{class_favored}" /><span></span>
                        <input type="number" name="attr_class2_level" value="0" class="nospin underlined sml" title="@{class2_level}" />
                    </div>
                    <div class="multiclass-b">
                        <select name="attr_class2_hitdietype" class="underlined" title="@{class2_hitdietype}">
                            <option value="4">D4</option>
                            <option value="6">D6</option>
                            <option value="8" selected="selected">D8</option>
                            <option value="10">D10</option>
                            <option value="12">D12</option>
                        </select>
                        <input type="number" name="attr_class2_bab" value="0" class="nospin underlined sml" title="@{class2_bab}" />
                        <input type="number" name="attr_class2_fortitude" value="0" class="nospin underlined sml" title="@{class2_fortitude}" />
                        <input type="number" name="attr_class2_reflex" value="0" class="nospin underlined sml" title="@{class2_reflex}" />
                        <input type="number" name="attr_class2_will" value="0" class="nospin underlined sml" title="@{class2_will}" />
                        <input type="number" name="attr_class2_speed" value="0" class="nospin underlined sml" title="@{class2_speed}" />
                    </div>
                    <div class="multiclass-c">
                        (<input type="number" name="attr_class2_skillranks_base" value="0" class="nospin underlined sml" title="@{class2_skillranks_base}" />
                        +
                        <span name="attr_intelligence_mod" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{intelligence_mod}"></span>
                        = <input type="hidden" name="attr_class2_skillranks_perlevel" value="0" />
                        <span name="attr_class2_skillranks_perlevel" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class2_skillranks_perlevel}"></span>)
                        x <span name="attr_class2_level" class="pseudoattr greybg underlined center" style="width: 30px;" data-i18n-title="level" title="Level"></span>
                        = <input type="hidden" name="attr_class2_skillranks" value="0" />
                        <span name="attr_class2_skillranks" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class2_skillranks}"></span>
                    </div>
                    <div class="multiclass-d">
                        <span class="spell"> <input class="pseudocheck" type="checkbox" name="attr_caster2_flag" value="1" title="@{caster2_flag}" /><span></span> </span>
                        <input type="number" name="attr_caster2_level" value="0" class="nospin underlined sml" title="@{caster2_level}" />
                        <select name="attr_caster2_ability" class="underlined ability" title="@{caster2_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence" selected="selected">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                        <input type="number" name="attr_caster2_dc_misc" value="0" class="nospin sml underlined" title="@{caster2_dc_misc}" />
                        <input class="pseudocheck" type="checkbox" name="attr_caster2_spell_failure" value="1" title="@{caster2_spell_failure}" checked="checked" /><span></span>

                    </div>
                </div>
                <div class="multiclass"> <!-- CLASS 3 -->
                    <div class="multiclass-a">
                        <span class="roundblack">3</span> <input type="text" name="attr_class3_name" spellcheck="false" class="underlined medium" title="@{class3_name}" />
                        <input type="radio" name="attr_class_favored" class="pseudocheck" value="3" title="@{class_favored}" /><span></span>
                        <input type="number" name="attr_class3_level" value="0" class="nospin underlined sml" title="@{class3_level}" />
                    </div>
                    <div class="multiclass-b">
                        <select name="attr_class3_hitdietype" class="underlined" title="@{class3_hitdietype}">
                            <option value="4">D4</option>
                            <option value="6">D6</option>
                            <option value="8" selected="selected">D8</option>
                            <option value="10">D10</option>
                            <option value="12">D12</option>
                        </select>
                        <input type="number" name="attr_class3_bab" value="0" class="nospin underlined sml" title="@{class3_bab}" />
                        <input type="number" name="attr_class3_fortitude" value="0" class="nospin underlined sml" title="@{class3_fortitude}" />
                        <input type="number" name="attr_class3_reflex" value="0" class="nospin underlined sml" title="@{class3_reflex}" />
                        <input type="number" name="attr_class3_will" value="0" class="nospin underlined sml" title="@{class3_will}" />
                        <input type="number" name="attr_class3_speed" value="0" class="nospin underlined sml" title="@{class3_speed}" />
                    </div>
                    <div class="multiclass-c">
                        (<input type="number" name="attr_class3_skillranks_base" value="0" class="nospin underlined sml" title="@{class3_skillranks_base}" />
                        +
                        <span name="attr_intelligence_mod" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{intelligence_mod}"></span>
                        = <input type="hidden" name="attr_class3_skillranks_perlevel" value="0" />
                        <span name="attr_class3_skillranks_perlevel" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class3_skillranks_perlevel}"></span>)
                        x <span name="attr_class3_level" class="pseudoattr greybg underlined center" style="width: 30px;" data-i18n-title="level" title="Level"></span>
                        = <input type="hidden" name="attr_class3_skillranks" value="0" />
                        <span name="attr_class3_skillranks" class="pseudoattr greybg underlined center" style="width: 30px;" title="@{class3_skillranks}"></span>
                    </div>
                    <div class="multiclass-d">
                        &nbsp;
                    </div>
                </div>
                <div class="multiclass topspace"> <!-- TOTALS -->
                    <div class="multiclass-a">
                        <div class="boxed greybg"><span name="attr_level" class="pseudoattr" title="@{level}"></span></div>
                    </div>
                    <div class="multiclass-b">
                        <div class="boxed greybg" style="margin-left: 27px;"><span name="attr_bab" class="pseudoattr" title="@{bab}"></span></div>
                        <div class="boxed greybg"><span name="attr_fortitude_base" class="pseudoattr" title="@{fortitude_base}"></span></div>
                        <div class="boxed greybg"><span name="attr_reflex_base" class="pseudoattr" title="@{reflex_base}"></span></div>
                        <div class="boxed greybg"><span name="attr_will_base" class="pseudoattr" title="@{will_base}"></span></div>
                        <div class="boxed greybg">
                            <input type="hidden" name="speed_class" value="0" />
                            <span name="attr_speed_class" class="pseudoattr" title="@{speed_class}"></span>
                        </div>
                    </div>
                    <div class="multiclass-c">
                        <input type="hidden" name="attr_skills_ranks_total_max" value="0" />
                        <div class="boxed greybg"><span name="attr_skills_ranks_total_max" class="pseudoattr" title="@{skills_ranks_total_max}"></span></div>
                    </div>
                    <div class="multiclass-d">
                        &nbsp;
                    </div>
                </div>
            </div>
        </div> <!-- END CLASSES -->
        <div class="col2third">
            <div class="topspace col1third"> <!-- RACE, AC, SAVES and ATTACKS -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="race">Race</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <span data-i18n="race-ability-modifiers">Race Ability Modifiers</span>:
                    <div class="myrow">
                        <span class="margindent" data-i18n="str-u">STR</span> <input type="number" name="attr_strength_race" value="0" class="nospin sml underlined" title="@{strength_race}" />
                        <span class="margindent" data-i18n="dex-u">DEX</span> <input type="number" name="attr_dexterity_race" value="0" class="nospin sml underlined" title="@{dexterity_race}" />
                        <span class="margindent" data-i18n="con-u">CON</span> <input type="number" name="attr_constitution_race" value="0" class="nospin sml underlined" title="@{constitution_race}" />
                    </div>
                    <div class="myrow">
                        <span class="margindent" data-i18n="int-u">INT</span> <input type="number" name="attr_intelligence_race" value="0" class="nospin sml underlined" title="@{intelligence_race}" />
                        <span class="margindent" data-i18n="wis-u">WIS</span> <input type="number" name="attr_wisdom_race" value="0" class="nospin sml underlined" title="@{wisdom_race}" />
                        <span class="margindent" data-i18n="cha-u">CHA</span> <input type="number" name="attr_charisma_race" value="0" class="nospin sml underlined" title="@{charisma_race}" />
                    </div>
                    <div class="myrow">
                        <span data-i18n="speed">Speed</span>: <input type="number" name="attr_speed_race" value="30" class="nospin sml underlined" title="@{speed_race}" /> <span data-i18n="ft.">Ft.</span>
                    </div>
                    <div class="myrow padindent">
                        <input class="pseudocheck" type="checkbox" name="attr_speed_notmodified" value="1" title="@{speed_notmodified}" /><span></span>
                        <span data-i18n="speed-never-modified">Never modified by armor or encumbrance</span>
                    </div>
                </div>
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="armor-class">Armor Class</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="myrow padindent">
                        <span data-i18n="primary-ability-modifier">Primary ability modifier</span>: <select name="attr_ac_ability_primary" class="underlined" title="@{ac_ability_primary}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent">
                        <span data-i18n="secondary-ability-modifier">Secondary ability modifier</span>: <select name="attr_ac_ability_secondary" class="underlined" title="@{ac_ability_secondary}">
                            <option value="none" data-i18n="none" selected="selected">None</option>
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_ac_noflatflooted" value="1" title="@{ac_noflatflooted}" /><span></span><span data-i18n="cannot-be-caught-flat-footed">Cannot be caught Flat-Footed</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_ac_touchshield" value="1" title="@{ac_touchshield}" /><span></span><span data-i18n="shield-bonus-added-to-touch-ac">Shield bonus added to Touch AC</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_ac_secab_monk" value="1" title="@{ac_secab_monk}" /><span></span><span data-i18n="secondary-ability-monk-rule" data-i18n-title="secondary-ability-monk-rule-t" title="If checked, secondary ability modifier is added to Flat-Footed AC, and is still used in AC calculation, even when some conditions deny Ability mod to AC.">Sec. ab. mod: apply Monk's AC Bonus rules</span></div>
                </div>
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="saving-throws">Saving Throws</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="myrow padindent">
                        <span data-i18n="fortitude-ability">Fortitude Ability</span>: <select name="attr_fortitude_ability" class="underlined" title="@{fortitude_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution" selected="selected">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent">
                        <span data-i18n="reflex-ability">Reflex Ability</span>: <select name="attr_reflex_ability" class="underlined" title="@{reflex_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent">
                        <span data-i18n="will-ability">Will Ability</span>: <select name="attr_will_ability" class="underlined" title="@{will_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom" selected="selected">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                </div>
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="attacks">Attacks</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <div class="myrow padindent">
                        <span data-i18n="cmb-ability">CMB Ability</span>: <select name="attr_cmb_ability" class="underlined" title="@{cmb_ability}">
                            <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent">
                        <span data-i18n="melee-ability">Melee Ability</span>: <select name="attr_melee_ability" class="underlined" title="@{melee_ability}">
                            <option value="strength" data-i18n="strength" selected="selected">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                    <div class="myrow padindent">
                        <span data-i18n="ranged-ability">Ranged Ability</span>: <select name="attr_ranged_ability" class="underlined" title="@{ranged_ability}">
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity" selected="selected">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </div>
                </div>
            </div> <!-- END RACE, AC, SAVES and ATTACKS -->
            <div class="col1third"> <!-- SKILLS -->
                <div class="blacklabel pnty">
                    <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                    <span class="big only" data-i18n="skills">Skills</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                <div class="bordered titled inbox">
                    <span data-i18n="show">Show</span>:
                    <div data-i18n-list="skills-list">
                        <div class="myrow padindent" data-i18n-list-item="acrobatics">
                            <input class="pseudocheck" type="checkbox" name="attr_acrobatics_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="acrobatics">Acrobatics</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="appraise">
                            <input class="pseudocheck" type="checkbox" name="attr_appraise_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="appraise">Appraise</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="bluff">
                            <input class="pseudocheck" type="checkbox" name="attr_bluff_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="bluff">Bluff</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="climb">
                            <input class="pseudocheck" type="checkbox" name="attr_climb_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="climb">Climb</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="craft">
                            <input class="pseudocheck" type="checkbox" name="attr_craft_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="craft">Craft</span>
                        </div><div style="display: none;" data-i18n-list-item="craft-rep"></div>
                        <div class="myrow padindent" data-i18n-list-item="diplomacy">
                            <input class="pseudocheck" type="checkbox" name="attr_diplomacy_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="diplomacy">Diplomacy</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="disable_device">
                            <input class="pseudocheck" type="checkbox" name="attr_disable_device_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="disable_device">Disable Device*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="disguise">
                            <input class="pseudocheck" type="checkbox" name="attr_disguise_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="disguise">Disguise</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="escape_artist">
                            <input class="pseudocheck" type="checkbox" name="attr_escape_artist_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="escape_artist">Escape Artist</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="fly">
                            <input class="pseudocheck" type="checkbox" name="attr_fly_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="fly">Fly</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="handle_animal">
                            <input class="pseudocheck" type="checkbox" name="attr_handle_animal_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="handle_animal">Handle Animal*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="heal">
                            <input class="pseudocheck" type="checkbox" name="attr_heal_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="heal">Heal</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="intimidate">
                            <input class="pseudocheck" type="checkbox" name="attr_intimidate_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="intimidate">Intimidate</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_arcana">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_arcana_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_arcana">Knowledge (Arcana)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_dungeoneering">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_dungeoneering_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_dungeoneering">Knowledge (Dungeoneering)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_engineering">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_engineering_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_engineering">Knowledge (Engineering)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_geography">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_geography_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_geography">Knowledge (Geography)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_history">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_history_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_history">Knowledge (History)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_local">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_local_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_local">Knowledge (Local)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_nature">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_nature_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_nature">Knowledge (Nature)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_nobility">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_nobility_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_nobility">Knowledge (Nobility)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_planes">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_planes_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_planes">Knowledge (Planes)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge_religion">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_religion_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_religion">Knowledge (Religion)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="knowledge-rep">
                            <input class="pseudocheck" type="checkbox" name="attr_knowledge_custom_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="knowledge_custom">Knowledge (Custom)*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="linguistics">
                            <input class="pseudocheck" type="checkbox" name="attr_linguistics_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="linguistics">Linguistics*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="perception">
                            <input class="pseudocheck" type="checkbox" name="attr_perception_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="perception">Perception</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="perform">
                            <input class="pseudocheck" type="checkbox" name="attr_perform_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="perform">Perform</span>
                        </div><div style="display: none;" data-i18n-list-item="perform-rep"></div>
                        <div class="myrow padindent" data-i18n-list-item="profession">
                            <input class="pseudocheck" type="checkbox" name="attr_profession_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="profession">Profession</span>
                        </div><div style="display: none;" data-i18n-list-item="profession-rep"></div>
                        <div class="myrow padindent" data-i18n-list-item="ride">
                            <input class="pseudocheck" type="checkbox" name="attr_ride_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="ride">Ride</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="sense_motive">
                            <input class="pseudocheck" type="checkbox" name="attr_sense_motive_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="sense_motive">Sense Motive</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="sleight_of_hand">
                            <input class="pseudocheck" type="checkbox" name="attr_sleight_of_hand_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="sleight_of_hand">Sleight of Hand*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="spellcraft">
                            <input class="pseudocheck" type="checkbox" name="attr_spellcraft_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="spellcraft">Spellcraft*</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="stealth">
                            <input class="pseudocheck" type="checkbox" name="attr_stealth_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="stealth">Stealth</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="survival">
                            <input class="pseudocheck" type="checkbox" name="attr_survival_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="survival">Survival</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="swim">
                            <input class="pseudocheck" type="checkbox" name="attr_swim_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="swim">Swim</span>
                        </div>
                        <div class="myrow padindent" data-i18n-list-item="use_magic_device">
                            <input class="pseudocheck" type="checkbox" name="attr_use_magic_device_view_flag" value="1" checked="checked"/><span></span>
                            <span data-i18n="use_magic_device">Use Magic Device*</span>
                        </div><div style="display: none;" data-i18n-list-item="custom-rep"></div>
                    </div>
                </div>
            </div> <!-- END SKILLS -->
        </div>
        <div class="col1third"> <!-- ROLLS, MISC and MANCER -->
            <div class="blacklabel pnty">
                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                <span class="big only" data-i18n="rolls">Rolls</span>
                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
            </div>
            <div class="bordered titled inbox">
                <input class="pseudocheck" type="checkbox" name="attr_rollshowchar" value="[[1]]" title="@{rollshowchar}" checked="checked" /><span></span><span data-i18n="show-character-name">Show character name</span>
                <div class="myrow">
                    <span data-i18n="whisp-rolls-gm:">Whisper Rolls to GM:</span> <select name="attr_whispertype" class="underlined" title="@{whispertype}">
                        <option value="" data-i18n="never-whisper-roll" selected="selected">Never Whisper Rolls</option>
                        <option value="?{@{ask_whisper}|@{ask_public_roll},|@{ask_whisper_roll},/w gm }" data-i18n="query-whisper-roll">Query Whisper</option>
                        <option value="/w gm " data-i18n="always-whisper-roll">Always Whisper Rolls</option>
                    </select>
                </div>
                <span class="block" data-i18n="query-modifier">Query modifier for:</span>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_ability" value="?{@{ask_modifier}|0}" title="@{rollmod_ability}" /><span></span><span data-i18n="ability-rolls">Ability Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_initiative" value="?{@{ask_modifier}|0}" title="@{rollmod_initiative}" /><span></span><span data-i18n="initiative-rolls">Initiative Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_save" value="?{@{ask_modifier}|0}" title="@{rollmod_save}" /><span></span><span data-i18n="save-concentration-rolls">Saving Throw & Concentration Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_skill" value="?{@{ask_modifier}|0}" title="@{rollmod_skill}" /><span></span><span data-i18n="skill-rolls">Skill Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_attack" value="?{@{ask_atk_modifier}|0}" title="@{rollmod_attack}" /><span></span><span data-i18n="attack-rolls">Attack & CMB Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollmod_damage" value="?{@{ask_dmg_modifier}|0}" title="@{rollmod_damage}" /><span></span><span data-i18n="damage-rolls">Damage Rolls</span></div>
                <span class="block" data-i18n="show-notes-in">Show Notes in:</span>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_ability" value="[[1]]" checked="checked" title="@{rollnotes_ability}" /><span></span><span data-i18n="ability-rolls">Ability Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_initiative" value="[[1]]" checked="checked" title="@{rollnotes_initiative}" /><span></span><span data-i18n="initiative-rolls">Initiative Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_save" value="[[1]]" checked="checked" title="@{rollnotes_save}" /><span></span><span data-i18n="save-concentration-rolls">Saving Throw & Concentration Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_skill" value="[[1]]" checked="checked" title="@{rollnotes_skill}" /><span></span><span data-i18n="skill-rolls">Skill Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_attack" value="[[1]]" checked="checked" title="@{rollnotes_attack}" /><span></span><span data-i18n="attack-rolls">Attack & CMB Rolls</span></div>
                    <div class="myrow padindent"><input class="pseudocheck" type="checkbox" name="attr_rollnotes_spell" value="[[1]]" checked="checked" title="@{rollnotes_spell}" /><span></span><span data-i18n="spell-rolls">Spell Rolls</span></div>
            </div>
            <div class="topspace blacklabel pnty">
                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                <span class="big only" data-i18n="misc-u">MISC</span>
                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
            </div>
            <div class="bordered titled inbox">
                <input class="pseudocheck" type="checkbox" name="attr_npc" value="1" title="@{npc}" /><span></span><span data-i18n="npc-monster-statblock">NPC/Monster Statblock</span>
            </div>
            <div class="blacklabel pnty">
                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                <span class="big only">Charactermancer</span>
                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
            </div>
            <div class="bordered titled inbox">
                <div class="myrow center">
                    <button type="action" class="myrol" name="act_relaunch_lvl1mancer">
                        <img style="height: 32px; width: 32px" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/CharactermancerIcon200px.png" />
                    </button>
                    <span data-i18n="relaunch-lvl1mancer">Launch Level 1 Charactermancer</span>
                    <span data-i18n="cannot-be-undone-u">(CANNOT BE UNDONE)</span>
                </div>
            </div>
            <div class="topspace myrow right">
                <span data-i18n="version">Version</span>
                <span name="attr_version"></span>
                <input type="checkbox" class="invisible" name="attr_debug_mode" value="1" title="Debug mode on/off - see Console log" />
            </div>
        </div> <!-- END ROLLS and MISC -->
    </div> <!-- END TAB CONFIGURATION -->
</div>  <!-- END PC SHEET -->

<!-- LICENCE -->
<span style="text-align: center;margin-top: 6px;font-family: sans-serif;font-size: 0.8em;">&copy; 2018. Pathfinder, their respective logos, the Paizo golem, all Paizo titles, the Pathfinder Roleplaying Game rules, and Paizos character names and distinctive likenesses are property and copyright of Paizo, Inc. in the United States and other countries.</span>

<!-- HIDDEN ATTRIBUTES -->
<div style="display: none;">
    <input type="hidden" name="none_mod" value="0" />
    <input type="hidden" name="cd_bar1_v" value="hp_max" />
    <input type="hidden" name="cd_bar1_m" value="hp_max" />
    <input type="hidden" name="cd_bar1_l" value="" />
    <input type="hidden" name="cd_bar2_v" value="" />
    <input type="hidden" name="cd_bar2_m" value="" />
    <input type="hidden" name="cd_bar2_l" value="" />
    <input type="hidden" name="cd_bar3_v" value="" />
    <input type="hidden" name="cd_bar3_m" value="" />
    <input type="hidden" name="cd_bar3_l" value="ac" />
    <input type="hidden" name="attr_ask_modifier" value="Modifier" />
    <input type="hidden" name="attr_ask_atk_modifier" value="Attack Modifier" />
    <input type="hidden" name="attr_ask_dmg_modifier" value="Damage Modifier" />
    <input type="hidden" name="attr_ask_whisper" value="Whisper?" />
    <input type="hidden" name="attr_ask_public_roll" value="Public Roll" />
    <input type="hidden" name="attr_ask_whisper_roll" value="Whisper Roll" />
    <input type="hidden" name="attr_conditions_display" value="" />
    <input type="hidden" name="attr_skill_condition_note" value="" />
    <input type="hidden" name="attr_perception_condition_note" value="" />
    <input type="hidden" name="attr_attack_condition_note" value="" />
    <input type="hidden" name="attr_cmb_condition_note" value="" />
    <input type="hidden" name="attr_damage_condition_note" value="" />
    <input type="hidden" name="attr_spell_condition_note" value="" />
    <input type="hidden" name="attr_speed_condition_multiplier" value="1" />
    <input type="hidden" name="attr_speed_condition_nospeed" value="0" />
    <input type="hidden" name="attr_l1mancer_status" value="" />
</div>

<!-- HIDDEN TRANSLATION TEXT -->
<div style="display: none;">
    <span data-i18n="combat-maneuver">Combat Maneuver</span>
    <span data-i18n="light-load">Light load</span>
    <span data-i18n="medium-load">Medium load</span>
    <span data-i18n="heavy-load">Heavy load</span>
    <span data-i18n="over-load">Overload</span>
    <span data-i18n="success">Success</span>
    <span data-i18n="failure">Failure</span>
    <span data-i18n="caster-level">Caster Level</span>
    <span data-i18n="ask-modifier">Modifier</span>
    <span data-i18n="ask-atk-modifier">Attack Modifier</span>
    <span data-i18n="ask-dmg-modifier">Damage Modifier</span>
    <span data-i18n="ask-whisper">Whisper?</span>
    <span data-i18n="ask-public-roll">Public Roll</span>
    <span data-i18n="ask-whisper-roll">Whisper Roll</span>
    <span data-i18n="bonus-dice">Bonus Dice</span>
    <span data-i18n="mod">Mod</span>
    <span data-i18n="#1">#1</span>
    <span data-i18n="#2">#2</span>
    <span data-i18n="#3">#3</span>
    <span data-i18n="#4">#4</span>
    <span data-i18n="#5">#5</span>
    <span data-i18n="#6">#6</span>
    <span data-i18n="#7">#7</span>
    <span data-i18n="#8">#8</span>
    <span data-i18n="#9">#9</span>
    <span data-i18n="blinded-skills">Blinded: 4 penalty on most STR and DEX based skill checks.</span>
    <span data-i18n="blinded-perception">Blinded: 4 penalty on opposed Perception skill checks.</span>
    <span data-i18n="dazzled-perception">Dazzled: 1 penalty on sight-based Perception checks.</span>
    <span data-i18n="deafened-perception">Deafened: automatically fails Perception checks based on sound, takes a 4 penalty on opposed Perception checks.</span>
    <span data-i18n="deafened-spell">Deafened: 20% chance of spell failure when casting spells with verbal components.</span>
    <span data-i18n="fascinated-skills">Fascinated: 4 penalty on skill checks made as reactions, such as Perception checks.</span>
    <span data-i18n="grappled-cmb">Grappled: 2 penalty on all combat maneuver checks, except those made to grapple or escape a grapple.</span>
    <span data-i18n="invisible-attack">Invisible: +2 bonus on attack rolls against sighted opponents, and ignores its opponents' Dexterity bonuses to AC (if any).</span>
    <span data-i18n="prone-defender">Prone defender: +4 bonus to AC against ranged attacks, 4 penalty to AC against melee attacks.</span>
    <span data-i18n="prone-attacker">Prone attacker: 4 penalty on melee attack rolls and cannot use a ranged weapon (except for a crossbow).</span>
    <span data-i18n="sickened-damage">Sickened: 2 penalty on weapon damage rolls.</span>
    <span data-i18n="attack">Attack</span>
    <span data-i18n="crit-confirm">Crit confirm</span>
    <span data-i18n="critical-damage">Critical damage</span>
    <span data-i18n="damage2">Damage2</span>
</div>

<!-- === SHEET ROLL TEMPLATES === -->
<rolltemplate class="sheet-rolltemplate-pc">
    {{#name}}
        {{#rollTotal() showchar 1}}
            <div class="charname smallname bold">{{charname}}</div>
        {{/rollTotal() showchar 1}}
    {{/name}}
    {{#smallname}}
        <div class="charname smallname bold">
            {{#rollTotal() showchar 1}}{{charname}} /{{/rollTotal() showchar 1}}
            {{smallname}}
        </div>
    {{/smallname}}
    <div class="bordered">
        {{#type}}<div class="sheet-icon sheet-{{type}}"></div>{{/type}}
        {{#name}}
            <div class="vtop">
                <div class="blacklabel top">
                    <span class="big">{{name}}</span>
                    {{#feattype}}<span class="med">({{feattype}})</span>{{/feattype}}
                    {{#abilitytype}}<span class="med">({{abilitytype}})</span>{{/abilitytype}}
                    {{#atkvs}}<span class="med">{{atkvs}}</span>{{/atkvs}}
                    {{#casterclass}}<span class="med">({{casterclass}}</span>{{#level}}<span class="med"> {{level}}</span>{{/level}}<span class="med">)</span>{{/casterclass}}
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{^roll1}}{{#roll}}<div class="resright">{{roll}}</div>{{/roll}}{{/roll1}}
            </div>
            {{^roll1}}
                {{#attack}}
                    {{#rollWasCrit() roll}}
                        <div class="right vtop">
                            <span class="symbol">t</span>
                            {{critconfirm}}
                            <div class="blacklabel med right yellow">
                                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                                <span data-i18n="crit-confirm">Crit confirm</span>
                            </div>
                        </div>
                    {{/rollWasCrit() roll}}
                {{/attack}}
            {{/roll1}}
        {{/name}}
        {{#attack}}
            {{#roll1}}
                {{#roll}}
                    <div class="flexatk">
                        <div class="blacklabel med">
                            <span data-i18n="attack">Attack</span>
                            <span data-i18n="#1">#1</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll}}
                        <div class="spacer"></div>
                        {{#rollWasCrit() roll}}
                            <span class="symbol">t</span>
                            {{critconfirm}}
                            <div class="blacklabel med right yellow">
                                <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                                <span data-i18n="crit-confirm">Crit confirm</span>
                            </div>
                        {{/rollWasCrit() roll}}
                    </div>
                    {{#rolldmg1}}
                        <div class="flexdmg">
                            <div class="blacklabel med yellow">
                                <span data-i18n="damage">Damage</span>
                                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                            </div>
                            {{rolldmg1}}
                            {{#rolldmg1crit}}{{#rollWasCrit() roll}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{rolldmg1crit}}
                            {{/rollWasCrit() roll}}{{/rolldmg1crit}}
                            <span class="notes inl">{{rolldmg1type}}</span>
                        </div>
                    {{/rolldmg1}}
                    {{#rolldmg2}}
                        <div class="flexdmg">
                            <div class="blacklabel med yellow">
                                <span data-i18n="damage2">Damage2</span>
                                <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                            </div>
                            {{rolldmg2}}
                            {{#rolldmg2crit}}{{#rollWasCrit() roll}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{rolldmg2crit}}
                            {{/rollWasCrit() roll}}{{/rolldmg2crit}}
                            <span class="notes inl">{{rolldmg2type}}</span>
                        </div>
                    {{/rolldmg2}}
                {{/roll}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#2">#2</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                    {{roll1}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll1}}
                        <span class="symbol">t</span>
                        {{critconfirm1}}
                        <div class="blacklabel med right yellow">
                            <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll1}}
                </div>
                {{#roll1dmg1}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll1dmg1}}
                        {{#roll1dmg1crit}}{{#rollWasCrit() roll1}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll1dmg1crit}}
                        {{/rollWasCrit() roll1}}{{/roll1dmg1crit}}
                        <span class="notes inl">{{roll1dmg1type}}</span>
                    </div>
                {{/roll1dmg1}}
                {{#roll1dmg2}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll1dmg2}}
                        {{#roll1dmg2crit}}{{#rollWasCrit() roll1}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll1dmg2crit}}
                        {{/rollWasCrit() roll1}}{{/roll1dmg2crit}}
                        <span class="notes inl">{{roll1dmg2type}}</span>
                    </div>
                {{/roll1dmg2}}
            {{/roll1}}
            {{#roll2}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#3">#3</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                    {{roll2}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll2}}
                        <span class="symbol">t</span>
                        {{critconfirm2}}
                        <div class="blacklabel med right yellow">
                            <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll2}}
                </div>
                {{#roll2dmg1}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll2dmg1}}
                        {{#roll2dmg1crit}}{{#rollWasCrit() roll2}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll2dmg1crit}}
                        {{/rollWasCrit() roll2}}{{/roll2dmg1crit}}
                        <span class="notes inl">{{roll2dmg1type}}</span>
                    </div>
                {{/roll2dmg1}}
                {{#roll2dmg2}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll2dmg2}}
                        {{#roll2dmg2crit}}{{#rollWasCrit() roll2}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll2dmg2crit}}
                        {{/rollWasCrit() roll2}}{{/roll2dmg2crit}}
                        <span class="notes inl">{{roll2dmg2type}}</span>
                    </div>
                {{/roll2dmg2}}
            {{/roll2}}
            {{#roll3}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#4">#4</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                    {{roll3}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll3}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <img class="brdleft" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdleft.png" />
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll3}}
                </div>
                {{#roll3dmg1}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll3dmg1}}
                        {{#roll3dmg1crit}}{{#rollWasCrit() roll3}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll3dmg1crit}}
                        {{/rollWasCrit() roll3}}{{/roll3dmg1crit}}
                        <span class="notes inl">{{roll3dmg1type}}</span>
                    </div>
                {{/roll3dmg1}}
                {{#roll3dmg2}}
                    <div class="flexdmg">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                            <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                        </div>
                        {{roll3dmg2}}
                        {{#roll3dmg2crit}}{{#rollWasCrit() roll3}}
                        <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll3dmg2crit}}
                        {{/rollWasCrit() roll3}}{{/roll3dmg2crit}}
                        <span class="notes inl">{{roll3dmg2type}}</span>
                    </div>
                {{/roll3dmg2}}
            {{/roll3}}
        {{/attack}}
        {{#damage}}
            {{#dmg1flag}}
                <div class="flexdmg">
                    <div class="blacklabel med yellow">
                        <span data-i18n="damage">Damage</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                    {{dmg1}}
                    {{#dmg1crit}}
                        {{#roll}}{{#rollWasCrit() roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg1crit}}{{/rollWasCrit() roll}}{{/roll}}
                        {{^roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg1crit}}{{/roll}}
                    {{/dmg1crit}}
                    <span class="notes inl">{{dmg1type}}</span>
                </div>
            {{/dmg1flag}}
            {{#dmg2flag}}
                <div class="flexdmg">
                    <div class="blacklabel med yellow">
                        <span data-i18n="damage2">Damage2</span>
                        <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                    </div>
                    {{dmg2}}
                    {{#dmg2crit}}
                        {{#roll}}{{#rollWasCrit() roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg2crit}}{{/rollWasCrit() roll}}{{/roll}}
                        {{^roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg2crit}}{{/roll}}
                    {{/dmg2crit}}
                    <span class="notes inl">{{dmg2type}}</span>
                </div>
            {{/dmg2flag}}
        {{/damage}}
        {{#shortdesc}}<div class="center"><span class="notes ital">{{shortdesc}}</span></div>{{/shortdesc}}
        {{#spellfailureroll}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="spell-failure">Spell Failure</span>
                {{spellfailureroll}} <span class="notes inl">></span> {{spellfailure}}
                {{#rollGreater() spellfailureroll spellfailure}}<span class="lbl bold" style="color: #247305;" data-i18n="success">Success</span>{{/rollGreater() spellfailureroll spellfailure}}
                {{#rollTotal() spellfailureroll spellfailure}}<span class="lbl bold" style="color: #BE202E;" data-i18n="failure">Failure</span>{{/rollTotal() spellfailureroll spellfailure}}
                {{#rollLess() spellfailureroll spellfailure}}<span class="lbl bold" style="color: #BE202E;" data-i18n="failure">Failure</span>{{/rollLess() spellfailureroll spellfailure}}
            </div>
        {{/spellfailureroll}}
        {{#sr}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="spell-resistance:">Spell Resistance:</span>
                <span class="notes inl">{{spellresistance}}</span>
            </div>
        {{/sr}}
        {{#save}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="saving-throw:">Saving Throw:</span>
                <span class="notes inl">{{saveeffect}}</span>
                <span class="lbl bold" data-i18n="dc-u">DC</span>
                {{savedc}}
            </div>
        {{/save}}
        {{#powertype}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="type:">Type:</span>
                <span class="notes inl">{{powertype}}</span>
            </div>
        {{/powertype}}
        {{#school}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="school:">School:</span>
                <span class="notes inl">{{school}}</span>
            </div>
        {{/school}}
        {{#castingtime}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="casting-time:">Casting time:</span>
                <span class="notes inl">{{castingtime}}</span>
            </div>
        {{/castingtime}}
        {{#component}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="components:">Components:</span>
                <span class="notes inl">{{component}}</span>
            </div>
        {{/component}}
        {{#range}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="range:">Range:</span>
                <span class="notes inl">{{range}}</span>
            </div>
        {{/range}}
        {{#area}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="area:">Area:</span>
                <span class="notes inl">{{area}}</span>
            </div>
        {{/area}}
        {{#targets}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="targets:">Targets:</span>
                <span class="notes inl">{{targets}}</span>
            </div>
        {{/targets}}
        {{#effect}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="effect:">Effect:</span>
                <span class="notes inl">{{effect}}</span>
            </div>
        {{/effect}}
        {{#duration}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="duration:">Duration:</span>
                <span class="notes inl">{{duration}}</span>
            </div>
        {{/duration}}
        {{#prerequisites}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="prerequisites:">Prerequisites:</span>
                <span class="notes inl">{{prerequisites}}</span>
            </div>
        {{/prerequisites}}
        {{#benefits}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="benefits:">Benefits:</span>
                <span class="notes inl">{{benefits}}</span>
            </div>
        {{/benefits}}
        {{#normal}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="normal:">Normal:</span>
                <span class="notes inl">{{normal}}</span>
            </div>
        {{/normal}}
        {{#special}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="special:">Special:</span>
                <span class="notes inl">{{special}}</span>
            </div>
        {{/special}}
        {{#concentration}}
            <div class="myrow center">
                {{concentration}}
            </div>
        {{/concentration}}
    </div>
    {{#descflag}}
        {{#desc}}
            <div class="desc">
                <span class="notes inl ital">{{desc}}</span>
            </div>
        {{/desc}}
    {{/descflag}}
    {{#rollTotal() shownotes 1}}
        {{#notes}}
            <div class="notes">
                <span class="lbl bold" data-i18n="notes">Notes</span>
                <span class="notes inl ital">{{notes}}</span>
            </div>
        {{/notes}}
    {{/rollTotal() shownotes 1}}
    {{#rollLess() conditionsflag 0}}
        {{#conditions}}
            <div class="notes">
                <span class="lbl bold" data-i18n="conditions:">Conditions:</span>
                <span class="notes conditions inl">{{conditions}}</span>
            </div>
        {{/conditions}}
    {{/rollLess() conditionsflag 0}}
    {{#conditionsnote}}
        <div class="notes">
            <span class="notes conditions inl">{{conditionsnote}}</span>
        </div>
    {{/conditionsnote}}
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-npc">
    {{#name}}
        {{#rollTotal() showchar 1}}
            <div class="charname smallname bold">{{charname}}</div>
        {{/rollTotal() showchar 1}}
    {{/name}}
    {{#smallname}}
        <div class="charname smallname bold">
            {{#rollTotal() showchar 1}}{{charname}} /{{/rollTotal() showchar 1}}
            {{smallname}}
        </div>
    {{/smallname}}
    <div class="bordered">
        {{#type}}<div class="sheet-icon sheet-{{type}}"></div>{{/type}}
        {{#name}}
            <div class="center vtop">
                <span class="big">{{name}}</span>
                {{^attack}}{{#roll}}<span class="bigres">{{roll}}</span>{{/roll}}{{/attack}}
                {{#feattype}}<span class="med">({{feattype}})</span>{{/feattype}}
                {{#abilitytype}}<span class="med">({{abilitytype}})</span>{{/abilitytype}}
                {{#atkvs}}<span class="med">{{atkvs}}</span>{{/atkvs}}
                {{#casterclass}}<span class="med">({{casterclass}}</span>{{#level}}<span class="med"> {{level}}</span>{{/level}}<span class="med">)</span>{{/casterclass}}
            </div>
        {{/name}}
        {{#attack}}
            {{#roll}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        {{#roll1}}<span data-i18n="#1">#1</span>{{/roll1}}
                    </div>
                    {{roll}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll}}
                        <span class="symbol">t</span>
                        {{critconfirm}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll}}
                </div>
                {{#rolldmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{rolldmg1}}
                        {{#rolldmg1crit}}{{#rollWasCrit() roll}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{rolldmg1crit}}
                        {{/rollWasCrit() roll}}{{/rolldmg1crit}}
                        <span class="notes inl">{{rolldmg1type}}</span>
                    </div>
                {{/rolldmg1}}
                {{#rolldmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{rolldmg2}}
                        {{#rolldmg2crit}}{{#rollWasCrit() roll}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{rolldmg2crit}}
                        {{/rollWasCrit() roll}}{{/rolldmg2crit}}
                        <span class="notes inl">{{rolldmg2type}}</span>
                    </div>
                {{/rolldmg2}}
            {{/roll}}
            {{#roll1}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#2">#2</span>
                    </div>
                    {{roll1}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll1}}
                        <span class="symbol">t</span>
                        {{critconfirm1}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll1}}
                </div>
                {{#roll1dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll1dmg1}}
                        {{#roll1dmg1crit}}{{#rollWasCrit() roll1}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll1dmg1crit}}
                        {{/rollWasCrit() roll1}}{{/roll1dmg1crit}}
                        <span class="notes inl">{{roll1dmg1type}}</span>
                    </div>
                {{/roll1dmg1}}
                {{#roll1dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll1dmg2}}
                        {{#roll1dmg2crit}}{{#rollWasCrit() roll1}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll1dmg2crit}}
                        {{/rollWasCrit() roll1}}{{/roll1dmg2crit}}
                        <span class="notes inl">{{roll1dmg2type}}</span>
                    </div>
                {{/roll1dmg2}}
            {{/roll1}}
            {{#roll2}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#3">#3</span>
                    </div>
                    {{roll2}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll2}}
                        <span class="symbol">t</span>
                        {{critconfirm2}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll2}}
                </div>
                {{#roll2dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll2dmg1}}
                        {{#roll2dmg1crit}}{{#rollWasCrit() roll2}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll2dmg1crit}}
                        {{/rollWasCrit() roll2}}{{/roll2dmg1crit}}
                        <span class="notes inl">{{roll2dmg1type}}</span>
                    </div>
                {{/roll2dmg1}}
                {{#roll2dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll2dmg2}}
                        {{#roll2dmg2crit}}{{#rollWasCrit() roll2}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll2dmg2crit}}
                        {{/rollWasCrit() roll2}}{{/roll2dmg2crit}}
                        <span class="notes inl">{{roll2dmg2type}}</span>
                    </div>
                {{/roll2dmg2}}
            {{/roll2}}
            {{#roll3}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#4">#4</span>
                    </div>
                    {{roll3}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll3}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll3}}
                </div>
                {{#roll3dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll3dmg1}}
                        {{#roll3dmg1crit}}{{#rollWasCrit() roll3}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll3dmg1crit}}
                        {{/rollWasCrit() roll3}}{{/roll3dmg1crit}}
                        <span class="notes inl">{{roll3dmg1type}}</span>
                    </div>
                {{/roll3dmg1}}
                {{#roll3dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll3dmg2}}
                        {{#roll3dmg2crit}}{{#rollWasCrit() roll3}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll3dmg2crit}}
                        {{/rollWasCrit() roll3}}{{/roll3dmg2crit}}
                        <span class="notes inl">{{roll3dmg2type}}</span>
                    </div>
                {{/roll3dmg2}}
            {{/roll3}}
            {{#roll4}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#5">#5</span>
                    </div>
                    {{roll4}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll4}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll4}}
                </div>
                {{#roll4dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll4dmg1}}
                        {{#roll4dmg1crit}}{{#rollWasCrit() roll4}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll4dmg1crit}}
                        {{/rollWasCrit() roll4}}{{/roll4dmg1crit}}
                        <span class="notes inl">{{roll4dmg1type}}</span>
                    </div>
                {{/roll4dmg1}}
                {{#roll4dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll4dmg2}}
                        {{#roll4dmg2crit}}{{#rollWasCrit() roll4}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll4dmg2crit}}
                        {{/rollWasCrit() roll4}}{{/roll4dmg2crit}}
                        <span class="notes inl">{{roll4dmg2type}}</span>
                    </div>
                {{/roll4dmg2}}
            {{/roll4}}
            {{#roll5}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#6">#6</span>
                    </div>
                    {{roll5}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll5}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll5}}
                </div>
                {{#roll5dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll5dmg1}}
                        {{#roll5dmg1crit}}{{#rollWasCrit() roll5}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll5dmg1crit}}
                        {{/rollWasCrit() roll5}}{{/roll5dmg1crit}}
                        <span class="notes inl">{{roll5dmg1type}}</span>
                    </div>
                {{/roll5dmg1}}
                {{#roll5dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll5dmg2}}
                        {{#roll5dmg2crit}}{{#rollWasCrit() roll5}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll5dmg2crit}}
                        {{/rollWasCrit() roll5}}{{/roll5dmg2crit}}
                        <span class="notes inl">{{roll5dmg2type}}</span>
                    </div>
                {{/roll5dmg2}}
            {{/roll5}}
            {{#roll6}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#7">#7</span>
                    </div>
                    {{roll6}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll6}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll6}}
                </div>
                {{#roll6dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll6dmg1}}
                        {{#roll6dmg1crit}}{{#rollWasCrit() roll6}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll6dmg1crit}}
                        {{/rollWasCrit() roll6}}{{/roll6dmg1crit}}
                        <span class="notes inl">{{roll6dmg1type}}</span>
                    </div>
                {{/roll6dmg1}}
                {{#roll6dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll6dmg2}}
                        {{#roll6dmg2crit}}{{#rollWasCrit() roll6}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll6dmg2crit}}
                        {{/rollWasCrit() roll6}}{{/roll6dmg2crit}}
                        <span class="notes inl">{{roll6dmg2type}}</span>
                    </div>
                {{/roll6dmg2}}
            {{/roll6}}
            {{#roll7}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#8">#8</span>
                    </div>
                    {{roll7}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll7}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll7}}
                </div>
                {{#roll7dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll7dmg1}}
                        {{#roll7dmg1crit}}{{#rollWasCrit() roll7}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll7dmg1crit}}
                        {{/rollWasCrit() roll7}}{{/roll7dmg1crit}}
                        <span class="notes inl">{{roll7dmg1type}}</span>
                    </div>
                {{/roll7dmg1}}
                {{#roll7dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll7dmg2}}
                        {{#roll7dmg2crit}}{{#rollWasCrit() roll7}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll7dmg2crit}}
                        {{/rollWasCrit() roll7}}{{/roll7dmg2crit}}
                        <span class="notes inl">{{roll7dmg2type}}</span>
                    </div>
                {{/roll7dmg2}}
            {{/roll7}}
            {{#roll8}}
                <div class="flexatk">
                    <div class="blacklabel med">
                        <span data-i18n="attack">Attack</span>
                        <span data-i18n="#9">#9</span>
                    </div>
                    {{roll8}}
                    <div class="spacer"></div>
                    {{#rollWasCrit() roll8}}
                        <span class="symbol">t</span>
                        {{critconfirm3}}
                        <div class="blacklabel med right yellow">
                            <span data-i18n="crit-confirm">Crit confirm</span>
                        </div>
                    {{/rollWasCrit() roll8}}
                </div>
                {{#roll8dmg1}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage">Damage</span>
                        </div>
                        {{roll8dmg1}}
                        {{#roll8dmg1crit}}{{#rollWasCrit() roll8}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll8dmg1crit}}
                        {{/rollWasCrit() roll8}}{{/roll8dmg1crit}}
                        <span class="notes inl">{{roll8dmg1type}}</span>
                    </div>
                {{/roll8dmg1}}
                {{#roll8dmg2}}
                    <div class="vtop">
                        <div class="blacklabel med yellow">
                            <span data-i18n="damage2">Damage2</span>
                        </div>
                        {{roll8dmg2}}
                        {{#roll8dmg2crit}}{{#rollWasCrit() roll8}}
                            <span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{roll8dmg2crit}}
                        {{/rollWasCrit() roll8}}{{/roll8dmg2crit}}
                        <span class="notes inl">{{roll8dmg2type}}</span>
                    </div>
                {{/roll8dmg2}}
            {{/roll8}}
        {{/attack}}
        {{#damage}}
            {{#dmg1flag}}
                <div class="vtop">
                    <div class="blacklabel med yellow">
                        <span data-i18n="damage">Damage</span>
                    </div>
                    {{dmg1}}
                    {{#dmg1crit}}
                        {{#roll}}{{#rollWasCrit() roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg1crit}}{{/rollWasCrit() roll}}{{/roll}}
                    {{/dmg1crit}}
                    <span class="notes inl">{{dmg1type}}</span>
                </div>
            {{/dmg1flag}}
            {{#dmg2flag}}
                <div class="vtop">
                    <div class="blacklabel med yellow">
                        <span data-i18n="damage2">Damage2</span>
                    </div>
                    {{dmg2}}
                    {{#dmg2crit}}
                        {{#roll}}{{#rollWasCrit() roll}}<span class="symbol" data-i18n-title="critical-damage" title="Critical damage">t</span> {{dmg2crit}}{{/rollWasCrit() roll}}{{/roll}}
                    {{/dmg2crit}}
                    <span class="notes inl">{{dmg2type}}</span>
                </div>
            {{/dmg2flag}}
        {{/damage}}
        {{#sr}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="spell-resistance:">Spell Resistance:</span>
                <span class="notes inl">{{spellresistance}}</span>
            </div>
        {{/sr}}
        {{#save}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="saving-throw:">Saving Throw:</span>
                <span class="notes inl">{{saveeffect}}</span>
                <span class="lbl bold" data-i18n="dc-u">DC</span>
                {{savedc}}
            </div>
        {{/save}}
        {{#school}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="school:">School:</span>
                <span class="notes inl">{{school}}</span>
            </div>
        {{/school}}
        {{#castingtime}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="casting-time:">Casting time:</span>
                <span class="notes inl">{{castingtime}}</span>
            </div>
        {{/castingtime}}
        {{#component}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="components:">Components:</span>
                <span class="notes inl">{{component}}</span>
            </div>
        {{/component}}
        {{#range}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="range:">Range:</span>
                <span class="notes inl">{{range}}</span>
            </div>
        {{/range}}
        {{#area}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="area:">Area:</span>
                <span class="notes inl">{{area}}</span>
            </div>
        {{/area}}
        {{#targets}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="targets:">Targets:</span>
                <span class="notes inl">{{targets}}</span>
            </div>
        {{/targets}}
        {{#effect}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="effect:">Effect:</span>
                <span class="notes inl">{{effect}}</span>
            </div>
        {{/effect}}
        {{#duration}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="duration:">Duration:</span>
                <span class="notes inl">{{duration}}</span>
            </div>
        {{/duration}}
        {{#prerequisites}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="prerequisites:">Prerequisites:</span>
                <span class="notes inl">{{prerequisites}}</span>
            </div>
        {{/prerequisites}}
        {{#benefits}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="benefits:">Benefits:</span>
                <span class="notes inl">{{benefits}}</span>
            </div>
        {{/benefits}}
        {{#normal}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="normal:">Normal:</span>
                <span class="notes inl">{{normal}}</span>
            </div>
        {{/normal}}
        {{#special}}
            <div class="myrow">
                <span class="lbl bold" data-i18n="special:">Special:</span>
                <span class="notes inl">{{special}}</span>
            </div>
        {{/special}}

    </div>
    {{#descflag}}
        {{#desc}}
            <div class="desc">
                <span class="notes inl ital">{{desc}}</span>
            </div>
        {{/desc}}
    {{/descflag}}
    {{#rollTotal() shownotes 1}}
        {{#notes}}
            <div class="notes">
                <span class="lbl bold" data-i18n="notes">Notes</span>
                <span class="notes inl ital">{{notes}}</span>
            </div>
        {{/notes}}
    {{/rollTotal() shownotes 1}}
</rolltemplate>

<!-- MANCER CONFIRM -->
<div class="mancer_confirm">
    <span style="font-weight: bold; font-size: 1.1em;" data-i18n="do_you_want_mancer">How do  you want to create this character?</span>
    <label>
        <input class="yes" type="checkbox" name="attr_mancer_confirm"><span class="yes" data-i18n="mancer-confirm-yes">Use the Charactermancer</span>
    </label>
    <label>
        <input class="yes" type="checkbox" name="attr_mancer_npc"><span class="yes" data-i18n="npc-new">Create an NPC</span>
    </label>
    <label>
        <input class="yes" type="checkbox" name="attr_mancer_cancel"><span class="yes" data-i18n="edit-sheet">Edit sheet directly</span>
    </label>
</div>

<!-- SHEET WORKERS -->
<script type="text/worker">
    /* === GLOBAL VARIABLES === */
    var pfoglobals_debug_mode = 0;

    const pfoglobals_currentversion = 1.16;
    var pfoglobals_i18n_obj = {};
    var pfoglobals_initdone = 0;

    const pfoglobals_abilities = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
    const pfoglobals_abilities_fields = ["strength_base","strength_race","strength_bonus","strength_condition","dexterity_base","dexterity_race","dexterity_bonus","dexterity_condition","constitution_base","constitution_race","constitution_bonus","intelligence_base","intelligence_race","intelligence_bonus","wisdom_base","wisdom_race","wisdom_bonus","charisma_base","charisma_race","charisma_bonus"];
    const pfoglobals_mods = ["strength_mod","dexterity_mod","constitution_mod","intelligence_mod","wisdom_mod","charisma_mod","none_mod"];
    const pfoglobals_flex_abilities = ["fortitude_ability","reflex_ability","will_ability","cmb_ability","melee_ability","ranged_ability","acrobatics_ability","appraise_ability","bluff_ability","climb_ability","craft_ability","diplomacy_ability","disable_device_ability","disguise_ability","escape_artist_ability","fly_ability","handle_animal_ability","heal_ability","intimidate_ability","knowledge_arcana_ability","knowledge_dungeoneering_ability","knowledge_engineering_ability","knowledge_geography_ability","knowledge_history_ability","knowledge_local_ability","knowledge_nature_ability","knowledge_nobility_ability","knowledge_planes_ability","knowledge_religion_ability","linguistics_ability","perception_ability","perform_ability","profession_ability","ride_ability","sense_motive_ability","sleight_of_hand_ability","spellcraft_ability","stealth_ability","survival_ability","swim_ability","use_magic_device_ability","caster1_ability","caster2_ability"];
    const pfoglobals_initiative_fields = ["npc","dexterity_mod","initiative_misc","initiative_bonus"];
    const pfoglobals_ac_ability_fields = ["npc","ac_ability_primary","ac_ability_secondary","ac_condition_nobonus","ac_ability_mod","encumbrance_ability_maximum","ac_ability_maximum","ac_secab_monk"].concat(pfoglobals_mods);
    const pfoglobals_ac_fields = ["npc","ac_bonus","ac_ability_mod","ac_armor","ac_shield","ac_size","ac_natural","ac_deflection","ac_misc","ac_dodge","ac_touch_bonus","ac_flatfooted_bonus","ac_natural_bonus","ac_deflection_bonus","ac_dodge_bonus","ac_noflatflooted","ac_touchshield","ac_condition","ac_secab_monk","ac_ff_ability_mod"];
    const pfoglobals_save_attr = ["base","ability","ability_mod","misc","bonus"];
    const pfoglobals_save_fields = ["fortitude_base","fortitude_ability","fortitude_ability_mod","fortitude_misc","fortitude_bonus","reflex_base","reflex_ability","reflex_ability_mod","reflex_misc","reflex_bonus","will_base","will_ability","will_ability_mod","will_misc","will_bonus"].concat(pfoglobals_mods);
    const pfoglobals_babs_fields = ["npc","bab","bab_multi","bab_size","cmb_size","cmb_ability","cmb_ability_mod","cmb_misc","cmb_bonus","melee_ability","melee_ability_mod","melee_misc","melee_bonus","ranged_ability","ranged_ability_mod","ranged_misc","ranged_bonus","ac_ability_mod","ac_dodge_bonus","ac_dodge","ac_deflection_bonus","ac_deflection","cmd_misc","cmd_bonus","cmd_condition","ac_condition_nobonus","class1_name","class2_name","class3_name","class1_bab","class2_bab","class3_bab","class1_level","class2_level","class3_level"].concat(pfoglobals_mods);
    const pfoglobals_skill_list = ["acrobatics","appraise","bluff","climb","craft","diplomacy","disable_device","disguise","escape_artist","fly","handle_animal","heal","intimidate","knowledge_arcana","knowledge_dungeoneering","knowledge_engineering","knowledge_geography","knowledge_history","knowledge_local","knowledge_nature","knowledge_nobility","knowledge_planes","knowledge_religion","linguistics","perception","perform","profession","ride","sense_motive","sleight_of_hand","spellcraft","stealth","survival","swim","use_magic_device"];
    const pfoglobals_skill_attr = ["classkill","ability","ability_mod","ranks","misc","bonus","armor_penalty"];
    const pfoglobals_skill_fields = ["skill_check_penalty","armor_check_penalty","encumbrance_check_penalty"].concat(pfoglobals_mods);
    const pfoglobals_skillranks_fields = ["intelligence_mod","class1_skillranks_base","class2_skillranks_base","class3_skillranks_base","class1_level","class2_level","class3_level"];
    var pfoglobals_repsec_skills = [{section:"skillcraft",attrs:pfoglobals_skill_attr},{section:"skillknowledge",attrs:pfoglobals_skill_attr},{section:"skillperform",attrs:pfoglobals_skill_attr},{section:"skillprofession",attrs:pfoglobals_skill_attr},{section:"skillcustom",attrs:pfoglobals_skill_attr}];
    const pfoglobals_atk_attr = ["atkname","atkflag","atktype","atktype2","atkmod","atkvs","atkcritrange","atkrange","dmgflag","dmgbase","dmgattr","dmgmod","dmgcritmulti","dmgtype","dmgbonusdice","dmg2flag","dmg2base","dmg2attr","dmg2mod","dmg2critmulti","dmg2type","dmg2bonusdice","descflag","atkdesc","notes"];
    var pfoglobals_repsec_atk = [{section:"attacks",attrs:pfoglobals_atk_attr}];
    const pfoglobals_atk_fields = ["npc","strength_oneandahalf_mod","strength_half_mod","dexterity_oneandahalf_mod","dexterity_half_mod","melee_mod","ranged_mod","cmb_mod","bab","bab_max","fob","rollmod_attack","rollnotes_attack","rollmod_damage","whispertype","rollshowchar","bab_multi","melee_multi","ranged_multi","cmb_multi","fob_multi"].concat(pfoglobals_mods);
    const pfoglobals_spell_attr = ["spelllevel","spellcaster","spellname","spellschool","spellclasslevel","spellcastingtime","spellrange","spellarea","spelltargets","spelleffect","spellduration","spellsaveflag","spellsave","spelldc_mod","spellresistanceflag","spellresistance","spellatkflag","spellatktype","spellatkmod","spellatkcritrange","spelldmgcritmulti","spelldmgflag","spelldmg","spelldmgtype","spelldmg2flag","spelldmg2","spelldmg2type","spelldescflag","spelldesc","notes"];
    const pfoglobals_spell_only_attr = ["spellcomponent"];
    const pfoglobals_spell_like_attr = ["spelltype","timesperday","perday_max"];
    var pfoglobals_repsec_spell = [];
    const pfoglobals_spell_fields = ["melee_mod","ranged_mod","cmb_mod","rollmod_attack","rollnotes_spell","rollmod_damage","whispertype","rollshowchar","caster1_level", "caster2_level","caster1_flag","caster2_flag","caster1_class","caster2_class","armor_spell_failure","caster1_spell_failure","caster2_spell_failure","npc","caster1_concentration_roll","caster2_concentration_roll","caster1_dc_level_0","caster1_dc_level_1","caster1_dc_level_2","caster1_dc_level_3","caster1_dc_level_4","caster1_dc_level_5","caster1_dc_level_6","caster1_dc_level_7","caster1_dc_level_8","caster1_dc_level_9","caster2_dc_level_0","caster2_dc_level_1","caster2_dc_level_2","caster2_dc_level_3","caster2_dc_level_4","caster2_dc_level_5","caster2_dc_level_6","caster2_dc_level_7","caster2_dc_level_8","caster2_dc_level_9"].concat(pfoglobals_mods);
    const pfoglobals_concentration_fields = ["npc","caster1_level","caster1_ability","caster1_ability_mod","caster1_concentration_misc","caster1_concentration_bonus","caster2_level","caster2_ability","caster2_ability_mod","caster2_concentration_misc","caster2_concentration_bonus"].concat(pfoglobals_mods);
    const pfoglobals_spells_dc_fields = ["npc","caster1_ability","caster1_ability_mod","caster1_dc_misc","caster1_dcbonus_level_0","caster1_dcbonus_level_1","caster1_dcbonus_level_2","caster1_dcbonus_level_3","caster1_dcbonus_level_4","caster1_dcbonus_level_5","caster1_dcbonus_level_6","caster1_dcbonus_level_7","caster1_dcbonus_level_8","caster1_dcbonus_level_9","caster2_ability","caster2_ability_mod","caster2_dc_misc","caster2_dcbonus_level_0","caster2_dcbonus_level_1","caster2_dcbonus_level_2","caster2_dcbonus_level_3","caster2_dcbonus_level_4","caster2_dcbonus_level_5","caster2_dcbonus_level_6","caster2_dcbonus_level_7","caster2_dcbonus_level_8","caster2_dcbonus_level_9"].concat(pfoglobals_mods);
    const pfoglobals_size = [{"size":"fine","atkac":8,"cmb":-8,"fly":8,"stealth":16,"load":0.125,"squares":0.5},{"size":"diminutive","atkac":4,"cmb":-4,"fly":6,"stealth":12,"load":0.25,"squares":0.5},{"size":"tiny","atkac":2,"cmb":-2,"fly":4,"stealth":8,"load":0.5,"squares":0.5},{"size":"small","atkac":1,"cmb":-1,"fly":2,"stealth":4,"load":0.75,"squares":0.75},{"size":"medium","atkac":0,"cmb":0,"fly":0,"stealth":0,"load":1,"squares":1.0},{"size":"large","atkac":-1,"cmb":1,"fly":-2,"stealth":-4,"load":2,"squares":2.0},{"size":"huge","atkac":-2,"cmb":2,"fly":-4,"stealth":-8,"load":4,"squares":3.0},{"size":"gargantuan","atkac":-4,"cmb":4,"fly":-6,"stealth":-12,"load":8,"squares":4.0},{"size":"colossal","atkac":-8,"cmb":8,"fly":-8,"stealth":-16,"load":16,"squares":4.0}];
    const pfoglobals_encumbrance_fields = ["npc","encumbrance_load_bonus","encumbrance_load_multiplier","strength","encumbrance_size","encumbrance_gear_weight","encumbrance_load_light","encumbrance_load_medium","encumbrance_load_heavy","speed_race","speed_class","encumbrance","encumbrance_display"];
    const pfoglobals_speed_fields = ["speed_race","speed_class","encumbrance","speed_notmodified","speed_encumbrance","speed_armor","encumbrance_run_factor","armor_run_factor","speed_base","speed_bonus","speed_run_factor","speed_condition_multiplier","speed_condition_norun","speed_condition_nospeed"];
    const pfoglobals_conditions = ["condition_bleed","condition_blinded","condition_confused","condition_cowering","condition_dazed","condition_dazzled","condition_deafened","condition_disabled","condition_dying","condition_energy_drained","condition_entangled","condition_exhausted","condition_fascinated","condition_fatigued","condition_flat-footed","condition_frightened","condition_grappled","condition_helpless","condition_incorporeal","condition_invisible","condition_nauseated","condition_panicked","condition_paralyzed","condition_petrified","condition_pinned","condition_prone","condition_shaken","condition_sickened","condition_stable","condition_staggered","condition_stunned","condition_unconscious"];

    /* === EVENTS === */

    // === Global Variables/Version/Mancer/NPC drop handling
    on("sheet:opened", (eventinfo) => {
        if (pfoglobals_initdone == 0) {
            loadi18n();
            // Constructing array of repeating sections' attributes
            var obj = {};
            obj["section"] = "spell-like";
            obj["attrs"] = pfoglobals_spell_attr.concat(pfoglobals_spell_like_attr);
            pfoglobals_repsec_spell.push(obj);
            for(var i = 0; i < 10; i++) {
                obj = {};
                obj["section"] = "spell-" + i;
                obj["attrs"] = pfoglobals_spell_attr.concat(pfoglobals_spell_only_attr);
                pfoglobals_repsec_spell.push(obj);
            }
            //DEBUG
            if (pfoglobals_debug_mode) {console.log("*** DEBUG pfoglobals_repsec_spell:" + JSON.stringify(pfoglobals_repsec_spell,null,"  "));}
            // Query modifiers translation
            setAttrs({ask_modifier: getTranslationByKey("ask-modifier"),
                ask_atk_modifier: getTranslationByKey("ask-atk-modifier"),
                ask_dmg_modifier: getTranslationByKey("ask-dmg-modifier"),
                ask_whisper: getTranslationByKey("ask-whisper"),
                ask_public_roll: getTranslationByKey("ask-public-roll"),
                ask_whisper_roll: getTranslationByKey("ask-whisper-roll")},{silent: true},() => {
                    pfoglobals_initdone = 1;
            });
        }
        if(eventinfo.sourceType !== "sheetworker") { // not NPC dropped from Compendium
            versioning(true);
        };
    });

    // === Mancer handling
    on("change:mancer_confirm", () => {
        setAttrs({"mancer_confirm_flag": "0", "charactermancer_step": "l1-welcome"}, {silent: true}, () => {
            check_l1_mancer();
        });
    });
    on("change:mancer_npc", () => {
        setAttrs({"npc": "1", "mancer_confirm_flag": "0", "l1mancer_status": "completed"}, {silent: true});
    });
    on("change:mancer_cancel", () => {
        setAttrs({"mancer_confirm_flag": "0", "l1mancer_status": "completed"}, {silent: true});
    });
    on("mancer:cancel", (eventinfo) => {
        if(!eventinfo["value"]) {return;};
        var update = {};

        if(eventinfo["value"] === "l1-welcome" || eventinfo["value"] === "l1-cancel") {
            update["l1mancer_status"] = "completed";
            update["charactermancer_step"] = "l1-welcome";
            deleteCharmancerData(["l1-welcome","l1-abilities","l1-race","l1-class","l1-feats","l1-equipment","l1-spells","l1-summary"]);
        }
        else if(eventinfo["value"].substring(0,3) === "l1-") {
            update["l1mancer_status"] = eventinfo["value"];
        };
        setAttrs(update);
    });
    on("clicked:cancel", () => {
        showChoices(["cancel-prompt"]);
        if (pfoglobals_debug_mode) {console.log("*** DEBUG Mancer cancel: " + JSON.stringify(getCharmancerData(),null,"  "));}
    });
    on("clicked:continue", () => {
        hideChoices(["cancel-prompt"]);
    });
    on("mancerfinish:l1-mancer", (eventinfo) => {
        // === VARIABLES ===
        if (pfoglobals_debug_mode) {console.log("*** DEBUG Mancer finish: " + JSON.stringify(eventinfo,null,"  "));}
        const mncrAbilities = pfoglobals_abilities;
        var mancerdata = eventinfo.data;
        var charUpd = {};
        var bRaceData = false;
        var bClassData = false;
        var FeatsToLoad = [];
        var SpellsToLoad = [];
        var allSpells = [];
        var allTraits = [];
        var allPowers = [];
        var allClassSkills = "";
        var allSkillBonus = "";
        var skillBonusNotes = {};
        var finalRaceSpeed = 0;
        var finalClassSpeed = 0;
        var allRepSecs = ["attacks","skillcraft","skillknowledge","skillperform","skillprofession","skillcustom","acitems","gear","feats","abilities","spell-like","metamagic"];
        for(var i = 0; i < 10; i++) {allRepSecs.push("spell-" + i);}

        // === FUNCTIONS ===
        var calc_abilities = function(data) {
            var abilities_scores = {};
            // --- Preparing ability scores detailed array
            _.each(mncrAbilities, (ability) => {
                abilities_scores[ability] = {"total": 0, "base":"0","race":"0","class":"0","subclass":"0","misc":"0"};
            });
            // --- Abilities base
            if(data["l1-abilities"]) {
                _.each(mncrAbilities, function(ability) {
                    if(data["l1-abilities"].values[ability]) {
                        abilities_scores[ability].base = parseInt(data["l1-abilities"].values[ability]) || 0;
                    }
                });
            }
            // --- Abilities race
            if(data["l1-race"]) {
                if(data["l1-race"].data && data["l1-race"].data.race) {
                    if(data["l1-race"].data.race["data-Ability Score Modifiers"]) {
                        _.each(data["l1-race"].data.race["data-Ability Score Modifiers"].split(","), (modifier) => {
                            var abrace = modifier.trim().toLowerCase();
                            if(abilities_scores[abrace.split(" ")[0].trim()]) {
                                abilities_scores[abrace.split(" ")[0].trim()].race = parseInt(abrace.split(" ")[1]) || 0;
                            }
                            else {
                                console.log("*** DEBUG ERROR ability race unsplitable: " + abrace);
                            }
                        });
                    } else if(data["l1-race"].data.race["data-Ability Score Choice"] && data["l1-race"].values["race_ability_choice1"]) {
                        abilities_scores[data["l1-race"].values["race_ability_choice1"]].race = parseInt(data["l1-race"].data.race["data-Ability Score Choice"].split("+")[1]) || 0;
                    }
                }
                if(data["l1-race"].values["race"] == "Index:Races") {
                    //Custom race abilities bonuses
                    _.each(mncrAbilities, (ability) => {
                        if(data["l1-race"].values["race_" + ability]) {
                            abilities_scores[ability].race = data["l1-race"].values["race_" + ability];
                        }
                    });
                }
            }
            // --- Abilities class
            // --- Abilities subclass
            if(data["l1-class"] && data["l1-class"].values.class_subclass1_ability_choice) {
                var sbclsablt = data["l1-class"].values.class_subclass1_ability_choice.split("(")[0].toLowerCase().trim();
                var sbclsabltvalue = data["l1-class"].values.class_subclass1_ability_choice.split("(")[1].replace(/[^\d\-]/gi, "");
                abilities_scores[sbclsablt].subclass = parseInt(sbclsabltvalue) || 0;
            }
            // --- Abilities misc
            // Final abilities calculation
            _.each(mncrAbilities, (ability) => {
                abilities_scores[ability].total = (parseInt(abilities_scores[ability].base) || 0) + (parseInt(abilities_scores[ability].race) || 0) + (parseInt(abilities_scores[ability].class) || 0) + (parseInt(abilities_scores[ability].subclass) || 0) + (parseInt(abilities_scores[ability].misc) || 0);
            });
            return abilities_scores;
        };
        var calc_abilities_mod = function(abilities_scores) {
            var ability_mods = {};
            _.each(mncrAbilities, (ability) => {
                ability_mods[ability] = Math.floor(((parseInt(abilities_scores[ability].total) || 10) - 10) / 2);
            });
            return ability_mods;
        };

        // === INIT ===
        setCharmancerText({"mancer_category":"Resetting Attributes","mancer_progress" :'<div style="width: 4%"></div>'});
        charUpd["npc"] = 0;
        charUpd["tabcurrent"] = "tabmain";
        charUpd["l1mancer_status"] = "completed";
        // -- Reset / Initialize
        _.extend(charUpd, calc_reset_pc());

        // === 1.ABILITIES ===
        setCharmancerText({"mancer_category":"Calculating Abilities","mancer_progress" :'<div style="width: 8%"></div>'});
        var abilities_score = calc_abilities(mancerdata);
        var ability_mods = calc_abilities_mod(abilities_score);
        _.each(mncrAbilities, (ablt) => {
            charUpd[ablt + "_base"] = parseInt(abilities_score[ablt].total) - parseInt(abilities_score[ablt].race);
            charUpd[ablt + "_race"] = parseInt(abilities_score[ablt].race);
            charUpd[ablt + "_mod"] = parseInt(ability_mods[ablt]);
        });

        // === 2.RACE ===
        setCharmancerText({"mancer_category":"Applying Race","mancer_progress" :'<div style="width: 16%"></div>'});
        if(mancerdata["l1-race"] && mancerdata["l1-race"].values.race) {
            // Variables
            if(mancerdata["l1-race"].values.race == "Index:Races") {
                // Custom race
                charUpd["race"] = (mancerdata["l1-race"].values["race_custom_name"] || "Unknown");
                charUpd["size"] = (mancerdata["l1-race"].values["race_custom_size"] || "medium");
                finalRaceSpeed += (parseInt(mancerdata["l1-race"].values["race_custom_speed"]) || 30);
            } else {
                charUpd["race"] = mancerdata["l1-race"].values.race.replace("Races:","");
            }
            // Static data
            if(mancerdata["l1-race"].data && mancerdata["l1-race"].data.race) {
                bRaceData = true;
                // Size
                charUpd["size"] = mancerdata["l1-race"].data.race["data-Size"].toLowerCase().trim();
                // Speed
                if(mancerdata["l1-race"].data.race["data-Race Speed"]) {
                    finalRaceSpeed += (parseInt(mancerdata["l1-race"].data.race["data-Race Speed"]) || 0);
                }
                if(mancerdata["l1-race"].data.race["data-Speed Not Modified"]) {
                    charUpd["speed_notmodified"] = 1;
                }
                // Senses
                if(mancerdata["l1-race"].data.race["data-Senses"]) {
                    charUpd["senses"] = mancerdata["l1-race"].data.race["data-Senses"];
                }
                // Lanuages
                if(mancerdata["l1-race"].data.race["data-Languages"]) {
                    charUpd["languages"] += mancerdata["l1-race"].data.race["data-Languages"] + " ";
                }
                // AC notes
                if(mancerdata["l1-race"].data.race["data-AC Notes"]) {
                    charUpd["ac_notes"] = mancerdata["l1-race"].data.race["data-AC Notes"];
                }
                // Fortitude notes
                if(mancerdata["l1-race"].data.race["data-Fortitude Notes"]) {
                    charUpd["fortitude_notes"] += mancerdata["l1-race"].data.race["data-Fortitude Notes"] + " ";
                }
                // Reflex notes
                if(mancerdata["l1-race"].data.race["data-Reflex Notes"]) {
                    charUpd["reflex_notes"] += mancerdata["l1-race"].data.race["data-Reflex Notes"] + " ";
                }
                // Will notes
                if(mancerdata["l1-race"].data.race["data-Will Notes"]) {
                    charUpd["will_notes"] += mancerdata["l1-race"].data.race["data-Will Notes"] + " ";
                }
                // Skill notes
                if(mancerdata["l1-race"].data.race["data-Skill Notes"]) {
                    if(mancerdata["l1-race"].data.race["data-Skill Notes"].indexOf(":") != -1) {
                        charUpd[mancerdata["l1-race"].data.race["data-Skill Notes"].split(":")[0].toLowerCase().trim() + "_notes"] += mancerdata["l1-race"].data.race["data-Skill Notes"].split(":")[1].trim();
                    }
                }
                // Skill bonus
                if(mancerdata["l1-race"].data.race["data-Skills Bonus"]) {
                    allSkillBonus += mancerdata["l1-race"].data.race["data-Skills Bonus"] + ",";
                    if(skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")]) {
                        skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")] += mancerdata["l1-race"].data.race["data-Skills Bonus"] + ",";
                    } else {
                        skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")] = mancerdata["l1-race"].data.race["data-Skills Bonus"] + ",";
                    }
                }
                if(mancerdata["l1-race"].values.race_skill_bonus_choice) {
                    allSkillBonus += mancerdata["l1-race"].values.race_skill_bonus_choice + ",";
                    if(skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")]) {
                        skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")] += mancerdata["l1-race"].values.race_skill_bonus_choice + ",";
                    } else {
                        skillBonusNotes[mancerdata["l1-race"].values.race.replace("Races:","")] = mancerdata["l1-race"].values.race_skill_bonus_choice + ",";
                    }
                }
                // Skill Ranks bonus
                if(mancerdata["l1-race"].data.race["data-Skill Ranks Bonus"]) {
                    charUpd["class1_skillranks_base"] = (parseInt(charUpd["class1_skillranks_base"]) || 0) + (parseInt(mancerdata["l1-race"].data.race["data-Skill Ranks Bonus"].replace(/[^\d\-]/gi, "")) || 0);
                }
                // Feats
                if(mancerdata["l1-race"].values.race_feat_choice) {
                    FeatsToLoad.push(mancerdata["l1-race"].values.race_feat_choice);
                } else if(mancerdata["l1-race"].data.race["data-Feats"]) {
                    _.each(mancerdata["l1-race"].data.race["data-Feats"].split(","),(feat) => {
                        FeatsToLoad.push("Feats:" + feat.trim());
                    });
                }
                // Spell-like abilities
                if(mancerdata["l1-race"].data.race["data-Spell-like abilities"]) {
                    let splabz = "";
                    if(mancerdata["l1-race"].data.race["data-Spell-like abilities prerequisites"]) {
                        let ablt = (mancerdata["l1-race"].data.race["data-Spell-like abilities prerequisites"].split(" ")[0] || "").trim().toLowerCase();
                        let minv = parseInt((mancerdata["l1-race"].data.race["data-Spell-like abilities prerequisites"].split(" ")[1] || "").trim().toLowerCase()) || 99;
                        if( (parseInt(abilities_score[ablt].total) || 0) >= minv )  {
                            splabz = mancerdata["l1-race"].data.race["data-Spell-like abilities"];
                        }
                    } else {
                        splabz = mancerdata["l1-race"].data.race["data-Spell-like abilities"];
                    }
                    if(splabz.length) {
                        charUpd["caster1_flag"] = 1;
                        charUpd["caster_flag"] = 1;
                        _.each(splabz.split(","), (splab) => {
                            let pawa = {};
                            pawa["Name"] = splab.trim();
                            pawa["Type"] = "Sp";
                            pawa["Spell-like"] = true;
                            pawa["Spell-source"] = splab.trim();
                            allPowers.push(pawa);
                            SpellsToLoad.push("Spells:" + splab.trim());
                        });
                    }
                }
                // Traits
                if(mancerdata["l1-race"].data.race["data-Traits"]) {
                    _.each(mancerdata["l1-race"].data.race["data-Traits"], (trait) => {
                        if(! trait["Type"]) {
                            trait["Type"] = getTranslationByKey("race");
                        }
                        allTraits.push(trait);
                    });
                }
            }
        }

        // === 3.CLASS ===
        setCharmancerText({"mancer_category":"Applying Class","mancer_progress" :'<div style="width: 24%"></div>'});
        charUpd["level"] = 1;
        charUpd["class1_level"] = 1;
        if(mancerdata["l1-class"] && mancerdata["l1-class"].values.class && mancerdata["l1-class"].values.class!="Rules:Classes") {
            // Variables
            charUpd["class1_name"] = mancerdata["l1-class"].values.class.replace("Classes:","");
            charUpd["class"] = charUpd["class1_name"] + " 1";
            // Alignment
            if(mancerdata["l1-class"].values.class_alignment_choice) {
                charUpd["alignment"] = mancerdata["l1-class"].values.class_alignment_choice.toLowerCase();
            }
            // Static data
            if(mancerdata["l1-class"].data && mancerdata["l1-class"].data.class) {
                bClassData = true;
                // Hit Die
                if(mancerdata["l1-class"].data.class["data-Hit Die"]) {
                    charUpd["class1_hitdietype"] = mancerdata["l1-class"].data.class["data-Hit Die"].toLowerCase().replace("d","");
                    charUpd["hitdietype"] = charUpd["class1_hitdietype"];
                    charUpd["hp_base"] = (parseInt(charUpd["class1_hitdietype"]) || 0) + (parseInt(ability_mods["constitution"]) || 0);
                    charUpd["hp_base_max"] = charUpd["hp_base"];
                    charUpd["hp"] = charUpd["hp_base"];
                    charUpd["hp_max"] = charUpd["hp_base"];
                }
                // Class skills
                if(mancerdata["l1-class"].data.class["data-Class skills"]) {
                    allClassSkills += mancerdata["l1-class"].data.class["data-Class skills"] + ",";
                }
                // Skill Bonus
                if(mancerdata["l1-class"].data.class["data-Skills bonus"]) {
                    allSkillBonus += mancerdata["l1-class"].data.class["data-Skills bonus"] + ",";
                    if(skillBonusNotes[mancerdata["l1-class"].values.class.replace("Classes:","")]) {
                        skillBonusNotes[mancerdata["l1-class"].values.class.replace("Classes:","")] += mancerdata["l1-class"].data.class["data-Skills bonus"] + ",";
                    } else {
                        skillBonusNotes[mancerdata["l1-class"].values.class.replace("Classes:","")] = mancerdata["l1-class"].data.class["data-Skills bonus"] + ",";
                    }
                }
                // Skill Ranks
                if(mancerdata["l1-class"].data.class["data-Skill Ranks"]) {
                    charUpd["class1_skillranks_base"] = (parseInt(charUpd["class1_skillranks_base"]) || 0) + (parseInt(mancerdata["l1-class"].data.class["data-Skill Ranks"].split("+")[0].replace(/[^\d\-]/gi, "")) || 0);
                }
                // Wealth
                if(mancerdata["l1-class"].values["class_wealth"] && mancerdata["l1-class"].values["class_wealth"] == "starting" && mancerdata["l1-class"].values["class_gp"]) {
                    charUpd["money_gp"] = parseInt(mancerdata["l1-class"].values["class_gp"]) || 0;
                } else if(mancerdata["l1-class"].data.class["data-Average Wealth"]) {
                    charUpd["money_gp"] = parseInt(mancerdata["l1-class"].data.class["data-Average Wealth"].replace("gp","").trim()) || 0;
                }
                // BAB
                if(mancerdata["l1-class"].data.class["data-Base Attack Bonus"]) {
                    charUpd["class1_bab"] = parseInt(mancerdata["l1-class"].data.class["data-Base Attack Bonus"]) || 0;
                    charUpd["bab"] = charUpd["class1_bab"];
                }
                // Saves => at saves below
                // Speeb Bonus
                if(mancerdata["l1-class"].data.class["data-Speed bonus"]) {
                    finalClassSpeed += (parseInt(mancerdata["l1-class"].data.class["data-Speed bonus"]) || 0);
                    charUpd["speed_notes"] += "+" + mancerdata["l1-class"].data.class["data-Speed bonus"] + " (" + charUpd["class1_name"] + ") ";
                }
                // AC Secondary Ability
                if(mancerdata["l1-class"].data.class["data-AC Secondary Ability"]) {
                    charUpd["ac_ability_secondary"] = mancerdata["l1-class"].data.class["data-AC Secondary Ability"].toLowerCase();
                    // Special cases
                    if(charUpd["class1_name"] == "Monk") {
                        charUpd["ac_secab_monk"] = 1;
                    }
                }
                // Spellcasting
                if(mancerdata["l1-class"].data.class["data-Spellcaster"]) {
                    charUpd["caster1_flag"] = 1;
                    charUpd["caster_flag"] = 1;
                    charUpd["caster1_class"] = charUpd["class1_name"];
                    // Spellcaster Level
                    if(mancerdata["l1-class"].data.class["data-Spellcaster Level"]) {
                        charUpd["caster1_level"] = parseInt(mancerdata["l1-class"].data.class["data-Spellcaster Level"]) || 0;
                    } else {
                        charUpd["caster1_level"] = 0;
                    }
                    // Spellcasting ability
                    if(mancerdata["l1-class"].data.class["data-Spellcasting ability"]) {
                        charUpd["caster1_ability"] = mancerdata["l1-class"].data.class["data-Spellcasting ability"].toLowerCase().trim();
                    } else {
                        charUpd["caster1_ability"] = "intelligence";
                    }
                    // Spell failure
                    if(mancerdata["l1-class"].data.class["data-Magic Type"]) {
                        charUpd["caster1_spell_failure"] = mancerdata["l1-class"].data.class["data-Magic Type"].toLowerCase() == "arcane" ? 1 : 0;
                    }
                    // Spells Per Day
                    if(mancerdata["l1-class"].data.class["data-Spells Per Day"]) {
                        let i = -1;
                        _.each(mancerdata["l1-class"].data.class["data-Spells Per Day"].split(","),(qty) => {
                            i++;
                            charUpd["caster1_spells_perday_level_" + i] = parseInt(qty.trim()) || 0;;
                            charUpd["caster1_spells_total_level_" + i] = charUpd["caster1_spells_perday_level_" + i];
                            charUpd["caster_spells_flag_level_" + i] = 1;
                        });
                    }
                    // Bonus Spells
                    let spellablt = parseInt(abilities_score[charUpd["caster1_ability"]].total) || 10;
                    if(spellablt > 11 && spellablt < 20) {
                        charUpd["caster1_spells_bonus_level_1"] = 1;
                    } else if(spellablt > 19) {
                        charUpd["caster1_spells_bonus_level_1"] = 2;
                    } else {
                        charUpd["caster1_spells_bonus_level_1"] = 0;
                    }
                    charUpd["caster1_spells_total_level_1"] = (parseInt(charUpd["caster1_spells_total_level_1"]) || 0) + parseInt(charUpd["caster1_spells_bonus_level_1"]);
                    // Spells known
                    if(mancerdata["l1-class"].data.class["data-Spells Known"]) {
                        let i = -1;
                        _.each(mancerdata["l1-class"].data.class["data-Spells Known"].split(","),(qty) => {
                            i++;
                            charUpd["caster1_spells_known_level_" + i] = parseInt(qty.trim()) || 0;
                            charUpd["caster_spells_flag_level_" + i] = 1;
                        });
                    }
                    // Spell-like abilities
                    if(mancerdata["l1-class"].data.class["data-Spell-like abilities"]) {
                        _.each(mancerdata["l1-class"].data.class["data-Spell-like abilities"].split(","), (splab) => {
                            let pawa = {};
                            pawa["Name"] = splab.trim();
                            pawa["Type"] = "Sp";
                            pawa["Spell-like"] = true;
                            pawa["Spell-source"] = splab.trim();
                            allPowers.push(pawa);
                            SpellsToLoad.push("Spells:" + splab.trim());
                        });
                    }
                }
                // Languages
                if(mancerdata["l1-class"].data.class["data-Languages"]) {
                    charUpd["languages"] += mancerdata["l1-class"].data.class["data-Languages"] + " ";
                }
                // Feats
                if(mancerdata["l1-class"].data.class["data-Bonus Feats"]) {
                    _.each(mancerdata["l1-class"].data.class["data-Bonus Feats"].split(","),(feat) => {
                        FeatsToLoad.push("Feats:" + feat.trim());
                    });
                }
                if(mancerdata["l1-class"].values.class_feat_choice) {
                    FeatsToLoad.push(mancerdata["l1-class"].values.class_feat_choice);
                }
                // Traits
                if(mancerdata["l1-class"].data.class["data-Traits"]) {
                    allTraits = allTraits.concat(mancerdata["l1-class"].data.class["data-Traits"]);
                }
            }
            // === SUBCLASS(ES)
            for(var subcls = 1; subcls < 3; subcls++) {
                if(mancerdata["l1-class"].values["class_subclass" + subcls]) {
                    charUpd["caster1_spells_notes"] += mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","") + ", ";
                    if(mancerdata["l1-class"].data["class_subclass" + subcls]) {
                        // Ability bonus
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Ability bonus choice"]) {
                            // TODO
                        }
                        //Saving Throw bonus
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Saving Throws bonus"]) {
                            charUpd["fortitude_notes"] += mancerdata["l1-class"].data["class_subclass" + subcls]["data-Saving Throws bonus"] + " (" + mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","") + "). ";
                            charUpd["reflex_notes"] += charUpd["fortitude_notes"];
                            charUpd["will_notes"] += charUpd["fortitude_notes"];
                        }
                        // Initiative bonus
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Initiative Bonus"]) {
                            charUpd["initiative_misc"] += (parseInt(charUpd["initiative_misc"]) || 0) + (parseInt(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Initiative Bonus"]) || 0);
                            charUpd["initiative_notes"] += "+" + mancerdata["l1-class"].data["class_subclass" + subcls]["data-Initiative Bonus"] + " (" + mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","") + "). ";
                        }
                        // Speed Bonus //  => speed notes
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Base Speed Bonus"]) {
                            finalClassSpeed += (parseInt(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Base Speed Bonus"]) || 0);
                            charUpd["speed_notes"] += "+" + mancerdata["l1-class"].data["class_subclass" + subcls]["data-Base Speed Bonus"] + " (" + mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","") + ") ";
                        }
                        // Class skills
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Class skills"]) {
                            allClassSkills += mancerdata["l1-class"].data["class_subclass" + subcls]["data-Class skills"] + ",";
                        }
                        // Skill bonus
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Skills bonus"]) {
                            allSkillBonus += mancerdata["l1-class"].data["class_subclass" + subcls]["data-Skills bonus"] + ",";
                            if(skillBonusNotes[mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","")]) {
                                skillBonusNotes[mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","")] += mancerdata["l1-class"].data["class_subclass" + subcls]["data-Skills bonus"] + ",";
                            } else {
                                skillBonusNotes[mancerdata["l1-class"].data.class["data-Subclass Name"] + ": " + mancerdata["l1-class"].values["class_subclass" + subcls].replace("Subclasses:","")] = mancerdata["l1-class"].data["class_subclass" + subcls]["data-Skills bonus"] + ",";
                            }
                        }
                        // Bonus Feat(s)
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Bonus Feat"]) {
                            _.each(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Bonus Feat"].split(","),(feat) => {
                                FeatsToLoad.push("Feats:" + feat.trim());
                            });
                        }
                        // Domain Spell
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Domain Spells Level 1"]) {
                            _.each(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Domain Spells Level 1"].split(","),(spell) => {
                                let spl = {};
                                spl["name"] = spell.trim();
                                spl["level"] = 1;
                                spl["domain"] = true;
                                allSpells.push(spl);
                                SpellsToLoad.push("Spells:" + spell.trim());
                            });
                        }
                        // Traits
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Traits"]) {
                            allTraits = allTraits.concat(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Traits"]);
                        }
                        // Powers
                        if(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Powers"]) {
                            allPowers = allPowers.concat(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Powers"]);
                            _.each(mancerdata["l1-class"].data["class_subclass" + subcls]["data-Powers"], (pawa) => {
                                if(pawa["Spell-source"]) {
                                    SpellsToLoad.push("Spells:" + pawa["Spell-source"]);
                                }
                            });
                        }
                    }
                }
            }
        }

        // === 4.SPEED ===
        setCharmancerText({"mancer_category":"Calculation Speed","mancer_progress" :'<div style="width: 32%"></div>'});
        charUpd["speed_race"] = finalRaceSpeed;
        charUpd["class1_speed"] = finalClassSpeed;
        charUpd["speed_class"] = finalClassSpeed;

        // === 5.SAVES ===
        setCharmancerText({"mancer_category":"Calculation Saving Throws","mancer_progress" :'<div style="width: 40%"></div>'});
        var saves_array = [{"name": "fortitude","ability": "constitution"},{"name": "reflex","ability": "dexterity"},{"name": "will","ability": "wisdom"}];
        var saves_scores = {};
        // --- Preparing saves detailed array
        _.each(saves_array, (save) => {
            saves_scores[save.name] = {"total":0,"base":0,"race":0,"class":0,"subclass":0,"misc":0, "ability": save.ability};
        });
        // --- Abilities bonus
        if(mancerdata["l1-abilities"]) {
            _.each(saves_array, function(save) {
                saves_scores[save.name].base = ability_mods[save.ability];
            });
        }
        // --- Saves race
        if(bRaceData) {
            _.each(saves_array, (save) => {
                if(mancerdata["l1-race"].data.race["data-" + save.name.charAt(0).toUpperCase() + save.name.slice(1) + " Bonus"]) {
                    saves_scores[save.name].race = (parseInt(mancerdata["l1-race"].data.race["data-" + save.name.charAt(0).toUpperCase() + save.name.slice(1) + " Bonus"]) || 0);
                    charUpd[save.name + "_notes"] += "+" + saves_scores[save.name].race + " (" + charUpd["race"] + "). ";
                }
            });
        }
        // --- Saves class
        if(bClassData) {
            if(mancerdata["l1-class"].data.class["data-Fortitude"]) {
                saves_scores["fortitude"].class = parseInt(mancerdata["l1-class"].data.class["data-Fortitude"]) || 0;
            }
            if(mancerdata["l1-class"].data.class["data-Reflex"]) {
                saves_scores["reflex"].class = parseInt(mancerdata["l1-class"].data.class["data-Reflex"]) || 0;
            }
            if(mancerdata["l1-class"].data.class["data-Will"]) {
                saves_scores["will"].class = parseInt(mancerdata["l1-class"].data.class["data-Will"]) || 0;
            }
        }
        // --- Saves subclass
        var subclsvbonus = 0;
        if(mancerdata["l1-class"].values.class_subclass1) {
            if(mancerdata["l1-class"].data && mancerdata["l1-class"].data.class_subclass1 && mancerdata["l1-class"].data.class_subclass1["data-Saving Throws bonus"]) {
                subclsvbonus = parseInt(mancerdata["l1-class"].data.class_subclass1["data-Saving Throws bonus"].replace(/[^\d\-]/gi, "")) || 0;
                _.each(saves_array, (save) => {
                    saves_scores[save.name].subclass = parseInt(saves_scores[save.name].subclass) + subclsvbonus;
                });
            }
        }
        if(mancerdata["l1-class"].values.class_subclass2) {
            if(mancerdata["l1-class"].data && mancerdata["l1-class"].data.class_subclass2 && mancerdata["l1-class"].data.class_subclass2["data-Saving Throws bonus"]) {
                subclsvbonus = parseInt(mancerdata["l1-class"].data.class_subclass2["data-Saving Throws bonus"].replace(/[^\d\-]/gi, "")) || 0;
                _.each(saves_array, (save) => {
                    saves_scores[save.name].subclass = parseInt(saves_scores[save.name].subclass) + subclsvbonus;
                });
            }
        }
        // --- Saves misc
        // Final Saves calculation
        _.each(saves_array, (save) => {
            saves_scores[save.name].total = (parseInt(saves_scores[save.name].base) || 0) + (parseInt(saves_scores[save.name].race) || 0) + (parseInt(saves_scores[save.name].class) || 0) + (parseInt(saves_scores[save.name].subclass) || 0) + (parseInt(saves_scores[save.name].misc) || 0);
            charUpd["class1_" + save.name] = (parseInt(saves_scores[save.name].class) || 0) + (parseInt(saves_scores[save.name].subclass) || 0);
            charUpd[save.name + "_base"] = charUpd["class1_" + save.name];
            charUpd[save.name + "_ability_mod"] = saves_scores[save.name].base;
            charUpd[save.name + "_misc"] = (parseInt(saves_scores[save.name].race) || 0) + (parseInt(saves_scores[save.name].misc) || 0);
            charUpd[save.name] = saves_scores[save.name].total;
        });

        // === 6.SKILLS
        setCharmancerText({"mancer_category":"Calculation Skills","mancer_progress" :'<div style="width: 44%"></div>'});
        // Class skills
        if(allClassSkills.length) {
            _.each(allClassSkills.split(","), (cls) => {
                if(cls.trim().toLowerCase().replace(/[^a-z\s]/gi, "").replace(/\s/gi,"_").length) {
                    charUpd[cls.trim().toLowerCase().replace(/[^a-z\s]/gi, "").replace(/\s/gi,"_") + "_classkill"] = 1;
                }
            });
        }
        // Bonus
        if(allSkillBonus.length) {
            _.each(allSkillBonus.split(","), (skl) => {
                if(skl.indexOf("+") != -1) {
                    let skill = skl.split("+")[0].trim().toLowerCase().replace(/[^a-z\s]/gi,"").trim().replace(/\s/gi,"_");
                    charUpd[skill + "_misc"] = (parseInt(charUpd[skill + "_misc"]) || 0)
                                      + (parseInt(skl.split("+")[1].replace(/[^\d\-]/gi, "")) || 0);
                }
            });
        }
        // Ranks
        if(mancerdata["l1-skills"] && mancerdata["l1-skills"].values) {
            _.each(Object.keys(mancerdata["l1-skills"].values), (skl) => {
                if(skl.slice(-6) == "_ranks") {
                    charUpd[skl] = mancerdata["l1-skills"].values[skl];
                }
            });
        }
        // Notes
        if(! _.isEmpty(skillBonusNotes)) {
            _.each(Object.keys(skillBonusNotes),(key) => {
                if(skillBonusNotes[key]) {
                    _.each(skillBonusNotes[key].split(","), (skl) => {
                        if(skl.indexOf("+") != -1) {
                            let skill = skl.split("+")[0].trim().toLowerCase().replace(/[^a-z\s]/gi, "").trim().replace(/\s/gi,"_");
                            charUpd[skill + "_notes"] += "+" + skl.split("+")[1].replace(/[^\d\-]/gi, "") + " (" + key + "). ";
                        }
                    });
                }
            });
        }

        // === Add FEATS to load ===
        if(mancerdata["l1-feats"] && mancerdata["l1-feats"].values["feat_lvl1_1"]) {
            FeatsToLoad.push(mancerdata["l1-feats"].values["feat_lvl1_1"]);
        }

        //  === Add SPELLS to load ===
        if(mancerdata["l1-spells"] && mancerdata["l1-spells"].values) {
            for(var j = 0; j < 2; j++) {
                for(var i = 1; i < 7; i++) {
                    if(mancerdata["l1-spells"].values["spells_level_" + j + "_" + i]) {
                        allSpells.push({"name":mancerdata["l1-spells"].values["spells_level_" + j + "_" + i],"level":j});
                        SpellsToLoad.push(mancerdata["l1-spells"].values["spells_level_" + j + "_" + i]);
                    }
                }
            }
        }

        // === 7.TRAITS ===
        setCharmancerText({"mancer_category":"Adding Traits","mancer_progress" :'<div style="width: 48%"></div>'});
        if (pfoglobals_debug_mode) {console.log("*** MancerFinish traits: " + JSON.stringify(allTraits,null,"  "));}
        _.each(allTraits, (trait) => {
            if(trait["Name"]) {
                let sec = "repeating_abilities_" + generateRowID() + "_";
                charUpd[sec + "name"] = trait["Name"];
                charUpd[sec + "options-flag"] = 0;
                if(trait["Type"]) {
                    charUpd[sec + "type"] = trait["Type"];
                }
                if(trait["Per-day"]) {
                    let perday = 0;
                    if(trait["Per-day"].indexOf("+") == -1) {
                        perday = parseInt(trait["Per-day"]) || 1;
                    } else {
                        perday = (parseInt(trait["Per-day"].split("+")[0].replace(/[^\d]/gi, "").trim()) || 1)
                                + (parseInt(ability_mods[trait["Per-day"].split("+")[1].replace("modifier", "").trim().toLowerCase()]) || 0);
                    }
                    if(perday > 0) {
                        charUpd[sec + "perday_max"] = perday;
                    }
                }
                if(trait["Description"]) {
                    charUpd[sec + "description"] = trait["Description"];
                }
            }
        });

        // === 11.ATTACKS === (special Monk ... one day)
            // TODO

        setCharmancerText({"mancer_category":"Erasing Old Data","mancer_progress" :'<div style="width: 56%"></div>'});
        erase_repsec_ids(allRepSecs, () => {
            setCharmancerText({"mancer_category":"Loading New Data","mancer_progress" :'<div style="width: 64%"></div>'});
            // Loading Compendium Pages
            let allCompendiumPages = [];
            allCompendiumPages = allCompendiumPages.concat(FeatsToLoad,SpellsToLoad);
            getCompendiumPage(allCompendiumPages,(compendiumdata) => {
                if(Array.isArray(compendiumdata)) {
                    var cdatarr = compendiumdata;
                } else {
                    var cdatarr = [];
                    cdatarr.push(compendiumdata);
                }
                // === 8.FEATS ===
                setCharmancerText({"mancer_category":"Adding Feats","mancer_progress" :'<div style="width: 72%"></div>'});
                if (pfoglobals_debug_mode) {console.log("*** MancerFinish feats: " + FeatsToLoad);}
                if(FeatsToLoad.length) {
                    _.extend(charUpd,drop_add_feats(FeatsToLoad,cdatarr));
                }

                // === 9.SPELL LIKE ABILITIES ===
                setCharmancerText({"mancer_category":"Adding Powers","mancer_progress" :'<div style="width: 80%"></div>'});
                if (pfoglobals_debug_mode) {console.log("*** MancerFinish powers: " + JSON.stringify(allPowers,null,"  "));}
                if(allPowers.length) {
                    let tmpObj = drop_add_spellike(allPowers,cdatarr,charUpd,true);
                    _.extend(charUpd,tmpObj);
                }

                // === 10.SPELLS ===
                setCharmancerText({"mancer_category":"Adding Spells","mancer_progress" :'<div style="width: 88%"></div>'});
                if (pfoglobals_debug_mode) {console.log("*** MancerFinish spells: " + JSON.stringify(SpellsToLoad,null,"  ") + " " + JSON.stringify(allSpells,null,"  "));}
                if(SpellsToLoad.length) {
                    _.extend(charUpd,drop_add_spells(allSpells,cdatarr,{},true));
                }

                if (pfoglobals_debug_mode) {console.log("*** DEBUG MancerFinish UPDATE: " + JSON.stringify(charUpd,null,"  "));}
                // === 12.FINAL ===
                setAttrs(charUpd,{silent: true},() => {
                    setCharmancerText({"mancer_category":"Global update","mancer_progress" :'<div style="width: 100%"></div>'});
                    le_big_stuff("all",false,() => {
                        update_ac_items();
                        update_coins_weight();
                        if (pfoglobals_debug_mode) {console.log("*** DEBUG MancerFinish FINISH!");}
                        finishCharactermancer();
                    });
                });
            });
        });
    });
    on("clicked:relaunch_lvl1mancer", (eventinfo) => {
        getAttrs(["l1mancer_status"], (v) => {
            var update = {};
            if(v["l1mancer_status"] === "completed") {
                update["l1mancer_status"] = "relaunch";
            }
            setAttrs(update, {silent: true}, () => {
                check_l1_mancer();
            });
        });
    });

    // === Generals
    on("change:npc", (e) => {
        if(pfoglobals_debug_mode) {
            console.log("*** DEBUG change:npc:"); // + JSON.stringify(e,null,"  "));
            console.table(e);
        }
        if( (e.sourceType == "player") && ((!e.newValue) || (e.newValue && e.newValue != "1")) ) {
            le_big_stuff("all");
        }
    });
    on("change:debug_mode", (e) => {
        if(typeof e.newValue !== "undefined") {
            if(e.newValue == "1") {
                console.log("*** DEBUG mode on");
                pfoglobals_debug_mode = 1;
            } else {
                console.log("*** DEBUG mode off");
                pfoglobals_debug_mode = 0;
            }
        } else {
            console.log("*** DEBUG mode off");
            pfoglobals_debug_mode = 0;
        }
    });
    // === Abilities
    on("change:strength_base change:strength_race change:strength_bonus change:strength_condition", () => {
        le_big_stuff("strength");
    });
    on("change:dexterity_base change:dexterity_race change:dexterity_bonus change:dexterity_condition", () => {
       le_big_stuff("dexterity");
    });
    on("change:constitution_base change:constitution_race change:constitution_bonus", () => {
        le_big_stuff("constitution");
    });
    on("change:intelligence_base change:intelligence_race change:intelligence_bonus", () => {
        le_big_stuff("intelligence");
    });
    on("change:wisdom_base change:wisdom_race change:wisdom_bonus", () => {
        le_big_stuff("wisdom");
    });
    on("change:charisma_base change:charisma_race change:charisma_bonus", () => {
        le_big_stuff("charisma");
    });
    // Mods only for NPCs
    on("change:strength", () => {
        update_mod("strength");
    });
    on("change:dexterity change:dexterity_condition_nobonus", () => {
       update_mod("dexterity");
    });
    on("change:constitution", () => {
        update_mod("constitution");
    });
    on("change:intelligence", () => {
        update_mod("intelligence");
    });
    on("change:wisdom", () => {
        update_mod("wisdom");
    });
    on("change:charisma", () => {
        update_mod("charisma");
    });

    // === Size
    on("change:size", (e) => {
        update_size(e.newValue);
    });
    on("change:encumbrance_size", () => {
        update_encumbrance();
    });

    // === HP
    on("change:hp", (e) => {
        getAttrs(["npc","hp","hp_max","hp_condition"],(v) => {
            if(v.npc !== "1") {  // PC only
                if (e.sourceType == "player") {
                    setAttrs({"hp_base": (parseInt(v.hp) || 0) - (parseInt(v.hp_condition) || 0)},{silent: true});
                }
            } else {
                if (typeof e.newValue == "undefined") {
                    var newv = 0
                } else {
                    var newv  = parseInt(e.newValue) || 0;
                }
                if(newv > 0) {
                    if((parseInt(v.hp_max) || 0) < newv) {
                        setAttrs({"hp_max":newv},{silent:true});
                    }
                }
            }
        });
    });
    on("change:hp_max", (e) => {
        if(e.sourceType == "player") {
            getAttrs(["npc","hp_max","hp_base_max","hp_condition"],(v) => {
                if(v.npc !== "1") {  // PC only
                    setAttrs({"hp_base_max": (parseInt(v.hp_max) || 0) - (parseInt(v.hp_condition) || 0)},{silent: true});
                }
            });
        }
    });
    on("change:hp_condition", (e) => {
        //theoratically only updated by sheetworker
        if(typeof e.previousValue  == "undefined") {
            var oldv = 0
        } else {
            var oldv = parseInt(e.previousValue) || 0;
        }
        if(typeof e.newValue  == "undefined") {
            var newv = 0
        } else {
            var newv  = parseInt(e.newValue) || 0;
        }
        if(newv != oldv) {
            getAttrs(["npc","hp_base","hp_base_max"],(v) => {
                if(v.npc !== "1") {  // PC only
                    var update = {};
                    update["hp"] = (parseInt(v.hp_base) || 0) + newv;
                    update["hp_max"] = (parseInt(v.hp_base_max) || 0) + newv;
                    setAttrs(update,{silent: true});
                }
            });
        }
    });
    // HD
    on("change:class_favored change:class1_hitdietype change:class2_hitdietype change:class3_hitdietype", () => {
        update_hitdie();
    });

    // === Class / Multiclassing / Musticasting
    on("change:class1_name change:class2_name change:class3_name change:caster1_flag change:caster2_flag", (e) => {
        update_class_names(e.sourceAttribute);  // => update_spells_dc => update_all_spells
    });
    on("change:class1_level change:class2_level change:class3_level", (e) => {
        update_class_numbers("level"); // => update_class_names
        update_skillranks_total();
    });
    on("change:class1_bab change:class2_bab change:class3_bab", (e) => {
        update_class_numbers("bab");
    });
    on("change:class1_fortitude change:class2_fortitude change:class3_fortitude", (e) => {
        update_class_numbers("fortitude");
    });
    on("change:class1_reflex change:class2_reflex change:class3_reflex", (e) => {
        update_class_numbers("reflex");
    });
    on("change:class1_will change:class2_will change:class3_will", (e) => {
        update_class_numbers("will");
    });
    on("change:class1_speed change:class2_speed change:class3_speed", (e) => {
        update_class_numbers("speed");
    });

    on("change:class1_skillranks_base change:class2_skillranks_base change:class3_skillranks_base", (e) => {
        update_skillranks_total();
    });

    // === Initiative
    on("change:initiative_misc change:initiative_bonus", () => {
        update_initiative();
    });

    // === AC
    on("change:ac_ability_maximum change:encumbrance_ability_maximum change:ac_condition_nobonus change:ac_secab_monk", (e) => {
        update_ac_ability(e.sourceAttribute); // => ac (=> cmd)
    });
    on("change:ac_ability_primary change:ac_ability_secondary", (e) => {
        update_ac_ability(e.newValue);  // => ac (=> cmd)
    });
    on("change:ac_bonus change:ac_armor change:ac_shield change:ac_ability_mod change:ac_size change:ac_natural change:ac_deflection change:ac_misc change:ac_dodge change:ac_touch_bonus change:ac_flatfooted_bonus change:ac_dodge_bonus change:ac_touch_bonus change:ac_natural_bonus change:ac_deflection_bonus change:ac_noflatflooted change:ac_touchshield change:ac_condition", () => {
        update_ac(); // => cmd
    });
    // AC Items
    on("remove:repeating_acitems change:repeating_acitems:equipped change:repeating_acitems:ac_bonus change:repeating_acitems:flatfooted_bonus change:repeating_acitems:touch_bonus change:repeating_acitems:natural_bonus change:repeating_acitems:deflection_bonus change:repeating_acitems:dodge_bonus change:repeating_acitems:type change:repeating_acitems:check_penalty change:repeating_acitems:max_dex_bonus change:repeating_acitems:spell_failure change:repeating_acitems:speed20 change:repeating_acitems:speed30 change:repeating_acitems:run_factor", () => {
        update_ac_items(); // => ac_ability (=> ac (=> cmd)) / speed / skills
    });
    // -- Compendium drop adjustments
    on("change:repeating_acitems:compendium_ac_bonus change:repeating_acitems:compendium_check_penalty change:repeating_acitems:compendium_max_dex_bonus change:repeating_acitems:compendium_spell_failure", (e) => {
        var update = {}, attr = e.sourceAttribute.replace("_compendium",""), val = parseInt(e.newValue.replace(/[^\d-]+/, "")) || 0;
        update[attr] = val;
        setAttrs(update,{silent:false});
    });
    on("change:repeating_acitems:compendium_armor_category", (e) => {
        var update = {}, val = "misc", runfactor = 4, typattr = e.sourceAttribute.replace("_compendium_armor_category","_type"), runattr =  e.sourceAttribute.replace("_compendium_armor_category","_run_factor");
        if(e.newValue.toLowerCase().includes("shield")) {
            val = "shield";
        }
        else if(e.newValue.toLowerCase().includes("light")) {
            val = "light";
        }
        else if(e.newValue.toLowerCase().includes("medium")) {
            val = "medium";
        }
        else if(e.newValue.toLowerCase().includes("heavy")) {
            val = "heavy";
            runfactor = 3;
        }
        update[typattr] = val;
        update[runattr] = runfactor;
        setAttrs(update,{silent:false});
    });

    // === SAVES
    on("change:fortitude_base change:fortitude_ability change:fortitude_misc change:fortitude_bonus", () => {
        update_save("fortitude");
    });
    on("change:reflex_base change:reflex_ability change:reflex_misc change:reflex_bonus", () => {
        update_save("reflex");
    });
    on("change:will_base change:will_ability change:will_misc change:will_bonus", () => {
        update_save("will");
    });

    // === BAB / ATTACK MODS / DEFENSE
    on("change:bab", (e) => {
        update_babs_all();
    });
    on("change:cmb_ability change:cmb_misc change:cmb_bonus", () => {
        update_babs("cmb");
    });
    on("change:melee_ability change:melee_misc change:melee_bonus", () => {
        update_babs("melee");
    });
    on("change:ranged_ability change:ranged_misc change:ranged_bonus", () => {
        update_babs("ranged");
    });
    on("change:cmd_misc change:cmd_bonus change:cmd_condition", () => {
        update_cmd();
    });
    /*
    on("change:bab_size", () => {
        //NB cmb_size is updated at the same time as bab_size, and update_babs_all also recalc cmb and cmd
        // => so no trigger for cmb_size
        update_babs_all();
    });
    */

    // === GEAR - ENCUMBRANCE
    // -- Compendium drop adjustments
    on("change:repeating_gear:compendium_weight", (e) => {
        var update = {};
        var attr = e.sourceAttribute.replace("_compendium_weight","_weight");
        var wght = parseInt(e.newValue.replace(/\D+/g, "")) || 2;
        update[attr] = wght;
        setAttrs(update,{silent:false});
    });
    // -- Gear weight
    on("change:repeating_gear:weight change:repeating_gear:quantity", (e) => {
        var id = e.sourceAttribute.substring(15, 35);
        update_gear_weight(id);
    });
    on("change:repeating_gear:weight_total remove:repeating_gear change:encumbrance_coins_weight change:encumbrance_coins_flag", () => {
        update_gear_weight_total();
    });
    on("change:money_cp change:money_sp change:money_gp change:money_pp", () => {
        update_coins_weight();
    });
    // -- Encumbrance & Overload
    on("change:encumbrance_load_bonus change:encumbrance_load_multiplier change:encumbrance_gear_weight", () => {
        update_encumbrance();
    });

    // === FEATS
    // -- Compendium drop adjustments
    on("change:repeating_feats:type_fromcompendium", (e) => {
        if(typeof e.newValue !== "undefined") {
            if(e.newValue.trim().length >0) {
                var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 19);
                var update = {};
                var val = e.newValue.toLowerCase().trim();
                var feattypes = ["general","combat","critical","grit","item creation","metamagic","monster","panache","performance","style","teamwork"];
                if(feattypes.includes(val)) {update[spl + "type"] = val;}
                else {update[spl + "type"] = "misc";}
                setAttrs(update,{silent: true});
            }
        }
    });

    // === SPEED
    on("change:speed_race change:speed_class", () => {
        update_ac_items();
    });
    on("change:speed_notmodified change:speed_encumbrance change:speed_armor change:armor_run_factor change:encumbrance_run_factor change:speed_base change:speed_bonus change:speed_run_factor change:speed_condition change:speed_condition_multiplier change:speed_condition_nospeed change:speed_condition_norun", () => {
        update_speed();
    });

    // === WEAPONS / ATTACKS
    // -- Display and roll calculation
    on("change:repeating_attacks:atkname change:repeating_attacks:atkflag change:repeating_attacks:atktype change:repeating_attacks:atktype2 change:repeating_attacks:atkmod change:repeating_attacks:atkcritrange change:repeating_attacks:atkrange change:repeating_attacks:dmgflag change:repeating_attacks:dmgbase change:repeating_attacks:dmgattr change:repeating_attacks:dmgmod change:repeating_attacks:dmgcritmulti change:repeating_attacks:dmgtype change:repeating_attacks:dmgbonusdice change:repeating_attacks:dmg2flag change:repeating_attacks:dmg2base change:repeating_attacks:dmg2attr change:repeating_attacks:dmg2mod change:repeating_attacks:dmg2critmulti change:repeating_attacks:dmg2type change:repeating_attacks:dmg2bonusdice change:repeating_attacks:descflag change:repeating_attacks:atkdesc change:repeating_attacks:notes", (e) => {
        var attackid = e.sourceAttribute.substring(18, 38);
        update_attacks(attackid);
    });
    // -- Compendium drop adjustments
    on("change:repeating_attacks:category", (e) => {
        var typ = "";
        var dmg = "";
        var attr = e.sourceAttribute.replace("_compendium_critical_range","_atkcritrange");
        if (e.newValue.toLowerCase().includes("ranged")) {
            typ = "ranged";
            dmg = "0";
        }
        else if (e.newValue.toLowerCase().includes("melee")) {
            typ = "melee";
            if(e.newValue.toLowerCase().includes("two-handed")) {dmg = "strength_oneandahalf";}
            else {dmg = "strength";}
        }
        if (typ != "") {
            var update = {};
            var attratk = e.sourceAttribute.replace("_category","_atktype");
            var attrdmg = e.sourceAttribute.replace("_category","_dmgattr");
            update[attratk] = typ;
            update[attrdmg] = dmg;
            setAttrs(update,{silent:false});
        }
    });
    on("change:repeating_attacks:compendium_dmg_medium", (e) => {
        getAttrs(["size"], (v) => {
            if(["medium","large","huge","gargantuan","colossal"].includes(v.size)) {
                var update = {};
                var attr = e.sourceAttribute.replace("_compendium_dmg_medium","_dmgbase");
                update[attr] = e.newValue;
                setAttrs(update,{silent:false});
            }
        });
    });
    on("change:repeating_attacks:compendium_dmg_small", (e) => {
        getAttrs(["size"], (v) => {
            if(["fine","diminutive","tiny","small"].includes(v.size)) {
                var update = {};
                var attr = e.sourceAttribute.replace("_compendium_dmg_small","_dmgbase");
                update[attr] = e.newValue;
                setAttrs(update,{silent:false});
            }
        });
    });
    on("change:repeating_attacks:compendium_critical_range", (e) => {
        var update = {};
        var attr = e.sourceAttribute.replace("_compendium_critical_range","_atkcritrange");
        var crit = parseInt(e.newValue.substr(0,2)) || 2;
        update[attr] = crit;
        setAttrs(update,{silent:false});
    });
    on("change:repeating_attacks:compendium_critical_damage", (e) => {
        var update = {};
        var attr = e.sourceAttribute.replace("_compendium_critical_damage","_dmgcritmulti");
        var crit = parseInt(e.newValue.replace(/\D+/g, "")) || 2;
        update[attr] = crit;
        setAttrs(update,{silent:false});
    });

    // === SKILLS
    on("change:armor_check_penalty change:encumbrance_check_penalty", () => {
        update_all_skills();
    });
    on("change:acrobatics_classkill change:acrobatics_ability change:acrobatics_ranks change:acrobatics_misc change:acrobatics_bonus change:acrobatics_armor_penalty", (e) => {
        // console.log("*** DEBUG acrobatics skill : " + JSON.stringify(e,null,"  "));
        update_skill("acrobatics",e.sourceAttribute);
    });
    on("change:appraise_classkill change:appraise_ability change:appraise_ranks change:appraise_misc change:appraise_bonus change:appraise_armor_penalty", (e) => {
        update_skill("appraise",e.sourceAttribute);
    });
    on("change:bluff_classkill change:bluff_ability change:bluff_ranks change:bluff_misc change:bluff_bonus change:bluff_armor_penalty", (e) => {
        update_skill("bluff",e.sourceAttribute);
    });
    on("change:climb_classkill change:climb_ability change:climb_ranks change:climb_misc change:climb_bonus change:climb_armor_penalty", (e) => {
        update_skill("climb",e.sourceAttribute);
    });
    on("change:craft_classkill change:craft_ability change:craft_ranks change:craft_misc change:craft_bonus change:craft_armor_penalty", (e) => {
        update_skill("craft",e.sourceAttribute);
    });
    on("change:repeating_skillcraft:classkill change:repeating_skillcraft:name change:repeating_skillcraft:ability change:repeating_skillcraft:ranks change:repeating_skillcraft:misc change:repeating_skillcraft:bonus change:repeating_skillcraft:armor_penalty", (e) => {
        var skillid = e.sourceAttribute.substring(0, 41);
        update_skill(skillid,e.sourceAttribute);
    });
    on("change:diplomacy_classkill change:diplomacy_ability change:diplomacy_ranks change:diplomacy_misc change:diplomacy_bonus change:diplomacy_armor_penalty", (e) => {
        update_skill("diplomacy",e.sourceAttribute);
    });
    on("change:disable_device_classkill change:disable_device_ability change:disable_device_ranks change:disable_device_misc change:disable_device_bonus change:disable_device_armor_penalty", (e) => {
        update_skill("disable_device",e.sourceAttribute);
    });
    on("change:disguise_classkill change:disguise_ability change:disguise_ranks change:disguise_misc change:disguise_bonus change:disguise_armor_penalty", (e) => {
        update_skill("disguise",e.sourceAttribute);
    });
    on("change:escape_artist_classkill change:escape_artist_ability change:escape_artist_ranks change:escape_artist_misc change:escape_artist_bonus change:escape_artist_armor_penalty", (e) => {
        update_skill("escape_artist",e.sourceAttribute);
    });
    on("change:fly_classkill change:fly_ability change:fly_ranks change:fly_misc change:fly_bonus change:fly_armor_penalty", (e) => {
        update_skill("fly",e.sourceAttribute);
    });
    on("change:handle_animal_classkill change:handle_animal_ability change:handle_animal_ranks change:handle_animal_misc change:handle_animal_bonus change:handle_animal_armor_penalty", (e) => {
        update_skill("handle_animal",e.sourceAttribute);
    });
    on("change:heal_classkill change:heal_ability change:heal_ranks change:heal_misc change:heal_bonus change:heal_armor_penalty", (e) => {
        update_skill("heal",e.sourceAttribute);
    });
    on("change:intimidate_classkill change:intimidate_ability change:intimidate_ranks change:intimidate_misc change:intimidate_bonus change:intimidate_armor_penalty", (e) => {
        update_skill("intimidate",e.sourceAttribute);
    });
    on("change:knowledge_arcana_classkill change:knowledge_arcana_ability change:knowledge_arcana_ranks change:knowledge_arcana_misc change:knowledge_arcana_bonus change:knowledge_arcana_armor_penalty", (e) => {
        update_skill("knowledge_arcana",e.sourceAttribute);
    });
    on("change:knowledge_dungeoneering_classkill change:knowledge_dungeoneering_ability change:knowledge_dungeoneering_ranks change:knowledge_dungeoneering_misc change:knowledge_dungeoneering_bonus change:knowledge_dungeoneering_armor_penalty", (e) => {
        update_skill("knowledge_dungeoneering",e.sourceAttribute);
    });
    on("change:knowledge_engineering_classkill change:knowledge_engineering_ability change:knowledge_engineering_ranks change:knowledge_engineering_misc change:knowledge_engineering_bonus change:knowledge_engineering_armor_penalty", (e) => {
        update_skill("knowledge_engineering",e.sourceAttribute);
    });
    on("change:knowledge_geography_classkill change:knowledge_geography_ability change:knowledge_geography_ranks change:knowledge_geography_misc change:knowledge_geography_bonus change:knowledge_geography_armor_penalty", (e) => {
        update_skill("knowledge_geography",e.sourceAttribute);
    });
    on("change:knowledge_history_classkill change:knowledge_history_ability change:knowledge_history_ranks change:knowledge_history_misc change:knowledge_history_bonus change:knowledge_history_armor_penalty", (e) => {
        update_skill("knowledge_history",e.sourceAttribute);
    });
    on("change:knowledge_local_classkill change:knowledge_local_ability change:knowledge_local_ranks change:knowledge_local_misc change:knowledge_local_bonus change:knowledge_local_armor_penalty", (e) => {
        update_skill("knowledge_local",e.sourceAttribute);
    });
    on("change:knowledge_nature_classkill change:knowledge_nature_ability change:knowledge_nature_ranks change:knowledge_nature_misc change:knowledge_nature_bonus change:knowledge_nature_armor_penalty", (e) => {
        update_skill("knowledge_nature",e.sourceAttribute);
    });
    on("change:knowledge_nobility_classkill change:knowledge_nobility_ability change:knowledge_nobility_ranks change:knowledge_nobility_misc change:knowledge_nobility_bonus change:knowledge_nobility_armor_penalty", (e) => {
        update_skill("knowledge_nobility",e.sourceAttribute);
    });
    on("change:knowledge_planes_classkill change:knowledge_planes_ability change:knowledge_planes_ranks change:knowledge_planes_misc change:knowledge_planes_bonus change:knowledge_planes_armor_penalty", (e) => {
        update_skill("knowledge_planes",e.sourceAttribute);
    });
    on("change:knowledge_religion_classkill change:knowledge_religion_ability change:knowledge_religion_ranks change:knowledge_religion_misc change:knowledge_religion_bonus change:knowledge_religion_armor_penalty", (e) => {
        update_skill("knowledge_religion",e.sourceAttribute);
    });
    on("change:repeating_skillknowledge:classkill change:repeating_skillknowledge:name change:repeating_skillknowledge:ability change:repeating_skillknowledge:ranks change:repeating_skillknowledge:misc change:repeating_skillknowledge:bonus change:repeating_skillknowledge:armor_penalty", (e) => {
        var skillid = e.sourceAttribute.substring(0, 45);
        update_skill(skillid,e.sourceAttribute);
    });
    on("change:linguistics_classkill change:linguistics_ability change:linguistics_ranks change:linguistics_misc change:linguistics_bonus change:linguistics_armor_penalty", (e) => {
        update_skill("linguistics",e.sourceAttribute);
    });
    on("change:perception_classkill change:perception_ability change:perception_ranks change:perception_misc change:perception_bonus change:perception_armor_penalty", (e) => {
        update_skill("perception",e.sourceAttribute);
    });
    on("change:perform_classkill change:perform_ability change:perform_ranks change:perform_misc change:perform_bonus change:perform_armor_penalty", (e) => {
        update_skill("perform",e.sourceAttribute);
    });
    on("change:repeating_skillperform:classkill change:repeating_skillperform:name change:repeating_skillperform:ability change:repeating_skillperform:ranks change:repeating_skillperform:misc change:repeating_skillperform:bonus change:repeating_skillperform:armor_penalty", (e) => {
        var skillid = e.sourceAttribute.substring(0, 43);
        update_skill(skillid,e.sourceAttribute);
    });
    on("change:profession_classkill change:profession_ability change:profession_ranks change:profession_misc change:profession_bonus change:profession_armor_penalty", (e) => {
        update_skill("profession",e.sourceAttribute);
    });
    on("change:repeating_skillprofession:classkill change:repeating_skillprofession:name change:repeating_skillprofession:ability change:repeating_skillprofession:ranks change:repeating_skillprofession:misc change:repeating_skillprofession:bonus change:repeating_skillprofession:armor_penalty", (e) => {
        var skillid = e.sourceAttribute.substring(0, 46);
        update_skill(skillid,e.sourceAttribute);
    });
    on("change:ride_classkill change:ride_ability change:ride_ranks change:ride_misc change:ride_bonus change:ride_armor_penalty", (e) => {
        update_skill("ride",e.sourceAttribute);
    });
    on("change:sense_motive_classkill change:sense_motive_ability change:sense_motive_ranks change:sense_motive_misc change:sense_motive_bonus change:sense_motive_armor_penalty", (e) => {
        update_skill("sense_motive",e.sourceAttribute);
    });
    on("change:sleight_of_hand_classkill change:sleight_of_hand_ability change:sleight_of_hand_ranks change:sleight_of_hand_misc change:sleight_of_hand_bonus change:sleight_of_hand_armor_penalty", (e) => {
        update_skill("sleight_of_hand",e.sourceAttribute);
    });
    on("change:spellcraft_classkill change:spellcraft_ability change:spellcraft_ranks change:spellcraft_misc change:spellcraft_bonus change:spellcraft_armor_penalty", (e) => {
        update_skill("spellcraft",e.sourceAttribute);
    });
    on("change:stealth_classkill change:stealth_ability change:stealth_ranks change:stealth_misc change:stealth_bonus change:stealth_armor_penalty", (e) => {
        update_skill("stealth",e.sourceAttribute);
    });
    on("change:survival_classkill change:survival_ability change:survival_ranks change:survival_misc change:survival_bonus change:survival_armor_penalty", (e) => {
        update_skill("survival",e.sourceAttribute);
    });
    on("change:swim_classkill change:swim_ability change:swim_ranks change:swim_misc change:swim_bonus change:swim_armor_penalty", (e) => {
        update_skill("swim",e.sourceAttribute);
    });
    on("change:use_magic_device_classkill change:use_magic_device_ability change:use_magic_device_ranks change:use_magic_device_misc change:use_magic_device_bonus change:use_magic_device_armor_penalty", (e) => {
        update_skill("use_magic_device",e.sourceAttribute);
    });
    on("change:repeating_skillcustom:classkill change:repeating_skillcustom:name change:repeating_skillcustom:ability change:repeating_skillcustom:ranks change:repeating_skillcustom:misc change:repeating_skillcustom:bonus change:repeating_skillcustom:armor_penalty", (e) => {
        var skillid = e.sourceAttribute.substring(0, 42);
        update_skill(skillid,e.sourceAttribute);
    });
    on("remove:repeating_skillcraft remove:repeating_skillknowledge remove:repeating_skillperform remove:repeating_skillprofession remove:repeating_skillcustom", (e) => {
        update_skills_ranks();
    });

    // SPELLS - SPELLCASTING
    // -- Armor spell failure
    on("change:armor_spell_failure change:caster1_spell_failure change:caster2_spell_failure", () => {
        getAttrs(["npc","caster1_flag","caster2_flag"], (v) => {
            if( (v.npc !== "1") &&  ((v.caster1_flag == "1") || (v.caster2_flag == "1")) ) {
                update_all_spells("all");
            }
        });
    });
    // -- Concentration & DCs
    on("change:caster1_ability change:caster1_level change:caster1_concentration_misc change:caster1_concentration_bonus change:caster2_ability change:caster2_level change:caster2_concentration_misc change:caster2_concentration_bonus", (e) => {
        update_concentration(e.sourceAttribute);  // update_concentration => update_sells_dc => update_all_spells
    });
    on("change:caster1_dc_misc change:caster1_dcbonus_level_0 change:caster1_dcbonus_level_1 change:caster1_dcbonus_level_2 change:caster1_dcbonus_level_3 change:caster1_dcbonus_level_4 change:caster1_dcbonus_level_5 change:caster1_dcbonus_level_6 change:caster1_dcbonus_level_7 change:caster1_dcbonus_level_8 change:caster1_dcbonus_level_9 change:caster2_dc_misc change:caster2_dcbonus_level_0 change:caster2_dcbonus_level_1 change:caster2_dcbonus_level_2 change:caster2_dcbonus_level_3 change:caster2_dcbonus_level_4 change:caster2_dcbonus_level_5 change:caster2_dcbonus_level_6 change:caster2_dcbonus_level_7 change:caster2_dcbonus_level_8 change:caster2_dcbonus_level_9", (e) => {
        update_spells_dc(e.sourceAttribute);
    });
    // -- DC updates to spells
    on("change:caster1_dc_level_0 change:caster1_dc_level_1 change:caster1_dc_level_2 change:caster1_dc_level_3 change:caster1_dc_level_4 change:caster1_dc_level_5 change:caster1_dc_level_6 change:caster1_dc_level_7 change:caster1_dc_level_8 change:caster1_dc_level_9 change:caster2_dc_level_0 change:caster2_dc_level_1 change:caster2_dc_level_2 change:caster2_dc_level_3 change:caster2_dc_level_4 change:caster2_dc_level_5 change:caster2_dc_level_6 change:caster2_dc_level_7 change:caster2_dc_level_8 change:caster2_dc_level_9", (e) =>{
        update_spells(e.sourceAttribute.charAt(e.sourceAttribute.length - 1),"all");
    });
    // -- Spell show flag per level
    on("change:caster1_spells_known_level_0 change:caster1_spells_known_level_1 change:caster1_spells_known_level_2 change:caster1_spells_known_level_3 change:caster1_spells_known_level_4 change:caster1_spells_known_level_5 change:caster1_spells_known_level_6 change:caster1_spells_known_level_7 change:caster1_spells_known_level_8 change:caster1_spells_known_level_9 change:caster2_spells_known_level_0 change:caster2_spells_known_level_1 change:caster2_spells_known_level_2 change:caster2_spells_known_level_3 change:caster2_spells_known_level_4 change:caster2_spells_known_level_5 change:caster2_spells_known_level_6 change:caster2_spells_known_level_7 change:caster2_spells_known_level_8 change:caster2_spells_known_level_9 change:caster1_spells_total_level_0 change:caster1_spells_total_level_1 change:caster1_spells_total_level_2 change:caster1_spells_total_level_3 change:caster1_spells_total_level_4 change:caster1_spells_total_level_5 change:caster1_spells_total_level_6 change:caster1_spells_total_level_7 change:caster1_spells_total_level_8 change:caster1_spells_total_level_9 change:caster2_spells_total_level_0 change:caster2_spells_total_level_1 change:caster2_spells_total_level_2 change:caster2_spells_total_level_3 change:caster2_spells_total_level_4 change:caster2_spells_total_level_5 change:caster2_spells_total_level_6 change:caster2_spells_total_level_7 change:caster2_spells_total_level_8 change:caster2_spells_total_level_9", (e) =>{
        update_spells_flag(e.sourceAttribute.charAt(e.sourceAttribute.length - 1));
    });
    // -- Prepared / Total
    on("change:caster1_spells_perday_level_0 change:caster1_spells_perday_level_1 change:caster1_spells_perday_level_2 change:caster1_spells_perday_level_3 change:caster1_spells_perday_level_4 change:caster1_spells_perday_level_5 change:caster1_spells_perday_level_6 change:caster1_spells_perday_level_7 change:caster1_spells_perday_level_8 change:caster1_spells_perday_level_9 change:caster1_spells_bonus_level_0 change:caster1_spells_bonus_level_1 change:caster1_spells_bonus_level_2 change:caster1_spells_bonus_level_3 change:caster1_spells_bonus_level_4 change:caster1_spells_bonus_level_5 change:caster1_spells_bonus_level_6 change:caster1_spells_bonus_level_7 change:caster1_spells_bonus_level_8 change:caster1_spells_bonus_level_9", (e) => {
        update_spells_totals(e.sourceAttribute.charAt(e.sourceAttribute.length - 1),1);
    });
    on("change:caster2_spells_perday_level_0 change:caster2_spells_perday_level_1 change:caster2_spells_perday_level_2 change:caster2_spells_perday_level_3 change:caster2_spells_perday_level_4 change:caster2_spells_perday_level_5 change:caster2_spells_perday_level_6 change:caster2_spells_perday_level_7 change:caster2_spells_perday_level_8 change:caster2_spells_perday_level_9 change:caster2_spells_bonus_level_0 change:caster2_spells_bonus_level_1 change:caster2_spells_bonus_level_2 change:caster2_spells_bonus_level_3 change:caster2_spells_bonus_level_4 change:caster2_spells_bonus_level_5 change:caster2_spells_bonus_level_6 change:caster2_spells_bonus_level_7 change:caster2_spells_bonus_level_8 change:caster2_spells_bonus_level_9", (e) => {
        update_spells_totals(e.sourceAttribute.charAt(e.sourceAttribute.length - 1),2);
    });
    on("change:repeating_spell-0:spellprepared change:repeating_spell-1:spellprepared change:repeating_spell-2:spellprepared change:repeating_spell-3:spellprepared change:repeating_spell-4:spellprepared change:repeating_spell-5:spellprepared change:repeating_spell-6:spellprepared change:repeating_spell-7:spellprepared change:repeating_spell-8:spellprepared change:repeating_spell-9:spellprepared", (e) => {
        update_spells_prepared(e.sourceAttribute,e.newValue);
    });
    // -- Removing
    on("remove:repeating_spell-0 remove:repeating_spell-1 remove:repeating_spell-2 remove:repeating_spell-3 remove:repeating_spell-4 remove:repeating_spell-5 remove:repeating_spell-6 remove:repeating_spell-7 remove:repeating_spell-8 remove:repeating_spell-9", (e) => {
        update_spells_prepared(e.sourceAttribute,"");
    });
    // -- Compendium drops
    on("change:repeating_spell-like:spellsave_fromcompendium change:repeating_spell-0:spellsave_fromcompendium change:repeating_spell-1:spellsave_fromcompendium change:repeating_spell-2:spellsave_fromcompendium change:repeating_spell-3:spellsave_fromcompendium change:repeating_spell-4:spellsave_fromcompendium change:repeating_spell-5:spellsave_fromcompendium change:repeating_spell-6:spellsave_fromcompendium change:repeating_spell-7:spellsave_fromcompendium change:repeating_spell-8:spellsave_fromcompendium change:repeating_spell-9:spellsave_fromcompendium",(e) => {
        var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 24);
        var update = {};
        if(typeof e.newValue !== "undefined") {
            if(e.newValue.trim().length > 0) {
                update[spl + "spellsave"] = e.newValue;
                if(e.newValue.toLowerCase().trim() == "none") {update[spl + "spellsaveflag"] = "0";}
                else {update[spl + "spellsaveflag"] = "{{save=1}}";}
            } else {
                update[spl + "spellsave"] = " ";
                update[spl + "spellsaveflag"] = "0";
            }
        } else {update[spl + "spellsaveflag"] = "0";}
        setAttrs(update);
    });
    on("change:repeating_spell-like:spellresistance_fromcompendium change:repeating_spell-0:spellresistance_fromcompendium change:repeating_spell-1:spellresistance_fromcompendium change:repeating_spell-2:spellresistance_fromcompendium change:repeating_spell-3:spellresistance_fromcompendium change:repeating_spell-4:spellresistance_fromcompendium change:repeating_spell-5:spellresistance_fromcompendium change:repeating_spell-6:spellresistance_fromcompendium change:repeating_spell-7:spellresistance_fromcompendium change:repeating_spell-8:spellresistance_fromcompendium change:repeating_spell-9:spellresistance_fromcompendium",(e) => {
        var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 30);
        var update = {};
        if(typeof e.newValue !== "undefined") {
            if(e.newValue.trim().length > 0) {
                update[spl + "spellresistance"] = e.newValue;
                if(e.newValue.toLowerCase().trim() == "no") {update[spl + "spellresistanceflag"] = "0";}
                else {update[spl + "spellresistanceflag"] = "{{sr=1}}";}
            } else {
                update[spl + "spellresistance"] = " ";
                update[spl + "spellresistanceflag"] = "0";
            }
        } else {update[spl + "spellresistanceflag"] = "0";}
        setAttrs(update);
    });
    on("change:repeating_spell-like:spellatk_fromcompendium change:repeating_spell-0:spellatk_fromcompendium change:repeating_spell-1:spellatk_fromcompendium change:repeating_spell-2:spellatk_fromcompendium change:repeating_spell-3:spellatk_fromcompendium change:repeating_spell-4:spellatk_fromcompendium change:repeating_spell-5:spellatk_fromcompendium change:repeating_spell-6:spellatk_fromcompendium change:repeating_spell-7:spellatk_fromcompendium change:repeating_spell-8:spellatk_fromcompendium change:repeating_spell-9:spellatk_fromcompendium",(e) => {
        if(typeof e.newValue !== "undefined") {
            getAttrs(["npc"], (v) => {
                var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 23);
                var update = {};
                if(e.newValue.toLowerCase().trim().substr(0, 6) == "ranged") {
                    update[spl + "spellatkflag"] = "{{attack=1}}";
                    if(v.npc == "0") {update[spl + "spellatktype"] = "ranged";}
                    setAttrs(update);
                } else if(e.newValue.toLowerCase().trim().substr(0, 5) == "touch") {
                    update[spl + "spellatkflag"] = "{{attack=1}}";
                    if(v.npc == "0") {update[spl + "spellatktype"] = "melee";}
                    setAttrs(update);
                }
            });
        }
    });
    on("change:repeating_spell-like:spelldmg_fromcompendium change:repeating_spell-0:spelldmg_fromcompendium change:repeating_spell-1:spelldmg_fromcompendium change:repeating_spell-2:spelldmg_fromcompendium change:repeating_spell-3:spelldmg_fromcompendium change:repeating_spell-4:spelldmg_fromcompendium change:repeating_spell-5:spelldmg_fromcompendium change:repeating_spell-6:spelldmg_fromcompendium change:repeating_spell-7:spelldmg_fromcompendium change:repeating_spell-8:spelldmg_fromcompendium change:repeating_spell-9:spelldmg_fromcompendium",(e) => {
        if(typeof e.newValue !== "undefined") {
            var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 23);
            if(e.newValue.trim().length > 0) {
                var update = {};
                update[spl + "spelldmg"] = e.newValue;
                update[spl + "spelldmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                setAttrs(update);
            }
        }
    });
    on("change:repeating_spell-like:spelldmg2_fromcompendium change:repeating_spell-0:spelldmg2_fromcompendium change:repeating_spell-1:spelldmg2_fromcompendium change:repeating_spell-2:spelldmg2_fromcompendium change:repeating_spell-3:spelldmg2_fromcompendium change:repeating_spell-4:spelldmg2_fromcompendium change:repeating_spell-5:spelldmg2_fromcompendium change:repeating_spell-6:spelldmg2_fromcompendium change:repeating_spell-7:spelldmg2_fromcompendium change:repeating_spell-8:spelldmg2_fromcompendium change:repeating_spell-9:spelldmg2_fromcompendium",(e) => {
        if(typeof e.newValue !== "undefined") {
            var spl = e.sourceAttribute.substr(0, e.sourceAttribute.length - 24);
            if(e.newValue.trim().length > 0) {
                var update = {};
                update[spl + "spelldmg2"] = e.newValue;
                update[spl + "spelldmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                setAttrs(update);
            }
        }
    });
    // -- Spell Rolls / Display
    on("change:repeating_spell-0:spellcaster change:repeating_spell-0:spellname change:repeating_spell-0:spellschool change:repeating_spell-0:spellclasslevel change:repeating_spell-0:spellcastingtime change:repeating_spell-0:spellcomponent change:repeating_spell-0:spellrange change:repeating_spell-0:spellarea change:repeating_spell-0:spelltargets change:repeating_spell-0:spelleffect change:repeating_spell-0:spellduration change:repeating_spell-0:spellsaveflag change:repeating_spell-0:spellsave change:repeating_spell-0:spelldc_mod change:repeating_spell-0:spellresistanceflag change:repeating_spell-0:spellresistance change:repeating_spell-0:spellatkflag change:repeating_spell-0:spellatktype change:repeating_spell-0:spellatkmod change:repeating_spell-0:spellatkcritrange change:repeating_spell-0:spelldmgcritmulti change:repeating_spell-0:spelldmgflag change:repeating_spell-0:spelldmg change:repeating_spell-0:spelldmgtype change:repeating_spell-0:spelldmg2flag change:repeating_spell-0:spelldmg2 change:repeating_spell-0:spelldmg2type change:repeating_spell-0:spelldescflag change:repeating_spell-0:spelldesc change:repeating_spell-0:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(0,spellid);
    });
    on("change:repeating_spell-1:spellcaster change:repeating_spell-1:spellname change:repeating_spell-1:spellschool change:repeating_spell-1:spellclasslevel change:repeating_spell-1:spellcastingtime change:repeating_spell-1:spellcomponent change:repeating_spell-1:spellrange change:repeating_spell-1:spellarea change:repeating_spell-1:spelltargets change:repeating_spell-1:spelleffect change:repeating_spell-1:spellduration change:repeating_spell-1:spellsaveflag change:repeating_spell-1:spellsave change:repeating_spell-1:spelldc_mod change:repeating_spell-1:spellresistanceflag change:repeating_spell-1:spellresistance change:repeating_spell-1:spellatkflag change:repeating_spell-1:spellatktype change:repeating_spell-1:spellatkmod change:repeating_spell-1:spellatkcritrange change:repeating_spell-1:spelldmgcritmulti change:repeating_spell-1:spelldmgflag change:repeating_spell-1:spelldmg change:repeating_spell-1:spelldmgtype change:repeating_spell-1:spelldmg2flag change:repeating_spell-1:spelldmg2 change:repeating_spell-1:spelldmg2type change:repeating_spell-1:spelldescflag change:repeating_spell-1:spelldesc change:repeating_spell-1:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(1,spellid);
    });
    on("change:repeating_spell-2:spellcaster change:repeating_spell-2:spellname change:repeating_spell-2:spellschool change:repeating_spell-2:spellclasslevel change:repeating_spell-2:spellcastingtime change:repeating_spell-2:spellcomponent change:repeating_spell-2:spellrange change:repeating_spell-2:spellarea change:repeating_spell-2:spelltargets change:repeating_spell-2:spelleffect change:repeating_spell-2:spellduration change:repeating_spell-2:spellsaveflag change:repeating_spell-2:spellsave change:repeating_spell-2:spelldc_mod change:repeating_spell-2:spellresistanceflag change:repeating_spell-2:spellresistance change:repeating_spell-2:spellatkflag change:repeating_spell-2:spellatktype change:repeating_spell-2:spellatkmod change:repeating_spell-2:spellatkcritrange change:repeating_spell-2:spelldmgcritmulti change:repeating_spell-2:spelldmgflag change:repeating_spell-2:spelldmg change:repeating_spell-2:spelldmgtype change:repeating_spell-2:spelldmg2flag change:repeating_spell-2:spelldmg2 change:repeating_spell-2:spelldmg2type change:repeating_spell-2:spelldescflag change:repeating_spell-2:spelldesc change:repeating_spell-2:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(2,spellid);
    });
    on("change:repeating_spell-3:spellcaster change:repeating_spell-3:spellname change:repeating_spell-3:spellschool change:repeating_spell-3:spellclasslevel change:repeating_spell-3:spellcastingtime change:repeating_spell-3:spellcomponent change:repeating_spell-3:spellrange change:repeating_spell-3:spellarea change:repeating_spell-3:spelltargets change:repeating_spell-3:spelleffect change:repeating_spell-3:spellduration change:repeating_spell-3:spellsaveflag change:repeating_spell-3:spellsave change:repeating_spell-3:spelldc_mod change:repeating_spell-3:spellresistanceflag change:repeating_spell-3:spellresistance change:repeating_spell-3:spellatkflag change:repeating_spell-3:spellatktype change:repeating_spell-3:spellatkmod change:repeating_spell-3:spellatkcritrange change:repeating_spell-3:spelldmgcritmulti change:repeating_spell-3:spelldmgflag change:repeating_spell-3:spelldmg change:repeating_spell-3:spelldmgtype change:repeating_spell-3:spelldmg2flag change:repeating_spell-3:spelldmg2 change:repeating_spell-3:spelldmg2type change:repeating_spell-3:spelldescflag change:repeating_spell-3:spelldesc change:repeating_spell-3:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(3,spellid);
    });
    on("change:repeating_spell-4:spellcaster change:repeating_spell-4:spellname change:repeating_spell-4:spellschool change:repeating_spell-4:spellclasslevel change:repeating_spell-4:spellcastingtime change:repeating_spell-4:spellcomponent change:repeating_spell-4:spellrange change:repeating_spell-4:spellarea change:repeating_spell-4:spelltargets change:repeating_spell-4:spelleffect change:repeating_spell-4:spellduration change:repeating_spell-4:spellsaveflag change:repeating_spell-4:spellsave change:repeating_spell-4:spelldc_mod change:repeating_spell-4:spellresistanceflag change:repeating_spell-4:spellresistance change:repeating_spell-4:spellatkflag change:repeating_spell-4:spellatktype change:repeating_spell-4:spellatkmod change:repeating_spell-4:spellatkcritrange change:repeating_spell-4:spelldmgcritmulti change:repeating_spell-4:spelldmgflag change:repeating_spell-4:spelldmg change:repeating_spell-4:spelldmgtype change:repeating_spell-4:spelldmg2flag change:repeating_spell-4:spelldmg2 change:repeating_spell-4:spelldmg2type change:repeating_spell-4:spelldescflag change:repeating_spell-4:spelldesc change:repeating_spell-4:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(4,spellid);
    });
    on("change:repeating_spell-5:spellcaster change:repeating_spell-5:spellname change:repeating_spell-5:spellschool change:repeating_spell-5:spellclasslevel change:repeating_spell-5:spellcastingtime change:repeating_spell-5:spellcomponent change:repeating_spell-5:spellrange change:repeating_spell-5:spellarea change:repeating_spell-5:spelltargets change:repeating_spell-5:spelleffect change:repeating_spell-5:spellduration change:repeating_spell-5:spellsaveflag change:repeating_spell-5:spellsave change:repeating_spell-5:spelldc_mod change:repeating_spell-5:spellresistanceflag change:repeating_spell-5:spellresistance change:repeating_spell-5:spellatkflag change:repeating_spell-5:spellatktype change:repeating_spell-5:spellatkmod change:repeating_spell-5:spellatkcritrange change:repeating_spell-5:spelldmgcritmulti change:repeating_spell-5:spelldmgflag change:repeating_spell-5:spelldmg change:repeating_spell-5:spelldmgtype change:repeating_spell-5:spelldmg2flag change:repeating_spell-5:spelldmg2 change:repeating_spell-5:spelldmg2type change:repeating_spell-5:spelldescflag change:repeating_spell-5:spelldesc change:repeating_spell-5:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(5,spellid);
    });
    on("change:repeating_spell-6:spellcaster change:repeating_spell-6:spellname change:repeating_spell-6:spellschool change:repeating_spell-6:spellclasslevel change:repeating_spell-6:spellcastingtime change:repeating_spell-6:spellcomponent change:repeating_spell-6:spellrange change:repeating_spell-6:spellarea change:repeating_spell-6:spelltargets change:repeating_spell-6:spelleffect change:repeating_spell-6:spellduration change:repeating_spell-6:spellsaveflag change:repeating_spell-6:spellsave change:repeating_spell-6:spelldc_mod change:repeating_spell-6:spellresistanceflag change:repeating_spell-6:spellresistance change:repeating_spell-6:spellatkflag change:repeating_spell-6:spellatktype change:repeating_spell-6:spellatkmod change:repeating_spell-6:spellatkcritrange change:repeating_spell-6:spelldmgcritmulti change:repeating_spell-6:spelldmgflag change:repeating_spell-6:spelldmg change:repeating_spell-6:spelldmgtype change:repeating_spell-6:spelldmg2flag change:repeating_spell-6:spelldmg2 change:repeating_spell-6:spelldmg2type change:repeating_spell-6:spelldescflag change:repeating_spell-6:spelldesc change:repeating_spell-6:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(6,spellid);
    });
    on("change:repeating_spell-7:spellcaster change:repeating_spell-7:spellname change:repeating_spell-7:spellschool change:repeating_spell-7:spellclasslevel change:repeating_spell-7:spellcastingtime change:repeating_spell-7:spellcomponent change:repeating_spell-7:spellrange change:repeating_spell-7:spellarea change:repeating_spell-7:spelltargets change:repeating_spell-7:spelleffect change:repeating_spell-7:spellduration change:repeating_spell-7:spellsaveflag change:repeating_spell-7:spellsave change:repeating_spell-7:spelldc_mod change:repeating_spell-7:spellresistanceflag change:repeating_spell-7:spellresistance change:repeating_spell-7:spellatkflag change:repeating_spell-7:spellatktype change:repeating_spell-7:spellatkmod change:repeating_spell-7:spellatkcritrange change:repeating_spell-7:spelldmgcritmulti change:repeating_spell-7:spelldmgflag change:repeating_spell-7:spelldmg change:repeating_spell-7:spelldmgtype change:repeating_spell-7:spelldmg2flag change:repeating_spell-7:spelldmg2 change:repeating_spell-7:spelldmg2type change:repeating_spell-7:spelldescflag change:repeating_spell-7:spelldesc change:repeating_spell-7:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(7,spellid);
    });
    on("change:repeating_spell-8:spellcaster change:repeating_spell-8:spellname change:repeating_spell-8:spellschool change:repeating_spell-8:spellclasslevel change:repeating_spell-8:spellcastingtime change:repeating_spell-8:spellcomponent change:repeating_spell-8:spellrange change:repeating_spell-8:spellarea change:repeating_spell-8:spelltargets change:repeating_spell-8:spelleffect change:repeating_spell-8:spellduration change:repeating_spell-8:spellsaveflag change:repeating_spell-8:spellsave change:repeating_spell-8:spelldc_mod change:repeating_spell-8:spellresistanceflag change:repeating_spell-8:spellresistance change:repeating_spell-8:spellatkflag change:repeating_spell-8:spellatktype change:repeating_spell-8:spellatkmod change:repeating_spell-8:spellatkcritrange change:repeating_spell-8:spelldmgcritmulti change:repeating_spell-8:spelldmgflag change:repeating_spell-8:spelldmg change:repeating_spell-8:spelldmgtype change:repeating_spell-8:spelldmg2flag change:repeating_spell-8:spelldmg2 change:repeating_spell-8:spelldmg2type change:repeating_spell-8:spelldescflag change:repeating_spell-8:spelldesc change:repeating_spell-8:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(8,spellid);
    });
    on("change:repeating_spell-9:spellcaster change:repeating_spell-9:spellname change:repeating_spell-9:spellschool change:repeating_spell-9:spellclasslevel change:repeating_spell-9:spellcastingtime change:repeating_spell-9:spellcomponent change:repeating_spell-9:spellrange change:repeating_spell-9:spellarea change:repeating_spell-9:spelltargets change:repeating_spell-9:spelleffect change:repeating_spell-9:spellduration change:repeating_spell-9:spellsaveflag change:repeating_spell-9:spellsave change:repeating_spell-9:spelldc_mod change:repeating_spell-9:spellresistanceflag change:repeating_spell-9:spellresistance change:repeating_spell-9:spellatkflag change:repeating_spell-9:spellatktype change:repeating_spell-9:spellatkmod change:repeating_spell-9:spellatkcritrange change:repeating_spell-9:spelldmgcritmulti change:repeating_spell-9:spelldmgflag change:repeating_spell-9:spelldmg change:repeating_spell-9:spelldmgtype change:repeating_spell-9:spelldmg2flag change:repeating_spell-9:spelldmg2 change:repeating_spell-9:spelldmg2type change:repeating_spell-9:spelldescflag change:repeating_spell-9:spelldesc change:repeating_spell-9:notes", (e) => {
        var spellid = e.sourceAttribute.substring(18, 38);
        update_spells(9,spellid);
    });
    // --- PC/NPC Spell-like abilities
    on("change:repeating_spell-like:spellname change:repeating_spell-like:spelltype change:repeating_spell-like:spellschool change:repeating_spell-like:spellclasslevel change:repeating_spell-like:spellcastingtime change:repeating_spell-like:spellrange change:repeating_spell-like:spellarea change:repeating_spell-like:spelltargets change:repeating_spell-like:spelleffect change:repeating_spell-like:spellduration change:repeating_spell-like:spellsaveflag change:repeating_spell-like:spellsave change:repeating_spell-like:spelldc_mod change:repeating_spell-like:spellresistanceflag change:repeating_spell-like:spellresistance change:repeating_spell-like:spellatkflag change:repeating_spell-like:spellatktype change:repeating_spell-like:spellatkmod change:repeating_spell-like:spellatkcritrange change:repeating_spell-like:spelldmgcritmulti change:repeating_spell-like:spelldmgflag change:repeating_spell-like:spelldmg change:repeating_spell-like:spelldmgtype change:repeating_spell-like:spelldmg2flag change:repeating_spell-like:spelldmg2 change:repeating_spell-like:spelldmg2type change:repeating_spell-like:spelldescflag change:repeating_spell-like:spelldesc change:repeating_spell-like:notes change:repeating_spell-like:timesperday change:repeating_spell-like:perday_max", (e) => {
        var spellid = e.sourceAttribute.substring(21, 41);
        update_spells("like",spellid);
    });

    // CONDITIONS
    on("change:condition_bleed change:condition_blinded change:condition_confused change:condition_cowering change:condition_dazed change:condition_dazzled change:condition_deafened change:condition_disabled change:condition_dying change:condition_energy_drained change:condition_entangled change:condition_exhausted change:condition_fascinated change:condition_fatigued change:condition_flat-footed change:condition_frightened change:condition_grappled change:condition_helpless change:condition_incorporeal change:condition_invisible change:condition_nauseated change:condition_panicked change:condition_paralyzed change:condition_petrified change:condition_pinned change:condition_prone change:condition_shaken change:condition_sickened change:condition_stable change:condition_staggered change:condition_stunned change:condition_unconscious ", () => {
        le_big_stuff("all");
    });
    on("change:conditions_reset", () => {
        le_big_stuff("all",true);
    });
    on("change:conditions_display", (e) => {
        if(e.newValue == " ") {
            setAttrs({"conditions_display":""},{silent: true});
        }
    });

    // === CONFIGURATION
    on("change:whispertype change:rollshowchar", () => {
        update_attacks("all");
        update_all_spells("all");
     });
    on("change:rollmod_attack change:rollnotes_attack change:rollmod_damage", () => {
        update_attacks("all");
    });

    // === NPC
    // --- NPC Attacks Display and Roll
    on("change:repeating_npcatk-melee:atkname change:repeating_npcatk-melee:atkmod change:repeating_npcatk-melee:multipleatk_flag change:repeating_npcatk-melee:atkmod2 change:repeating_npcatk-melee:atkmod3 change:repeating_npcatk-melee:atkmod4 change:repeating_npcatk-melee:atkmod5 change:repeating_npcatk-melee:atkmod6 change:repeating_npcatk-melee:atkmod7 change:repeating_npcatk-melee:atkmod8 change:repeating_npcatk-melee:atkmod9 change:repeating_npcatk-melee:atkcritrange change:repeating_npcatk-melee:dmgflag change:repeating_npcatk-melee:dmgbase change:repeating_npcatk-melee:dmgtype change:repeating_npcatk-melee:dmgcritmulti change:repeating_npcatk-melee:dmg2flag change:repeating_npcatk-melee:dmg2base change:repeating_npcatk-melee:dmg2type change:repeating_npcatk-melee:dmg2critmulti", (e) => {
            var atkid = e.sourceAttribute.substring(23, 43);
            update_npc_attack("melee",atkid);
    });
    on("change:repeating_npcatk-ranged:atkname change:repeating_npcatk-ranged:atkmod change:repeating_npcatk-ranged:multipleatk_flag change:repeating_npcatk-ranged:atkmod2 change:repeating_npcatk-ranged:atkmod3 change:repeating_npcatk-ranged:atkmod4 change:repeating_npcatk-ranged:atkmod5 change:repeating_npcatk-ranged:atkmod6 change:repeating_npcatk-ranged:atkmod7 change:repeating_npcatk-ranged:atkmod8 change:repeating_npcatk-ranged:atkmod9 change:repeating_npcatk-ranged:atkcritrange change:repeating_npcatk-ranged:atkrange change:repeating_npcatk-ranged:dmgflag change:repeating_npcatk-ranged:dmgbase change:repeating_npcatk-ranged:dmgtype change:repeating_npcatk-ranged:dmgcritmulti change:repeating_npcatk-ranged:dmg2flag change:repeating_npcatk-ranged:dmg2base change:repeating_npcatk-ranged:dmg2type change:repeating_npcatk-ranged:dmg2critmulti", (e) => {
            var atkid = e.sourceAttribute.substring(24, 44);
            update_npc_attack("ranged",atkid);
    });
    // -- NPC skills display
    on("change:acrobatics change:acrobatics_notes change:appraise change:appraise_notes change:bluff change:bluff_notes change:climb change:climb_notes change:craft change:craft_notes change:diplomacy change:diplomacy_notes change:disable_device change:disable_device_notes change:disguise change:disguise_notes change:escape_artist change:escape_artist_notes change:fly change:fly_notes change:handle_animal change:handle_animal_notes change:heal change:heal_notes change:intimidate change:intimidate_notes change:knowledge_arcana change:knowledge_arcana_notes change:knowledge_dungeoneering change:knowledge_dungeoneering_notes change:knowledge_engineering change:knowledge_engineering_notes change:knowledge_geography change:knowledge_geography_notes change:knowledge_history change:knowledge_history_notes change:knowledge_local change:knowledge_local_notes change:knowledge_nature change:knowledge_nature_notes change:knowledge_nobility change:knowledge_nobility_notes change:knowledge_planes change:knowledge_planes_notes change:knowledge_religion change:knowledge_religion_notes change:linguistics change:linguistics_notes change:perception change:perception_notes change:perform change:perform_notes change:profession change:profession_notes change:ride change:ride_notes change:sense_motive change:sense_motive_notes change:sleight_of_hand change:sleight_of_hand_notes change:spellcraft change:spellcraft_notes change:stealth change:stealth_notes change:survival change:survival_notes change:swim change:swim_notes change:use_magic_device change:use_magic_device_notes", (e) => {
        var skill = "";
        if (e.sourceAttribute.slice(-6) == "_notes") {skill = e.sourceAttribute.substring(0, e.sourceAttribute.indexOf("_notes"));}
        else {skill = e.sourceAttribute;}
        var fields = ["npc",skill, skill + "_notes"];
        getAttrs(fields, (v) => {
            if(v.npc == "1") {
                setAttrs(calc_npc_skill_display(skill,v[skill],v[skill + "_notes"]),{silent: true});
            }
        });
    });
    // --- NPC Compendium drops
    on("change:npcdrop_data", (e) => {
        if(pfoglobals_debug_mode) {console.log("*** DEBUG change:npcdrop_data: " + JSON.stringify(e,null,"  "));}
        if(e && e.newValue) { // && e.sourceType && e.sourceType == "player"
            check_npc_drop(e.newValue, () => {
                update_default_token();
            });
        }
    });
    on("change:npcsplike_data", (e) => {
        if(typeof e.newValue !== "undefined") {
            var cdata;
            try{
                cdata = JSON.parse(e.newValue) || {};
            }
            catch(error){
                cdata = {};
            }
            if(! _.isEmpty(cdata)) {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcsplike_data: " + JSON.stringify(cdata,null,"  "));}
                var category = cdata["Category"].toLowerCase();
                if(category == "spells") {
                    getAttrs(["npcsplike_name","npcsplike_uniq"], (v) => {
                        var objs = [];
                        var obj = {};
                        var page = {};
                        var pages = [];
                        var update = {};
                        var tmpupd = {};

                        obj["Name"] = v.npcsplike_name;
                        obj["Frequency"] = "At Will";
                        obj["Spell"] = v.npcsplike_name;
                        objs.push(obj);

                        page["name"] = v.npcsplike_name;
                        page["id"] = v.npcsplike_uniq;
                        page["data"] = cdata;
                        pages.push(page);

                        update["npcsplike_name"] = "";
                        update["npcsplike_uniq"] = "";
                        update["npcsplike_category"] = "";
                        update["npcsplike_data"] = "";

                        tmpupd = drop_add_spellike(objs,pages,{},false);
                        _.extend(update,tmpupd);

                        var spellid = Object.keys(tmpupd)[0].substring(21, 41);
                        if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcsplike_data spellid: " + spellid);}

                        setAttrs(update,{silent: true},() => {
                            update_spells("like",spellid);
                        });
                    });
                }
            }
        }
    });
    on("change:npcspl0_data change:npcspl1_data change:npcspl2_data change:npcspl3_data change:npcspl4_data change:npcspl5_data change:npcspl6_data change:npcspl7_data change:npcspl8_data change:npcspl9_data", (e) => {
        if(typeof e.newValue !== "undefined") {
            var cdata;
            try{
                cdata = JSON.parse(e.newValue) || {};
            }
            catch(error){
                cdata = {};
            }
            if(! _.isEmpty(cdata)) {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcsplX_data: " + JSON.stringify(cdata,null,"  "));}
                var category = cdata["Category"].toLowerCase();
                if(category == "spells") {
                    var level = e.sourceAttribute.substring(6, 7);
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcsplX_data level: " + level);}
                    getAttrs(["npcspl" + level + "_name","npcspl" + level + "_uniq"], (v) => {
                        var objs = [];
                        var obj = {};
                        var page = {};
                        var pages = [];
                        var update = {};
                        var tmpupd = {};

                        obj["name"] = v["npcspl" + level + "_name"];
                        obj["level"] = level;
                        objs.push(obj);

                        page["name"] = v["npcspl" + level + "_name"];
                        page["id"] = v["npcspl" + level + "_uniq"];
                        page["data"] = cdata;
                        pages.push(page);

                        update["npcspl" + level + "_name"] = "";
                        update["npcspl" + level + "_uniq"] = "";
                        update["npcspl" + level + "_category"] = "";
                        update["npcspl" + level + "_data"] = "";

                        tmpupd = drop_add_spells(objs,pages,{},false);
                        _.extend(update,tmpupd);

                        var spellid = Object.keys(tmpupd)[0].substring(18, 38);
                        if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcsplX_data spellid: " + spellid);}

                        setAttrs(update,{silent: true},() => {
                            update_spells(level,spellid);
                        });
                    });
                }
            }
        }

    });
    on("change:npcfeat_data", (e) => {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcfeat_data e: " + JSON.stringify(e,null,"  "));}
        if(typeof e.newValue !== "undefined") {
            var cdata;
            try{
                cdata = JSON.parse(e.newValue) || {};
            }
            catch(error){
                cdata = {};
            }
            if(! _.isEmpty(cdata)) {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcfeat_data: " + JSON.stringify(cdata,null,"  "));}
                var category = cdata["Category"].toLowerCase();
                if(category == "feats") {
                    getAttrs(["npcfeat_name","npcfeat_uniq"], (v) => {
                        if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcfeat_data v: " + JSON.stringify(v,null,"  "));}
                        var objs = [];
                        var page = {};
                        var pages = [];
                        var update = {};
                        var tmpupd = {};

                        objs.push(v.npcfeat_name);

                        page["name"] = v.npcfeat_name;
                        page["id"] = v.npcfeat_uniq;
                        page["data"] = cdata;
                        pages.push(page);

                        update["npcfeat_name"] = "";
                        update["npcfeat_uniq"] = "";
                        update["npcfeat_category"] = "";
                        update["npcfeat_data"] = "";

                        tmpupd = drop_add_feats(objs,pages);
                        _.extend(update,tmpupd);

                        if (pfoglobals_debug_mode) {console.log("*** DEBUG change:npcfeat_data update: " + JSON.stringify(update,null,"  "));}
                        setAttrs(update,{silent: true});
                    });
                }
            }
        }
    });

    /* === FUNCTIONS === */

    // -- NPC creation Functions
    const check_npc_drop = function(droppedData, callback) {
        if(droppedData) {
            var cdata;
            try{
                cdata = JSON.parse(droppedData) || {};
            }
            catch(error){
                cdata = {};
                if (pfoglobals_debug_mode) {console.log("*** DEBUG check_npc_drop: no valid data");}
            }
            if(! _.isEmpty(cdata)) {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG check_npc_drop:cdata: " + JSON.stringify(cdata,null,"  "));}
                if(cdata["Category"] && (cdata["Category"].toLowerCase() == "bestiary")) {
                    setAttrs({"npc": 1,"options-flag-npc": 0,"build-flag-npc": 1},{silent: true}, ()=>{
                        getAttrs(["npcdrop_name","npcdrop_uniq"], (v) => {
                            update_npc_drop(cdata, v, callback)
                        });
                    });
                }
            } else {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG check_npc_drop: empty data");}
            }
        }
    };
    const update_npc_drop = function(cdata, attrs,callback) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_npc_drop cdata: " + JSON.stringify(cdata,null,"  "));}
        var update = {};
        // Initialize NPC & show building splash
        update["version"] = pfoglobals_currentversion;
        update["l1mancer_status"] = "completed";
        update["npc"] = 1;
        update["options-flag-npc"] = 0;
        setAttrs(update, {silent: true},() => {
            update = {};
            var tmpobj = {};
            var doUpdateSpells = false;
            var callbacks = [];
            // Base NPC information
            if(attrs["npcdrop_name"]) {
                update["character_name"] = attrs["npcdrop_name"];
            }
            if(attrs["npcdrop_uniq"]) {
                update["npc_fromcompendium"] = attrs["npcdrop_uniq"];
            } else {
                update["npc_fromcompendium"] = "Bestiary:" + attrs["npcdrop_name"];
            }
            update["armor_spell_failure"] = 0;
            // Icons
            if(cdata["icon-Climate"]) {
                update["npc_icon_climate"] = cdata["icon-Climate"].toLowerCase().trim();
            }
            if(cdata["icon-Terrain"]) {
                update["npc_icon_terrain"] = cdata["icon-Terrain"].toLowerCase().trim();
            }
            if(cdata["icon-CreatureType"]) {
                update["npc_icon_type"] = cdata["icon-CreatureType"].toLowerCase().trim();
            }
            // Expansion for header color
            if(cdata["Expansion"] || cdata["expansion"]) { // "Expansion\":\"8\" => Bestiary
                update["npc_expansion"] = cdata["Expansion"] || cdata["expansion"];
            }
            // === Compendium data handling
            if(cdata["data-Size"]) {
                if(["fine","diminutive","tiny","small","medium","large","huge","gargantuan","colossal"].includes(cdata["data-Size"].toLowerCase())) {
                    update["size"] = cdata["data-Size"].toLowerCase();
                    update["size_display"] = getTranslationByKey(cdata["data-Size"].toLowerCase());
                } else {
                    update["size_display"] = cdata["data-Size"];
                }
            }
            // Spells raw data
            if(cdata["data-Spell Caster Level"]) {
                update["caster1_level"] = parseInt(cdata["data-Spell Caster Level"]) || 0;
            }
            if(cdata["data-Spell Caster Concentration"]) {
                update["caster1_concentration"] = parseInt(cdata["data-Spell Caster Concentration"]) || 0;
            }
            var objspells;
            if(cdata["data-Spells"]) {
                try{
                    objspells = JSON.parse(cdata["data-Spells"]);
                }
                catch(error) {
                    objspells = [];
                }
                update["spells_flag"] = 1;
            } else if(cdata["data-Spells Misc"]) {
                objspells = [];
                update["npc_spells_notes"] = cdata["data-Spells Misc"];
                update["spells_flag"] = 1;
            } else {
                objspells = [];
                update["spells_flag"] = 0;
            }
            // Spells infos (except spells) & per day
            for(var i = 1; i < 10; i++) {
                if(cdata["data-Spells per day-Level " + i]) {
                    update["caster1_spells_perday_level_" + i] = parseInt(cdata["data-Spells per day-Level " + i]) || 0;
                    update["caster1_spells_total_level_" + i] = parseInt(cdata["data-Spells per day-Level " + i]) || 0;
                }
            }
            if(objspells.length) {
                // Counting the spells by level
                var spellsbylevel = objspells.reduce(function(sums,entry){
                    sums[entry.level] = (sums[entry.level] || 0) + 1;
                    return sums;
                },{});
                for(var i = 1; i < 10; i++) {
                    if( (spellsbylevel["" + i]) && (! update["caster1_spells_perday_level_" + i])  ) {
                        update["caster1_spells_perday_level_" + i] = spellsbylevel["" + i];
                        update["caster1_spells_total_level_" + i] =  spellsbylevel["" + i];
                    }
                }
            }
            if(cdata["data-Bloodlines Domains Schools"]) {
                update["caster1_spells_notes"] = cdata["data-Bloodlines Domains Schools"];
            }
            // Spell-like raw data
            if(cdata["data-Spell-Like Abilities Caster Level"]) {
                update["caster2_level"] = parseInt(cdata["data-Spell-Like Abilities Caster Level"]) || 0;
            }
            if(cdata["data-Spell-Like Abilities Concentration"]) {
                update["caster2_concentration"] = parseInt(cdata["data-Spell-Like Abilities Concentration"]) || 0;
            }
            var objlikes;
            if(cdata["data-Spell-like Abilities"]) {
                try{
                    objlikes = JSON.parse(cdata["data-Spell-like Abilities"]);
                }
                catch(error){
                    objlikes = [];
                }
                update["spellabilities_flag"] = 1;
            } else if(cdata["data-Spell-Like Abilities Misc"]) {
                objlikes = [];
                update["npc_spellabilities_notes"] = cdata["data-Spell-Like Abilities Misc"];
                update["spellabilities_flag"] = 1;
            } else {
                objlikes = [];
                update["spellabilities_flag"] = 0;
            }
            if(cdata["data-CR"]) {
                update["npc_cr"] = cdata["data-CR"];
            }
            if(cdata["data-MR"]) {
                update["npc_mr"] = cdata["data-MR"];
            }
            if(cdata["data-XP"]) {
                update["xp"] = cdata["data-XP"];
            }
            if(cdata["data-Race Class Level"]) {
                update["class"] = cdata["data-Race Class Level"];
            }
            if(cdata["data-Alignment"]) {
                update["npc_alignment"] = cdata["data-Alignment"];
            }
            if(cdata["data-Type"]) {
                update["npc_type"] = cdata["data-Type"];
            }
            if(cdata["data-Initiative"]) {
                update["initiative"] = parseInt(cdata["data-Initiative"]) || 0;
            }
            if(cdata["data-Initiative Notes"]) {
                update["initiative_notes"] = "(" + cdata["data-Initiative Notes"] + ")";
            }
            if(cdata["data-Senses"]) {
                update["senses"] = cdata["data-Senses"];
            }
            if(cdata["data-Aura"]) {
                update["aura"] = cdata["data-Aura"];
            }
            if(cdata["data-AC"]) {
                update["ac"] = (parseInt(cdata["data-AC"]) || 0);
            }
            if(cdata["data-AC Touch"]) {
                update["ac_touch"] = (parseInt(cdata["data-AC Touch"]) || 0);
            }
            if(cdata["data-AC Flat-Footed"]) {
                update["ac_flatfooted"] = (parseInt(cdata["data-AC Flat-Footed"]) || 0);
            }
            if(cdata["data-AC Notes"]) {
                update["ac_notes"] = cdata["data-AC Notes"];
            }
            if(cdata["data-HP"]) {
                update["hp"] = parseInt(cdata["data-HP"]) || 0;
                update["hp_max"] = parseInt(cdata["data-HP"]) || 0;
            }
            if(cdata["data-HP Notes"]) {
                update["hp_notes"] = cdata["data-HP Notes"];
            }
            if(cdata["data-HP Roll"]) {
                update["hd_roll"] = cdata["data-HP Roll"];
            }
            if(cdata["data-HD"]) {
                update["hd"] = cdata["data-HD"];
            }
            if(cdata["data-Fort"]) {
                update["fortitude"] = parseInt(cdata["data-Fort"]) || 0;
            }
            if(cdata["data-Ref"]) {
                update["reflex"] = parseInt(cdata["data-Ref"]) || 0;
            }
            if(cdata["data-Will"]) {
                update["will"] = parseInt(cdata["data-Will"]) || 0;
            }
            if(cdata["data-Save Modifiers"]) {
                update["saves_modifiers"] = cdata["data-Save Modifiers"];
            }
            if(cdata["data-SR"]) {
                update["sr"] = parseInt(cdata["data-SR"]) || 0;
            }
            if(cdata["data-Defensive Abilities"]) {
                update["defensive_abilities"] = cdata["data-Defensive Abilities"];
            }
            if(cdata["data-DR"]) {
                update["npc_dr"] = cdata["data-DR"];
            }
            if(cdata["data-Immunities"]) {
                update["immune"] = cdata["data-Immunities"];
            }
            if(cdata["data-Resistances"]) {
                update["resist"] = cdata["data-Resistances"];
            }
            if(cdata["data-Weaknesses"]) {
                update["weaknesses"] = cdata["data-Weaknesses"];
            }
            if(cdata["data-Speed"]) {
                update["npc_speed"] = cdata["data-Speed"];
            }
            if(cdata["data-Space"]) {
                update["space"] = cdata["data-Space"];
            }
            if(cdata["data-Reach"]) {
                update["reach"] = cdata["data-Reach"];
            }
            if(cdata["data-Tactics"]) {
                update["tactics"] = cdata["data-Tactics"];
            }
            // Basic Stats
            if(cdata["data-STR"]) {
                update["strength"] = parseInt(cdata["data-STR"]) || 0;
            } else {
                update["strength"] = 0;
            }
            tmpobj = calc_ability_mod("strength",update);
            _.extend(update, tmpobj);
            if(cdata["data-DEX"]) {
                update["dexterity"] = parseInt(cdata["data-DEX"]) || 0;
            } else {
                update["dexterity"] = 0;
            }
            tmpobj = calc_ability_mod("dexterity",update);
            _.extend(update, tmpobj);
            if(cdata["data-CON"]) {
                update["constitution"] = parseInt(cdata["data-CON"]) || 0;
            } else {
                update["constitution"] = 0;
            }
            tmpobj = calc_ability_mod("constitution",update);
            _.extend(update, tmpobj);
            if(cdata["data-INT"]) {
                update["intelligence"] = parseInt(cdata["data-INT"]) || 0;
            } else {
                update["intelligence"] = 0;
            }
            tmpobj = calc_ability_mod("intelligence",update);
            _.extend(update, tmpobj);
            if(cdata["data-WIS"]) {
                update["wisdom"] = parseInt(cdata["data-WIS"]) || 0;
            } else {
                update["wisdom"] = 0;
            }
            tmpobj = calc_ability_mod("wisdom",update);
            _.extend(update, tmpobj);
            if(cdata["data-CHA"]) {
                update["charisma"] = parseInt(cdata["data-CHA"]) || 0;
            } else {
                update["charisma"] = 0;
            }
            tmpobj = calc_ability_mod("charisma",update);
            _.extend(update, tmpobj);
            if(cdata["data-Base Atk"]) {
                update["bab"] = parseInt(cdata["data-Base Atk"]) || 0;
            } else {
                update["bab"] = 0;
            }
            if(cdata["data-CMB"]) {
                update["cmb_mod"] = parseInt(cdata["data-CMB"]) || 0;
            } else {
                update["cmb_mod"] = 0;
            }
            if(cdata["data-CMB Notes"]) {
                update["cmb_notes"] = cdata["data-CMB Notes"];
            }
            if(cdata["data-CMD"]) {
                update["cmd_mod"] = parseInt(cdata["data-CMD"]) || 0;
            } else {
                update["cmd_mod"] = 0;
            }
            if(cdata["data-CMD Notes"]) {
                update["cmd_notes"] = cdata["data-CMD Notes"];
            }
            if(cdata["data-Skills Racial Modifiers"]) {
                update["skills_racial_modifiers"] = cdata["data-Skills Racial Modifiers"];
            }
            // SKILLS
            if(cdata["data-Acrobatics"]) {
                update["acrobatics"] = parseInt(cdata["data-Acrobatics"]) || 0;
            }
            if(cdata["data-Acrobatics Notes"]) {
                update["acrobatics_notes"] = cdata["data-Acrobatics Notes"];
            }
            _.extend(update,calc_npc_skill_display("acrobatics",(cdata["data-Acrobatics"] || ""),(cdata["data-Acrobatics Notes"] || "")));
            if(cdata["data-Appraise"]) {
                update["appraise"] = parseInt(cdata["data-Appraise"]) || 0;
            }
            if(cdata["data-Appraise Notes"]) {
                update["appraise_notes"] = cdata["data-Appraise Notes"];
            }
            _.extend(update,calc_npc_skill_display("appraise",(cdata["data-Appraise"] || ""),(cdata["data-Appraise Notes"] || "")));
            if(cdata["data-Bluff"]) {
                update["bluff"] = parseInt(cdata["data-Bluff"]) || 0;
            }
            if(cdata["data-Bluff Notes"]) {
                update["bluff_notes"] = cdata["data-Bluff Notes"];
            }
            _.extend(update,calc_npc_skill_display("bluff",(cdata["data-Bluff"] || ""),(cdata["data-Bluff Notes"] || "")));
            if(cdata["data-Climb"]) {
                update["climb"] = parseInt(cdata["data-Climb"]) || 0;
            }
            if(cdata["data-Climb Notes"]) {
                update["climb_notes"] = cdata["data-Climb Notes"];
            }
            _.extend(update,calc_npc_skill_display("climb",(cdata["data-Climb"] || ""),(cdata["data-Climb Notes"] || "")));
            if(cdata["data-Craft"]) {
                update["craft"] = parseInt(cdata["data-Craft"]) || 0;
            }
            if(cdata["data-Craft Notes"]) {
                update["craft_notes"] = cdata["data-Craft Notes"];
            }
            _.extend(update,calc_npc_skill_display("craft",(cdata["data-Craft"] || ""),(cdata["data-Craft Notes"] || "")));
            if(cdata["data-Diplomacy"]) {
                update["diplomacy"] = parseInt(cdata["data-Diplomacy"]) || 0;
            }
            if(cdata["data-Diplomacy Notes"]) {
                update["diplomacy_notes"] = cdata["data-Diplomacy Notes"];
            }
            _.extend(update,calc_npc_skill_display("diplomacy",(cdata["data-Diplomacy"] || ""),(cdata["data-Diplomacy Notes"] || "")));
            if(cdata["data-Disable Device"]) {
                update["disable_device"] = parseInt(cdata["data-Disable Device"]) || 0;
            }
            if(cdata["data-Disable Device Notes"]) {
                update["disable_device_notes"] = cdata["data-Disable Device Notes"];
            }
            _.extend(update,calc_npc_skill_display("disable_device",(cdata["data-Disable Device"] || ""),(cdata["data-Disable Device Notes"] || "")));
            if(cdata["data-Disguise"]) {
                update["disguise"] = parseInt(cdata["data-Disguise"]) || 0;
            }
            if(cdata["data-Disguise Notes"]) {
                update["disguise_notes"] = cdata["data-Disguise Notes"];
            }
            _.extend(update,calc_npc_skill_display("disguise",(cdata["data-Disguise"] || ""),(cdata["data-Disguise Notes"] || "")));
            if(cdata["data-Escape Artist"]) {
                update["escape_artist"] = parseInt(cdata["data-Escape Artist"]) || 0;
            }
            if(cdata["data-Escape Artist Notes"]) {
                update["escape_artist_notes"] = cdata["data-Escape Artist Notes"];
            }
            _.extend(update,calc_npc_skill_display("escape_artist",(cdata["data-Escape Artist"] || ""),(cdata["data-Escape Artist Notes"] || "")));
            if(cdata["data-Fly"]) {
                update["fly"] = parseInt(cdata["data-Fly"]) || 0;
            }
            if(cdata["data-Fly Notes"]) {
                update["fly_notes"] = cdata["data-Fly Notes"];
            }
            _.extend(update,calc_npc_skill_display("fly",(cdata["data-Fly"] || ""),(cdata["data-Fly Notes"] || "")));
            if(cdata["data-Handle Animal"]) {
                update["handle_animal"] = parseInt(cdata["data-Handle Animal"]) || 0;
            }
            if(cdata["data-Handle Animal Notes"]) {
                update["handle_animal_notes"] = cdata["data-Handle Animal Notes"];
            }
            _.extend(update,calc_npc_skill_display("handle_animal",(cdata["data-Handle Animal"] || ""),(cdata["data-Handle Animal Notes"] || "")));
            if(cdata["data-Heal"]) {
                update["heal"] = parseInt(cdata["data-Heal"]) || 0;
            }
            if(cdata["data-Heal Notes"]) {
                update["heal_notes"] = cdata["data-Heal Notes"];
            }
            _.extend(update,calc_npc_skill_display("heal",(cdata["data-Heal"] || ""),(cdata["data-Heal Notes"] || "")));
            if(cdata["data-Intimidate"]) {
                update["intimidate"] = parseInt(cdata["data-Intimidate"]) || 0;
            }
            if(cdata["data-Intimidate Notes"]) {
                update["intimidate_notes"] = cdata["data-Intimidate Notes"];
            }
            _.extend(update,calc_npc_skill_display("intimidate",(cdata["data-Intimidate"] || ""),(cdata["data-Intimidate Notes"] || "")));
            if(cdata["data-Knowledge Arcana"]) {
                update["knowledge_arcana"] = parseInt(cdata["data-Knowledge Arcana"]) || 0;
            }
            if(cdata["data-Knowledge Arcana Notes"]) {
                update["knowledge_arcana_notes"] = cdata["data-Knowledge Arcana Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_arcana",(cdata["data-Knowledge Arcana"] || ""),(cdata["data-Knowledge Arcana Notes"] || "")));
            if(cdata["data-Knowledge Dungeoneering"]) {
                update["knowledge_dungeoneering"] = parseInt(cdata["data-Knowledge Dungeoneering"]) || 0;
            }
            if(cdata["data-Knowledge Dungeoneering Notes"]) {
                update["knowledge_dungeoneering_notes"] = cdata["data-Knowledge Dungeoneering Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_dungeoneering",(cdata["data-Knowledge Dungeoneering"] || ""),(cdata["data-Knowledge Dungeoneering Notes"] || "")));
            if(cdata["data-Knowledge Engineering"]) {
                update["knowledge_engineering"] = parseInt(cdata["data-Knowledge Engineering"]) || 0;
            }
            if(cdata["data-Knowledge Engineering Notes"]) {
                update["knowledge_engineering_notes"] = cdata["data-Knowledge Engineering Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_engineering",(cdata["data-Knowledge Engineering"] || ""),(cdata["data-Knowledge Engineering Notes"] || "")));
            if(cdata["data-Knowledge Geography"]) {
                update["knowledge_geography"] = parseInt(cdata["data-Knowledge Geography"]) || 0;
            }
            if(cdata["data-Knowledge Geography Notes"]) {
                update["knowledge_geography_notes"] = cdata["data-Knowledge Geography Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_geography",(cdata["data-Knowledge Geography"] || ""),(cdata["data-Knowledge Geography Notes"] || "")));
            if(cdata["data-Knowledge History"]) {
                update["knowledge_history"] = parseInt(cdata["data-Knowledge History"]) || 0;
            }
            if(cdata["data-Knowledge History Notes"]) {
                update["knowledge_history_notes"] = cdata["data-Knowledge History Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_history",(cdata["data-Knowledge History"] || ""),(cdata["data-Knowledge History Notes"] || "")));
            if(cdata["data-Knowledge Local"]) {
                update["knowledge_local"] = parseInt(cdata["data-Knowledge Local"]) || 0;
            }
            if(cdata["data-Knowledge Local Notes"]) {
                update["knowledge_local_notes"] = cdata["data-Knowledge Local Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_local",(cdata["data-Knowledge Local"] || ""),(cdata["data-Knowledge Local Notes"] || "")));
            if(cdata["data-Knowledge Nature"]) {
                update["knowledge_nature"] = parseInt(cdata["data-Knowledge Nature"]) || 0;
            }
            if(cdata["data-Knowledge Nature Notes"]) {
                update["knowledge_nature_notes"] = cdata["data-Knowledge Nature Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_nature",(cdata["data-Knowledge Nature"] || ""),(cdata["data-Knowledge Nature Notes"] || "")));
            if(cdata["data-Knowledge Nobility"]) {
                update["knowledge_nobility"] = parseInt(cdata["data-Knowledge Nobility"]) || 0;
            }
            if(cdata["data-Knowledge Nobility Notes"]) {
                update["knowledge_nobility_notes"] = cdata["data-Knowledge Nobility Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_nobility",(cdata["data-Knowledge Nobility"] || ""),(cdata["data-Knowledge Nobility Notes"] || "")));
            if(cdata["data-Knowledge Planes"]) {
                update["knowledge_planes"] = parseInt(cdata["data-Knowledge Planes"]) || 0;
            }
            if(cdata["data-Knowledge Planes Notes"]) {
                update["knowledge_planes_notes"] = cdata["data-Knowledge Planes Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_planes",(cdata["data-Knowledge Planes"] || ""),(cdata["data-Knowledge Planes Notes"] || "")));
            if(cdata["data-Knowledge Religion"]) {
                update["knowledge_religion"] = parseInt(cdata["data-Knowledge Religion"]) || 0;
            }
            if(cdata["data-Knowledge Religion Notes"]) {
                update["knowledge_religion_notes"] = cdata["data-Knowledge Religion Notes"];
            }
            _.extend(update,calc_npc_skill_display("knowledge_religion",(cdata["data-Knowledge Religion"] || ""),(cdata["data-Knowledge Religion Notes"] || "")));
            if(cdata["data-Linguistics"]) {
                update["linguistics"] = parseInt(cdata["data-Linguistics"]) || 0;
            }
            if(cdata["data-Linguistics Notes"]) {
                update["linguistics_notes"] = cdata["data-Linguistics Notes"];
            }
            _.extend(update,calc_npc_skill_display("linguistics",(cdata["data-Linguistics"] || ""),(cdata["data-Linguistics Notes"] || "")));
            if(cdata["data-Perception"]) {
                update["perception"] = parseInt(cdata["data-Perception"]) || 0;
            }
            if(cdata["data-Perception Notes"]) {
                update["perception_notes"] = cdata["data-Perception Notes"];
            }
            _.extend(update,calc_npc_skill_display("perception",(cdata["data-Perception"] || ""),(cdata["data-Perception Notes"] || "")));
            if(cdata["data-Perform"]) {
                update["perform"] = parseInt(cdata["data-Perform"]) || 0;
            }
            if(cdata["data-Perform Notes"]) {
                update["perform_notes"] = cdata["data-Perform Notes"];
            }
            _.extend(update,calc_npc_skill_display("perform",(cdata["data-Perform"] || ""),(cdata["data-Perform Notes"] || "")));
            if(cdata["data-Profession"]) {
                update["profession"] = parseInt(cdata["data-Profession"]) || 0;
            }
            if(cdata["data-Profession Notes"]) {
                update["profession_notes"] = cdata["data-Profession Notes"];
            }
            _.extend(update,calc_npc_skill_display("profession",(cdata["data-Profession"] || ""),(cdata["data-Profession Notes"] || "")));
            if(cdata["data-Ride"]) {
                update["ride"] = parseInt(cdata["data-Ride"]) || 0;
            }
            if(cdata["data-Ride Notes"]) {
                update["ride_notes"] = cdata["data-Ride Notes"];
            }
            _.extend(update,calc_npc_skill_display("ride",(cdata["data-Ride"] || ""),(cdata["data-Ride Notes"] || "")));
            if(cdata["data-Sense Motive"]) {
                update["sense_motive"] = parseInt(cdata["data-Sense Motive"]) || 0;
            }
            if(cdata["data-Sense Motive Notes"]) {
                update["sense_motive_notes"] = cdata["data-Sense Motive Notes"];
            }
            _.extend(update,calc_npc_skill_display("sense_motive",(cdata["data-Sense Motive"] || ""),(cdata["data-Sense Motive Notes"] || "")));
            if(cdata["data-Sleight Of Hand"]) {
                update["sleight_of_hand"] = parseInt(cdata["data-Sleight Of Hand"]) || 0;
            }
            if(cdata["data-Sleight Of Hand Notes"]) {
                update["sleight_of_hand_notes"] = cdata["data-Sleight Of Hand Notes"];
            }
            _.extend(update,calc_npc_skill_display("sleight_of_hand",(cdata["data-Sleight Of Hand"] || ""),(cdata["data-Sleight Of Hand Notes"] || "")));
            if(cdata["data-Spellcraft"]) {
                update["spellcraft"] = parseInt(cdata["data-Spellcraft"]) || 0;
            }
            if(cdata["data-Spellcraft Notes"]) {
                update["spellcraft_notes"] = cdata["data-Spellcraft Notes"];
            }
            _.extend(update,calc_npc_skill_display("spellcraft",(cdata["data-Spellcraft"] || ""),(cdata["data-Spellcraft Notes"] || "")));
            if(cdata["data-Stealth"]) {
                update["stealth"] = parseInt(cdata["data-Stealth"]) || 0;
            }
            if(cdata["data-Stealth Notes"]) {
                update["stealth_notes"] = cdata["data-Stealth Notes"];
            }
            _.extend(update,calc_npc_skill_display("stealth",(cdata["data-Stealth"] || ""),(cdata["data-Stealth Notes"] || "")));
            if(cdata["data-Survival"]) {
                update["survival"] = parseInt(cdata["data-Survival"]) || 0;
            }
            if(cdata["data-Survival Notes"]) {
                update["survival_notes"] = cdata["data-Survival Notes"];
            }
            _.extend(update,calc_npc_skill_display("survival",(cdata["data-Survival"] || ""),(cdata["data-Survival Notes"] || "")));
            if(cdata["data-Swim"]) {
                update["swim"] = parseInt(cdata["data-Swim"]) || 0;
            }
            if(cdata["data-Swim Notes"]) {
                update["swim_notes"] = cdata["data-Swim Notes"];
            }
            _.extend(update,calc_npc_skill_display("swim",(cdata["data-Swim"] || ""),(cdata["data-Swim Notes"] || "")));
            if(cdata["data-Use Magic Device"]) {
                update["use_magic_device"] = parseInt(cdata["data-Use Magic Device"]) || 0;
            }
            if(cdata["data-Use Magic Device Notes"]) {
                update["use_magic_device_notes"] = cdata["data-Use Magic Device Notes"];
            }
            _.extend(update,calc_npc_skill_display("use_magic_device",(cdata["data-Use Magic Device"] || ""),(cdata["data-Use Magic Device Notes"] || "")));
            if(cdata["data-Skills Misc"]) {
                update["skills_notes"] = cdata["data-Skills Misc"];
            }
            // END SKILLS
            if(cdata["data-Languages"]) {
                update["languages"] = cdata["data-Languages"];
            }
            if(cdata["data-SQ"]) {
                update["sq"] = cdata["data-SQ"];
            }
            if(cdata["data-Combat Gear"]) {
                update["combat_gear"] = cdata["data-Combat Gear"];
            }
            if(cdata["data-Environment"]) {
                update["environment"] = cdata["data-Environment"];
            }
            if(cdata["data-Organization"]) {
                update["organization"] = cdata["data-Organization"];
            }
            if(cdata["data-Treasure"]) {
                update["treasure"] = cdata["data-Treasure"];
            }
            if(cdata["data-Description"]) {
                update["background"] = cdata["data-Description"];
            }
            // ATTACKS AND POWERS
            if(cdata["data-Attacks"]) {
                var atkz;
                try{
                    atkz = JSON.parse(cdata["data-Attacks"]);
                }
                catch(error){
                    atkz = [];
                }
                if(atkz.length) {
                    _.extend(update, npcdrop_add_attacks(atkz,update));
                }
            } else if(cdata["Melee"] || cdata["Ranged"]) {
                // Parsing PRD Monsters attacks
                if(cdata["Melee"]) {
                    update["meleeattacks_flag"] = 1;
                    _.extend(update, npc_attack_parser(cdata["Melee"],"melee",update));
                } else {
                    update["meleeattacks_flag"] = 0;
                }
                if(cdata["Ranged"]) {
                    update["rangedattacks_flag"] = 1;
                    _.extend(update, npc_attack_parser(cdata["Ranged"],"ranged",update));
                } else {
                    update["rangedattacks_flag"] = 0;
                }
            }
            if(cdata["data-Special Atk"]) {
                var specz;
                try{
                    specz = JSON.parse(cdata["data-Special Atk"]);
                }
                catch(error) {
                    specz = [];
                }
                if(specz.length) {
                    _.extend(update, npcdrop_add_special_attacks(specz));
                }
            } else if(cdata["Special Attacks"]) {
                update["specialattacks_flag"] = 1;
                update["specialattacks_notes"] = cdata["Special Attacks"];
            } else {
                update["specialattacks_flag"] = 0;
            }
            if(cdata["data-Special abilities"]) {
                var abz;
                try{
                    abz = JSON.parse(cdata["data-Special Abilities"]);
                }
                catch(error) {
                    abz = [];
                }
                if(abz.length) {
                    _.extend(update, npcdrop_add_specabs(abz));
                }
            }
            // Do 2 setAttrs: one "quick", one "long" (after getCompendiumPages), to avoid setTokenAttrs timeout
            setAttrs(update,{silent:true},() => {
                if(callback) {
                    callback();
                }
                update = {};
                var pages = [];
                if(objspells.length) {
                    doUpdateSpells = true;
                    _.each(objspells, (obj) => {
                        if(obj.name) {
                            pages.push("Spells:" + toTitleCase(obj.name));
                        }
                    });
                }
                if(objlikes.length) {
                    doUpdateSpells = true;
                    _.each(objlikes, (obj) => {
                        if(obj["Name"] && obj["Spell"]) {
                            pages.push("Spells:" + toTitleCase(obj["Spell"]));
                        }
                    });
                }
                if(cdata["data-Feats"]) {
                    var parsed;
                    var objfeats;
                    try {
                        parsed = JSON.parse(cdata["data-Feats"]);
                    }
                    catch(error) {
                        parsed = cdata["data-Feats"].split(",");
                    }
                    if(Array.isArray(parsed)) {
                        objfeats = parsed;
                    } else {
                        objfeats = [];
                    }
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG update_npc_drop feats parsing: " + objfeats);}
                    _.each(objfeats, (obj) => {
                        var featname = "";
                        if(obj.indexOf("(") === -1) {
                            featname = "Feats:" + obj.trim();
                        } else {
                            featname = "Feats:" + obj.split("(")[0].trim();
                        }
                        pages.push(featname);
                    });
                } else {
                    var objfeats = [];
                }
                getCompendiumPage(pages,(compendiumdata) => {
                    if(Array.isArray(compendiumdata)) {
                        var cdatarr = compendiumdata;
                    } else {
                        var cdatarr = [];
                        cdatarr.push(compendiumdata);
                    }
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG update_npc_drop getCompendiumPage: " + cdatarr);}
                    if(objspells.length) {
                        tmpobj = drop_add_spells(objspells,cdatarr,update,false);
                        _.extend(update, tmpobj);
                    }
                    if(objlikes.length) {
                        tmpobj = drop_add_spellike(objlikes,cdatarr,update,false);
                        _.extend(update, tmpobj);
                    }
                    if(objfeats.length) {
                        tmpobj = drop_add_feats(objfeats,cdatarr);
                        _.extend(update, tmpobj);
                    }
                    setAttrs(update,{silent:true},() => {
                        // Hide building splash
                        setAttrs({"build-flag-npc": 0},{silent: true});
                    });
                });
            });
        });
    };
    const npcdrop_add_attacks = function(objs,values) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_attacks objs: " + JSON.stringify(objs,null,"  "));}
        let update = {};
        let meleecount = 0;
        let rangedcount = 0;
        _.each(objs, (obj) => {
            if(obj["Name"]) {
                let newrowid = generateRowID();
                let repsec = "";
                let type = ""
                if(obj["Range"]) {
                    rangedcount++;
                    repsec = "repeating_npcatk-ranged_";
                    type = "ranged";
                    update[repsec + newrowid + "_atkrange"] = obj["Range"];
                } else {
                    meleecount++;
                    repsec = "repeating_npcatk-melee_";
                    type = "melee";
                }
                update[repsec + newrowid + "_atkname"] = obj["Name"];
                update[repsec + newrowid + "_options-flag"] = 0;
                if(obj["Attack Bonuses"]) { // atkmod -> atkmod9
                    let atkmodz = obj["Attack Bonuses"].replace(/[^\d\/\-]/gi, '');
                    if(atkmodz.indexOf("/") == -1) {  // one attack
                        update[repsec + newrowid + "_atkmod"] = atkmodz;
                    } else {  // multiple attacks, up to 9
                        let atks = atkmodz.split("/");
                        update[repsec + newrowid + "_multipleatk_flag"] = 1;
                        let i = 1;
                        _.each(atks, (atk) => {
                            update[repsec + newrowid + "_atkmod" + ((i > 1) ? i : "")] = atk;
                            i++;
                        });
                    }
                } else {
                    update[repsec + newrowid + "_atkmod"] = "0";
                }
                if(obj["Critical Range"]) {
                    update[repsec + newrowid + "_atkcritrange"] = parseInt(obj["Critical Range"]) || 20;
                } else {
                    update[repsec + newrowid + "_atkcritrange"] = 20;
                }
                if(obj["Damage 1"]) {
                    update[repsec + newrowid + "_dmgflag"] = 1;
                    update[repsec + newrowid + "_dmgbase"] = obj["Damage 1"];
                }
                if(obj["Damage 1 Notes or Type"]) {
                    update[repsec + newrowid + "_dmgtype"] = obj["Damage 1 Notes or Type"];
                } else {
                    update[repsec + newrowid + "_dmgtype"] = "";
                }
                if(obj["Damage 1 Critical Multiplier"]) {
                    update[repsec + newrowid + "_dmgcritmulti"] = parseInt(obj["Damage 1 Critical Multiplier"].toLowerCase().replace(/[^\d]/gi,"")) || 2;
                }
                if(obj["Damage 2"]) {
                    update[repsec + newrowid + "_dmg2flag"] = 1;
                    update[repsec + newrowid + "_dmg2base"] = obj["Damage 2"];
                }
                if(obj["Damage 2 Notes or Type"]) {
                    update[repsec + newrowid + "_dmg2type"] = obj["Damage 2 Notes or Type"];
                } else {
                    update[repsec + newrowid + "_dmg2type"] = "";
                }
                if(obj["Damage 2 Critical Multiplier"]) {
                    update[repsec + newrowid + "_dmg2critmulti"] = parseInt(obj["Damage 2 Critical Multiplier"].toLowerCase().replace(/[^\d]/gi,"")) || 2;
                }
                if(obj["Description"]) {
                    update[repsec + newrowid + "_descflag"] = 1;
                    update[repsec + newrowid + "_atkdesc"] = obj["Description"];
                }
                let tmpvalues = {};
                _.extend(tmpvalues,values,update);
                tmpvalues["npc"] = "1";
                _.extend(update,calc_npc_attack(type,newrowid,tmpvalues));
            }
        });
        if(! _.isEmpty(update)) {
            update["meleeattacks_flag"] = (meleecount > 0) ? 1 : 0;
            update["rangedattacks_flag"] = (rangedcount > 0) ? 1 : 0;
        } else {
            update["meleeattacks_flag"] = 0;
            update["rangedattacks_flag"] = 0;
        }
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_attacks update: " + JSON.stringify(update,null,"  "));}
        return update;
    };
    const npc_attack_parser = function(source,type,values) {
        let repsec = "repeating_npcatk-melee_";
        if(type == "ranged") {
            repsec = "repeating_npcatk-ranged_";
        }
        if(pfoglobals_debug_mode) {console.log("*** DEBUG npc_attack_parser: " + source + ", " + repsec);}
        let update = {};
        let strz = source.replace(/\s(or|and)\s/g,", ").split(",").map(x => x.trim());
        let newrowid = "";
        _.each(strz, (str) => {
            newrowid = generateRowID();
            let atkstr = str.split("(")[0].trim();
            let dmgstr = str.split("(")[1].trim().replace(/\)$/, "").trim();
            // Attack names and bonuses
            update[repsec + newrowid + "_atkmod"] = "0"; // safe
            let i = 0;
            _.each(atkstr.match(/(^|\+|\-)[^\+\-]+(?=(\-|\+)|$)/g), (atk) => {
                update[repsec + newrowid  + ((i > 0) ? "_atkmod" : "_atkname") + ((i > 1) ? i : "")] = ((i > 0) ? atk.replace(/[^\d\-]/gi, '') : atk.trim()) ;
                i++;
            });
            update[repsec + newrowid + "_multipleatk_flag"] = (i > 2) ? 1 : 0;
            // Range ???
            // Damage, critical range and more
            let dmgparts = dmgstr.split(" ")[0].split("/");
            if(dmgparts.length) {
                // Base damage
                update[repsec + newrowid + "_dmgflag"] = 1;
                update[repsec + newrowid + "_dmgbase"] = dmgparts[0];
                 // critical handling
                if(dmgparts.length == 3) {
                    if(dmgparts[1].match(/\d+/g)) {
                        update[repsec + newrowid + "_atkcritrange"] = (parseInt(dmgparts[1].match(/\d+/g)[0]) || 20);
                    } else {
                        update[repsec + newrowid + "_atkcritrange"] = 20;
                    }
                    update[repsec + newrowid + "_dmgcritmulti"] = parseInt(dmgparts[2].toLowerCase().replace(/[^\d]/gi,"")) || 2;
                } else if(dmgparts.length == 2) {
                    if(dmgparts[1].length && ["x",""].includes(dmgparts[1].toLowerCase().charAt(0))) {
                        update[repsec + newrowid + "_atkcritrange"] = 20;
                        update[repsec + newrowid + "_dmgcritmulti"] = parseInt(dmgparts[1].toLowerCase().replace(/[^\d]/gi,"")) || 2;
                    } else {
                        if(dmgparts[1].match(/\d+/g)) {
                            update[repsec + newrowid + "_atkcritrange"] = (parseInt(dmgparts[1].match(/\d+/g)[0]) || 20);
                        } else {
                            update[repsec + newrowid + "_atkcritrange"] = 20;
                        }
                        update[repsec + newrowid + "_dmgcritmulti"] = 2;
                    }
                } else {
                    update[repsec + newrowid + "_atkcritrange"] = 20;
                    update[repsec + newrowid + "_dmgcritmulti"] = 2;
                }
                // Notes or Type
                if(dmgstr.split(" ").length > 1) {
                    update[repsec + newrowid + "_dmgtype"] = dmgstr.replace(dmgstr.split(" ")[0],"").trim();
                } else {
                    update[repsec + newrowid + "_dmgtype"] = "";
                }
            }
            // Misc
            update[repsec + newrowid + "_options-flag"] = 0;
            let tmpvalues = {};
            _.extend(tmpvalues,values,update);
            tmpvalues["npc"] = "1";
            _.extend(update,calc_npc_attack(type,newrowid,tmpvalues));
        });
        if(pfoglobals_debug_mode) {console.log("*** DEBUG npc_attack_parser update: " + JSON.stringify(update,null,"  "));}
        return update;
    };
    const npcdrop_add_special_attacks = function(objs) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_special_attacks objs: " + JSON.stringify(objs,null,"  "));}
        var update = {};
        var repsec = "repeating_npcatk-special_";
        _.each(objs, (obj) => {
            var newrowid = generateRowID();
            if(obj["Name"]) { //atkname
                update[repsec + newrowid + "_atkname"] = obj["Name"];
                update[repsec + newrowid + "_options-flag"] = 0;
            }
            if(obj["Per Day"]) {
                update[repsec + newrowid + "_perday_max"] = parseInt(obj["Per Day"]) || 1;
            }
            if(obj["Attack Bonus"]) { // atkmod
                update[repsec + newrowid + "_atkflag"] = "{{attack=1}}{{roll=[[1d20cs>@{atkcritrange}+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}{{critconfirm=[[1d20cs20+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}";
                update[repsec + newrowid + "_atkmod"] = obj["Attack Bonus"].replace(/[^\d\-]/gi, '');
            } else {
                update[repsec + newrowid + "_atkflag"] = "0";
            }
            if(obj["Critical Range"]) {
                update[repsec + newrowid + "_atkcritrange"] = parseInt(obj["Critical Range"].replace(/[^\d]/gi, '')) || 20;
            } else {
                update[repsec + newrowid + "_atkcritrange"] = 20;
            }
            if(obj["Range"]) {
                update[repsec + newrowid + "_rangeflag"] = "{{range=@{atkrange}}}";
                update[repsec + newrowid + "_atkrange"] = obj["Range"];
            }
            if(obj["Area"]) {
                update[repsec + newrowid + "_areaflag"] = "{{area=@{atkarea}}}";
                update[repsec + newrowid + "_atkarea"] = obj["Area"];
            }
            if(obj["Effect"]) {
                update[repsec + newrowid + "_effectflag"] = "{{effect=@{atkeffect}}}";
                update[repsec + newrowid + "_atkeffect"] = obj["Effect"];
            }
            if(obj["Saving Throw"]) {
                update[repsec + newrowid + "_atksave"] = obj["Saving Throw"];
                if(obj["Saving Throw"].toLowerCase().trim() == "none") {
                    update[repsec + newrowid + "_atksaveflag"] = "0";
                } else {
                    update[repsec + newrowid + "_atksaveflag"] = "{{save=1}}{{savedc=@{atkdc}}}{{saveeffect=@{atksave}}}";
                }
            } else {
                update[repsec + newrowid + "_atksave"] = " ";
            }
            if(obj["Saving Throw DC"]) {
                if(! update[repsec + newrowid + "_atksaveflag"]) {
                    update[repsec + newrowid + "_atksaveflag"] = "{{save=1}}{{savedc=@{atkdc}}}{{saveeffect=@{atksave}}}";
                }
                update[repsec + newrowid + "_atkdc"] = parseInt(obj["Saving Throw DC"].replace(/[^\d\-]/gi, '')) || 0;
            }
            if(obj["Damage 1"]) {
                update[repsec + newrowid + "_dmgflag"] = "{{damage=1}}{{dmg1flag=1}}{{dmg1=[[@{dmgbase}[MOD]+@{rollmod_damage}[BONUS]]]}}{{dmg1type=@{dmgtype}}}{{dmg1crit=[[(@{dmgbase}[MOD]+@{rollmod_damage}[BONUS])*@{dmgcritmulti}]]}}";
                update[repsec + newrowid + "_dmgbase"] = obj["Damage 1"];
            }
            if(obj["Damage 1 Notes or Type"]) {
                update[repsec + newrowid + "_dmgtype"] = obj["Damage 1 Notes or Type"];
            }
            if(obj["Damage 1 Critical Multiplier"]) {
                update[repsec + newrowid + "_dmgcritmulti"] = parseInt(obj["Damage 1 Critical Multiplier"].toLowerCase().replace("x","")) || 2;
            }
            if(obj["Damage 2"]) {
                update[repsec + newrowid + "_dmg2flag"] = "{{damage=1}} {{dmg2flag=1}}{{dmg2=[[@{dmg2base}[MOD]+@{rollmod_damage}[BONUS]]]}}{{dmg2type=@{dmg2type}}}{{dmg2crit=[[(@{dmg2base}[MOD]+@{rollmod_damage}[BONUS])*@{dmg2critmulti}]]}}";
                update[repsec + newrowid + "_dmg2base"] = obj["Damage 2"];
            }
            if(obj["Damage 2 Notes or Type"]) {
                update[repsec + newrowid + "_dmg2type"] = obj["Damage 2 Notes or Type"];
            }
            if(obj["Damage 2 Critical Multiplier"]) {
                update[repsec + newrowid + "_dmg2critmulti"] = parseInt(obj["Damage 2 Critical Multiplier"].toLowerCase().replace("x","")) || 2;
            }
            if(obj["Description"]) {
                update[repsec + newrowid + "_descflag"] = "{{descflag=[[1]]}}{{desc=@{atkdesc}}}";
                update[repsec + newrowid + "_atkdesc"] = obj["Description"];
            }
        });
        if(! _.isEmpty(update)) {
            update["specialattacks_flag"] = 1;
        } else {
            update["specialattacks_flag"] = 0;
        }
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_special_attacks update: " + JSON.stringify(update,null,"  "));}
        return update;
    };
    const npcdrop_add_specabs = function(objs) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_specabs objs: " + JSON.stringify(objs,null,"  "));}
        var update = {};
        var repsec = "repeating_abilities_";
        _.each(objs, (obj) => {
            var newrowid = generateRowID();
            if(obj["Name"]) {
                update[repsec + newrowid + "_name"] = obj["Name"];
                update[repsec + newrowid + "_options-flag"] = 0;
                update[repsec + newrowid + "_fromcompendium"] = obj["Name"];
            }
            if(obj["Type"]) {
                update[repsec + newrowid + "_type"] = obj["Type"];
            }
            if(obj["Description"]) {
                update[repsec + newrowid + "_descflag"] = "{{descflag=[[1]]}}{{desc=@{description}}}";
                update[repsec + newrowid + "_description"] = obj["Description"];
            }
            // TODO : pull from compendium (???) + callbacks
        });
        if(! _.isEmpty(update)) {
            update["special_abilities_flag"] = 1;
        } else {
            update["special_abilities_flag"] = 0;
        }
        if (pfoglobals_debug_mode) {console.log("*** DEBUG npcdrop_add_specabs update :" + JSON.stringify(update,null,"  "));}
        return update;
    };
    const calc_npc_skill_display = function(skill,value,note) {
        var update = {};
        var display = "";
        var flag = 0;
        var intval = parseInt(value) || 0;
        if (intval != 0 ) {
            display += (intval >= 0) ? ("+" + intval) : ("" + intval);
            flag = 1;
        }
        if(note && (note.length > 0)) {
            if(display.length === 0) {display += "+0";}
            display += " (" + note + ")";
            flag = 1;
        }
        update[skill + "_display"] = display;
        update[skill + "_flag"] = flag;
        return update;
    };
    const update_default_token = function() {
        // Token default attributes handling
        getAttrs(["hp_max","ac","size","cd_bar1_v","cd_bar1_m","cd_bar1_l","cd_bar2_v","cd_bar2_m","cd_bar2_l","cd_bar3_v","cd_bar3_m","cd_bar3_l"], (v) => {
            // TOKEN handling
            var default_attr = {};
            default_attr["width"] = 70;
            default_attr["height"] = 70;
            if(v["size"]) {
                var squares = 1.0;
                var squarelength = 70;
                var obj_size = pfoglobals_size.find((size_item) => size_item.size === v["size"]);
                if(! _.isEmpty(obj_size)) {
                    squares = Math.max((parseFloat(obj_size.squares) || 1.0), 1.0);
                }
                let squaresize = parseInt(squarelength * squares);
                default_attr["width"] = squaresize;
                default_attr["height"] = squaresize;
            }
            var getList = {};
            for(x = 1; x <= 3; x++) {
                _.each(["v", "m"], (letter) => {
                    var keyname = "cd_bar" + x + "_" + letter;
                    if((typeof v[keyname] !== "undefined") && isNaN(v[keyname])) {getList[keyname] = v[keyname];}
                });
            }
            getAttrs(_.values(getList), (values) =>  {
                _.each(_.keys(getList), (keyname) => {
                    v[keyname] = values[getList[keyname]] == undefined ? "" : values[getList[keyname]];
                });
                if(v["cd_bar1_l"]) {default_attr["bar1_link"] = v["cd_bar1_l"];}
                else if(v["cd_bar1_v"] || v["cd_bar1_m"]) {
                    if(v["cd_bar1_v"]) {default_attr["bar1_value"] = v["cd_bar1_v"];}
                    if(v["cd_bar1_m"]) {default_attr["bar1_max"] = v["cd_bar1_m"];}
                } else {
                    default_attr["bar1_value"] = v["hp_max"];
                    default_attr["bar1_max"] = v["hp_max"];
                }
                if(v["cd_bar2_l"]) {default_attr["bar2_link"] = v["cd_bar2_l"];}
                else if(v["cd_bar2_v"] || v["cd_bar2_m"]) {
                    if(v["cd_bar2_v"]) {default_attr["bar2_value"] = v["cd_bar2_v"];}
                    if(v["cd_bar2_m"]) {default_attr["bar2_max"] = v["cd_bar2_m"];}
                }
                else {default_attr["bar2_link"] = "ac";}
                if(v["cd_bar3_l"]) {default_attr["bar3_link"] = v["cd_bar3_l"];}
                else if(v["cd_bar3_v"] || v["cd_bar3_m"]) {
                    if(v["cd_bar3_v"]) {default_attr["bar3_value"] = v["cd_bar3_v"];}
                    if(v["cd_bar3_m"]) {default_attr["bar3_max"] = v["cd_bar3_m"];}
                }
                setDefaultToken(default_attr);
            });
        });
    };

    // === DROP / COMPENDIUM
    const drop_add_feats = function(objs,cdatarr) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_feats objs :" + JSON.stringify(objs,null,"  "));}
        let update = {};
        // return update;
        let repsec = "_";
        _.each(objs, (obj) => {
            let featObj = {};
            let newrowid = generateRowID();
            let featname = "";
            let featname2 = "";
            let featRepsec = "repeating_feats";
            featname = obj.trim().replace("Feats:","").trim();
            if(obj.indexOf("(") != -1) {
                featname2 = obj.split("(")[0].trim().replace("Feats:","").trim();
            }
            featObj[repsec + newrowid + "_name"] = featname;
            featObj[repsec + newrowid + "_options-flag"] = 0;
            featObj[repsec + newrowid + "_type"] = "misc";
            if(! _.isEmpty(cdatarr)) {
                let cdata = cdatarr.find(o => ((o.data["Feat Name"]) && (o.data["Feat Name"].toLowerCase().trim() === featname.toLowerCase()) && (o.data["Category"] === "Feats")));
                if((!(cdata && cdata.id  && cdata.data))  && featname2.length) {
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_feats 2nd search with: " + featname2);}
                    cdata = cdatarr.find(o => ((o.data["Feat Name"]) && (o.data["Feat Name"].toLowerCase().trim() === featname2.toLowerCase()) && (o.data["Category"] === "Feats")));
                }
                if(cdata && cdata.id && cdata.data) {
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_feats cdata: " + JSON.stringify(cdata,null,"  "));}
                    if(cdata.data["Feat Name"]) {
                        featObj[repsec + newrowid + "_fromcompendium"] = "Feats:" + cdata["name"];
                    }
                    if(cdata.data["Feat Type"]) {
                        let featType = cdata.data["Feat Type"].toLowerCase().trim();
                        if(["general","combat","critical","grit","item creation","metamagic","monster","panache","performance","style","teamwork"].includes(featType)) {
                            featObj[repsec + newrowid + "_type"] = featType;
                            if(featType == "metamagic") {
                                featRepsec = "repeating_metamagic";
                            }
                        } else {
                            featObj[repsec + newrowid + "_type"] = "misc";
                        }
                    }
                    if(cdata.data["Prerequisites"]) {
                        featObj[repsec + newrowid + "_prerequisites"] = cdata.data["Prerequisites"];
                    }
                    if(cdata.data["Benefit"]) {
                        featObj[repsec + newrowid + "_benefits"] = cdata.data["Benefit"];
                    }
                    if(cdata.data["Normal"]) {
                        featObj[repsec + newrowid + "_normal"] = cdata.data["Normal"];
                    }
                    if(cdata.data["data-description"]) {
                        featObj[repsec + newrowid + "_description"] = cdata.data["data-description"];
                    }
                } else if(pfoglobals_debug_mode) {
                    console.log("*** DEBUG drop_add_feats feat not found with " + featname + " or " + featname2 + " in " + JSON.stringify(cdatarr,null,"  "));
                }
            }
            _.each(Object.keys(featObj),(key) => {
                update[featRepsec + key] = featObj[key];
            });
        });
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_feats update :" + JSON.stringify(update,null,"  "));}
        return update;
    };
    const drop_add_spells = function(objs, cdatarr, values, isPc = false) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_spells objs: " + JSON.stringify(objs,null,"  "));}
        var update = {};
        var baserepsec = "repeating_spell";
        _.each(objs, (obj) => {
            if(obj.name) {
                var newrowid = generateRowID();
                var level = 0;
                if(obj.level) {
                    level = parseInt(obj.level) || 0;
                }
                var repsec = baserepsec + "-" + level + "_";
                update[repsec + newrowid + "_spellname"] = toTitleCase(obj.name.replace("Spells:",""));
                if(obj.domain) {
                    if(isPc) {
                        update[repsec + newrowid + "_spelldomaineflag"] = 1;
                    } else {
                        update[repsec + newrowid + "_spellname"] += " (D)";
                    }
                }
                update[repsec + newrowid + "_options-flag"] = 0;
                if(! _.isEmpty(cdatarr)) {
                    var cdata = cdatarr.find(o => (o.name.toLowerCase().trim() === obj.name.replace("Spells:","").toLowerCase().trim() && o.data["Category"] === "Spells"));
                    // console.log("*** DEBUG drop_add_spells cdata :" + JSON.stringify(cdata,null,"  "));
                    if(cdata && cdata.id  && cdata.data) {
                        update[repsec + newrowid + "_fromcompendium"] = "Spells:" + cdata["name"];
                        if(cdata.data["School"]) {
                            update[repsec + newrowid + "_spellschool"] = cdata.data["School"];
                        }
                        if(cdata.data["Level"]) {
                            update[repsec + newrowid + "_spellclasslevel"] = cdata.data["Level"];
                        }
                        if(cdata.data["Casting Time"]) {
                            update[repsec + newrowid + "_spellcastingtime"] = cdata.data["Casting Time"];
                        }
                        if(cdata.data["Components"]) {
                            update[repsec + newrowid + "_spellcomponent"] = cdata.data["Components"];
                        }
                        if(cdata.data["Range"]) {
                            update[repsec + newrowid + "_spellrange"] = cdata.data["Range"];
                        }
                        if(cdata.data["Area"]) {
                            update[repsec + newrowid + "_spellarea"] = cdata.data["Area"];
                        }
                        if(cdata.data["Target"]) {
                            update[repsec + newrowid + "_spelltargets"] = cdata.data["Target"];
                        }
                        if(cdata.data["Effect"]) {
                            update[repsec + newrowid + "_spelleffect"] = cdata.data["Effect"];
                        }
                        if(cdata.data["Duration"]) {
                            update[repsec + newrowid + "_spellduration"] = cdata.data["Duration"];
                        }
                        if(cdata.data["Saving Throw"]) {
                            update[repsec + newrowid + "_spellsave"] = cdata.data["Saving Throw"];
                            if(cdata.data["Saving Throw"].toLowerCase().trim() == "none") {
                                update[repsec + newrowid + "_spellsaveflag"] = 0;
                            } else {
                                update[repsec + newrowid + "_spellsaveflag"] = "{{save=1}}";
                            }
                        } else {
                            update[repsec + newrowid + "_spellsave"] = " ";
                        }
                        if(obj.dc) {
                            if(! update[repsec + newrowid + "_spellsaveflag"]) {
                                update[repsec + newrowid + "_spellsaveflag"] = "{{save=1}}";
                            }
                            update[repsec + newrowid + "_spelldc_mod"] = parseInt(String(obj.dc).replace(/[^\d]/gi, '')) || 0;
                        }
                        if(cdata.data["Spell Resistance"]) {
                            update[repsec + newrowid + "_spellresistance"] = cdata.data["Spell Resistance"];
                            if(cdata.data["Spell Resistance"].toLowerCase().trim() == "no") {
                                update[repsec + newrowid + "_spellresistanceflag"] = "0";
                            } else {
                                update[repsec + newrowid + "_spellresistanceflag"] = "{{sr=1}}";
                            }
                        }
                        if(cdata.data["Spell Attack"]) {
                            update[repsec + newrowid + "_spellatkflag"] = "{{attack=1}}";
                            if(cdata.data["Spell Attack"].toLowerCase().indexOf("ranged touch") !== -1) {
                                update[repsec + newrowid + "_spellatktype"] =  "ranged";
                            } else if(cdata.data["Spell Attack"].toLowerCase().indexOf("touch") !== -1) {
                                update[repsec + newrowid + "_spellatktype"] =  "melee";
                            }
                        }
                        if(cdata.data["Spell Damage"]) {
                            update[repsec + newrowid + "_spelldmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                            update[repsec + newrowid + "_spelldmg"] = cdata.data["Spell Damage"];
                        }
                        if(cdata.data["Spell Damage Type"]) {
                            update[repsec + newrowid + "_spelldmgtype"] = cdata.data["Spell Damage Type"];
                        }
                        if(cdata.data["Secondary Spell Damage"]) {
                            update[repsec + newrowid + "_spelldmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                            update[repsec + newrowid + "_spelldmg2"] = cdata.data["Secondary Spell Damage"];
                        }
                        if(cdata.data["Secondary Spell Damage Type"]) {
                            update[repsec + newrowid + "_spelldmg2type"] = cdata.data["Secondary Spell Damage Type"];
                        }
                        if(cdata["content"]) {
                            update[repsec + newrowid + "_spelldesc"] = cdata["content"];
                            update[repsec + newrowid + "_spelldescflag"] = "{{descflag=[[1]]}}";
                        }
                    }
                }
                var tmpvalues = {};
                _.extend(tmpvalues,values,update);
                if(! isPc) {
                    tmpvalues["npc"] = "1";
                }
                _.extend(update,calc_spell(level,newrowid,tmpvalues));
            }
        });
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_spells update: " + JSON.stringify(update,null,"  "));}
        return update;
    };
    const drop_add_spellike = function(objs,cdatarr,values, isPc = false) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_spellike: " + JSON.stringify(objs,null,"  "));}
        var update = {};
        var repsec = "repeating_spell-like_";
        _.each(objs, (obj) => {
            if(obj["Name"]) {
                if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_spellike obj :" + JSON.stringify(obj,null,"  "))};
                var newrowid = generateRowID();
                update[repsec + newrowid + "_spellname"] = obj["Name"];
                update[repsec + newrowid + "_options-flag"] = 0;
                if(isPc) {
                    if(obj["Per-day"]) {
                        update[repsec + newrowid + "_timesperday"] = "per-day";
                        let perday = 0;
                        if(obj["Per-day"].indexOf("+") == -1) {
                            perday = parseInt(obj["Per-day"]) || 1;
                        } else {
                            perday = (parseInt(obj["Per-day"].split("+")[0].replace(/[^\d]/gi, "").trim()) || 1)
                                    + (parseInt(values[obj["Per-day"].split("+")[1].replace("modifier", "").trim().toLowerCase() + "_mod"]) || 0);
                        }
                        if(perday > 0) {
                            update[repsec + newrowid + "_perday_max"] = perday;
                        }
                    } else {
                        update[repsec + newrowid + "_timesperday"] = "at-will";
                    }
                } else {
                    if(obj["Frequency"]) {
                        if(obj["Frequency"].toLowerCase().trim() == "constant") {
                            update[repsec + newrowid + "_timesperday"] = "constant";
                        } else if(obj["Frequency"].toLowerCase().trim() == "at will") {
                            update[repsec + newrowid + "_timesperday"] = "at-will";
                        } else if(obj["Frequency"].toLowerCase().trim() == "per hour") {
                            update[repsec + newrowid + "_timesperday"] = "per-hour";
                        } else if(obj["Frequency"].toLowerCase().trim() == "per day") {
                            update[repsec + newrowid + "_timesperday"] = "per-day";
                        } else if(obj["Frequency"].toLowerCase().trim() == "per week") {
                            update[repsec + newrowid + "_timesperday"] = "per-week";
                        } else if(obj["Frequency"].toLowerCase().trim() == "per month") {
                            update[repsec + newrowid + "_timesperday"] = "per-month";
                        } else if(obj["Frequency"].toLowerCase().trim() == "per year") {
                            update[repsec + newrowid + "_timesperday"] = "per-year";
                        } else if(obj["Frequency"].toLowerCase().trim() == "every x hours") {
                            update[repsec + newrowid + "_timesperday"] = "every-hours";
                        } else { // default
                            update[repsec + newrowid + "_timesperday"] = "at-will";
                        }
                        if(obj["Occurences"] || obj["Occurrences"]) { // in case of typo
                            update[repsec + newrowid + "_perday_max"] = parseInt(obj["Occurrences"]) || parseInt(obj["Occurences"]) || 0;
                        }
                    }
                }
                // getting data from Spell source of the ability, if any
                if(obj["Spell"] || obj["Spell-source"]) {
                    // update[repsec + newrowid + "_fromcompendium"] = "Spells:" + obj["Spell"];
                    if(! _.isEmpty(cdatarr)) {
                        let zespell = "";
                        if(isPc) {
                            zespell = obj["Spell-source"];
                        } else {
                            zespell = obj["Spell"];
                        }
                        var cdata = cdatarr.find(o => (o.name.toLowerCase().trim() === zespell.toLowerCase().trim() &&  o.data["Category"] === "Spells"));
                        if(cdata && cdata.id  && cdata.data) {
                            update[repsec + newrowid + "_fromcompendium"] = "Spells:" + cdata["name"];
                            if(obj["School"]) {
                                update[repsec + newrowid + "_spellschool"] = obj["School"];
                            } else if (cdata.data["School"]) {
                                update[repsec + newrowid + "_spellschool"] = cdata.data["School"];
                            }
                            if(obj["Level"]) {
                                update[repsec + newrowid + "_spellclasslevel"] = obj["Level"];
                            } else if(cdata.data["Level"]) {
                                update[repsec + newrowid + "_spellclasslevel"] = cdata.data["Level"];
                            }
                            if(obj["Casting Time"]) {
                                update[repsec + newrowid + "_spellcastingtime"] = obj["Casting Time"];
                            } else if(cdata.data["Casting Time"]) {
                                update[repsec + newrowid + "_spellcastingtime"] = cdata.data["Casting Time"];
                            }
                            if(obj["Range"]) {
                                update[repsec + newrowid + "_spellrange"] = obj["Range"];
                            } else if(cdata.data["Range"]) {
                                update[repsec + newrowid + "_spellrange"] = cdata.data["Range"];
                            }
                            if(obj["Area"]) {
                                update[repsec + newrowid + "_spellarea"] = obj["Area"];
                            } else if(cdata.data["Area"]) {
                                update[repsec + newrowid + "_spellarea"] = cdata.data["Area"];
                            }
                            if(obj["Target"]) {
                                update[repsec + newrowid + "_spelltargets"] = obj["Target"];
                            } else if(cdata.data["Target"]) {
                                update[repsec + newrowid + "_spelltargets"] = cdata.data["Target"];
                            }
                            if(obj["Effect"]) {
                                update[repsec + newrowid + "_spelleffect"] = obj["Effect"];
                            } else if(cdata.data["Effect"]) {
                                update[repsec + newrowid + "_spelleffect"] = cdata.data["Effect"];
                            }
                            if(obj["Duration"]) {
                                update[repsec + newrowid + "_spellduration"] = obj["Duration"];
                            } else if(cdata.data["Duration"]) {
                                update[repsec + newrowid + "_spellduration"] = cdata.data["Duration"];
                            }
                            if(obj["Saving Throw"]) {
                                update[repsec + newrowid + "_spellsave"] = obj["Saving Throw"];
                            } else if(cdata.data["Saving Throw"]) {
                                update[repsec + newrowid + "_spellsave"] = cdata.data["Saving Throw"];
                            } else {
                                update[repsec + newrowid + "_spellsave"] = " ";
                            }
                            if(update[repsec + newrowid + "_spellsave"]) {
                                update[repsec + newrowid + "_spellsaveflag"] = (update[repsec + newrowid + "_spellsave"].toLowerCase().trim() == "none") ? "0" : "{{save=1}}";
                            }
                            if(obj["DC"]) {
                                if(! update[repsec + newrowid + "_spellsaveflag"]) {
                                    update[repsec + newrowid + "_spellsaveflag"] = "{{save=1}}";
                                }
                                update[repsec + newrowid + "_spelldc_mod"] = parseInt(obj["DC"].replace(/[^\d]/gi, '')) || 0;
                            }
                            if(obj["Spell Resistance"]) {
                                update[repsec + newrowid + "_spellresistance"] = obj["Spell Resistance"];
                            } else if(cdata.data["Spell Resistance"]) {
                                update[repsec + newrowid + "_spellresistance"] = cdata.data["Spell Resistance"];
                            }
                            if(update[repsec + newrowid + "_spellresistance"]) {
                                update[repsec + newrowid + "_spellresistanceflag"] = (update[repsec + newrowid + "_spellresistance"].toLowerCase().trim() == "no") ? "0" : "{{sr=1}}";
                            }
                            if(obj["Spell Attack"]) {
                                update[repsec + newrowid + "_spellatkmod"] = obj["Spell Attack"];
                                update[repsec + newrowid + "_spellatkflag"] = "{{attack=1}}";
                            } else if(cdata.data["Spell Attack"]) {
                                update[repsec + newrowid + "_spellatkflag"] = "{{attack=1}}";
                            }
                            if(obj["Spell Damage"]) {
                                update[repsec + newrowid + "_spelldmg"] = obj["Spell Damage"];
                            } else if(cdata.data["Spell Damage"]) {
                                update[repsec + newrowid + "_spelldmg"] = cdata.data["Spell Damage"];
                            }
                            if(update[repsec + newrowid + "_spelldmg"]) {
                                update[repsec + newrowid + "_spelldmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                            }
                            if(obj["Spell Damage Type"]) {
                                update[repsec + newrowid + "_spelldmgtype"] = obj["Spell Damage Type"];
                            } else if(cdata.data["Spell Damage Type"]) {
                                update[repsec + newrowid + "_spelldmgtype"] = cdata.data["Spell Damage Type"];
                            }
                            if(obj["Secondary Spell Damage"]) {
                                update[repsec + newrowid + "_spelldmg2"] = obj["Secondary Spell Damage"];
                            } else if(cdata.data["Secondary Spell Damage"]) {
                                update[repsec + newrowid + "_spelldmg2"] = cdata.data["Secondary Spell Damage"];
                            }
                            if(update[repsec + newrowid + "_spelldmg2"]) {
                                update[repsec + newrowid + "_spelldmg2flag"] = "{{damage=1}} {{dmg2flag=1}}";
                            }
                            if(obj["Secondary Spell Damage Type"]) {
                                update[repsec + newrowid + "_spelldmg2type"] = obj["Secondary Spell Damage Type"];
                            } else if(cdata.data["Secondary Spell Damage Type"]) {
                                update[repsec + newrowid + "_spelldmg2type"] = cdata.data["Secondary Spell Damage Type"];
                            }
                            if(obj["content"]) {
                                update[repsec + newrowid + "_spelldesc"] = obj["content"];
                            } else if(cdata["content"]) {
                                update[repsec + newrowid + "_spelldesc"] = cdata["content"];
                            }
                            if(update[repsec + newrowid + "_spelldesc"]) {
                                update[repsec + newrowid + "_spelldescflag"] = "{{descflag=[[1]]}}";
                            }
                        }
                    }
                }
                // Completing or replacing data for PC (race/class/subclass feature)
                if(isPc) {
                    if(obj["Type"]) {
                        update[repsec + newrowid + "_spelltype"] = obj["Type"];
                    }
                    if(obj["Casting-time"]) {
                        update[repsec + newrowid + "_spellcastingtime"] = obj["Casting-time"];
                    }
                    if(obj["Range"]) {
                        update[repsec + newrowid + "_spellrange"] = obj["Range"];
                    }
                    if(obj["Area"]) {
                        update[repsec + newrowid + "_spellarea"] = obj["Area"];
                    }
                    if(obj["Target"]) {
                        update[repsec + newrowid + "_spelltargets"] = obj["Target"];
                    }
                    if(obj["Effect"]) {
                        update[repsec + newrowid + "_spelleffect"] = obj["Effect"];
                    }
                    if(obj["Duration"]) {
                        update[repsec + newrowid + "_spellduration"] = obj["Duration"];
                    }
                    if(obj["Save-DC"]) {
                        let zedc = 0;
                        if(obj["Save-DC"].indexOf("+") == -1) {
                            zedc = parseInt(obj["Save-DC"].replace(/[^\d]/gi, '')) || 0;
                        } else {
                            _.each(obj["Save-DC"].split("+"),(elm) => {
                                if(elm.toLowerCase().indexOf("modifier") != -1) {
                                    zedc += (parseInt(values[elm.replace("modifier", "").trim().toLowerCase() + "_mod"]) || 0);
                                } else if(elm.toLowerCase().indexOf("level") != -1) {
                                    if(elm.toLowerCase().indexOf("1/2") == -1) {
                                        zedc += parseInt(values["level"]) || 0;
                                    }
                                } else {
                                    zedc += (parseInt(elm.replace(/[^\d]/gi, "").trim()) || 0)
                                }
                            });
                        }
                        if(zedc > 0) {
                            update[repsec + newrowid + "_spellsaveflag"] = "{{save=1}}";
                            update[repsec + newrowid + "_spelldc"] = zedc;
                        }
                    }
                    if(obj["Attack"]) {
                        update[repsec + newrowid + "_spellatkflag"] = "{{attack=1}}";
                        if(obj["Attack"].toLowerCase().indexOf("melee") != -1) {
                            update[repsec + newrowid + "_spellatkmod"] = "@{melee_mod}[" + obj["Attack"] + "]";
                        } else if(obj["Attack"].toLowerCase().indexOf("ranged") != -1) {
                            update[repsec + newrowid + "_spellatkmod"] = "@{ranged_mod}[" + obj["Attack"] + "]";
                        } else {
                            update[repsec + newrowid + "_spellatkmod"] = obj["Attack"];
                        }
                    }
                    if(obj["Damage"]) {
                        update[repsec + newrowid + "_spelldmgflag"] = "{{damage=1}} {{dmg1flag=1}}";
                        if(obj["Damage"].indexOf("+") == -1) {
                            update[repsec + newrowid + "_spelldmg"] = obj["Damage"];
                        } else {
                            update[repsec + newrowid + "_spelldmg"] = obj["Damage"].split("+")[0];
                            if(obj["Damage"].split("+")[1].toLowerCase().indexOf("for every two") != -1) {
                                // 1d6 + 1 point for every two cleric levels
                                update[repsec + newrowid + "_spelldmg"] += "+[[floor(@{caster1_level}/2)]]";
                            } else {
                                update[repsec + newrowid + "_spelldmg"] += obj["Damage"].split("+")[1].replace(/[^\d\-\+\s]/gi, "").trim();
                            }
                        }
                    }
                    if(obj["Damage-type"]) {
                        update[repsec + newrowid + "_spelldmgtype"] = obj["Damage-type"];
                    }
                    if(obj["Description"]) {
                        update[repsec + newrowid + "_spelldescflag"] = "{{descflag=[[1]]}}";
                        update[repsec + newrowid + "_spelldesc"] = obj["Description"];
                    }
                }
                // Final calculation
                var tmpvalues = {};
                _.extend(tmpvalues,values,update);
                if(! isPc) {
                    tmpvalues["npc"] = "1";
                }
                _.extend(update,calc_spell("like",newrowid,tmpvalues));
            }
        });
        if (pfoglobals_debug_mode) {console.log("*** DEBUG drop_add_spellike update :" + JSON.stringify(update,null,"  "));}
        return update;
    };

    // === ABILITIES and MODS
    const calc_ability = function(attr,v) {
        var update = {};
        var total = (parseInt(v[attr + "_base"]) || 0) + (parseInt(v[attr + "_race"]) || 0) + (parseInt(v[attr + "_bonus"]) || 0);
        if (["strength","dexterity"].includes(attr)) {
            total += parseInt(v[attr + "_condition"]) || 0;
        }
        update[attr] = Math.max(total,0);
        return update;
    };
    const update_mod = function(attr) {
        var fields = [attr]
        if (attr == "dexterity") {
            fields.push("dexterity_condition_nobonus");
        }
        getAttrs(fields, (v) => {
            setAttrs(calc_ability_mod(attr, v),{silent: true});
        });
    };
    const calc_ability_mod = function(attr, v) {
        var update = {};
        var mod = Math.floor(((parseInt(v[attr]) || 0) - 10) / 2);
        if (attr == "strength") {
            update["strength_half_mod"] = Math.floor(mod*0.5);
            update["strength_oneandahalf_mod"] = Math.floor(mod*1.5);
        } else if  (attr == "dexterity") {
            if(v.dexterity_condition_nobonus) {
                if ( (v.dexterity_condition_nobonus == "1") && (mod > 0) ) {
                    mod = 0;
                }
            }
            update["dexterity_half_mod"] = Math.floor(mod*0.5);
            update["dexterity_oneandahalf_mod"] = Math.floor(mod*1.5);
        }
        update[attr + "_mod"] = mod;
        return update;
    };

    // === SIZE
    const update_size = function(psize) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_size call: psize = " + psize);}
        getAttrs(["npc"], (v) => {
            if(v.npc == "1") {
                var update = {};
                update["size_display"] = getTranslationByKey(psize);
                setAttrs(update, {silent: true});
            } else {
                setAttrs(calc_pc_size(psize),{silent: true}, () => {
                    update_babs_all();
                });
            }
        });
    };
    const calc_pc_size = function(psize) {
        var size = psize || "medium", atkac = 0, cmb = 0, fly = 0, stealth = 0, load = 1;
        var obj_size = pfoglobals_size.find((size_item) => size_item.size === psize);
        if(! _.isEmpty(obj_size)) {
            atkac = parseInt(obj_size.atkac) || 0;
            cmb = parseInt(obj_size.cmb) || 0;
            fly = parseInt(obj_size.fly) || 0;
            stealth = parseInt(obj_size.stealth) || 0;
            load = parseFloat(obj_size.load) || 1.0;
        }
        update = {"ac_size": atkac, "bab_size": atkac, "cmb_size": cmb, "fly_size": fly, "stealth_size": stealth, "encumbrance_size": load};
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_pc_size: psize = " + psize + " update = " + JSON.stringify(update,null,"  "));}
        return update;
    };

    // === INITIATIVE
    const update_initiative = function () {
        getAttrs(pfoglobals_initiative_fields, (v) => {
            if(v.npc !== "1") {
                setAttrs(calc_initiative(v));
            }
        });
    };
    const calc_initiative = function(v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_initiative");}
        var update = {};
        update["initiative"] = (parseInt(v.dexterity_mod) || 0) + (parseInt(v.initiative_misc) || 0) + (parseInt(v.initiative_bonus) || 0);
        return update;
    }

    // === Class / Mutliclassing / Multicasting
    const update_class_names = function(attr) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_class_names call");}
        var fields = ["npc","class1_name","class2_name","class3_name","caster1_flag","caster2_flag","class1_level","class2_level","class3_level"];
        var update = {};
        getAttrs(fields, (v) => {
            if(v.npc !== "1") {
                var cls = "", cc1 = " ", cc2 = " ";
                if (typeof v.class1_name !== "undefined") {
                    if (v.class1_name.length > 0) {
                        cls += v.class1_name;
                        if (v.caster1_flag != "0") {cc1 = v.class1_name;}
                    }
                }
                if (typeof v.class2_name !== "undefined") {
                    if (v.class2_name.length > 0) {
                        cls += (cls.length > 0) ? (" " + (parseInt(v.class1_level) || 1) + ", ") : "";
                        cls += v.class2_name + " " + (parseInt(v.class2_level) || 0);
                        if (v.caster2_flag != "0") {cc2 = v.class2_name;}
                    }
                }
                if (typeof v.class3_name !== "undefined") {
                    if (v.class3_name.length > 0) {cls += ((cls.length > 0) ? ", " : "") + v.class3_name + " " + (parseInt(v.class3_level) || 0);}
                }
                update["class"] = cls;
                update["caster1_class"] = cc1;
                update["caster2_class"] = cc2;
                update["caster_flag"] = (parseInt(v.caster1_flag) || 0) + (parseInt(v.caster2_flag) || 0);
                setAttrs(update, {silent: true}, () => {
                    if( (parseInt(update["caster_flag"]) || 0) > 0) {
                        if(typeof attr !== "undefined" ) {
                            if(attr == "caster1_flag") {
                                update_spells_dc("caster1_ability"); // => update_all_spells
                            } else if(attr == "caster2_flag") {
                                update_spells_dc("caster2_ability"); // => update_all_spells
                            } else if( ((parseInt(update["caster_flag"]) || 0) == 2)  && (["class1_name","class2_name"].includes(attr)) ) {
                                update_all_spells("all");
                            }
                        }
                    }
                });
            }
        });
    };
    const update_class_numbers = function(attr) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_class_numbers attr: " + attr);}
        var fields = ["npc","class1_" + attr,"class2_" + attr,"class3_" + attr ], update = {};
        getAttrs(fields, (v) => {
            if(v.npc != "1") {
                var finalattr = "", total = 0;
                for(var i = 1; i < 4; i++) {
                    total += (parseInt(v["class" + i + "_" + attr]) || 0);
                }
                if (["level","bab"].includes(attr)) {
                    finalattr = attr;
                } else if(["speed"].includes(attr)) {
                    finalattr = attr + "_class";
                } else {
                    finalattr = attr + "_base";
                }
                if(attr == "bab") {
                    update["bab_max"] = total;
                }
                update[finalattr] = total;
                setAttrs(update,{silent: false},() => {
                    if(attr == "level") {
                        update_class_names(attr);
                        getAttrs(pfoglobals_babs_fields, (values) => {
                            setAttrs(calc_fob(values),{silent: true},() => {
                                update_attacks("all");
                            });
                        });
                    }
                });
            }
        });
    };
    const update_hitdie = function(){
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_hitdie");}
        var fields = ["class_favored","class1_hitdietype","class2_hitdietype","class3_hitdietype"], update = {};
        getAttrs(fields, (v) => {
            var fav = parseInt(v["class_favored"]) || 1;
            update["hitdietype"] = v["class" + fav + "_hitdietype"];
            setAttrs(update,{silent: true});
        });
    };

    // === AC / DEFENSE
    const update_ac_items = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_ac_items");}
        var update = {}, attrs = ["speed_race","speed_class", "caster1_flag","caster2_flag","speed_armor","armor_run_factor","armor_check_penalty","armor_spell_failure"];
        getSectionIDs("repeating_acitems", (idarray) => {
            _.each(idarray, (itemid) => {
                attrs.push("repeating_acitems_" + itemid + "_equipped");
                attrs.push("repeating_acitems_" + itemid + "_ac_bonus");
                attrs.push("repeating_acitems_" + itemid + "_flatfooted_bonus");
                attrs.push("repeating_acitems_" + itemid + "_touch_bonus");
                attrs.push("repeating_acitems_" + itemid + "_natural_bonus");
                attrs.push("repeating_acitems_" + itemid + "_deflection_bonus");
                attrs.push("repeating_acitems_" + itemid + "_dodge_bonus");
                attrs.push("repeating_acitems_" + itemid + "_type");
                attrs.push("repeating_acitems_" + itemid + "_check_penalty");
                attrs.push("repeating_acitems_" + itemid + "_max_dex_bonus");
                attrs.push("repeating_acitems_" + itemid + "_spell_failure");
                attrs.push("repeating_acitems_" + itemid + "_spell_failure");
                attrs.push("repeating_acitems_" + itemid + "_speed20");
                attrs.push("repeating_acitems_" + itemid + "_speed30");
                attrs.push("repeating_acitems_" + itemid + "_run_factor");
            });
            getAttrs(attrs, (v) => {
                var update = {}, bonusarmor = 0, bonusshield = 0, bonusff = 0, bonustouch = 0, bonusnatural = 0, bonusdeflection = 0, bonusdodge = 0, checkpen = 0, maxdex = 99, spellf = 0, maxab = "-", run = 4;
                var speedbase = (parseInt(v.speed_race) || 30) + (parseInt(v.speed_class) || 0);
                var speedreduced = calc_reduced_speed(speedbase); // heavy and medium armor
                var speed = speedbase;
                _.each(idarray, (itemid) => {
                    if ( v["repeating_acitems_" + itemid + "_equipped"] == "1" ) {
                        if (v["repeating_acitems_" + itemid + "_type"] == "shield") {bonusshield += parseInt(v["repeating_acitems_" + itemid + "_ac_bonus"]) || 0;}
                        else {bonusarmor += parseInt(v["repeating_acitems_" + itemid + "_ac_bonus"]) || 0;}
                        bonusff += parseInt(v["repeating_acitems_" + itemid + "_flatfooted_bonus"]) || 0;
                        bonustouch += parseInt(v["repeating_acitems_" + itemid + "_touch_bonus"]) || 0;
                        bonusnatural = Math.max(bonusnatural, parseInt(v["repeating_acitems_" + itemid + "_natural_bonus"]) || 0);
                        bonusdeflection = Math.max(bonusdeflection, parseInt(v["repeating_acitems_" + itemid + "_deflection_bonus"]) || 0);
                        bonusdodge += parseInt(v["repeating_acitems_" + itemid + "_dodge_bonus"]) || 0;
                        checkpen += parseInt(v["repeating_acitems_" + itemid + "_check_penalty"]) || 0;
                        if ((parseInt(v["repeating_acitems_" + itemid + "_max_dex_bonus"]) || 99) != 0) {maxdex = Math.min(maxdex, parseInt(v["repeating_acitems_" + itemid + "_max_dex_bonus"]) || 99);}
                        spellf += parseInt(v["repeating_acitems_" + itemid + "_spell_failure"]) || 0;
                        if(["heavy","medium"].includes(v["repeating_acitems_" + itemid + "_type"])) {speed = Math.min(speed,speedbase,speedreduced);}
                        run = Math.min(run, parseInt(v["repeating_acitems_" + itemid + "_run_factor"]) || 4);
                    }
                });
                if (maxdex < 99) {maxab = maxdex;}
                update = { "ac_armor": bonusarmor, "ac_shield": bonusshield, "ac_flatfooted_bonus": bonusff, "ac_touch_bonus": bonustouch, "ac_natural_bonus": bonusnatural, "ac_deflection_bonus": bonusdeflection, "ac_dodge_bonus": bonusdodge, "ac_ability_maximum": maxab, "armor_check_penalty": checkpen, "armor_spell_failure": spellf, "speed_armor": speed, "armor_run_factor":run};
                setAttrs(update, {silent: true}, () => {
                    update_ac_ability("ac_ability_maximum"); // => ac => cmd
                    if(((parseInt(v.speed_armor) || 0) !== speed) || ((parseInt(v.armor_run_factor) || 0) !== run)) {
                        update_speed();
                    }
                    if((parseInt(v.armor_check_penalty) || 0) !== checkpen) {
                        update_all_skills();
                    }
                    if(((v.caster1_flag == "1") || (v.caster2_flag == "1")) && ((parseInt(v.armor_spell_failure) || 0) !== spellf)) {
                        update_all_spells("all");
                    }
                });
            });
        });
    };
    const update_ac_ability = function(attr) {
        getAttrs(pfoglobals_ac_ability_fields, (v) => {
            if(v.npc !== "1") {
                setAttrs(calc_ac_ability(attr,v), {silent: true}, () => {
                    update_ac();
                });
            }
        });
    };
    const calc_ac_ability = function(attr,v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_ac_ability call for " + attr);}
        var update = {};
        var secabmonk = parseInt(v.ac_secab_monk) || 0;
        var primary = parseInt(v[v.ac_ability_primary + "_mod"]) || 0;
        var secondary = parseInt(v[v.ac_ability_secondary + "_mod"]) || 0;
        var maxmod = Math.min(parseInt(v.ac_ability_maximum) || 99, parseInt(v.encumbrance_ability_maximum) || 99);
        var ffmod = 0; //Flat-footed special mod (for Monks and such)
        if (secabmonk == 1) {  //If Monk rule for secondary ability applies
            if ((secondary < 0) || (maxmod != 99)) {
                secondary = 0;  // only Bonus applies (not penalty) and if not encumbered by armor or load
            } else {
                ffmod = secondary;
            }
        }
        var finalmod = Math.min(primary + secondary,maxmod);
        if ((parseInt(v.ac_condition_nobonus) || 0) == 1)  { // AC Bonus denied by Condition(s)
            if ( (secabmonk == 1)  && (maxmod == 99) ) { // Except that PC is a monk AND PC is unarmored/unencombered, so it may retain its secondary ability mod (which is, at worse, zero)
                finalmod = secondary;
                ffmod = secondary;
            } else {
                if (finalmod > 0) {
                    finalmod = 0;
                }
            }
        }
        update["ac_ability_mod"] = finalmod;
        update["ac_ff_ability_mod"] = ffmod;
        return update;
    };
    const update_ac = function() {
        getAttrs(pfoglobals_ac_fields, (v) => {
            if(v.npc != "1") {
                setAttrs(calc_ac(v),{silent: true}, () => {
                    update_cmd();
                });
            }
        });
    };
    const calc_ac = function(v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_ac");}
        var update = {};
        var base = 10, ac = 0, actouch = 0, acff = 0;
        var bonus = parseInt(v.ac_bonus) || 0;
        var ability = parseInt(v.ac_ability_mod) || 0;
        var armor = parseInt(v.ac_armor) || 0;
        var shield = parseInt(v.ac_shield) || 0;
        var size = parseInt(v.ac_size) || 0;
        var natural = (parseInt(v.ac_natural) || 0) + (parseInt(v.ac_natural_bonus) || 0);
        var deflection = (parseInt(v.ac_deflection) || 0) + (parseInt(v.ac_deflection_bonus) || 0);
        var misc = parseInt(v.ac_misc) || 0;
        var dodge = (parseInt(v.ac_dodge) || 0) + (parseInt(v.ac_dodge_bonus) || 0);
        var touch_bonus = parseInt(v.ac_touch_bonus) || 0;
        var flatfooted_bonus = parseInt(v.ac_flatfooted_bonus) || 0;
        var noflatflooted = parseInt(v.ac_noflatflooted) || 0;
        var touchshield = parseInt(v.ac_touchshield) || 0;
        var secabmonk = parseInt(v.ac_secab_monk) || 0;
        var condition = parseInt(v.ac_condition) || 0;
        var flag = bonus !=0 ? 1 : 0;
        ac = base + bonus + ability + armor + shield + size + natural + deflection + misc + dodge + condition;
        if (noflatflooted == 1) {
            acff = ac;
        } else {
            acff = base + bonus + ( (ability < 0) ? ability : 0 ) + armor + shield + size + natural + deflection + misc + condition;
            if (secabmonk == 1) { // Monk rules to secondary ability AC modifier
                let ffmod = (parseInt(v.ac_ff_ability_mod) || 0);
                acff += (ffmod > 0) ? ffmod : 0; // If positive (bonus), applies to Flat-Footed
            }
        }
        acff += flatfooted_bonus;
        actouch = base + bonus + ability + size + deflection + misc + dodge + condition;
        if (touchshield == 1) {
            actouch += shield;
        }
        actouch += touch_bonus;
        update["ac"] = ac;
        update["ac_touch"] = actouch;
        update["ac_flatfooted"] = acff;
        return update;
    };
    const update_cmd = function() {
        getAttrs(pfoglobals_babs_fields, (v) => {
            if(v.npc !== "1") {
                setAttrs(calc_cmd(v), {silent: true});
            }
        });
    };
    const calc_cmd = function(v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_cmd");}
        var update = {};
        var acmod = parseInt(v.ac_ability_mod) || 0;
        if ( (acmod > 0) && (v.ac_condition_nobonus == "1") ) {
            acmod = 0;
        }
        update["cmd_mod"] = 10 + (parseInt(v.bab) || 0) + (parseInt(v.strength_mod) || 0) + acmod + (parseInt(v.cmb_size) || 0) + (parseInt(v.ac_dodge_bonus) || 0) + (parseInt(v.ac_dodge) || 0) + (parseInt(v.ac_deflection_bonus) || 0) + (parseInt(v.ac_deflection) || 0) + (parseInt(v.cmd_condition) || 0) + (parseInt(v.cmd_misc) || 0) + (parseInt(v.cmd_bonus) || 0);
        return update;
    };

    // === SAVES
    const update_save = function(attr) {
        getAttrs(pfoglobals_save_fields, (v) => {
            if(v.npc !== "1") {
                setAttrs(calc_save(attr,v));
            }
        });
    };
    const calc_save = function(attr,v) {
            // DEBUG
            if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_save attr: " + attr);}
            var update = {};
            if(v[attr + "_ability_mod"] != v[v[attr + "_ability"] + "_mod"]) {
                v[attr + "_ability_mod"] = v[v[attr + "_ability"] + "_mod"];
                update[attr + "_ability_mod"] = v[attr + "_ability_mod"];
            }
            update[attr] = pfoglobals_save_attr.map((fld) => parseInt(v[attr + "_" + fld]) || 0).reduce((total, val) => total + val);
            return update;
    };

    // === BABS
    const update_babs_all = function() {
        getAttrs(pfoglobals_babs_fields, (v) => {
            if(v.npc !== "1") {
                setAttrs(calc_babs_all(v), {silent: true}, () => {
                    update_attacks("all");
                });
            }
        });
    };
    const update_babs = function(attr) {
        getAttrs(pfoglobals_babs_fields, (v) => {
            if(v.npc != "1") {
                setAttrs(calc_babs(attr,v),{silent: true},() => {
                    update_attacks(attr);
                });
            }
        });
    };
    const calc_babs_all = function(v) {
        // babs for multi attack array
        var bab = parseInt(v.bab) || 0, update = {}, babarray = [], obj_multi = {}, obj_cmb = {}, obj_melee = {}, obj_ranged = {}, obj_cmd = {}, obj_fob = {};
        var multi = bab;
        do {
            babarray.push(multi);
            multi = multi - 5;
        } while (multi > 0);
        obj_multi["bab_multi"] = babarray;
        v["bab_multi"] = babarray;
        obj_cmb = calc_babs("cmb",v);
        obj_melee = calc_babs("melee",v);
        obj_ranged = calc_babs("ranged",v);
        obj_cmd = calc_cmd(v);
        obj_fob = calc_fob(v);
        _.extend(update,obj_multi,obj_cmb,obj_melee,obj_ranged,obj_cmd,obj_fob);
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_babs_all " + JSON.stringify(update));}
        return update;
    };
    const calc_babs = function(attr,v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_babs attr: " + attr);}
        var update = {}, atkarray = [], sizemod = 0;
        if (typeof v.bab_multi !== "undefined") {
            var babarray = JSON.parse("[" + v.bab_multi + "]");
        } else {
            var babarray = [];
        }
        if (attr === "cmb") {
            sizemod = parseInt(v.cmb_size) || 0;
        }
        else {
            sizemod = parseInt(v.bab_size) || 0;
        }
        if(v[attr + "_ability_mod"] != v[v[attr + "_ability"] + "_mod"]) {
            v[attr + "_ability_mod"] = v[v[attr + "_ability"] + "_mod"];
            update[attr + "_ability_mod"] = v[attr + "_ability_mod"];
        }
        update[attr + "_mod"] = (parseInt(v.bab) || 0) + sizemod + (parseInt(v[attr + "_ability_mod"]) || 0) + (parseInt(v[attr + "_misc"]) || 0) + (parseInt(v[attr + "_bonus"]) || 0);
        if (babarray.length) {
            var tmp = 0;
            _.each(babarray, (babval) => {
                tmp = (parseInt(babval) || 0) + sizemod + (parseInt(v[attr + "_ability_mod"]) || 0) + (parseInt(v[attr + "_misc"]) || 0) + (parseInt(v[attr + "_bonus"]) || 0);
                atkarray.push(tmp);
            });
        } else {
            atkarray.push(update[attr + "_mod"]);
        }
        update[attr + "_multi"] = atkarray;
        return update;
    };
    const calc_fob = function(v) {
        // Flurry of Blows Attack Bonus calculation
        // ["class1_name","class2_name","class3_name","class1_bab","class2_bab","class3_bab","class1_level","class2_level","class3_level"]
        let lvl = 0;
        let bab = 0;
        let fob = 0;
        let multi = 0;
        let farray = [];
        let fobarray = [];
        let monkclass = 0;
        let mod = (parseInt(v.melee_ability_mod) || 0) + (parseInt(v.melee_misc) || 0) + (parseInt(v.melee_bonus) || 0);
        for(let i = 1; i < 4; i++) {
            if(v["class" + i + "_name"].match(/monk/i) && !monkclass) {
                lvl = parseInt(v["class" + i + "_level"]) || 1;
                monkclass = i;
            } else {
                bab += parseInt(v["class" + i + "_bab"]) || 0;
            }
        }
        if(lvl > 0) {
            fob = bab + lvl;
            multi = fob;
            do {
                farray.push(multi);
                multi = multi - 5;
            } while (multi > 0);
            _.each(farray, (f) => {
                fobarray.push(f - 2, f - 2);
            });
            if(fobarray.length > 2) { // PF weirdness
                fobarray.splice(-1,1);
            }
        } else {
            fobarray.push(0);
        }
        let update = {};
        update["fob"] = fob;
        update["fob_multi"] = fobarray;
        return update;
    }

    // === WEAPONS/ATTACKS
    const update_attacks = function(update_id) {
        // temps : 100 - 300
        var debug_start = new Date();
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("DOING UPDATE_ATTACKS: " + update_id);}
        if(update_id.substring(0,1) === "-" && update_id.length === 20) {
            do_update_attack("",[{section: "attacks", ids: [update_id], attrs: pfoglobals_atk_attr}],debug_start);
        } else if (["strength","strength_oneandahalf","strength_half","dexterity","dexterity_half","dexterity_oneandahalf","constitution","intelligence","wisdom","charisma","melee","ranged","cmb","bab","bab_max","all"].includes(update_id)) {
            get_repsec_ids(JSON.parse(JSON.stringify(pfoglobals_repsec_atk)), (repsec_agr)=>{
                do_update_attack(update_id,repsec_agr,debug_start);
            });
        }
    };
    const do_update_attack = function(attributename = "", repsec_agr, debug_start) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG do_update_attack: " + " / " + attributename + " / " + JSON.stringify(repsec_agr,null,"  "));}
        var attack_attribs = get_repsec_fields(repsec_agr,pfoglobals_atk_fields);
        getAttrs(attack_attribs, (v) => {
            if(v.npc != "1") {
                var update = calc_attacks(repsec_agr, v, attributename);
                setAttrs(update, {silent: true}, () => {
                    if (pfoglobals_debug_mode) {
                        var elapsed = new Date() - debug_start;
                        console.log("*** DEBUG time to update attacks: " + elapsed);
                    }
                });
            }
        });
    };
    const calc_attacks = function(repsec_agr, v, attributename = "") {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_attacks call");}
        var update = {};
        _.each(repsec_agr, (current_section)=>{
            // DEBUG
            if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_attacks section: " + current_section.section);}
            _.each(current_section.ids, (attackid)=>{
                // DEBUG
                if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_attacks ids: " + attackid);}
                if( (attributename.length === 0) || (attributename == "all") || ((v["repeating_attacks_" + attackid + "_atktype"] && v["repeating_attacks_" + attackid + "_atktype"].includes(attributename)) || (v["repeating_attacks_" + attackid + "_atktype2"] && v["repeating_attacks_" + attackid + "_atktype2"].includes(attributename)) || (v["repeating_attacks_" + attackid + "_dmgattr"] && v["repeating_attacks_" + attackid + "_dmgattr"].includes(attributename)) || (v["repeating_attacks_" + attackid + "_dmg2attr"] && v["repeating_attacks_" + attackid + "_dmg2attr"].includes(attributename))) ) {
                    if (pfoglobals_debug_mode) {console.log("*** DEBUG UPDATING ATTACK: " + attackid);}

                    var i = 0, tmpint = 0, stemp = "", atkbonus = 0, atkbonusdisplay = "-", atkbonusdisplay1 = " ", atkbonusdisplay2 = " ", atkbonusdisplay3 = " ", atkdmg = "", atkdmgbonus = 0, atkdmg2bonus = 0, atkdmgdisplay = "-", atkdmg2display = "-", atkdisplay = " ", rollbase = "", rollatk = " ", rollatk1 = " ", rollatk2 = " ", rollatk3 = " ", rolldmg = "", rolldmgonly = "", rolltype = "", rollnotes = "", conditions = "", condatknotes = "", conddmgnotes = "", atktype = 0, atktypearray = [];
                    var atkname = v["repeating_attacks_" + attackid + "_atkname"];
                    var atkflag = v["repeating_attacks_" + attackid + "_atkflag"];

                    // Base atk bonus
                    if ((v["repeating_attacks_" + attackid + "_atktype"] == "bab") || (v["repeating_attacks_" + attackid + "_atktype"] == "bab_max"))  {
                        atktype = parseInt(v.bab) || 0;
                    } else {
                        atktype = parseInt(v[v["repeating_attacks_" + attackid + "_atktype"] + "_mod"]) || 0;
                    }
                    // Multi attack base handling
                    if (["bab","melee","ranged","cmb","fob"].includes(v["repeating_attacks_" + attackid + "_atktype"])) {
                        var multi = "";
                        if(v[v["repeating_attacks_" + attackid + "_atktype"] + "_multi"]) {
                            multi = v[v["repeating_attacks_" + attackid + "_atktype"] + "_multi"];
                        } else {
                            multi = atktype;
                        }
                        atktypearray = JSON.parse("[" + multi + "]");
                    }
                    if (v["repeating_attacks_" + attackid + "_atktype"] == "fob") {
                        atktype = parseInt(atktypearray[0]) || parseInt(v.fob) || 0;
                    }

                    var atktype2 = parseInt(v[v["repeating_attacks_" + attackid + "_atktype2"] + "_mod"]) || 0;
                    var atkmod = v["repeating_attacks_" + attackid + "_atkmod"];
                    var atkvs = v["repeating_attacks_" + attackid + "_atkvs"];
                    var atkcritrange = parseInt(v["repeating_attacks_" + attackid + "_atkcritrange"]) || 20;
                    var atkrange = v["repeating_attacks_" + attackid + "_atkrange"];
                    var dmgflag = v["repeating_attacks_" + attackid + "_dmgflag"];
                    var dmgbase = v["repeating_attacks_" + attackid + "_dmgbase"];
                    if (!dmgbase.length) {dmgbase = "0";}
                    var dmgattr = parseInt(v[v["repeating_attacks_" + attackid + "_dmgattr"] + "_mod"]) || 0;
                    var dmgmod = v["repeating_attacks_" + attackid + "_dmgmod"];
                    var dmgbonusdice = v["repeating_attacks_" + attackid + "_dmgbonusdice"];
                    var dmgcritmulti = parseInt(v["repeating_attacks_" + attackid + "_dmgcritmulti"]) || 1;
                    var dmgtype = v["repeating_attacks_" + attackid + "_dmgtype"];
                    var dmg2flag = v["repeating_attacks_" + attackid + "_dmg2flag"];
                    var dmg2base = v["repeating_attacks_" + attackid + "_dmg2base"];
                    if (!dmg2base.length) {dmg2base = "0";}
                    var dmg2attr = parseInt(v[v["repeating_attacks_" + attackid + "_dmg2attr"] + "_mod"]) || 0;
                    var dmg2mod = v["repeating_attacks_" + attackid + "_dmg2mod"];
                    var dmg2bonusdice = v["repeating_attacks_" + attackid + "_dmg2bonusdice"];
                    var dmg2critmulti = parseInt(v["repeating_attacks_" + attackid + "_dmg2critmulti"]) || 1;
                    var dmg2type = v["repeating_attacks_" + attackid + "_dmg2type"];
                    var descflag = v["repeating_attacks_" + attackid + "_descflag"];
                    var atkdesc = v["repeating_attacks_" + attackid + "_atkdesc"];
                    var atknotes = v["repeating_attacks_" + attackid + "_notes"];

                    // Handling empty values
                    if (!atkmod.length) {atkmod = "0";}
                    if (!dmgmod.length) {dmgmod = "0";}
                    if (!dmg2mod.length) {dmg2mod = "0";}

                    // == Display handling
                    atkbonus = atktype + atktype2 + (parseInt(atkmod) || 0);
                    atkdmgbonus = dmgattr + (parseInt(dmgmod) || 0);
                    atkdmg2bonus = dmg2attr + (parseInt(dmg2mod) || 0);
                    if(atkflag != "0") {
                        atkdisplay ="";
                        if (v["repeating_attacks_" + attackid + "_atktype"] != "0") {
                            if(v["repeating_attacks_" + attackid + "_atktype"] == "bab_max") {
                                atkdisplay += pfoglobals_i18n_obj["bab"];
                            } else {
                                atkdisplay += pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype"]];
                            }
                        }
                        if (v["repeating_attacks_" + attackid + "_atktype2"] != "0") {
                            if (atkdisplay.trim().length >0) {
                                atkdisplay += "+";
                            }
                            atkdisplay += pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype2"]];
                        }
                        atkdisplay = "(" + atkdisplay + " " + pfoglobals_i18n_obj["vs"] + " " + pfoglobals_i18n_obj[atkvs] + ")";
                        atkbonusdisplay = "" + (atkbonus < 0 ? "" : "+") + atkbonus;
                        if (atktypearray.length > 1) {
                            tmpint = (parseInt(atktypearray[1]) || 0) + atktype2 + (parseInt(atkmod) || 0);
                            atkbonusdisplay1 = "/" + (tmpint < 0 ? "" : "+") + tmpint;
                        }
                        if (atktypearray.length > 2) {
                            tmpint = (parseInt(atktypearray[2]) || 0) + atktype2 + (parseInt(atkmod) || 0);
                            atkbonusdisplay2 = "/" + (tmpint < 0 ? "" : "+") + tmpint;
                        }
                        if (atktypearray.length > 3) {
                            tmpint = (parseInt(atktypearray[3]) || 0) + atktype2 + (parseInt(atkmod) || 0);
                            atkbonusdisplay3 = "/" + (tmpint < 0 ? "" : "+") + tmpint;
                        }
                    }
                    if(dmgflag != "0") {
                        atkdmgdisplay = "" + dmgbase + (atkdmgbonus < 0 ? "" : "+") + atkdmgbonus;
                        if(dmgbonusdice.length) {atkdmgdisplay += "+(" + dmgbonusdice + ")";}
                    }
                    if(dmg2flag != "0") {
                        atkdmg2display = "" + dmg2base + (atkdmg2bonus < 0 ? "" : "+") + atkdmg2bonus;
                        if(dmg2bonusdice.length) {atkdmg2display += "+(" + dmg2bonusdice + ")";}
                    }
                    update["repeating_attacks_" + attackid + "_atkdisplay"] = atkdisplay;
                    update["repeating_attacks_" + attackid + "_atkbonusdisplay"] = atkbonusdisplay;
                    update["repeating_attacks_" + attackid + "_atkbonusdisplay1"] = atkbonusdisplay1;
                    update["repeating_attacks_" + attackid + "_atkbonusdisplay2"] = atkbonusdisplay2;
                    update["repeating_attacks_" + attackid + "_atkbonusdisplay3"] = atkbonusdisplay3;
                    update["repeating_attacks_" + attackid + "_atkdmgdisplay"] = atkdmgdisplay;
                    update["repeating_attacks_" + attackid + "_atkdmgdisplay2"] = atkdmg2display;

                    // == Rolls handling
                    if(descflag != "0") {  // desc
                        atkdesc = "{{descflag=[[1]]}}{{desc=" + atkdesc + "}}";
                    }
                    if(v["rollnotes_attack"] != "0") { // notes
                        rollnotes = "{{shownotes=[[1]]}}{{notes=" + atknotes + "}}";
                    }
                    if(atkrange.length != 0) { // range
                        atkrange = "{{range=" + atkrange + "}}";
                    }

                    // roll attack
                    if(atkflag != "0") {
                        stemp = atktype + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype"]] + "]+"
                                + atktype2 + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype2"]] + "]+"
                                + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
                        rollatk = "{{roll=[[1d20cs>" + atkcritrange + "+" + stemp + "{{atkvs=" + atkdisplay + "}}";
                        rollatk += "{{critconfirm=[[1d20cs20+" + stemp;
                        if (atktypearray.length > 1) {
                            stemp = atktypearray[1] + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype"]] + "]+"
                                    + atktype2 + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype2"]] + "]+"
                                    + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
                            rollatk1 = "{{roll1=[[1d20cs>" + atkcritrange + "+" + stemp;
                            rollatk1 += "{{critconfirm1=[[1d20cs20+" + stemp;
                        }
                        if (atktypearray.length > 2) {
                            stemp = atktypearray[2] + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype"]] + "]+"
                                    + atktype2 + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype2"]] + "]+"
                                    + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
                            rollatk2 = "{{roll2=[[1d20cs>" + atkcritrange + "+" + stemp;
                            rollatk2 += "{{critconfirm2=[[1d20cs20+" + stemp;
                        }
                        if (atktypearray.length > 3) {
                            stemp = atktypearray[3] + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype"]] + "]+"
                                    + atktype2 + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_atktype2"]] + "]+"
                                    + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
                            rollatk3 = "{{roll3=[[1d20cs>" + atkcritrange + "+" + stemp;
                            rollatk3 += "{{critconfirm3=[[1d20cs20+" + stemp;
                        }
                        rolltype += "attack";
                        rollbase += atkflag + atkrange + rollatk + rollatk1 + rollatk2 + rollatk3;
                        // desc
                        if(descflag != "0") {
                            rollatk += atkdesc;
                            rollbase += atkdesc;
                        }
                        // notes
                        if(v["rollnotes_attack"] != "0") {
                            rollatk += rollnotes;
                            rollbase += rollnotes;
                        }
                        // conditions
                        conditions += "{{conditionsflag=[[@{attack_condition}]]}} {{conditions=@{conditions_display}}}";
                        condatknotes += ((v["repeating_attacks_" + attackid + "_atktype"] == "cmb") ? "@{cmb_condition_note}" : "") + "@{attack_condition_note}";
                    }

                    // roll damage
                    if( (dmgflag != "0") || (dmg2flag != "0") ) {
                        rolltype += "damage";
                        if(dmgflag != "0") {
                            stemp = dmgbase + "+" + dmgattr + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_dmgattr"]] + "]+" + dmgmod + "[MOD]+@{rollmod_damage}[BONUS]";
                            if(dmgbonusdice.length) {stemp += "+" + dmgbonusdice + "[BONUS DICE]"};
                            if ( (atkflag != "0") && (atktypearray.length > 1) ) {
                                // One damage roll per attack
                                rolldmg += "{{rolldmg1=[[" + stemp + "]]}}{{rolldmg1type=" + dmgtype +"}}";
                                if (atktypearray.length > 1) {rolldmg += "{{roll1dmg1=[[" + stemp + "]]}}{{roll1dmg1type=" + dmgtype +"}}";}
                                if (atktypearray.length > 2) {rolldmg += "{{roll2dmg1=[[" + stemp + "]]}}{{roll2dmg1type=" + dmgtype +"}}";}
                                if (atktypearray.length > 3) {rolldmg += "{{roll3dmg1=[[" + stemp + "]]}}{{roll3dmg1type=" + dmgtype +"}}";}
                            } else {rolldmg += dmgflag + "{{dmg1=[[" + stemp + "]]}}{{dmg1type=" + dmgtype +"}}";} // No attack (damage only) or just one attack
                            rolldmgonly += dmgflag + "{{dmg1=[[" + stemp + "]]}}{{dmg1type=" + dmgtype +"}}";
                            if (dmgcritmulti > 1) {
                                // Critical damage
                                stemp = "";
                                for(i = 1; i <= dmgcritmulti; i++) {stemp += ((stemp.length > 0) ? "+" : "") + dmgbase;}
                                stemp = "((" + stemp + ")+(" + dmgattr + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_dmgattr"]] + "]+" + dmgmod + "[MOD]+@{rollmod_damage}[BONUS])*" + dmgcritmulti + ")";
                                if(dmgbonusdice.length) {stemp += "+" + dmgbonusdice + "[BONUS DICE]"};
                                if ( (atkflag != "0") && (atktypearray.length > 1) ) {
                                    // One crit damage roll per attack
                                    rolldmg += "{{rolldmg1crit=[[" + stemp + "]]}}";
                                    if (atktypearray.length > 1) {rolldmg += "{{roll1dmg1crit=[[" + stemp + "]]}}";}
                                    if (atktypearray.length > 2) {rolldmg += "{{roll2dmg1crit=[[" + stemp + "]]}}";}
                                    if (atktypearray.length > 3) {rolldmg += "{{roll3dmg1crit=[[" + stemp + "]]}}";}
                                } else {rolldmg += "{{dmg1crit=[[" + stemp + "]]}}";} // No attack (damage only) or just one attack
                                rolldmgonly += "{{dmg1crit=[[" + stemp + "]]}}";
                            }
                        }
                        if(dmg2flag != "0") {
                            stemp = dmg2base + "+" + dmg2attr + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_dmg2attr"]] + "]+" + dmg2mod + "[MOD]+@{rollmod_damage}[BONUS]";
                            if(dmg2bonusdice.length) {stemp += "+" + dmg2bonusdice + "[BONUS DICE]"};
                            if ( (atkflag != "0") && (atktypearray.length > 1) ) {
                                // One damage roll per attack
                                rolldmg += "{{rolldmg2=[[" + stemp + "]]}}{{rolldmg2type=" + dmg2type +"}}";
                                if (atktypearray.length > 1) {rolldmg += "{{roll1dmg2=[[" + stemp + "]]}}{{roll1dmg2type=" + dmg2type +"}}";}
                                if (atktypearray.length > 2) {rolldmg += "{{roll2dmg2=[[" + stemp + "]]}}{{roll2dmg2type=" + dmg2type +"}}";}
                                if (atktypearray.length > 3) {rolldmg += "{{roll3dmg2=[[" + stemp + "]]}}{{roll3dmg2type=" + dmg2type +"}}";}
                            } else {rolldmg += dmg2flag + "{{dmg2=[[" + stemp + "]]}}{{dmg2type=" + dmg2type +"}}";} // No attack (damage only) or just one attack
                            rolldmgonly += dmg2flag + "{{dmg2=[[" + stemp + "]]}}{{dmg2type=" + dmg2type +"}}";
                            if (dmg2critmulti > 1) {
                                // Critical damage
                                stemp = "";
                                for(i = 1; i <= dmg2critmulti; i++) {stemp += ((stemp.length > 0) ? "+" : "") + dmg2base;}
                                stemp = "((" + stemp + ")+(" + dmg2attr + "[" + pfoglobals_i18n_obj[v["repeating_attacks_" + attackid + "_dmg2attr"]] + "]+" + dmg2mod + "[MOD]+@{rollmod_damage}[BONUS])*" + dmg2critmulti + ")";
                                if(dmg2bonusdice.length) {stemp += "+" + dmg2bonusdice + "[BONUS DICE]"};
                                if ( (atkflag != "0") && (atktypearray.length > 1) ) {
                                    // One crit damage roll per attack
                                    rolldmg += "{{rolldmg2crit=[[" + stemp + "]]}}";
                                    if (atktypearray.length > 1) {rolldmg += "{{roll1dmg2crit=[[" + stemp + "]]}}";}
                                    if (atktypearray.length > 2) {rolldmg += "{{roll2dmg2crit=[[" + stemp + "]]}}";}
                                    if (atktypearray.length > 3) {rolldmg += "{{roll3dmg2crit=[[" + stemp + "]]}}";}
                                } else {rolldmg += "{{dmg2crit=[[" + stemp + "]]}}";} // No attack (damage only) or just one attack
                                rolldmgonly += "{{dmg2crit=[[" + stemp + "]]}}";
                            }
                        }
                        // desc
                        if((descflag != "0") && (atkflag == "0")) {
                            rolldmg += atkdesc;
                            rolldmgonly += atkdesc;
                        }
                        // notes
                        if((v["rollnotes_attack"] != "0") && (atkflag == "0")) {
                            rolldmg += rollnotes;
                            rolldmgonly += rollnotes;
                        }
                        rollbase += rolldmg;
                        conddmgnotes += "@{damage_condition_note}"; // conditions
                    }

                    // final rolls values
                    if (rollbase.trim().length > 0) {
                        rollbase = "@{whispertype} &{template:pc" + "}{{name=" + atkname + "}}{{type=" + rolltype + "}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + rollbase + conditions + "{{conditionsnote=" + condatknotes + conddmgnotes + "}}";
                    }
                    if (rollatk.trim().length > 0) {
                        rollatk = "@{whispertype} &{template:pc" + "}{{name=" + atkname + "}}{{type=attack}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + atkflag + atkrange + rollatk + conditions + "{{conditionsnote=" + condatknotes + "}}";
                    }
                    if (rollatk1.trim().length > 0) {
                        rollatk1 = "@{whispertype} &{template:pc" + "}{{smallname=" + atkname + "}}{{type=attack}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + atkflag + rollatk1 + conditions + "{{conditionsnote=" + condatknotes + "}}";
                    }
                    if (rollatk2.trim().length > 0) {
                        rollatk2 = "@{whispertype} &{template:pc" + "}{{smallname=" + atkname + "}}{{type=attack}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + atkflag + rollatk2 + conditions + "{{conditionsnote=" + condatknotes + "}}";
                    }
                    if (rollatk3.trim().length > 0) {
                        rollatk3 = "@{whispertype} &{template:pc" + "}{{smallname=" + atkname + "}}{{type=attack}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + atkflag + rollatk3 + conditions + "{{conditionsnote=" + condatknotes + "}}";
                    }
                    if (rolldmg.trim().length > 0) {
                        rolldmgonly = "@{whispertype} &{template:pc" + "}{{smallname=" + atkname + "}}{{type=damage}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}" + rolldmgonly + "{{conditionsnote=" + conddmgnotes + "}}";
                    }
                    update["repeating_attacks_" + attackid + "_rollbase"] = rollbase;
                    update["repeating_attacks_" + attackid + "_rollbase_atk"] = rollatk;
                    update["repeating_attacks_" + attackid + "_rollbase_atk1"] = rollatk1;
                    update["repeating_attacks_" + attackid + "_rollbase_atk2"] = rollatk2;
                    update["repeating_attacks_" + attackid + "_rollbase_atk3"] = rollatk3;
                    update["repeating_attacks_" + attackid + "_rollbase_dmg"] = rolldmgonly;
                }
            });
        });
        return update;
    };
    // --- NPC attacks
    const update_npc_attack = function(type,id) {
        // type = "melee" / "ranged"
        var base = "repeating_npcatk-" + type + "_" + id + "_";
        var fields = [base + "atkname",base + "atkflag",base + "atkmod",base + "multipleatk_flag",base + "atkmod2",base + "atkmod3",base + "atkmod4",base + "atkmod5",base + "atkmod6",base + "atkmod7",base + "atkmod8",base + "atkmod9",base + "atkcritrange",base + "dmgflag",base + "dmgbase",base + "dmgtype",base + "dmgcritmulti",base + "dmg2flag",base + "dmg2base",base + "dmg2type",base + "dmg2critmulti"];
        if(type == "ranged") {fields.push(base + "atkrange");}
        getAttrs(fields, (v) => {
            setAttrs(calc_npc_attack(type,id,v),{silent:true});
        });
    };
    const calc_npc_attack = function(type,id,v) {
        var base = "repeating_npcatk-" + type + "_" + id + "_";
        var update = {}, display = "", multi = "", sdmg1 = "", sdmg2 = "", scrit1 = "", scrit2 = "";
        display = v[base + "atkname"];
        display += " " + (((parseInt(v[base  + "atkmod"]) || 0) > 0) ? "+" : "") + v[base  + "atkmod"];
        var dmgcritmulti = parseInt(v[base + "dmgcritmulti"]) || 2;
        var dmg2critmulti = parseInt(v[base + "dmg2critmulti"]) || 1;
        // First attack
        multi = "{{roll=[[1d20cs>@{atkcritrange}+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}{{critconfirm=[[1d20cs20+@{atkmod}[MOD]+@{rollmod_attack}[BONUS]]]}}";
        // Damage
        if(v[base + "dmgflag"] && v[base + "dmgbase"]){
            if( (v[base + "dmgflag"] != "0") && (v[base + "dmgbase"].length > 0) ){
                sdmg1 = "[[" + v[base + "dmgbase"] + "+@{rollmod_damage}[BONUS]]]";
                multi += "{{rolldmg1=" + sdmg1 + "}}{{rolldmg1type=@{dmgtype}}}";
                if(dmgcritmulti > 1) {
                    scrit1 = "";
                    for(i = 1; i <= dmgcritmulti; i++) {
                        scrit1 += ((scrit1.length > 0) ? "+" : "") + v[base + "dmgbase"];
                    }
                    scrit1 = "[[(" + scrit1 + ")+(@{rollmod_damage}[BONUS]*" + dmgcritmulti + ")]]";
                    multi += "{{rolldmg1crit=" + scrit1 + "}}";
                }
            }
        }
        if(v[base + "dmg2flag"] && v[base + "dmg2base"]){
            if( (v[base + "dmg2flag"] != "0") && (v[base + "dmg2base"].length > 0) ){
                sdmg2 = "[[" + v[base + "dmg2base"] + "+@{rollmod_damage}[BONUS]]]";
                multi += "{{rolldmg2=" + sdmg2 + "}}{{rolldmg2type=@{dmg2type}}}";
                if(dmg2critmulti > 1) {
                    scrit2 = "";
                    for(i = 1; i <= dmg2critmulti; i++) {
                        scrit2 += ((scrit2.length > 0) ? "+" : "") + v[base + "dmg2base"];
                    }
                    scrit2 = "[[(" + scrit2 + ")+(@{rollmod_damage}[BONUS]*" + dmg2critmulti + ")]]";
                    multi += "{{rolldmg2crit=" + scrit2 + "}}";
                }
            }
        }
        // Multi attack
        if((v[base + "multipleatk_flag"] || "0") == "1"){
            for(var i = 2; i < 10; i++) {
                if (v[base  + "atkmod" + i]) {
                    display += "/" + (((parseInt(v[base  + "atkmod" + i]) || 0) > 0) ? "+" : "") + v[base  + "atkmod" + i];
                    multi += "{{roll" + (i-1) + "=[[1d20cs>@{atkcritrange}+@{atkmod" + i + "}[MOD]+@{rollmod_attack}[BONUS]]]}}{{critconfirm" + (i-1) + "=[[1d20cs20+@{atkmod" + i + "}[MOD]+@{rollmod_attack}[BONUS]]]}}";
                    if(sdmg1.length) {
                        multi += "{{roll" + (i-1) + "dmg1=" + sdmg1 + "}}{{roll" + (i-1) + "dmg1type=" + v[base + "dmgtype"] +"}}";
                        if(dmgcritmulti > 1) { multi += "{{roll" + (i-1) + "dmg1crit=" + scrit1 + "}}"; }
                    }
                    if(v[base + "dmg2flag"] == "1") {
                        multi += "{{roll" + (i-1) + "dmg2=" + sdmg2 + "}}{{roll" + (i-1) + "dmg2type=" + v[base + "dmg2type"] +"}}";
                        if(dmg2critmulti > 1) {
                            multi += "{{roll" + (i-1) + "dmg2crit=" + scrit2 + "}}";
                        }
                    }
                }
            }
        }
        if((type == "ranged") && (v[base + "atkrange"] || "").length) {
            display += " " + v[base + "atkrange"];
        }
        if (((v[base  + "dmgflag"] || "0") != "0") || ((v[base  + "dmg2flag"] || "0") != "0")) {
            var dmg = "";
            var dmg1 = "";
            var dmg2 = "";
            if((v[base  + "dmgflag"] || "0") != "0") {
                dmg1 += v[base + "dmgbase"];
                if((parseInt(v[base + "atkcritrange"]) || 20) < 20) {
                    dmg1 += "/" + v[base + "atkcritrange"] + "-20";
                }
                if((parseInt(v[base + "dmgcritmulti"]) || 2) != 2) {
                    dmg1 += "/x" + v[base + "dmgcritmulti"];
                }
                if(v[base + "dmgtype"] != "") {
                    dmg1 += " " + v[base + "dmgtype"];
                }
            }
            if ((v[base  + "dmg2flag"] || "0") != "0") {
                if(v[base + "dmg2base"].trim() != "0") {
                    dmg2 += v[base + "dmg2base"];
                }
                if(v[base + "dmg2type"] != "") {
                    dmg2 += " " + v[base + "dmg2type"];
                }
                if((parseInt(v[base + "dmg2critmulti"]) || 1) != 1) {
                    dmg2 += "/x" + v[base + "dmg2critmulti"];
                }
            }
            dmg = dmg1 + ((dmg2.length >0) ? ", " : "") + dmg2;
            if (dmg.length >0) { display += " (" + dmg + ")"; }
        }
        update[base + "atkdisplay"] = display;
        update[base + "multipleatk"] = multi;
        return update;
    };

    // === SKILLS
    const update_all_skills = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_all_skills call");}
        get_repsec_ids(JSON.parse(JSON.stringify(pfoglobals_repsec_skills)), (repsec_agr)=>{
            var fixskill_fields = pfoglobals_skill_fields;
            _.each(pfoglobals_skill_list,(skillname)=>{
                fixskill_fields.push(...pfoglobals_skill_attr.map((skillattr) => skillname + "_" + skillattr));
            });
            var fields  = get_repsec_fields(repsec_agr,fixskill_fields);
            getAttrs(fields, (v) => {
                // Listing all skills to update
                var skills_array = [];
                _.each(repsec_agr, (repsec) => {
                    skills_array.push(...repsec.ids.map((id) => "repeating_" + repsec.section + "_" + id));
                });
                skills_array.push(...pfoglobals_skill_list);
                // DEBUG
                if (pfoglobals_debug_mode) {console.log("*** DEBUG update_all_skills skills:" + skills_array);}
                // Recalculating and updating skill_check_penalty
                v.skill_check_penalty = Math.min((parseInt(v.armor_check_penalty) || 0),(parseInt(v.encumbrance_check_penalty) || 0));
                // Calculating global update
                var update = calc_skill(skills_array, v, true);
                update["skill_check_penalty"] = v.skill_check_penalty;
                // Updating
                setAttrs(update,{silent: true});
            });
        });
    };
    const update_skill = function(skillname,sourcefield) {
        var fields = pfoglobals_skill_fields.concat([...pfoglobals_skill_attr.map((skillattr) => skillname + "_" + skillattr)]);
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_skill: skillname = " + skillname + " / sourcefield = " + sourcefield);}
        getAttrs(fields, (v) => {
            setAttrs(calc_skill([skillname],v), {silent: true}, () => {
                if(sourcefield.slice(-5) == "ranks") {
                    update_skills_ranks();
                }
            });
        });
    };
    const calc_skill = function(skills_array, v, update_ranks = false) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_skill call" + skills_array);}
        var update = {}, total_ranks = 0;
        _.each(skills_array, (skillname)=>{
            var penlt = 0, abltmod = 0;
            var cls = parseInt(v[skillname + "_classkill"]) || 0;
            var ranks = parseInt(v[skillname + "_ranks"]) || 0;
            total_ranks += ranks;
            if (["strength","dexterity"].includes(v[skillname + "_ability"])) {
                if(v[skillname + "_armor_penalty"] != "0") {
                    penlt =  parseInt(v.skill_check_penalty) || 0;
                    // v1.12 forced update
                    update[skillname + "_armor_penalty"] = "1";
                }
            } else {
                update[skillname + "_armor_penalty"] = "0";
            }
            var clsbonus = (cls * ranks) != 0 ? 3 : 0;
            var flag = (penlt != 0 ? 1 : 0) + (((parseInt(v[skillname + "_bonus"]) || 0) != 0 ? 1 : 0) * 2);
            update[skillname + "_penalty_flag"] = flag;
            abltmod = parseInt(v[v[skillname + "_ability"] + "_mod"]) || 0;
            update[skillname + "_ability_mod"] = abltmod;
            var skill = clsbonus + ranks + penlt + abltmod + (parseInt(v[skillname + "_misc"]) || 0) + (parseInt(v[skillname + "_bonus"]) || 0);
            if (skillname.substr(0, 15) == "repeating_skill") {
                update[skillname + "_skill"] = skill;
            } else {
                update[skillname] = skill;
            }
        });
        if(update_ranks) {
            update["skills_ranks_total"] = total_ranks;
        }
        return update;
    };
    const update_skills_ranks = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_skills_ranks call");}
        get_repsec_ids(JSON.parse(JSON.stringify(pfoglobals_repsec_skills)), (repsec_agr) => {
            var fields  = get_repsec_fields(repsec_agr,[...pfoglobals_skill_list.map((skill) => skill + "_ranks")])
                .filter(fld => fld.slice(-5) == "ranks");
            getAttrs(fields, (v) => {
                var ranks = 0;
                _.each(fields, (fld)=>{
                    ranks += parseInt(v[fld]) || 0;
                });
                setAttrs({"skills_ranks_total":ranks},{silent:true});
            });
        });
    };
    const update_skillranks_total = function() {
        getAttrs(pfoglobals_skillranks_fields, (v) => {
            setAttrs(calc_skillranks_total(v), {silent: true});
        });
    };
    const calc_skillranks_total = function(v) {
        let update = {};
        for(var i = 1; i < 4; i++) {
            update["class" + i + "_skillranks_perlevel"] = (parseInt(v["class" + i + "_skillranks_base"]) || 0) + (parseInt(v["intelligence_mod"]) || 0);
            update["class" + i + "_skillranks"] = (parseInt(update["class" + i + "_skillranks_perlevel"]) || 0) * (parseInt(v["class" + i + "_level"]) || 0);
            update["skills_ranks_total_max"] = (parseInt(update["skills_ranks_total_max"]) || 0) + update["class" + i + "_skillranks"];
        }
        return update;
    };

    // === SPEED
    const update_speed = function() {
        getAttrs(pfoglobals_speed_fields, (v) => {
            setAttrs(calc_speed(v), {silent: true});
        });
    };
    const calc_speed = function (v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_speed call");}
        var update = {};
        // Speed encumbrance
        var speed_base = (parseInt(v.speed_race) || 30) + (parseInt(v.speed_class) || 0);
        update["speed_character"] = speed_base;
        var speed_encumbrance = speed_base;
        if (["medium","heavy"].includes(v.encumbrance)) {
            speed_encumbrance = calc_reduced_speed(speed_base);
        } else if (v.encumbrance == "over") {
            speed_encumbrance = 5;
        }
        update["speed_encumbrance"] = speed_encumbrance;
        v.speed_encumbrance = speed_encumbrance;
        // Speed base
        if (v.speed_notmodified != "1") {
            speed_base = Math.min(speed_base, parseInt(v.speed_encumbrance) || 30, parseInt(v.speed_armor) || 30);
        }
        update["speed_base"] = speed_base;
        v.speed_base = speed_base;
        // Run factor
        var runfac = Math.min((parseInt(v.encumbrance_run_factor) || 4),(parseInt(v.armor_run_factor) || 4));
        update["speed_run_factor"] = runfac;
        v.speed_run_factor = runfac;
        // Final speed
        var speed = 0;
        var fourth = 0;
        var run = 0;
        if (v.speed_condition_nospeed != "1") {
            speed = ((parseInt(v.speed_base) || 30) + (parseInt(v.speed_bonus) || 0)) * (parseFloat(v.speed_condition_multiplier) || 1.0);
            fourth = calc_round_speed(speed/4);
            speed = calc_round_speed(speed);
            run = speed * ((v.speed_condition_norun == "1") ? 0 : (parseInt(v.speed_run_factor) || 4));
        }
        update["speed"] = speed;
        update["speed_run"] = run;
        update["speed_swim"] = fourth;
        update["speed_climb"] = fourth;
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_speed update: " + JSON.stringify(update,null,"  "));}
        return update;
    };
    const calc_reduced_speed = function(basespeed) {
        return Math.ceil(((( (parseInt(basespeed) || 30) /5)/3)*2))*5;
    };
    const calc_round_speed = function(rawspeed) {
        var speed = Math.floor( (parseFloat(rawspeed) || 0.0) /5)*5;
        speed = (speed < 5) ? 5 : speed;
        return speed;
    };

    // === GEAR / ENCUMBRANCE
    // Gear weight
    const update_gear_weight = function(id) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_gear_weight call id: " + id);}
        var fields = ["repeating_gear_" + id + "_weight","repeating_gear_" + id + "_quantity"];
        getAttrs(fields, (v) => {
            var update = {};
            var weight = (parseFloat(v["repeating_gear_" + id + "_weight"]) || 0.0) * (parseFloat(v["repeating_gear_" + id + "_quantity"]) || 0.0);
            if ((weight - parseInt(weight)) > 0) {
                weight = weight.toFixed(1);
            }
            update["repeating_gear_" + id + "_weight_total"] = weight;
            setAttrs(update, {silent: false});
        });
    };
    const update_coins_weight = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_coins_weight call");}
        getAttrs(["money_cp","money_sp","money_gp","money_pp"], (v) => {
            var weight = ( (parseInt(v.money_cp) || 0) + (parseInt(v.money_sp) || 0) + (parseInt(v.money_gp) || 0) + (parseInt(v.money_pp) || 0) ) / 50;
            if ((weight - parseInt(weight)) > 0) {
                weight = weight.toFixed(1);
            }
            setAttrs({"encumbrance_coins_weight": weight}, {silent: false});
        });
    };
    const update_gear_weight_total = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_gear_weight_total call");}
        getSectionIDs("repeating_gear", (idarray) => {
            var attribs = ["encumbrance_coins_weight","encumbrance_coins_flag"];
            _.each(idarray, (id) => {
                attribs.push("repeating_gear_" + id + "_weight_total");
            });
            getAttrs(attribs, (v) => {
                var total = 0, update = {};
                _.each(idarray, (id) => {
                    total += parseFloat(v["repeating_gear_" + id + "_weight_total"]) || 0.0;
                });
                total += (parseInt(v.encumbrance_coins_flag) || 0) * (parseFloat(v.encumbrance_coins_weight) || 0);
                if ((total - parseInt(total)) > 0) {
                    total = total.toFixed(1);
                }
                update["encumbrance_gear_weight"] = total;
                setAttrs(update, {silent: false});
            });
        });
    };
    // Encumbrance
    const update_encumbrance = function() {
        getAttrs(pfoglobals_encumbrance_fields, (v) => {
            // DEBUG
            if (pfoglobals_debug_mode) {console.log("*** DEBUG update_encumbrance");}
            if(v.npc != "1") {
                setAttrs(calc_encumbrance(v), {silent: true}, () => {
                   update_speed();
                   update_ac_ability("encumbrance_ability_maximum");
                   update_all_skills();
                });
            }
        });
    };
    const calc_encumbrance = function(v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_encumbrance call");}
        var update = {}, checkpen = 0, dexmax = 99, maxab = "-", runfactor = 4, display = "", weight = parseInt(v.encumbrance_gear_weight) || 0;
        var speedbase = (parseInt(v.speed_race) || 30) + (parseInt(v.speed_class) || 0);
        var bonus = parseInt(v.encumbrance_load_bonus) || 0;
        var str = (parseInt(v.strength) || 10) + bonus;
        var multi = parseFloat(v.encumbrance_load_multiplier) || 1.0;
        var size = parseFloat(v.encumbrance_size) || 1.0;
        var heavy = parseInt((calc_max_load(str) * size) * multi);
        var medium = Math.floor((heavy / 3) * 2);
        var light = Math.floor(heavy / 3);
        var prevenc = v.encumbrance; // light / medium / heavy / over
        var speed = speedbase;
        var newenc = prevenc;
        update["encumbrance_load_light"] = light;
        update["encumbrance_load_medium"] = medium;
        update["encumbrance_load_heavy"] = heavy;
        update["encumbrance_lift_head"] = heavy;
        update["encumbrance_lift_ground"] = heavy * 2;
        update["encumbrance_drag_push"] = heavy * 5;
        if (typeof v.encumbrance_display !== "undefined") {
            display = v.encumbrance_display;
        }
        if((weight > light) && (weight <= medium)) {
            newenc = "medium";
            checkpen = -3;
            speed = calc_reduced_speed(speedbase);
            dexmax = 3;
            runfactor = 4;
        } else if ((weight > medium) && (weight <= heavy)) {
            newenc = "heavy";
            checkpen = -6;
            speed = calc_reduced_speed(speedbase);
            dexmax = 1;
            runfactor = 3;
        } else if (weight > heavy) {
            newenc = "over";
            checkpen = -6;
            speed = 5;
            dexmax = 1;
            runfactor = 3;
        } else {
            newenc = "light";
        }
        if((prevenc != newenc) || (display == "")) {
            if (dexmax < 99) {
                maxab = dexmax;
            }
            update["encumbrance"] = newenc;
            update["encumbrance_display"] = getTranslationByKey(newenc + "-load");
            update["encumbrance_check_penalty"] = checkpen;
            update["speed_encumbrance"] = speed;
            update["encumbrance_ability_maximum"] = maxab;
            update["encumbrance_run_factor"] = runfactor;
        }
        return update;
    };
    const calc_max_load = function(str) {
        if((str >= 0) && (str <= 10)) { return (str * 10);}
        else if (str > 14) { return (2 * calc_max_load(str - 5));}
        else {return ([115, 130, 150, 175][str - 11]);}
    };

    // === SPELLS / SPELLCASTING
    const update_concentration = function(srcattr) {
        var cster = srcattr.substr(0,7).slice(-1);
        getAttrs(pfoglobals_concentration_fields, (v) => {
            if(v.npc != "1") {
                setAttrs(calc_concentration(srcattr, v), {silent: true}, () => {
                    if(srcattr == "caster" + cster + "_ability") {
                        update_spells_dc(srcattr);
                    }
                });
            }
        });
    };
    const calc_concentration = function(srcattr, v) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_concentration srcattr: " + srcattr);}
        var cster = srcattr.substr(0,7).slice(-1);
        var update = {};
        if(srcattr == "caster" + cster + "_ability") {
            update["caster" + cster + "_ability_mod"] = parseInt(v[v["caster" + cster + "_ability"] + "_mod"]) || 0;
            v["caster" + cster + "_ability_mod"] = update["caster" + cster + "_ability_mod"];
        }
        update["caster" + cster + "_concentration"] = (parseInt(v["caster" + cster + "_level"]) || 0) + (parseInt(v["caster" + cster + "_ability_mod"]) || 0) + (parseInt(v["caster" + cster + "_concentration_misc"]) || 0) + (parseInt(v["caster" + cster + "_concentration_bonus"]) || 0);
        return update;
    };
    const update_spells_dc = function(attr) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_spells_dc attr: " + attr);}
        var cster = attr.substr(0,7).slice(-1), minlvl = 0, maxlvl = 0, update_all = false;
        if (["caster1_ability","caster1_ability_mod","caster1_dc_misc","caster2_ability","caster2_ability_mod","caster2_dc_misc"].includes(attr)) {
            update_all = true;
            maxlvl = 10;
        } else {
            minlvl = parseInt(attr.slice(-1)) || 0;
            maxlvl = 1 + minlvl;
        }
        if ((minlvl >= 0) && (maxlvl <= 10)) {
            getAttrs(pfoglobals_spells_dc_fields, (v) => {
                if(v.npc != "1") {
                    var update = calc_spells_dc(attr, v, minlvl, maxlvl)
                    if(update_all) {
                        setAttrs(update, {silent: true}, () => {
                            update_all_spells("all");
                        });
                    } else {setAttrs(update, {silent: false});}
                }
            });
        }
    };
    const calc_spells_dc = function(attr, v, minlvl, maxlvl) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_spells_dc attr: " + attr);}
        var  cster = attr.substr(0,7).slice(-1), update = {}, i = 0;
        if(attr == "caster" + cster + "_ability") {
            update["caster" + cster + "_ability_mod"] = parseInt(v[v["caster" + cster + "_ability"] + "_mod"]) || 0;
            v["caster" + cster + "_ability_mod"] = update["caster" + cster + "_ability_mod"];
        }
        for(i = minlvl; i < maxlvl; i++) {
            update["caster" + cster + "_dc_level_" + i] = 10 + i + (parseInt(v["caster" + cster + "_ability_mod"]) || 0) + (parseInt(v["caster" + cster + "_dc_misc"]) || 0) + (parseInt(v["caster" + cster + "_dcbonus_level_" + i]) || 0);
        }
        return update;
    };
    const update_spells_flag = function(level) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_spells_flag level: " + level);}
        var fields = ["caster1_spells_known_level_" + level, "caster2_spells_known_level_" + level, "caster1_spells_total_level_" + level, "caster2_spells_total_level_" + level];
        getAttrs(fields, (v) => {
            var flag = "caster_spells_flag_level_" + level, update = {};
            var tot = (parseInt(v["caster1_spells_known_level_" + level]) || 0) + (parseInt(v["caster2_spells_known_level_" + level]) || 0) + (parseInt(v["caster1_spells_total_level_" + level]) || 0) + (parseInt(v["caster2_spells_total_level_" + level]) || 0);
            update[flag] = (tot > 0) ? 1 : 0;
            setAttrs(update);
        });
    };
    const update_spells_totals = function(level,cster) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_spells_totals level: " + level + ", caster: " + cster);}
        var fields = ["caster" + cster + "_spells_perday_level_" + level, "caster" + cster + "_spells_bonus_level_" + level];
        getAttrs(fields, (v) => {
            var update = {};
            update["caster" + cster + "_spells_total_level_" + level] = (parseInt(v["caster" + cster + "_spells_perday_level_" + level]) || 0) + (parseInt(v["caster" + cster + "_spells_bonus_level_" + level]) || 0);
            setAttrs(update, {silent: false});
        });
    };
    const update_spells_prepared = function (src,val) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_spells_prepared src: " + src + ", val: " + val);}
        var update = {};
        var repsec = src.substr(0,17);
        var level = repsec.charAt(repsec.length - 1);
        getSectionIDs("repeating_spell-" + level, (idarray) => {
            var spell_attribs = ["caster1_spells_total_level_" + level,"caster2_spells_total_level_" + level];
            _.each(idarray, (spellid) => {
                spell_attribs.push("repeating_spell-" + level + "_" + spellid + "_spellprepared");
                spell_attribs.push("repeating_spell-" + level + "_" + spellid + "_spellcaster");
            });
            getAttrs(spell_attribs, (v) => {
                var total1 = 0, total2 = 0;
                _.each(idarray, (id) => {
                    if (v["repeating_spell-" + level + "_" + id + "_spellcaster"] == "2") { total2 += parseInt(v["repeating_spell-" + level + "_" + id + "_spellprepared"]) || 0; }
                    else { total1 += parseInt(v["repeating_spell-" + level + "_" + id + "_spellprepared"]) || 0; }
                });
                update["caster1_spells_prepared_level_" + level] = total1;
                update["caster1_spells_prepared_flag_" + level] = (total1 > (parseInt(v["caster1_spells_total_level_" + level]) || 0)) ? 1 : 0;
                update["caster2_spells_prepared_level_" + level] = total2;
                update["caster2_spells_prepared_flag_" + level] = (total2 > (parseInt(v["caster2_spells_total_level_" + level]) || 0)) ? 1 : 0;
                setAttrs(update, {silent: true});
            });
        });
    };
    const update_all_spells = function(update_id) {
        var debug_start = new Date();
        // Gathering all spells levels items ids to pass to update_spells()
        get_repsec_ids(JSON.parse(JSON.stringify(pfoglobals_repsec_spell)), (repsec_agr)=> {
            do_update_spell(["0","1","2","3","4","5","6","7","8","9","like"],update_id,repsec_agr,debug_start);
        });
    };
    const update_spells = function(level,update_id) {
        var debug_start = null;
        // DEBUG
        if (pfoglobals_debug_mode) {
            debug_start = new Date();
            console.log("*** DEBUG DOING UPDATE_SPELLS: " + level + " / " + update_id);
        }
        var attr_array = [];
        if(level == "like") {
            attr_array = pfoglobals_spell_attr.concat(pfoglobals_spell_like_attr);
        } else {
            attr_array = pfoglobals_spell_attr.concat(pfoglobals_spell_only_attr);
        }
        if(update_id.substring(0,1) === "-" && update_id.length === 20) {
            do_update_spell([level],"",[{section: "spell-" + level, ids: [update_id], attrs: attr_array}],debug_start);
        } else if(["strength","dexterity","constitution","intelligence","wisdom","charisma","melee","ranged","cmb","all"].includes(update_id)) {
            get_repsec_ids([{section: "spell-" + level, attrs: attr_array}], (repsec_agr)=>{
                do_update_spell([level],update_id,repsec_agr,debug_start);
            });
        }
    };
    const do_update_spell = function(level, attributename = "", repsec_agr, debug_start) {
        if (pfoglobals_debug_mode) {console.log("*** DEBUG do_update_spell: " + level + " / " + attributename);}
        var spell_attribs = get_repsec_fields(repsec_agr, pfoglobals_spell_fields);
        getAttrs(spell_attribs, (v) => {
            setAttrs(calc_spells(level, repsec_agr, v, attributename), {silent: true}, ()=>{
                if (pfoglobals_debug_mode) {
                    var elapsed = new Date() - debug_start;
                    console.log("*** DEBUG time to update spells: " + elapsed);
                }
            });
        });
    };
    const calc_spells = function(level, repsec_agr, v, attributename = "") {
        var update = {};
        _.each(level, (spell_level) => {
            let spellids = repsec_agr.find((repsec) => repsec.section === "spell-" + spell_level).ids;
            _.each(spellids, (spellid) => {
                if( (attributename.length === 0) || (attributename == "all") || (v["repeating_spell-" + spell_level + "_" + spellid + "_spellatktype"] && v["repeating_spell-" + spell_level + "_" + spellid + "_spellatktype"].includes(attributename))) {
                    _.extend(update,calc_spell(spell_level,spellid,v));
                }
            });
        });
        return update;
    };
    const calc_spell = function(spell_level,spellid,v) {
        var update = {};
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_spell: " + spell_level + " / " + spellid);}
        // Begin calc
        var stemp = "", rollbase = "", rollbasetemplate = "pc", conditionsnote = "";
        if (v.npc == "1") {
            rollbasetemplate = "npc";
        }
        var atkflag = v["repeating_spell-" + spell_level + "_" + spellid + "_spellatkflag"] || "0";
        var atktype = v["repeating_spell-" + spell_level + "_" + spellid + "_spellatktype"] || "0";
        var atkmod = v["repeating_spell-" + spell_level + "_" + spellid + "_spellatkmod"] || "0";
        var atkcritrange = parseInt(v["repeating_spell-" + spell_level + "_" + spellid + "_spellatkcritrange"]) || 20;
        var dmgflag = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmgflag"] || "0";
        var dmgbase = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmg"] || "0";
        if (! dmgbase.length) {
            dmgbase = "0";
        }
        var dmgcritmulti = parseInt(v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmgcritmulti"]) || 1;
        var dmgtype = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmgtype"] || "";
        var dmg2flag = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmg2flag"] || "0";
        var dmg2base = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmg2"] || "0";
        if (! dmg2base.length) {
            dmg2base = "0";
        }
        var dmg2type = v["repeating_spell-" + spell_level + "_" + spellid + "_spelldmg2type"] || "";
        var cster = v["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster"] || "1";
        var csterflag1 = v.caster1_flag || "0";
        var csterflag2 = v.caster2_flag || "0";
        // == Display and Multiclass handling
        if (spell_level == "like") {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_timesperday"] == "every-hours") {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spelldisplay"] = v["repeating_spell-" + spell_level + "_" + spellid + "_spellname"] + "  " + pfoglobals_i18n_obj["every-hours"].replace("X",v["repeating_spell-" + spell_level + "_" + spellid + "_perday_max"]);
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellprepared"] = 0;
            } else {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spelldisplay"] = v["repeating_spell-" + spell_level + "_" + spellid + "_spellname"] + "  " + pfoglobals_i18n_obj[v["repeating_spell-" + spell_level + "_" + spellid + "_timesperday"]];
                if(["per-hour","per-day","per-week","per-month","per-year"].includes(v["repeating_spell-" + spell_level + "_" + spellid + "_timesperday"])) {
                    update["repeating_spell-" + spell_level + "_" + spellid + "_spellprepared"] = 1;
                } else {
                    update["repeating_spell-" + spell_level + "_" + spellid + "_spellprepared"] = 0;
                }
            }
        } else {
            update["repeating_spell-" + spell_level + "_" + spellid + "_spelldisplay"] = v["repeating_spell-" + spell_level + "_" + spellid + "_spellname"];
            // Multicasting
            if ((csterflag1 == "1") && (typeof v.caster1_class !== "undefined")) {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster1_class"] = (v.caster1_class.length > 0) ? v.caster1_class : " ";
            } else {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster1_class"] = " ";
            }
            if ((csterflag2 == "1") && (typeof v.caster2_class !== "undefined")) {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster2_class"] = (v.caster2_class.length > 0) ? v.caster2_class : " ";
            } else {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster2_class"] = " ";
            }
            if ((csterflag1 == "1") && (csterflag2 == "1")) {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellmulticasters-flag"] = 1;
            } else {
                update["repeating_spell-" + spell_level + "_" + spellid + "_spellmulticasters-flag"] = 0;
                if (csterflag1 == "1") {
                    update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster"] = 1;
                    cster = "1";
                } else if (csterflag2 == "1") {
                    update["repeating_spell-" + spell_level + "_" + spellid + "_spellcaster"] = 2;
                    cster = "2";
                }
            }
        }
        // == Save DC
        var savedc = 0 + (parseInt(v["caster" + cster + "_dc_level_" + spell_level]) || 0) + (parseInt(v["repeating_spell-" + spell_level + "_" + spellid + "_spelldc_mod"]) || 0);
        // == Rolls handling
        // base
        rollbase = "@{whispertype} &{template:" + rollbasetemplate + "}{{name=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellname"] + "}}{{type=spell}}{{showchar=@{rollshowchar}}}{{charname=@{character_name}}}";
        // spell level
        if (spell_level == "like") {
            if (v.npc == "1") {
                rollbase += "{{level=" + v.caster2_level + "}}";
            }
        } else {
            rollbase += "{{level=" + spell_level + "}}";
        }
        // caster class
        if ((v.npc !== "1") && (csterflag1 == "1") && (csterflag2 == "1") && (typeof v.caster1_class !== "undefined") && (typeof v.caster2_class !== "undefined")) {
            rollbase += "{{casterclass=" + ((cster == "1") ? v.caster1_class : v.caster2_class) + "}}";
        }
        // type (spell-like)
        if (spell_level == "like") {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_spelltype"]) {
                rollbase += "{{powertype=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spelltype"] + "}}";
            }
        }
        // school
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellschool"]) {
            rollbase += "{{school=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellschool"] + "}}";
        }
        // casting time
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellcastingtime"]) {
            rollbase += "{{castingtime=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellcastingtime"] + "}}";
        }
        // component
        if (spell_level != "like") {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellcomponent"]) {
                rollbase += "{{component=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellcomponent"] + "}}";
            }
        }
        // range
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellrange"]) {
            rollbase += "{{range=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellrange"] + "}}";
        }
        // area
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellarea"]) {
            rollbase += "{{area=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellarea"] + "}}";
        }
        // targets
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spelltargets"]) {
            rollbase += "{{targets=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spelltargets"] + "}}";
        }
        // effect
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spelleffect"]) {
            rollbase += "{{effect=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spelleffect"] + "}}";
        }
        // duration
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellduration"]) {
            rollbase += "{{duration=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellduration"] + "}}";
        }
        // saving throw
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellsaveflag"]) {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellsaveflag"] != "0") {
                rollbase += "{{save=1}}{{savedc=[[" + savedc + "]]}}{{saveeffect=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellsave"] + "}}";
            }
        }
        // spell resistance
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellresistanceflag"]) {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_spellresistanceflag"] != "0") {
                rollbase += "{{sr=1}}{{spellresistance=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spellresistance"] + "}}";
            }
        }
        // desc
        if(v["repeating_spell-" + spell_level + "_" + spellid + "_spelldescflag"]) {
            if(v["repeating_spell-" + spell_level + "_" + spellid + "_spelldescflag"] != "0") {
                rollbase += "{{descflag=[[1]]}}{{desc=" + v["repeating_spell-" + spell_level + "_" + spellid + "_spelldesc"] + "}}";
            }
        }
        // roll attack
        if(atkflag != "0") {
            if (atktype != "0") {
                atktype = "@{" + atktype + "_mod}";
            }
            if (atkmod.length == 0) {
                atkmod = "0";
            }
            rollbase += atkflag + "{{roll=[[1d20cs>" + atkcritrange + "+" + atktype + "[" + pfoglobals_i18n_obj[v["repeating_spell-" + spell_level + "_" + spellid + "_spellatktype"]] + "]+" + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
            rollbase += "{{critconfirm=[[1d20cs20+" + atktype + "[" + pfoglobals_i18n_obj[v["repeating_spell-" + spell_level + "_" + spellid + "_spellatktype"]] + "]+" + atkmod + "[MOD]+(@{attack_condition})[CONDITION]+@{rollmod_attack}[BONUS]]]}}";
            if (v.npc == "0") {
                conditionsnote += "@{attack_condition_note}";
                rollbase += "{{conditionsflag=[[@{attack_condition}]]}}{{conditions=@{conditions_display}}}";
            }
        }
        // roll damage
        if((dmgflag != "0") || (dmg2flag != "0")) {
            if(dmgflag != "0") {
                stemp = "" + dmgbase + "+@{rollmod_damage}[BONUS]";
                rollbase += dmgflag + "{{dmg1=[[" + stemp + "]]}}{{dmg1type=" + dmgtype +"}}";
                if( (atkflag != "0") && (dmgcritmulti >1) ) { // Critical damage
                    stemp = "";
                    for(i = 1; i <= dmgcritmulti; i++) { stemp += ((stemp.length > 0) ? "+" : "") + dmgbase; }
                    rollbase += "{{dmg1crit=[[(" + stemp +")+(@{rollmod_damage}*" + dmgcritmulti + ")[BONUS]]]}}";
                }
            }
            if(dmg2flag != "0") {
                stemp = "" + dmg2base + "+@{rollmod_damage}[BONUS]";
                rollbase += dmg2flag + "{{dmg2=[[" + stemp +"]]}}{{dmg2type=" + dmg2type + "}}";
                if( (atkflag != "0") && (dmgcritmulti >1) ) { // Critical damage
                    stemp = "";
                    for(i = 1; i <= dmgcritmulti; i++) {
                        stemp += ((stemp.length > 0) ? "+" : "") + dmg2base;
                    }
                    rollbase += "{{dmg2crit=[[(" + stemp +")+(@{rollmod_damage}*" + dmgcritmulti + ")[BONUS]]]}}";
                }
            }
        }
        // spell failure
        if ((v.npc !== "1") && (spell_level != "like")) {
            if( (v.armor_spell_failure != "0") && ( ((v.caster1_spell_failure == "1") && (cster == "1")) || ((cster == "2") && (v.caster2_spell_failure == "1"))) ) {
                rollbase += "{{spellfailureroll=[[1d100]]}}";
                rollbase += "{{spellfailure=[[" + v.armor_spell_failure + "]]}}";
                conditionsnote += "@{spell_condition_note}";
            }
        }
        // concentration
        if ((v.npc == "0") && (spell_level != "like")) {
            update["repeating_spell-" + spell_level + "_" + spellid + "_rollconcentration"] = v["caster" + cster + "_concentration_roll"];
            rollbase += "{{concentration=[" + getTranslationByKey("concentration") + "](~repeating_spell-" + spell_level + "_concentration)}}";
        }
        // notes & conditions
        if (v.npc == "0") {
            if(v["rollnotes_spell"] != "0") {
                rollbase += "{{shownotes=[[1]]}}{{notes=" + v["repeating_spell-" + spell_level + "_" + spellid + "_notes"] + "}}";
            }
            rollbase += "{{conditionsnote=" + conditionsnote + "}}";
        }
        // == update
        update["repeating_spell-" + spell_level + "_" + spellid + "_spelldc"] = savedc;
        update["repeating_spell-" + spell_level + "_" + spellid + "_rollcontent"] = rollbase;
        // End calc
        return update;
    };

    // === Conditions
    const update_conditions = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG update_conditions call");}
        getAttrs(pfoglobals_conditions, (v) => {
            setAttrs(calc_conditions(v, false), {silent: false});
        });
    };
    const reset_conditions = function() {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG reset_conditions call");}
        getAttrs(pfoglobals_conditions, (v) => {
            setAttrs(calc_conditions(v, true), {silent: false});
        });
    };
    const calc_conditions = function(v, reset = false) {
        // DEBUG
        if (pfoglobals_debug_mode) {console.log("*** DEBUG calc_conditions call, reset: " + reset);}
        var dspl = " ", update = {}, strength_condition = 0, dexterity_condition = 0, dexterity_condition_nobonus = 0, ability_check_condition = 0, ac_condition = 0, ac_condition_nobonus = 0, ac_condition_note = " ", cmd_condition = 0, skill_condition = 0, skill_condition_note = "", perception_condition_note = "", attack_condition = 0, attack_condition_note = "", cmb_condition_note = "", damage_condition_note = "", initiative_condition = 0, spell_condition_note = "", saves_condition = 0, hp_condition = 0, speed_condition = 0, speed_condition_multiplier = 1.0, speed_condition_nospeed = 0, speed_condition_norun = 0, i = 0;
        if(reset) {
            _.each(pfoglobals_conditions, (fld) => {
                update[fld] = 0;
            });
            update["conditions_reset"] = 0;
            update["options-flag-conditions"] = 0;
        } else {
            _.each(pfoglobals_conditions, (fld) => {
                if((parseInt(v[fld]) || 0) > 0) {
                    if (dspl.trim().length == 0) {
                        dspl = pfoglobals_i18n_obj[fld.replace("condition_","")];
                    } else {
                        dspl += "  " + pfoglobals_i18n_obj[fld.replace("condition_","")];
                    }
                    if (fld == "condition_blinded") {
                        ac_condition -= 2;
                        cmd_condition -= 2;
                        ac_condition_nobonus = 1;
                        skill_condition_note += getTranslationByKey("blinded-skills") + " ";
                        perception_condition_note += getTranslationByKey("blinded-perception") + " ";
                    }
                    if (fld == "condition_cowering") {
                        ac_condition -= 2;
                        cmd_condition -= 2;
                        ac_condition_nobonus = 1;
                    }
                    if (fld == "condition_dazzled") {
                        perception_condition_note += getTranslationByKey("dazzled-perception") + " ";
                        attack_condition -= 1;
                    }
                    if (fld == "condition_deafened") {
                        perception_condition_note += getTranslationByKey("deafened-perception") + " ";
                        initiative_condition -= 4;
                        spell_condition_note += getTranslationByKey("deafened-spell") + " ";
                    }
                    if (fld == "condition_energy_drained") {
                        i = parseInt(v["condition_energy_drained"]) || 1;
                        dspl += " (" + i + ")";
                        ability_check_condition -= i;
                        initiative_condition -= i;
                        cmd_condition -= i;
                        skill_condition -= i;
                        attack_condition -= i;
                        saves_condition -= i;
                        hp_condition -= (5*i);
                    }
                    if (fld == "condition_entangled") {
                        dexterity_condition -= 4;
                        attack_condition -= 2;
                        speed_condition = 1;
                        speed_condition_multiplier = Math.min(speed_condition_multiplier, 0.5);
                        speed_condition_norun = 1;
                    }
                    if (fld == "condition_exhausted") {
                        strength_condition -= 6;
                        dexterity_condition -= 6;
                        speed_condition = 1;
                        speed_condition_multiplier = Math.min(speed_condition_multiplier, 0.5);
                        speed_condition_norun = 1;
                    }
                    if (fld == "condition_fascinated") {
                        skill_condition_note += getTranslationByKey("fascinated-skills") + " ";
                    }
                    if (fld == "condition_fatigued") {
                        strength_condition -= 2;
                        dexterity_condition -= 2;
                    }
                    if (fld == "condition_frightened") {
                        ability_check_condition -= 2;
                        skill_condition -= 2;
                        attack_condition -= 2;
                        initiative_condition -= 2;
                        saves_condition -= 2;
                    }
                    if (fld == "condition_grappled") {
                        dexterity_condition -= 4;
                        attack_condition -= 2;
                        cmb_condition_note += getTranslationByKey("grappled-cmb") + " ";
                        speed_condition = 1;
                        speed_condition_nospeed = 1;
                    }
                    if (fld == "condition_invisible") {
                        attack_condition_note += getTranslationByKey("invisible-attack") + " ";
                    }
                    if (fld == "condition_panicked") {
                        ability_check_condition -= 2;
                        skill_condition -= 2;
                        initiative_condition -= 2;
                        saves_condition -= 2;
                    }
                    if (fld == "condition_pinned") {
                        dexterity_condition_nobonus = 1;
                        ac_condition_nobonus = 1;
                        ac_condition -= 4;
                        cmd_condition -= 4;
                        speed_condition = 1;
                        speed_condition_nospeed = 1;
                    }
                    if (fld == "condition_prone") {
                        ac_condition_note += getTranslationByKey("prone-defender") + " ";
                        attack_condition_note += getTranslationByKey("prone-attacker") + " ";
                    }
                    if (fld == "condition_shaken") {
                        ability_check_condition -= 2;
                        skill_condition -= 2;
                        attack_condition -= 2;
                        initiative_condition -= 2;
                        saves_condition -= 2;
                    }
                    if (fld == "condition_sickened") {
                        ability_check_condition -= 2;
                        skill_condition -= 2;
                        attack_condition -= 2;
                        damage_condition_note += getTranslationByKey("sickened-damage") + " ";
                        initiative_condition -= 2;
                        saves_condition -= 2;
                    }
                    if (fld == "condition_stunned") {
                        ac_condition -= 2;
                        cmd_condition -= 2;
                        ac_condition_nobonus = 1;
                    }
                }
            });
        }
        update["strength_condition"] = strength_condition;
        update["dexterity_condition"] = dexterity_condition;
        update["ability_check_condition"] = ability_check_condition;
        update["dexterity_condition_nobonus"] = dexterity_condition_nobonus;
        update["ac_condition"] = ac_condition;
        update["ac_condition_nobonus"] = ac_condition_nobonus;
        update["ac_condition_note"] = ac_condition_note;
        update["cmd_condition"] = cmd_condition;
        update["skill_condition"] = skill_condition;
        update["skill_condition_note"] = skill_condition_note;
        update["perception_condition_note"] = perception_condition_note;
        update["attack_condition"] = attack_condition;
        update["attack_condition_note"] = attack_condition_note;
        update["cmb_condition_note"] = cmb_condition_note;
        update["damage_condition_note"] = damage_condition_note;
        update["initiative_condition"] = initiative_condition;
        update["spell_condition_note"] = spell_condition_note;
        update["saves_condition"] = saves_condition;
        update["hp_condition"] = hp_condition;
        update["speed_condition"] = speed_condition;
        update["speed_condition_multiplier"] = speed_condition_multiplier;
        update["speed_condition_nospeed"] = speed_condition_nospeed;
        update["speed_condition_norun"] = speed_condition_norun;
        update["conditions_display"] = dspl;
        return update;
    };

    // == Big recalculate from ability updates
    const le_big_stuff = function(ability, reset_conditions = false, callback = null) {
        var debug_start = new Date();
        // DEBUG
        if (pfoglobals_debug_mode) {
            console.log("*** DEBUG le_big_stuff start for ability: " + ability + ", at " + debug_start);
        }
        // Gathering all necessary repsection IDs
        const all_repsecs = [...pfoglobals_repsec_atk, ...pfoglobals_repsec_spell, ...pfoglobals_repsec_skills];
        get_repsec_ids(JSON.parse(JSON.stringify(all_repsecs)), (repsec_agr)=>{
            // Gathering all necessary attributes
            var tmpfields = [];
            // Size
            tmpfields.push("size");
            // Saves attributes
            _.each(["fortitude","reflex","will"],(savename)=>{
                tmpfields.push(...pfoglobals_save_attr.map((fld) => savename + "_" + fld));
            });
            // --- Skills
            _.each(pfoglobals_skill_list,(skillname)=>{
                tmpfields.push(...pfoglobals_skill_attr.map((skillattr) => skillname + "_" + skillattr));
            });
            tmpfields.push(...pfoglobals_skillranks_fields);
            // Some special fields
            tmpfields.push("hp_base","hp_base_max","hp_condition","dexterity_condition_nobonus");
            // All other fixed ones
            tmpfields.push(...pfoglobals_abilities, ...pfoglobals_abilities_fields, ...pfoglobals_mods, ...pfoglobals_flex_abilities, ...pfoglobals_initiative_fields, ...pfoglobals_ac_ability_fields, ...pfoglobals_ac_fields, ...pfoglobals_babs_fields, ...pfoglobals_skill_fields, ...pfoglobals_atk_fields, ...pfoglobals_spell_fields, ...pfoglobals_concentration_fields, ...pfoglobals_spells_dc_fields, ...pfoglobals_encumbrance_fields, ...pfoglobals_speed_fields, ...pfoglobals_conditions);
            ;
            // -- Remove duplicates
            const fixed_fields = Array.from(new Set(tmpfields))
            // -- Add repsec fields
            const all_fields = get_repsec_fields(repsec_agr,fixed_fields);
            // Gathering values
            getAttrs(all_fields, (v) => {
                // DEBUG
                if (pfoglobals_debug_mode) {console.log("*** DEBUG le_big_stuff : " + JSON.stringify(v,null,"  "));}
                var big_update = {};
                var update = {};
                // === Conditions
                update = calc_conditions(v, reset_conditions);
                _.extend(big_update, update);
                _.extend(v, update);
                // === Mods
                if(["strength","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("strength",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("strength",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    if(v.npc !== "1") {
                        // Encumbrance
                        update = calc_encumbrance(v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                        // Speed
                        update = calc_speed(v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                }
                if(["dexterity","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("dexterity",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("dexterity",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                }
                if(["constitution","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("constitution",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("constitution",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                }
                if(["intelligence","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("intelligence",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("intelligence",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                }
                if(["wisdom","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("wisdom",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("wisdom",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                }
                if(["charisma","all"].includes(ability)) {
                    if(v.npc !== "1") {
                        update = calc_ability("charisma",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    update = calc_ability_mod("charisma",v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                }
                // === Other PC only stuff
                if(v.npc !== "1") {
                    // Size
                    update = calc_pc_size(v.size);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // Flex abilities
                    update = {};
                    _.each(pfoglobals_flex_abilities, (ablt) => {
                        update[ablt + "_mod"] = v[v[ablt] + "_mod"];
                    });
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // HP
                    big_update["hp"] = (parseInt(v.hp_base) || 0) + (parseInt(v.hp_condition) || 0);
                    big_update["hp_max"] = (parseInt(v.hp_base_max) || 0) + (parseInt(v.hp_condition) || 0);
                    // Initiative
                    update = calc_initiative(v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // AC
                    update = calc_ac_ability(ability,v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    update = calc_ac(v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // BABS and CMD
                    update = calc_babs_all(v);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // SAVES
                    _.each(["fortitude","reflex","will"],(savename)=>{
                        update = calc_save(savename, v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    });
                    // Concentration &  Spell DC
                    if(v.caster1_flag == "1") {
                        update = calc_concentration("caster1",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                        update = calc_spells_dc("caster1",v,0,10);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    if(v.caster2_flag == "1") {
                        update = calc_concentration("caster2",v);
                        _.extend(big_update, update);
                        _.extend(v, update);
                        update = calc_spells_dc("caster2",v,0,10);
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                    // Skillpoints & Skills
                    update = calc_skillranks_total(v);
                    _.extend(big_update, update);
                    var skills_array = [];
                    _.each(repsec_agr.filter(current_section => current_section.section.substr(0,5) == "skill"), (repsec) => {
                        skills_array.push(...repsec.ids.map((id) => "repeating_" + repsec.section + "_" + id));
                    });
                    skills_array.push(...pfoglobals_skill_list);
                    update = calc_skill(skills_array,v,true);
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // Attacks
                    update = calc_attacks(repsec_agr.filter(current_section => current_section.section == "attacks"), v, "all");
                    _.extend(big_update, update);
                    _.extend(v, update);
                    // Spells
                    if((v.caster1_flag == "1") || (v.caster2_flag == "1")) {
                        update = calc_spells(["0","1","2","3","4","5","6","7","8","9","like"],repsec_agr.filter(current_section => current_section.section.substr(0,6) == "spell-"), v, "all");
                        _.extend(big_update, update);
                        _.extend(v, update);
                    }
                }
                // Updating (finally)
                // DEBUG
                if (pfoglobals_debug_mode) {
                    console.log("*** DEBUG le_big_stuff big_update: " + JSON.stringify(big_update,null,"  "));
                    console.log("*** DEBUG le_big_stuff v: " + JSON.stringify(v,null,"  "));
                }
                setAttrs(big_update, {silent: true}, ()=>{
                    // DEBUG
                    var elapsed = new Date() - debug_start;
                    if (pfoglobals_debug_mode) {
                        console.log("*** DEBUG le_big_stuff done in " + elapsed + "ms ");
                    } else {
                        console.log("Pathfinder sheet updated (" + elapsed + ")");
                    }
                    if(callback) {
                        if (pfoglobals_debug_mode) {
                            console.log("*** DEBUG le_big_stuff setAttrs Callback");
                        }
                        callback();
                    } else {
                        if (pfoglobals_debug_mode) {
                            console.log("*** DEBUG le_big_stuff setAttrs NO Callback");
                        }
                    }
                });
            });
        });
    };

    // == Utilities
    const get_repsec_ids = function(repsec_array,callback,repsec_agr) {
        // Returns an array of objects, aggregating ids and attributes for various repeating sections items
        // Parameters: Source (like pfoglobals_repsec_spell), callback function, Aggregate ([{section:string, ids:[ids], attrs:[attribute]}])
        // Courtesy of Scott C. :)
        var currsection = repsec_array.shift();
        if(currsection.section) {
            if (pfoglobals_debug_mode) {console.log("*** DEBUG get_repsec_ids section: " + currsection.section);}
            repsec_agr = repsec_agr || [];
            getSectionIDs('repeating_' + currsection.section, (itemsids)=>{
                repsec_agr.push({
                    section:currsection.section,
                    ids:itemsids,
                    attrs:currsection.attrs
                });
                if (_.isEmpty(repsec_array)) {
                    callback(repsec_agr);
                } else {
                    get_repsec_ids(repsec_array,callback,repsec_agr);
                }
            });
        } else {
            if (_.isEmpty(repsec_array)) {
                callback(repsec_agr);
            } else {
                get_repsec_ids(repsec_array,callback,repsec_agr);
            }
        }
    };
    const get_repsec_fields = function(repsec_agr, other_attrs = []) {
        // Returns an array of attribute names from several repeating sections and optional other standard attributes
        // Parameters: Reapting section Aggregate ([{section:string, ids:[ids], attrs:[attributes]}]), [other attributes names]
        var fields = [], repsecfields = [];
        _.each(repsec_agr, (current_section)=>{
            // DEBUG console.log("*** DEBUG get_repsec_fields section: " + current_section.section);
            _.each(current_section.ids, (id)=>{
                // DEBUG console.log("*** DEBUG get_repsec_fields ids: " + id);
                _.each(current_section.attrs, (attr)=>{
                    // DEBUG console.log("*** DEBUG get_repsec_fields attrs: " + attr);
                    repsecfields.push("repeating_" + current_section.section + "_" + id + "_" + attr);
                });
            });
        });
        fields = repsecfields.concat(other_attrs);
        return fields;
    };
    const toTitleCase = function(str) {
        return str.replace(/\w\S*/g, function(txt){
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        });
    };
    const erase_repsec_ids = function(sectionArray, callback) {
        var thisSection = sectionArray.shift();
        getSectionIDs(thisSection, (itemids) => {
            _.each(itemids, (item) => {
                removeRepeatingRow("repeating_" + thisSection + "_" + item);
            });
            if(sectionArray.length > 0) {
                erase_repsec_ids(sectionArray, callback);
            } else {
                callback();
            }

        });
    };

    // === Multi Lingual handling
    const loadi18n = function() {
        pfoglobals_i18n_obj["strength"] = getTranslationByKey("str-u");
        pfoglobals_i18n_obj["dexterity"] = getTranslationByKey("dex-u");
        pfoglobals_i18n_obj["constitution"] = getTranslationByKey("con-u");
        pfoglobals_i18n_obj["intelligence"] = getTranslationByKey("int-u");
        pfoglobals_i18n_obj["wisdom"] = getTranslationByKey("wis-u");
        pfoglobals_i18n_obj["charisma"] = getTranslationByKey("cha-u");
        pfoglobals_i18n_obj["bab"] = getTranslationByKey("bab-u");
        pfoglobals_i18n_obj["melee"] = getTranslationByKey("melee");
        pfoglobals_i18n_obj["ranged"] = getTranslationByKey("ranged");
        pfoglobals_i18n_obj["cmb"] = getTranslationByKey("cmb-u");
        pfoglobals_i18n_obj["fob"] = getTranslationByKey("fob");
        pfoglobals_i18n_obj["cmd"] = getTranslationByKey("cmd-u");
        pfoglobals_i18n_obj["ac"] = getTranslationByKey("ac-u");
        pfoglobals_i18n_obj["touch"] = getTranslationByKey("touch");
        pfoglobals_i18n_obj["flatfooted"] = getTranslationByKey("flat-footed");
        pfoglobals_i18n_obj["fftouch"] = getTranslationByKey("ff-touch");
        pfoglobals_i18n_obj["other"] = getTranslationByKey("other");
        pfoglobals_i18n_obj["fortitude"] = getTranslationByKey("fort-u");
        pfoglobals_i18n_obj["reflex"] = getTranslationByKey("ref-u");
        pfoglobals_i18n_obj["will"] = getTranslationByKey("will-u");
        pfoglobals_i18n_obj["vs"] = getTranslationByKey("vs");
        pfoglobals_i18n_obj["0"] = "";
        pfoglobals_i18n_obj["constant"] = getTranslationByKey("constant");
        pfoglobals_i18n_obj["at-will"] = getTranslationByKey("at-will");
        pfoglobals_i18n_obj["per-hour"] = getTranslationByKey("per-hour");
        pfoglobals_i18n_obj["per-day"] = getTranslationByKey("per-day");
        pfoglobals_i18n_obj["per-week"] = getTranslationByKey("per-week");
        pfoglobals_i18n_obj["per-month"] = getTranslationByKey("per-month");
        pfoglobals_i18n_obj["per-year"] = getTranslationByKey("per-year");
        pfoglobals_i18n_obj["every-hours"] = getTranslationByKey("every-hours");
        pfoglobals_i18n_obj["bleed"] = getTranslationByKey("bleed");
        pfoglobals_i18n_obj["dazed"] = getTranslationByKey("dazed");
        pfoglobals_i18n_obj["dying"] = getTranslationByKey("dying");
        pfoglobals_i18n_obj["fascinated"] = getTranslationByKey("fascinated");
        pfoglobals_i18n_obj["grappled"] = getTranslationByKey("grappled");
        pfoglobals_i18n_obj["nauseated"] = getTranslationByKey("nauseated");
        pfoglobals_i18n_obj["pinned"] = getTranslationByKey("pinned");
        pfoglobals_i18n_obj["stable"] = getTranslationByKey("stable");
        pfoglobals_i18n_obj["blinded"] = getTranslationByKey("blinded");
        pfoglobals_i18n_obj["dazzled"] = getTranslationByKey("dazzled");
        pfoglobals_i18n_obj["energy_drained"] = getTranslationByKey("energy_drained");
        pfoglobals_i18n_obj["fatigued"] = getTranslationByKey("fatigued");
        pfoglobals_i18n_obj["helpless"] = getTranslationByKey("helpless");
        pfoglobals_i18n_obj["panicked"] = getTranslationByKey("panicked");
        pfoglobals_i18n_obj["prone"] = getTranslationByKey("prone");
        pfoglobals_i18n_obj["staggered"] = getTranslationByKey("staggered");
        pfoglobals_i18n_obj["confused"] = getTranslationByKey("confused");
        pfoglobals_i18n_obj["deafened"] = getTranslationByKey("deafened");
        pfoglobals_i18n_obj["entangled"] = getTranslationByKey("entangled");
        pfoglobals_i18n_obj["frightened"] = getTranslationByKey("frightened");
        pfoglobals_i18n_obj["incorporeal"] = getTranslationByKey("incorporeal");
        pfoglobals_i18n_obj["paralyzed"] = getTranslationByKey("paralyzed");
        pfoglobals_i18n_obj["shaken"] = getTranslationByKey("shaken");
        pfoglobals_i18n_obj["stunned"] = getTranslationByKey("stunned");
        pfoglobals_i18n_obj["cowering"] = getTranslationByKey("cowering");
        pfoglobals_i18n_obj["disabled"] = getTranslationByKey("disabled");
        pfoglobals_i18n_obj["exhausted"] = getTranslationByKey("exhausted");
        pfoglobals_i18n_obj["flat-footed"] = getTranslationByKey("flat-footed");
        pfoglobals_i18n_obj["invisible"] = getTranslationByKey("invisible");
        pfoglobals_i18n_obj["petrified"] = getTranslationByKey("petrified");
        pfoglobals_i18n_obj["sickened"] = getTranslationByKey("sickened");
        pfoglobals_i18n_obj["unconscious"] = getTranslationByKey("unconscious");
    };

    // === Version and updating
    const calc_reset_pc = function() {
        var update = {};

        // -- Reset to empty string
        var toResetAsChar = ["class1_name","class2_name","class3_name","languages","senses","ac_notes","fortitude_notes","reflex_notes","will_notes","caster1_class","caster2_class","caster1_spells_notes","caster2_spells_notes","initiative_notes","speed_notes","encumbrance_display","encumbrance_load_notes","misc_notes","background","bab_notes","cmb_notes","melee_notes","ranged_notes","cmd_notes","sr_notes","craft_name","perform_name","profession_name"];
        toResetAsChar = toResetAsChar.concat(pfoglobals_abilities.map((ablt) => ablt + "_notes"));
        toResetAsChar = toResetAsChar.concat(pfoglobals_skill_list.map((sk) => sk + "_notes"));
        _.each(toResetAsChar,(attr) => {
            update[attr] = "";
        });

        // -- Reset to zero
        var toResetAsZero = ["caster_flag","class2_level","class3_level","initiative_misc","money_cp","money_sp","money_gp","money_pp","xp",""];
        for(var i = 1; i < 4; i++) {
            toResetAsZero.push("class" + i + "_bab","class" + i + "_fortitude","class" + i + "_reflex","class" + i + "_will","class" + i + "_skillranks_base","class" + i + "_speed");
        }
        for(var j = 1; j < 3; j++) {
            for(var i = 0; i < 10; i++) {
                toResetAsZero.push("caster" + j + "_spells_known_level_" + i, "caster" + j + "_spells_perday_level_" + i, "caster" + j + "_spells_bonus_level_" + i, "caster" + j + "_spells_prepared_level_" + i, "caster" + j + "_spells_total_level_" + i, "caster" + j + "_dc_level_" + i, "caster" + j + "_dcbonus_level_" + i,"caster_spells_flag_level_" + i);
            }
        }

        toResetAsZero = toResetAsZero.concat(pfoglobals_abilities.map((ablt) => ablt + "_race"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_abilities.map((ablt) => ablt + "_bonus"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_abilities.map((ablt) => ablt + "_condition"));

        toResetAsZero = toResetAsZero.concat(pfoglobals_skill_list.map((sk) => sk + "_classkill"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_skill_list.map((sk) => sk + "_ability_mod"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_skill_list.map((sk) => sk + "_ranks"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_skill_list.map((sk) => sk + "_misc"));
        toResetAsZero = toResetAsZero.concat(pfoglobals_skill_list.map((sk) => sk + "_bonus"));

        toResetAsZero = toResetAsZero.concat(pfoglobals_mods,["initiative_misc","initiative_bonus"],["fortitude_base","fortitude_ability_mod","fortitude_misc","fortitude_bonus","reflex_base","reflex_ability_mod","reflex_misc","reflex_bonus","will_base","will_ability_mod","will_misc","will_bonus"],["encumbrance_ability_maximum"],["ac_condition_nobonus","ac_bonus","ac_ability_mod","ac_armor","ac_shield","ac_size","ac_natural","ac_deflection","ac_misc","ac_dodge","ac_touch_bonus","ac_flatfooted_bonus","ac_natural_bonus","ac_deflection_bonus","ac_dodge_bonus","ac_noflatflooted","ac_touchshield","ac_condition","ac_secab_monk","ac_ff_ability_mod"],["bab","bab_max","bab_multi","bab_size","cmb_mod","cmb_size","cmb_ability_mod","cmb_misc","cmb_bonus","melee_mod","melee_ability_mod","melee_misc","melee_bonus","ranged_mod","ranged_ability_mod","ranged_misc","ranged_bonus","cmd_misc","cmd_bonus","cmd_condition"],pfoglobals_skill_fields,["caster1_flag","caster2_flag","caster1_level","caster1_ability_mod","caster1_concentration","caster1_concentration_misc","caster1_concentration_bonus","caster2_level","caster2_ability_mod","caster2_concentration","caster2_concentration_misc","caster2_concentration_bonus"],["encumbrance_load_bonus","stealth_size","encumbrance_size","fly_size","encumbrance_gear_weight","encumbrance_load_light","encumbrance_load_medium","encumbrance_load_heavy","encumbrance"],["encumbrance","speed_notmodified","speed_bonus","speed_condition_multiplier","speed_condition_norun","speed_condition_nospeed","speed_class"],pfoglobals_conditions,["armor_spell_failure","caster1_dc_misc","caster2_dc_misc"]);

        toResetAsZero = _.uniq(toResetAsZero);
        _.each(toResetAsZero,(attr) => {
            update[attr] = 0;
        });

        // -- Reset to One (1)
        var toResetAsOne = ["class1_level","level","class_favored","encumbrance_load_multiplier","caster1_spell_failure","caster2_spell_failure"];
        _.each(toResetAsOne,(attr) => {
            update[attr] = 1;
        });

        // -- Reset to default value
        _.each(pfoglobals_abilities, (ablt) => {
            update[ablt] = 10;
            update[ablt + "_base"] = 10;
        });
        update["ac"] = 10;
        update["ac_touch"] = 10;
        update["ac_flatfooted"] = 10;
        update["class1_hitdietype"] = 8;
        update["class2_hitdietype"] = 8;
        update["class3_hitdietype"] = 8;
        update["xp_max"] = 2000;
        update["encumbrance_run_factor"] = 4;
        update["armor_run_factor"] = 4;
        update["ac_ability_primary"] = "dexterity";
        update["ac_ability_secondary"] = "";
        update["ac_ability_maximum"] = "-";

        update["fortitude_ability"] = "constitution";
        update["reflex_ability"] = "dexterity";
        update["will_ability"] = "wisdom";

        update["cmb_ability"] = "strength";
        update["melee_ability"] = "strength";
        update["ranged_ability"] = "dexterity";
        update["cmd_mod"] = 10;

        update["speed"] = 30;
        update["speed_base"] = 30;
        update["speed_character"] = 30;
        update["speed_encumbrance"] = 30;
        update["speed_armor"] = 30;
        update["speed_run_factor"] = 4;
        update["speed_run"] = 120;
        update["speed_swim"] = 7.5;
        update["speed_climb"] = 7.5;

        update["encumbrance_load_light"] = 33;
        update["encumbrance_load_medium"] = 66;
        update["encumbrance_load_heavy"] = 100;
        update["encumbrance_lift_head"] = 100;
        update["encumbrance_lift_ground"] = 200;
        update["encumbrance_drag_push"] = 500;
        update["encumbrance_check_penalty"] = 0;
        update["encumbrance_ability_maximum"] = "-";
        update["encumbrance_run_factor"] = 4;
        update["encumbrance_coins_weight"] = 0;

        update["acrobatics_ability"] = "dexterity";
        update["appraise_ability"] = "intelligence";
        update["bluff_ability"] = "charisma";
        update["climb_ability"] = "strength";
        update["craft_ability"] = "intelligence";
        update["diplomacy_ability"] = "charisma";
        update["disable_device_ability"] = "dexterity";
        update["disguise_ability"] = "charisma";
        update["escape_artist_ability"] = "dexterity";
        update["fly_ability"] = "dexterity";
        update["handle_animal_ability"] = "charisma";
        update["heal_ability"] = "wisdom";
        update["intimidate_ability"] = "charisma";
        update["knowledge_arcana_ability"] = "intelligence";
        update["knowledge_dungeoneering_ability"] = "intelligence";
        update["knowledge_engineering_ability"] = "intelligence";
        update["knowledge_geography_ability"] = "intelligence";
        update["knowledge_history_ability"] = "intelligence";
        update["knowledge_local_ability"] = "intelligence";
        update["knowledge_nature_ability"] = "intelligence";
        update["knowledge_nobility_ability"] = "intelligence";
        update["knowledge_planes_ability"] = "intelligence";
        update["knowledge_religion_ability"] = "intelligence";
        update["linguistics_ability"] = "intelligence";
        update["perception_ability"] = "wisdom";
        update["perform_ability"] = "charisma";
        update["profession_ability"] = "wisdom";
        update["ride_ability"] = "dexterity";
        update["sense_motive_ability"] = "wisdom";
        update["sleight_of_hand_ability"] = "dexterity";
        update["spellcraft_ability"] = "intelligence";
        update["stealth_ability"] = "dexterity";
        update["survival_ability"] = "wisdom";
        update["swim_ability"] = "strength";
        update["use_magic_device_ability"] = "charisma";

        update["acrobatics_armor_penalty"] = "1";
        update["climb_armor_penalty"] = "1";
        update["disable_device_armor_penalty"] = "1";
        update["escape_artist_armor_penalty"] = "1";
        update["fly_armor_penalty"] = "1";
        update["ride_armor_penalty"] = "1";
        update["sleight_of_hand_armor_penalty"] = "1";
        update["stealth_armor_penalty"] = "1";
        update["swim_armor_penalty"] = "1";

        update["caster1_ability"] = "intelligence";
        update["caster2_ability"] = "intelligence";

        return update;
    };
    const check_l1_mancer = function() {
        getAttrs(["l1mancer_status","npc","charactermancer_step"], function(v) {
            if(v.npc !== "1") {
                if(v["l1mancer_status"] && v["l1mancer_status"] === "completed") {
                    return;
                }

                if(v["charactermancer_step"]) {
                    startCharactermancer(v["charactermancer_step"]);
                } else {
                    if(v["l1mancer_status"] && v["l1mancer_status"] === "relaunch") {
                        startCharactermancer("l1-welcome");
                    } else {
                        setAttrs({mancer_confirm_flag: 1}, {silent: true});
                    }
                }
            }
        });
    };
    const initializeChar = function(doneupdating) {
        getAttrs(["character_name","npc"], (v) => {
            console.log("Initializing character " + v.character_name);
            if(v.npc !== "1") {
                var update = calc_reset_pc();
                // UPDATE
                setAttrs(update, {silent: true}, () => {
                    doneupdating();
                });
            }
        });
    };
    const update_to_1_07 = function(doneupdating) {
        console.log("UPDATING TO v1.07");
        setAttrs({"ac_natural_bonus": 0,"ac_deflection_bonus":0,"ac_dodge_bonus":0},{silent: true},() => {
            doneupdating();
        });
    };
    const update_to_1_08 = function(doneupdating) {
        console.log("UPDATING TO v1.08");
        getAttrs(["ac_ability_mod","npc"], (v) => {
            if(v.npc !== "1") {
                var update = {};
                if(typeof v.ac_ability_mod == "undefined") { var mod = 0; }
                else { var mod = v.ac_ability_mod; }
                update["ac_ability_mod"] = mod;
                update["encumbrance_coins_weight"] = 0; // coin weight init
                setAttrs(update,{silent: true}, () => {
                    update_ac(); // AC mod fix
                    // Size mod fix
                    update_babs_all();
                    update_all_spells("all");
                    // Coins weight
                    update_coins_weight();
                    update_gear_weight_total();
                    update_encumbrance();
                    doneupdating();
                });
            } else {
                doneupdating();
            }
        });
    };
    const update_to_1_10 = function(doneupdating) {
        console.log("UPDATING TO v1.10");
        getAttrs(["dexterity","hp","hp_max","npc"], (v) => {
            if(v.npc !== "1") {
                var update = {};
                var mod = Math.floor(((parseInt(v.dexterity) || 10) - 10) / 2);
                update["dexterity_half_mod"] = Math.floor(mod*0.5);
                update["dexterity_oneandahalf_mod"] = Math.floor(mod*1.5);
                update["hp_base"] = parseInt(v.hp) || 0;
                update["hp_base_max"] = parseInt(v.hp_max) || 0;
                setAttrs(update,{silent: true}, () => {
                    update_cmd(); // Ability mod fix to CMD
                    update_attacks("all"); // Conditions mod added to rolls
                    update_all_spells("all"); // Conditions mod added to rolls
                    doneupdating();
                });
            } else {
                doneupdating();
            }
        });
    };
    const update_to_1_12 = function(doneupdating) {
        console.log("UPDATING TO v1.12");
        getAttrs(["npc"], (v) => {
            if(v.npc !== "1") {
                update_all_skills(); // change armor/encumbrance penalty handling
            }
            doneupdating();
        });
    };
    const update_to_1_14 = function(doneupdating) {
        console.log("UPDATING TO v1.14");
        getAttrs(["npc","size"], (v) => {
            if(v.npc !== "1") {
                // size mods fix for CMB/CMD
                setAttrs(calc_pc_size(v["size"]),{silent: true}, () => {
                    update_babs_all(); //=>attacks
                });
            }
            doneupdating();
        });
    };
    const update_to_1_16 = function(doneupdating) {
        console.log("UPDATING TO v1.16");
        getAttrs(["npc","class","race"], (v) => {
            if(v.npc !== "1") {
                update_speed();
                // Already existing PC to be considered complete regarding the Charactermancer
                if((v.class && v.class.trim().length) || (v.race && v.race.trim().length)) {
                    setAttrs({"l1mancer_status": "completed"}, {silent: true}, () => {
                        doneupdating();
                    });
                } else {
                    doneupdating();
                }
            } else {
                doneupdating();
            }

        });
    };
    const versioning = function(initChar = false) {
        getAttrs(["version"], (v) => {
            // 1.16 TODO
            var vrs = parseFloat(v["version"]) || 0.0;
            if (vrs === pfoglobals_currentversion) {
                console.log("Pathfinder by Roll20 v" + vrs);
                check_l1_mancer();
            } else if (vrs < 1.0) {
                if(initChar) {
                    initializeChar(() => {
                        setAttrs({"version": "1.0"}, {silent: true}, () => {
                            versioning();
                        });
                    });
                } else {
                    setAttrs({"version": "1.0"}, {silent: true}, () => {
                        versioning();
                    });
                }
            } else if (vrs < 1.07) {
                update_to_1_07(() => {
                    setAttrs({"version": "1.07"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else if (vrs < 1.08) {
                update_to_1_08(() => {
                    setAttrs({"version": "1.08"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else if (vrs < 1.10) {
                update_to_1_10(() => {
                    setAttrs({"version": "1.10"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else if (vrs < 1.12) {
                update_to_1_12(() => {
                    setAttrs({"version": "1.12"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else if (vrs < 1.14) {
                update_to_1_14(() => {
                    setAttrs({"version": "1.14"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else if (vrs < 1.16) {
                update_to_1_16(() => {
                    setAttrs({"version": "1.16"}, {silent: true}, () => {
                        versioning();
                    });
                });
            } else {
                setAttrs({"version": pfoglobals_currentversion}, {silent: true}, () => {
                    versioning();
                });
            }
        });
    };
</script>

<!-- === MANCER === -->

<!-- Slides -->
<charmancer class="sheet-charmancer-l1-welcome">
    <div class="charmancer container">
        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step here"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step next"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step next"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step next"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step next"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step next"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT == -->
        <div style="display: block; width: 100%; font-size: 1.3em; text-align: center;" data-i18n="charmancer-welcome">
            Welcome to the Pathfinder by Roll20 Character Builder.
        </div>

        <!-- === NAVIGATION == -->
        <div class="bottombar">
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-abilities" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-welcome" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-abilities">
    <div class="charmancer container">
        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step here"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step next"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step next"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step next"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step next"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT == -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>
        <div class="choices">
            <input type="hidden" name="comp_pointbuy_points" value="0">
            <input type="hidden" name="comp_max_pointbuy_points" value="0">
            <input type="hidden" name="comp_dicepool" value="0">
            <input type="hidden" name="comp_max_dicepool" value="0">
            <input type="hidden" name="comp_roll_results" value="">
            <div class="row">
                <label class="hilite">
                    <span class="title" data-i18n="rollab-generation">Ability Scores Generation:</span>
                    <select name="comp_abilities" required>
                        <option value="" data-i18n="choose">Choose</option>
                        <option value="standard" data-i18n="rollab-standard">Standard (4d6, drop lowest)</option>
                        <option value="classic" data-i18n="rollab-classic">Classic (3d6)</option>
                        <option value="heroic" data-i18n="rollab-heroic">Heroic (2d6+6)</option>
                        <option value="dicepool_24" data-i18n="rollab-dicepool_24">Dice Pool (24d6)</option>
                        <option value="dicepool_28" data-i18n="rollab-dicepool_28">Dice Pool (high powered 28d6)</option>
                        <option value="purchase_low" data-i18n="rollab-purchase_low">Purchase (Low Fantasy: 10)</option>
                        <option value="purchase_standard" data-i18n="rollab-purchase_standard">Purchase (Standard Fantasy: 15)</option>
                        <option value="purchase_high" data-i18n="rollab-purchase_high">Purchase (High Fantasy: 20)</option>
                        <option value="purchase_epic" data-i18n="rollab-purchase_epic">Purchase (Epic Fantasy: 25)</option>
                        <option class="custom" value="custom" data-i18n="custom">Custom</option>
                    </select>
                </label>
            </div>
            <div class="row choice abilities_possible abilities_standard">
                <button type="roll" class="myrol mancer d6" name="roll_rollstats" value="&{template:mancerroll} {{title=Ability Scores Rolls: Standard (4d6, drop lowest)}} {{r1=[[4d6dl1]]}} {{r2=[[4d6dl1]]}} {{r3=[[4d6dl1]]}} {{r4=[[4d6dl1]]}} {{r5=[[4d6dl1]]}} {{r6=[[4d6dl1]]}} {{r1name=^{roll} ^{#1}}} {{r2name=^{roll} ^{#2}}} {{r3name=^{roll} ^{#3}}} {{r4name=^{roll} ^{#4}}} {{r5name=^{roll} ^{#5}}} {{r6name=^{roll} ^{#6}}}" data-i18n="rollab-standard">Standard (4d6, drop lowest)</button>
                <button type="action" class="mancer clear" name="act_clearstats" data-i18n="clear">Clear</button>
            </div>
            <div class="row choice abilities_possible abilities_classic">
                <button type="roll" class="myrol mancer d6" name="roll_rollstats" value="&{template:mancerroll} {{title=Ability Scores Rolls: Classic (3d6)}} {{r1=[[3d6]]}} {{r2=[[3d6]]}} {{r3=[[3d6]]}} {{r4=[[3d6]]}} {{r5=[[3d6]]}} {{r6=[[3d6]]}} {{r1name=^{roll} ^{#1}}} {{r2name=^{roll} ^{#2}}} {{r3name=^{roll} ^{#3}}} {{r4name=^{roll} ^{#4}}} {{r5name=^{roll} ^{#5}}} {{r6name=^{roll} ^{#6}}}" data-i18n="rollab-classic">Classic (3d6)</button>
                <button type="action" class="mancer clear" name="act_clearstats" data-i18n="clear">Clear</button>
            </div>
            <div class="row choice abilities_possible abilities_heroic">
                <button type="roll" class="myrol mancer d6" name="roll_rollstats" value="&{template:mancerroll} {{title=Ability Scores Rolls: Heroic (2d6+6)}} {{r1=[[2d6+6]]}} {{r2=[[2d6+6]]}} {{r3=[[2d6+6]]}} {{r4=[[2d6+6]]}} {{r5=[[2d6+6]]}} {{r6=[[2d6+6]]}} {{r1name=^{roll} ^{#1}}} {{r2name=^{roll} ^{#2}}} {{r3name=^{roll} ^{#3}}} {{r4name=^{roll} ^{#4}}} {{r5name=^{roll} ^{#5}}} {{r6name=^{roll} ^{#6}}}" data-i18n="rollab-heroic">Heroic (2d6+6)</button>
                <button type="action" class="mancer clear" name="act_clearstats"><span data-i18n="clear">Clear</span></button>
            </div>
            <div class="row choice abilities_possible abilities_dicepool">
                <div>
                    <strong>
                        <span data-i18n="available-dice:">Available Dice:</span>
                        <span class="dicepool_display"></span> / <span class="max_dicepool_display"></span>
                    </strong>
                </div>
                <button type="roll" class="myrol mancer d6" name="roll_rollstatsd6" value="&{template:mancerroll} {{title=Ability Scores Rolls: Dice Pool}} {{r1=Not set}} {{r2=Not set}} {{r3=Not set}} {{r4=Not set}} {{r5=Not set}} {{r6=Not set}} {{r1name=^{strength}}} {{r2name=^{dexterity}}} {{r3name=^{constitution}}} {{r4name=^{intelligence}}} {{r5name=^{wisdom}}} {{r6name=^{charisma}}}" data-i18n="rollab-dicepool">Roll Dice Pool</button>
                <button type="action" class="mancer clear" name="act_clearstats"><span data-i18n="clear">Clear</span></button>
            </div>
            <div class="row choice abilities_possible abilities_pointbuy">
                <strong>
                    <span data-i18n="available-points:">Available Points:</span>
                    <span class="points_available_display"></span> / <span class="max_points_available_display"></span>
                </strong>
                <button type="action" class="mancer clear" name="act_clearstats"><span data-i18n="clear">Clear</span></button>
            </div>
            <div class="choice abilities_possible abilities_custom">
                <!-- Manually input stats -->
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="strength">Strength:</span>
                        <div class="boxed">
                            <input type="number" name="comp_strength" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="dexterity">Dexterity:</span>
                        <div class="boxed">
                            <input type="number" name="comp_dexterity" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="constitution">Constitution:</span>
                        <div class="boxed">
                            <input type="number" name="comp_constitution" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="intelligence">Intelligence:</span>
                        <div class="boxed">
                            <input type="number" name="comp_intelligence" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="wisdom">Wisdom:</span>
                        <div class="boxed">
                            <input type="number" name="comp_wisdom" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-i18n="charisma">Charisma:</span>
                        <div class="boxed">
                            <input type="number" name="comp_charisma" min="0" placeholder="-" required>
                        </div>
                    </label>
                </div>
            </div>
            <div class="choice abilities_possible abilities_selects">
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="strength">Strength:</span>
                        <span class="abilities_radio_strength" name="comp_strength" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="dexterity">Dexterity:</span>
                        <span class="abilities_radio_dexterity" name="comp_dexterity" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="constitution">Constitution:</span>
                        <span class="abilities_radio_constitution" name="comp_constitution" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="intelligence">Intelligence:</span>
                        <span class="abilities_radio_intelligence" name="comp_intelligence" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="wisdom">Wisdom:</span>
                        <span class="abilities_radio_wisdom" name="comp_wisdom" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="charisma">Charisma:</span>
                        <span class="abilities_radio_charisma" name="comp_charisma" required></span>
                    </div>
                </div>
            </div>
            <div class="choice abilities_possible abilities_dicepool">
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="strength-d6">Strength D6s:</span>
                        <span class="abilities_radio_strengthd6" name="comp_strengthd6" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="dexterity-d6">Dexterity D6s:</span>
                        <span class="abilities_radio_dexterityd6" name="comp_dexterityd6" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="constitution-d6">Constitution D6s:</span>
                        <span class="abilities_radio_constitutiond6" name="comp_constitutiond6" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="intelligence-d6">Intelligence D6s:</span>
                        <span class="abilities_radio_intelligenced6" name="comp_intelligenced6" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="wisdom-d6">Wisdom D6s:</span>
                        <span class="abilities_radio_wisdomd6" name="comp_wisdomd6" required></span>
                    </div>
                </div>
                <div class="row">
                    <div class="hilite">
                        <span class="label" data-i18n="charisma-d6">Charisma D6s:</span>
                        <span class="abilities_radio_charismad6" name="comp_charismad6" required></span>
                    </div>
                </div>
            </div>
            <div class="row last"></div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page" accept="Generating%20Ability%20Scores"></div>
        </div>

        <!-- === NAVIGATION == -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-welcome" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-race" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-abilities" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-race">
    <div class="charmancer container">
        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step here"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step next"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step next"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step next"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT == -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>
        <div class="choices">
            <div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-18n="choose-race">Choose a race:</span>
                        <select name="comp_race" accept="Category:Races" required>
                            <option value="" data-i18n="choose">Choose</option>
                            <option class="custom" value="Index:Races" data-i18n="custom">Custom</option>
                        </select>
                        <button type="action" name="act_info_race" class="mancer_info">i</button>
                        <span class="choice custom_race">Custom race allows for customized stat adjustment, speed, and size. All other custom race features should be entered manually on the character sheet after the Charactermancer is completed.</span>
                        <label class="choice custom_race">
                            <span class="title" data-18n="name:">Name:</span>
                            <input type="text" name="comp_race_custom_name" data-i18n-placeholder="race" placeholder="Race" />
                        </label>
                    </label>
                </div>
                <div class="choice row race_always custom_race"> <!-- ABILITIES -->
                    <label class="hilite">
                        <span class="title" data-18n="ability-score-increase">Ability Score Increase:</span>
                        <span class="race_ability_score race_text"></span>
                        <span class="choice race_ability_choice1 race_ability_choice1_text race_text"></span>
                        <select class="choice race_ability_choice1" name="comp_race_ability_choice1">
                            <option value="" data-i18n="choose">Choose</option>
                            <option value="strength" data-i18n="strength">Strength</option>
                            <option value="dexterity" data-i18n="dexterity">Dexterity</option>
                            <option value="constitution" data-i18n="constitution">Constitution</option>
                            <option value="intelligence" data-i18n="intelligence">Intelligence</option>
                            <option value="wisdom" data-i18n="wisdom">Wisdom</option>
                            <option value="charisma" data-i18n="charisma">Charisma</option>
                        </select>
                    </label>
                    <div class="choice custom_race race_abilities">
                        <label>
                            <span class="title" data-i18n="strength">Strength:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_strength" value="0" />
                            </div>
                        </label>
                        <label>
                            <span class="title" data-i18n="dexterity">Dexterity:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_dexterity" value="0" />
                            </div>
                        </label>
                        <label>
                            <span class="title" data-i18n="constitution">Constitution:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_constitution" value="0" />
                            </div>
                        </label>
                        <label>
                            <span class="title" data-i18n="intelligence">Intelligence:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_intelligence" value="0" />
                            </div>
                        </label>
                        <label>
                            <span class="title" data-i18n="wisdom">Wisdom:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_wisdom" value="0" />
                            </div>
                        </label>
                        <label>
                            <span class="title" data-i18n="charisma">Charisma:</span>
                            <div class="boxed">
                                <input type="number" name="comp_race_charisma" value="0" />
                            </div>
                        </label>
                    </div>
                </div>
                <div class="choice row race_always custom_race"> <!-- SIZE -->
                    <label>
                        <span class="title" data-18n="size:" >Size:</span>
                        <span class="race_size race_text"></span>
                        <select class="choice custom_race" name="comp_race_custom_size">
                            <option value="fine" data-i18n="fine">Fine</option>
                            <option value="diminutive" data-i18n="diminutive">Diminutive</option>
                            <option value="tiny" data-i18n="tiny">Tiny</option>
                            <option value="small" data-i18n="small">Small</option>
                            <option value="medium" data-i18n="medium" selected="selected">Medium</option>
                            <option value="large" data-i18n="large">Large</option>
                            <option value="huge" data-i18n="huge">Huge</option>
                            <option value="gargantuan" data-i18n="gargantuan">Gargantuan</option>
                            <option value="colossal" data-i18n="colossal">Colossal</option>
                        </select>
                    </label>
                </div>
                <div class="choice row race_always custom_race"> <!-- SPEED -->
                    <label>
                        <span class="title" data-18n="speed:">Speed:</span>
                        <span class="race_speed race_text"></span>
                        <span class="choice custom_race">
                            <input type="number" name="comp_race_custom_speed" value="30" /> ft.
                        </span>
                    </label>
                </div>
                <div class="choice row race_senses_row"> <!-- SENSES -->
                    <label>
                        <span class="title" data-18n="senses:">Senses:</span>
                        <span class="race_senses race_text"></span>
                    </label>
                </div>
                <div class="choice row race_always"> <!-- LANGUAGES -->
                    <label>
                        <span class="title" data-18n="languages:">Languages:</span>
                        <span class="race_languages race_text"></span>
                    </label>
                </div>
                <div class="choice row race_acnotes_row"> <!-- AC -->
                    <label>
                        <span class="title" data-18n="ac-u:">AC:</span>
                        <span class="race_acnotes race_text"></span>
                    </label>
                </div>
                <div class="choice row race_saves_row "> <!-- SAVING THROWS -->
                    <div class="choice race_fortitude_row ">
                        <label>
                            <span class="title" data-18n="fortitude:">Fortitude:</span>
                            <span class="race_fortitude race_text"></span>
                        </label>
                    </div>
                    <div class="choice race_reflex_row ">
                        <label>
                            <span class="title" data-18n="reflex:">Reflex:</span>
                            <span class="race_reflex race_text"></span>
                        </label>
                    </div>
                    <div class="choice race_will_row ">
                        <label>
                            <span class="title" data-18n="will:">Will:</span>
                            <span class="race_will race_text"></span>
                        </label>
                    </div>
                </div>
                <div class="choice row race_skills"> <!-- SKILLS -->
                    <label class="hilite">
                        <span class="title" data-18n="skills-bonus:">Skills Bonus:</span>
                        <select class="choice race_skill_bonus_choice_row" name="comp_race_skill_bonus_choice">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <span class="race_skill_bonus race_text"></span>
                    </label>
                </div>
                <div class="choice row race_feats"> <!-- FEATS -->
                    <label class="hilite">
                        <span class="title" data-18n="bonus-feats:">Bonus Feats:</span>
                        <select class="choice race_feat_choice_row" name="comp_race_feat_choice">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <span class="race_feat_display race_text"></span>
                        <button type="action" name="act_info_race_feat" class="mancer_info">i</button>
                    </label>
                </div>
                <div class="choice row race_spells"> <!-- SPELLS -->
                    <label>
                        <span class="title" data-18n="spell-like-abilities:">Spell-Like Abilities:</span>
                        <span class="race_spell_display race_text"></span>
                    </label>
                </div>
                <div class="choice row race_traits race_text"> <!-- TRAITS -->
                </div>
            </div>
            <div class="row last"></div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page sheet-race-info" accept="Index:Races"></div>
        </div>

            <!-- === NAVIGATION == -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-abilities" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-class" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-race" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-class">
    <div class="charmancer container">

        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step prev"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step here"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step next"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step next"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT == -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
            <!-- <div>
                <span class="choice label class_spellcasting_ability_container"><span class="title" data-18n="class-spellcasting-ability:">Class Spellcasting Ability:</span> <span class="class_spellcasting_ability"></span></span>
            </div> -->
        </div>

        <div class="choices">
            <div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-18n="choose-race">Choose a class:</span>
                        <select name="comp_class" accept="Category:Classes" required>
                            <option value="" data-i18n="choose">Choose</option>
                            <option class="custom" value="Rules:Classes" data-i18n="custom">Custom</option>
                        </select>
                        <button type="action" name="act_info_class" class="mancer_info">i</button>
                        <span class="choice custom_class">All custom class features should be entered manually on the character sheet after the Charactermancer is completed.</span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- alignment -->
                    <label class="hilite">
                        <span class="title" data-18n="alignment:">Alignment:</span>
                        <select class="choice class_alignment_choice" name="comp_class_alignment_choice" required>
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <span class="class_alignment_display class_text"></span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- HD -->
                    <label>
                        <span class="title" data-18n="hit-die:">Hit Die:</span>
                        <span class="class_hit_die class_text"></span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- class skills -->
                    <label>
                        <span class="title" data-18n="class-skills:">Class Skills:</span>
                        <span class="class_class_skills class_text"></span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- skill ranks -->
                    <label>
                        <span class="title" data-18n="skill-ranks:">Skill Ranks:</span>
                        <span class="class_skill_ranks class_text"></span>
                        <span class="class_skill_ranks_total class_text"></span>
                    </label>
                </div>
                <div class="choice row class_skill_bonus_row"> <!-- skill bonus -->
                    <label>
                        <span class="title" data-18n="skills-bonus:">Skills Bonus:</span>
                        <span class="class_skill_bonus class_text"></span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- wealth -->
                    <input type="hidden" name="comp_class_gp" value="0" />
                    <label>
                        <span class="title" data-18n="starting-wealth:">Starting Wealth:</span>
                        <input type="radio" class="sheet-pseudocheck" name="comp_class_wealth" value="starting" checked="checked" /><span></span><span class="class_wealth_starting class_text"></span>
                        <input type="radio" class="sheet-pseudocheck" name="comp_class_wealth" value="average" /><span></span><span class="class_wealth_average class_text"></span>
                        <!-- <input type="radio" name="comp_class_wealth" value="starting" /> Starting
                        <input type="radio" name="comp_class_wealth" value="average" /> Average -->
                    </label>
                    <div class="choice class_wealthroll_display">
                        <div class="flexrow">
                            <button type="roll" class="myrol mancer" name="roll_rollwealth" value="&{template:mancerroll} {{title=Wealth Roll}} {{r1=[[1d0]]}} {{r1name=^{roll}}}">Roll Wealth</button>
                            <span class="class_gp_display class_text"></span>
                        </div>
                    </div>
                </div>
                <div class="choice row class_always"> <!-- BAB -->
                    <label>
                        <span class="title" data-18n="base-attack-bonus:">Base Attack Bonus:</span>
                        <span class="class_bab class_text"></span>
                    </label>
                </div>
                <div class="choice row class_always"> <!-- Saves -->
                    <label class="inl">
                        <span class="title" data-18n="fortitude:">Fortitude:</span>
                        <span class="class_fortitude class_text"></span>
                    </label>
                    <label class="inl">
                        <span class="title" data-18n="reflex:">Reflex:</span>
                        <span class="class_reflex class_text"></span>
                    </label>
                    <label class="inl">
                        <span class="title" data-18n="will:">Will:</span>
                        <span class="class_will class_text"></span>
                    </label>
                </div>
                <div class="choice row class_speed_bonus_row"> <!-- speed bonus -->
                    <label>
                        <span class="title" data-18n="speed-bonus:">Speed Bonus:</span>
                        <span class="class_speed_bonus class_text"></span>
                    </label>
                </div>
                <div class="choice row class_acsecondary_row"> <!-- AC sec ability -->
                    <label>
                        <span class="title" data-18n="ac-secondary-ability:">AC Secondary Ability:</span>
                        <span class="class_acsecondary class_text"></span>
                    </label>
                </div>
                <div class="choice row class_spellcaster_row"> <!-- Spellcaster -->
                    <label class="inl">
                        <span class="title" data-18n="spellcasting-ability:">Spellcasting ability:</span>
                        <span class="class_spellcasting_ability class_text"></span>
                    </label>
                    <label class="inl">
                        <span class="title" data-18n="spellcaster-level:">Spellcaster level:</span>
                        <span class="class_spellcaster_level class_text"></span>
                    </label>
                </div>
                <div class="choice row class_spelllike_row"> <!-- Spell-like abilities -->
                    <label>
                        <span class="title" data-18n="spell-like-abilities:">Spell-Like Abilities:</span>
                        <span class="class_spelllike class_text"></span>
                    </label>
                </div>
                <div class="choice row class_languages_row"> <!-- Languages -->
                    <label>
                        <span class="title" data-18n="languages:">Languages:</span>
                        <span class="class_languages race_text"></span>
                    </label>
                </div>
                <div class="choice row class_bonusfeats_row"> <!-- Bonus Feats -->
                    <label class="hilite">
                        <span class="title" data-18n="bonus-feats:">Bonus Feats:</span>
                        <div class="choice class_feat_choice_row">
                            <select name="comp_class_feat_choice">
                                <option value="" data-i18n="choose">Choose</option>
                            </select>
                            <button type="action" name="act_info_class_feat_choice" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat1_row">
                            <span class="class_feat1 race_text"></span>
                            <button type="action" name="act_info_class_feat1" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat2_row">
                            <span class="class_feat2 race_text"></span>
                            <button type="action" name="act_info_class_feat2" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat3_row">
                            <span class="class_feat3 race_text"></span>
                            <button type="action" name="act_info_class_feat3" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat4_row">
                            <span class="class_feat4 race_text"></span>
                            <button type="action" name="act_info_class_feat4" class="mancer_info">i</button>
                        </div>
                    </label>
                </div>
                <!-- SUBLASSES -->
                <div class="choice row subclass1_row"> <!-- Subclass 1 -->
                    <label class="hilite">
                        <span class="title subclass1_name class_text"></span>
                        <select name="comp_class_subclass1" class="class_subclass1">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_info_subclass1" class="mancer_info">i</button>
                    </label>
                    <div class="choice subclass1_detail">
                        <span class="subclass1_description class_text" style="font-style: italic;"></span>
                        <label class="choice subrow subclass1_abltbonus_row">
                            <span class="title" data-i18n="ability-score-increase">Ability Score Increase:</span>
                            <select name="comp_class_subclass1_ability_choice">
                                <option value="" data-i18n="choose">Choose</option>
                            </select>
                        </label>
                        <label class="choice subrow subclass1_savebonus_row">
                            <span class="title" data-i18n="saving-throws-bonus:">Saving Throws bonus:</span>
                            <span class="subclass1_savebonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_initbonus_row">
                            <span class="title" data-i18n="initiative-bonus:">Initiative Bonus:</span>
                            <span class="subclass1_initbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_speedbonus_row">
                            <span class="title" data-i18n="speed-bonus:">Speed Bonus:</span>
                            <span class="subclass1_speedbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_classkills_row">
                            <span class="title" data-i18n="class-skills:">Class Skills:</span>
                            <span class="subclass1_classkills class_text"></span>
                            <select name="comp_class_subclass1_classkills_choice" class="choice class_subclass1_classkills_choice">
                                    <option value="" data-i18n="choose">Choose</option>
                                    <option value="knowledge_arcana" data-i18n="knowledge_arcana">Knowledge (Arcana)*</option>
                                    <option value="knowledge_dungeoneering" data-i18n="knowledge_dungeoneering">Knowledge (Dungeoneering)*</option>
                                    <option value="knowledge_engineering" data-i18n="knowledge_engineering">Knowledge (Engineering)*</option>
                                    <option value="knowledge_geography" data-i18n="knowledge_geography">Knowledge (Geography)*</option>
                                    <option value="knowledge_history" data-i18n="knowledge_history">Knowledge (History)*</option>
                                    <option value="knowledge_local" data-i18n="knowledge_local">Knowledge (Local)*</option>
                                    <option value="knowledge_nature" data-i18n="knowledge_nature">Knowledge (Nature)*</option>
                                    <option value="knowledge_nobility" data-i18n="knowledge_nobility">Knowledge (Nobility)*</option>
                                    <option value="knowledge_planes" data-i18n="knowledge_planes">Knowledge (Planes)*</option>
                                    <option value="knowledge_religion" data-i18n="knowledge_religion">Knowledge (Religion)*</option>
                            </select>
                        </label>
                        <label class="choice subrow subclass1_skillsbonus_row">
                            <span class="title" data-i18n="skills-bonus:">Skills Bonus:</span>
                            <span class="subclass1_skillsbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_bonusfeat_row">
                            <span class="title" data-i18n="bonus-feats:">Bonus Feats</span>
                            <div>
                                <span class="subclass1_bonusfeat1 class_text"></span>
                                <button type="action" name="act_info_subclass1_feat1" class="mancer_info">i</button>
                            </div>
                            <div class="choice subclass1_bonusfeat2_row">
                                <span class="subclass1_bonusfeat2 class_text"></span>
                                <button type="action" name="act_info_subclass1_feat2" class="mancer_info">i</button>
                            </div>
                        </label>
                        <label class="choice subrow subclass1_domainspell1_row">
                            <span class="title" data-i18n="domaine-spell">Domain Spell</span>
                            <span class="subclass1_domainspell1 class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_traits_row">
                            <span class="title" data-i18n="traits:">Traits:</span>
                            <span class="subclass1_traits class_text"></span>
                        </label>
                        <label class="choice subrow subclass1_powers_row">
                            <span class="title" data-i18n="powers:">Powers:</span>
                            <span class="subclass1_powers class_text"></span>
                        </label>
                    </div>
                </div>
                <div class="choice row subclass2_row"> <!-- Subclass 2 -->
                    <label class="hilite">
                        <span class="title subclass2_name class_text"></span>
                        <select name="comp_class_subclass2" class="class_subclass2">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_info_subclass2" class="mancer_info">i</button>
                    </label>
                    <div class="choice subclass2_detail">
                        <span class="subclass2_description class_text" style="font-style: italic;"></span>
                        <label class="choice subrow subclass2_abltbonus_row">
                            <span class="title" data-i18n="ability-score-increase">Ability Score Increase:</span>
                            <select name="comp_class_subclass2_ability_choice">
                                <option value="" data-i18n="choose">Choose</option>
                            </select>
                        </label>
                        <label class="choice subrow subclass2_savebonus_row">
                            <span class="title" data-i18n="saving-throws-bonus:">Saving Throws bonus:</span>
                            <span class="subclass2_savebonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_initbonus_row">
                            <span class="title" data-i18n="initiative-bonus:">Initiative Bonus:</span>
                            <span class="subclass2_initbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_speedbonus_row">
                            <span class="title" data-i18n="speed-bonus:">Speed Bonus:</span>
                            <span class="subclass2_speedbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_classkills_row">
                            <span class="title" data-i18n="class-skills:">Class Skills:</span>
                            <span class="subclass2_classkills class_text"></span>
                            <select name="comp_class_subclass2_classkills_choice" class="choice class_subclass2_classkills_choice">
                                    <option value="" data-i18n="choose">Choose</option>
                                    <option value="knowledge_arcana" data-i18n="knowledge_arcana">Knowledge (Arcana)*</option>
                                    <option value="knowledge_dungeoneering" data-i18n="knowledge_dungeoneering">Knowledge (Dungeoneering)*</option>
                                    <option value="knowledge_engineering" data-i18n="knowledge_engineering">Knowledge (Engineering)*</option>
                                    <option value="knowledge_geography" data-i18n="knowledge_geography">Knowledge (Geography)*</option>
                                    <option value="knowledge_history" data-i18n="knowledge_history">Knowledge (History)*</option>
                                    <option value="knowledge_local" data-i18n="knowledge_local">Knowledge (Local)*</option>
                                    <option value="knowledge_nature" data-i18n="knowledge_nature">Knowledge (Nature)*</option>
                                    <option value="knowledge_nobility" data-i18n="knowledge_nobility">Knowledge (Nobility)*</option>
                                    <option value="knowledge_planes" data-i18n="knowledge_planes">Knowledge (Planes)*</option>
                                    <option value="knowledge_religion" data-i18n="knowledge_religion">Knowledge (Religion)*</option>
                            </select>
                        </label>
                        <label class="choice subrow subclass2_skillsbonus_row">
                            <span class="title" data-i18n="skills-bonus:":>Skills Bonus:</span>
                            <span class="subclass2_skillsbonus class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_bonusfeat_row">
                            <span class="title" data-i18n="bonus-feats:">Bonus Feats</span>
                            <div>
                                <span class="subclass2_bonusfeat1 class_text"></span>
                                <button type="action" name="act_info_subclass2_feat1" class="mancer_info">i</button>
                            </div>
                            <div class="choice subclass2_bonusfeat2_row">
                                <span class="subclass2_bonusfeat2 class_text"></span>
                                <button type="action" name="act_info_subclass2_feat2" class="mancer_info">i</button>
                            </div>
                        </label>
                        <label class="choice subrow subclass2_domainspell1_row">
                            <span class="title" data-i18n="domaine-spell">Domain Spell</span>
                            <span class="subclass2_domainspell1 class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_traits_row">
                            <span class="title" data-i18n="traits:">Traits:</span>
                            <span class="subclass2_traits class_text"></span>
                        </label>
                        <label class="choice subrow subclass2_powers_row">
                            <span class="title" data-i18n="powers:">Powers:</span>
                            <span class="subclass2_powers class_text"></span>
                        </label>
                    </div>
                </div>
                <div class="choice row class_always class_traits class_text"> <!-- Traits -->
                </div>
                <div class="row last"></div>
            </div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page sheet-class-info" accept="Rules:Classes"></div>
        </div>

        <!-- === NAVIGATION == -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-race" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-skills" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-class" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-skills">
    <div class="charmancer container">

        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step prev"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step prev"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step here"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step next"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT === -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>

        <div class="choices">
            <div class="flexrow">
                <label>
                    <span class="title" data-18n="skill-ranks:">Skill Ranks:</span>
                    <span class="skills_ranks_current skills_text"></span>
                    /
                    <span class="skills_ranks_max skills_text"></span>
                </label>
                <button type="action" class="mancer clear" name="act_clearskillranks"><span data-i18n="clear">Clear</span></button>
            </div>
            <div class="skillsection">
                <div class="skillitem">
                    <span class="lab class_skill" data-i18n="class" data-i18n-title="class-skill" title="Class Skill">Class</span>
                    <span class="lab name_skill" data-i18n="name">Name</span>
                    <span class="lab" data-i18n="ranks">Ranks</span>
                    <span class="lab bonus_skill" data-i18n="mod">Mod</span>
                    <span class="lab bonus_skill" data-i18n="bonus">Bonus</span>
                    <span class="lab total_skill" data-i18n="total">Total</span>
                </div>
                <div class="skillitem">
                    <span class="acrobatics_class class_skill"></span>
                    <span class="name_skill" data-i18n="acrobatics">acrobatics</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_acrobatics_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="acrobatics_bonus bonus_skill"></span>
                    <span class="acrobatics_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="appraise_class class_skill"></span>
                    <span class="name_skill" data-i18n="appraise">appraise</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_appraise_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="appraise_bonus bonus_skill"></span>
                    <span class="appraise_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="bluff_class class_skill"></span>
                    <span class="name_skill" data-i18n="bluff">bluff</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_bluff_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="bluff_bonus bonus_skill"></span>
                    <span class="bluff_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="climb_class class_skill"></span>
                    <span class="name_skill" data-i18n="climb">climb</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_climb_ranks" /><span></span>
                    </div>
                    <span class="mod_strength bonus_skill">0</span>
                    <span class="climb_bonus bonus_skill"></span>
                    <span class="climb_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="craft_class class_skill"></span>
                    <span class="name_skill" data-i18n="craft">craft</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_craft_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="craft_bonus bonus_skill"></span>
                    <span class="craft_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="diplomacy_class class_skill"></span>
                    <span class="name_skill" data-i18n="diplomacy">diplomacy</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_diplomacy_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="diplomacy_bonus bonus_skill"></span>
                    <span class="diplomacy_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="disable_device_class class_skill"></span>
                    <span class="name_skill" data-i18n="disable_device">disable_device</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_disable_device_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="disable_device_bonus bonus_skill"></span>
                    <span class="disable_device_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="disguise_class class_skill"></span>
                    <span class="name_skill" data-i18n="disguise">disguise</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_disguise_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="disguise_bonus bonus_skill"></span>
                    <span class="disguise_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="escape_artist_class class_skill"></span>
                    <span class="name_skill" data-i18n="escape_artist">escape_artist</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_escape_artist_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="escape_artist_bonus bonus_skill"></span>
                    <span class="escape_artist_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="fly_class class_skill"></span>
                    <span class="name_skill" data-i18n="fly">fly</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_fly_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="fly_bonus bonus_skill"></span>
                    <span class="fly_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="handle_animal_class class_skill"></span>
                    <span class="name_skill" data-i18n="handle_animal">handle_animal</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_handle_animal_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="handle_animal_bonus bonus_skill"></span>
                    <span class="handle_animal_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="heal_class class_skill"></span>
                    <span class="name_skill" data-i18n="heal">heal</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_heal_ranks" /><span></span>
                    </div>
                    <span class="mod_wisdom bonus_skill">0</span>
                    <span class="heal_bonus bonus_skill"></span>
                    <span class="heal_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="intimidate_class class_skill"></span>
                    <span class="name_skill" data-i18n="intimidate">intimidate</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_intimidate_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="intimidate_bonus bonus_skill"></span>
                    <span class="intimidate_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_arcana_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_arcana">knowledge_arcana</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_arcana_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_arcana_bonus bonus_skill"></span>
                    <span class="knowledge_arcana_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_dungeoneering_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_dungeoneering">knowledge_dungeoneering</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_dungeoneering_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_dungeoneering_bonus bonus_skill"></span>
                    <span class="knowledge_dungeoneering_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_engineering_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_engineering">knowledge_engineering</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_engineering_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_engineering_bonus bonus_skill"></span>
                    <span class="knowledge_engineering_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_geography_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_geography">knowledge_geography</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_geography_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_geography_bonus bonus_skill"></span>
                    <span class="knowledge_geography_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_history_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_history">knowledge_history</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_history_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_history_bonus bonus_skill"></span>
                    <span class="knowledge_history_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_local_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_local">knowledge_local</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_local_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_local_bonus bonus_skill"></span>
                    <span class="knowledge_local_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_nature_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_nature">knowledge_nature</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_nature_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_nature_bonus bonus_skill"></span>
                    <span class="knowledge_nature_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_nobility_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_nobility">knowledge_nobility</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_nobility_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_nobility_bonus bonus_skill"></span>
                    <span class="knowledge_nobility_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_planes_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_planes">knowledge_planes</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_planes_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_planes_bonus bonus_skill"></span>
                    <span class="knowledge_planes_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="knowledge_religion_class class_skill"></span>
                    <span class="name_skill" data-i18n="knowledge_religion">knowledge_religion</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_knowledge_religion_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="knowledge_religion_bonus bonus_skill"></span>
                    <span class="knowledge_religion_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="linguistics_class class_skill"></span>
                    <span class="name_skill" data-i18n="linguistics">linguistics</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_linguistics_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="linguistics_bonus bonus_skill"></span>
                    <span class="linguistics_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="perception_class class_skill"></span>
                    <span class="name_skill" data-i18n="perception">perception</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_perception_ranks" /><span></span>
                    </div>
                    <span class="mod_wisdom bonus_skill">0</span>
                    <span class="perception_bonus bonus_skill"></span>
                    <span class="perception_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="perform_class class_skill"></span>
                    <span class="name_skill" data-i18n="perform">perform</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_perform_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="perform_bonus bonus_skill"></span>
                    <span class="perform_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="profession_class class_skill"></span>
                    <span class="name_skill" data-i18n="profession">profession</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_profession_ranks" /><span></span>
                    </div>
                    <span class="mod_wisdom bonus_skill">0</span>
                    <span class="profession_bonus bonus_skill"></span>
                    <span class="profession_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="ride_class class_skill"></span>
                    <span class="name_skill" data-i18n="ride">ride</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_ride_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="ride_bonus bonus_skill"></span>
                    <span class="ride_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="sense_motive_class class_skill"></span>
                    <span class="name_skill" data-i18n="sense_motive">sense_motive</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_sense_motive_ranks" /><span></span>
                    </div>
                    <span class="mod_wisdom bonus_skill">0</span>
                    <span class="sense_motive_bonus bonus_skill"></span>
                    <span class="sense_motive_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="sleight_of_hand_class class_skill"></span>
                    <span class="name_skill" data-i18n="sleight_of_hand">sleight_of_hand</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_sleight_of_hand_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="sleight_of_hand_bonus bonus_skill"></span>
                    <span class="sleight_of_hand_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="spellcraft_class class_skill"></span>
                    <span class="name_skill" data-i18n="spellcraft">spellcraft</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_spellcraft_ranks" /><span></span>
                    </div>
                    <span class="mod_intelligence bonus_skill">0</span>
                    <span class="spellcraft_bonus bonus_skill"></span>
                    <span class="spellcraft_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="stealth_class class_skill"></span>
                    <span class="name_skill" data-i18n="stealth">stealth</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_stealth_ranks" /><span></span>
                    </div>
                    <span class="mod_dexterity bonus_skill">0</span>
                    <span class="stealth_bonus bonus_skill"></span>
                    <span class="stealth_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="survival_class class_skill"></span>
                    <span class="name_skill" data-i18n="survival">survival</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_survival_ranks" /><span></span>
                    </div>
                    <span class="mod_wisdom bonus_skill">0</span>
                    <span class="survival_bonus bonus_skill"></span>
                    <span class="survival_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="swim_class class_skill"></span>
                    <span class="name_skill" data-i18n="swim">swim</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_swim_ranks" /><span></span>
                    </div>
                    <span class="mod_strength bonus_skill">0</span>
                    <span class="swim_bonus bonus_skill"></span>
                    <span class="swim_total total_skill">0</span>
                </div>
                <div class="skillitem">
                    <span class="use_magic_device_class class_skill"></span>
                    <span class="name_skill" data-i18n="use_magic_device">use_magic_device</span>
                    <div>
                        <input type="checkbox" class="pseudocheck" value="1" name="comp_use_magic_device_ranks" /><span></span>
                    </div>
                    <span class="mod_charisma bonus_skill">0</span>
                    <span class="use_magic_device_bonus bonus_skill"></span>
                    <span class="use_magic_device_total total_skill">0</span>
                </div>
            </div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page sheet-class-info" accept="Acquiring Skills"></div>
        </div>

        <!-- === NAVIGATION === -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-class" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-feats" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-skills" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-feats">
    <div class="charmancer container">

        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step prev"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step prev"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step prev"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step here"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step next"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT == -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>

        <div class="choices">
            <div>
                <div class="row">
                    <label class="hilite">
                        <span class="title" data-18n="choose-feat">Choose a Feat:</span>
                        <select name="comp_feat_lvl1_1" class="choice feat_lvl1_1" required>
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_info_feat_lvl1_1" class="mancer_info">i</button>
                    </label>
                </div>
                <div class="choice row race_feats"> <!-- Race Feats -->
                    <label>
                        <span class="title" data-18n="race">Race</span>
                        <span class="title" data-18n="bonus-feats:">Bonus Feats:</span>
                        <span class="race_feat_display race_text"></span>
                        <button type="action" name="act_info_race_feat" class="mancer_info">i</button>
                    </label>
                </div>
                <div class="choice row class_bonusfeats_row"> <!-- Class Feats -->
                    <label>
                        <span class="title" data-18n="class">Class</span>
                        <span class="title" data-18n="bonus-feats:">Bonus Feats:</span>
                        <div class="choice class_feat_choice_row">
                            <span class="class_feat_choice_display class_text"></span>
                            <button type="action" name="act_info_class_feat_choice" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat1_row">
                            <span class="class_feat1 race_text"></span>
                            <button type="action" name="act_info_class_feat1" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat2_row">
                            <span class="class_feat2 race_text"></span>
                            <button type="action" name="act_info_class_feat2" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat3_row">
                            <span class="class_feat3 race_text"></span>
                            <button type="action" name="act_info_class_feat3" class="mancer_info">i</button>
                        </div>
                        <div class="choice class_feat4_row">
                            <span class="class_feat4 race_text"></span>
                            <button type="action" name="act_info_class_feat4" class="mancer_info">i</button>
                        </div>
                    </label>
                </div>
                <div class="choice row subclass_feats_row"> <!-- Subclass Feats -->
                    <label class="choice subclass1_bonusfeat_row"> <!-- Subclass 1 -->
                        <span class="title subclass1_name class_text"></span>
                        <span class="title" data-i18n="bonus-feats:">Bonus Feats:</span>
                        <div>
                            <span class="subclass1_bonusfeat1 class_text"></span>
                            <button type="action" name="act_info_subclass1_feat1" class="mancer_info">i</button>
                        </div>
                        <div class="choice subclass1_bonusfeat2_row">
                            <span class="subclass1_bonusfeat2 class_text"></span>
                            <button type="action" name="act_info_subclass1_feat2" class="mancer_info">i</button>
                        </div>
                    </label>
                    <label class="choice subclass2_bonusfeat_row"> <!-- Subclass 2 -->
                            <span class="title subclass2_name class_text"></span>
                            <span class="title" data-i18n="bonus-feats:">Bonus Feats:</span>
                            <div>
                                <span class="subclass2_bonusfeat1 class_text"></span>
                                <button type="action" name="act_info_subclass2_feat1" class="mancer_info">i</button>
                            </div>
                            <div class="choice subclass2_bonusfeat2_row">
                                <span class="subclass2_bonusfeat2 class_text"></span>
                                <button type="action" name="act_info_subclass2_feat2" class="mancer_info">i</button>
                            </div>
                    </label>
                </div>
                <div class="row last"></div>
            </div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page sheet-feats-info sheet-race-info sheet-class-info" accept="Rules:Feats"></div>
        </div>

        <!-- === NAVIGATION == -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-skills" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-spells" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-feats" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-spells">
    <div class="charmancer container">

        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step prev"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step prev"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step prev"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step prev"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step here"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step next"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT === -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>

        <div class="choices">
            <input type="hidden" name="comp_spellcaster" value="" />
            <label>
                <span class="title spells_nospell"></span>
            </label>
            <div class="choice spells_spells">
                <div class="choice row spells_level_0">
                    <label class="hilite">
                        <span class="title" data-18n="0-level-spells">0-Level Spells</span>
                    </label>
                    <label class="choice subrow spells_level_0_1_row">
                        <select name="comp_spells_level_0_1" class="spells_level_0_1">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_1" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_0_2_row">
                        <select name="comp_spells_level_0_2" class="spells_level_0_2">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_2" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_0_3_row">
                        <select name="comp_spells_level_0_3" class="spells_level_0_3">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_3" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_0_4_row">
                        <select name="comp_spells_level_0_4" class="spells_level_0_4">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_4" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_0_5_row">
                        <select name="comp_spells_level_0_5" class="spells_level_0_5">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_5" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_0_6_row">
                        <select name="comp_spells_level_0_6" class="spells_level_0_6">
                            <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_0_6" class="mancer_info">i</button>
                    </label>
                </div>
                <div class="choice row spells_level_1">
                    <label class="hilite">
                        <span class="title" data-18n="1st-level-spells">1st-Level Spells</span>
                    </label>
                    <label class="choice subrow spells_level_1_1_row">
                        <select name="comp_spells_level_1_1" class="spells_level_1_1">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_1" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_1_2_row">
                        <select name="comp_spells_level_1_2" class="spells_level_1_2">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_2" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_1_3_row">
                        <select name="comp_spells_level_1_3" class="spells_level_1_3">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_3" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_1_4_row">
                        <select name="comp_spells_level_1_4" class="spells_level_1_4">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_4" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_1_5_row">
                        <select name="comp_spells_level_1_5" class="spells_level_1_5">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_5" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_level_1_6_row">
                        <select name="comp_spells_level_1_6" class="spells_level_1_6">
                                <option value="" data-i18n="choose">Choose</option>
                        </select>
                        <button type="action" name="act_spells_level_1_6" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_domainspell1_row">
                        <span class="title spells_domain1"></span>
                        <span class="spells_domainspell1"></span>
                        <button type="action" name="act_spells_domainspell1" class="mancer_info">i</button>
                    </label>
                    <label class="choice subrow spells_domainspell2_row">
                        <span class="title spells_domain2"></span>
                        <span class="spells_domainspell2"></span>
                        <button type="action" name="act_spells_domainspell2" class="mancer_info">i</button>
                    </label>
                </div>
                <div class="row"></div>
            </div>
        </div>

        <div class="info">
            <div class="sheet-compendium-page sheet-spells-info" accept="Rules:Spell"></div>
        </div>

        <!-- === NAVIGATION === -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-feats" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next"><button type="back" value="l1-summary" data-18n="next">Next</button></div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" data-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-spells" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-l1-summary">
    <div class="charmancer container">

        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>
        <div class="steps">
            <div class="step prev"><button type="back" value="l1-welcome" data-i18n="start">Start</button></div>
            <div class="step prev"><button type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>
            <div class="step prev"><button type="back" value="l1-race" data-i18n="race">Race</button></div>
            <div class="step prev"><button type="back" value="l1-class" data-i18n="class">Class</button></div>
            <div class="step prev"><button type="back" value="l1-skills" data-i18n="skills">Skills</button></div>
            <div class="step prev"><button type="back" value="l1-feats" data-i18n="feats">Feats</button></div>
            <div class="step prev"><button type="back" value="l1-spells" data-i18n="spells">Spells</button></div>
            <div class="step here"><button type="back" value="l1-summary" data-i18n="review">Review</button></div>
            <div class="step cancel"><button type="action" name="act_cancel" data-i18n="cancel">Cancel</button></div>
        </div>

        <!-- === CONTENT === -->
        <div class="topbar">
            <div class="sheet-attr-container">
                <h4 data-i18n="strength">Strength</h4>
                <div class="boxed greybg">
                    <span class="strength_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="dexterity">Dexterity</h4>
                <div class="boxed greybg">
                    <span class="dexterity_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="constitution">Constitution</h4>
                <div class="boxed greybg">
                    <span class="constitution_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="intelligence">Intelligence</h4>
                <div class="boxed greybg">
                    <span class="intelligence_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="wisdom">Wisdom</h4>
                <div class="boxed greybg">
                    <span class="wisdom_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="charisma">Charisma</h4>
                <div class="boxed greybg">
                    <span class="charisma_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-i18n="fortitude">Fortitude</h4>
                <div class="boxed greybg">
                    <span class="fortitude_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="reflex">Reflex</h4>
                <div class="boxed greybg">
                    <span class="reflex_total">-</span>
                </div>
            </div>
            <div class="sheet-attr-container">
                <h4 data-i18n="will">Will</h4>
                <div class="boxed greybg">
                    <span class="will_total">-</span>
                </div>
            </div>
            <span class="separator"></span>
            <div class="sheet-attr-container">
                <h4 data-18n="hit-points">Hit Points</h4>
                <div class="boxed greybg">
                    <span class="hit_points">-</span>
                </div>
            </div>
        </div>

        <div class="summary" style="width: 100%;">
            <span class="choice summary_text sum_sum"></span>
            <span class="choice summary_text red req sum_req_sum"></span>
            <label class="subrow"> <!-- Abilities -->
                <span class="title" data-18n="abilities">Abilities</span>
                <div class="choice summary_text sum_abilities"></div>
                <div class="choice summary_text red req sum_req_abilities"></div>
                <div class="choice summary_text red sum_err_abilities"></div>
            </label>
            <label class="subrow">  <!-- Race -->
                <span class="title" data-18n="race">Race</span>
                <div class="choice summary_text sum_race"></div>
                <div class="choice summary_text red req sum_req_race"></div>
                <div class="choice summary_text red sum_err_race"></div>
            </label>
            <label class="subrow"> <!-- Class -->
                <span class="title" data-18n="class">Class</span>
                <div class="choice summary_text sum_class"></div>
                <div class="choice summary_text red req sum_req_class"></div>
                <div class="choice summary_text red sum_err_class"></div>
            </label>
            <label class="subrow"> <!-- Skills -->
                <span class="title" data-18n="skills">Skills</span>
                <div class="choice summary_text sum_skills"></div>
                <div class="choice summary_text red req sum_req_skills"></div>
                <div class="choice summary_text red sum_err_skills"></div>
            </label>
            <label class="subrow"> <!-- Feats -->
                <span class="title" data-18n="feats">Feats</span>
                <div class="choice summary_text sum_feats"></div>
                <div class="choice summary_text red req sum_req_feats"></div>
                <div class="choice summary_text red sum_err_feats"></div>
            </label>
            <label class="subrow"> <!-- Spells -->
                <span class="title" data-18n="spells">Spells</span>
                <div class="choice summary_text sum_spells"></div>
                <div class="choice summary_text red req sum_req_spells"></div>
                <div class="choice summary_text red sum_err_spells"></div>
            </label>
        </div>

        <!-- === NAVIGATION === -->
        <div class="bottombar">
            <div class="nav back"><button type="back" value="l1-spells" data-18n="back">Back</button></div>
            <div class="nav cancel"><button type="action" name="act_cancel" data-18n="cancel">Cancel</button></div>
            <div class="nav next">
                <input type="hidden" class="apply" name="comp_mancer_apply" value="0" />
                <button class="apply" type="finish" value="l1-mancer" data-18n="apply">Apply</button>
                <button class="apply not" data-18n="apply">Apply</button>
            </div>
        </div>
        <div class="choice cancel-prompt">
            <p class="label" data-18n="mancer-cancel-question">Which Path to follow, Adventurer?</p>
            <div class="step cancel"><button type="cancel" value="l1-cancel" sdata-i18n="discard-and-exit">Discard and exit</button></div>
            <div class="step done"><button type="cancel" value="l1-summary" data-i18n="save-and-exit">Save and Exit</button></div>
            <div class="step here"><button type="action" name="act_continue" data-i18n="mancer-continue">Continue Charactermancer</button></div>
            <p class="warning" data-18n="mancer-warning">Discard and Exit will cause all choices to be lost.</p>
        </div>
    </div>
</charmancer>
<charmancer class="sheet-charmancer-final">
    <div class="charmancer">
        <!-- === NAVIGATION == -->
        <div class="logos">
            <img class="logo pf" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/pathfinderlogo_small.png" />
            <img class="logo cm" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/charactermancer_small.png" />
            <img class="logo r20" src="https://raw.githubusercontent.com/NathaTerrien/roll20-wip/master/_tests/roll20logo_small.png" />
        </div>

        <div class="steps center">
            <div class="step here">
                <span>Building your character...</span>
            </div>
        </div>

        <div style="text-align: center;">
            <h5><span class="mancer_category"></span></h5>
        </div>

        <div>
            <span class="mancer_progress"></span> <!-- <div style="width: 100%"></div> -->
        </div>

        <input type="hidden" name="attr_mancer_category">
        <input type="hidden" name="attr_mancer_progress">
    </div>
</charmancer>

<!-- Mancer Templates -->
<rolltemplate class="sheet-rolltemplate-mancerroll">
    <div class="charname smallname bold">{{title}}</div>
    <div class="bordered">
        {{#r1}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r1name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r1}}
                <div class="spacer"></div>
            </div>
        {{/r1}}
        {{#r2}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r2name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r2}}
                <div class="spacer"></div>
            </div>
        {{/r2}}
        {{#r3}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r3name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r3}}
                <div class="spacer"></div>
            </div>
        {{/r3}}
        {{#r4}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r4name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r4}}
                <div class="spacer"></div>
            </div>
        {{/r4}}
        {{#r5}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r5name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r5}}
                <div class="spacer"></div>
            </div>
        {{/r5}}
        {{#r6}}
            <div class="flexatk">
                <div class="blacklabel med">
                    <span>{{r6name}}</span>
                    <img class="brdright" src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Pathfinder%20Official/img/brdright.png" />
                </div>
                {{r6}}
                <div class="spacer"></div>
            </div>
        {{/r6}}
    </div>
</rolltemplate>

<!-- Mancer Workers -->
<script type="text/worker">
    const mncrDebugMode = false;

    const mncrAbilities = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
    const mncrGetList = true;
    const mncrCostOfScore = {"7":"-4","8":"-2","9":"-1","10":"0","11":"1","12":"2","13":"3","14":"5","15":"7","16":"10","17":"13","18":"17"};
    const mncrDicepoolChoices = ["3","4","5","6","7","8", "9", "10", "11", "12", "13"];

    // === ABILITIES ===
    on("page:l1-abilities", () => {
        recalcData("abilities");
    });
    on("mancerchange:abilities", (eventinfo) => {
        var data = getCharmancerData();
        var initHide = ["abilities_possible"];
        var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
        var pointbuyChoices = ["7","8", "9", "10", "11", "12", "13", "14", "15","16","17","18"];
        var pointbuysPoints = {"purchase_low":10,"purchase_standard":15,"purchase_high":20,"purchase_epic":25};

        hideChoices(initHide);
        recalcData("abilities");

        if (["standard","classic","heroic"].includes(data["l1-abilities"].values.abilities)) {
            showChoices(["abilities_" + data["l1-abilities"].values.abilities]);
            if (data["l1-abilities"].values.roll_results && data["l1-abilities"].values.roll_results.length) {
                showChoices(["abilities_selects"]);
                var roll_results = typeof data["l1-abilities"].values.roll_results == "string" ? data["l1-abilities"].values.roll_results.split(",") : data["l1-abilities"].values.roll_results;
                _.each(attribs, (attrib) => {
                    setCharmancerOptions(attrib, roll_results);
                });
            }
        }
        if (["purchase_low","purchase_standard","purchase_high","purchase_epic"].includes(eventinfo.newValue || "")) {
            setAttrs({"pointbuy_points": pointbuysPoints[eventinfo.newValue]  || "15","max_pointbuy_points":pointbuysPoints[eventinfo.newValue] || "15"}, () => {
                showChoices(["abilities_pointbuy", "abilities_selects"]);
                setCharmancerText({"points_available_display":pointbuysPoints[eventinfo.newValue] || "15","max_points_available_display": pointbuysPoints[eventinfo.newValue] || "15"});
                _.each(attribs, (attrib) => {
                    setCharmancerOptions(attrib, pointbuyChoices);
                });
            });
        }
        if (["purchase_low","dicepool_24","dicepool_28"].includes(eventinfo.newValue || "")) {
            var pool = eventinfo.newValue.slice(-2) || "24";
            setAttrs({"dicepool":pool,"max_dicepool":pool}, () => {
                showChoices(["abilities_dicepool"]);
                setCharmancerText({"dicepool_display":pool,"max_dicepool_display":pool});
                _.each(attribs, (attrib) => {
                    setCharmancerOptions(attrib + "d6", mncrDicepoolChoices);
                });
            });
        }
        if (data["l1-abilities"].values.abilities == "custom") {
            showChoices(["abilities_custom"]);
        }

        reset = {};
        if (eventinfo.sourceType == "player") {
            _.each(attribs, (attrib) => {
                reset[attrib] = "";
            });
            reset["pointbuy_points"] = "15"
        }
        recalcData("abilities");
        setAttrs(reset);
    });
    on("mancerchange:strength mancerchange:dexterity mancerchange:constitution mancerchange:intelligence mancerchange:wisdom mancerchange:charisma", (eventinfo) => {
        data = getCharmancerData();
        var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
        var clearvalues = [
            data["l1-abilities"].values.strength,
            data["l1-abilities"].values.dexterity,
            data["l1-abilities"].values.constitution,
            data["l1-abilities"].values.intelligence,
            data["l1-abilities"].values.wisdom,
            data["l1-abilities"].values.charisma];
        var purchases = ["purchase_low","purchase_standard","purchase_high","purchase_epic"];
        var clearvalue = eventinfo.newValue;

        if (!(data["l1-abilities"].values.abilities == "custom"
             || purchases.includes(data["l1-abilities"].values.abilities))) {
            var clearObject = {};
            attribs = attribs.filter(item => item != eventinfo.triggerName);
            _.each(attribs, (attrib) => {
                if (clearvalue == data["l1-abilities"].values[attrib]) {
                    clearObject[attrib] = "";
                }
            });
        }

        if (purchases.includes(data["l1-abilities"].values.abilities)) {
            recalcPoints();
        }

        if (eventinfo.sourceType == "player") {
            setAttrs(clearObject,{silent: true}, () => {
                recalcData("abilities");
            });
        } else {
            recalcData("abilities");
        }
    });
    on("mancerchange:strengthd6 mancerchange:dexterityd6 mancerchange:constitutiond6 mancerchange:intelligenced6 mancerchange:wisdomd6 mancerchange:charismad6", (eventinfo) => {
        data = getCharmancerData();
        var attribs = ["strengthd6","dexterityd6","constitutiond6","intelligenced6","wisdomd6","charismad6"];
        var maxPoints = parseInt(data["l1-abilities"].values["max_dicepool"]) || 0;
        var pointsAvailable = maxPoints;
        var scores = {};
        var button = "&{template:mancerroll} {{title=Ability Scores Rolls: Dice Pool}} {{r1=Not set}} {{r2=Not set}} {{r3=Not set}} {{r4=Not set}} {{r5=Not set}} {{r6=Not set}} {{r1name=^{strength}}} {{r2name=^{dexterity}}} {{r3name=^{constitution}}} {{r4name=^{intelligence}}} {{r5name=^{wisdom}}} {{r6name=^{charisma}}}";
        var i=1;

        // Decrement dice pool based on selected attribs
        _.each(attribs, (attrib) => {
            var dice = (parseInt(data["l1-abilities"].values[attrib]) || 0);
            pointsAvailable -= dice;
            if(dice > 0) {
                button = button.replace("{{r" + i + "=Not set}}","{{r"+i+"=[[" + dice + "d6kh3]]}}");
            }
            i++;
        });

        // Disable options if points are below a threshold.
        var choicesToDisable = [];
        _.each(mncrDicepoolChoices, (dice) => {
            if((parseInt(dice) || -99) > pointsAvailable) {
                // console.log("*** DEBUG recalcPoints score / cost: " + score + " / " + cost);
                choicesToDisable.push(dice);
            }
        });
        // console.log("*** DEBUG recalcPoints choicesToDisable: " + choicesToDisable);
        if (choicesToDisable.length > 0) {
            _.each(attribs, (attrib) => {
                disableCharmancerOptions(attrib, choicesToDisable);
            });
        } else {
            _.each(attribs, (attrib) => {
                disableCharmancerOptions(attrib, []);
            });
        }

        setCharmancerText({"dicepool_display":String(pointsAvailable)});

        setAttrs({dicepool:String(pointsAvailable),"roll_rollstatsd6":button});
    });
    on("mancerroll:rollstats", (eventinfo) => {
        var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
        var results = [];
        var i = 1;
        // console.log("*** DEBUG mancerroll:rollstats: " + JSON.stringify(eventinfo,null,"  "));
        _.each(eventinfo.roll, (roll) => {
            results.push(roll.result + "~" + i);
            i++;
        });
        results.sort((a,b) => {return Number(a.split("~")[0]) - Number(b.split("~")[0])});
        _.each(attribs, (attrib) => {
            setCharmancerOptions(attrib, results);
        });
        setAttrs({roll_results: results, strength: "", dexterity: "", constitution: "", intelligence: "", wisdom: "", charisma: ""});
        showChoices(["abilities_selects"]);
    });
    on("mancerroll:rollstatsd6", (eventinfo) => {
        if(eventinfo.roll.length == 6) {
            var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
            var update = {};
            var i = 0;
            // console.log("*** DEBUG mancerroll:rollstatsd6: " + JSON.stringify(eventinfo,null,"  "));
            _.each(eventinfo.roll, (roll) => {
                update[attribs[i]] = roll.result;
                i++;
            });
            setAttrs(update, () => {
                recalcData("abilities");
            });
        }
    });
    on("clicked:clearstats", (eventinfo) => {
        var data = getCharmancerData();
        var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma","strengthd6","dexterityd6","constitutiond6","intelligenced6","wisdomd6","charismad6"];
        reset = {};
        _.each(attribs, (attrib) => {
            reset[attrib] = "";
            disableCharmancerOptions(attrib, []);
        });
        setAttrs(reset);
    });
    const handleAbilities = function(data, section) {
        var showList = [];
        if(data["data-Ability Score Choice"]) {
            showList.push(section + "_ability_choice1");
            if(data["data-Ability Score Choice"].split("+")[0] == "2") {
                showList.push(section + "_ability_choice2");
            }
        };
        return showList;
    };
    const recalcPoints = function() {
        data = getCharmancerData();
        var attribs = ["strength","dexterity","constitution","intelligence","wisdom","charisma"];
        var maxPoints = parseInt(data["l1-abilities"].values["max_pointbuy_points"]) || 0;
        var pointsAvailable = maxPoints;
        var scores = {};

        _.each(attribs, (attrib) => {
            scores[attrib] = (parseInt(data["l1-abilities"].values[attrib]) || 10);
        });

        // Decrement points based on selected attribs
        _.each(scores, (score) => {
            pointsAvailable -= (parseInt(mncrCostOfScore[score]) || 0);
        });

        // Disable options if points are below a threshold.
        var choicesToDisable = [];
        _.each(mncrCostOfScore, (cost, score) => {
            if((parseInt(cost) || -99) > pointsAvailable) {
                // console.log("*** DEBUG recalcPoints score / cost: " + score + " / " + cost);
                choicesToDisable.push(score);
            }
        });
        // console.log("*** DEBUG recalcPoints choicesToDisable: " + choicesToDisable);
        if (choicesToDisable.length > 0) {
            _.each(attribs, (attrib) => {
                disableCharmancerOptions(attrib, choicesToDisable);
            });
        } else {
            _.each(attribs, (attrib) => {
                disableCharmancerOptions(attrib, []);
            });
        }

        setCharmancerText({"points_available_display":String(pointsAvailable)});

        setAttrs({pointbuy_points:String(pointsAvailable)});
    };

    // === RACE ===
    on("page:l1-race", () => {
        recalcData("race");
    });
    on("mancerchange:race", (eventinfo) => {
        hideChoices();

        var reset = {};
        if(!(eventinfo.newValue === "" || eventinfo.newValue === undefined)) {
            // showChoices(["race_options"]);
            changeCompendiumPage("sheet-race-info", eventinfo.newValue);
        } else {
            changeCompendiumPage("sheet-race-info", "Index:Races");
        }

        if(eventinfo.sourceType == "player") {
            reset = {race_name: "", race_ability_choice1: "", race_skill_bonus_choice: "", race_feat_choice: "", race_custom_name: "", race_strength:0, race_dexterity: 0, race_constitution:0, race_intelligence:0, race_wisdom:0, race_charisma:0, race_custom_size: "medium", race_custom_speed:30};
        }

        if(eventinfo.newValue === "Index:Races") {
            //Clears saved data for this field
            getCompendiumPage("");
            setAttrs(reset, () => {
                var update = {"race_text": ""};
                showChoices(["custom_race"]);
                setCharmancerText(update);
                recalcData("race");
            });
        } else {
            getCompendiumPage(eventinfo.newValue, mncrGetList, (p) => {
                setAttrs(reset, () => {
                    var mancerdata = getCharmancerData();
                    var update = {};
                    var showList = [];
                    var possibles = ["race_ability_score", "race_size", "race_speed", "race_senses", "race_languages", "race_acnotes", "race_fortitude", "race_reflex", "race_will", "race_skill_bonus", "race_skill_bonus_choice", "race_feat_display", "race_spell_display", "race_traits"];
                    var data = p["data"];
                    var abilities_scores = calc_abilities(mancerdata);

                    if(mncrDebugMode) {console.log("*** DEBUG race raw data:" + JSON.stringify(data,null,"  "));}

                    if(!(eventinfo.newValue === "" || eventinfo.newValue === undefined)) {
                        showList.push("race_always");
                    }

                   _.each(possibles, (key) => {
                        update[key] = "";
                    });

                    showList = showList.concat(handleAbilities(data, "race"));
                    if(data["data-Ability Score Modifiers"]) {
                       update["race_ability_score"] = data["data-Ability Score Modifiers"];
                    }
                    if(data["data-Ability Score Choice"]) {
                        update["race_ability_choice1_text"] = "+" + (data["data-Ability Score Choice"].split("+")[1] || "0") + " " + getTranslationByKey("to:");
                    }

                    if(data["data-Size"]) {update["race_size"] = data["data-Size"];};
                    if(data["data-Race Speed"]) {
                        update["race_speed"] = data["data-Race Speed"];
                        if(data["data-Speed Not Modified"] && data["data-Speed Not Modified"] == "true") {
                            update["race_speed"] += ", " + getTranslationByKey("speed-never-modified").toLowerCase();
                        }
                    };
                    if(data["data-Senses"]) {
                        update["race_senses"] = data["data-Senses"];
                        showList.push("race_senses_row");
                    };
                    if(data["data-Languages"]) {
                        update["race_languages"] = data["data-Languages"];
                    };
                    if(data["data-AC Notes"]) {
                        update["race_acnotes"] = data["data-AC Notes"];
                        showList.push("race_acnotes_row");
                    };

                    if(data["data-Fortitude Bonus"] || data["data-Fortitude Notes"]) {
                        if(!showList["race_saves_row"]) {
                            showList.push("race_saves_row");
                        }
                        showList.push("race_fortitude_row");
                        update["race_fortitude"] = "";
                        if(data["data-Fortitude Bonus"]) {
                            update["race_fortitude"] += "+ " + data["data-Fortitude Bonus"];
                        }
                        if(data["data-Fortitude Notes"]) {
                            update["race_fortitude"] += (update["race_fortitude"].length > 0 ? ", " : "") + data["data-Fortitude Notes"];
                        }
                    }
                    if(data["data-Reflex Bonus"] || data["data-Reflex Notes"]) {
                        if(!showList["race_saves_row"]) {
                            showList.push("race_saves_row");
                        }
                        showList.push("race_reflex_row");
                        update["race_reflex"] = "";
                        if(data["data-Reflex Bonus"]) {
                            update["race_reflex"] += "+ " + data["data-Reflex Bonus"];
                        }
                        if(data["data-Reflex Notes"]) {
                            update["race_reflex"] += (update["race_reflex"].length > 0 ? ", " : "") + data["data-Reflex Notes"];
                        }
                    }
                    if(data["data-Will Bonus"] || data["data-Will Notes"]) {
                        if(!showList["race_saves_row"]) {
                            showList.push("race_saves_row");
                        }
                        showList.push("race_will_row");
                        update["race_will"] = "";
                        if(data["data-Will Bonus"]) {
                            update["race_will"] += "+ " + data["data-Will Bonus"];
                        }
                        if(data["data-Will Notes"]) {
                            update["race_will"] += (update["race_will"].length > 0 ? ", " : "") + data["data-Will Notes"];
                        }
                    }

                    if(data["data-Skills Bonus"] || data["data-Skills Bonus Choice"]  || data["data-Skill Notes"]) {
                        if(!showList["race_skills"]) {
                            showList.push("race_skills");
                        }
                        var skl = "";
                        if(data["data-Skills Bonus Choice"]) {
                            var skillChoices = [];
                            _.each(data["data-Skills Bonus Choice"].split(","), (achoice) => {
                                if(achoice.trim().length > 0) {
                                    skillChoices.push(achoice.trim());
                                }
                            });
                            if(skillChoices.length) {
                                showList.push("race_skill_bonus_choice_row");
                                setCharmancerOptions("race_skill_bonus_choice", skillChoices);
                            }
                        }
                        if(data["data-Skills Bonus"]) {
                            skl += " " + (data["data-Skills Bonus"] || "");
                        }
                        if(data["data-Skill Notes"]) {
                            skl += " " + (data["data-Skill Notes"] || "");
                        }
                        // console.log("*** DEBUG race_skill_bonus :" + skl);
                        if(skl.length > 0) {
                            update["race_skill_bonus"] = skl.trim();
                        }
                    }

                    if(data["data-Feats"]) {
                        if(!showList["race_feats"]) {
                            showList.push("race_feats");
                        }
                        if(data["data-Feats"] === "Any") {
                            if(!showList["race_feat_choice_row"]) {
                                showList.push("race_feat_choice_row");
                            }
                            setCharmancerOptions("race_feat_choice", "Category:Feats",{"category": "Feats"},() => {
                                disableCharmancerOptions("race_feat_choice",get_feats(mancerdata));
                            });
                        } else {
                            update["race_feat_display"] = data["data-Feats"];
                        }
                    }

                    if(data["data-Spell-like abilities"]) {
                        var spltxt = "";
                        if(data["data-Spell-like abilities prerequisites"]) {
                            var ablt = (data["data-Spell-like abilities prerequisites"].split(" ")[0] || "").trim().toLowerCase();
                            var minv = parseInt((data["data-Spell-like abilities prerequisites"].split(" ")[1] || "").trim().toLowerCase()) || 99;
                            // console.log(" *** DEBUG Spell-like: " + ablt + " >= " + minv);
                            if( (parseInt(abilities_scores[ablt].total) || 0) >= minv )  {
                                spltxt = data["data-Spell-like abilities"];
                            }
                        } else {
                            spltxt = data["data-Spell-like abilities"];
                        }
                        if(spltxt.length) {
                            if(!showList["race_spells"]) {
                                showList.push("race_spells");
                            }
                            update["race_spell_display"] = spltxt;
                        }
                    }

                    if(data["data-Traits"]) {
                        var traits_final = "";
                        let tmp = data["data-Traits"].replace(/=&gt;/gi,":");
                        var json = JSON.parse(tmp);
                        _.each(json, (t, i) => {
                            if(t["Name"] && t["Description"]) {
                                traits_final = traits_final + "<b>" + t["Name"] + "</b> " + t["Description"];
                                // + "<br>";
                            };
                        });
                        if(traits_final.length) {
                            showList.push("race_traits");
                            update["race_traits"] = traits_final;
                        }
                    };

                    setCharmancerText(update);
                    showChoices(showList);
                    recalcData("race");
                });
            });
        }
    });
    on("clicked:info_race", (eventinfo) => {
        var data = getCharmancerData();
        var race = data["l1-race"] && data["l1-race"].values.race ? data["l1-race"].values.race : "Index:Races";
        changeCompendiumPage("sheet-race-info", race);
    });
    on("mancerchange:race_ability_choice1", (eventinfo) => {
        if(eventinfo.sourceType == "player") {
            recalcData("race");
        }
    });
    on("mancerchange:race_strength mancerchange:race_dexterity mancerchange:race_constitution mancerchange:race_intelligence mancerchange:race_wisdom mancerchange:race_charisma", (eventinfo) => {
        if(eventinfo.sourceType == "player") {
            recalcData("race");
        }
    });
    on("mancerchange:race_feat_choice", (eventinfo) => {
        if(eventinfo.sourceType == "player") {
            if((eventinfo.newValue || "").length) {
                changeCompendiumPage("sheet-race-info", eventinfo.newValue);
            }
        }
    });
    on("clicked:info_race_feat", (eventinfo) => {
        var data = getCharmancerData();
        if (data["l1-race"] && data["l1-race"].data && data["l1-race"].data.race && data["l1-race"].data.race["data-Feats"]) {
            if(data["l1-race"].data.race["data-Feats"] !== "Any") {
                changeCompendiumPage("sheet-race-info", data["l1-race"].data.race["data-Feats"]);
                return;
            }
        }
        if(data["l1-race"] && data["l1-race"].values.race_feat_choice) {
            changeCompendiumPage("sheet-race-info", data["l1-race"].values.race_feat_choice); // ??? "Feats:" + data["l1-race"].values.race_feat_choice
            return;
        }
    });

    // === CLASS ===
    on("page:l1-class", () => {
        recalcData("class");
    });
    on("mancerchange:class", (eventinfo) => {
        hideChoices();
        recalcData("class");

        var reset = {};

        if(!(eventinfo.newValue === "" || eventinfo.newValue === undefined)) {
            // showChoices(["class_options"]);
            changeCompendiumPage("sheet-class-info", eventinfo.newValue);
        } else {
            changeCompendiumPage("sheet-class-info", "Rules:Classes");
        }

        if(eventinfo.sourceType == "player") {
            reset = {class_name: "", class_alignment_choice: "", class_wealth: "starting", class_gp: 0, class_feat_choice: "", class_subclass1: "", class_subclass2: ""};
            deleteCharmancerData(["l1-skills","l1-spells"], () => {
                update_class(eventinfo,reset);
            });
        } else {
            update_class(eventinfo,reset);
        }
    });
    on("clicked:info_class", (eventinfo) => {
        var data = getCharmancerData();
        var race = data["l1-class"] && data["l1-class"].values.class ? data["l1-class"].values.class : "Rules:Classes";
        changeCompendiumPage("sheet-class-info", race);
    });
    on("mancerchange:class_wealth", (eventinfo) => {
            // console.log("*** DEBUG mancerchange:class_wealth: " + JSON.stringify(eventinfo,null,"  "));
            var mancerdata = getCharmancerData();
            var values = {};
            var update = {};
            var choices = ["class_wealthroll_display"];
            var gp = 0;
            if(eventinfo.newValue && eventinfo.newValue == "average") {
                hideChoices(choices);
                if(eventinfo.sourceType == "player") {
                    values["class_gp"] = parseInt(mancerdata["l1-class"].data.class["data-Average Wealth"].toLowerCase().replace(/[^\d]/gi, "")) || 0;
                }
            } else if (eventinfo.newValue && eventinfo.newValue == "starting") {
                showChoices(choices);
                values["roll_rollwealth"] = "&{template:mancerroll} {{title=Wealth Roll}} {{r1=[["
                                        + mancerdata["l1-class"].data.class["data-Starting Wealth"].toLowerCase().replace(/[^\d\sxd]/gi, "").replace(/[x]/gi, "*")
                                        + "]]}} {{r1name=^{roll}}}";
                if(eventinfo.sourceType == "player") {
                    values["class_gp"] = 0;
                } else {
                    if(mancerdata["l1-class"].values.class_gp) {
                        gp = mancerdata["l1-class"].values.class_gp;
                    }
                }
                update["class_gp_display"] = gp + " gp";
            }
            setAttrs(values,{silent: true}, () => {
                setCharmancerText(update);
            });
    });
    on("mancerchange:class_feat_choice", (eventinfo) => {
        if(eventinfo.sourceType == "player") {
            if((eventinfo.newValue || "").length) {
                changeCompendiumPage("sheet-class-info", eventinfo.newValue);
            }
        }
    });
    on("clicked:info_class_feat_choice", (eventinfo) => {
        var data = getCharmancerData();
        if (data["l1-class"] && data["l1-class"].values.class_feat_choice) {
            changeCompendiumPage("sheet-class-info", data["l1-class"].values.class_feat_choice);
        }
    });
    on("clicked:info_class_feat1 clicked:info_class_feat2 clicked:info_class_feat3 clicked:info_class_feat4", (eventinfo) => {
        // console.log("*** DEBUG clicked:info_class_featX: " + JSON.stringify(eventinfo,null,"  "));
        var data = getCharmancerData();
        if (data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class && data["l1-class"].data.class["data-Bonus Feats"]) {
            var featz = data["l1-class"].data.class["data-Bonus Feats"];
            if(featz.indexOf(",") == -1) {
                changeCompendiumPage("sheet-class-info", "Feats:" + featz);
            } else {
                var tmpint = (parseInt(eventinfo["triggerName"].trim().slice(-1)) || 1)- 1;
                changeCompendiumPage("sheet-class-info", "Feats:" + featz.split(",")[tmpint].trim());
            }
        }
    });
    on("mancerroll:rollwealth", (eventinfo) => {
        // console.log("*** DEBUG mancerroll:rollwealth: " + JSON.stringify(eventinfo,null,"  "));
        var gp = parseInt((eventinfo.roll[0].result || "0"));
        setAttrs({class_gp: gp},{silent: true},() => {
            setCharmancerText({class_gp_display: gp + " gp"});
        });
    });
    on("mancerchange:class_subclass1 mancerchange:class_subclass2", (eventinfo) => {
        if((eventinfo.newValue || "").length) {
            if(eventinfo.sourceType == "player") {
                changeCompendiumPage("sheet-class-info", eventinfo.newValue);
            }
        }
        update_subclasses(eventinfo.triggerName.slice(-1),eventinfo.newValue || "", eventinfo.sourceType || "");
    });
    on("clicked:info_subclass1", (eventinfo) => {
        var data = getCharmancerData();
        if (data["l1-class"] && data["l1-class"].values.class_subclass1) {
            changeCompendiumPage("sheet-class-info", data["l1-class"].values.class_subclass1);
        }
    });
    on("clicked:info_subclass2", (eventinfo) => {
        var data = getCharmancerData();
        if (data["l1-class"] && data["l1-class"].values.class_subclass2) {
            changeCompendiumPage("sheet-class-info", data["l1-class"].values.class_subclass2);
        }
    });
    on("mancerchange:class_subclass1_ability_choice", () => {
        recalcData("class");
    });
    on("clicked:info_subclass1_feat1 clicked:info_subclass1_feat2 clicked:info_subclass2_feat1 clicked:info_subclass2_feat2", (eventinfo) => {
        var data = getCharmancerData();
        var sub = eventinfo["triggerName"].charAt(21);
        if (data["l1-class"] && data["l1-class"].data && data["l1-class"].data["class_subclass" + sub] && data["l1-class"].data["class_subclass" + sub]["data-Bonus Feat"]) {
            var featz = data["l1-class"].data["class_subclass" + sub]["data-Bonus Feat"];
            if(featz.indexOf(",") == -1) {
                changeCompendiumPage("sheet-class-info", "Feats:" + featz);
            } else {
                var tmpint = (parseInt(eventinfo["triggerName"].trim().slice(-1)) || 1)- 1;
                changeCompendiumPage("sheet-class-info", "Feats:" + featz.split(",")[tmpint].trim());
            }
        }
    });
    const update_class = function(eventinfo,reset) {
        if(eventinfo.newValue === "Rules:Classes") {
            //Clears saved data for this field
            getCompendiumPage("");
            setAttrs(reset, () => {
                var update = {"class_text": ""};
                showChoices(["custom_class"]);
                setCharmancerText(update);
                recalcData("class");
            });
        } else {
            getCompendiumPage(eventinfo.newValue, mncrGetList, (p) => {
                setAttrs(reset,{silent: true}, () => {
                    var mancerdata = getCharmancerData();
                    var update = {};
                    var showList = [];
                    var possibles = ["class_alignment_display","class_traits","class_skill_bonus","class_speed_bonus","class_acsecondary","class_spellcasting_ability","class_spellcaster_level","class_spelllike","class_languages","class_feat1","class_feat2","class_feat3","class_feat4","class_subclass1_description","class_subclass2_description","class_gp_display"];
                    var data = p["data"];
                    var values = {};
                    var tmpint = 0;

                    if(mncrDebugMode) {console.log("*** DEBUG class raw data:" + JSON.stringify(data,null,"  "));}

                    if(!(eventinfo.newValue === "" || eventinfo.newValue === undefined)) {
                        showList.push("class_always");
                    }

                    _.each(possibles, (key) => {
                        update[key] = "";
                    });

                    if(data["data-Hit Die"]) {
                        update["class_hit_die"] = data["data-Hit Die"];
                    }

                    if(data["data-Alignment Choice"]) {
                        var aligarray = [];
                        _.each(data["data-Alignment Choice"].split(","), (el) => {
                            if(el.trim().length > 0) {
                                aligarray.push(el.trim());
                            }
                        });
                        var options = {};
                        if(aligarray.length == 1) {
                            options["selected"] = data["data-Alignment Choice"].trim();
                        }
                        // console.log("*** DEBUG class alignment choices: " + aligarray);
                        if(!showList["class_alignment_choice"]) {
                            showList.push("class_alignment_choice");
                        }
                        setCharmancerOptions("class_alignment_choice",aligarray,options);
                    }

                    if(data["data-Class skills"]) {
                        update["class_class_skills"] = data["data-Class skills"];
                    }
                    if(data["data-Skill Ranks"]) {
                        update["class_skill_ranks"] = data["data-Skill Ranks"];
                    }
                    if(data["data-Skills bonus"]) {
                        update["class_skill_bonus"] = data["data-Skills bonus"];
                        showList.push("class_skill_bonus_row");
                    }
                    if(data["data-Starting Wealth"]){
                        update["class_wealth_starting"] = data["data-Starting Wealth"];
                    }
                    if(data["data-Average Wealth"]){
                        update["class_wealth_average"] = data["data-Average Wealth"];
                    }
                    if(mancerdata["l1-class"] && mancerdata["l1-class"].values.class_wealth) {
                        if(mancerdata["l1-class"].values.class_wealth == "average") {
                            update["class_gp_display"] = "";
                        } else {
                            showList.push("class_wealthroll_display");
                            update["class_gp_display"] = (parseInt(mancerdata["l1-class"].values.class_gp) || 0) + " gp";
                        }
                    }
                    if(data["data-Base Attack Bonus"]) {
                        tmpint = parseInt(data["data-Base Attack Bonus"]) || 0;
                        update["class_bab"] = "" + (tmpint < 0 ? "" : "+") + tmpint;
                    } else {
                        update["class_bab"] = "+0";
                    }
                    if(data["data-Fortitude"]) {
                        tmpint = parseInt(data["data-Fortitude"]) || 0;
                        update["class_fortitude"] = "" + (tmpint < 0 ? "" : "+") + tmpint;
                    } else {
                        update["class_fortitude"] = "+0";
                    }
                    if(data["data-Reflex"]) {
                        tmpint = parseInt(data["data-Reflex"]) || 0;
                        update["class_reflex"] = "" + (tmpint < 0 ? "" : "+") + tmpint;
                    } else {
                        update["class_reflex"] = "+0";
                    }
                    if(data["data-Will"]) {
                        tmpint = parseInt(data["data-Will"]) || 0;
                        update["class_will"] = "" + (tmpint < 0 ? "" : "+") + tmpint;
                    } else {
                        update["class_will"] = "+0";
                    }
                    if(data["data-Speed bonus"]) {
                        update["class_speed_bonus"] = data["data-Speed bonus"];
                        showList.push("class_speed_bonus_row");
                    }
                    if(data["data-AC Seconday Ability"]) {
                        update["class_acsecondary"] = data["data-AC Seconday Ability"];
                        showList.push("class_acsecondary_row");
                    }
                    if(data["data-Spellcaster"]) {
                        showList.push("class_spellcaster_row");
                        update["class_spellcasting_ability"] = data["data-Spellcasting ability"];
                        update["class_spellcaster_level"] = data["data-Spellcaster Level"];
                    }
                    if(data["data-Spell-like abilities"]) {
                        update["class_spelllike"] = data["data-Spell-like abilities"];
                        showList.push("class_spelllike_row");
                    }
                    if(data["data-Languages"]) {
                        update["class_languages"] = data["data-Languages"];
                        showList.push("class_languages_row");
                    }
                    if(data["data-Bonus Feats"] || data["data-Bonus Feats Choice"]) {
                        showList.push("class_bonusfeats_row");
                        if(data["data-Bonus Feats"]) {
                            tmpint = 0;
                            _.each(data["data-Bonus Feats"].split(","), (feat) => {
                                tmpint++;
                                showList.push("class_feat" + tmpint +  "_row");
                                update["class_feat" + tmpint] = feat.trim();
                            });
                        }
                        if(data["data-Bonus Feats Choice"]) {
                            let options = {"category": "Feats"};
                            showList.push("class_feat_choice_row");
                            if(data["data-Bonus Feats Choice"].indexOf(",") !== -1) {
                                var featquery = [];
                                _.each(data["data-Bonus Feats Choice"].split(","), (feat) => {
                                    featquery.push(feat.trim());
                                });
                                setCharmancerOptions("class_feat_choice", featquery, options, () => {
                                    disableCharmancerOptions("class_feat_choice", get_feats(mancerdata));
                                });
                            } else {
                                setCharmancerOptions("class_feat_choice", data["data-Bonus Feats Choice"], options, () => {
                                    disableCharmancerOptions("class_feat_choice", get_feats(mancerdata));
                                });
                            }
                        }
                    }
                    if(data["data-Traits"]) {
                        var traits_final = "";
                        let tmp = data["data-Traits"].replace(/=&gt;/gi,":");
                        var json = JSON.parse(tmp);
                        _.each(json, (t, i) => {
                            if(t["Name"]) {
                                traits_final += "<b>" + t["Name"];
                                if(t["Type"] || t["Per-day"]) {
                                    traits_final += " (";
                                    if(t["Type"]) {
                                        traits_final += t["Type"];
                                    }
                                    if(t["Per-day"]) {
                                        if(t["Type"]) {
                                            traits_final += ", ";
                                        }
                                        traits_final += t["Per-day"] + " " + getTranslationByKey("per-day");
                                    }
                                    traits_final += ")";
                                }
                                traits_final += "</b>";
                                if(t["Description"]) {
                                    traits_final += " " + t["Description"];
                                }
                                // traits_final += "<br/>";
                            };
                        });
                        update["class_traits"] = traits_final;
                    };

                    var class_name = eventinfo.newValue && eventinfo.newValue.split(":").length > 1 && eventinfo.newValue.split(":")[0] === "Classes" ? eventinfo.newValue.split(":")[1] : false;

                    // Subclass
                    // console.log("*** DEBUG mancerchange:class_subclass :" + choices);
                    if(data["data-Subclass Number"] && data["data-Subclass Name"]) {
                        if((parseInt(data["data-Subclass Number"]) || 0) > 0){
                            // First subclass
                            var subOptions = {show_source: true};
                            if(eventinfo.sourceType != "player") {
                                subOptions.silent = true;
                            } else {
                                subOptions.selected = "";
                            }
                            var choices = [];
                            if(mancerdata["l1-class"].values["class_subclass1"]) {
                                choices.push(mancerdata["l1-class"].values["class_subclass1"]);
                            }
                            if(mancerdata["l1-class"].values["class_subclass2"]) {
                                choices.push(mancerdata["l1-class"].values["class_subclass2"]);
                            }
                            // Show subclass
                            showList.push("subclass1_row");
                            update["subclass1_name"] = data["data-Subclass Name"] + ":";
                            setCharmancerOptions("class_subclass1","Category:Subclasses data-Parent:" + class_name, subOptions, () => {
                                disableCharmancerOptions("class_subclass1", choices);
                            });
                            // 2nd subclass
                            if((parseInt(data["data-Subclass Number"]) || 0) > 1){
                                showList.push("subclass2_row");
                                update["subclass2_name"] = data["data-Subclass Name"] + ":";
                                setCharmancerOptions("class_subclass2","Category:Subclasses data-Parent:" + class_name, subOptions, () => {
                                    disableCharmancerOptions("class_subclass2", choices);
                                });
                            }
                        }
                    }

                    setAttrs(values, () => {
                        setCharmancerText(update);
                        showChoices(showList);
                        recalcData("class");
                    });
                });
            });
        }
    };
    const update_subclasses = function(nber, subclass, sourceType) {
        if(mncrDebugMode) {console.log("*** DEBUG subclass " + nber + " :" + subclass);}
        var update = {};
        var reset = {};
        var values = {};
        var showList = []; // "subclass1_detail","subclass2_detail"
        var hideList = ["subclass" + nber + "_detail","subclass" + nber + "_abltbonus_row","subclass" + nber + "_abltbonus_row","subclass" + nber + "_savebonus_row","subclass" + nber + "_speedbonus_row","subclass" + nber + "_classkills_row","class_subclass" + nber + "_classkills_choice","subclass" + nber + "_skillsbonus_row","subclass" + nber + "_bonusfeat_row","subclass" + nber + "_bonusfeat2_row","subclass" + nber + "_domainspell1_row","subclass" + nber + "_traits_row","subclass" + nber + "_powers_row"];
        var possibles = ["subclass" + nber + "_description","subclass" + nber + "_savebonus","subclass" + nber + "_speedbonus","subclass" + nber + "_classkills","subclass" + nber + "_skillsbonus","subclass" + nber + "_bonusfeat1","subclass" + nber + "_bonusfeat2","subclass" + nber + "_domainspell1","subclass" + nber + "_traits","subclass" + nber + "_powers"];

        _.each(possibles, (key) => {
            update[key] = "";
        });

        hideChoices(hideList);

        if(sourceType == "player" && (! subclass)) {
            reset["class_subclass" + nber + "_ability_choice"] = "";
            reset["class_subclass" + nber + "_classkills_choice"] = "";
        }

        getCompendiumPage(subclass, true, (dta) => {
            setAttrs(reset,{silent:true}, () => {
                var data = dta["data"];

                if(mncrDebugMode) {console.log("*** DEBUG suclass " + nber + " raw data:" + JSON.stringify(data,null,"  "));}

                showList.push("subclass" + nber + "_detail");

                if(data["data-Description"]) {
                    update["subclass" + nber + "_description"] = data["data-Description"];
                }
                if(data["data-Ability bonus choice"]) {
                    var abltarray = [];
                    _.each(data["data-Ability bonus choice"].split(","), (el) => {
                        if(el.trim().length > 0) {
                            abltarray.push(el.trim());
                        }
                    });
                    setCharmancerOptions("class_subclass" + nber + "_ability_choice",abltarray);
                    showList.push("subclass" + nber + "_abltbonus_row");
                } else {
                    values["class_subclass" + nber + "_ability_choice"] = "";
                }
                if(data["data-Saving Throws bonus"]) {
                    showList.push("subclass" + nber + "_savebonus_row");
                    update["subclass" + nber + "_savebonus"] = data["data-Saving Throws bonus"];
                }
                if(data["data-Base Speed Bonus"]) {
                    showList.push("subclass" + nber + "_speedbonus_row");
                    update["subclass" + nber + "_speedbonus"] = data["data-Base Speed Bonus"];
                }
                if(data["data-Initiative Bonus"]) {
                    showList.push("subclass" + nber + "_initbonus_row");
                    update["subclass" + nber + "_initbonus"] = data["data-Initiative Bonus"];
                }
                if(data["data-Class skills"]) {
                    showList.push("subclass" + nber + "_classkills_row");
                    if(data["data-Class skills"].toLowerCase().indexOf("any ") == -1) {
                        update["subclass" + nber + "_classkills"] = data["data-Class skills"];
                    } else {
                        showList.push("class_subclass" + nber + "_classkills_choice");
                    }
                } else {
                    values["class_subclass" + nber + "_classkills_choice"] = "";
                }
                if(data["data-Skills bonus"]) {
                    showList.push("subclass" + nber + "_skillsbonus_row");
                    update["subclass" + nber + "_skillsbonus"] = data["data-Skills bonus"];
                }
                if(data["data-Bonus Feat"]) {
                    showList.push("subclass" + nber + "_bonusfeat_row");
                    update["subclass" + nber + "_bonusfeat1"] = data["data-Bonus Feat"].split(",")[0];
                    if(data["data-Bonus Feat"].split(",").length > 1) {
                        update["subclass" + nber + "_bonusfeat2"] = data["data-Bonus Feat"].split(",")[1];
                        showList.push("subclass" + nber + "_bonusfeat2_row");
                    }
                }
                if(data["data-Domain Spells Level 1"]) {
                    showList.push("subclass" + nber + "_domainspell1_row");
                    update["subclass" + nber + "_domainspell1"] = data["data-Domain Spells Level 1"];
                }

                // Traits
                if(data["data-Traits"]) {
                    var traits_final = "";
                    let tmp = data["data-Traits"].replace(/=&gt;/gi,":");
                    var json = JSON.parse(tmp);
                    _.each(json, (t, i) => {
                        if(t["Name"]) {
                            traits_final += "<b>" + t["Name"];
                            if(t["Type"]) {
                                traits_final += " (" + t["Type"] + ")";
                            }
                            traits_final += "</b>";
                            if(t["Description"]) {
                                traits_final += " " + t["Description"];
                            }
                            // traits_final += "<br/>";
                        };
                    });
                    if(traits_final.length) {
                        showList.push("subclass" + nber + "_traits_row");
                        update["subclass" + nber + "_traits"] = traits_final;
                    }
                };

                // Powers
                if(data["data-Powers"]) {
                    var powers_final = "";
                    let tmp = data["data-Powers"].replace(/=&gt;/gi,":");
                    var json = JSON.parse(tmp);
                    _.each(json, (t, i) => {
                        if(t["Name"]) {
                            powers_final += "<b>" + t["Name"];
                            if(t["Type"] || t["Per-day"]) {
                                powers_final += " (";
                                if(t["Type"]) {
                                    powers_final += t["Type"];
                                }
                                if(t["Per-day"]) {
                                    if(t["Type"]) {
                                        powers_final += ", ";
                                    }
                                    powers_final += t["Per-day"] + " " + getTranslationByKey("per-day");
                                }
                                powers_final += ")";
                            }
                            powers_final += "</b>";
                            if(t["Description"]) {
                                powers_final += " " + t["Description"];
                            }
                            // powers_final += "<br/>";
                        };
                    });
                    if(powers_final.length) {
                        showList.push("subclass" + nber + "_powers_row");
                        update["subclass" + nber + "_powers"] = powers_final;
                    }
                };
                setAttrs(values, () => {
                    showChoices(showList);
                    setCharmancerText(update);
                    recalcData();
                });
            });
        });
    };

    // === SKILLS ===
    on("page:l1-skills", () => {
        recalcData("skills");
    });
    on("mancerchange:acrobatics_ranks mancerchange:appraise_ranks mancerchange:bluff_ranks mancerchange:climb_ranks mancerchange:craft_ranks mancerchange:diplomacy_ranks mancerchange:disable_device_ranks mancerchange:disguise_ranks mancerchange:escape_artist_ranks mancerchange:fly_ranks mancerchange:handle_animal_ranks mancerchange:heal_ranks mancerchange:intimidate_ranks mancerchange:knowledge_arcana_ranks mancerchange:knowledge_dungeoneering_ranks mancerchange:knowledge_engineering_ranks mancerchange:knowledge_geography_ranks mancerchange:knowledge_history_ranks mancerchange:knowledge_local_ranks mancerchange:knowledge_nature_ranks mancerchange:knowledge_nobility_ranks mancerchange:knowledge_planes_ranks mancerchange:knowledge_religion_ranks mancerchange:linguistics_ranks mancerchange:perception_ranks mancerchange:perform_ranks mancerchange:profession_ranks mancerchange:ride_ranks mancerchange:sense_motive_ranks mancerchange:sleight_of_hand_ranks mancerchange:spellcraft_ranks mancerchange:stealth_ranks mancerchange:survival_ranks mancerchange:swim_ranks mancerchange:use_magic_device_ranks", () => {
        recalcData("skills");
    });
    on("clicked:clearskillranks", (eventinfo) => {
        update = {};
        _.each(["acrobatics","appraise","bluff","climb","craft","diplomacy","disable_device","disguise","escape_artist","fly","handle_animal","heal","intimidate","knowledge_arcana","knowledge_dungeoneering","knowledge_engineering","knowledge_geography","knowledge_history","knowledge_local","knowledge_nature","knowledge_nobility","knowledge_planes","knowledge_religion","linguistics","perception","perform","profession","ride","sense_motive","sleight_of_hand","spellcraft","stealth","survival","swim","use_magic_device"], (skill) => {
                update[skill + "_ranks"] = 0;
        });
        setAttrs(update,{silent: true},() => {
            recalcData("skills");
        });
    });

    // === FEATS ===
    on("page: page:l1-feats", () => {
        hideChoices();

        var update = {};
        var showList = ["feat_lvl1_1"];
        var data = getCharmancerData();

        // Race
        if(data["l1-race"]) {
            if(data["l1-race"].values.race_feat_choice) {
                showList.push("race_feats");
                update["race_feat_display"] = data["l1-race"].values.race_feat_choice.replace("Feats:","");
            } else if(data["l1-race"].data && data["l1-race"].data.race && data["l1-race"].data.race["data-Feats"] && data["l1-race"].data.race["data-Feats"] != "Any") {
                showList.push("race_feats");
                update["race_feat_display"] = data["l1-race"].data.race["data-Feats"];
            }
        }

        // Class
        if(data["l1-class"]) {
            if(data["l1-class"].values.class_feat_choice) {
                showList.push("class_bonusfeats_row","class_feat_choice_row");
                update["class_feat_choice_display"] = data["l1-class"].values.class_feat_choice.replace("Feats:","");
            }
            if(data["l1-class"].data && data["l1-class"].data.class && data["l1-class"].data.class["data-Bonus Feats"]) {
                showList.push("class_bonusfeats_row");
                if(data["l1-class"].data.class["data-Bonus Feats"]) {
                    tmpint = 0;
                    _.each(data["l1-class"].data.class["data-Bonus Feats"].split(","), (feat) => {
                        tmpint++;
                        showList.push("class_feat" + tmpint +  "_row");
                        update["class_feat" + tmpint] = feat.trim();
                    });
                }
            }
            // Subclass 1
            if(data["l1-class"].values.class_subclass1){
                if(data["l1-class"].data && data["l1-class"].data.class_subclass1 && data["l1-class"].data.class_subclass1["data-Bonus Feat"]) {
                    showList.push("subclass_feats_row","subclass1_bonusfeat_row");
                    update["subclass1_name"] = data["l1-class"].values.class_subclass1.replace("Subclasses:","");
                    update["subclass1_bonusfeat1"] = data["l1-class"].data.class_subclass1["data-Bonus Feat"].split(",")[0].trim();
                    if(data["l1-class"].data.class_subclass1["data-Bonus Feat"].split(",").length > 1) {
                        update["subclass1_bonusfeat2"] = data["l1-class"].data.class_subclass1["data-Bonus Feat"].split(",")[1].trim();
                        showList.push("subclass1_bonusfeat2_row");
                    }
                }
            }
            // Subclass 2
            if(data["l1-class"].values.class_subclass2){
                if(data["l1-class"].data && data["l1-class"].data.class_subclass2 && data["l1-class"].data.class_subclass2["data-Bonus Feat"]) {
                    showList.push("subclass_feats_row","subclass2_bonusfeat_row");
                    update["subclass2_name"] = data["l1-class"].values.class_subclass2.replace("Subclasses:","");
                    update["subclass2_bonusfeat1"] = data["l1-class"].data.class_subclass2["data-Bonus Feat"].split(",")[0].trim();
                    if(data["l1-class"].data.class_subclass2["data-Bonus Feat"].split(",").length > 1) {
                        update["subclass2_bonusfeat2"] = data["l1-class"].data.class_subclass2["data-Bonus Feat"].split(",")[1].trim();
                        showList.push("subclass2_bonusfeat2_row");
                    }
                }
            }
        }
        setCharmancerOptions("feat_lvl1_1", "Category:Feats", {}, () => {
            disableCharmancerOptions("feat_lvl1_1", get_feats(data));
            setCharmancerText(update);
            showChoices(showList);
            recalcData("feats");
        });
    });
    on("mancerchange:feat_lvl1_1", (eventinfo) => {
        if(eventinfo.newValue && eventinfo.sourceType == "player") {
            changeCompendiumPage("sheet-feats-info", eventinfo.newValue);
        }
    });
    on("clicked:info_feat_lvl1_1", (eventinfo) => {
        var data = getCharmancerData();
        if(data["l1-feats"].values["feat_lvl1_1"]) {
            changeCompendiumPage("sheet-feats-info", data["l1-feats"].values["feat_lvl1_1"]);
        }
    });

    // === SPELLS ===
    on("page:l1-spells", () => {
        var update = {};
        var showList = [];
        var values = {};
        var spellreset = {"spells_level_0_1":"","spells_level_0_2":"","spells_level_0_3":"","spells_level_0_4":"","spells_level_0_5":"","spells_level_0_6":"","spells_level_1_1":"","spells_level_1_2":"","spells_level_1_3":"","spells_level_1_4":"","spells_level_1_5":"","spells_level_1_6":""};
        var data = getCharmancerData();

        hideChoices();

        if(data["l1-class"] && data["l1-class"].values.class) {
            if(data["l1-class"].data && data["l1-class"].data.class
            && data["l1-class"].data.class["data-Spellcaster"]
            && (data["l1-class"].data.class["data-Spells Per Day"] || data["l1-class"].data.class["data-Spells Known"])) {

                // Reset of spells if class has changed
                if(data["l1-spells"] && data["l1-spells"].values["spellcaster"]) {
                    if(data["l1-spells"].values.spellcaster != data["l1-class"].values.class) {
                        values["spellcaster"] =  data["l1-class"].values.class;
                        _.extend(values,spellreset);
                    }
                } else {
                    values["spellcaster"] =  data["l1-class"].values.class;
                }

                // Abilities mods
                var abilities_scores = calc_abilities(data);
                var ability_mods = calc_abilities_mod(abilities_scores);

                // Check ability
                var ablt = 10;
                var ablt_name = getTranslationByKey("intelligence");
                if(data["l1-class"].data.class["data-Spellcasting ability"]) {
                    ablt = parseInt(abilities_scores[data["l1-class"].data.class["data-Spellcasting ability"].toLowerCase()].total) || 10;
                    ablt_name = getTranslationByKey(data["l1-class"].data.class["data-Spellcasting ability"].toLowerCase());
                }
                if(ablt < 10 ) {
                    _.extend(values,spellreset);
                    update["spells_nospell"] = data["l1-class"].values.class.replace("Classes:","") + " "
                                    + getTranslationByKey("cant-cast-with")
                                    + " " + ablt + " " + ablt_name;
                } else {
                    // Bonus spells
                        /* ablt < 10 : Cant cast spells tied to this ability
                        ablt > 9 && ablt < 12 : 0 bonus spells
                        ablt > 11 && ablt < 20 : 1 bonus spells
                        ablt > 19 : 2 bonus spells */
                    var bonuspells = [0,0];
                    if(ablt > 11 && ablt < 20) {
                        bonuspells[1] = 1;
                    } else if(ablt > 19) {
                        bonuspells[1] = 2;
                    }

                    // Spells known/per day
                    showList.push("spells_spells");
                    var lvlarr;
                    var prepared = false;
                    if(data["l1-class"].data.class["data-Spells Known"]) {
                        lvlarr = data["l1-class"].data.class["data-Spells Known"].split(",");
                        update["spells_nospell"] = getTranslationByKey("choose-known-spells");
                    } else {
                        prepared = true;
                        lvlarr = data["l1-class"].data.class["data-Spells Per Day"].split(",");
                        update["spells_nospell"] = getTranslationByKey("choose-prepared-spells");
                    }

                    var querry = "";
                    if(data["l1-class"].data.class["data-Spell Choice"]) {
                        querry = data["l1-class"].data.class["data-Spell Choice"];
                    } else {
                        querry = "Category:Spells";
                    }

                    // Domain spells
                    for(var j = 1; j < 3; j++) {
                        if(data["l1-class"].values["class_subclass" + j]
                        && data["l1-class"].data["class_subclass" + j]
                        && data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"]) {
                            showList.push("spells_domainspell" + j + "_row");
                            update["spells_domain" + j] = getTranslationByKey("domaine-spell") + " (" + data["l1-class"].values["class_subclass" + j].replace("Subclasses:","") + "):";
                            update["spells_domainspell" + j] = data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"];
                        }
                    }

                    // Spell choices
                    var spelllevel = -1;
                    _.each(lvlarr, (lvl) => {
                        spelllevel++;
                        var nbspells = 0;
                        if(lvl.indexOf("+") == -1) {
                            nbspells = parseInt(lvl) || 0;
                        } else {
                            nbspells = (parseInt(lvl.split("+")[0].toLowerCase().trim()) || 0) + (parseInt(ability_mods[lvl.split("+")[1].toLowerCase().trim()]) || 0);
                        }
                        // Adding bonus spells for prepared spells (not spells known)
                        if(prepared) {
                            nbspells += (bonuspells[spelllevel] || 0);
                        }
                        if(nbspells) {
                            showList.push("spells_level_" + spelllevel);
                            for(var i = 1; i < 7; i++) {
                                if(i <= nbspells) {
                                    showList.push("spells_level_" + spelllevel + "_" + i + "_row");
                                    setCharmancerOptions("spells_level_" + spelllevel + "_" + i, querry.replace("CASTERLEVEL",spelllevel));
                                } else {
                                    values["spells_level_" + spelllevel + "_" + i] = "";
                                }
                            }
                        }
                    });
                }
            } else {
                values["spellcaster"] = "";
                _.extend(values,spellreset);
                update["spells_nospell"] = getTranslationByKey("character-no-spells");
            }
        } else {
            values["spellcaster"] = "";
            _.extend(values,spellreset);
            update["spells_nospell"] = getTranslationByKey("character-no-spells");
        }
        setAttrs(values,{silent: true},() => {
            if(! _.isEmpty(update)) {
                setCharmancerText(update);
            }
            showChoices(showList);
            recalcData("spells");
        });
    });
    on("mancerchange:spells_level_0_1 mancerchange:spells_level_0_2 mancerchange:spells_level_0_3 mancerchange:spells_level_0_4 mancerchange:spells_level_0_5 mancerchange:spells_level_0_6 mancerchange:spells_level_1_1 mancerchange:spells_level_1_2 mancerchange:spells_level_1_3 mancerchange:spells_level_1_4 mancerchange:spells_level_1_5 mancerchange:spells_level_1_6", (eventinfo) => {

        if(eventinfo.newValue && eventinfo.sourceType == "player") {
            changeCompendiumPage("sheet-spells-info", eventinfo.newValue);
        }

        var data = getCharmancerData();
        // Selected spells to disable
        var choices = [];
        for(var j = 0; j < 2; j++) {
            for(var i = 1; i < 7; i++) {
                if(data["l1-spells"].values["spells_level_" + j + "_" + i]) {
                    choices.push(data["l1-spells"].values["spells_level_" + j + "_" + i]);
                }
            }
        }

        // Domain spells
        for(j = 1; j < 3; j++) {
            if(data["l1-class"] && data["l1-class"].values["class_subclass" + j]
            && data["l1-class"].data["class_subclass" + j]
            && data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"]) {
                choices.push("Spells:" + data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"]);
            }
        }

        // console.log("*** DEBUG change:spells_level_x_y choices: " + choices);

        // Disable spells
        for(j = 0; j < 2; j++) {
            for(i = 1; i < 7; i++) {
                disableCharmancerOptions("spells_level_" + j + "_" + i,choices);
            }
        }
    });
    on("clicked:spells_level_0_1 clicked:spells_level_0_2 clicked:spells_level_0_3 clicked:spells_level_0_4 clicked:spells_level_1_1 clicked:spells_level_1_2 clicked:spells_level_1_3 clicked:spells_level_1_4 clicked:spells_level_1_5 clicked:spells_level_1_6", (eventinfo) => {
        // "triggerName": "clicked:spells_level_0_1"
        var spell = eventinfo["triggerName"].replace("clicked:","");
        var data = getCharmancerData();
        if(data["l1-spells"].values[spell]) {
            changeCompendiumPage("sheet-spells-info", data["l1-spells"].values[spell]);
        }
    });
    on("clicked:spells_domainspell1 clicked:spells_domainspell2", (eventinfo) => {
        var j = eventinfo["triggerName"].slice(-1);
        var data = getCharmancerData();
        if(data["l1-class"] && data["l1-class"].data
            && data["l1-class"].data["class_subclass" + j]
            && data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"]) {
            changeCompendiumPage("sheet-spells-info", "Spells:" + data["l1-class"].data["class_subclass" + j]["data-Domain Spells Level 1"]);
        }
    });

    // === SUMMARY ===
    on("page:l1-summary", () => {
        var returnObj = recalcData("summary") || {};

        hideChoices();
        var update = {};
        var values = {}
        var showList = [];
        var nogo = false;
        var data = getCharmancerData();

        _.each(["abilities","race","class","skills","feats","feats"],(cat) => {
            _.each(["_req","_err","_"], (lab) => {
                update["sum" + lab + "_" + cat] = "";
            });
        });

        // === ABILITIES ===
        if(data["l1-abilities"] && data["l1-abilities"].values
            && data["l1-abilities"].values["abilities"]
            && data["l1-abilities"].values["strength"]
            && data["l1-abilities"].values["dexterity"]
            && data["l1-abilities"].values["constitution"]
            && data["l1-abilities"].values["intelligence"]
            && data["l1-abilities"].values["wisdom"]
            && data["l1-abilities"].values["charisma"]) {
                showList.push("sum_abilities");
                let method = "";
                if(data["l1-abilities"].values["abilities"] == "custom") {
                    method = getTranslationByKey("custom");
                } else {
                    method = getTranslationByKey("rollab-" + data["l1-abilities"].values["abilities"]);
                }
                update["sum_abilities"] = "You have generated your Ability Scores using the <b>" + method + "</b> method.";
        } else {
            nogo = true;
            showList.push("sum_req_abilities");
            update["sum_req_abilities"] = "You need to generate your Ability Scores."
                + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-abilities" data-i18n="abilities">Abilities</button></div>';
        }

        // === RACE ===
        if(data["l1-race"] && data["l1-race"].values.race) {
            showList.push("sum_race");
            if(data["l1-race"].values.race == "Index:Races") {
                update["sum_race"] = "Your Custom Race is <b>" + (data["l1-race"].values["race_custom_name"] || "Unknown") + "</b>.";
            } else {
                update["sum_race"] = "Your Race is <b>" + data["l1-race"].values.race.replace("Races:","") + "</b>.";
            }
            if(data["l1-race"].data && data["l1-race"].data.race) {
                // race_ability_choice1
                if(data["l1-race"].data.race["data-Ability Score Choice"] && (! data["l1-race"].values["race_ability_choice1"])) {
                    nogo = true;
                    showList.push("sum_req_race");
                    update["sum_req_race"] = (update["sum_req_race"].length > 0 ? " " : "") + "You haven't picked an Ability Score Increase.";
                }
                // race_skill_bonus_choice
                if(data["l1-race"].data.race["data-Skills Bonus Choice"] && (! data["l1-race"].values["race_skill_bonus_choice"])) {
                    nogo = true;
                    showList.push("sum_req_race");
                    update["sum_req_race"] = (update["sum_req_race"].length > 0 ? " " : "") + "You haven't picked a Skill Bonus.";
                }
                // race_feat_choice
                if(data["l1-race"].data.race["data-Feats"] && data["l1-race"].data.race["data-Feats"] == "Any" && (! data["l1-race"].values["race_feat_choice"])) {
                    nogo = true;
                    showList.push("sum_req_race");
                    update["sum_req_race"] = (update["sum_req_race"].length > 0 ? " " : "") + "You haven't picked a Bonus Feat.";
                }
                if(update["sum_req_race"] && (update["sum_req_race"].length > 0)) {
                    update["sum_req_race"] += ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-race" data-i18n="race">Race</button></div>';
                }
            }
        } else {
            nogo = true;
            showList.push("sum_req_race");
            update["sum_req_race"] = "You need to pick a Race." + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-race" data-i18n="race">Race</button></div>';
        }

        // === CLASS ===
        if(data["l1-class"] && data["l1-class"].values.class) {
            showList.push("sum_class");
            if(data["l1-class"].values.class == "Rules:Classes") {
                update["sum_class"] = "You choose to set a custom Class.";
            } else {
                update["sum_class"] = "Your Class is <b>" + data["l1-class"].values.class.replace("Classes:","") + "</b>.";
                // Alignment
                if(! data["l1-class"].values.class_alignment_choice) {
                    showList.push("sum_err_class");
                    update["sum_err_class"] += (update["sum_err_class"].length > 0 ? " " : "") + "Your haven't chosen your alignment.";
                }
                // Wealth
                if(data["l1-class"].values["class_wealth"]
                    && data["l1-class"].values["class_wealth"] == "starting"
                    && ((! data["l1-class"].values["class_gp"]) || (data["l1-class"].values["class_gp"] && data["l1-class"].values["class_gp"] == "0"))) {
                    showList.push("sum_err_class");
                    update["sum_err_class"] += (update["sum_err_class"].length > 0 ? " " : "") + "Your haven't roll your Starting Wealth.";
                }
                if(data["l1-class"].data && data["l1-class"].data.class) {
                    // Subclasses
                    if(data["l1-class"].data.class["data-Subclass Name"]) {
                        if(data["l1-class"].values.class_subclass1) {
                            update["sum_class"] += " Your <b>" + data["l1-class"].data.class["data-Subclass Name"] + "</b> is <b>" + data["l1-class"].values.class_subclass1.replace("Subclasses:","") + "</b>.";
                            if(data["l1-class"].data.class_subclass1) {
                                // Ability Choice
                                if(data["l1-class"].data.class_subclass1["data-Ability bonus choice"]
                                    && (! data["l1-class"].values["class_subclass1_ability_choice"])) {
                                        nogo = true;
                                        showList.push("sum_req_class");
                                        update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick an Ability Score Increase.";
                                }
                                // Subclass Skill Choice
                                if(data["l1-class"].data.class_subclass1["data-Class skills"]
                                    && (data["l1-class"].data.class_subclass1["data-Class skills"].indexOf("Any") != -1)
                                    && (! data["l1-class"].values["class_subclass1_classkills_choice"])) {
                                        nogo = true;
                                        showList.push("sum_req_class");
                                        update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick a Class Skill.";
                                }
                            }
                        } else {
                            nogo = true;
                            showList.push("sum_req_class");
                            update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick a " + data["l1-class"].data.class["data-Subclass Name"] + ".";
                        }
                        if(data["l1-class"].values.class_subclass2) {
                            update["sum_class"] += " Your <b>second " + data["l1-class"].data.class["data-Subclass Name"] + "</b> is <b>" + data["l1-class"].values.class_subclass2.replace("Subclasses:","") + "</b>.";
                            if(data["l1-class"].data.class_subclass2) {
                                // Ability Choice
                                if(data["l1-class"].data.class_subclass2["data-Ability bonus choice"]
                                    && (! data["l1-class"].values["class_subclass2_ability_choice"])) {
                                        nogo = true;
                                        showList.push("sum_req_class");
                                        update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick an Ability Score Increase.";
                                }
                                // Subclass Skill Choice
                                if(data["l1-class"].data.class_subclass2["data-Class skills"]
                                    && (data["l1-class"].data.class_subclass2["data-Class skills"].indexOf("Any") != -1)
                                    && (! data["l1-class"].values["class_subclass2_classkills_choice"])) {
                                        nogo = true;
                                        showList.push("sum_req_class");
                                        update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick a Class Skill.";
                                }
                            }
                        } else if(data["l1-class"].data.class["data-Subclass Number"] == "2") {
                            nogo = true;
                            showList.push("sum_req_class");
                            update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick a second " + data["l1-class"].data.class["data-Subclass Name"] + ".";
                        }
                    }
                    // Feat Choice
                    if(data["l1-class"].data.class["data-Bonus Feats Choice"]
                        && (! data["l1-class"].values["class_feat_choice"])) {
                        nogo = true;
                        showList.push("sum_req_class");
                        update["sum_req_class"] += (update["sum_req_class"].length > 0 ? " " : "") + "Your need to pick a Bonus Feat.";
                    }
                }
                if(update["sum_req_class"] && (update["sum_req_class"].length > 0)) {
                    update["sum_req_class"] += ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-class" data-i18n="class">Class</button></div>';
                }
            }
        } else {
            nogo = true;
            showList.push("sum_req_class");
            update["sum_req_class"] = "Your need to pick a Class."
                + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-class" data-i18n="class">Class</button></div>';
        }

        // === SKILLS ===
        if(data["l1-class"] && data["l1-class"].values.class) {
            if(data["l1-skills"] && data["l1-skills"].values) {
                var listskill = "";
                _.each(Object.keys(data["l1-skills"].values),(skl) => {
                    if(skl.indexOf("_ranks") > -1) {
                        if((parseInt(data["l1-skills"].values[skl]) || 0) > 0) {
                            listskill += (listskill.length > 0 ? ", " : "") + getTranslationByKey(skl.replace("_ranks",""));
                        }
                    }
                });
                if(listskill.length) {
                    showList.push("sum_skills");
                    update["sum_skills"] = "You picked the following Skills: <b>" + listskill + "</b>.";
                    if(! _.isEmpty(returnObj) && returnObj.skillranks) {
                        if( (parseInt(returnObj.skillranks.current) || 0) > 0 ) {
                            nogo = true;
                            showList.push("sum_req_skills");
                            update["sum_req_skills"] = "You haven't spent all your  Skill Ranks."
                                + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-skills" data-i18n="skills">Skills</button></div>';
                        }
                    }
                } else {
                    nogo = true;
                    showList.push("sum_req_skills");
                    update["sum_req_skills"] = "You have not picked any Skill."
                        + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-skills" data-i18n="skills">Skills</button></div>';
                }
            } else {
                nogo = true;
                showList.push("sum_req_skills");
                update["sum_req_skills"] = "You have not picked any Skill."
                    + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-skills" data-i18n="skills">Skills</button></div>';
            }
        } else {
            showList.push("sum_err_skills");
            update["sum_err_skills"] = "Your need to pick a Class."
        }

        // === FEATS ===
        if(data["l1-feats"] && data["l1-feats"].values["feat_lvl1_1"]) {
            showList.push("sum_feats");
            update["sum_feats"] = "You have picked <b>" + data["l1-feats"].values["feat_lvl1_1"].replace("Feats:","") + "</b>.";
        } else {
            nogo = true;
            showList.push("sum_req_feats");
            update["sum_req_feats"] = "You need to pick a Feat."
                + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-feats" data-i18n="feats">Feats</button></div>';
        }

        // === SPELLS ===
        if(data["l1-class"] && data["l1-class"].values.class) {
            if(data["l1-class"].data && data["l1-class"].data.class
            && data["l1-class"].data.class["data-Spellcaster"]
            && (data["l1-class"].data.class["data-Spells Per Day"] || data["l1-class"].data.class["data-Spells Known"])) {
                if(data["l1-spells"] && data["l1-spells"].values) {
                    // Abilities mods
                    var abilities_scores = calc_abilities(data);
                    var ability_mods = calc_abilities_mod(abilities_scores);

                    // Check ability
                    var ablt = 10;
                    var ablt_name = getTranslationByKey("intelligence");
                    if(data["l1-class"].data.class["data-Spellcasting ability"]) {
                        ablt = parseInt(abilities_scores[data["l1-class"].data.class["data-Spellcasting ability"].toLowerCase()].total) || 10;
                        ablt_name = getTranslationByKey(data["l1-class"].data.class["data-Spellcasting ability"].toLowerCase());
                    }
                    if(ablt < 10 ) {
                        showList.push("sum_err_spells");
                        update["sum_err_spells"] = data["l1-class"].values.class.replace("Classes:","") + " "
                        + getTranslationByKey("cant-cast-with")
                        + " " + ablt + " " + ablt_name;
                    } else {
                        // Bonus spells
                            /* ablt < 10 : Cant cast spells tied to this ability
                            ablt > 9 && ablt < 12 : 0 bonus spells
                            ablt > 11 && ablt < 20 : 1 bonus spells
                            ablt > 19 : 2 bonus spells */
                        var bonuspells = [0,0];
                        if(ablt > 11 && ablt < 20) {
                            bonuspells[1] = 1;
                        } else if(ablt > 19) {
                            bonuspells[1] = 2;
                        }

                        // Spells known/per day
                        var lvlarr;
                        var prepared = false;
                        if(data["l1-class"].data.class["data-Spells Known"]) {
                            lvlarr = data["l1-class"].data.class["data-Spells Known"].split(",");
                        } else {
                            prepared = true;
                            lvlarr = data["l1-class"].data.class["data-Spells Per Day"].split(",");
                        }

                        // Spell choices
                        var spellschosen = "";
                        var allspellschosen = true;
                        var spelllevel = -1;
                        _.each(lvlarr, (lvl) => {
                            spelllevel++;
                            var nbspells = 0;
                            if(lvl.indexOf("+") == -1) {
                                nbspells = parseInt(lvl) || 0;
                            } else {
                                nbspells = (parseInt(lvl.split("+")[0].toLowerCase().trim()) || 0) + (parseInt(ability_mods[lvl.split("+")[1].toLowerCase().trim()]) || 0);
                            }
                            // Adding bonus spells for prepared spells (not spells known)
                            if(prepared) {
                                nbspells += (bonuspells[spelllevel] || 0);
                            }
                            if(nbspells) {
                                for(var i = 1; i < 7; i++) {
                                    if(i <= nbspells) {
                                        if(data["l1-spells"].values["spells_level_" + spelllevel + "_" + i]) {
                                            spellschosen += (spellschosen.length > 0 ? ", " : "") + data["l1-spells"].values["spells_level_" + spelllevel + "_" + i].replace("Spells:","");
                                        } else {
                                            allspellschosen = false;
                                        }
                                    }
                                }
                            }
                            if(spellschosen.length) {
                                showList.push("sum_spells");
                                update["sum_spells"] = "You have selected the following Spells: <b>" + spellschosen + "</b>.";
                                if(! allspellschosen) {
                                    nogo = true;
                                    showList.push("sum_req_spells");
                                    update["sum_req_spells"] = "Your haven't picked all your Spells."
                                        + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-spells" data-i18n="spells">Spells</button></div>';
                                }
                            } else {
                                nogo = true;
                                showList.push("sum_req_spells");
                                update["sum_req_spells"] = "Your haven't picked any Spells."
                                    + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-spells" data-i18n="spells">Spells</button></div>';
                            }
                        });
                    }
                } else {
                    nogo = true;
                    showList.push("sum_req_spells");
                    update["sum_req_spells"] = "Your haven't picked any Spells."
                        + ' <span data-i18n="return-to:">Return to:</span> <div class="sheet-step sheet-next"><button class="sheet-step" type="back" value="l1-spells" data-i18n="spells">Spells</button></div>';
                }
            } else {
                showList.push("sum_spells");
                update["sum_spells"] = getTranslationByKey("character-no-spells");
            }
        } else {
            showList.push("sum_err_spells");
            update["sum_err_spells"] = "Your need to pick a Class."
        }

        // === Final phrase on top ===
        if(nogo) {
            showList.push("sum_req_sum");
            update["sum_req_sum"] = "You have missed some required fields";
            values["mancer_apply"] = "0";
        } else {
            showList.push("sum_sum");
            update["sum_sum"] = "If you are ready to build your character, click <b>APPLY</b>.";
            values["mancer_apply"] = "1";
        }
        setAttrs(values,{silent: true}, () => {
            setCharmancerText(update);
            showChoices(showList);
        });
    });

    // === GENERAL FUNCTIONS
    const get_feats = function(data) {
        // -- Feat already gained or selected
        var choices = [];

        // Race
        if(data["l1-race"]) {
            if(data["l1-race"].values.race_feat_choice) {
                choices.push(format_compendium_category("Feats",data["l1-race"].values.race_feat_choice));
            } else if(data["l1-race"].data && data["l1-race"].data.race && data["l1-race"].data.race["data-Feats"] && data["l1-race"].data.race["data-Feats"] != "Any") {
                _.each(data["l1-race"].data.race["data-Feats"].split(","), (feat) => {
                    choices.push(format_compendium_category("Feats",feat.trim()));
                });
            }
        }

        // Class
        if(data["l1-class"]) {
            if(data["l1-class"].values.class_feat_choice) {
                choices.push(format_compendium_category("Feats",data["l1-class"].values.class_feat_choice));
            }
            if(data["l1-class"].data && data["l1-class"].data.class && data["l1-class"].data.class["data-Bonus Feats"]) {
                _.each(data["l1-class"].data.class["data-Bonus Feats"].split(","), (feat) => {
                    choices.push(format_compendium_category("Feats",feat.trim()));
                });
            }
            if(data["l1-class"].values.class_subclass1
                && data["l1-class"].data && data["l1-class"].data.class_subclass1 && data["l1-class"].data.class_subclass1["data-Bonus Feat"]){
                _.each(data["l1-class"].data.class_subclass1["data-Bonus Feat"].split(","), (feat) => {
                    choices.push(format_compendium_category("Feats",feat.trim()));
                });
            }
            if(data["l1-class"].values.class_subclass2
                && data["l1-class"].data && data["l1-class"].data.class_subclass2 && data["l1-class"].data.class_subclass2["data-Bonus Feat"]) {
                _.each(data["l1-class"].data.class_subclass2["data-Bonus Feat"].split(","), (feat) => {
                    choices.push(format_compendium_category("Feats",feat.trim()));
                });
            }
        }

        // Level 1 Feat
        if(data["l1-feats"] && data["l1-feats"].values["feat_lvl1_1"]) {
            choices.push(format_compendium_category("Feats",data["l1-feats"].values["feat_lvl1_1"]));
        }

        if(mncrDebugMode) {console.log("*** DEBUG get_feats: " + choices);}
        return choices;
    };
    const format_compendium_category = function(category,value) {
        return (value.indexOf(category + ":") == -1 ? (category + ":") : "") + value.trim();
    };
    const calc_abilities = function(data) {
        var abilities_scores = {};
        // --- Preparing ability scores detailed array
        _.each(mncrAbilities, (ability) => {
            abilities_scores[ability] = {"total": 0, "base":"0","race":"0","class":"0","subclass":"0","misc":"0"};
        });
        // --- Abilities base
        if(data["l1-abilities"]) {
            _.each(mncrAbilities, function(ability) {
                if(data["l1-abilities"].values[ability]) {
                    abilities_scores[ability].base = parseInt(data["l1-abilities"].values[ability]) || 0;
                }
            });
        }
        // --- Abilities race
        if(data["l1-race"]) {
            if(data["l1-race"].data && data["l1-race"].data.race) {
                if(data["l1-race"].data.race["data-Ability Score Modifiers"]) {
                    _.each(data["l1-race"].data.race["data-Ability Score Modifiers"].split(","), (modifier) => {
                        var abrace = modifier.trim().toLowerCase();
                        if(abilities_scores[abrace.split(" ")[0].trim()]) {
                            abilities_scores[abrace.split(" ")[0].trim()].race = parseInt(abrace.split(" ")[1]) || 0;
                        }
                        else {
                            console.log("*** DEBUG ERROR ability race unsplitable: " + abrace);
                        }
                    });
                } else if(data["l1-race"].data.race["data-Ability Score Choice"] && data["l1-race"].values["race_ability_choice1"]) {
                    abilities_scores[data["l1-race"].values["race_ability_choice1"]].race = parseInt(data["l1-race"].data.race["data-Ability Score Choice"].split("+")[1]) || 0;
                }
            }
            if(data["l1-race"].values["race"] == "Index:Races") {
                //Custom race abilities bonuses
                _.each(mncrAbilities, (ability) => {
                    if(data["l1-race"].values["race_" + ability]) {
                        abilities_scores[ability].race = data["l1-race"].values["race_" + ability];
                    }
                });
            }
        }
        // --- Abilities class
        // --- Abilities subclass
        if(data["l1-class"] && data["l1-class"].values.class_subclass1_ability_choice) {
            var sbclsablt = data["l1-class"].values.class_subclass1_ability_choice.split("(")[0].toLowerCase().trim();
            var sbclsabltvalue = data["l1-class"].values.class_subclass1_ability_choice.split("(")[1].replace(/[^\d\-]/gi, "");
            abilities_scores[sbclsablt].subclass = parseInt(sbclsabltvalue) || 0;
        }
        // --- Abilities misc
        // Final abilities calculation
        _.each(mncrAbilities, (ability) => {
            abilities_scores[ability].total = (parseInt(abilities_scores[ability].base) || 0) + (parseInt(abilities_scores[ability].race) || 0) + (parseInt(abilities_scores[ability].class) || 0) + (parseInt(abilities_scores[ability].subclass) || 0) + (parseInt(abilities_scores[ability].misc) || 0);
        });
        return abilities_scores;
    };
    const calc_abilities_mod = function(abilities_scores) {
        var ability_mods = {};
        _.each(mncrAbilities, (ability) => {
            ability_mods[ability] = Math.floor(((parseInt(abilities_scores[ability].total) || 10) - 10) / 2);
        });
        return ability_mods;
    };
    const recalcData = function(currentStep = "") {
        var data = getCharmancerData();
        var update = {};
        var returnObj = {};

        if(mncrDebugMode) {console.log("*** DEBUG recalcData before:" + JSON.stringify(data,null,"  "));}

        // === ABILITIES SCORES ===
        var abilities_scores = calc_abilities(data);
        _.each(mncrAbilities, (ability) => {
            if(abilities_scores[ability].total !== 0) {
                update[ability + "_total"] = abilities_scores[ability].total;
            } else {
                update[ability + "_total"] = "-";
            }
        });

        // Abilities mods
        var ability_mods = calc_abilities_mod(abilities_scores);

        if(mncrDebugMode) {console.log("*** DEBUG recalcData abilities_scores: " + JSON.stringify(abilities_scores,null,"  "));}

        // === SAVES ===
        var saves_array = [{"name": "fortitude","ability": "constitution"},{"name": "reflex","ability": "dexterity"},{"name": "will","ability": "wisdom"}];
        var saves_scores = {};
        // --- Preparing saves detailed array
        _.each(saves_array, (save) => {
            saves_scores[save.name] = {"total":0,"base":0,"race":0,"class":0,"subclass":0,"misc":0, "ability": save.ability};
        });
        // --- Abilities bonus
        if(data["l1-abilities"]) {
            _.each(saves_array, function(save) {
                saves_scores[save.name].base = ability_mods[save.ability];
            });
        }
        // --- Saves race
        if(data["l1-race"] && data["l1-race"].data && data["l1-race"].data.race) {
            _.each(saves_array, (save) => {
                if(data["l1-race"].data.race["data-" + save.name.charAt(0).toUpperCase() + save.name.slice(1) + " Bonus"]) {
                    saves_scores[save.name].race = (parseInt(data["l1-race"].data.race["data-" + save.name.charAt(0).toUpperCase() + save.name.slice(1) + " Bonus"]) || 0);
                }
            });
        }
        // --- Saves class
        if(data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class) {
            if(data["l1-class"].data.class["data-Fortitude"]) {
                saves_scores["fortitude"].class = parseInt(data["l1-class"].data.class["data-Fortitude"]) || 0;
            }
            if(data["l1-class"].data.class["data-Reflex"]) {
                saves_scores["reflex"].class = parseInt(data["l1-class"].data.class["data-Reflex"]) || 0;
            }
            if(data["l1-class"].data.class["data-Will"]) {
                saves_scores["will"].class = parseInt(data["l1-class"].data.class["data-Will"]) || 0;
            }
        }
        // --- Saves subclass
        var subclsvbonus = 0;
        if(data["l1-class"] && data["l1-class"].values.class_subclass1) {
            if(data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class_subclass1 && data["l1-class"].data.class_subclass1["data-Saving Throws bonus"]) {
                subclsvbonus = parseInt(data["l1-class"].data.class_subclass1["data-Saving Throws bonus"].replace(/[^\d\-]/gi, "")) || 0;
                _.each(saves_array, (save) => {
                    saves_scores[save.name].subclass = parseInt(saves_scores[save.name].subclass) + subclsvbonus;
                });
            }
        }
        if(data["l1-class"] && data["l1-class"].values.class_subclass2) {
            if(data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class_subclass2 && data["l1-class"].data.class_subclass2["data-Saving Throws bonus"]) {
                subclsvbonus = parseInt(data["l1-class"].data.class_subclass2["data-Saving Throws bonus"].replace(/[^\d\-]/gi, "")) || 0;
                _.each(saves_array, (save) => {
                    saves_scores[save.name].subclass = parseInt(saves_scores[save.name].subclass) + subclsvbonus;
                });
            }
        }
        // --- Saves misc
        // Final Saves calculation
        _.each(saves_array, (save) => {
            saves_scores[save.name].total = (parseInt(saves_scores[save.name].base) || 0) + (parseInt(saves_scores[save.name].race) || 0) + (parseInt(saves_scores[save.name].class) || 0) + (parseInt(saves_scores[save.name].subclass) || 0) + (parseInt(saves_scores[save.name].misc) || 0);
            if(saves_scores[save.name].total !== 0) {
                update[save.name + "_total"] = saves_scores[save.name].total;
            } else {
                update[save.name + "_total"] = "-";
            }
        });
        if(mncrDebugMode) {console.log("*** DEBUG recalcData saves_score: " + JSON.stringify(saves_scores,null,"  "));}

        // === HIT POINTS ===
        var hp = parseInt(ability_mods["constitution"]) || 0;
        if(data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class && data["l1-class"].data.class["data-Hit Die"]) {
            hp += (parseInt(String(data["l1-class"].data.class["data-Hit Die"]).replace("d","")) || 0);
        }
        update["hit_points"] = hp > 0 ? hp : "-";

        // === Skill ranks ===
        var ranks = {"current":0,"max":0};
        if(["class","skills","summary"].includes(currentStep)) {
            var rankablt = "intelligence";
            var rankbase = 0;
            var rankbonus = 0;
            var rankrace = 0;
            // Max ranks
            if(data["l1-class"] && data["l1-class"].data && data["l1-class"].data.class && data["l1-class"].data.class["data-Skill Ranks"]) {
                if(data["l1-class"].data.class["data-Skill Ranks"].indexOf("+") !== -1) {
                    rankbase = (parseInt(data["l1-class"].data.class["data-Skill Ranks"].split("+")[0]) || 0);
                    rankablt = data["l1-class"].data.class["data-Skill Ranks"].split("+")[1];
                    if(rankablt.length) {
                        rankablt = rankablt.toLowerCase().replace(" modifier","").trim();
                    }
                }
            }
            rankbonus = ability_mods[rankablt];
            if(data["l1-race"] && data["l1-race"].data && data["l1-race"].data.race && data["l1-race"].data.race["data-Skill Ranks Bonus"]) {
                rankrace = parseInt(data["l1-race"].data.race["data-Skill Ranks Bonus"].replace(/[^\d\-]/gi, "")) || 0;
            }
            ranks.max = (rankbase + rankbonus + rankrace) < 1 ? 1 : (rankbase + rankbonus + rankrace);

            // Current ranks
            var rankstotal = 0;
            _.each(["acrobatics","appraise","bluff","climb","craft","diplomacy","disable_device","disguise","escape_artist","fly","handle_animal","heal","intimidate","knowledge_arcana","knowledge_dungeoneering","knowledge_engineering","knowledge_geography","knowledge_history","knowledge_local","knowledge_nature","knowledge_nobility","knowledge_planes","knowledge_religion","linguistics","perception","perform","profession","ride","sense_motive","sleight_of_hand","spellcraft","stealth","survival","swim","use_magic_device"], (skill) => {
                if(data["l1-skills"] && data["l1-skills"].values[skill + "_ranks"]) {
                    rankstotal += (parseInt(data["l1-skills"].values[skill + "_ranks"]) || 0);
                    ranks[skill] = 1;
                } else {
                    ranks[skill] = 0;
                }
            });
            if(rankstotal) {
                ranks.current = (parseInt(ranks.max) || 0) - rankstotal;
            } else {
                ranks.current = ranks.max;
            }

            if(currentStep == "class") {
                update["class_skill_ranks_total"] = "(" + ranks.max + ")";
            }

            if(currentStep == "summary") {
                returnObj["skillranks"] = ranks;
            }
        }

        // === SKILLS ===
        if(currentStep == "skills") {
            // === Ranks
            if(! _.isEmpty(ranks)) {
                update["skills_ranks_current"] = ranks.current;
                update["skills_ranks_max"] = ranks.max;
            }
            // === Class skills
            var skillclass = {"acrobatics":0,"appraise":0,"bluff":0,"climb":0,"craft":0,"diplomacy":0,"disable_device":0,"disguise":0,"escape_artist":0,"fly":0,"handle_animal":0,"heal":0,"intimidate":0,"knowledge_arcana":0,"knowledge_dungeoneering":0,"knowledge_engineering":0,"knowledge_geography":0,"knowledge_history":0,"knowledge_local":0,"knowledge_nature":0,"knowledge_nobility":0,"knowledge_planes":0,"knowledge_religion":0,"linguistics":0,"perception":0,"perform":0,"profession":0,"ride":0,"sense_motive":0,"sleight_of_hand":0,"spellcraft":0,"stealth":0,"survival":0,"swim":0,"use_magic_device":0};
            var classkills = [];
            if(data["l1-class"] && data["l1-class"].data.class && data["l1-class"].data.class["data-Class skills"]) {
                _.each(data["l1-class"].data.class["data-Class skills"].split(","), (skl) => {
                    classkills.push(skl.trim().toLowerCase().replace(/[^a-z\s]/gi, "").replace(/\s/gi,"_"));
                });
            }
                // Subclass1
            if(data["l1-class"] && data["l1-class"].values["class_subclass1"]) {
                if(data["l1-class"] && data["l1-class"].data["class_subclass1"] && data["l1-class"].data["class_subclass1"]["data-Class skills"]) {
                    if(data["l1-class"].values["class_subclass1_classkills_choice"]) {
                        if(classkills.indexOf(data["l1-class"].values["class_subclass1_classkills_choice"]) == -1) {
                            classkills.push(data["l1-class"].values["class_subclass1_classkills_choice"]);
                        }
                    } else {
                        _.each(data["l1-class"].data["class_subclass1"]["data-Class skills"].split(","), (skl) => {
                            var skill = skl.trim().toLowerCase().replace(/[^a-z\s]/gi, "").replace(/\s/gi,"_");
                            if(classkills.indexOf(skill) == -1) {
                                classkills.push(skill);
                            }
                        });
                    }
                }
            }
                // Subclass2
            if(data["l1-class"] && data["l1-class"].values["class_subclass2"]) {
                if(data["l1-class"] && data["l1-class"].data["class_subclass2"] && data["l1-class"].data["class_subclass2"]["data-Class skills"]) {
                    if(data["l1-class"].values["class_subclass2_classkills_choice"]) {
                        if(classkills.indexOf(data["l1-class"].values["class_subclass2_classkills_choice"]) == -1) {
                            classkills.push(data["l1-class"].values["class_subclass2_classkills_choice"]);
                        }
                    } else {
                        _.each(data["l1-class"].data["class_subclass2"]["data-Class skills"].split(","), (skl) => {
                            var skill = skl.trim().toLowerCase().replace(/[^a-z\s]/gi, "").replace(/\s/gi,"_");
                            if(classkills.indexOf(skill) == -1) {
                                classkills.push(skill);
                            }
                        });
                    }
                }
            }
            // console.log("*** DEBUG recalc classkills: " + classkills);
                // Processing
            _.each(classkills, (skill) => {
                if((skillclass[skill] == 0) && (ranks[skill] == 1)) {
                    skillclass[skill] = 3;
                }
                update[skill + "_class"] = "";
            });
            // === Abilities modifiers
            var skillablt = {"acrobatics":"dexterity","appraise":"intelligence","bluff":"charisma","climb":"strength","craft":"intelligence","diplomacy":"charisma","disable_device":"dexterity","disguise":"charisma","escape_artist":"dexterity","fly":"dexterity","handle_animal":"charisma","heal":"wisdom","intimidate":"charisma","knowledge_arcana":"intelligence","knowledge_dungeoneering":"intelligence","knowledge_engineering":"intelligence","knowledge_geography":"intelligence","knowledge_history":"intelligence","knowledge_local":"intelligence","knowledge_nature":"intelligence","knowledge_nobility":"intelligence","knowledge_planes":"intelligence","knowledge_religion":"intelligence","linguistics":"intelligence","perception":"wisdom","perform":"charisma","profession":"wisdom","ride":"dexterity","sense_motive":"wisdom","sleight_of_hand":"dexterity","spellcraft":"intelligence","stealth":"dexterity","survival":"wisdom","swim":"strength","use_magic_device":"charisma"};
            _.each(Object.keys(ability_mods), (mod) => {
                update["mod_" + mod] = (parseInt(ability_mods[mod]) || 0) < 0 ? ability_mods[mod] : "+" + ability_mods[mod];
            });
            // === Skill bonuses
            var skillbonus = {"acrobatics":0,"appraise":0,"bluff":0,"climb":0,"craft":0,"diplomacy":0,"disable_device":0,"disguise":0,"escape_artist":0,"fly":0,"handle_animal":0,"heal":0,"intimidate":0,"knowledge_arcana":0,"knowledge_dungeoneering":0,"knowledge_engineering":0,"knowledge_geography":0,"knowledge_history":0,"knowledge_local":0,"knowledge_nature":0,"knowledge_nobility":0,"knowledge_planes":0,"knowledge_religion":0,"linguistics":0,"perception":0,"perform":0,"profession":0,"ride":0,"sense_motive":0,"sleight_of_hand":0,"spellcraft":0,"stealth":0,"survival":0,"swim":0,"use_magic_device":0};
            var bonusskill = "";
                // race data-Skills Bonus
            if(data["l1-race"] && data["l1-race"].data.race && data["l1-race"].data.race["data-Skills Bonus"]) {
                bonusskill += ((bonusskill.length) ? "," : "") + data["l1-race"].data.race["data-Skills Bonus"];
            }
                // race data-Skills Bonus Choice
            if(data["l1-race"] && data["l1-race"].values.race_skill_bonus_choice){
                bonusskill += ((bonusskill.length) ? "," : "") + data["l1-race"].values.race_skill_bonus_choice;
            }
                // class data-Skills bonus
            if(data["l1-class"] && data["l1-class"].data.class && data["l1-class"].data.class["data-Skills bonus"]) {
                bonusskill += ((bonusskill.length) ? "," : "") + data["l1-class"].data.class["data-Skills bonus"];
            }
                // Sublcass1 data-Skills bonus
            if(data["l1-class"] && data["l1-class"].values["class_subclass1"]) {
                if(data["l1-class"] && data["l1-class"].data["class_subclass1"] && data["l1-class"].data["class_subclass1"]["data-Skills bonus"]) {
                    bonusskill += ((bonusskill.length) ? "," : "") + data["l1-class"].data["class_subclass1"]["data-Skills bonus"];
                }
            }
                // Sublcass1 data-Skills bonus
            if(data["l1-class"] && data["l1-class"].values["class_subclass2"]) {
                if(data["l1-class"] && data["l1-class"].data["class_subclass2"] && data["l1-class"].data["class_subclass2"]["data-Skills bonus"]) {
                    bonusskill += ((bonusskill.length) ? "," : "") + data["l1-class"].data["class_subclass2"]["data-Skills bonus"];
                }
            }
                // Calculation
            _.each(bonusskill.split(","), (skl) => {
                if(skl.indexOf("+") != -1) {
                    var skill = skl.split("+")[0].trim().toLowerCase().replace(/[^a-z\s]/gi, "").trim().replace(/\s/gi,"_");
                    skillbonus[skill] = (parseInt(skillbonus[skill]) || 0)
                                      + (parseInt(skl.split("+")[1].replace(/[^\d\-]/gi, "")) || 0);
                }
            });
            _.each(Object.keys(skillbonus), (skill) => {
                update[skill + "_bonus"] = ((parseInt(skillbonus[skill]) || 0) > 0 ? "+" : "")
                                        + ((parseInt(skillbonus[skill]) || 0) == 0 ? "" : skillbonus[skill]);
            });
            // Totals
            _.each(Object.keys(skillablt), (skill) => {
                update[skill + "_total"] = (parseInt(skillclass[skill]) || 0)
                                        + (parseInt(ranks[skill]) || 0)
                                        + (parseInt(ability_mods[skillablt[skill]]) || 0)
                                        + (parseInt(skillbonus[skill]) || 0);
            });
        }

        setCharmancerText(update);
        return returnObj;
    };
</script>
