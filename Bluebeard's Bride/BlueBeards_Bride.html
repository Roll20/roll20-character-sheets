<!-- Roll20 Character Sheet for 
    Bluebeard's Bride, published by Magpie Games: 
        http://www.magpiegames.com/bluebeards-bride/
    
    Roll20 Character Sheet author: Jason Slanga <jason@anhinga.net>
    
-->

<!-- sheet worker scripts -->
<script type="text/worker">
    // set worker attributes used for translation in roll queries
    on("sheet:opened", function(eventInfo){
        setAttrs({
            bloodname: getTranslationByKey("blood"),
            carnalityname: getTranslationByKey("carnality"),
            resiliencename: getTranslationByKey("resilience"),
            rollquerycaress: "&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=" + getTranslationByKey("movename-caress") + "}} {{moveroll=[[2d6 + @{hasringblood}]]}} {{trigger=" + getTranslationByKey("trigger-caress") + "}} {{hit=" + getTranslationByKey("hit-caress") + "}} {{partial=" + getTranslationByKey("partial-caress") + "}}",
            rollqueryviolence: "&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=" + getTranslationByKey("movename-violence") + "}} {{moveroll=[[2d6 + @{hasringcarnality}]]}} {{trigger=" + getTranslationByKey("trigger-violence") + "}} {{hit=" + getTranslationByKey("hit-violence") + "}} {{partial=" + getTranslationByKey("partial-violence") + "}}",
            rollquerycryout: "&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=" + getTranslationByKey("movename-cryout") + "}} {{moveroll=[[2d6 + @{hasringresilience}]]}} {{trigger=" + getTranslationByKey("trigger-cryout") + "}} {{hit=" + getTranslationByKey("hit-cryout") + "}} {{partial=" + getTranslationByKey("partial-cryout") + "}}"
        });
        
    });

    // update the playbook attribute when the select changes
    on("change:repeating_sisters:playbookselect", function() {
        getAttrs(["repeating_sisters_playbookselect"], function(values) {
            setAttrs({ 
                repeating_sisters_playbook:values.repeating_sisters_playbookselect,
                repeating_sisters_playbookname: getTranslationByKey(values.repeating_sisters_playbookselect)
            });
        });
    });
    
    // update the face attribute when the select changes
    on("change:repeating_sisters:faceselect", function() {
        getAttrs(["repeating_sisters_faceselect"], function(values) {
            setAttrs({ repeating_sisters_face:values.repeating_sisters_faceselect });
        });
    });
    
    // reset the trauma
    on("change:repeating_sisters:traumareset", function() {
        setAttrs({ repeating_sister_trauma:0 });
    });
    
    // update the hasring attributes
    function updatehasring(id) {
        // the id has been converted to lowercase - get the unmodified id
        getSectionIDs("sisters", function(idarray) {
           var theid;
           for (var i = 0; i < idarray.length; i++) {
               if (id == idarray[i].toLowerCase()) {
                   theid = idarray[i];
               }
           }
           
           // get all the attributes that need to be updated, plus check if we should actually update
            getAttrs([
                "repeating_sisters_" + theid + "_sisterhasring",
                "repeating_sisters_" + theid + "_playbook",
                "repeating_sisters_" + theid + "_blood",
                "repeating_sisters_" + theid + "_carnality",
                "repeating_sisters_" + theid + "_resilience"],
                function(values){
                    var newattrs = {};
                    var updateattrs = false;
                    for (v in values) {
                        switch (v.split("_").pop()) {
                            case "sisterhasring":
                                updateattrs = (values[v] == "1") ? true : false;  // should we update the values?
                                break;
                            case "playbook":
                                // newattrs["hasringname"] = values[v];
                                newattrs["hasringname"] = getTranslationByKey( values[v] );
                                break;
                            case "blood":
                                newattrs["hasringblood"] = values[v];
                                break;
                            case "carnality":
                                newattrs["hasringcarnality"] = values[v];
                                break;
                            case "resilience":
                                newattrs["hasringresilience"] = values[v];
                                break;
                            default:
                        }
                    }
                    
                    if (updateattrs) {
                        setAttrs(newattrs);
                    }
            })
           
        });
    }
    
    // handle passing the ring
    on("change:repeating_sisters", function(eventInfo) {
        // parse out the id - NB this will be set to all lowercase
        var srcid = eventInfo.sourceAttribute.split("_")[2];


        // check if we should turn the others sisters off
        if (eventInfo.sourceAttribute.split("_").pop() == "sisterhasring" && eventInfo.newValue) {
        
            // loop through all the sisters 
            getSectionIDs("sisters", function(idarray) {
                var othersisters = {};
                for (var i = 0; i < idarray.length; i++) {
                    // Are we working on the sister who has the ring?
                    if (srcid != idarray[i].toLowerCase()) {
                        othersisters["repeating_sisters_" + idarray[i] + "_sisterhasring"] = 0;
                    }
                }
                
                setAttrs(othersisters);
            });
        }

        // update the hasring attributes - the function will do validation        
        updatehasring(srcid);

    });
    
    // if the sister reaches 5 trauma, shatter!
    on("change:repeating_sisters:trauma", function(eventInfo) {
       if (eventInfo.newValue == 5) {
           setAttrs({ repeating_sisters_shattered: 1 });
       } 
    });
    
    // unshatter
    on("change:repeating_sisters:unshatter", function() {
        setAttrs({ repeating_sisters_shattered: 0 });
    });
    
</script>

<!-- end sheet worker scripts -->

<!-- wrapper for the entire sheet -->
<div class="sheet-bluebeard">

<!-- Radio Buttons for Show/Hide -->
<input type="radio" name="attr_showpages" class="attr_showpages attr_showsisters" value="The Sisters" />
<span>The Sisters</span>

<input type="radio" name="attr_showpages" class="attr_showpages attr_showmoves" value="The Moves" />
<span>The Moves</span>

<input type="radio" name="attr_showpages" class="attr_showpages attr_showbride" value="The Bride" />
<span>The Bride</span>

<input type="radio" name="attr_showpages" class="attr_showpages attr_showhelp" value="Help" checked="checked" />
<span>Help</span>

<!------------------------------------------------------------------------------
  The Sisters
-->
<div class="sheet-thesisters sheet-thepages">
    <h1 data-i18n="the-sisters">The Sisters</h1>
    
    <!-- Hidden fields to hold information about the sister who has the ring -->
    <input type="text" name="attr_hasringname" class="attr_hasringhidden" />
    <input type="number" name="attr_hasringblood" class="attr_hasringhidden" />
    <input type="number" name="attr_hasringcarnality" class="attr_hasringhidden" />
    <input type="number" name="attr_hasringresilience" class="attr_hasringhidden" />
    
    <!-- buttons to show/hide sections of the playbooks -->
    <input type="checkbox" name="attr_showbonds" class="attr_showbonds" value="1" checked="checked" 
        title="Show/Hide Sisterly Bonds" />
    <span data-i18n="sisterly-bonds">Sisterly Bonds</span>
    
    <input type="checkbox" name="attr_showwedding" class="attr_showwedding" value="1" checked="checked" 
        title="Show/Hide Wedding Prep Questions" />
    <span data-i18n="wedding-prep">Wedding Prep</span>
    
    <fieldset class="repeating_sisters">
        
        <!-- this is a DIV to describe a single sister -->
        <div class="sheet-sister">
            
            <!-- This checkbox supercedes everything - 
                if the sister is shattered, hide it all, and show a special box -->
            <input type="checkbox" name="attr_shattered" class="attr_shattered" value="1" />
        
            <!-- include a checkbox for this sister to hold the ring -->
            <input type="checkbox" name="attr_sisterhasring" class="attr_sisterhasring" value="1" />
            <span></span>
    
            <!-- Display the playbook -->
            <input type="radio" name="attr_playbook" class="attr_playbook attr_pbanimus" value="Animus" checked="checked" />
            <input type="radio" name="attr_playbook" class="attr_playbook attr_pbfatale" value="Fatale" />
            <input type="radio" name="attr_playbook" class="attr_playbook attr_pbmother" value="Mother" />
            <input type="radio" name="attr_playbook" class="attr_playbook attr_pbvirgin" value="Virgin" />
            <input type="radio" name="attr_playbook" class="attr_playbook attr_pbwitch" value="Witch" />
            <input type="text" name="attr_playbookname" class="attr_playbook" />

            <select name="attr_playbookselect" class="attr_playbookselect">
                <option value="Animus" data-i18n="animus">Animus</option>
                <option value="Fatale" data-i18n="fatale">Fatale</option>
                <option value="Mother" data-i18n="mother">Mother</option>
                <option value="Virgin" data-i18n="virgin">Virgin</option>
                <option value="Witch" data-i18n="witch">Witch</option>
            </select>
            
            <!-- Display blocks for each playbook title -->
            <div class="sheet-pbtitle sheet-pbtanimus">
                <h1 data-i18n="animus">Animus</h1>
                <p data-i18n="animus-desc">
                    You hold onto righteousness with both hands.
                    Others admire your strength and bow to your will.
                </p>
            </div>
            <div class="sheet-pbtitle sheet-pbtfatale">
                <h1 data-i18n="fatale">Fatale</h1>
                <p data-i18n="fatale-desc">
                    You drip sensuality from your lips.
                    Others watch your every move and crave for you to take control.
                </p>
            </div>
            <div class="sheet-pbtitle sheet-pbtmother">
                <h1 data-i18n="mother">Mother</h1>
                <p data-i18n="mother-desc">
                    You walk with authority.
                    Others ache for your approval, and long for you to soother their wounds.
                </p>
            </div>
            <div class="sheet-pbtitle sheet-pbtvirgin">
                <h1 data-i18n="virgin">Virgin</h1>
                <p data-i18n="virgin-desc">
                    You see beauty where there is none.
                    Others seek comfort in your warmth and delight in your obedience.
                </p>
            </div>
            <div class="sheet-pbtitle sheet-pbtwitch">
                <h1 data-i18n="witch">Witch</h1>
                <p data-i18n="witch-desc">
                    You braid magic from shadow and blood.
                    Others desire a taste of your sing and pray for your undoing.
                </p>
            </div>
            
            <!-- Display div for shattered playbooks -->
            <div class="shattered">
                <div class="shatteredanimus"></div>
                <div class="shatteredfatale"></div>
                <div class="shatteredmother"></div>
                <div class="shatteredvirgin"></div>
                <div class="shatteredwitch"></div>
                
                <p data-i18n="shattered-desc" style="text-align: center;">
                    When a sister misses her roll, the Groundskeeper may look to you
                    to describe what happens to the Bride.<br />
                    Use the following prompts to help describe what happens to the Bride:
                </p>
                
                <ul data-i18n="shattered-options">
                    <li>Answer with what you find frightening.</li>
                    <li>Illuminate the horror in beauty as well as gore.</li>
                    <li>Decribe interesting details using all five senses.</li>
                </ul>
                
                <input type="checkbox" name="attr_unshatter" class="attr_unshatter" value="1" 
                    title="Unshatter Sister" />
                <span></span>
            </div>
            
            <!-- end playbook display -->
    
            <!-- Stats -->
            <div class="sheet-stats">
                <hr />

                <h1 data-i18n="stats">Stats</h1>
                <table class="sheet-tblstats">
                    <tr>
                        <td><div><input type="number" class="attr_stat" name="attr_blood" min="-1" max="1" value="0" /></div></td>
                        <td><div><input type="number" class="attr_stat" name="attr_carnality" min="-1" max="1" value="0" /></div></td>
                        <td><div><input type="number" class="attr_stat" name="attr_resilience" min="-1" max="1" value="0" /></div></td>
                    </tr>
                    <tr>
                        <td>
                            <button type="roll" name="roll_blood" class="roll_stat roll_blood" data-i18n="blood"
                            value="&{template:bluebeard} {{sistername=@{playbookname}}} {{movename=@{bloodname}}} {{moveroll=[[2d6 + @{blood}]]}}">blood</button>
                        </td>
                        <td>
                            <button type="roll" name="roll_carnality" class="roll_stat roll_carnality" data-i18n="carnality"
                            value="&{template:bluebeard} {{sistername=@{playbookname}}} {{movename=@{carnalityname}}} {{moveroll=[[2d6 + @{carnality}]]}}">carnality</button>
                        </td>
                        <td>
                            <button type="roll" name="roll_resilience" class="roll_stat roll_resilience" data-i18n="resilience"
                            value="&{template:bluebeard} {{sistername=@{playbookname}}} {{movename=@{resiliencename}}} {{moveroll=[[2d6 + @{resilience}]]}}">reslience</button>
                        </td>
                    </tr>
                </table>
            </div>

            <!-- Face -->
            <div class="sheet-face">
                <hr />    
    
                <h1 data-i18n="face">Face</h1>
                <!-- Face select inputs for show/hide magic -->
                <input type="radio" name="attr_face" class="attr_face" value="" checked="checked" />
                <input type="radio" name="attr_face" class="attr_face attr_facebrute" value="The Brute" />
                <input type="radio" name="attr_face" class="attr_face attr_facerooster" value="The Rooster" />
                <input type="radio" name="attr_face" class="attr_face attr_faceshield" value="The Shield" />
                <input type="radio" name="attr_face" class="attr_face attr_facedancer" value="The Dancer" />
                <input type="radio" name="attr_face" class="attr_face attr_facemistress" value="The Mistress" />
                <input type="radio" name="attr_face" class="attr_face attr_facespider" value="The Spider" />
                <input type="radio" name="attr_face" class="attr_face attr_facebear" value="The Bear" />
                <input type="radio" name="attr_face" class="attr_face attr_facekingmaker" value="The Kingmaker" />
                <input type="radio" name="attr_face" class="attr_face attr_facemartyr" value="The Martyr" />
                <input type="radio" name="attr_face" class="attr_face attr_facelily" value="The Lily" />
                <input type="radio" name="attr_face" class="attr_face attr_facemoth" value="The Moth" />
                <input type="radio" name="attr_face" class="attr_face attr_facevictim" value="The Victim" />
                <input type="radio" name="attr_face" class="attr_face attr_facemedium" value="The Medium" />
                <input type="radio" name="attr_face" class="attr_face attr_facereaper" value="The Reaper" />
                <input type="radio" name="attr_face" class="attr_face attr_faceviper" value="The Viper" />

                <select name="attr_faceselect" class="attr_faceselect">
                    <option value=""></option>
                    <!-- The Animus -->
                    <option value="The Brute" data-i18n="the-brute" class="attr_faceanimus">The Brute</option>
                    <option value="The Rooster" data-i18n="the-rooster" class="attr_faceanimus">The Rooster</option>
                    <option value="The Shield" data-i18n="the-shield" class="attr_faceanimus">The Shield</option>
                    <!-- The Fatale -->
                    <option value="The Dancer" data-i18n="the-dancer" class="attr_facefatale">The Dancer</option>
                    <option value="The Mistress" data-i18n="the-mistress" class="attr_facefatale">The Mistress</option>
                    <option value="The Spider" data-i18n="the-spider" class="attr_facefatale">The Spider</option>
                    <!-- The Mother -->
                    <option value="The Bear" data-i18n="the-bear" class="attr_facemother">The Bear</option>
                    <option value="The Kingmaker" data-i18n="the-kingmaker" class="attr_facemother">The Kingmaker</option>
                    <option value="The Martyr" data-i18n="the-martyr" class="attr_facemother">The Martyr</option>
                    <!-- The Virgin -->
                    <option value="The Lily" data-i18n="the-lily" class="attr_facevirgin">The Lily</option>
                    <option value="The Moth" data-i18n="the-moth" class="attr_facevirgin">The Moth</option>
                    <option value="The Victim" data-i18n="thevictim" class="attr_facevirgin">The Victim</option>
                    <!-- The Witch -->
                    <option value="The Medium" data-i18n="the-medium" class="attr_facewitch">The Medium</option>
                    <option value="The Reaper" data-i18n="the-reaper" class="attr_facewitch">The Reaper</option>
                    <option value="The Viper" data-i18n="the-viper" class="attr_facewitch">The Viper</option>
                </select>
                
                <!-- All the face moves -->
                
                <!-- Animus: The Brute -->
                <div class="sheet-facemove sheet-facebrute sheet-moveblock">
                    <h2 data-i18n="the-brute">The Brute</h2>
                    <p data-i18n="the-brute-desc">
                        When you <em>investigate a mysterious object</em> by breaking it,
                        ask a follow-up question about the object. Its essence still remains, 
                        but the item can no longer be investigated by any Sister.
                    </p>
                </div>
                
                <!-- Animus: The Rooster -->
                <div class="sheet-facemove sheet-facerooster sheet-moveblock">
                    <h2 data-i18n="the-rooster">The Rooster</h2>
                    <p data-i18n="the-rooster-desc">
                        Mark one trauma to give a direct order to an NPC. 
                        They do it, but choose one: Your order&hellip;
                    </p>
                    <ul data-i18n="the-rooster-options">
                        <li>is carried out to the letter and then some.</li>
                        <li>is overwhelming and carried out sloppily.</li>
                        <li>is not something they can do, and a third party steps in to carry it out.</li>
                    </ul>
                </div>
                
                <!-- Animus: The Shield -->
                <div class="sheet-facemove sheet-faceshield sheet-moveblock">
                    <h2 data-i18n="the-shield">The Shield</h2>
                    <p data-i18n="the-shield-desc">
                        When one of your Sisters marks trauma, explain to her how
                        the trauma she is experiencing is her fault, then ask if she
                        believes you. If she believes you, she marks one less trauma. 
                        Ifshe rejects your explanation, mark one trauma as you experience 
                        the shame of your own impotence.
                    </p>
                </div>
                
                <!-- Fatale: The Dancer -->
                <div class="sheet-facemove sheet-facedancer sheet-moveblock">
                    <h2 data-i18n="the-dancer">The Dancer</h2>
                    <p data-i18n="the-dancer-desc">
                        Remove a piece of your clothing to <em>care for someone</em>. 
                        That item of clothing is lost to you forever, but it feeds the appetite
                        of the horror or servant until the Bride speaks again.
                    </p>
                </div>
                
                <!-- Fatale: The Mistress -->
                <div class="sheet-facemove sheet-facemistress sheet-moveblock">
                    <h2 data-i18n="the-mistress">The Mistress</h2>
                    <p data-i18n="the-mistress-desc">
                        You are the one really in control.
                        Mark one trauma to take the ring from your Sister.
                    </p>
                </div>
                
                <!-- Fatale: The Spider -->
                <div class="sheet-facemove sheet-facespider sheet-moveblock">
                    <h2 data-i18n="the-spider">The Spider</h2>
                    <p data-i18n="the-spider-desc">
                        Your beauty and charm get you what you want.
                        When you trap a servant or horror with your feminine wiles, 
                        they will tell you a secret about either the house or Bluebeard.
                    </p>
                    <p data-i18n="the-spider-desc2">
                        Mark a trauma to ask a follow-up question.
                    </p>
                </div>
                
                <!-- Mother: The Bear -->
                <div class="sheet-facemove sheet-facebear sheet-moveblock">
                    <h2 data-i18n="the-bear">The Bear</h2>
                    <p data-i18n="the-bear-desc">
                        When a Sister provokes trauma, you can step in and punish
                        the Sister who truly deserves it. Tell the guilty Sister to mark
                        the trauma instead, and mark one trauma for yourself as well,
                        as your failure to prevent this is self evident.
                    </p>
                </div>
                
                <!-- Mother: The Kingmaker -->
                <div class="sheet-facemove sheet-facekingmaker sheet-moveblock">
                    <h2 data-i18n="the-kingmaker">The Kingmaker</h2>
                    <p data-i18n="the-kingmaker-desc">
                        When you insist a male servant or horror deserves more power
                        than they currently have and give them a gift, you have found
                        your champion. Heal one trauma.
                    </p>
                </div>
                
                <!-- Mother: The Martyr -->
                <div class="sheet-facemove sheet-facemartyr sheet-moveblock">
                    <h2 data-i18n="the-martyr">The Martyr</h2>
                    <p data-i18n="the-martyr-desc">
                        You will take your love to the ends of this world. When you
                        offer forgiveness for a Sister’s sins, mark trauma, one for two,
                        to heal that Sister.
                    </p>
                </div>
                
                <!-- Virgin: The Lily -->
                <div class="sheet-facemove sheet-facelily sheet-moveblock">
                    <h2 data-i18n="the-lily">The Lily</h2>
                    <p data-i18n="the-lily-desc">
                       Your beauty is a candle in the darkness. 
                       When you <em>care for someone</em> by showing them something beautiful, 
                       you do not have to demonstrate your sincerity. 
                    </p>
                </div>
                
                <!-- Virgin: The Moth -->
                <div class="sheet-facemove sheet-facemoth sheet-moveblock">
                    <h2 data-i18n="the-moth">The Moth</h2>
                    <p data-i18n="the-moth-desc">
                        When you <em>investigate a mysterious object</em> by placing
                        yourself in immediate danger, the Groundskeeper asks you a
                        question off the list provided. Your answer is truth. Mark a
                        trauma to earn a second question.
                    </p>
                </div>
                
                <!-- Virgin: The Victim -->
                <div class="sheet-facemove sheet-facevictim sheet-moveblock">
                    <h2 data-i18n="the-victim">The Victim</h2>
                    <p data-i18n="the-victim-desc">
                        When you <em>caress a horror</em> by inviting it to come closer,
                        mark one trauma to take a 10+ instead of rolling.
                    </p>
                </div>
                
                <!-- Witch: The Medium -->
                <div class="sheet-facemove sheet-facemedium sheet-moveblock">
                    <h2 data-i18n="the-medium">The Medium</h2>
                    <p data-i18n="the-medium-desc">
                        Spill your blood to commune with the horrors of the room.
                        Mark one trauma and the Groundskeeper will share whisperings 
                        about what happened here, and might ask you a question
                        or two; answer them.
                    </p>
                </div>
                
                <!-- Witch: The Reaper -->
                <div class="sheet-facemove sheet-facereaper sheet-moveblock">
                    <h2 data-i18n="the-reaper">The Reaper</h2>
                    <p data-i18n="the-reaper-desc">
                        When a fellow Sister shatters, you feed on a piece of the Bride’s
                        soul. Heal two trauma.
                    </p>
                </div>
                
                <!-- Witch: The Viper -->
                <div class="sheet-facemove sheet-faceviper sheet-moveblock">
                    <h2 data-i18n="the-viper">The Viper</h2>
                    <p data-i18n="the-viper-desc">
                        When you <em>care for a servant</em> by poisoning them with
                        your lies, they choke on your words and die.
                    </p>
                </div>
                
            </div>
            
            <!-- Trauma -->
            <div class="trauma tooltip">
                <hr />
            
                <!-- put a reset button on top of the title -->
                <span data-i18n="reset-trauma" class="tooltiptext">reset Trauma</span>
                <input type="checkbox" name="attr_traumareset" class="attr_traumareset" value="1" />
                
                <h1 data-i18n="trauma">Trauma</h1>
                
                <div class="sheet-traumatrack">
                    <input type="radio" name="attr_trauma" class="attr_trauma attr_trauma0" value="0" checked="checked" />
                    <input type="radio" name="attr_trauma" class="attr_trauma" value="1" /><span></span>
                    <input type="radio" name="attr_trauma" class="attr_trauma" value="2" /><span></span>
                    <input type="radio" name="attr_trauma" class="attr_trauma" value="3" /><span></span>
                    <input type="radio" name="attr_trauma" class="attr_trauma" value="4" /><span></span>
                    <input type="radio" name="attr_trauma" class="attr_trauma" value="5" /><span></span>
                </div>
            </div>
        
            <!-- Sisterly Bonds -->
            <div class="bonds">
                <hr />
            
                <h1 data-i18n="sisterly-bonds">Sisterly Bonds</h1>
                <p data-i18n="sisterly-bonds-desc">You trust your sisters&hellip; for the most part, but&hellip;</p>
                <textarea name="attr_bond1" class="attr_bond"></textarea>
                <textarea name="attr_bond2" class="attr_bond"></textarea>
            </div>
    
            <!-- Wedding Prep -->
            <div class="weddingprep">
                <hr />
            
                <h1 data-i18n="wedding-prep">Wedding Prep</h1>
                <ul class="weddingquestions">
                    <li>
                        <p data-i18n="weddinganimus-1" class="weddingquestion weddinganimus">What are the Bride's hands like?</p>
                        <p data-i18n="weddingfatale-1" class="weddingquestion weddingfatale">What does the Bride's mouth look like?</p>
                        <p data-i18n="weddingmother-1" class="weddingquestion weddingmother">What is the Bride's figure like?</p>
                        <p data-i18n="weddingvirgin-1" class="weddingquestion weddingvirgin">What do the Bride's eyes look like?</p>
                        <p data-i18n="weddingwitch-1" class="weddingquestion weddingwitch">What is the Bride's hair like?</p>
                        <textarea name="attr_look1" class="attr_wedding"></textarea>
                    </li>
                    <li>
                        <p data-i18n="weddinganimus-2" class="weddingquestion weddinganimus">What weakness do you give away when others hold your hand?</p>
                        <p data-i18n="weddingfatale-2" class="weddingquestion weddingfatale">How do others keep her quiet?</p>
                        <p data-i18n="weddingmother-2" class="weddingquestion weddingmother">What do others wish was different about it?</p>
                        <p data-i18n="weddingvirgin-2" class="weddingquestion weddingvirgin">How do others know you want them when they gaze into your eyes?</p>
                        <p data-i18n="weddingwitch-2" class="weddingquestion weddingwitch">How do others like you to wear it?</p>
                        <textarea name="attr_look2" class="attr_wedding"></textarea>
                    </li>
                    <li>
                        <p data-i18n="leave-behind">What are you leaving behind from your provincial life, to become Bluebeard's Bride?</p>
                        <textarea name="attr_leavebehind" class="attr_wedding"></textarea>
                    </li>
                    <li>
                        <p data-i18n="gesture">When you first met, what loving gesture did Bluebeard make that won you over?</p>
                        <textarea name="attr_gesture" class="attr_wedding"></textarea>
                    </li>
                    <li>
                        <p data-i18n="gift">What gift did you present to Bluebeard before the wedding? Why did you choose this?</p>
                        <textarea name="attr_gift" class="attr_wedding"></textarea>
                    </li>
                    <li>
                        <p data-i18n="trust">Do you trust your generous husband, Bluebeard, or do you hold unkind suspicions? Why is that?</p>
                        <textarea name="attr_trust" class="attr_wedding"></textarea>
                    </li>
                </ul>
            </div>
            <!-- end wedding prep -->
    
        </div>
        
    </fieldset>

</div>

<!------------------------------------------------------------------------------
  The Moves
-->
<div class="themoves thepages">
    <h1 data-i18n="The Moves">The Moves</h1>
    <!-- who has the ring? -->
    <div class="hasring">
        <!--
        <input type="text" name="attr_hasring" disabled="true" class="attr_hasring" value="@{hasringname}" />
        -->
        <span name="attr_hasringname" class="attr_hasring" data-i18n-dynamic></span>
        <span data-i18n="hasthering">has the ring.</span>
    </div>

    <!-- container for three columns of moves -->
    <div class="movescolumns">
        <!-- Maiden Moves -->
        <div class="sheet-maidenmoves sheet-movescol">
            <h1></h1>
            <h1 data-i18n="Maiden Moves">Maiden Moves</h1>
            
            <!-- Care for Someone -->
            <div class="sheet-moveblock">
                <h2 data-i18n="care-for-someone">Care for Someone</h2>
                <p data-i18n="care-for-someone-desc">
                    When you <em>care for someone</em> (servant or horror), you ease their suffering
                    and bridle their torment.
                </p>
                <p data-i18n="care-for-someone2">
                    They may demand a demonstration of your sincerity.
                </p>
            </div>
            
            <!-- Investigate a Mysterious object -->
            <div class="sheet-moveblock">
                <h2 data-i18n="investigate-a-mysterious-object">Investigate a Mysterious Object</h2>
                <p data-i18n="investigate-a-mysterious-object-desc">
                    When you <em>investigate a mysterious object</em> from a room, ask two:
                </p>
                <ul data-i18n="investigate-a-mysterious-object-options">
                    <li>Whose item is this?</li>
                    <li>What memories does this item hold?</li>
                    <li>What about this item is odd or uncanny?</li>
                    <li>Why did Bluebeard keep this item?</li>
                </ul>
            </div>
            
            <!-- Take Stock -->
            <div class="sheet-moveblock">
                <h2 data-i18n="take-stock">Take Stock</h2>
                <p data-i18n="take-stock-desc">When you <em>take stock</em> of a tense situation, ask one:</p>
                <ul data-i18n="take-stock-options">
                    <li>What stalks the Bride from the shadows?</li>
                    <li>What traps have been laid for the Bride?</li>
                    <li>What does this place demand of the Bride?</li>
                    <li>What horror here is hidden from the Bride?</li>
                </ul>
            </div>
            
        </div>
        <!-- end maiden moves -->
        
        <!-- Ring Moves -->
        <div class="sheet-ringmoves sheet-movescol">
            <h1></h1>
            <h1 data-i18n="ring-moves">Ring Moves</h1>
            
            <!-- Shiver from Fear -->
            <div class="sheet-moveblock">
                <h2 data-i18n="shiver-from-fear">Shiver from Fear</h2>
                <p data-i18n="shiver-from-fear-desc">
                    When you <em>shiver from fear</em>, name the thing you are most afraid will happen;
                    the Groundskeeper will tell you how it's worse than you feared.
                    Keep the ring and choose two, or pass the ring and choose one:
                </p>
                <ul data-i18n="shiver-from-fear-options">
                    <li>It infects the Bride with its perversion.</li>
                    <li>It has the Bride in its clutches right now.</li>
                    <li>It speaks to you. Take one trauma&hellip; Just you, Sister.</li>
                </ul>
            </div>
            
            <!-- Caress a Horror -->
            <div class="sheet-moveblock">
                <h2>
                    <!-- These spans are used for translation in pre-processing -->
                    <span style="display: none" data-i18n="movename-caress">Caress a Horro</span>
                    <span style="display: none" data-i18n="trigger-caress">When you Caress a Horror, roll +Blood.</span>
                    <span style="display: none" data-i18n="hit-caress">On a hit, the horror is swayed by your stroke; direct what was intended for you to another victim in the house.</span>
                    <span style="display: none" data-i18n="partial-caress">On a hit, the horror is swayed by your stroke; direct what was intended for you to another victim in the house.
                            On a 7-9, it will shift its attention, but only if you participate in some way.</span>
                    
                    <button type="roll" name="roll_caress" class="roll_move roll_caress" 
                            value="@{rollquerycaress}"></button>
                
                    <!--
                    <button type="roll" name="roll_caress" class="roll_move roll_caress" 
                            value="&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=Caress a Horror}} {{moveroll=[[2d6 + @{hasringblood}]]}} {{trigger=When you Caress a Horror, roll +Blood.}} {{hit=On a hit, the horror is swayed by your stroke; directwhat was intended for you to another victim in the house.}} {{partial=On a hit, the horror is swayed by your stroke; directwhat was intended for you to another victim in the house.
                            On a 7-9, it will shift its attention, but only if you participate in some way.}}"></button>
                    -->
                </h2>
                <p data-i18n="caress-a-horror-desc">
                    When you <em>caress a horror</em>, roll +Blood. 
                    On a hit, the horror is swayed by your stroke;
                    direct what was intended for you to another victim in the house.
                </p>
                <p data-i18n="caress-a-horror-desc2">
                    On a 7-9, it will shift its attention, but only if you participate in some way.
                </p>
            </div>
            
            <!-- Dirty Yourself with Violence -->
            <div class="sheet-moveblock">
                <h2>
                    <!-- These spans are used for translation in pre-processing -->
                    <span style="display: none" data-i18n="movename-violence">Dirty Yourself with Violence</span>
                    <span style="display: none" data-i18n="trigger-violence">When you Dirty Yourself With Violence, roll +Carnality.</span>
                    <span style="display: none" data-i18n="hit-violence">On a hit, you inflict harm as established and choose one:
                            ◆ Disable them
                            ◆ Silence them
                            ◆ Mutilate them</span>
                    <span style="display: none" data-i18n="partial-violence">On a hit, you inflict trauma as established and choose one:
                            ◆ Disable them
                            ◆ Silence them
                            ◆ Mutilate them
                            
                            On a 7-9, choose one from below as well:
                            ◆ Your vulnerability opens you up to trauma
                            ◆ Your carelessness leaves you in a bad spot</span>

                    <button type="roll" name="roll_violence" class="roll_move roll_violence" 
                            value="@{rollqueryviolence}"></button>
                    
                    <!--
                    <button type="roll" name="roll_violence" class="roll_move roll_violence" 
                            value="&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=Dirty Yourself with Violence}} {{moveroll=[[2d6 + @{hasringcarnality}]]}} {{trigger=When you Dirty Yourself With Violence, roll +Carnality.}} {{hit=On a hit, you inflict harm as established and choose one:
                            ◆ Disable them
                            ◆ Silence them
                            ◆ Mutilate them}} {{partial=On a hit, you inflict trauma as established and choose one:
                            ◆ Disable them
                            ◆ Silence them
                            ◆ Mutilate them
                            
                            On a 7-9, choose one from below as well:
                            ◆ Your vulnerability opens you up to trauma
                            ◆ Your carelessness leaves you in a bad spot}}"></button>
                    -->
                </h2>
                <p data-i18n="dirty-yourself-with-violence-desc">
                    When you <em>dirty yourself with violence</em>, roll +Carnality.
                    On a hit, you inflict trauma as established and choose one:
                </p>
                <ul data-i18n="dirty-yourself-with-violence-options">
                    <li>Disable them</li>
                    <li>Silence them</li>
                    <li>Mutilate them</li>
                </ul>
                <p data-i18n="dirty-yourself-with-violence-desc2">
                    On a 7-9, choose one from below as well:
                </p>
                <ul data-i18n="dirty-yourself-with-violence-options2">
                    <li>Your vulnerability opens you up to trauma</li>
                    <li>Your carelessness leaves you in a bad spot</li>
                </ul>
                
            </div>
            
            <!-- Cry Out for Help -->
            <div class="sheet-moveblock">
                <h2>
                    <!-- These spans are used for translation in pre-processing -->
                    <span style="display: none" data-i18n="movename-cryout">Cry Out for Help HEY!</span>
                    <span style="display: none" data-i18n="trigger-cryout">When you break down and Cry Out for Help, roll +Reslience.</span>
                    <span style="display: none" data-i18n="hit-cryout">On a hit, a house servant comes to address your concerns and calm your hysteria.</span>
                    <span style="display: none" data-i18n="partial-cryout">On a hit, a house servant comes to address your concerns and calm your hysteria.
                            On a 7-9, they help you, but they first need proof of your loyalty to Bluebeard.</span>

                    <button type="roll" name="roll_cryout" class="roll_move roll_cryout" 
                            value='@{rollquerycryout}'></button>
                        
                    <!--
                    <button type="roll" name="roll_cryout" class="roll_move roll_cryout" 
                            value="&{template:bluebeard} {{sistername=@{hasringname}}} {{movename=Cry Out for Help}} {{moveroll=[[2d6 + @{hasringresilience}]]}} {{trigger=When you break down and Cry Out for Help, roll +Reslience.}} {{hit=On a hit, a house servant comes to address your concerns and calm your hysteria.}} {{partial=On a hit, a house servant comes to address your concerns and calm your hysteria.
                            On a 7-9, they help you, but they first need proof of your loyalty to Bluebeard.}}"></button>
                    -->
                </h2>
                <p data-i18n="cry-out-for-help-desc">
                    When you break down and <em>cry out for help</em>, roll +Resilience.
                    On a hit, a house servant comes to address your concerns and calm your hysteria.
                    On a 7-9, they help you, but they first need proof of your loyalty to Bluebeard.
                </p>
            </div>
            
            <!-- Give Up the Ring -->
            <div class="sheet-moveblock">
                <h2 data-i18n="give-up-the-ring">Give Up the Ring</h2>
                <p data-i18n="give-up-the-ring-desc">
                    When you voluntarily <em>give up the ring</em>, pass the ring to the next Sister.
                    You are immune to trauma until that Sister passes the ring.
                </p>
            </div>
        </div>
        
        <!-- Exit Moves -->
        <div class="sheet-exitmoves sheet-movescol">
            <h1></h1>
            <h1 data-i18n="exit-moves">Exit Moves</h1>
            
            <!-- Escape -->
            <div class="sheet-moveblock">
                <h2 data-i18n="escape">Escape</h2>
                <p data-i18n="escape-desc">
                    When you attempt to <em>escape</em> <i>without</i> propsing a truth,
                    the Groundskeeper will offer you a hard bargain or ugly choice.
                    If you pay the price, you escape.
                </p>
            </div>
            
            <!-- Propose a Truth -->
            <div class="sheet-moveblock">
                <h2 data-i18n="propose-a-truth">Propose a Truth</h2>
                <p data-i18n="propose-a-truth-desc">
                    When you <em>propose a truth</em> about a room,
                    detail what you think happened in the the room, to whom, and why.
                    Next describe the token you take that supports your interpretation 
                    of what happened here and mark it on the appropriate token track.
                </p>
                
                <p data-i18n="propose-a-truth-desc2" class="sheet-moveoption">
                    If it is a <em>token of Faithfulness</em>, 
                    you are close to proving that your trust in your husband is well placed;
                    heal one trauma.
                </p>
                
                <p data-i18n="propose-a-truth-desc3" class="sheet-moveoption">
                    If it is a <em>token of Disloyalty</em>, you are closer to proving
                    that your unkind suspicions about your husband are true;
                    mark one trauma.
                </p>
            </div>
        </div>
    </div>
</div>

<!------------------------------------------------------------------------------
  The Bride
-->
<div class="sheet-thebride sheet-thepages">
    <h1 data-i18n="the-bride">The Bride</h1>
    <p data-i18n="the-bride-desc">
        Do you arrive at the final room as a faithful Bride whose trust in her generous husband is well placed?<br />
        Or are you a disloyal Bride, who harbors unkind suspicions?
    </p>
    
    <!-- hold two columns -->
    <div class="sheet-bridecols">
        
        <div class="sheet-bridecol sheet-bridefaithful">
            <h1 data-i18n="faithfulness">faithfulness</h1>
            <div class="sheet-tokenrow">
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_faithful1" class="attr_faithful attr_token" value="1" />
                    <span></span>
                </div>
                <div class="sheet-truthbox">
                    <input type="text" name="attr_faithfultoken1" class="attr_token" placeholder="A token of faithfulness" />
                    <textarea name="attr_faithfultruth1" class="attr_truth" placeholder="A truth"></textarea>
                </div>
            </div>
            <div class="sheet-tokenrow">
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_faithful2" class="attr_faithful attr_token" value="1" />
                    <span></span>
                </div>
                <div class="sheet-truthbox">
                    <input type="text" name="attr_faithfultoken2" class="attr_token" placeholder="A token of faithfulness" />
                    <textarea name="attr_faithfultruth2" class="attr_truth" placeholder="A truth"></textarea>
                </div>
            </div>
            <div class="sheet-tokenrow">
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_faithful3" class="attr_faithful attr_token" value="1" />
                    <span></span>
                </div>
                <div class="sheet-truthbox">
                    <input type="text" name="attr_faithfultoken3" class="attr_token" placeholder="A token of faithfulness" />
                    <textarea name="attr_faithfultruth3" class="attr_truth" placeholder="A truth"></textarea>
                </div>
            </div>
        </div>
        
        <div class="sheet-bridecol sheet-bridedisloyal">
            <h1 data-i18n="disloyalty">disloyalty</h1>
            <div class="sheet-tokenrow">
                <div class="sheet-truthbox">
                    <input type="text" name="attr_disloyaltoken1" class="attr_token" placeholder="A token of disloyalty" />
                    <textarea name="attr_disloyaltruth1" class="attr_truth" placeholder="A truth"></textarea>
                </div>
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_disloyal1" class="attr_disloyal attr_token" value="1" />
                    <span></span>
                </div>
            </div>
            <div class="sheet-tokenrow">
                <div class="sheet-truthbox">
                    <input type="text" name="attr_disloyaltoken2" class="attr_token" placeholder="A token of disloyalty" />
                    <textarea name="attr_disloyaltruth2" class="attr_truth" placeholder="A truth"></textarea>
                </div>
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_disloyal2" class="attr_disloyal attr_token" value="1" />
                    <span></span>
                </div>
            </div>
            <div class="sheet-tokenrow">
                <div class="sheet-truthbox">
                    <input type="text" name="attr_disloyaltoken3" class="attr_token" placeholder="A token of disloyalty" />
                    <textarea name="attr_disloyaltruth3" class="attr_truth" placeholder="A truth"></textarea>
                </div>
                <div class="sheet-tokenbox">
                    <input type="checkbox" name="attr_disloyal3" class="attr_disloyal attr_token" value="1" />
                    <span></span>
                </div>
            </div>
        </div>
        
    </div>

<!-- end sheet-thebride -->
</div>

<!------------------------------------------------------------------------------
  Help
-->
<div class="sheet-help sheet-thepages">
    <h1 data-i18n="help">Help</h1>
    
    <p data-i18n="help-desc">
        Select different sections of the playsheet using the tabs at the top 
        of the page. The currently selected section will have a white border 
        and text.
    </p>
    
    <hr />
    
    <h2 data-i18n="the-sisters">The Sisters</h2>
    
    <p data-i18n="the-sisters-desc">
        This page contains information for individual sisters, all displayed
        on a single page. Use the tabs at the top to toggle visibility of the
        <em>Sisterly Bonds</em>, and <em>Wedding Preparation</em> sections.
        Add a new sister using the "Add" button at the bottom of the page. 
        Use the "Modify" button to change the order of the sisters, or remove
        a sister.
    </p>
    
    <h3 data-i18n="adding-a-new-sister">Adding a New Sister</h3>
    <p data-i18n="adding-a-new-sister-desc">
        When a new sister is added, click on the sister's playbook name to 
        bring up a dropdown box. In the <em>Stats</em> section, use the arrows
        next to each number to increase or decrease the stats. 
        In the <em>Face</em> section, click the face title to bring up a
        dropdown menu, just as with the playbook. Use the tabs at the top of 
        the page to display the <em>Sisterly Bonds</em> and <em>Wedding Prep</em>.
    </p>
    
    <h3 data-i18n="stats-trauma-passing-the-ring">Stats, Trauma, and Passing the Ring</h3>
    <p data-i18n="stats-trauma-passing-the-ring-desc">
        Click the name of each Stat to make a roll with that stat. 
    </p>
    <p data-i18n="stats-trauma-passing-the-ring-desc2">
        Click the heart icons in the <em>Trauma</em> section to increase
        and decrease the Sister's Trauma. You can reset the Trauma completely
        by clicking the "Trauma" title.
        When a Sister reaches 5 Trauma, her block will automatically change to 
        the "Shattered" block. If a Sister is shattered accidentally, you can
        "unshatter" her block by clicking the heart icon.
    </p>
    <p data-i18n="stats-trauma-passing-the-ring-desc3">
        At the top left of each Sister's block is a Ring icon, faded out by 
        default. Click the icon on a Sister's block to pass the ring to that Sister.
        When rolling Moves, the sheet will automatically use the Stats for the 
        Sister who is currently holding the Ring.
    </p>
    
    <hr />
    
    <h2 data-i18n="the-moves">The Moves</h2>
    <p data-i18n="the-moves-desc">
        This page describes the various moves.
        The top of this page shows the Sister who is currently holding the Ring.
        This Sister's Stats will be used, if a move requires a roll.
    </p>
    <p data-i18n="the-moves-desc2">
        If a Move calls for a roll, click the name of that Move to make the
        roll automatically. A black border to will appear when hovering
        over the name, to indicate that you can make a roll.
    </p>
    
    <hr />
    
    <h2 data-i18n="the-bride">The Bride</h2>
    <p data-i18n="the-bride-desc">
        Use this page to track the Bride's progress thru the mansion.
        When the Bride aquires Tokens of <em>Faithfulness</em> and
        <em>Disloyalty</em>, click the appropriate icon, and enter information
        about the Token in the text boxes.
    </p>
    
    
    
</div>

<!-- end sheet-bluebeard -->
</div>


<!------------------------------------------------------------------------------
  Roll Template 
-->
<rolltemplate class="sheet-rolltemplate-bluebeard">
    <!-- container for the roll output -->
    <div class="sheet-rollbox">
        <!-- Describe the roll -->
        <div class="sheet-rolltitle">
            <span class="sheet-rollsistername">{{sistername}}</span>
            <span data-i18n="isrolling">is rolling</span>
            <div class="sheet-movename">{{movename}}</div>
            <!--
            {{#statused}}
                <div class="sheet-statline">
                    using 
                    <span class="sheet-statused">{{statused}}</span>
                </div>
            {{/statused}}
            -->
        </div>
        
        <!-- Show the roll result -->
        <div class="sheet-rollresult">
            <div class="sheet-moveroll">{{moveroll}}</div>
    
            <div class="sheet-rolldescription">
                <p class="sheet-rolltrigger">{{trigger}}</p>
                
                {{#rollGreater() moveroll 9}}
                    <p class="sheet-rollhit">{{hit}}</p>
                    <p class="sheet-rolldetails">{{details}}</p>
                {{/rollGreater() moveroll 9}}
                
                {{#rollBetween() moveroll 7 9}}
                    <p class="sheet-rollpartial">{{partial}}</p>
                    <p class="sheet-rolldetails">{{details}}</p>
                {{/rollBetween() moveroll 7 9}}
                
                {{#rollLess() moveroll 7}}
                    <p class="sheet-rollmiss">{{miss}}</p>
                {{/rollLess() moveroll 7}}
                
            </div>

        </div>
    </div>
</rolltemplate>
