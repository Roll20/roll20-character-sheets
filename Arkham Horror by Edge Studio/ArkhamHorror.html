<!-- BEGIN SHEET -->
<input name="attr_SetupDone" style="display: none;" type="text" value="0">
<input type="radio" class="sheet-page1" name="attr_page" value="1" checked="checked" id="sheet-page1">
    <label for="sheet-page1" data-i18n="main-c">Main</label>
<input type="radio" class="sheet-page2" name="attr_page" value="2" id="sheet-page2">
    <label for="sheet-page2" data-i18n="background-c">Background</label>


<div class="sheet-page1 background1">
	<div style="display: inline-block; vertical-align: top; width: 820px; height: 1060px; margin: -18px 0px 0px 0px; border: 0px solid Red">
		<div style="width: 800px; height: 60px; margin: 16px 0px 0px 26px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 160px;"  data-i18n="character_name:-c">Character Name:</label>
			<input  name="attr_character_name" type="text" class="sheet-text" style="width: 220px; " />
			
			<label class="sheet-label" style="width: 170px; margin-left: -4px"  data-i18n="character_archetype:-c">Character Archetype:</label>
			<input  name="attr_character_archetype" type="text" class="sheet-text" style="width: 170px; " />
			
			<label class="sheet-label" style="width: 130px"  data-i18n="player_name:-c">Player Name:</label>
			<input  name="attr_player_name" type="text" class="sheet-text" style="width: 240px; " />
			
			<label class="sheet-label" style="width: 140px;"  data-i18n="total_xp_earned:-c">Total XP Earned:</label>
			<input  name="attr_character_xp_earned" type="text" class="sheet-text" style="width: 50px; " />
			
			<label class="sheet-label" style="width: 90px;"  data-i18n="unused_xp:-c">Unused XP:</label>
			<input  name="attr_character_xp_unused" type="text" class="sheet-text" style="width: 50px; " />
		</div>
		
		<div style="width: 800px; height: 190px; margin: 0px 0px 0px 26px; border: 2px solid Black;">
			<!-- Dice Dashboard -->
			<div style="width: 740px; height: 80px; margin: 0px 0px 0px 30px; border: 2px solid Black;">
					<input type="hidden" name="attr_die1_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 40px" ><input name="attr_die1" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
					<input type="hidden" name="attr_die2_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 60px" ><input name="attr_die2" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
					<input type="hidden" name="attr_die3_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 60px" ><input name="attr_die3" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
					<input type="hidden" name="attr_die4_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 60px" ><input name="attr_die4" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
					<input type="hidden" name="attr_die5_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 60px" ><input name="attr_die5" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
					<input type="hidden" name="attr_die6_background_oolor" value="0" class="sheet-toggle">
					<div class="sheet-cell" style="display: inline-block; vertical-align: top; width: 58px; height: 52px; margin: 10px 0px 0px 60px" ><input name="attr_die6" style="width: 56px; height: 54px; background-color: transparent; font-family: dicefontd6; font-size:62px; font-weight: normal; color: inherit; margin: -4px 0px 0px 0px; border: none;" readonly value="f" /></div>
			</div>
			<!-- First line --> 
			<label class="sheet-label" style="width: 140px;" data-i18n="dice_pool:-c">Dice Pool:</label>
			<input  name="attr_dice_pool" type="text" class="sheet-text" style="width: 40px; font-style: normal;" value="6"/>

			<label class="sheet-label" style="width: 140px;" data-i18n="pool_limit:-c">Pool Limit:</label>
			<input  name="attr_pool_limit" type="text" class="sheet-text" style="width: 40px; font-style: normal;" value="6" />

			<label class="sheet-label" style="width: 66px;" data-i18n="damage:-c">Damage:</label>
			<input  name="attr_damage" type="text" class="sheet-text" style="width: 30px; font-style: normal;" value="0" />

			<label class="sheet-label" style="width: 114px; color: rgb(14, 76, 146); margin-left: 96px;" data-i18n="bonus/penalty:-c">Bonus/Penalty:</label>
			<input  name="attr_bonus_penalty" type="text" class="sheet-text" style="width: 30px; font-style: normal;" value="0" />
			
			<!-- Second line --> 
			<label class="sheet-label" style="width: 140px;" data-i18n="normal_dice:-c">Normal Dice:</label>
			<input  name="attr_normal_dice" type="text" class="sheet-text" style="width: 40px; font-style: normal;" value="6" />

			<label class="sheet-label" style="width: 140px;" data-i18n="horror_dice:-c">Horror Dice:</label>
			<input  name="attr_horror_dice" type="text" class="sheet-text" style="width: 40px; font-style: normal;" value="0" />

			<label class="sheet-label" style="width: 150px;" data-i18n="horror_dice_limit:-c">Horror Dice Limit:</label>
			<input  name="attr_horror_dice_limit" type="text" class="sheet-text" style="width: 30px; font-style: normal;" value="0" />

			<input id="Advantage" type="checkbox" name="attr_advantage" class="colorToggle" value="1">
			<label class="colorToggle sheet-label" style='margin: 0px;  font-size: 16px;' for="Advantage" data-i18n="advantage-c">Advantage</label>

			<input id="Disadvantage" type="checkbox" name="attr_disadvantage" class="colorToggle" value="1">
			<label class="colorToggle sheet-label" style='margin: 0px;  font-size: 16px;' for="Disadvantage" data-i18n="disadvantage-c">Disadvantage</label>

			<!-- Third line --> 
			<label class="sheet-label" style="width: 150px;" data-i18n="temp_normal_dice:-c">Temp Normal Dice:</label>
			<input  name="attr_temporary_normal_dice" type="text" class="sheet-text" style="width: 30px; font-style: normal; margin-left: -2px"  value="0" />

			<label class="sheet-label" style="width: 150px;" data-i18n="temp_horror_dice:-c">Temp Horror Dice:</label>
			<input  name="attr_temporary_horror_dice" type="text" class="sheet-text" style="width: 30px; font-style: normal; margin-left:  2px"  value="0" />

			<button class="btn sheet-skillName" type="action" name="act_refresh" style="width: 66px; margin: 0px 0px 0px 16px; padding: 2px 2px 2px 2px; background-color: rgb(226,226,221); border: 1px solid Brown;">
				<label  style="margin: 0; padding: 2px; font-size: 1.0em;" data-i18n="refresh-c">Refresh</label>
			</button>
		</div>
		
		<div style="display: inline-block; vertical-align: top; width: 450px; height: 274px; margin: 0px 0px 0px 26px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 234px;"  data-i18n="skills-c">Skills</label>
			<hr style="width: 90%; height: 0px; border-bottom: 3px solid DimGray; margin: -4px 0px 0px 5%;">

			<button class="btn sheet-skillName" type="action" name="act_agility" style="margin: 16px 12px 0px 0px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="agility-c">Agility</label>
			</button>
			<input  name="attr_skill_agility"     type="text" class="sheet-circle" style="z-index: 2; position: relative; margin: 8px 0px 0px -4px;" />
			<label class="sheet-label" style="width: 24px; height: 12px; font-size: 10px; margin: -6px 0px 0px -12px;"  data-i18n="max.-c">Max.</label>
			<input  name="attr_skill_agility_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 18px 0px 0px -30px;" />

			<button class="btn sheet-skillName" type="action" name="act_knowledge" style="margin: 16px 38px 0px 12px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="knowledge-c">Knowledge</label>
			</button>
			<input  name="attr_skill_knowledge"     type="text" class="sheet-circle" style="z-index: 2; position: relative; margin: 8px 0px 0px -4px;" />
			<label class="sheet-label" style="width: 24px; height: 12px; font-size: 10px; margin: -6px 0px 0px -12px;"  data-i18n="max.-c">Max.</label>
			<input  name="attr_skill_knowledge_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 18px 0px 0px -30px;" />

			<button class="btn sheet-skillName" type="action" name="act_athletics" style="margin: 6px 12px 0px 0px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="athletics-c">Athletics</label>
			</button>
			<input  name="attr_skill_athletics"     type="text" class="sheet-circle" style="z-index: 3; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_athletics_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_resolve" style="margin: 6px 38px 0px 12px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="resolve-c">Resolve</label>
			</button>
			<input  name="attr_skill_resolve"     type="text" class="sheet-circle" style="z-index: 3; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_resolve_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_wits" style="margin: 6px 12px 0px 0px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="wits-c">Wits</label>
			</button>
			<input  name="attr_skill_wits"     type="text" class="sheet-circle" style="z-index: 4; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_wits_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_meleeCombat" style="margin: 6px 38px 0px 12px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="meleeCombat-c">Melee Combat</label>
			</button>
			<input  name="attr_skill_melee_combat"     type="text" class="sheet-circle" style="z-index: 4; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_melee_combat_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_presence" style="margin: 6px 12px 0px 0px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="presence-c">Presence</label>
			</button>
			<input  name="attr_skill_presence"     type="text" class="sheet-circle" style="z-index: 5; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_presence_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_rangedCombat" style="margin: 6px 38px 0px 12px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="rangedCombat-c">Ranged Combat</label>
			</button>
			<input  name="attr_skill_ranged_combat"     type="text" class="sheet-circle" style="z-index: 5; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_ranged_combat_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_intuition" style="margin: 6px 12px 0px 0px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="intuition-c">Intuition</label>
			</button>
			<input  name="attr_skill_intuition"     type="text" class="sheet-circle" style="z-index: 6; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_intuition_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />

			<button class="btn sheet-skillName" type="action" name="act_lore" style="margin: 6px 38px 0px 12px; background-color: rgb(226,226,221); border: 0px solid Brown;">
				<label  style="background-color: rgb(226,226,221); font-size: 1.0em;" data-i18n="lore-c">Lore</label>
			</button>
			<input  name="attr_skill_lore"     type="text" class="sheet-circle" style="z-index: 6; position: relative; margin: -6px 0px 0px -4px;" />
			<input  name="attr_skill_lore_max" type="text" class="sheet-circle" style="z-index: 1; position: relative; width: 34px; height: 30px; margin: 4px 0px 0px -8px;" />
		</div>
		<div style="display: inline-block; vertical-align: top; width: 300px; height: 278px; margin: 0px 0px 0px 4px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 170px;"  data-i18n="insight-c">Insight</label>
			<hr style="width: 90%; height: 0px; border-bottom: 3px solid DimGray; margin: -4px 0px 0px 5%;">
			<div style="display: inline-block; vertical-align: top; width: 280px; height: 80px; border-radius: 50px; margin: 6px 0px 0px 8px; border: 4px solid Black;">
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 114px; height: 14px; text-align: center; font-size: 10px; margin: -2px 0px 0px 14px; color: Black;"  data-i18n="limit-u">LIMIT</label>
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 114px; height: 14px; text-align: center; font-size: 10px; margin: -2px 14px 0px 0px; color: Black;"  data-i18n="remaining-u">REMAINING</label>
				<input  name="attr_insight_limit"     type="text" class="sheet-text" style="width: 56px; height: 56px; font-style: normal; margin: 0px 0px 0px 50px;" value="1"/>
				<input  name="attr_insight_remaining" type="text" class="sheet-text" style="width: 56px; height: 56px; font-style: normal; margin: 0px 0px 0px 60px;" value="1"/>
			</div>
			<hr style="width: 90%; height: 0px; border-bottom: 3px solid DimGray; margin: 4px 0px 0px 5%;">
			<label class="sheet-label" style="width: 114px; height: 14px; text-align: left; font-size: 12px; margin: 6px 0px 0px 4px; color: Black;"  data-i18n="personalityTrait:-c">Personality Trait:</label>
			<input  name="attr_personality_trait1" type="text" class="sheet-text" style="width: 320px; height: 22px; font-size: 14px; margin: 0px 0px 0px 10px;" />
			<input  name="attr_personality_trait2" type="text" class="sheet-text" style="width: 320px; height: 22px; font-size: 14px; margin: -2px 0px 0px 10px;" />

			<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 60px; height: 14px; text-align: left; font-size: 12px; margin: -8px 0px 0px 6px; color: Black;"  data-i18n="positive:-c">Positive:</label>
			<input  name="attr_personality_trait_positive1" type="text" class="sheet-text" style="width: 260px; height: 22px; font-size: 14px; margin: -20px 0px 0px 70px;" />
			<input  name="attr_personality_trait_positive2" type="text" class="sheet-text" style="width: 260px; height: 22px; font-size: 14px; margin: -20px 0px 0px 70px;" />

			<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 60px; height: 14px; text-align: left; font-size: 12px; margin: -28px 0px 0px 6px; color: Black;"  data-i18n="negative:-c">Negative:</label>
			<input  name="attr_personality_trait_negative1" type="text" class="sheet-text" style="width: 260px; height: 22px; font-size: 14px; margin: -40px 0px 0px 70px;" />
			<input  name="attr_personality_trait_negative2" type="text" class="sheet-text" style="width: 260px; height: 22px; font-size: 14px; margin: -40px 0px 0px 70px;" />
		</div>
		
		<!-- Knacks-->
		<div style="width: 790px; margin: 0px 0px 0px 26px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 800px; font-size: 20px; text-align: center; margin: -8px 0px 0px -8px;"  data-i18n="knacks-c">Knacks</label>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid DimGray; margin: -6px 0px 0px 0;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack1_1" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier1:-c">Tier 1:</label>
				</button>
				<textarea name="attr_knack1_1_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack1_1_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack1_2" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier1:-c">Tier 1:</label>
				</button>
				<textarea name="attr_knack1_2_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack1_2_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack1_3" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier1:-c">Tier 1:</label>
				</button>
				<textarea name="attr_knack1_3_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack1_3_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack2_1" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier2:-c">Tier 2:</label>
				</button>
				<textarea name="attr_knack2_1_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack2_1_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack2_2" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier2:-c">Tier 2:</label>
				</button>
				<textarea name="attr_knack2_2_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack2_2_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack3_1" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier3:-c">Tier 3:</label>
				</button>
				<textarea name="attr_knack3_1_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack3_1_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack3_2" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier3:-c">Tier 3:</label>
				</button>
				<textarea name="attr_knack3_2_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack3_2_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">

			<div style="display: inline-block; vertical-align: top; width: 110px; border: 0px solid Green;">
				<button class="btn sheet-skillName" type="action" name="act_knack4_1" style="width: 110px; height: 16px; font-size: 14px; text-align: center; margin: 0; padding: 0; background-color: rgb(226,226,221); border: 0px solid Brown;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;" data-i18n="tier4:-c">Tier 4:</label>
				</button>
				<textarea name="attr_knack4_1_name" style="display: inline-block; vertical-align: top; height: 36px; width: 100px; font-size: 14px; resize: none; background-color: transparent; margin: -4px 0px 0px 0px; border: 1px solid DimGray;" placeholder="Knack Name"></textarea>
			</div>
			<textarea name="attr_knack4_1_description" style="display: inline-block; vertical-align: top; height: 50px; width: 670px; font-size: 12px; max-width: 670px; background-color: transparent; margin: 0px 0px 0px -4px; border: 1px solid DimGray;" placeholder="Knack Notes"></textarea>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid Black; margin: -2px 0px 0px 0px;">
		</div>
		<!-- Weapons -->
		<div style="width: 790px; height: 260px; margin: 0px 0px 0px 26px; border: 2px solid transparent;">
			<div style="display: inline-block; vertical-align: top; width: 450px; height: 254px; margin: 6px 0px 0px 2px; border: 2px solid transparent;">
				<label class="sheet-label" style="width: 450px; font-size: 20px; text-align: center; margin: 0px 0px 0px 0px;"  data-i18n="weapons-c">Weapons</label>
				<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -2px 0px 0px 1%;">
			<!-- Weapon 1 -->
				<button class="btn sheet-skillName" type="action" name="act_weapon1" style="display: inline-block; vertical-align: top; width: 90px; height: 20px; font-size: 12px; text-align: center; margin: 0px 0px 0px 14px; padding: 0;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;"  data-i18n="weaponName:-c">Weapon Name:</label>
				</button>
				<input  name="attr_weapon_name_1" type="text" class="sheet-text" style="width: 320px; height: 20px; font-size: 14px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 40px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 14px; padding: 0;"  data-i18n="skill:-c">Skill:</label>
				<select  name="attr_weapon_skill_1" class="sheet-text" style="width: 100px; height: 16px; font-size: 11px; margin: -2px 0px 0px 0px; padding: 0px 2px 0px 2px;">
					<option value="" selected></option>
					<option value="skill_melee_combat" data-i18n="meleeCombat-c">Melee Combat</option>
					<option value="skill_ranged_combat" data-i18n="rangedCombat-c">Ranged Combat</option>
				</select>

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 4px; padding: 0;"  data-i18n="damage:-c">Damage:</label>
				<input  name="attr_weapon_damage_1" type="text" class="sheet-text" style="width: 90px; height: 16px; font-size: 12px; margin: 2px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 90px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 4px; padding: 0;"  data-i18n="injuryRating:-c">Injury Rating:</label>
				<input  name="attr_weapon_injury_rating_1" type="text" class="sheet-text" style="width: 30px; height: 16px; font-size: 12px; margin: -2px 0px 0px 0px;" />

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 14px; padding: 0;"  data-i18n="range:-c">Range:</label>
				<input  name="attr_weapon_range_1" type="text" class="sheet-text" style="width: 190px; height: 16px; font-size: 12px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 74px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 0px; padding: 0;"  data-i18n="ammunition:-c">Ammunition:</label>
				<div style="display: inline-block; vertical-align: top; width: 100px; height: 12px; margin: -6px 0px 0px -2px; border: 0px solid Black;">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo1_weapon1" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo2_weapon1" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo3_weapon1" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo4_weapon1" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo5_weapon1" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo6_weapon1" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
				</div>
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 80px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 14px; padding: 0;"  data-i18n="specialRules:-c">Special Rules:</label>
				<input  name="attr_weapon_special_rules_1" type="text" class="sheet-text" style="width: 344px; height: 16px; font-size: 12px; margin: -6px 0px 0px 0px;" />
				<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -10px 0px 0px 1%;">
			<!-- Weapon 2 -->
				<button class="btn sheet-skillName" type="action" name="act_weapon2" style="display: inline-block; vertical-align: top; width: 90px; height: 20px; font-size: 12px; text-align: center; margin: 0px 0px 0px 14px; padding: 0;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;"  data-i18n="weaponName:-c">Weapon Name:</label>
				</button>
				<input  name="attr_weapon_name_2" type="text" class="sheet-text" style="width: 320px; height: 20px; font-size: 14px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 40px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 14px; padding: 0;"  data-i18n="skill:-c">Skill:</label>
				<select  name="attr_weapon_skill_2" class="sheet-text" style="width: 100px; height: 16px; font-size: 11px; margin: -2px 0px 0px 0px; padding: 0px 2px 0px 2px;">
					<option value="" selected></option>
					<option value="skill_melee_combat" data-i18n="meleeCombat-c">Melee Combat</option>
					<option value="skill_ranged_combat" data-i18n="rangedCombat-c">Ranged Combat</option>
				</select>

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 4px; padding: 0;"  data-i18n="damage:-c">Damage:</label>
				<input  name="attr_weapon_damage_2" type="text" class="sheet-text" style="width: 90px; height: 16px; font-size: 12px; margin: 2px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 90px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 4px; padding: 0;"  data-i18n="injuryRating:-c">Injury Rating:</label>
				<input  name="attr_weapon_injury_rating_2" type="text" class="sheet-text" style="width: 30px; height: 16px; font-size: 12px; margin: -2px 0px 0px 0px;" />

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 14px; padding: 0;"  data-i18n="range:-c">Range:</label>
				<input  name="attr_weapon_range_2" type="text" class="sheet-text" style="width: 190px; height: 16px; font-size: 12px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 74px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 0px; padding: 0;"  data-i18n="ammunition:-c">Ammunition:</label>
				<div style="display: inline-block; vertical-align: top; width: 100px; height: 12px; margin: -6px 0px 0px -2px; border: 0px solid Black;">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo1_weapon2" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo2_weapon2" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo3_weapon2" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo4_weapon2" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo5_weapon2" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo6_weapon2" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
				</div>
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 80px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 14px; padding: 0;"  data-i18n="specialRules:-c">Special Rules:</label>
				<input  name="attr_weapon_special_rules_2" type="text" class="sheet-text" style="width: 344px; height: 16px; font-size: 12px; margin: -6px 0px 0px 0px;" />
				<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -10px 0px 0px 1%;">

			<!-- Weapon 3 -->
				<button class="btn sheet-skillName" type="action" name="act_weapon3" style="display: inline-block; vertical-align: top; width: 90px; height: 20px; font-size: 12px; text-align: center; margin: 0px 0px 0px 14px; padding: 0;">
					<label  style="text-align: center; margin: 0; padding: 0; font-size: 1.0em;"  data-i18n="weaponName:-c">Weapon Name:</label>
				</button>
				<input  name="attr_weapon_name_3" type="text" class="sheet-text" style="width: 320px; height: 20px; font-size: 14px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 40px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 14px; padding: 0;"  data-i18n="skill:-c">Skill:</label>
				<select  name="attr_weapon_skill_3" class="sheet-text" style="width: 100px; height: 16px; font-size: 11px; margin: -2px 0px 0px 0px; padding: 0px 2px 0px 2px;">
					<option value="" selected></option>
					<option value="skill_melee_combat" data-i18n="meleeCombat-c">Melee Combat</option>
					<option value="skill_ranged_combat" data-i18n="rangedCombat-c">Ranged Combat</option>
				</select>

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: 0px 0px 0px 4px; padding: 0;"  data-i18n="damage:-c">Damage:</label>
				<input  name="attr_weapon_damage_3" type="text" class="sheet-text" style="width: 90px; height: 16px; font-size: 12px; margin: 2px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 90px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 4px; padding: 0;"  data-i18n="injuryRating:-c">Injury Rating:</label>
				<input  name="attr_weapon_injury_rating_3" type="text" class="sheet-text" style="width: 30px; height: 16px; font-size: 12px; margin: -2px 0px 0px 0px;" />

				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 50px; height: 10px; font-size: 12px; text-align: left; margin: -2px 0px 0px 14px; padding: 0;"  data-i18n="range:-c">Range:</label>
				<input  name="attr_weapon_range_3" type="text" class="sheet-text" style="width: 190px; height: 16px; font-size: 12px; margin: 0px 0px 0px 0px;" />
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 74px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 0px; padding: 0;"  data-i18n="ammunition:-c">Ammunition:</label>
				<div style="display: inline-block; vertical-align: top; width: 100px; height: 12px; margin: -6px 0px 0px -2px; border: 0px solid Black;">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo1_weapon3" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo2_weapon3" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo3_weapon3" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo4_weapon3" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo5_weapon3" style="margin: 2px 0px 0px 2px" data-i18n-title="ammo-c" value="1">
					<input type="checkbox" class="rounded-checkbox" name="attr_ammo6_weapon3" style="margin: 2px 0px 0px 0px" data-i18n-title="ammo-c" value="1">
				</div>
				<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 80px; height: 10px; font-size: 12px; text-align: left; margin: -4px 0px 0px 14px; padding: 0;"  data-i18n="specialRules:-c">Special Rules:</label>
				<input  name="attr_weapon_special_rules_3" type="text" class="sheet-text" style="width: 344px; height: 16px; font-size: 12px; margin: -6px 0px 0px 0px;" />
				<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -8px 0px 0px 1%;">
			</div>
			<div style="display: inline-block; vertical-align: top; width: 320px; height: 254px; margin: 6px 0px 0px 2px; border: 2px solid transparent;">
				<label class="sheet-label" style="width: 320px; font-size: 20px; text-align: center; margin: 0px 0px 0px 0px;"  data-i18n="injuriesAndOtherEffects">Injuries and Other Effects</label>
				<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -2px 0px 0px 1%;">
				<textarea name="attr_injuries_effects" style="display: inline-block; vertical-align: top; height: 190px; width: 300px; font-size: 12px; max-width: 310px; background-color: transparent; margin: 6px 4px 4px 4px; border: 1px solid DimGray;"></textarea>
			</div>			
		</div>
	</div>
</div>

<div class="sheet-page2 background2" >
	<div style="display: inline-block; vertical-align: top; width: 820px; height: 1060px; margin: -8px 0px 0px 0px; border: 0px solid Blue">
		<div style="display: inline-block; vertical-align: top; width: 500px; height: 510px; margin: 16px 0px 0px 26px; border: 2px solid Black;">
			<label class="sheet-label" style="width: 470px; text-align: center; font-size: 20px; margin: -6px 0px 0px 0px;"  data-i18n="background-c">Background</label>
			<hr style="width: 96%; height: 0px; border-bottom: 3px solid DimGray; margin: -2px 0px 0px 1%;">

			<label class="sheet-label" style="width: 470px; text-align: left; font-size: 14px; height: 16px; margin: 4px 0px 0px 4px;"  data-i18n="placeOfOrigin:">Place of Origin:</label>
			<textarea name="attr_place_of_origin" style="display: inline-block; vertical-align: top; height: 66px; width: 466px; font-size: 12px; max-width: 466px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 470px; text-align: left; font-size: 14px; height: 16px; margin: -2px 0px 0px 4px;"  data-i18n="familyAndFriends:">Family and Friends:</label>
			<textarea name="attr_family_and_friends" style="display: inline-block; vertical-align: top; height: 66px; width: 466px; font-size: 12px; max-width: 466px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 290px; text-align: left; font-size: 14px; height: 14px; margin: -4px 0px 0px 4px;"  data-i18n="employment:-c">Employment:</label>
			<label class="sheet-label" style="width: 96px; text-align: left; font-size: 14px; height: 14px; margin: -4px 0px 0px 0px;"  data-i18n="weeklySalary:-c">Weekly Salary:</label>
			<input  name="attr_weekly_salary" type="text" class="sheet-text" style="width: 70px; height: 18px; font-size: 12px; margin: 0px 0px 0px -2px;" />
			<textarea name="attr_employment" style="display: inline-block; vertical-align: top; height: 66px; width: 466px; font-size: 12px; max-width: 466px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 470px; text-align: left; font-size: 14px; height: 14px; margin: -4px 0px 0px 4px;"  data-i18n="firstSupernaturalEncounter:-c">First Supernatural Encounter:</label>
			<textarea name="attr_family_and_friends" style="display: inline-block; vertical-align: top; height: 66px; width: 466px; font-size: 12px; max-width: 466px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 470px; text-align: left; font-size: 14px; height: 14px; margin: -4px 0px 0px 4px;"  data-i18n="notableEnemies:-c">Notable Enemies:</label>
			<textarea name="attr_notable_enemies" style="display: inline-block; vertical-align: top; height: 66px; width: 466px; font-size: 12px; max-width: 466px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>
		</div>
		
		<div style="display: inline-block; vertical-align: top; width: 258px; height: 460px; margin: 20px 0px 0px 20px; border: 2px solid Black;">
			<img name="attr_character_avatar" title="ID Photograph: 258w x 460h pixels" style="width: 258px; height: 460px; border: 0px solid Blue; background: White; margin: 0px 0px 0px 0px;"> 
		</div>
		<div style="display: inline-block; vertical-align: top; width: 380px; height: 500px; margin: 6px 0px 0px 26px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 380px; text-align: center; font-size: 20px; margin: -6px 0px 0px 0px;"  data-i18n="mundaneResources-c">Mundane Resources</label>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid DimGray; margin: -2px 0px 0px 1%;">

			<label class="sheet-label" style="display: inline-block; vertical-align: top; width: 48px; text-align: left; font-size: 14px; height: 16px; margin: 4px 0px 0px 4px;"  data-i18n="money:-c">Money:</label>
			<textarea name="attr_money" style="display: inline-block; vertical-align: top; height: 54px; width: 304px; font-size: 12px; max-width: 304px; background-color: transparent; margin: 6px 0px 0px 0px; border: 1px solid DimGray;" placeholder="$50"></textarea>

			<label class="sheet-label" style="width: 370px; text-align: left; font-size: 14px; height: 16px; margin: -10px 0px 0px 4px;"  data-i18n="equipment:-c">Equipment:</label>
			<textarea name="attr_equipment" style="display: inline-block; vertical-align: top; height: 126px; width: 360px; font-size: 12px; max-width: 360px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 370px; text-align: left; font-size: 14px; height: 16px; margin: -6px 0px 0px 4px;"  data-i18n="vehicle:-c">Vehicle:</label>
			<textarea name="attr_vehicle" style="display: inline-block; vertical-align: top; height: 76px; width: 360px; font-size: 12px; max-width: 360px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 370px; text-align: left; font-size: 14px; height: 16px; margin: -2px 0px 0px 4px;"  data-i18n="lodging:-c">Lodging:</label>
			<textarea name="attr_lodging" style="display: inline-block; vertical-align: top; height: 104px; width: 360px; font-size: 12px; max-width: 360px; background-color: transparent; margin: 0px 0px 0px 8px; border: 1px solid DimGray;" ></textarea>

		</div>
		<div style="display: inline-block; vertical-align: top; width: 380px; height: 500px; margin: 6px 0px 0px 6px; border: 2px solid transparent;">
			<label class="sheet-label" style="width: 380px; text-align: center; font-size: 20px; margin: -6px 0px 0px 0px;"  data-i18n="supernaturalResources-c">Supernatural Resources</label>
			<hr style="width: 100%; height: 0px; border-bottom: 3px solid DimGray; margin: -2px 0px 0px 1%;">

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 16px; margin: 8px 0px 0px 16px; padding: 0;"  data-i18n="tome:-c">Tome:</label>
			<textarea name="attr_tome_1" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: 0px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="tome:-c">Tome:</label>
			<textarea name="attr_tome_2" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -8px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="tome:-c">Tome:</label>
			<textarea name="attr_tome_3" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="relic:-c">Relic:</label>
			<textarea name="attr_relic_1" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="relic:-c">Relic:</label>
			<textarea name="attr_relic_2" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="relic:-c">Relic:</label>
			<textarea name="attr_relic_3" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="eldritchDebtOrFavor:">Eldritch Debt or Favor:</label>
			<textarea name="attr_eldritch_debt_or_favor_1" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>

			<label class="sheet-label" style="width: 360px; text-align: left; font-size: 12px; height: 12px; margin: -2px 0px 0px 16px; padding: 0;"  data-i18n="eldritchDebtOrFavor:">Eldritch Debt or Favor:</label>
			<textarea name="attr_eldritch_debt_or_favor_2" style="display: inline-block; vertical-align: top; height: 32px; width: 356px; font-size: 12px; max-width: 356px; background-color: transparent; margin: -6px 0px 0px 16px; border: 1px solid DimGray;" ></textarea>
		</div>
	</div>
</div>

<div class="sheet-page3" >
	<div style="display: inline-block; vertical-align: top; width: 856px; height: 44px; border:0px solid Purple">
		<hr style="width: 820px; height: 0px; border-bottom: 3px solid DimGray; margin: 4px 0px 0px 30px;">
	</div>
</div>



<rolltemplate class="sheet-rolltemplate-check">
    <div class="container">
        <div><h1>{{name}}</h1></div>
		<div class="arrow-container"><div class="arrow-right"></div></div>
 		{{#Description}}
			<div class="rowcolor"><span class="tcat" style="color: DarkRed; font-size: 1.4em; margin-right: 6px; " data-i18n="description:-c">Description:</span>{{Description}}</div>
 		{{/Description}}
		{{#Weapon}}
			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="skill:-c">Skill:</span>{{Skill}}</div>
			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="damage:-c">Damage:</span>{{Damage}}</div>
 			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="injuryRating:-c">Injury Rating:</span>{{InjuryRating}}</div>
			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="range:-c">Range:</span>{{Range}}</div>
			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="ammo:-c">Ammo:</span>{{Ammo}}</div>
			<div class="rowcolor"><span class="tcat" style="font-size: 1.4em; margin-right: 6px;" data-i18n="specialRules:-c">Special Rules:</span>{{SpecialRules}}</div>
		{{/Weapon}}

 		{{#Empty}}
			<div class="rowcolor"><span class="tcat" style="color: DarkRed; font-size: 1.4em; margin-right: 6px; " data-i18n="outOfAmmunition-c">Out Of Ammunition</span></div>
 		{{/Empty}}

		{{#Hand}}
			<div class="rowcolor"><span class="tcat" data-i18n="hand:-c">Hand: </span>
			{{#computed::NumDie}}
				{{#rollTotal() computed::NumDie 1 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span>
				{{/rollTotal() computed::NumDie 1 }}
				{{#rollTotal() computed::NumDie 2 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die2}}</span>
				{{/rollTotal() computed::NumDie 2 }}
				{{#rollTotal() computed::NumDie 3 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die2}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die3}}</span>
				{{/rollTotal() computed::NumDie 3 }}
				{{#rollTotal() computed::NumDie 4 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die2}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die3}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die4}}</span>
				{{/rollTotal() computed::NumDie 4 }}
				{{#rollTotal() computed::NumDie 5 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die2}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die3}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die4}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die5}}</span>
				{{/rollTotal() computed::NumDie 5 }}
				{{#rollTotal() computed::NumDie 6 }}
					<span style="font-family: dicefontd6; font-size: 2.0em;">{{Die1}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die2}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die3}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die4}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die5}}</span><span style="font-family: dicefontd6; font-size: 2.0em;">{{Die6}}</span>
				{{/rollTotal() computed::NumDie 6 }}
			{{/computed::NumDie}}

			{{#computed::HorrorDie}}
				{{#rollTotal() computed::HorrorDie 1 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span>
				{{/rollTotal() computed::HorrorDie 1 }}
				{{#rollTotal() computed::HorrorDie 2 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror2}}</span>
				{{/rollTotal() computed::HorrorDie 2 }}
				{{#rollTotal() computed::HorrorDie 3 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror2}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror3}}</span>
				{{/rollTotal() computed::HorrorDie 3 }}
				{{#rollTotal() computed::HorrorDie 4 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror2}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror3}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror4}}</span>
				{{/rollTotal() computed::HorrorDie 4 }}
				{{#rollTotal() computed::HorrorDie 5 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror2}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror3}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror4}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror5}}</span>
				{{/rollTotal() computed::HorrorDie 5 }}
				{{#rollTotal() computed::HorrorDie 6 }}
					<span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror1}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror2}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror3}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror4}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(34, 139, 34);" data-i18n-title="horror-c">{{Horror5}}</span><span style="font-family: dicefontd6; font-size: 2.0em; color: rgb(80, 200, 120);" data-i18n-title="horror-c">{{Horror6}}</span>
				{{/rollTotal() computed::HorrorDie 6 }}
			{{/computed::HorrorDie}}
			
			{{#rollGreater() computed::AdvantageFlag 0}}
				<span style="font-family: dicefontd6; font-size: 2.0em; color: Purple;" data-i18n-title="advantage-c">{{AdvantageDie}}</span>
			{{/rollGreater() computed::AdvantageFlag 0}}
			{{#rollGreater() computed::DisadvantageFlag 0}}
				<span style="font-family: dicefontd6; font-size: 2.0em; color: Orange;" data-i18n-title="disadvantage-c">{{DisadvantageDie}}</span>
			{{/rollGreater() computed::DisadvantageFlag 0}}
			</div>

			{{#rollGreater() computed::TraumaDie 0}}
				<div class="rowcolor"><span class="tcat" style="color: DarkRed;" data-i18n="traumaDie:-c">Trauma Die: </span><span style="font-size: 1.4em;">{{computed::TraumaDie}}</span></div>
			{{/rollGreater() computed::TraumaDie 0}}
			</div>		
 		{{/Hand}}		


</rolltemplate>

<script type="text/worker">

on("clicked:refresh", function(eventInfo) {
	let TriggerName = eventInfo.triggerName;
	let Name = eventInfo.triggerName.substring(8); 
	//console.log("  TriggerName: " + TriggerName);
	//console.log("  Name: " + Name);
	//console.log("  eventInfo: " + JSON.stringify(eventInfo));
	//console.log(" clicked:refresh");
	
	getAttrs(["pool_limit", "horror_dice_limit", "damage", "die1", "die2", "die3", "die4", "die5", "die6","die1_background_oolor","die2_background_oolor","die3_background_oolor","die4_background_oolor","die5_background_oolor","die6_background_oolor"], function(values) {
		let PoolLimit = parseInt(values.pool_limit)||0;
		let HorrorDiceLimit = parseInt(values.horror_dice_limit)||0;
		let Damage = parseInt(values.damage)||0;
		
		let Die1 = values.die1;
		let Die2 = values.die2;		
		let Die3 = values.die3;		
		let Die4 = values.die4;		
		let Die5 = values.die5;		
		let Die6 = values.die6;
		let Die1Background = values.die1_background_oolor;
		let Die2Background = values.die2_background_oolor;
		let Die3Background = values.die3_background_oolor;
		let Die4Background = values.die4_background_oolor;
		let Die5Background = values.die5_background_oolor;
		let Die6Background = values.die6_background_oolor;
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
		
		// Reset the Dice Record
		Die1 = "f";
		Die2 = "f";
		Die3 = "f";
		Die4 = "f";
		Die5 = "f";
		Die6 = "f";
		Die1Background = "0"; // Normal = 0, Horror = 1, Damage = 2, Spent = 3
		Die2Background = "0";
		Die3Background = "0";
		Die4Background = "0";
		Die5Background = "0";
		Die6Background = "0";
		//console.log("  PoolLimit: " + PoolLimit + " HorrorDiceLimit: " + HorrorDiceLimit);
		if (Damage > PoolLimit) { Damage = PoolLimit; }
		if (Damage < 0) { Damage = 0; }
		switch (Damage) {
			case 1 :   Die6 = "@"; Die6Background = "2"; break;
			case 2 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; break;
			case 3 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2";  break;
			case 4 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2";  break;
			case 5 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2"; Die2 = "@"; Die2Background = "2";  break;
			case 6 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2"; Die2 = "@"; Die2Background = "2"; Die1 = "@"; Die1Background = "2";  break;
			default: console.log(" No Damage " + Damage );
		}
		if (HorrorDiceLimit	> 0) {
			let Idx = 6 - Damage; 
			//console.log ("  Horror Idx = " + Idx);
			for (let j = 0; j < HorrorDiceLimit; j++) {
				//console.log ("   j = " + j + " Idx = " + Idx);
				switch (Idx) {
					case 1 :   Die1Background = "1"; break;
					case 2 :   Die2Background = "1"; break;
					case 3 :   Die3Background = "1";  break;
					case 4 :   Die4Background = "1";  break;
					case 5 :   Die5Background = "1";  break;
					case 6 :   Die6Background = "1";  break;
					default: console.log(" No Damage " + Damage );
				}
				Idx -= 1;
			}
		}
		
		let NormalDice = PoolLimit - HorrorDiceLimit - Damage;
		if (NormalDice < 0) { NormalDice = 0; } // Investigator has full hand of Horror Dice and more Damage
		let DicePool = PoolLimit - Damage;
		if (DicePool > PoolLimit) { DicePool = PoolLimit; }
		
		setAttrs({                            
			normal_dice: NormalDice, horror_dice: HorrorDiceLimit, dice_pool: DicePool,
			die1: Die1, die1_background_oolor: Die1Background,
			die2: Die2, die2_background_oolor: Die2Background,
			die3: Die3, die3_background_oolor: Die3Background,
			die4: Die4, die4_background_oolor: Die4Background,
			die5: Die5, die5_background_oolor: Die5Background,
			die6: Die6, die6_background_oolor: Die6Background
		});
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
	});
});

on("clicked:knack1_1 clicked:knack1_2 clicked:knack1_3 clicked:knack2_1 clicked:knack2_2 clicked:knack3_1  clicked:knack3_2  clicked:knack4_1", function(eventInfo) {
	let TriggerName = eventInfo.triggerName;
	let Name = eventInfo.triggerName.substring(8); 
	//console.log("  TriggerName: " + TriggerName);
	//console.log("  Name: " + Name);
	//console.log("  eventInfo: " + JSON.stringify(eventInfo));
	
	getAttrs(["knack1_1_name", "knack1_1_description", "knack1_2_name", "knack1_2_description", "knack1_3_name", "knack1_3_description","knack2_1_name", "knack2_1_description","knack2_2_name", "knack2_2_description","knack3_1_name", "knack3_1_description","knack3_2_name", "knack3_2_description","knack4_1_name", "knack4_1_description"], function(values) {
		let Name1_1 = values.knack1_1_name;
		let Description1_1 = values.knack1_1_description;
		let Name1_2 = values.knack1_2_name;
		let Description1_2 = values.knack1_2_description;
		let Name1_3 = values.knack1_3_name;
		let Description1_3 = values.knack1_3_description;
		let Name2_1 = values.knack2_1_name;
		let Description2_1 = values.knack2_1_description;
		let Name2_2 = values.knack2_2_name;
		let Description2_2 = values.knack2_2_description;
		let Name3_1 = values.knack3_1_name;
		let Description3_1 = values.knack3_1_description;
		let Name3_2 = values.knack3_2_name;
		let Description3_2 = values.knack3_2_description;
		let Name4_1 = values.knack4_1_name;
		let Description4_1 = values.knack4_1_description;
		
		
		switch (Name) {
			case "knack1_1" :   Name = Name1_1; Description = Description1_1; break;
			case "knack1_2" :   Name = Name1_2; Description = Description1_2; break;
			case "knack1_3" :   Name = Name1_3; Description = Description1_3; break;
			case "knack2_1" :   Name = Name2_1; Description = Description2_1; break;
			case "knack2_2" :   Name = Name2_2; Description = Description2_2; break;
			case "knack3_1" :   Name = Name3_1; Description = Description3_1; break;
			case "knack3_2" :   Name = Name3_2; Description = Description3_2; break;
			case "knack4_1" :   Name = Name4_1; Description = Description4_1; break;
			default: console.log(" Name " + Name + " unknown Knack");
		}		
		
		
		
		const rollBase ="&{template:check} {{name=@{character_name} *invokes* "+Name+"}} {{Description="+Description+"}}"; 

		//console.log("  rollBase = " + rollBase);

	    startRoll(rollBase, rollResult => {
			finishRoll(
				rollResult.rollId
			);
		});
	});
});

on("clicked:weapon1 clicked:weapon2 clicked:weapon3", function(eventInfo) {
	let TriggerName = eventInfo.triggerName;
	let Name = eventInfo.triggerName.substring(8); 
	//console.log("  TriggerName: " + TriggerName);
	//console.log("  Name: " + Name);
	//console.log("  eventInfo: " + JSON.stringify(eventInfo));


	getAttrs(["skill_melee_combat","skill_ranged_combat","weapon_name_1", "weapon_skill_1", "weapon_damage_1", "weapon_injury_rating_1", "weapon_range_1", "ammo1_weapon1","ammo2_weapon1", "ammo3_weapon1","ammo4_weapon1", "ammo5_weapon1","ammo6_weapon1", "weapon_special_rules_1",
	"weapon_name_2", "weapon_skill_2", "weapon_damage_2", "weapon_injury_rating_2", "weapon_range_2", "ammo1_weapon2","ammo2_weapon2", "ammo3_weapon2","ammo4_weapon2", "ammo5_weapon2","ammo6_weapon2", "weapon_special_rules_2",
	"weapon_name_3", "weapon_skill_3", "weapon_damage_3", "weapon_injury_rating_3", "weapon_range_3", "ammo1_weapon3","ammo2_weapon3", "ammo3_weapon3","ammo4_weapon3", "ammo5_weapon3","ammo6_weapon3", "weapon_special_rules_3",
	"normal_dice","horror_dice","temporary_normal_dice","temporary_horror_dice","bonus_penalty","advantage","disadvantage",
	"die1", "die2", "die3", "die4", "die5", "die6","die1_background_oolor","die2_background_oolor","die3_background_oolor","die4_background_oolor","die5_background_oolor","die6_background_oolor"], function(values) {

		let Melee = parseInt(values.skill_melee_combat)||0;
		let Ranged = parseInt(values.skill_ranged_combat)||0;
		//console.log("  Melee: " + Melee + " Ranged " + Ranged );
		
		let NormalDieAvailable = parseInt(values.normal_dice)||0;
		let HorrorDieAvailable = parseInt(values.horror_dice)||0;
		let TemporaryNormalDie = parseInt(values.temporary_normal_dice)||0;
		let TemporaryHorrorDie = parseInt(values.temporary_horror_dice)||0;
		let BonusOrPenalty = parseInt(values.bonus_penalty)||0;
		let AdvantageFlag = parseInt(values.advantage)||0;
		let DisadvantageFlag = parseInt(values.disadvantage)||0;
		let Die1 = values.die1;
		let Die2 = values.die2;		
		let Die3 = values.die3;		
		let Die4 = values.die4;		
		let Die5 = values.die5;		
		let Die6 = values.die6;
		let Die1Background = values.die1_background_oolor;
		let Die2Background = values.die2_background_oolor;
		let Die3Background = values.die3_background_oolor;
		let Die4Background = values.die4_background_oolor;
		let Die5Background = values.die5_background_oolor;
		let Die6Background = values.die6_background_oolor;

		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
														 

		//console.log(" BonusOrPenalty: " + BonusOrPenalty + " AdvantageFlag: " + AdvantageFlag + "  DisadvantageFlag: " + DisadvantageFlag);
		//console.log(" TemporaryNormalDie: " + TemporaryNormalDie + " TemporaryHorrorDie: " + TemporaryHorrorDie);
				
		let Name1 = values.weapon_name_1;
		let Skill1 = values.weapon_skill_1;
		let Damage1 = values.weapon_damage_1;
		let Injury1 = values.weapon_injury_rating_1;
		let Range1 = values.weapon_range_1;
		let Ammo1_1 = values.ammo1_weapon1;
		let Ammo1_2 = values.ammo2_weapon1;
		let Ammo1_3 = values.ammo3_weapon1;
		let Ammo1_4 = values.ammo4_weapon1;
		let Ammo1_5 = values.ammo5_weapon1;
		let Ammo1_6 = values.ammo6_weapon1;
		let Rules1 = values.weapon_special_rules_1;
		let AmmoUnused1 = 6 - Ammo1_1  - Ammo1_2 - Ammo1_3 - Ammo1_4 - Ammo1_5 - Ammo1_6;
		let NextAmmo1 = "ammo1_weapon1";
		if (Ammo1_1 == 0) {
			NextAmmo1 = "ammo1_weapon1"; 
		} else if (Ammo1_2 == 0) {
			NextAmmo1 = "ammo2_weapon1"; 
		} else if (Ammo1_3 == 0) {
			NextAmmo1 = "ammo3_weapon1"; 
		} else if (Ammo1_4 == 0) {
			NextAmmo1 = "ammo4_weapon1"; 
		} else if (Ammo1_5 == 0) {
			NextAmmo1 = "ammo5_weapon1"; 
		} else { NextAmmo1 = "ammo6_weapon1"; } // NO checking if weapon ammo is spent
		
		//console.log("  Name1: " + Name1 + " Skill1: " + Skill1 + " Injury1: " + Injury1);
		//console.log("    Range1: " + Range1 + " Damage1: " + Damage1 + " Rules1: " + Rules1 + " Next Ammo: " + NextAmmo1);
	
		let Name2 = values.weapon_name_2;
		let Skill2 = values.weapon_skill_2;
		let Damage2 = values.weapon_damage_2;
		let Injury2 = values.weapon_injury_rating_2;
		let Range2 = values.weapon_range_2;
		let Ammo2_1 = values.ammo1_weapon2;
		let Ammo2_2 = values.ammo2_weapon2;
		let Ammo2_3 = values.ammo3_weapon2;
		let Ammo2_4 = values.ammo4_weapon2;
		let Ammo2_5 = values.ammo5_weapon2;
		let Ammo2_6 = values.ammo6_weapon2;
		let Rules2 = values.weapon_special_rules_2;
		let AmmoUnused2 = 6 - Ammo2_1  - Ammo2_2 - Ammo2_3 - Ammo2_4 - Ammo2_5 - Ammo2_6;
		let NextAmmo2 = "ammo1_weapon2";
		if (Ammo2_1 == 0) {
			NextAmmo2 = "ammo1_weapon2"; 
		} else if (Ammo2_2 == 0) {
			NextAmmo2 = "ammo2_weapon2"; 
		} else if (Ammo2_3 == 0) {
			NextAmmo2 = "ammo3_weapon2"; 
		} else if (Ammo2_4 == 0) {
			NextAmmo2 = "ammo4_weapon2"; 
		} else if (Ammo2_5 == 0) {
			NextAmmo2 = "ammo5_weapon2"; 
		} else { NextAmmo2 = "ammo6_weapon2"; } // NO checking if weapon ammo is spent

		//console.log("  Name2: " + Name2 + " Skill2: " + Skill2 + " Injury2: " + Injury2);
		//console.log("    Range2: " + Range2 + " Damage2: " + Damage2 + " Rules2: " + Rules2 + " Next Ammo: " + NextAmmo2);
		
		let Name3 = values.weapon_name_3;
		let Skill3 = values.weapon_skill_3;
		let Damage3 = values.weapon_damage_3;
		let Injury3 = values.weapon_injury_rating_3;
		let Range3 = values.weapon_range_3;
		let Ammo3_1 = values.ammo1_weapon3;
		let Ammo3_2 = values.ammo2_weapon3;
		let Ammo3_3 = values.ammo3_weapon3;
		let Ammo3_4 = values.ammo4_weapon3;
		let Ammo3_5 = values.ammo5_weapon3;
		let Ammo3_6 = values.ammo6_weapon3;
		let Rules3 = values.weapon_special_rules_3;
		let AmmoUnused3 = 6 - Ammo3_1  - Ammo3_2 - Ammo3_3 - Ammo3_4 - Ammo3_5 - Ammo3_6;
		let NextAmmo3 = "ammo1_weapon3";
		if (Ammo3_1 == 0) {
			NextAmmo3 = "ammo1_weapon3"; 
		} else if (Ammo3_2 == 0) {
			NextAmmo3 = "ammo2_weapon3"; 
		} else if (Ammo3_3 == 0) {
			NextAmmo3 = "ammo3_weapon3"; 
		} else if (Ammo3_4 == 0) {
			NextAmmo3 = "ammo4_weapon3"; 
		} else if (Ammo3_5 == 0) {
			NextAmmo3 = "ammo5_weapon3"; 
		} else { NextAmmo3 = "ammo6_weapon3"; } // NO checking if weapon ammo is spent


		//console.log("  Name3: " + Name3 + " Skill3: " + Skill3 + " Injury3: " + Injury3);
		//console.log("    Range3: " + Range3 + " Damage3: " + Damage3 + " Rules3: " + Rules3 + " Next Ammo3: " + NextAmmo3);
		
		//console.log("  Ammo Unused 1: " + AmmoUnused1 + " 2: " + AmmoUnused2 + " 3: " + AmmoUnused3);
 	
		let WeaponName = "";
		let Skill = "";
		let Damage = "";
		let Injury = "";
		let Range = "";
		let Ammo1 = "";
		let Ammo2 = "";
		let Ammo3 = "";
		let Ammo4 = "";
		let Ammo5 = "";
		let Ammo6 = "";
		let Rules = "";
		let AmmoUnused =  0;
		let NextAmmo =  "ammo1_weapon1";
		let Difficulty = 6;
		
		switch (Name) {
			case "weapon1":  WeaponName = Name1; Skill = Skill1; Damage = Damage1; Injury = Injury1; Range = Range1; Rules = Rules1; Ammo1 = Ammo1_1; Ammo2 = Ammo1_2; Ammo3 = Ammo1_3; Ammo4 = Ammo1_4; Ammo5 = Ammo1_5; Ammo6 = Ammo1_6; AmmoUnused = AmmoUnused1; NextAmmo = NextAmmo1; if (Skill1 == 'skill_ranged_combat') {Difficulty = Ranged;} else {Difficulty = Melee;} break;
			case "weapon2":  WeaponName = Name2; Skill = Skill2; Damage = Damage2; Injury = Injury2; Range = Range2; Rules = Rules2; Ammo1 = Ammo2_1; Ammo2 = Ammo2_2; Ammo3 = Ammo2_3; Ammo4 = Ammo2_4; Ammo5 = Ammo2_5; Ammo6 = Ammo2_6; AmmoUnused = AmmoUnused2; NextAmmo = NextAmmo2; if (Skill2 == 'skill_ranged_combat') {Difficulty = Ranged;} else {Difficulty = Melee;}; break;
			case "weapon3":  WeaponName = Name3; Skill = Skill3; Damage = Damage3; Injury = Injury3; Range = Range3; Rules = Rules3; Ammo1 = Ammo3_1; Ammo2 = Ammo3_2; Ammo3 = Ammo3_3; Ammo4 = Ammo3_4; Ammo5 = Ammo3_5; Ammo6 = Ammo3_6; AmmoUnused = AmmoUnused3; NextAmmo = NextAmmo3; if (Skill3 == 'skill_ranged_combat') {Difficulty = Ranged;} else {Difficulty = Melee;}; break;
			default: console.log(" Name " + Name + " unknown Weapon");
		}		
		//console.log("  WeaponName: " + WeaponName + " Skill: " + Skill + " Difficulty: " + Difficulty + " Damage: " + Damage + "  Injury: " + Injury+ "  Range: " + Range + "  Rules: " + Rules + "  AmmoUnused: " + AmmoUnused + " NextAmmo: " + NextAmmo);

		// Determine if the weapon is Ranged and Out of ammo
		if ((AmmoUnused == 0) && (Skill == "skill_ranged_combat")) {
			//console.log("   AmmoUnused: " + AmmoUnused + " Skill: " + Skill);
			//console.log(" OUT OF AMMO!!!");
			const rollAmmoOut = "&{template:check} {{name=@{character_name} *attempts to use* "+WeaponName+"}} {{Empty='1'}}"; 
			
			startRoll(rollAmmoOut, rollResult => {
				finishRoll(
					rollResult.rollId,
						{
						}
					);
			});
			return;
		}

		// Prettify skill Name
		if (Skill == "skill_ranged_combat") { Skill = "Ranged Combat"; } 
		else {Skill = "Melee Combat";}

		
		let NumDie = 8;   // Six plus Advantage/Disadvantage
		let Horror = 6;
		let Fumbles = 0;  // Natural 1
		let Criticals = 0;  // Natural 6
		let Successes = 0;
		let Failures = 0;
		let NumHorrorDie = 0;
		let HorrorFumbles = 0;  // Natural 1
		let HorrorCriticals = 0;  // Natural 6
		let HorrorSuccesses = 0;
		let HorrorFailures = 0;

		let QueryNumDice = " {{Dice=[[?{Number of Dice|3}]]}} ";
		let QueryHorror = " {{Horror=[[?{Horror Dice?|0}]]}} ";
		let QueryKnack = " {{Knacks=[[?{Bonus/Penalty|0}]]}} ";
		let Roll = "2";
		let Result1 = "1";
		let Result2 = "2";
		let Result3 = "3";
		let Result4 = "4";
		let Result5 = "5";
		let Result6 = "6";
		let Horror1 = "1";
		let Horror2 = "2";
		let Horror3 = "3";
		let Horror4 = "4";
		let Horror5 = "5";
		let Horror6 = "6";
		let Trauma1 = "0";
		let Trauma2 = "0";
		let Trauma3 = "0";
		let Trauma4 = "0";
		let Trauma5 = "0";
		let Trauma6 = "0";
		let AdvantageDie    = "0";
		let DisadvantageDie = "0";
		
		// Note: Since dicefontd6 is being overridden 
		//	(and I can't work around it - note: !important did not work) 
		//	calcuate all possibilites and winnow at the end 
	

		let CurrentDie = 1;
		let CurrentSuccess = 0;
		let Trauma = "0";
						 
		while (CurrentDie <= NumDie) {
		
			Roll = Math.floor(Math.random() * 6) + 1;
			
			//console.log(" Roll: " + Roll + " Horror " + Horror +" CurrentDie " + CurrentDie + " of " + NumDie + " Difficulty: " + Difficulty);

			// Roll Normal Die
			
			let Adjusted = Roll + BonusOrPenalty;										
			CurrentSuccess = 0;
			if (Roll == 1){
				Failures += 1 ;
				Fumbles += 1 ;
				Adjusted = 1;				 
			} else if (Roll == 6){
				Criticals += 1 ;
				Successes += 1 ;
				CurrentSuccess = 1;
				Adjusted = 6;				 
			} else if ((Roll+BonusOrPenalty) >= Difficulty) {
				Successes += 1 ;
				CurrentSuccess = 1;
			} else {
				Failures += 1 ;
			}

			switch (Adjusted) {
				case -5: 
				case -4: 
				case -3: 
				case -2: 
				case -1: 
				case  0:			 
				case  1: 
					if (CurrentSuccess == 1) { RollResult = "g"; } else { RollResult = "G"; }
					break;
				case 2: 
					if (CurrentSuccess == 1) { RollResult = "h"; } else { RollResult = "H"; }
					break;			
				case 3: 
					if (CurrentSuccess == 1) { RollResult = "i"; } else { RollResult = "I"; }
					break;
				case 4: 
					if (CurrentSuccess == 1) { RollResult = "j"; } else { RollResult = "J"; }
					break;			
				case 5: 
					if (CurrentSuccess == 1) { RollResult = "k"; } else { RollResult = "K"; }
					break;			
				case 6: 
				case 7: 
				case 8: 
				case 9: 
				case 10: 
				case 11: 
					if (CurrentSuccess == 1) { RollResult = "l"; } else { RollResult = "L"; }
					break;			
				default:			
					console.log("  Roll default: " + Roll);
			}
			
			if (CurrentDie == 1) {
				Result1 = RollResult;
			} else if (CurrentDie == 2) {
				Result2 = RollResult;
			} else if (CurrentDie == 3) {
				Result3 = RollResult;
			} else if (CurrentDie == 4) {
				Result4 = RollResult;
			} else if (CurrentDie == 5) {
				Result5 = RollResult;
			} else if (CurrentDie == 6) {
				Result6 = RollResult;
			} else if (CurrentDie == 7) {
				AdvantageDie = RollResult;
			} else if (CurrentDie == 8) {
				DisadvantageDie = RollResult;
			} else {
			  console.log (" CurrentDie invalid: " + CurrentDie );
			 }
			//console.log ("  Result1 " + Result1 + " Result2 " + Result2 + " Result3 " + Result3 + " Result4 " + Result4 + " Result5 " + Result5 + " Result6 " + Result6);
			//console.log ("  AdvantageDie " + AdvantageDie + " DisadvantageDie " + DisadvantageDie);
			//console.log ("  Successes: " + Successes + " Criticals " + Criticals + " Failures " + Failures + " Fumbles " + Fumbles);

			// Roll Horror Die 
			Horror = Math.floor(Math.random() * 6) + 1;
			Adjusted = Horror + BonusOrPenalty;						  
			CurrentSuccess = 0;
			if (Horror == 1){
				HorrorFailures += 1;
				HorrorFumbles += 1;
				Adjusted = 1;
			} else if (Horror == 6){
				HorrorCriticals += 1;
				HorrorSuccesses += 1;
				CurrentSuccess = 1;
				Adjusted = 6;
			} else if ((Horror+BonusOrPenalty) >= Difficulty) {
				HorrorSuccesses += 1;
				CurrentSuccess = 1;
			} else {
				HorrorFailures += 1;
			}
		
			switch (Adjusted) {
				case -5: 
				case -4: 
				case -3: 
				case -2: 
				case -1: 
				case  0: 
				case  1: 			 
					if (CurrentSuccess == 1) { RollResult = "g"; } else { RollResult = "G"; }
					break;
				case 2: 
					if (CurrentSuccess == 1) { RollResult = "h"; } else { RollResult = "H"; }
					break;			
				case 3: 
					if (CurrentSuccess == 1) { RollResult = "i"; } else { RollResult = "I"; }
					break;
				case 4: 
					if (CurrentSuccess == 1) { RollResult = "j"; } else { RollResult = "J"; }
					break;			
				case 5: 
					if (CurrentSuccess == 1) { RollResult = "k"; } else { RollResult = "K"; }
					break;			
				case 6: 
				case 7: 
				case 8: 
				case 9: 
				case 10: 
				case 11: 			
					if (CurrentSuccess == 1) { RollResult = "l"; } else { RollResult = "L"; }
					break;			
				default:			
					console.log("  Horror default: " + Horror);
			}
				
			if (CurrentDie == 1) {
				Horror1 = RollResult; Trauma1 = Horror;
			} else if (CurrentDie == 2) {
				Horror2 = RollResult; Trauma2 = Horror;
			} else if (CurrentDie == 3) {
				Horror3 = RollResult; Trauma3 = Horror;
			} else if (CurrentDie == 4) {
				Horror4 = RollResult; Trauma4 = Horror;
			} else if (CurrentDie == 5) {
				Horror5 = RollResult; Trauma5 = Horror;
			} else if (CurrentDie == 6) {
				Horror6 = RollResult; Trauma6 = Horror;
			} else {
			  console.log ("Current Horror Die invalid: " + CurrentDie );
			}

			//console.log ("  Horror1 " + Horror1 + " Horror2 " + Horror2 + " Horror3 " + Horror3 + " Horror4 " + Horror4 + " Horror5 " + Horror5 + " Horror6 " + Horror6 );
			//console.log ("  Horror Successes: " + HorrorSuccesses + " Criticals " + HorrorCriticals + " Failures " + HorrorFailures + " Fumbles " + HorrorFumbles);

			CurrentDie += 1;

		}
		//console.log ("  Result1 " + Result1 + " Result2 " + Result2 + " Result3 " + Result3 + " Result4 " + Result4 + " Result5 " + Result5 + " Result6 " + Result6 );
		//console.log ("  Successes: " + Successes + " Criticals " + Criticals + " Failures " + Failures + " Fumbles " + Fumbles);

		//console.log ("  Horror1 " + Horror1 + " Horror2 " + Horror2 + " Horror3 " + Horror3 + " Horror4 " + Horror4 + " Horror5 " + Horror5 + " Horror6 " + Horror6 );
		//console.log ("  Horror Successes: " + HorrorSuccesses + " Criticals " + HorrorCriticals + " Failures " + HorrorFailures + " Fumbles " + HorrorFumbles);

		//console.log ("  Trauma1 " + Trauma1 + " Trauma2 " + Trauma2 + " Trauma3 " + Trauma3 + " Trauma4 " + Trauma4 + " Trauma5 " + Trauma5 + " Trauma6 " + Trauma6 );



		const rollBase ="&{template:check} {{name=@{character_name} *uses* "+WeaponName+"}} {{Weapon='1'}} {{Skill="+Skill+"}} {{Damage="+Damage+"}} {{InjuryRating="+Injury+"}} {{Range="+Range+"}} {{Ammo="+AmmoUnused+"}} {{SpecialRules="+Rules+"}} {{Hand='1'}} "+ QueryNumDice + " " + QueryHorror + " {{Roll=[["+Roll+"]]}} {{NumDie=[["+NumDie+"]]}} {{HorrorDie=[["+Horror+"]]}} {{Die1="+Result1+"}} {{Die2="+Result2+"}} {{Die3="+Result3+"}} {{Die4="+Result4+"}} {{Die5="+Result5+"}} {{Die6="+Result6+"}}  {{Horror1="+Horror1+"}} {{Horror2="+Horror2+"}} {{Horror3="+Horror3+"}} {{Horror4="+Horror4+"}} {{Horror5="+Horror5+"}} {{Horror6="+Horror6+"}} {{AdvantageDie="+AdvantageDie+"}} {{DisadvantageDie="+DisadvantageDie+"}} {{AdvantageFlag=[["+AdvantageFlag+"]]}} {{DisadvantageFlag=[["+DisadvantageFlag+"]]}} {{TraumaDie=[["+Trauma+"]]}}";  

		//console.log("  rollBase = " + rollBase);

	    startRoll(rollBase, rollResult => {


			//console.log(" rollResult.results.Dice: " + JSON.stringify(rollResult.results.Dice) );
			NumDie = rollResult.results.Dice.result;
			//console.log("   NumDie:  " + NumDie );

			if ((NumDie < 0) || (NumDie > 6)) {
				if (NumDie < 0) { NumDie = 0;} 	else if (NumDie > 6) { NumDie = 6;}
				//console.log ("  RESET NumDie to " + NumDie);
			}

			//console.log(" rollResult.results.Horror.rolls " + JSON.stringify(rollResult.results.Horror.rolls) );
			NumHorrorDie = rollResult.results.Horror.result;
			if (NumHorrorDie < 0 || NumHorrorDie > 6) {
				if (NumHorrorDie < 0) { NumHorrorDie = 0;} else if (NumHorrorDie > 6) { NumHorrorDie = 6;}
				//console.log ("  RESET NumHorrorDie to " + NumHorrorDie);
			}
			
			//console.log("Roll Cost:  NumDie: " + NumDie + " NumHorrorDie " + NumHorrorDie);
			//console.log("Pool Available:  Normal: " + NormalDieAvailable  + " Temp Normal: " + TemporaryNormalDie + " Horror: " + HorrorDieAvailable + " Temp Horror: " + TemporaryHorrorDie);
			
			// Is the cost covered? 
			let Covered = 1; // Assume the cost is covered
			if (NumDie > (NormalDieAvailable + TemporaryNormalDie)) {
				Covered = 0;
				//console.log(" Not enough DIE! Converting Normal from " + NumDie + " to " + NormalDieAvailable + " + " + TemporaryNormalDie);  
				NumDie = NormalDieAvailable + TemporaryNormalDie;
			}
			if (NumHorrorDie > (HorrorDieAvailable + TemporaryHorrorDie)) {
				Covered = 0;
				//console.log(" Not enough Horror DIE! Converting Horror from " + NumHorrorDie + " to " + (HorrorDieAvailable + TemporaryHorrorDie));  
				NumHorrorDie = (HorrorDieAvailable + TemporaryHorrorDie);
			}

			let Adjusted = "0";
			let CommaAdjusted = "";
			for (let i = 1; i <= NumHorrorDie; i++) { 
				Adjusted = String(NumDie + i);
				CommaAdjusted = " " + Adjusted;
   				switch (i) {
					case 1: 
						if (Trauma1 == "1") { Trauma = Adjusted; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;
					case 2: 
						if (Trauma2 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 3: 
						if (Trauma3 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;
					case 4: 
						if (Trauma4 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 5: 
						if (Trauma5 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 6: 
						if (Trauma6 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					default:			
						console.log("  Trauma default: " + i);
				}				
	
			}				
			//console.log("  Trauma: " + Trauma);
			
			let NormalDiceCost = NumDie;
			let HorrorDiceCost = NumHorrorDie;
			//console.log("  Pay cost: Normal " + NormalDiceCost +  " Horror " + NumHorrorDie);
			//console.log("     Normal Dice Temp " + TemporaryNormalDie);
			//console.log("     Horror Dice Temp: " + TemporaryHorrorDie);

			if ((TemporaryNormalDie != 0) && (NormalDiceCost > 0)) {
				//console.log("     TemporaryNormalDie: " + TemporaryNormalDie + " NormalDiceCost: " + NormalDiceCost);
				if (NormalDiceCost >= TemporaryNormalDie) {
					NormalDiceCost -= TemporaryNormalDie;
					TemporaryNormalDie = 0;
				} else {
					TemporaryNormalDie -= NormalDiceCost;
					NormalDiceCost = 0;
				}
			}
			//console.log("     NormalDiceCost: " + NormalDiceCost + " NormalDieAvailable: " + NormalDieAvailable);
			if (NormalDiceCost > 0) {
				if (NormalDiceCost > NumDie) {
					NumDie = NormalDieAvailable;
				}
				// Dice Dashboard update
				let DieSpent = 0;
				
				for (let j = 6; (j > 0) && (DieSpent < NumDie) ; j--) {
					//console.log ("   j = " + j + " DieSpent = " + DieSpent + " NumDie " + NumDie);
					switch (j) {
						case 1 :   if (Die1Background == "0") {Die1Background = "3"; Die1 = "0"; DieSpent++; console.log("  Used Die1"); }; break;
						case 2 :   if (Die2Background == "0") {Die2Background = "3"; Die2 = "0"; DieSpent++; console.log("  Used Die2"); }; break;
						case 3 :   if (Die3Background == "0") {Die3Background = "3"; Die3 = "0"; DieSpent++; console.log("  Used Die3"); }; break;
						case 4 :   if (Die4Background == "0") {Die4Background = "3"; Die4 = "0"; DieSpent++; console.log("  Used Die4"); }; break;
						case 5 :   if (Die5Background == "0") {Die5Background = "3"; Die5 = "0"; DieSpent++; console.log("  Used Die5"); }; break;
						case 6 :   if (Die6Background == "0") {Die6Background = "3"; Die6 = "0"; DieSpent++; console.log("  Used Die6"); }; break;
						default: console.log(" Die not found at " + j );
					}
				}
				//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
				//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
			}


			if ((TemporaryHorrorDie != 0) && (HorrorDiceCost > 0)) {
				//console.log("     TemporaryHorrorDie: " + TemporaryHorrorDie + " HorrorDiceCost: " + HorrorDiceCost);
				if (HorrorDiceCost >= TemporaryHorrorDie) {
					HorrorDiceCost -= TemporaryHorrorDie;
					TemporaryHorrorDie = 0;
				} else {
					TemporaryHorrorDie -= HorrorDiceCost;
					HorrorDiceCost = 0;
				}
			}
			//console.log("     HorrorDiceCost: " + HorrorDiceCost + " HorrorDieAvailable: " + HorrorDieAvailable);

			if (HorrorDiceCost > 0) {
				if (HorrorDiceCost > NumHorrorDie) {
					NumHorrorDie = HorrorDieAvailable;
				}
				// Dice Dashboard update
				let DieSpent = 0;
				
				for (let j = 6; (j > 0) && (DieSpent < NumHorrorDie) ; j--) {
					//console.log ("   j = " + j + " DieSpent = " + DieSpent + " NumHorrorDie " + NumDie);
					switch (j) {
						case 1 :   if (Die1Background == "1") {Die1Background = "3"; Die1 = "0"; DieSpent++; console.log("  Used Die1"); }; break;
						case 2 :   if (Die2Background == "1") {Die2Background = "3"; Die2 = "0"; DieSpent++; console.log("  Used Die2"); }; break;
						case 3 :   if (Die3Background == "1") {Die3Background = "3"; Die3 = "0"; DieSpent++; console.log("  Used Die3"); }; break;
						case 4 :   if (Die4Background == "1") {Die4Background = "3"; Die4 = "0"; DieSpent++; console.log("  Used Die4"); }; break;
						case 5 :   if (Die5Background == "1") {Die5Background = "3"; Die5 = "0"; DieSpent++; console.log("  Used Die5"); }; break;
						case 6 :   if (Die6Background == "1") {Die6Background = "3"; Die6 = "0"; DieSpent++; console.log("  Used Die6"); }; break;
						default: console.log(" Die not found at " + j );
					}
				}
			}

			let NewDicePool = NormalDieAvailable + HorrorDieAvailable - NormalDiceCost - HorrorDiceCost;
			//console.log("     Dice Pool: " + (NormalDieAvailable + HorrorDieAvailable) + " NewDicePool: " + NewDicePool);
					
			setAttrs({                            
				dice_pool: NewDicePool, normal_dice: NormalDieAvailable - NormalDiceCost, horror_dice: HorrorDieAvailable - HorrorDiceCost, temporary_normal_dice: TemporaryNormalDie, temporary_horror_dice: TemporaryHorrorDie, [NextAmmo]: 1,
					die1: Die1, die1_background_oolor: Die1Background,
					die2: Die2, die2_background_oolor: Die2Background,
					die3: Die3, die3_background_oolor: Die3Background,
					die4: Die4, die4_background_oolor: Die4Background,
					die5: Die5, die5_background_oolor: Die5Background,
					die6: Die6, die6_background_oolor: Die6Background
			});

			//console.log("  For Display: Normal " + NumDie + " Horror " + NumHorrorDie + " NextAmmo: " + NextAmmo);

			finishRoll(
				rollResult.rollId,
				{
					NumDie: NumDie,
					HorrorDie: NumHorrorDie,
					TraumaDie: Trauma,
					AdvantageFlag: AdvantageFlag,
					DisadvantageFlag: DisadvantageFlag
				}
			);


		});
	});
});


on("change:damage", function(eventInfo) {
	//console.log(" change:damage");
	let PreviousDamage = parseInt(eventInfo.previousValue)||0;
	let Damage = parseInt(eventInfo.newValue)||0;
	//console.log("  PreviousDamage: " + PreviousDamage);
	//console.log("  Damage: " + Damage);
	
	getAttrs(["dice_pool", "pool_limit", "normal_dice", "horror_dice", "horror_dice_limit", "die1", "die2", "die3", "die4", "die5", "die6","die1_background_oolor","die2_background_oolor","die3_background_oolor","die4_background_oolor","die5_background_oolor","die6_background_oolor" ], function(values) {
		let DicePool = parseInt(values.dice_pool)||0;
		let PoolLimit = parseInt(values.pool_limit)||0;
		let NormalDice = parseInt(values.normal_dice)||0;
		let HorrorDice = parseInt(values.horror_dice)||0;
		let HorrorDiceLimit = parseInt(values.horror_dice_limit)||0;
		let Die1 = values.die1;
		let Die2 = values.die2;		
		let Die3 = values.die3;		
		let Die4 = values.die4;		
		let Die5 = values.die5;		
		let Die6 = values.die6;
		let Die1Background = values.die1_background_oolor;
		let Die2Background = values.die2_background_oolor;
		let Die3Background = values.die3_background_oolor;
		let Die4Background = values.die4_background_oolor;
		let Die5Background = values.die5_background_oolor;
		let Die6Background = values.die6_background_oolor;
		//console.log("  DicePool: " + DicePool + " PoolLimit: " + PoolLimit );
		//console.log("  NormalDice: " + NormalDice + " HorrorDice: " + HorrorDice);
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);

		// Calculate number of Spent Die 
		let SpentDice = PoolLimit - PreviousDamage - DicePool;
		//console.log("  SpentDice: " + SpentDice );

		if (Damage > PoolLimit) { Damage = PoolLimit; }
		if (Damage < 0) { Damage = 0; }
		//console.log("  Damage: " + Damage );
		switch (Damage) {
			case 1 :   Die6 = "@"; Die6Background = "2"; break;
			case 2 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; break;
			case 3 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2";  break;
			case 4 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2";  break;
			case 5 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2"; Die2 = "@"; Die2Background = "2";  break;
			case 6 :   Die6 = "@"; Die6Background = "2"; Die5 = "@"; Die5Background = "2"; Die4 = "@"; Die4Background = "2"; Die3 = "@"; Die3Background = "2"; Die2 = "@"; Die2Background = "2"; Die1 = "@"; Die1Background = "2";  break;
			default: console.log(" No Damage " + Damage );
		}
		
		// If damage has been restored then convert to Spent die
		if (PreviousDamage > Damage) {
			let Healing = PreviousDamage - Damage;
			let Start = 6 - PreviousDamage + 1;
			//console.log("  Restore " + Healing + " Dice. Start at  " + Start );
			for (let i = Start; i < (Healing+ Start); i++){
					switch (i) {
						case 1: console.log(" case 1: Die1 - " + Die1); if (Die1 == "@") {Die1 = "0"; Die1Background = "3"}; SpentDice++; break;
						case 2: console.log(" case 2: Die2 - " + Die2); if (Die2 == "@") {Die2 = "0"; Die2Background = "3"}; SpentDice++; break;
						case 3: console.log(" case 3: Die3 - " + Die3); if (Die3 == "@") {Die3 = "0"; Die3Background = "3"}; SpentDice++; break;
						case 4: console.log(" case 4: Die4 - " + Die4); if (Die4 == "@") {Die4 = "0"; Die4Background = "3"}; SpentDice++; break;
						case 5: console.log(" case 5: Die5 - " + Die5); if (Die5 == "@") {Die5 = "0"; Die5Background = "3"}; SpentDice++; break;
						case 6: console.log(" case 6: Die6 - " + Die6); if (Die6 == "@") {Die6 = "0"; Die6Background = "3"}; SpentDice++; break;
						default: console.log(" No Damage " + Damage );
					}

				//console.log("    i " + i + " SpentDice  " + SpentDice );

			}
		} else {
			// Might have to migrate Horror Die
			let HorrorCount = 0;
			if  (Die1Background == "1") {HorrorCount++;} 
			if  (Die2Background == "1") {HorrorCount++;} 
			if  (Die3Background == "1") {HorrorCount++;} 
			if  (Die4Background == "1") {HorrorCount++;} 
			if  (Die5Background == "1") {HorrorCount++;} 
			let LastNormal = 0;
			if  (Die1Background == "0") {LastNormal = 1}; 
			if  (Die2Background == "0") {LastNormal = 2}; 
			if  (Die3Background == "0") {LastNormal = 3}; 
			if  (Die4Background == "0") {LastNormal = 4}; 
			if  (Die5Background == "0") {LastNormal = 5};
			let NewDamage = Damage - PreviousDamage;
			//console.log("  NewDamage = " + NewDamage);			
			let LastDamage = PoolLimit - Damage;
			let RoomLeft = PoolLimit - SpentDice - Damage;
			//console.log("   HorrorDiceLimit " + HorrorDiceLimit + " HorrorCount " + HorrorCount + " RoomLeft " + RoomLeft + " LastNormal " + LastNormal);
			while (NewDamage > 0) {
				if ((HorrorCount < HorrorDiceLimit) && (RoomLeft > 0))
				{
					//console.log("   Working on LastNormal " + LastNormal);

					switch (LastNormal) {
						case 1: console.log(" case 1: Die1 - " + Die1); if (Die1Background == "0") {Die1 = "f"; Die1Background = "1"}; break;
						case 2: console.log(" case 2: Die2 - " + Die2); if (Die2Background == "0") {Die2 = "f"; Die2Background = "1"}; break;
						case 3: console.log(" case 3: Die3 - " + Die3); if (Die3Background == "0") {Die3 = "f"; Die3Background = "1"}; break;
						case 4: console.log(" case 4: Die4 - " + Die4); if (Die4Background == "0") {Die4 = "f"; Die4Background = "1"}; break;
						case 5: console.log(" case 5: Die5 - " + Die5); if (Die5Background == "0") {Die5 = "f"; Die5Background = "1"}; break;
						case 6: console.log(" case 6: Die6 - " + Die6); if (Die6Background == "0") {Die6 = "f"; Die6Background = "1"}; break;
						default: console.log(" No Damage " + Damage );
					}
					RoomLeft--;
					LastNormal--;
				}
				NewDamage--;
				//console.log("   NewDamage " + NewDamage + " RoomLeft " + RoomLeft + " LastNormal " + LastNormal);
			}
		}

		NormalDice = PoolLimit - HorrorDiceLimit - Damage - SpentDice;
		if (NormalDice < 0) { NormalDice = 0; } // Investigator has full hand of Horror Dice and more Damage
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
		
		setAttrs({                            
			normal_dice: NormalDice, horror_dice: HorrorDiceLimit, dice_pool: PoolLimit - Damage - SpentDice,
			die1: Die1, die1_background_oolor: Die1Background,
			die2: Die2, die2_background_oolor: Die2Background,
			die3: Die3, die3_background_oolor: Die3Background,
			die4: Die4, die4_background_oolor: Die4Background,
			die5: Die5, die5_background_oolor: Die5Background,
			die6: Die6, die6_background_oolor: Die6Background
		});
		
	//console.log ("  leaving change:Damage ");
	});


});

on("change:horror_dice_limit", function(eventInfo) {
	//console.log(" change:horror_dice_limit");
	let PreviousHorror = parseInt(eventInfo.previousValue)||0;
	let Horror = parseInt(eventInfo.newValue)||0;
	//console.log(" Horror Dice Limit change");
	//console.log("  PreviousHorror: " + PreviousHorror);
	//console.log("  Horror: " + Horror);

	getAttrs(["dice_pool", "normal_dice", "pool_limit", "horror_dice", "horror_dice_limit", "damage", "die1", "die2", "die3", "die4", "die5", "die6","die1_background_oolor","die2_background_oolor","die3_background_oolor","die4_background_oolor","die5_background_oolor","die6_background_oolor" ], function(values) {
		let DicePool = parseInt(values.dice_pool)||0;
		let PoolLimit = parseInt(values.pool_limit)||0;
		let NormalDice = parseInt(values.normal_dice)||0;
		let HorrorDice = parseInt(values.horror_dice)||0;
		let HorrorDiceLimit = parseInt(values.horror_dice_limit)||0;
		let Damage = parseInt(values.damage)||0;
		let Die1 = values.die1;
		let Die2 = values.die2;		
		let Die3 = values.die3;		
		let Die4 = values.die4;		
		let Die5 = values.die5;		
		let Die6 = values.die6;
		let Die1Background = values.die1_background_oolor;
		let Die2Background = values.die2_background_oolor;
		let Die3Background = values.die3_background_oolor;
		let Die4Background = values.die4_background_oolor;
		let Die5Background = values.die5_background_oolor;
		let Die6Background = values.die6_background_oolor;

		//console.log("  DicePool: " + DicePool + " HorrorDiceLimit: " + HorrorDiceLimit);
		//console.log("  NormalDice: " + NormalDice + " HorrorDice: " + HorrorDice);


		//console.log("  DicePool: " + DicePool + " PoolLimit: " + PoolLimit );
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);

		// Calculate number of Spent Die 
		let SpentDice = PoolLimit - Damage - DicePool;
		//console.log("  SpentDice: " + SpentDice );

		
		if (HorrorDiceLimit	> 0) {
			let StopIdx = 6 - Damage - SpentDice + 1; 
			let StartIdx = StopIdx - HorrorDiceLimit ; 
			if (StartIdx < 0) { StartIdx = 0;}
			//console.log ("  Start Horror Idx " + StartIdx + " StopIdx " + StopIdx + " HorrorDiceLimit " + HorrorDiceLimit + " Damage " + Damage);
			for (let j = StartIdx; j < StopIdx; j++) {
				//console.log ("   j = " + j + " StartIdx = " + StartIdx);
				switch (j) {
					case 1 :   Die1Background = "1"; break;
					case 2 :   Die2Background = "1"; break;
					case 3 :   Die3Background = "1"; break;
					case 4 :   Die4Background = "1";  break;
					case 5 :   Die5Background = "1";  break;
					case 6 :   Die6Background = "1";  break;
					default: console.log(" No Horror at " + Idx );
				}
			}
		} 
		if (PreviousHorror > Horror) // May have to remove some backgrounds
		{
			let StopIdx = 6 - Damage - SpentDice; 
			let StartIdx = DicePool - PreviousHorror ; 
			if (StartIdx < 0) { StartIdx = 0;}
			//console.log ("  Start clear Horror Idx = " + StartIdx + " StopIdx " + StopIdx + " HorrorDiceLimit " + HorrorDiceLimit + " Damage " + Damage);
			for (let j = StartIdx; j <= StopIdx; j++) {
				//console.log ("   j = " + j + " StartIdx = " + StartIdx);
				switch (j) {
					case 1 :   Die1Background = "0"; break;
					case 2 :   Die2Background = "0"; break;
					case 3 :   Die3Background = "0"; break;
					case 4 :   Die4Background = "0";  break;
					case 5 :   Die5Background = "0";  break;
					case 6 :   Die6Background = "0";  break;
					default: console.log(" No Horror at " + Idx );
				}
			}
		}

		if (DicePool <= HorrorDiceLimit) {
			NormalDice = 0;
			HorrorDice = DicePool;
		} else {
			NormalDice = DicePool - HorrorDiceLimit;
			HorrorDice = HorrorDiceLimit;
		}
		
		if (NormalDice < 0) { NormalDice = 0; } // Investigator has full hand of Horror Dice and more Damage
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
	
		setAttrs({                            
			normal_dice: NormalDice, horror_dice: HorrorDiceLimit, dice_pool: PoolLimit - Damage - SpentDice,
			die1: Die1, die1_background_oolor: Die1Background,
			die2: Die2, die2_background_oolor: Die2Background,
			die3: Die3, die3_background_oolor: Die3Background,
			die4: Die4, die4_background_oolor: Die4Background,
			die5: Die5, die5_background_oolor: Die5Background,
			die6: Die6, die6_background_oolor: Die6Background
		});
		//console.log ("  leaving change:horror_dice_limit ");	
	});
});

on("change:dice_pool", function(eventInfo) {
	let PreviousValue = parseInt(eventInfo.previousValue)||0;
	let NewValue = parseInt(eventInfo.newValue)||0;

	//console.log("  PreviousValue: " + PreviousValue);
	//console.log("  NewValue: " + NewValue);

	let DieRemoved = PreviousValue - NewValue;
	getAttrs(["normal_dice", "horror_dice", "horror_dice_limit"], function(values) {
		let NormalDice = parseInt(values.normal_dice)||0;
		let HorrorDice = parseInt(values.horror_dice)||0;
		let HorrorDiceLimit = parseInt(values.horror_dice_limit)||0;
		let TotalDice = NormalDice + HorrorDice;
		//console.log("  NormalDice: " + NormalDice + " HorrorDice: " + HorrorDice + " TotalDice " + TotalDice);
		
		if (NewValue == TotalDice) { 
			//console.log(" TotalDice = NewValue = " +  NewValue + "   meaning equilibrium is preserved ");
			//console.log("   BUT check Horror Dice. Limit: " + HorrorDiceLimit + " Current Horror Dice: " + HorrorDice);
			if (HorrorDice < HorrorDiceLimit) {
				let Deficit = HorrorDiceLimit - HorrorDice;
				//console.log("  Siphon from Normal: " + NormalDice + " for Deficit: " + Deficit);
				if (Deficit > NormalDice) {
					HorrorDice += NormalDice;
					NormalDice = 0;
				} else {
					HorrorDice = HorrorDiceLimit;
					NormalDice -= Deficit;
				}
				setAttrs({                            
					normal_dice: NormalDice, horror_dice: HorrorDice
				});
			}
			return;
		}
		
		TotalDice = NewValue; 
		if (TotalDice <= HorrorDiceLimit) {
			NormalDice = 0;
			HorrorDice = TotalDice;
		} else {
			NormalDice = TotalDice - HorrorDiceLimit;
			HorrorDice = HorrorDiceLimit;
		}
		setAttrs({                            
			normal_dice: NormalDice, horror_dice: HorrorDice
		});
	});
});

on("clicked:agility clicked:athletics clicked:wits clicked:presence clicked:intuition clicked:knowledge clicked:resolve clicked:meleeCombat clicked:rangedCombat clicked:lore", function(eventInfo) {
	let TriggerName = eventInfo.triggerName;
	let Name = eventInfo.triggerName.substring(8); //Difficulty level
	//console.log("  TriggerName: " + TriggerName);
	//console.log("  Name: " + Name);
	//console.log("  eventInfo: " + JSON.stringify(eventInfo));


	getAttrs(["skill_agility","skill_athletics","skill_wits","skill_presence","skill_intuition","skill_knowledge","skill_resolve","skill_melee_combat","skill_ranged_combat","skill_lore","normal_dice","horror_dice","temporary_normal_dice","temporary_horror_dice","bonus_penalty","advantage","disadvantage", "die1", "die2", "die3", "die4", "die5", "die6","die1_background_oolor","die2_background_oolor","die3_background_oolor","die4_background_oolor","die5_background_oolor","die6_background_oolor"], function(values) {

		let Agility = parseInt(values.skill_agility)||0;
		let Athletics = parseInt(values.skill_athletics)||0;
		let Wits = parseInt(values.skill_wits)||0;
		let Presence = parseInt(values.skill_presence)||0;
		let Intuition = parseInt(values.skill_intuition)||0;
		let Knowledge = parseInt(values.skill_knowledge)||0;
		let Resolve = parseInt(values.skill_resolve)||0;
		let Melee = parseInt(values.skill_melee_combat)||0;
		let Ranged = parseInt(values.skill_ranged_combat)||0;
		let Lore = parseInt(values.skill_lore)||0;
		let NormalDieAvailable = parseInt(values.normal_dice)||0;
		let HorrorDieAvailable = parseInt(values.horror_dice)||0;
		let TemporaryNormalDie = parseInt(values.temporary_normal_dice)||0;
		let TemporaryHorrorDie = parseInt(values.temporary_horror_dice)||0;
		let BonusOrPenalty = parseInt(values.bonus_penalty)||0;
		let AdvantageFlag = parseInt(values.advantage)||0;
		let DisadvantageFlag = parseInt(values.disadvantage)||0;
		let Die1 = values.die1;
		let Die2 = values.die2;		
		let Die3 = values.die3;		
		let Die4 = values.die4;		
		let Die5 = values.die5;		
		let Die6 = values.die6;
		let Die1Background = values.die1_background_oolor;
		let Die2Background = values.die2_background_oolor;
		let Die3Background = values.die3_background_oolor;
		let Die4Background = values.die4_background_oolor;
		let Die5Background = values.die5_background_oolor;
		let Die6Background = values.die6_background_oolor;
														 

		//console.log(" Agility: " + Agility + " Athletics: " + Athletics + "  Wits: " + Wits + " Presence: " + Presence + "  Intuition: " + Intuition);
		//console.log(" Knowledge: " + Knowledge + " Resolve: " + Resolve + "  Melee: " + Melee + " Ranged: " + Ranged + "  Lore: " + Lore);
		//console.log(" BonusOrPenalty: " + BonusOrPenalty + " AdvantageFlag: " + AdvantageFlag + "  DisadvantageFlag: " + DisadvantageFlag);
		//console.log(" TemporaryNormalDie: " + TemporaryNormalDie + " TemporaryHorrorDie: " + TemporaryHorrorDie);
		//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
		//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
		
		let Difficulty = 6;
		let NameCapitalized = "Unknown";
		switch (Name) {
			case "agility" :   Difficulty = Agility; NameCapitalized = "Agility"; break;
			case "athletics" : Difficulty = Athletics; NameCapitalized = "Athletics"; break;
			case "wits" :      Difficulty = Wits; NameCapitalized = "Wits"; break;
			case "presence" :  Difficulty = Presence; NameCapitalized = "Presence"; break;
			case "intuition" : Difficulty = Intuition; NameCapitalized = "Intuition"; break;
			case "knowledge" : Difficulty = Knowledge; NameCapitalized = "Knowledge"; break;
			case "resolve" :   Difficulty = Resolve; NameCapitalized = "Resolve"; break;
			case "meleecombat" :     Difficulty = Melee; NameCapitalized = "Melee Combat"; break;
			case "rangedcombat" :    Difficulty = Ranged; NameCapitalized = "Ranged Combat"; break;
			case "lore" :      Difficulty = Lore; NameCapitalized = "Lore"; break;
			default: console.log(" Name " + Name + " unknown Skill");
		}
		
		
		let NumDie = 8;   // Six plus Advantage/Disadvantage
		let Horror = 6;
		let Fumbles = 0;  // Natural 1
		let Criticals = 0;  // Natural 6
		let Successes = 0;
		let Failures = 0;
		let NumHorrorDie = 0;
		let HorrorFumbles = 0;  // Natural 1
		let HorrorCriticals = 0;  // Natural 6
		let HorrorSuccesses = 0;
		let HorrorFailures = 0;

		let QueryNumDice = " {{Dice=[[?{Number of Dice|3}]]}} ";
		let QueryHorror = " {{Horror=[[?{Horror Dice?|0}]]}} ";
		let QueryKnack = " {{Knacks=[[?{Bonus/Penalty|0}]]}} ";
		let Roll = "2";
		let Result1 = "1";
		let Result2 = "2";
		let Result3 = "3";
		let Result4 = "4";
		let Result5 = "5";
		let Result6 = "6";
		let Horror1 = "1";
		let Horror2 = "2";
		let Horror3 = "3";
		let Horror4 = "4";
		let Horror5 = "5";
		let Horror6 = "6";
		let Trauma1 = "0";
		let Trauma2 = "0";
		let Trauma3 = "0";
		let Trauma4 = "0";
		let Trauma5 = "0";
		let Trauma6 = "0";
		let AdvantageDie    = "0";
		let DisadvantageDie = "0";
		
		// Note: Since dicefontd6 is being overridden 
		//	(and I can't work around it - note: !important did not work) 
		//	calcuate all possibilites and winnow at the end 
		

		let CurrentDie = 1;
		let CurrentSuccess = 0;
		let Trauma = "0";
						 
		while (CurrentDie <= NumDie) {
		
			Roll = Math.floor(Math.random() * 6) + 1;
			
			//console.log(" Roll: " + Roll + " Horror " + Horror +" CurrentDie " + CurrentDie + " of " + NumDie + " Difficulty: " + Difficulty);

			// Roll Normal Die 
			
			let Adjusted = Roll + BonusOrPenalty;										
			CurrentSuccess = 0;
			if (Roll == 1){
				Failures += 1 ;
				Fumbles += 1 ;
				Adjusted = 1;				 
			} else if (Roll == 6){
				Criticals += 1 ;
				Successes += 1 ;
				CurrentSuccess = 1;
				Adjusted = 6;				 
			} else if ((Roll+BonusOrPenalty) >= Difficulty) {
				Successes += 1 ;
				CurrentSuccess = 1;
			} else {
				Failures += 1 ;
			}

			switch (Adjusted) {
				case -5: 
				case -4: 
				case -3: 
				case -2: 
				case -1: 
				case  0:			 
				case  1: 
					if (CurrentSuccess == 1) { RollResult = "g"; } else { RollResult = "G"; }
					break;
				case 2: 
					if (CurrentSuccess == 1) { RollResult = "h"; } else { RollResult = "H"; }
					break;			
				case 3: 
					if (CurrentSuccess == 1) { RollResult = "i"; } else { RollResult = "I"; }
					break;
				case 4: 
					if (CurrentSuccess == 1) { RollResult = "j"; } else { RollResult = "J"; }
					break;			
				case 5: 
					if (CurrentSuccess == 1) { RollResult = "k"; } else { RollResult = "K"; }
					break;			
				case 6: 
				case 7: 
				case 8: 
				case 9: 
				case 10: 
				case 11: 
					if (CurrentSuccess == 1) { RollResult = "l"; } else { RollResult = "L"; }
					break;			
				default:			
					console.log("  Roll default: " + Roll);
			}
			
			if (CurrentDie == 1) {
				Result1 = RollResult;
			} else if (CurrentDie == 2) {
				Result2 = RollResult;
			} else if (CurrentDie == 3) {
				Result3 = RollResult;
			} else if (CurrentDie == 4) {
				Result4 = RollResult;
			} else if (CurrentDie == 5) {
				Result5 = RollResult;
			} else if (CurrentDie == 6) {
				Result6 = RollResult;
			} else if (CurrentDie == 7) {
				AdvantageDie = RollResult;
			} else if (CurrentDie == 8) {
				DisadvantageDie = RollResult;
			} else {
			  console.log (" CurrentDie invalid: " + CurrentDie );
			 }
			//console.log ("  Result1 " + Result1 + " Result2 " + Result2 + " Result3 " + Result3 + " Result4 " + Result4 + " Result5 " + Result5 + " Result6 " + Result6);
			//console.log ("  AdvantageDie " + AdvantageDie + " DisadvantageDie " + DisadvantageDie);
			//console.log ("  Successes: " + Successes + " Criticals " + Criticals + " Failures " + Failures + " Fumbles " + Fumbles);

			// Roll Horror Die 
			Horror = Math.floor(Math.random() * 6) + 1;
			Adjusted = Horror + BonusOrPenalty;						  
			CurrentSuccess = 0;
			if (Horror == 1){
				HorrorFailures += 1;
				HorrorFumbles += 1;
				Adjusted = 1;
			} else if (Horror == 6){
				HorrorCriticals += 1;
				HorrorSuccesses += 1;
				CurrentSuccess = 1;
				Adjusted = 6;
			} else if ((Horror+BonusOrPenalty) >= Difficulty) {
				HorrorSuccesses += 1;
				CurrentSuccess = 1;
			} else {
				HorrorFailures += 1;
			}
		
			switch (Adjusted) {
				case -5: 
				case -4: 
				case -3: 
				case -2: 
				case -1: 
				case  0: 
				case  1: 			 
					if (CurrentSuccess == 1) { RollResult = "g"; } else { RollResult = "G"; }
					break;
				case 2: 
					if (CurrentSuccess == 1) { RollResult = "h"; } else { RollResult = "H"; }
					break;			
				case 3: 
					if (CurrentSuccess == 1) { RollResult = "i"; } else { RollResult = "I"; }
					break;
				case 4: 
					if (CurrentSuccess == 1) { RollResult = "j"; } else { RollResult = "J"; }
					break;			
				case 5: 
					if (CurrentSuccess == 1) { RollResult = "k"; } else { RollResult = "K"; }
					break;			
				case 6: 
				case 7: 
				case 8: 
				case 9: 
				case 10: 
				case 11: 			
					if (CurrentSuccess == 1) { RollResult = "l"; } else { RollResult = "L"; }
					break;			
				default:			
					console.log("  Horror default: " + Horror);
			}
				
			if (CurrentDie == 1) {
				Horror1 = RollResult; Trauma1 = Horror;
			} else if (CurrentDie == 2) {
				Horror2 = RollResult; Trauma2 = Horror;
			} else if (CurrentDie == 3) {
				Horror3 = RollResult; Trauma3 = Horror;
			} else if (CurrentDie == 4) {
				Horror4 = RollResult; Trauma4 = Horror;
			} else if (CurrentDie == 5) {
				Horror5 = RollResult; Trauma5 = Horror;
			} else if (CurrentDie == 6) {
				Horror6 = RollResult; Trauma6 = Horror;
			} else {
			  console.log ("Current Horror Die invalid: " + CurrentDie );
			}

			//console.log ("  Horror1 " + Horror1 + " Horror2 " + Horror2 + " Horror3 " + Horror3 + " Horror4 " + Horror4 + " Horror5 " + Horror5 + " Horror6 " + Horror6 );
			//console.log ("  Horror Successes: " + HorrorSuccesses + " Criticals " + HorrorCriticals + " Failures " + HorrorFailures + " Fumbles " + HorrorFumbles);

			CurrentDie += 1;

		}
		//console.log ("  Result1 " + Result1 + " Result2 " + Result2 + " Result3 " + Result3 + " Result4 " + Result4 + " Result5 " + Result5 + " Result6 " + Result6 );
		//console.log ("  Successes: " + Successes + " Criticals " + Criticals + " Failures " + Failures + " Fumbles " + Fumbles);

		//console.log ("  Horror1 " + Horror1 + " Horror2 " + Horror2 + " Horror3 " + Horror3 + " Horror4 " + Horror4 + " Horror5 " + Horror5 + " Horror6 " + Horror6 );
		//console.log ("  Horror Successes: " + HorrorSuccesses + " Criticals " + HorrorCriticals + " Failures " + HorrorFailures + " Fumbles " + HorrorFumbles);

		//console.log ("  Trauma1 " + Trauma1 + " Trauma2 " + Trauma2 + " Trauma3 " + Trauma3 + " Trauma4 " + Trauma4 + " Trauma5 " + Trauma5 + " Trauma6 " + Trauma6 );



		const rollBase ="&{template:check} {{name=@{character_name} *rolls* "+NameCapitalized+"}} {{Hand='1'}} "+ QueryNumDice + " " + QueryHorror + " {{Roll=[["+Roll+"]]}} {{NumDie=[["+NumDie+"]]}} {{HorrorDie=[["+Horror+"]]}} {{Die1="+Result1+"}} {{Die2="+Result2+"}} {{Die3="+Result3+"}} {{Die4="+Result4+"}} {{Die5="+Result5+"}} {{Die6="+Result6+"}}  {{Horror1="+Horror1+"}} {{Horror2="+Horror2+"}} {{Horror3="+Horror3+"}} {{Horror4="+Horror4+"}} {{Horror5="+Horror5+"}} {{Horror6="+Horror6+"}} {{AdvantageDie="+AdvantageDie+"}} {{DisadvantageDie="+DisadvantageDie+"}} {{AdvantageFlag=[["+AdvantageFlag+"]]}} {{DisadvantageFlag=[["+DisadvantageFlag+"]]}} {{TraumaDie=[["+Trauma+"]]}}"; 
		//console.log("  rollBase = " + rollBase);

	    startRoll(rollBase, rollResult => {


			//console.log(" rollResult.results.Dice: " + JSON.stringify(rollResult.results.Dice) );
			NumDie = rollResult.results.Dice.result;
			//console.log("   NumDie:  " + NumDie );

			if ((NumDie < 0) || (NumDie > 6)) {
				if (NumDie < 0) { NumDie = 0;} 	else if (NumDie > 6) { NumDie = 6;}
				//console.log ("  RESET NumDie to " + NumDie);
			}

			//console.log(" rollResult.results.Horror.rolls " + JSON.stringify(rollResult.results.Horror.rolls) );
			NumHorrorDie = rollResult.results.Horror.result;
			if (NumHorrorDie < 0 || NumHorrorDie > 6) {
				if (NumHorrorDie < 0) { NumHorrorDie = 0;} else if (NumHorrorDie > 6) { NumHorrorDie = 6;}
				//console.log ("  RESET NumHorrorDie to " + NumHorrorDie);
			}
			
			//console.log("Roll Cost:  NumDie: " + NumDie + " NumHorrorDie " + NumHorrorDie);
			//console.log("Pool Available:  Normal: " + NormalDieAvailable  + " Temp Normal: " + TemporaryNormalDie + " Horror: " + HorrorDieAvailable + " Temp Horror: " + TemporaryHorrorDie);
			
			// Is the cost covered?
			let Covered = 1; // Assume the cost is covered
			if (NumDie > (NormalDieAvailable + TemporaryNormalDie)) {
				Covered = 0;
				//console.log(" Not enough DIE! Converting Normal from " + NumDie + " to " + NormalDieAvailable + " + " + TemporaryNormalDie);  
				NumDie = NormalDieAvailable + TemporaryNormalDie;
			}
			if (NumHorrorDie > (HorrorDieAvailable + TemporaryHorrorDie)) {
				Covered = 0;
				//console.log(" Not enough Horror DIE! Converting Horror from " + NumHorrorDie + " to " + (HorrorDieAvailable + TemporaryHorrorDie));  
				NumHorrorDie = (HorrorDieAvailable + TemporaryHorrorDie);
			}


			//console.log("!! NumDie: " + NumDie);

			let Adjusted = "0";
			let CommaAdjusted = "";
			for (let i = 1; i <= NumHorrorDie; i++) { 
				Adjusted = String(NumDie + i);
				CommaAdjusted = " " + Adjusted;
   				switch (i) {
					case 1: 
						if (Trauma1 == "1") { Trauma = Adjusted; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;
					case 2: 
						if (Trauma2 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 3: 
						if (Trauma3 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;
					case 4: 
						if (Trauma4 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 5: 
						if (Trauma5 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					case 6: 
						if (Trauma6 == "1") { if (Trauma == "0") {Trauma = Adjusted;} else {Trauma += CommaAdjusted;} ; console.log("  Trauma at Die" + i + " or Adjusted " + Adjusted); }
						break;			
					default:			
						console.log("  Trauma default: " + i);
				}				
	
			}				
			//console.log("  Trauma: " + Trauma);
			//console.log("!! NumDie: " + NumDie);
			
			let NormalDiceCost = NumDie;
			let HorrorDiceCost = NumHorrorDie;
			//console.log("  Pay cost: Normal " + NormalDiceCost +  " Horror " + NumHorrorDie);
			//console.log("     Normal Dice Temp " + TemporaryNormalDie);
			//console.log("     Horror Dice Temp: " + TemporaryHorrorDie);

			if ((TemporaryNormalDie != 0) && (NormalDiceCost > 0)) {
				//console.log("     TemporaryNormalDie: " + TemporaryNormalDie + " NormalDiceCost: " + NormalDiceCost);
				if (NormalDiceCost >= TemporaryNormalDie) {
					NormalDiceCost -= TemporaryNormalDie;
					TemporaryNormalDie = 0;
				} else {
					TemporaryNormalDie -= NormalDiceCost;
					NormalDiceCost = 0;
				}
			}
			//console.log("     NormalDiceCost: " + NormalDiceCost + " NormalDieAvailable: " + NormalDieAvailable);
			//console.log("!!! NumDie: " + NumDie);
			if (NormalDiceCost > 0) {
				if (NormalDiceCost > NumDie) {
					//console.log("??? NumDie: " + NumDie + " NormalDiceCost " + NormalDiceCost + " NormalDieAvailable " + NormalDieAvailable);
					NumDie = NormalDieAvailable;
				}
				// Dice Dashboard update
				let DieSpent = 0;
				
				for (let j = 6; (j > 0) && (DieSpent < NumDie) ; j--) {
					//console.log ("   j = " + j + " DieSpent = " + DieSpent + " NumDie " + NumDie);
					switch (j) {
						case 1 :   if (Die1Background == "0") {Die1Background = "3"; Die1 = "0"; DieSpent++; console.log("  Used Die1"); }; break;
						case 2 :   if (Die2Background == "0") {Die2Background = "3"; Die2 = "0"; DieSpent++; console.log("  Used Die2"); }; break;
						case 3 :   if (Die3Background == "0") {Die3Background = "3"; Die3 = "0"; DieSpent++; console.log("  Used Die3"); }; break;
						case 4 :   if (Die4Background == "0") {Die4Background = "3"; Die4 = "0"; DieSpent++; console.log("  Used Die4"); }; break;
						case 5 :   if (Die5Background == "0") {Die5Background = "3"; Die5 = "0"; DieSpent++; console.log("  Used Die5"); }; break;
						case 6 :   if (Die6Background == "0") {Die6Background = "3"; Die6 = "0"; DieSpent++; console.log("  Used Die6"); }; break;
						default: console.log(" Die not found at " + j );
					}
				}
				//console.log("  Die: " + Die1 + " " + Die2 + " " + Die3 + " " + Die4 + " " + Die5 + " " + Die6);
				//console.log("  Background: " + Die1Background + " " + Die2Background + " " + Die3Background + " " + Die4Background + " " + Die5Background + " " + Die6Background);
			}
			//console.log("!!!! NumDie: " + NumDie);


			if ((TemporaryHorrorDie != 0) && (HorrorDiceCost > 0)) {
				//console.log("     TemporaryHorrorDie: " + TemporaryHorrorDie + " HorrorDiceCost: " + HorrorDiceCost);
				if (HorrorDiceCost >= TemporaryHorrorDie) {
					HorrorDiceCost -= TemporaryHorrorDie;
					TemporaryHorrorDie = 0;
				} else {
					TemporaryHorrorDie -= HorrorDiceCost;
					HorrorDiceCost = 0;
				}
			}
			//console.log("     HorrorDiceCost: " + HorrorDiceCost + " HorrorDieAvailable: " + HorrorDieAvailable);

			if (HorrorDiceCost > 0) {
				if (HorrorDiceCost >= NumHorrorDie) {
					NumHorrorDie = HorrorDieAvailable;
				}
				// Dice Dashboard update
				let DieSpent = 0;
				
				for (let j = 6; (j > 0) && (DieSpent < NumHorrorDie) ; j--) {
					//console.log ("   j = " + j + " DieSpent = " + DieSpent + " NumHorrorDie " + NumDie);
					switch (j) {
						case 1 :   if (Die1Background == "1") {Die1Background = "3"; Die1 = "0"; DieSpent++; console.log("  Used Die1"); }; break;
						case 2 :   if (Die2Background == "1") {Die2Background = "3"; Die2 = "0"; DieSpent++; console.log("  Used Die2"); }; break;
						case 3 :   if (Die3Background == "1") {Die3Background = "3"; Die3 = "0"; DieSpent++; console.log("  Used Die3"); }; break;
						case 4 :   if (Die4Background == "1") {Die4Background = "3"; Die4 = "0"; DieSpent++; console.log("  Used Die4"); }; break;
						case 5 :   if (Die5Background == "1") {Die5Background = "3"; Die5 = "0"; DieSpent++; console.log("  Used Die5"); }; break;
						case 6 :   if (Die6Background == "1") {Die6Background = "3"; Die6 = "0"; DieSpent++; console.log("  Used Die6"); }; break;
						default: console.log(" Die not found at " + j );
					}
				}
			}

			let NewDicePool = NormalDieAvailable + HorrorDieAvailable - NormalDiceCost - HorrorDiceCost;
			//console.log("     Dice Pool: " + (NormalDieAvailable + HorrorDieAvailable) + " NewDicePool: " + NewDicePool);
					
			setAttrs({                            
				dice_pool: NewDicePool, normal_dice: NormalDieAvailable - NormalDiceCost, horror_dice: HorrorDieAvailable - HorrorDiceCost, temporary_normal_dice: TemporaryNormalDie, temporary_horror_dice: TemporaryHorrorDie,
					die1: Die1, die1_background_oolor: Die1Background,
					die2: Die2, die2_background_oolor: Die2Background,
					die3: Die3, die3_background_oolor: Die3Background,
					die4: Die4, die4_background_oolor: Die4Background,
					die5: Die5, die5_background_oolor: Die5Background,
					die6: Die6, die6_background_oolor: Die6Background
			});

			//console.log("  For Display: Normal " + NumDie + " Horror " + NumHorrorDie);

			finishRoll(
				rollResult.rollId,
				{
					NumDie: NumDie,
					HorrorDie: NumHorrorDie,
					TraumaDie: Trauma,
					AdvantageFlag: AdvantageFlag,
					DisadvantageFlag: DisadvantageFlag
				}
			);
		});
	});
});

</script>
