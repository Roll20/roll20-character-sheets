<div class="sheet-container">
    <input type='hidden' class='tabstoggle' name='attr_sheetTab'  value='charactertab'  />
    <div class="navi tab-navi">
        <button class="character-sheet" type="action" name="act_charactertab" >Charakter</button>
        <button class="character-sheet" type="action" name="act_descriptionequipmenttab" >Inventar</button>
        <div>
            <input type="hidden" class="additionalform1-toggle" name="attr_additionalform1">
            <button class="character-sheet additionalform1" type="action" name="act_additionalform1tab" >1. Wandelform</button>
        </div>
        <div>
            <input type="hidden" class="additionalform2-toggle" name="attr_additionalform2">
            <button class="character-sheet additionalform2" type="action" name="act_additionalform2tab" >2. Wandelform</button>
        </div>
        <div>
            <input type="hidden" class="additionalform3-toggle" name="attr_additionalform3">
            <button class="character-sheet additionalform3" type="action" name="act_additionalform3tab" >3. Wandelform</button>
        </div>
        <div></div>
        <button type="action" name="act_settingstab" >Einstellungen</button>
    </div>
    <div class="charactertab">
        <div class="character-container">
            <div class="character-container-left">
                <div class="character-attributes-container">
                    <div class="character-attributes-headers">
                        <h3 class="character-attributes-header">Eigenschaften</h3>
                        <h3 class="character-attributes-header">Wert</h3>
                        <h3 class="character-attributes-header">+ / -</h3>
                    </div>
                    <div class="character-base-attributes">
                        <div class="character-base-attribute character-strength-container">
                            <h3 class="input-label-left">Stärke</h3>
                            <input type="number" name="attr_character_strength_base" value="0" />
                            <button type='roll' name='roll_character_strength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_strength_base}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Stärke}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_character_strength_mod" value="0" readonly />
                            <button type='roll' name='roll_character_strength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_strength_mod}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Stärke}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-constitution-container">
                            <h3 class="input-label-left">Konstitution</h3>
                            <input type="number" name="attr_character_constitution_base" value="0" />
                            <button type='roll' name='roll_character_constitution_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_constitution_base}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Konstitution}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_character_constitution_mod" value="0" readonly />
                            <button type='roll' name='roll_character_constitution_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_constitution_mod}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Konstitution}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-dexterity-container">
                            <h3 class="input-label-left">Geschicklichkeit</h3>
                            <input type="number" name="attr_character_dexterity_base" value="0" />
                            <button type='roll' name='roll_character_dexterity_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_dexterity_base}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod] + [[-@{character_armorreduction}]][Rüstungsabzug]]] {{type=Attribut Grundwert}} {{skillname=Geschicklichkeit}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>

                            <input type="number" name="attr_character_dexterity_mod" value="0" readonly />
                            <button type='roll' name='roll_character_dexterity_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_dexterity_mod}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geschicklichkeit}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-charisma-container">
                            <h3 class="input-label-left">Charisma</h3>
                            <input type="number" name="attr_character_charisma_base" value="0" />
                            <button type='roll' name='roll_character_charisma_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_charisma_base}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Charisma}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_character_charisma_mod" value="0" readonly />
                            <button type='roll' name='roll_character_charisma_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_charisma_mod}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Charisma}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                        </div>
                        <div class="character-base-attribute character-intelligence-container">
                            <h3 class="input-label-left">Intelligenz</h3>
                            <input type="number" name="attr_character_intelligence_base" value="0" />
                            <button type='roll' name='roll_character_intelligence_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_intelligence_base}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Intelligenz}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_character_intelligence_mod" value="0" readonly />
                            <button type='roll' name='roll_character_intelligence_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_intelligence_mod}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Intelligenz}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-mentalstrength-container">
                            <h3 class="input-label-left">Geistige Kraft</h3>
                            <input type="number" name="attr_character_mentalstrength_base" value="0" />
                            <button type='roll' name='roll_character_mentalstrength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_mentalstrength_base}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Geistige Kraft}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_character_mentalstrength_mod" value="0" readonly />
                            <button type='roll' name='roll_character_mentalstrength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_mentalstrength_mod}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geistige Kraft}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                    </div>
                    <div class="character-additional-attributes">
                        <div class="character-base-attribute">
                            <h3 class="input-label-left">Initiative (K / G)</h3>
                            <input type="number" name="attr_character_initiative_body" value="0" readonly />
                            <button type='roll' name='roll_character_initiative_body' value='&{template:initiative} [[ [[[[@{character_initiative_body}]][Körperliche Initiative] - [[1d6]][Rot]]] [[[[@{character_initiative_body}]][Körperliche Initiative] + [[1d6]][Blau]]] ]] {{type=Körperliche}} {{user=@{character_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                            <input type="number" name="attr_character_initiative_mind" value="0" readonly />
                            <button type='roll' name='roll_character_initiative_mind' value='&{template:initiative} [[ [[[[@{character_initiative_mind}]][Geistige Initiative] - [[1d6]][Rot]]] [[[[@{character_initiative_mind}]][Geistige Initiative] + [[1d6]][Blau]]] ]] {{type=Geistige}} {{user=@{character_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                        </div>
                        <div class="character-additional-attribute critical-hit-container">
                            <h3 class="input-label-left">Kritischer Treffer</h3>
                            <input type="number" name="attr_character_criticalhit" value="0" readonly />
                            <input type="hidden" name="attr_optionalRuleCriticalHit" value="0">
                            <button type="action" class="rollbutton" name="act_charactercriticalhit"></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Tod</h3>
                            <input type="number" name="attr_character_death" value="0" readonly />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute dodge-container" >
                            <h3 class="input-label-left">Ausweichen</h3>
                            <input type="number" name="attr_character_dodge" value="0" readonly />
                            <button type='roll' name='roll_character_dodge' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_dodge}]][Ausweichen] + [[?{Modifier|0}]][Mod]]] {{skillname=Ausweichen}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute magicresistance-container">
                            <h3 class="input-label-left">Zauberresistenz</h3>
                            <input type="number" name="attr_character_magicresistance" value="0" readonly />
                            <button type='roll' name='roll_character_magicresistance' value='&{template:skill} [[[[1d20]][Würfel] + [[@{character_magicresistance}]][Zauberresistenz] + [[?{Modifier|0}]][Mod]]] {{skillname=Zauberresistenz}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Körperentwicklung</h3>
                            <input type="hidden" name="attr_bodydevelopment_characterautocalculation" value="1" />
                            <input type="hidden" name="attr_bodydevelopment_characternormalskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_characterweaponskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_charactermagicskills" value="0" />
                            <input type="number" name="attr_bodydevelopment_character" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_bodydevelopment_characterautocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Geistentwicklung</h3>
                            <input type="hidden" name="attr_minddevelopment_characterautocalculation" value="1" />
                            <input type="hidden" name="attr_minddevelopment_characternormalskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_characterweaponskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_charactermagicskills" value="0" />
                            <input type="number" name="attr_minddevelopment_character" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_minddevelopment_characterautocalculation" value="1" checked /></label>

                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration LP</h3>
                            <input type="text" name="attr_character_regenerationhp" value="0" />
                            <button type='roll' name='roll_character_regenerationhp' value='&{template:regeneration} [[@{character_regenerationhp}]] {{type=Lebenspunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration MP</h3>
                            <input type="text" name="attr_character_regenerationmp" value="0" />
                            <button type='roll' name='roll_character_regenerationmp' value='&{template:regeneration} [[@{character_regenerationmp}]] {{type=Magiepunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Rüstungsschutz</h3>
                            <input type="number" name="attr_character_armor" value="0" />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute character-armorreduction-container">
                            <h3 class="input-label-left">Rüstungsabzüge</h3>
                            <input type="hidden" name="attr_armorreduction_character_autocalc" value="1" />
                            <input type="number" name="attr_character_armorreduction" value="0" min="0" />
                            <input type="number" name="attr_character_armorreduction_manual" value="0" min="0" />
                            <label>In Berechnungen berücksichtigen</label>
                            <label><input type="checkbox" name="attr_armorreduction_character_autocalc" value="1" checked /></label>
                        </div>
                    </div>
                </div>
                <div class="powers-container">
                    <div class="powers-headers">
                        <h3>Kräfte</h3>
                        <fieldset class="repeating_characterpowers">
                            <div class="characterpower-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_togglecharacterpowerdetail"></button>
                                <input class="powers" type="text" name="attr_characterpower" />
                                <div class="characterpower-detail">
                                    <textarea name="attr_characterpowerdetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="race-skills-container">
                    <div class="race-skills-headers">
                        <h3>Völkerspezifische Fertigkeiten</h3>
                        <fieldset class="repeating_characterraceskills">
                            <div class="characterraceskill-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_toggleraceskillsdetail"></button>
                                <input class="race" type="text" name="attr_raceskill" />
                                <div class="characterraceskill-detail">
                                    <textarea name="attr_characterraceskilldetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="character-container-right">
                <div class="character-status">
                    <div class="character-base-info-container">
                        <div>
                            <h3>Name</h3>
                            <input class="base-info-character-name" type="text" name="attr_character_name" />
                        </div>
                        <div>
                            <h3>Sphäre</h3>
                            <input class="base-info-character-sphere" type="text" name="attr_character_sphere" />
                        </div>
                        <div>
                            <h3>Volk</h3>
                            <input class="base-info-character-race" type="text" name="attr_character_race" />
                        </div>
                        <div>
                            <h3>Profession</h3>
                            <input class="base-info-character-profession" type="text" name="attr_character_profession" />
                        </div>
                    </div>
                    <div class="character-health-container">
                        <h3 class="status-header">Lebenspunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_character_max_hp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_character_temp_hp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_character_total_hp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_character_curr_hp" value="0" />
                        <div></div>
                    </div>
                    <div class="character-magic-container">
                        <h3 class="status-header">Magiepunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_character_max_mp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_character_temp_mp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_character_total_mp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_character_curr_mp" value="0" />
                        <div></div>
                    </div>
                </div>
                <div class="all-skills-container">
                    <input type='hidden' class='skilltoggle' name='attr_characterskilltab'  value='characternormalskills'  />
                    <div class="navi all-skills-navi">
                        <button type="action" name="act_characternormalskills" >Fertigkeiten</button>
                        <button type="action" name="act_characterweaponskills" >Waffen</button>
                        <button type="action" name="act_charactermagicskills" >Magie</button>
                        <div></div>
                    </div>
                    <div class="normal-skills-container">
                        <div class="normal-skills-headers">
                            <div></div>
                            <h3>Normale Fertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="normal-skills-table-container">
                            <fieldset class="repeating_characternormalskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="normal-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addnormalskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <select class="normal-skill normal-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_skillmod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="normal-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_skilltotal' value='&{template:skill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="normal-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_divskilltotal' value='&{template:skill} [[ [[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}} {{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="weapon-skills-container">
                        <div class="weapon-skills-headers">
                            <div></div>
                            <h3>Waffenfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Attacke</h3>
                            <h3>Parade</h3>
                            <h3>+ / -</h3>
                            <h3>Schaden</h3>
                        </div>
                        <fieldset class="repeating_characterweaponskills">
                            <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                            <input name="attr_armorreduction" type="hidden" value="0" >
                            <div class="weapon-skill-container">
                                <button class="adddiversification-button" type="action" name="act_addweaponskilldiversification" title="Neue Ausprägung">+</button>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <select class="weapon-skill weapon-skill-attribute" name="attr_attribute">
                                    <option selected value="none">-</option>
                                    <option value="strength">Stärke</option>
                                    <option value="constitution">Konstitution</option>
                                    <option value="dexterity">Geschicklichkeit</option>
                                    <option value="charisma">Charisma</option>
                                    <option value="intelligence">Intelligenz</option>
                                    <option value="mentalstrength">Geistige Kraft</option>
                                </select>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[[[1d20]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[[[1d20]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" readonly />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                            <div class="weapon-skill-diversification-container">
                                <div class="skill-sublist-item-arrow"></div>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <div class="mastery-container">
                                    <input name="attr_attackmastery" type="hidden" value="0" />
                                    <input name="attr_parademastery" type="hidden" value="0" />
                                    <select class="weapon-mastery" name="attr_mastery">
                                        <option selected value="none">Kein Meister</option>
                                        <option value="attackmastery">Meister Attacke</option>
                                        <option value="parademastery">Meister Parade</option>
                                    </select>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[ [[[[1 + @{attackmastery}]]d20kh1]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[ [[[[1 + @{parademastery}]]d20kh1]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="magic-skills-container">
                        <div class="magic-skills-headers">
                            <div></div>
                            <h3>Zauberfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="magic-skills-table-container">
                            <fieldset class="repeating_charactermagicskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="magic-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addmagicskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <select class="magic-skill magic-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_magicskillmod' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge]]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="magic-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge]]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="magic-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="space-taker"></div>
            </div>
        </div>
    </div>
    <div class="descriptionequipmenttab">
        <div class="descriptionequipment-container">
            <div class="descriptionequipment-left-container">
                <div class="equipment-container">
                    <h3>Ausrüstung</h3>
                    <fieldset class="repeating_equipment">
                        <input class="equipment" type="text" name="attr_equipment" />
                    </fieldset>
                </div>
            </div>
            <div class="descriptionequipment-center-container">
                <div class="money-container">
                    <h3>Geld / Vermögen</h3>
                    <fieldset class="repeating_money">
                        <div class="money-item-container">
                            <input type="text" name="attr_money" />
                            <input type="number" name="attr_amount" value="0" />
                        </div>
                    </fieldset>
                </div>
                <div class="specialequipment-list-container">
                    <div class="specialequipment-headers">
                        <h3>Besondere Gegenstände</h3>
                        <fieldset class="repeating_specialequipment">
                            <div class="specialequipment-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_togglespecialequipment"></button>
                                <input class="specialequipment" type="text" name="attr_specialequipment" />
                                <div class="specialequipment-detail">
                                    <textarea name="attr_specialequipmentdetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                </div>
            </div>
            <div class="descriptionequipment-right-container">
                <div class="skillpoint-container">
                    <h3>Fertigkeitspunkte</h3>
                    <div class="skillpoint-table">
                        <div></div><h3>ST</h3><h3>KO</h3><h3>GE</h3><h3>CH</h3><h3>IN</h3><h3>GK</h3><h3>Allg</h3>
                        <h3>Unverbraucht</h3>
                        <input type="number" name="attr_str_notused" value="0" />
                        <input type="number" name="attr_con_notused" value="0" />
                        <input type="number" name="attr_dex_notused" value="0" />
                        <input type="number" name="attr_cha_notused" value="0" />
                        <input type="number" name="attr_int_notused" value="0" />
                        <input type="number" name="attr_mp_notused" value="0" />
                        <input type="number" name="attr_all_notused" value="0" />
                        <h3>Verbraucht</h3>
                        <input type="number" name="attr_str_used" value="0" />
                        <input type="number" name="attr_con_used" value="0" />
                        <input type="number" name="attr_dex_used" value="0" />
                        <input type="number" name="attr_cha_used" value="0" />
                        <input type="number" name="attr_int_used" value="0" />
                        <input type="number" name="attr_mp_used" value="0" />
                        <input type="number" name="attr_all_used" value="0" />
                        <h3>Insgesamt</h3>
                        <input type="number" name="attr_str_total" value="0" readonly />
                        <input type="number" name="attr_con_total" value="0" readonly />
                        <input type="number" name="attr_dex_total" value="0" readonly />
                        <input type="number" name="attr_cha_total" value="0" readonly />
                        <input type="number" name="attr_int_total" value="0" readonly />
                        <input type="number" name="attr_mp_total" value="0" readonly />
                        <input type="number" name="attr_all_total" value="0" readonly />
                    </div>
                </div>
                <div class="spheresiblings-container">
                    <h3>Sphärengeschwister</h3>
                    <fieldset class="repeating_speresiblings">
                        <div class="spheresibling-container">
                            <input class="spheresiblings" type="text" name="attr_spheresibling" value="Name" />
                            <input class="spheresiblings" type="text" name="attr_spheresiblingsphere" value="Sphäre" />
                            <input class="spheresiblings" type="text" name="attr_spheresiblingprofession" value="Profession" />
                        </div>
                    </fieldset>
                </div>
            </div>
            <div class="character-description-container">
                <h3>Charakterbeschreibung</h3>
                <textarea name="attr_characterdescription"></textarea>
            </div>
            <div></div>
        </div>
    </div>
    <div class="additionalform1tab">
        <div class="character-container">
            <div class="character-container-left">
                <div class="character-attributes-container">
                    <div class="character-attributes-headers">
                        <h3 class="character-attributes-header">Eigenschaften</h3>
                        <h3 class="character-attributes-header">Wert</h3>
                        <h3 class="character-attributes-header">+ / -</h3>
                    </div>
                    <div class="character-base-attributes">
                        <div class="character-base-attribute character-strength-container">
                            <h3 class="input-label-left">Stärke</h3>
                            <input type="number" name="attr_form1_strength_base" value="0" />
                            <button type='roll' name='roll_form1_strength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_strength_base}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Stärke}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form1r_strength_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_strength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_strength_mod}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Stärke}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-constitution-container">
                            <h3 class="input-label-left">Konstitution</h3>
                            <input type="number" name="attr_form1_constitution_base" value="0" />
                            <button type='roll' name='roll_form1_constitution_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_constitution_base}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Konstitution}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form1_constitution_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_constitution_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_constitution_mod}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Konstitution}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-dexterity-container">
                            <h3 class="input-label-left">Geschicklichkeit</h3>
                            <input type="number" name="attr_form1_dexterity_base" value="0" />
                            <button type='roll' name='roll_form1_dexterity_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_dexterity_base}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod] + [[-@{form1_armorreduction}]][Rüstungsabzug]]] {{type=Attribut Grundwert}} {{skillname=Geschicklichkeit}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>

                            <input type="number" name="attr_form1_dexterity_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_dexterity_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_dexterity_mod}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geschicklichkeit}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-charisma-container">
                            <h3 class="input-label-left">Charisma</h3>
                            <input type="number" name="attr_form1_charisma_base" value="0" />
                            <button type='roll' name='roll_form1_charisma_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_charisma_base}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Charisma}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form1_charisma_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_charisma_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_charisma_mod}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Charisma}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                        </div>
                        <div class="character-base-attribute character-intelligence-container">
                            <h3 class="input-label-left">Intelligenz</h3>
                            <input type="number" name="attr_form1_intelligence_base" value="0" />
                            <button type='roll' name='roll_form1_intelligence_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_intelligence_base}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Intelligenz}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form1_intelligence_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_intelligence_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_intelligence_mod}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Intelligenz}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-mentalstrength-container">
                            <h3 class="input-label-left">Geistige Kraft</h3>
                            <input type="number" name="attr_form1_mentalstrength_base" value="0" />
                            <button type='roll' name='roll_form1_mentalstrength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_mentalstrength_base}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Geistige Kraft}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form1_mentalstrength_mod" value="0" readonly />
                            <button type='roll' name='roll_form1_mentalstrength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_mentalstrength_mod}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geistige Kraft}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                    </div>
                    <div class="character-additional-attributes">
                        <div class="character-base-attribute">
                            <h3 class="input-label-left">Initiative (K / G)</h3>
                            <input type="number" name="attr_form1_initiative_body" value="0" readonly />
                            <button type='roll' name='roll_form1_initiative_body' value='&{template:initiative} [[ [[[[@{form1_initiative_body}]][Körperliche Initiative] - [[1d6]][Rot]]] [[[[@{form1_initiative_body}]][Körperliche Initiative] + [[1d6]][Blau]]] ]] {{type=Körperliche}} {{user=@{form1_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                            <input type="number" name="attr_form1_initiative_mind" value="0" readonly />
                            <button type='roll' name='roll_form1_initiative_mind' value='&{template:initiative} [[ [[[[@{form1_initiative_mind}]][Geistige Initiative] - [[1d6]][Rot]]] [[[[@{form1_initiative_mind}]][Geistige Initiative] + [[1d6]][Blau]]] ]] {{type=Geistige}} {{user=@{form1_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                        </div>
                        <div class="character-additional-attribute critical-hit-container">
                            <h3 class="input-label-left">Kritischer Treffer</h3>
                            <input type="number" name="attr_form1_criticalhit" value="0" readonly />
                            <input type="hidden" name="attr_optionalRuleCriticalHit" value="0">
                            <button type="action" class="rollbutton" name="act_form1criticalhit"></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Tod</h3>
                            <input type="number" name="attr_form1_death" value="0" readonly />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute dodge-container" >
                            <h3 class="input-label-left">Ausweichen</h3>
                            <input type="number" name="attr_form1_dodge" value="0" readonly />
                            <button type='roll' name='roll_form1_dodge' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_dodge}]][Ausweichen] + [[?{Modifier|0}]][Mod]]] {{skillname=Ausweichen}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute magicresistance-container">
                            <h3 class="input-label-left">Zauberresistenz</h3>
                            <input type="number" name="attr_form1_magicresistance" value="0" readonly />
                            <button type='roll' name='roll_form1_magicresistance' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form1_magicresistance}]][Zauberresistenz] + [[?{Modifier|0}]][Mod]]] {{skillname=Zauberresistenz}} {{user=@{form1_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Körperentwicklung</h3>
                            <input type="hidden" name="attr_bodydevelopment_form1autocalculation" value="1" />
                            <input type="hidden" name="attr_bodydevelopment_form1normalskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form1weaponskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form1magicskills" value="0" />
                            <input type="number" name="attr_bodydevelopment_form1" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_bodydevelopment_form1autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Geistentwicklung</h3>
                            <input type="hidden" name="attr_minddevelopment_form1autocalculation" value="1" />
                            <input type="hidden" name="attr_minddevelopment_form1normalskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form1weaponskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form1magicskills" value="0" />
                            <input type="number" name="attr_minddevelopment_form1" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_minddevelopment_form1autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration LP</h3>
                            <input type="text" name="attr_form1_regenerationhp" value="0" />
                            <button type='roll' name='roll_form1_regenerationhp' value='&{template:regeneration} [[@{form1_regenerationhp}]] {{type=Lebenspunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration MP</h3>
                            <input type="text" name="attr_form1_regenerationmp" value="0" />
                            <button type='roll' name='roll_form1_regenerationmp' value='&{template:regeneration} [[@{form1_regenerationmp}]] {{type=Magiepunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Rüstungsschutz</h3>
                            <input type="number" name="attr_form1_armor" value="0" />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute character-armorreduction-container">
                            <h3 class="input-label-left">Rüstungsabzüge</h3>
                            <input type="hidden" name="attr_armorreduction_form1_autocalc" value="1" />
                            <input type="number" name="attr_form1_armorreduction" value="0" min="0" />
                            <input type="number" name="attr_form1_armorreduction_manual" value="0" min="0" />
                            <label>In Berechnungen berücksichtigen</label>
                            <label><input type="checkbox" name="attr_armorreduction_form1_autocalc" value="1" checked /></label>
                        </div>
                    </div>
                </div>
                <div class="powers-container">
                    <div class="powers-headers">
                        <h3>Kräfte</h3>
                        <fieldset class="repeating_form1powers">
                            <div class="characterpower-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_togglecharacterpowerdetail"></button>
                                <input class="powers" type="text" name="attr_characterpower" />
                                <div class="characterpower-detail">
                                    <textarea name="attr_characterpowerdetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="race-skills-container">
                    <div class="race-skills-headers">
                        <h3>Völkerspezifische Fertigkeiten</h3>
                        <fieldset class="repeating_form1raceskills">
                            <div class="characterraceskill-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_toggleraceskillsdetail"></button>
                                <input class="race" type="text" name="attr_raceskill" />
                                <div class="characterraceskill-detail">
                                    <textarea name="attr_characterraceskilldetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="character-container-right">
                <div class="character-status">
                    <div class="character-base-info-container">
                        <div>
                            <h3>Name</h3>
                            <input class="base-info-character-name" type="text" name="attr_form1_name" />
                        </div>
                        <div>
                            <h3>Sphäre</h3>
                            <input class="base-info-character-sphere" type="text" name="attr_form1_sphere" />
                        </div>
                        <div>
                            <h3>Volk</h3>
                            <input class="base-info-character-race" type="text" name="attr_form1_race" />
                        </div>
                        <div>
                            <h3>Profession</h3>
                            <input class="base-info-character-profession" type="text" name="attr_form1_profession" />
                        </div>
                    </div>
                    <div class="character-health-container">
                        <h3 class="status-header">Lebenspunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form1_max_hp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form1_temp_hp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form1_total_hp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form1_curr_hp" value="0" />
                        <div></div>
                    </div>
                    <div class="character-magic-container">
                        <h3 class="status-header">Magiepunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form1_max_mp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form1_temp_mp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form1_total_mp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form1_curr_mp" value="0" />
                        <div></div>
                    </div>
                </div>
                <div class="all-skills-container">
                    <input type='hidden' class='skilltoggle' name='attr_form1skilltab'  value='form1normalskills'  />
                    <div class="navi all-skills-navi">
                        <button type="action" name="act_form1normalskills" >Fertigkeiten</button>
                        <button type="action" name="act_form1weaponskills" >Waffen</button>
                        <button type="action" name="act_form1magicskills" >Magie</button>
                        <div></div>
                    </div>
                    <div class="normal-skills-container">
                        <div class="normal-skills-headers">
                            <div></div>
                            <h3>Normale Fertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="normal-skills-table-container">
                            <fieldset class="repeating_form1normalskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="normal-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addnormalskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <select class="normal-skill normal-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_skillmod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="normal-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_skilltotal' value='&{template:skill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="normal-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_divskilltotal' value='&{template:skill} [[ [[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="weapon-skills-container">
                        <div class="weapon-skills-headers">
                            <div></div>
                            <h3>Waffenfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Attacke</h3>
                            <h3>Parade</h3>
                            <h3>+ / -</h3>
                            <h3>Schaden</h3>
                        </div>
                        <fieldset class="repeating_form1weaponskills">
                            <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                            <input name="attr_armorreduction" type="hidden" value="0" >
                            <div class="weapon-skill-container">
                                <button class="adddiversification-button" type="action" name="act_addweaponskilldiversification" title="Neue Ausprägung">+</button>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <select class="weapon-skill weapon-skill-attribute" name="attr_attribute">
                                    <option selected value="none">-</option>
                                    <option value="strength">Stärke</option>
                                    <option value="constitution">Konstitution</option>
                                    <option value="dexterity">Geschicklichkeit</option>
                                    <option value="charisma">Charisma</option>
                                    <option value="intelligence">Intelligenz</option>
                                    <option value="mentalstrength">Geistige Kraft</option>
                                </select>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[[[1d20]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[[[1d20]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" readonly />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                            <div class="weapon-skill-diversification-container">
                                <div class="skill-sublist-item-arrow"></div>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <div class="mastery-container">
                                    <input name="attr_attackmastery" type="hidden" value="0" />
                                    <input name="attr_parademastery" type="hidden" value="0" />
                                    <select class="weapon-mastery" name="attr_mastery">
                                        <option selected value="none">Kein Meister</option>
                                        <option value="attackmastery">Meister Attacke</option>
                                        <option value="parademastery">Meister Parade</option>
                                    </select>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[ [[[[1 + @{attackmastery}]]d20kh1]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[ [[[[1 + @{parademastery}]]d20kh1]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="magic-skills-container">
                        <div class="magic-skills-headers">
                            <div></div>
                            <h3>Zauberfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="magic-skills-table-container">
                            <fieldset class="repeating_form1magicskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="magic-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addmagicskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <select class="magic-skill magic-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_magicskillmod' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="magic-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="magic-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="space-taker"></div>
            </div>
        </div>
    </div>
    <div class="additionalform2tab">
        <div class="character-container">
            <div class="character-container-left">
                <div class="character-attributes-container">
                    <div class="character-attributes-headers">
                        <h3 class="character-attributes-header">Eigenschaften</h3>
                        <h3 class="character-attributes-header">Wert</h3>
                        <h3 class="character-attributes-header">+ / -</h3>
                    </div>
                    <div class="character-base-attributes">
                        <div class="character-base-attribute character-strength-container">
                            <h3 class="input-label-left">Stärke</h3>
                            <input type="number" name="attr_form2_strength_base" value="0" />
                            <button type='roll' name='roll_form2_strength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_strength_base}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Stärke}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form2r_strength_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_strength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_strength_mod}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Stärke}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-constitution-container">
                            <h3 class="input-label-left">Konstitution</h3>
                            <input type="number" name="attr_form2_constitution_base" value="0" />
                            <button type='roll' name='roll_form2_constitution_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_constitution_base}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Konstitution}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form2_constitution_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_constitution_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_constitution_mod}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Konstitution}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-dexterity-container">
                            <h3 class="input-label-left">Geschicklichkeit</h3>
                            <input type="number" name="attr_form2_dexterity_base" value="0" />
                            <button type='roll' name='roll_form2_dexterity_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_dexterity_base}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod] + [[-@{form2_armorreduction}]][Rüstungsabzug]]] {{type=Attribut Grundwert}} {{skillname=Geschicklichkeit}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>

                            <input type="number" name="attr_form2_dexterity_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_dexterity_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_dexterity_mod}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geschicklichkeit}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-charisma-container">
                            <h3 class="input-label-left">Charisma</h3>
                            <input type="number" name="attr_form2_charisma_base" value="0" />
                            <button type='roll' name='roll_form2_charisma_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_charisma_base}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Charisma}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form2_charisma_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_charisma_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_charisma_mod}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Charisma}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                        </div>
                        <div class="character-base-attribute character-intelligence-container">
                            <h3 class="input-label-left">Intelligenz</h3>
                            <input type="number" name="attr_form2_intelligence_base" value="0" />
                            <button type='roll' name='roll_form2_intelligence_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_intelligence_base}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Intelligenz}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form2_intelligence_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_intelligence_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_intelligence_mod}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Intelligenz}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-mentalstrength-container">
                            <h3 class="input-label-left">Geistige Kraft</h3>
                            <input type="number" name="attr_form2_mentalstrength_base" value="0" />
                            <button type='roll' name='roll_form2_mentalstrength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_mentalstrength_base}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Geistige Kraft}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form2_mentalstrength_mod" value="0" readonly />
                            <button type='roll' name='roll_form2_mentalstrength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_mentalstrength_mod}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geistige Kraft}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                    </div>
                    <div class="character-additional-attributes">
                        <div class="character-base-attribute">
                            <h3 class="input-label-left">Initiative (K / G)</h3>
                            <input type="number" name="attr_form2_initiative_body" value="0" readonly />
                            <button type='roll' name='roll_form2_initiative_body' value='&{template:initiative} [[ [[[[@{form2_initiative_body}]][Körperliche Initiative] - [[1d6]][Rot]]] [[[[@{form2_initiative_body}]][Körperliche Initiative] + [[1d6]][Blau]]] ]] {{type=Körperliche}} {{user=@{form2_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                            <input type="number" name="attr_form2_initiative_mind" value="0" readonly />
                            <button type='roll' name='roll_form2_initiative_mind' value='&{template:initiative} [[ [[[[@{form2_initiative_mind}]][Geistige Initiative] - [[1d6]][Rot]]] [[[[@{form2_initiative_mind}]][Geistige Initiative] + [[1d6]][Blau]]] ]] {{type=Geistige}} {{user=@{form2_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                        </div>
                        <div class="character-additional-attribute critical-hit-container">
                            <h3 class="input-label-left">Kritischer Treffer</h3>
                            <input type="number" name="attr_form2_criticalhit" value="0" readonly />
                            <input type="hidden" name="attr_optionalRuleCriticalHit" value="0">
                            <button type="action" class="rollbutton" name="act_form2criticalhit"></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Tod</h3>
                            <input type="number" name="attr_form2_death" value="0" readonly />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute dodge-container" >
                            <h3 class="input-label-left">Ausweichen</h3>
                            <input type="number" name="attr_form2_dodge" value="0" readonly />
                            <button type='roll' name='roll_form2_dodge' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_dodge}]][Ausweichen] + [[?{Modifier|0}]][Mod]]] {{skillname=Ausweichen}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute magicresistance-container">
                            <h3 class="input-label-left">Zauberresistenz</h3>
                            <input type="number" name="attr_form2_magicresistance" value="0" readonly />
                            <button type='roll' name='roll_form2_magicresistance' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form2_magicresistance}]][Zauberresistenz] + [[?{Modifier|0}]][Mod]]] {{skillname=Zauberresistenz}} {{user=@{form2_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Körperentwicklung</h3>
                            <input type="hidden" name="attr_bodydevelopment_form2autocalculation" value="1" />
                            <input type="hidden" name="attr_bodydevelopment_form2normalskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form2weaponskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form2magicskills" value="0" />
                            <input type="number" name="attr_bodydevelopment_form2" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_bodydevelopment_form2autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Geistentwicklung</h3>
                            <input type="hidden" name="attr_minddevelopment_form2autocalculation" value="1" />
                            <input type="hidden" name="attr_minddevelopment_form2normalskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form2weaponskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form2magicskills" value="0" />
                            <input type="number" name="attr_minddevelopment_form2" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_minddevelopment_form2autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration LP</h3>
                            <input type="text" name="attr_form2_regenerationhp" value="0" />
                            <button type='roll' name='roll_form2_regenerationhp' value='&{template:regeneration} [[@{form2_regenerationhp}]] {{type=Lebenspunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration MP</h3>
                            <input type="text" name="attr_form2_regenerationmp" value="0" />
                            <button type='roll' name='roll_form2_regenerationmp' value='&{template:regeneration} [[@{form2_regenerationmp}]] {{type=Magiepunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Rüstungsschutz</h3>
                            <input type="number" name="attr_form2_armor" value="0" />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute character-armorreduction-container">
                            <h3 class="input-label-left">Rüstungsabzüge</h3>
                            <input type="hidden" name="attr_armorreduction_form2_autocalc" value="1" />
                            <input type="number" name="attr_form2_armorreduction" value="0" min="0" />
                            <input type="number" name="attr_form2_armorreduction_manual" value="0" min="0" />
                            <label>In Berechnungen berücksichtigen</label>
                            <label><input type="checkbox" name="attr_armorreduction_form2_autocalc" value="1" checked /></label>
                        </div>
                    </div>
                </div>
                <div class="powers-container">
                    <div class="powers-headers">
                        <h3>Kräfte</h3>
                        <fieldset class="repeating_form2powers">
                            <div class="characterpower-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_togglecharacterpowerdetail"></button>
                                <input class="powers" type="text" name="attr_characterpower" />
                                <div class="characterpower-detail">
                                    <textarea name="attr_characterpowerdetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="race-skills-container">
                    <div class="race-skills-headers">
                        <h3>Völkerspezifische Fertigkeiten</h3>
                        <fieldset class="repeating_form2raceskills">
                            <div class="characterraceskill-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_toggleraceskillsdetail"></button>
                                <input class="race" type="text" name="attr_raceskill" />
                                <div class="characterraceskill-detail">
                                    <textarea name="attr_characterraceskilldetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="character-container-right">
                <div class="character-status">
                    <div class="character-base-info-container">
                        <div>
                            <h3>Name</h3>
                            <input class="base-info-character-name" type="text" name="attr_form2_name" />
                        </div>
                        <div>
                            <h3>Sphäre</h3>
                            <input class="base-info-character-sphere" type="text" name="attr_form2_sphere" />
                        </div>
                        <div>
                            <h3>Volk</h3>
                            <input class="base-info-character-race" type="text" name="attr_form2_race" />
                        </div>
                        <div>
                            <h3>Profession</h3>
                            <input class="base-info-character-profession" type="text" name="attr_form2_profession" />
                        </div>
                    </div>
                    <div class="character-health-container">
                        <h3 class="status-header">Lebenspunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form2_max_hp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form2_temp_hp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form2_total_hp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form2_curr_hp" value="0" />
                        <div></div>
                    </div>
                    <div class="character-magic-container">
                        <h3 class="status-header">Magiepunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form2_max_mp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form2_temp_mp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form2_total_mp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form2_curr_mp" value="0" />
                        <div></div>
                    </div>
                </div>
                <div class="all-skills-container">
                    <input type='hidden' class='skilltoggle' name='attr_form2skilltab'  value='form2normalskills'  />
                    <div class="navi all-skills-navi">
                        <button type="action" name="act_form2normalskills" >Fertigkeiten</button>
                        <button type="action" name="act_form2weaponskills" >Waffen</button>
                        <button type="action" name="act_form2magicskills" >Magie</button>
                        <div></div>
                    </div>
                    <div class="normal-skills-container">
                        <div class="normal-skills-headers">
                            <div></div>
                            <h3>Normale Fertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="normal-skills-table-container">
                            <fieldset class="repeating_form2normalskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="normal-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addnormalskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <select class="normal-skill normal-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_skillmod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="normal-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_skilltotal' value='&{template:skill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="normal-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_divskilltotal' value='&{template:skill} [[ [[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="weapon-skills-container">
                        <div class="weapon-skills-headers">
                            <div></div>
                            <h3>Waffenfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Attacke</h3>
                            <h3>Parade</h3>
                            <h3>+ / -</h3>
                            <h3>Schaden</h3>
                        </div>
                        <fieldset class="repeating_form2weaponskills">
                            <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                            <input name="attr_armorreduction" type="hidden" value="0" >
                            <div class="weapon-skill-container">
                                <button class="adddiversification-button" type="action" name="act_addweaponskilldiversification" title="Neue Ausprägung">+</button>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <select class="weapon-skill weapon-skill-attribute" name="attr_attribute">
                                    <option selected value="none">-</option>
                                    <option value="strength">Stärke</option>
                                    <option value="constitution">Konstitution</option>
                                    <option value="dexterity">Geschicklichkeit</option>
                                    <option value="charisma">Charisma</option>
                                    <option value="intelligence">Intelligenz</option>
                                    <option value="mentalstrength">Geistige Kraft</option>
                                </select>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[[[1d20]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[[[1d20]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" readonly />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                            <div class="weapon-skill-diversification-container">
                                <div class="skill-sublist-item-arrow"></div>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <div class="mastery-container">
                                    <input name="attr_attackmastery" type="hidden" value="0" />
                                    <input name="attr_parademastery" type="hidden" value="0" />
                                    <select class="weapon-mastery" name="attr_mastery">
                                        <option selected value="none">Kein Meister</option>
                                        <option value="attackmastery">Meister Attacke</option>
                                        <option value="parademastery">Meister Parade</option>
                                    </select>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[ [[[[1 + @{attackmastery}]]d20kh1]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[ [[[[1 + @{parademastery}]]d20kh1]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="magic-skills-container">
                        <div class="magic-skills-headers">
                            <div></div>
                            <h3>Zauberfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="magic-skills-table-container">
                            <fieldset class="repeating_form2magicskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="magic-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addmagicskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <select class="magic-skill magic-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_magicskillmod' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="magic-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="magic-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="space-taker"></div>
            </div>
        </div>
    </div>
    <div class="additionalform3tab">
        <div class="character-container">
            <div class="character-container-left">
                <div class="character-attributes-container">
                    <div class="character-attributes-headers">
                        <h3 class="character-attributes-header">Eigenschaften</h3>
                        <h3 class="character-attributes-header">Wert</h3>
                        <h3 class="character-attributes-header">+ / -</h3>
                    </div>
                    <div class="character-base-attributes">
                        <div class="character-base-attribute character-strength-container">
                            <h3 class="input-label-left">Stärke</h3>
                            <input type="number" name="attr_form3_strength_base" value="0" />
                            <button type='roll' name='roll_form3_strength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_strength_base}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Stärke}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form3r_strength_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_strength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_strength_mod}]][Stärke] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Stärke}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-constitution-container">
                            <h3 class="input-label-left">Konstitution</h3>
                            <input type="number" name="attr_form3_constitution_base" value="0" />
                            <button type='roll' name='roll_form3_constitution_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_constitution_base}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Konstitution}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                            <input type="number" name="attr_form3_constitution_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_constitution_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_constitution_mod}]][Konstitution] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Konstitution}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-dexterity-container">
                            <h3 class="input-label-left">Geschicklichkeit</h3>
                            <input type="number" name="attr_form3_dexterity_base" value="0" />
                            <button type='roll' name='roll_form3_dexterity_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_dexterity_base}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod] + [[-@{form3_armorreduction}]][Rüstungsabzug]]] {{type=Attribut Grundwert}} {{skillname=Geschicklichkeit}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>

                            <input type="number" name="attr_form3_dexterity_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_dexterity_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_dexterity_mod}]][Geschicklichkeit] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geschicklichkeit}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-charisma-container">
                            <h3 class="input-label-left">Charisma</h3>
                            <input type="number" name="attr_form3_charisma_base" value="0" />
                            <button type='roll' name='roll_form3_charisma_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_charisma_base}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Charisma}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form3_charisma_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_charisma_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_charisma_mod}]][Charisma] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Charisma}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                        </div>
                        <div class="character-base-attribute character-intelligence-container">
                            <h3 class="input-label-left">Intelligenz</h3>
                            <input type="number" name="attr_form3_intelligence_base" value="0" />
                            <button type='roll' name='roll_form3_intelligence_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_intelligence_base}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Intelligenz}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form3_intelligence_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_intelligence_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_intelligence_mod}]][Intelligenz] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Intelligenz}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-base-attribute character-mentalstrength-container">
                            <h3 class="input-label-left">Geistige Kraft</h3>
                            <input type="number" name="attr_form3_mentalstrength_base" value="0" />
                            <button type='roll' name='roll_form3_mentalstrength_base' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_mentalstrength_base}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Grundwert}} {{skillname=Geistige Kraft}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>

                            <input type="number" name="attr_form3_mentalstrength_mod" value="0" readonly />
                            <button type='roll' name='roll_form3_mentalstrength_mod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_mentalstrength_mod}]][Geistige Kraft] + [[?{Modifier|0}]][Mod]]] {{type=Attribut Bonus}} {{skillname=Geistige Kraft}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                    </div>
                    <div class="character-additional-attributes">
                        <div class="character-base-attribute">
                            <h3 class="input-label-left">Initiative (K / G)</h3>
                            <input type="number" name="attr_form3_initiative_body" value="0" readonly />
                            <button type='roll' name='roll_form3_initiative_body' value='&{template:initiative} [[ [[[[@{form3_initiative_body}]][Körperliche Initiative] - [[1d6]][Rot]]] [[[[@{form3_initiative_body}]][Körperliche Initiative] + [[1d6]][Blau]]] ]] {{type=Körperliche}} {{user=@{form3_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                            <input type="number" name="attr_form3_initiative_mind" value="0" readonly />
                            <button type='roll' name='roll_form3_initiative_mind' value='&{template:initiative} [[ [[[[@{form3_initiative_mind}]][Geistige Initiative] - [[1d6]][Rot]]] [[[[@{form3_initiative_mind}]][Geistige Initiative] + [[1d6]][Blau]]] ]] {{type=Geistige}} {{user=@{form3_name}}} {{initiative=$[[0]]}} {{red=$[[1]]}} {{blue=$[[4]]}} {{redresult=$[[2]]}} {{blueresult=$[[5]]}}'></button>
                        </div>
                        <div class="character-additional-attribute critical-hit-container">
                            <h3 class="input-label-left">Kritischer Treffer</h3>
                            <input type="number" name="attr_form3_criticalhit" value="0" readonly />
                            <input type="hidden" name="attr_optionalRuleCriticalHit" value="0">
                            <button type="action" class="rollbutton" name="act_form3criticalhit"></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Tod</h3>
                            <input type="number" name="attr_form3_death" value="0" readonly />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute dodge-container" >
                            <h3 class="input-label-left">Ausweichen</h3>
                            <input type="number" name="attr_form3_dodge" value="0" readonly />
                            <button type='roll' name='roll_form3_dodge' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_dodge}]][Ausweichen] + [[?{Modifier|0}]][Mod]]] {{skillname=Ausweichen}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute magicresistance-container">
                            <h3 class="input-label-left">Zauberresistenz</h3>
                            <input type="number" name="attr_form3_magicresistance" value="0" readonly />
                            <button type='roll' name='roll_form3_magicresistance' value='&{template:skill} [[[[1d20]][Würfel] + [[@{form3_magicresistance}]][Zauberresistenz] + [[?{Modifier|0}]][Mod]]] {{skillname=Zauberresistenz}} {{user=@{form3_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{result=$[[3]]}}'></button>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Körperentwicklung</h3>
                            <input type="hidden" name="attr_bodydevelopment_form3autocalculation" value="1" />
                            <input type="hidden" name="attr_bodydevelopment_form3normalskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form3weaponskills" value="0" />
                            <input type="hidden" name="attr_bodydevelopment_form3magicskills" value="0" />
                            <input type="number" name="attr_bodydevelopment_form3" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_bodydevelopment_form3autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute body-mind-development-container">
                            <h3 class="input-label-left">Geistentwicklung</h3>
                            <input type="hidden" name="attr_minddevelopment_form3autocalculation" value="1" />
                            <input type="hidden" name="attr_minddevelopment_form3normalskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form3weaponskills" value="0" />
                            <input type="hidden" name="attr_minddevelopment_form3magicskills" value="0" />
                            <input type="number" name="attr_minddevelopment_form3" value="0" />
                            <label>Automatisch Berechnen</label>
                            <label><input type="checkbox" name="attr_minddevelopment_form3autocalculation" value="1" checked /></label>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration LP</h3>
                            <input type="text" name="attr_form3_regenerationhp" value="0" />
                            <button type='roll' name='roll_form3_regenerationhp' value='&{template:regeneration} [[@{form3_regenerationhp}]] {{type=Lebenspunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Regeneration MP</h3>
                            <input type="text" name="attr_form3_regenerationmp" value="0" />
                            <button type='roll' name='roll_form3_regenerationmp' value='&{template:regeneration} [[@{form3_regenerationmp}]] {{type=Magiepunkte Regeneration}} {{result=$[[0]]}}'></button>
                        </div>
                        <div class="character-additional-attribute">
                            <h3 class="input-label-left">Rüstungsschutz</h3>
                            <input type="number" name="attr_form3_armor" value="0" />
                            <div></div>
                        </div>
                        <div class="character-additional-attribute character-armorreduction-container">
                            <h3 class="input-label-left">Rüstungsabzüge</h3>
                            <input type="hidden" name="attr_armorreduction_form3_autocalc" value="1" />
                            <input type="number" name="attr_form3_armorreduction" value="0" min="0" />
                            <input type="number" name="attr_form3_armorreduction_manual" value="0" min="0" />
                            <label>In Berechnungen berücksichtigen</label>
                            <label><input type="checkbox" name="attr_armorreduction_form3_autocalc" value="1" checked /></label>
                        </div>
                    </div>
                </div>
                <div class="powers-container">
                    <div class="powers-headers">
                        <h3>Kräfte</h3>
                        <fieldset class="repeating_form3powers">
                            <div class="characterpower-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_togglecharacterpowerdetail"></button>
                                <input class="powers" type="text" name="attr_characterpower" />
                                <div class="characterpower-detail">
                                    <textarea name="attr_characterpowerdetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
                <div class="race-skills-container">
                    <div class="race-skills-headers">
                        <h3>Völkerspezifische Fertigkeiten</h3>
                        <fieldset class="repeating_form3raceskills">
                            <div class="characterraceskill-container">
                                <input class="detailtoggle" name="attr_detailtoggle" value="0" type="hidden" />
                                <button class="togglebutton" type="action" name="act_toggleraceskillsdetail"></button>
                                <input class="race" type="text" name="attr_raceskill" />
                                <div class="characterraceskill-detail">
                                    <textarea name="attr_characterraceskilldetail"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
            <div class="character-container-right">
                <div class="character-status">
                    <div class="character-base-info-container">
                        <div>
                            <h3>Name</h3>
                            <input class="base-info-character-name" type="text" name="attr_form3_name" />
                        </div>
                        <div>
                            <h3>Sphäre</h3>
                            <input class="base-info-character-sphere" type="text" name="attr_form3_sphere" />
                        </div>
                        <div>
                            <h3>Volk</h3>
                            <input class="base-info-character-race" type="text" name="attr_form3_race" />
                        </div>
                        <div>
                            <h3>Profession</h3>
                            <input class="base-info-character-profession" type="text" name="attr_form3_profession" />
                        </div>
                    </div>
                    <div class="character-health-container">
                        <h3 class="status-header">Lebenspunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form3_max_hp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form3_temp_hp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form3_total_hp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form3_curr_hp" value="0" />
                        <div></div>
                    </div>
                    <div class="character-magic-container">
                        <h3 class="status-header">Magiepunkte</h3>
                        <h3 class="input-label-left">Basis</h3>
                        <input type="number" name="attr_form3_max_mp" value="0" readonly />
                        <h3 class="input-label-left">Temporär</h3>
                        <input type="number" name="attr_form3_temp_mp" value="0" />
                        <h3 class="input-label-left">Gesamt</h3>
                        <input type="number" name="attr_form3_total_mp" value="0" readonly />
                        <h3 class="input-label-left">Aktuell</h3>
                        <input type="number" name="attr_form3_curr_mp" value="0" />
                        <div></div>
                    </div>
                </div>
                <div class="all-skills-container">
                    <input type='hidden' class='skilltoggle' name='attr_form3skilltab'  value='form3normalskills'  />
                    <div class="navi all-skills-navi">
                        <button type="action" name="act_form3normalskills" >Fertigkeiten</button>
                        <button type="action" name="act_form3weaponskills" >Waffen</button>
                        <button type="action" name="act_form3magicskills" >Magie</button>
                        <div></div>
                    </div>
                    <div class="normal-skills-container">
                        <div class="normal-skills-headers">
                            <div></div>
                            <h3>Normale Fertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="normal-skills-table-container">
                            <fieldset class="repeating_form3normalskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="normal-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addnormalskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <select class="normal-skill normal-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_skillmod' value='&{template:skill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="normal-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_skilltotal' value='&{template:skill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="normal-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="normal-skill normal-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="normal-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_divskilltotal' value='&{template:skill} [[ [[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{type=Fertigkeit}} {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                    <div class="weapon-skills-container">
                        <div class="weapon-skills-headers">
                            <div></div>
                            <h3>Waffenfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Attacke</h3>
                            <h3>Parade</h3>
                            <h3>+ / -</h3>
                            <h3>Schaden</h3>
                        </div>
                        <fieldset class="repeating_form3weaponskills">
                            <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                            <input name="attr_armorreduction" type="hidden" value="0" >
                            <div class="weapon-skill-container">
                                <button class="adddiversification-button" type="action" name="act_addweaponskilldiversification" title="Neue Ausprägung">+</button>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <select class="weapon-skill weapon-skill-attribute" name="attr_attribute">
                                    <option selected value="none">-</option>
                                    <option value="strength">Stärke</option>
                                    <option value="constitution">Konstitution</option>
                                    <option value="dexterity">Geschicklichkeit</option>
                                    <option value="charisma">Charisma</option>
                                    <option value="intelligence">Intelligenz</option>
                                    <option value="mentalstrength">Geistige Kraft</option>
                                </select>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[[[1d20]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[[[1d20]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" readonly />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                            <div class="weapon-skill-diversification-container">
                                <div class="skill-sublist-item-arrow"></div>
                                <input class="weapon-skill weapon-skill-name" type="text" name="attr_skillname" />
                                <div class="mastery-container">
                                    <input name="attr_attackmastery" type="hidden" value="0" />
                                    <input name="attr_parademastery" type="hidden" value="0" />
                                    <select class="weapon-mastery" name="attr_mastery">
                                        <option selected value="none">Kein Meister</option>
                                        <option value="attackmastery">Meister Attacke</option>
                                        <option value="parademastery">Meister Parade</option>
                                    </select>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_attack" value="0" />
                                    <button type='roll' name='roll_attack' value='&{template:attack} [[ [[[[1 + @{attackmastery}]]d20kh1]][Würfel] + [[?{Angriff|@{attack}}]][Angriff] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <div>
                                    <input class="weapon-skill" type="number" name="attr_parry" value="0" />
                                    <button type='roll' name='roll_parry' value='&{template:parry} [[ [[[[1 + @{parademastery}]]d20kh1]][Würfel] + [[?{Parade|@{parry}}]][Parade] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                </div>
                                <input class="weapon-skill" type="number" name="attr_mod" value="0" />
                                <div>
                                    <input class="weapon-skill weapon-skill-damage" type="text" name="attr_weapondamage" value="0" />
                                    <button type='roll' name='roll_weapondamage' value='&{template:damage} [[[[@{weapondamage}]][Schaden] + [[@{mod}]][Attr. Mod] + [[?{Zusatzschaden|0d6}]][Zusatzschaden]]] {{skillname=@{skillname}}} {{damage=$[[0]]}} {{mod=$[[1]]}} {{additional=$[[2]]}} {{result=$[[3]]}}'></button>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="magic-skills-container">
                        <div class="magic-skills-headers">
                            <div></div>
                            <h3>Zauberfertigkeiten</h3>
                            <h3>Abh.</h3>
                            <h3>Wert</h3>
                            <h3>+ / -</h3>
                            <h3>Gesamt</h3>
                            <div></div>
                        </div>
                        <div class="magic-skills-table-container">
                            <fieldset class="repeating_form3magicskills">
                                <input class="diversification-toggle" name="attr_diversification" type="hidden" value="0" />
                                <input name="attr_armorreduction" type="hidden" value="0" >
                                <div class="magic-skill-container">
                                    <button class="adddiversification-button" type="action" name="act_addmagicskilldiversification" title="Neue Ausprägung">+</button>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <select class="magic-skill magic-skill-attribute" name="attr_attribute">
                                        <option selected value="none">-</option>
                                        <option value="strength">Stärke</option>
                                        <option value="constitution">Konstitution</option>
                                        <option value="dexterity">Geschicklichkeit</option>
                                        <option value="charisma">Charisma</option>
                                        <option value="intelligence">Intelligenz</option>
                                        <option value="mentalstrength">Geistige Kraft</option>
                                    </select>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_skillvalue" value="0" />
                                        <button type='roll' name='roll_magicskillmod' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{skillvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                    <input class="magic-skill" type="number" name="attr_mod" value="0" readonly />
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_totalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[1d20]][Würfel] + [[@{totalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod]  + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} {{armorreduction=$[[3]]}} {{result=$[[4]]}}'></button>
                                    </div>
                                </div>
                                <div class="magic-skill-diversification-container">
                                    <div class="skill-sublist-item-arrow"></div>
                                    <input class="magic-skill magic-skill-name" type="text" name="attr_skillname" />
                                    <div class="mastery-container">
                                        <input name="attr_mastery" type="checkbox" value="1" />
                                        <label>Meister</label>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationskillvalue" value="0" />
                                    </div>
                                    <div>
                                    </div>
                                    <div>
                                        <input class="magic-skill" type="number" name="attr_diversificationtotalvalue" value="0" readonly />
                                        <button type='roll' name='roll_magicskilltotal' value='&{template:magicskill} [[[[[[1 + @{mastery}]]d20kh1]][Würfel] + [[@{diversificationtotalvalue}]][Fertigkeit] + [[?{Modifier|0}]][Mod] + [[-@{armorreduction}]][Rüstungsabzüge] ]] {{skillname=@{skillname}}} {{user=@{character_name}}} {{roll=$[[1]]}} {{skill=$[[2]]}}{{mod=$[[3]]}} {{armorreduction=$[[4]]}} {{result=$[[5]]}}'></button>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="space-taker"></div>
            </div>
        </div>
    </div>
    <div class="settingstab">
        <div class="settings-container">
            <h2>Einstellungen</h2>
            <div class="additional-form-pages-container">
                <h3>Wandelformen</h3>
                <input type="checkbox" name="attr_additionalform1" value="1" >Zeige Wandelform 1</input><br/>
                <input type="checkbox" name="attr_additionalform2" value="1" >Zeige Wandelform 2</input><br/>
                <input type="checkbox" name="attr_additionalform3" value="1" >Zeige Wandelform 3</input><br/>
                <input type="checkbox" name="attr_optionalRuleCriticalHit" value="1" >Kritischer Treffer Optionale Regel: Erhöhter LP Verlust berücksichtigen</input><br/>
            </div>
        </div>
    </div>
</div>

<rolltemplate class="sheet-rolltemplate-skill">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>
                {{#type}}
                {{type}} -
                {{/type}}
                {{skillname}}
            </h3>
            <label>von</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Gewürfelt</h3>{{roll}}<span></span>
            <span></span><h3>Fertigkeit</h3>{{skill}}<span></span>
            <span></span><h3>Modifikator</h3>{{mod}}<span></span>
            {{#rollLess() armorreduction 0}}
            <span></span><h3>Rüstungsabzüge</h3>{{armorreduction}}<span></span>
            {{/rollLess() armorreduction 0}}
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-magicskill">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>{{skillname}}</h3>
            <label>von</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Gewürfelt</h3>{{roll}}<span></span>
            <span></span><h3>Fertigkeit</h3>{{skill}}<span></span>
            <span></span><h3>Modifikator</h3>{{mod}}<span></span>
            {{#rollLess() armorreduction 0}}
            <span></span><h3>Rüstungsabzüge</h3>{{armorreduction}}<span></span>
            {{/rollLess() armorreduction 0}}
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-attack">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>Angriff - {{skillname}}</h3>
            <label>von</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Gewürfelt</h3>{{roll}}<span></span>
            <span></span><h3>Angriff</h3>{{skill}}<span></span>
            <span></span><h3>Modifikator</h3>{{mod}}<span></span>
            {{#rollLess() armorreduction 0}}
            <span></span><h3>Rüstungsabzüge</h3>{{armorreduction}}<span></span>
            {{/rollLess() armorreduction 0}}
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-parry">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>Parade - {{skillname}}</h3>
            <label>von</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Gewürfelt</h3>{{roll}}<span></span>
            <span></span><h3>Parade</h3>{{skill}}<span></span>
            <span></span><h3>Modifikator</h3>{{mod}}<span></span>
            {{#rollLess() armorreduction 0}}
            <span></span><h3>Rüstungsabzüge</h3>{{armorreduction}}<span></span>
            {{/rollLess() armorreduction 0}}
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-damage">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>Schaden</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Schaden</h3>{{damage}}<span></span>
            <span></span><h3>Attribut Mod.</h3>{{mod}}<span></span>
            <span></span><h3>Zusatzschaden</h3>{{additional}}<span></span>
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-regeneration">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>{{type}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-initiative">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>{{type}} Initiative</h3>
            <label>von</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Initiative</h3>{{initiative}}<span></span>
            <span></span><h3>Roter Würfel</h3>{{red}}<span></span>
            <span></span><h3>Blauer Würfel</h3>{{blue}}<span></span>
            {{#rollGreater() red blue}}
                <span></span><h3>Ergebnis</h3>{{redresult}}<span></span>
            {{/rollGreater() red blue}}
            {{#rollGreater() blue red}}
                <span></span><h3>Ergebnis</h3>{{blueresult}}<span></span>
            {{/rollGreater() blue red}}
            {{#rollTotal() blue red}}
                <span></span><h3>Ergebnis</h3>{{initiative}}<span></span>
            {{/rollTotal() blue red}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-criticalhit">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <h3>Kritischer Treffer</h3>
            <label>gegen</label>
            <h3>{{user}}</h3>
        </div>
        <div class="sheet-template-body">
            <span></span><h3>Gewürfelt</h3>{{roll}}<span></span>
            <span></span><h3>Modifikator</h3>{{mod}}<span></span>
            <span></span><h3>Kritischer Treffer</h3>{{skill}}<span></span>
            {{#computed::lploss}}
            <span></span><h3>LP Verlust Abzug</h3>{{computed::lploss}}<span></span>
            {{/computed::lploss}}
            {{#result}}
            <span></span><h3>Ergebnis</h3>{{result}}<span></span>
            {{/result}}
            {{#rollGreater() result 19}}
            <span></span><h3>Erfolg</h3><span></span>
            {{/rollGreater() result 19}}
            {{#rollLess() result 20}}
            <span></span><h3>Fehlschlag</h3><span></span>
            {{/rollLess() result 20}}
            {{#computed::calcresult}}
            <span></span><h3>Ergebnis</h3>{{computed::calcresult}}<span></span>
            {{/computed::calcresult}}
            {{#rollGreater() computed::calcresult 19}}
            <span></span><h3 class="rolltemplate-criticalhit-result rollsuccess">Erfolg</h3><span></span>
            {{/rollGreater() computed::calcresult 19}}
            {{#rollLess() computed::calcresult 20}}
            <span></span><h3 class="rolltemplate-criticalhit-result rollfail">Fehlschlag</h3><span></span>
            {{/rollLess() computed::calcresult 20}}
        </div>
    </div>
</rolltemplate>

<script type="text/worker">

    // character sheet tab control
    const mainnavibuttonlist = ["charactertab", "descriptionequipmenttab", "settingstab", "additionalform1tab", "additionalform2tab", "additionalform3tab"];
    mainnavibuttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

    // skill tab control
    const characterSkillnavibuttonlist = ["characternormalskills", "characterweaponskills", "charactermagicskills"];
    characterSkillnavibuttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                characterskilltab: button
            });
        });
    });

    const form1Skillnavibuttonlist = ["form1normalskills", "form1weaponskills", "form1magicskills"];
    form1Skillnavibuttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                form1skilltab: button
            });
        });
    });

    const form2Skillnavibuttonlist = ["form2normalskills", "form2weaponskills", "form2magicskills"];
    form2Skillnavibuttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                form2skilltab: button
            });
        });
    });

    const form3Skillnavibuttonlist = ["form3normalskills", "form3weaponskills", "form3magicskills"];
    form3Skillnavibuttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                form3skilltab: button
            });
        });
    });

    let characterAttributeModList = ["character_strength_mod", "character_constitution_mod", "character_dexterity_mod", "character_charisma_mod", "character_intelligence_mod", "character_mentalstrength_mod"];
    let form1AttributeModList = ["form1_strength_mod", "form1_constitution_mod", "form1_dexterity_mod", "form1_charisma_mod", "form1_intelligence_mod", "form1_mentalstrength_mod"];
    let form2AttributeModList = ["form2_strength_mod", "form2_constitution_mod", "form2_dexterity_mod", "form2_charisma_mod", "form2_intelligence_mod", "form2_mentalstrength_mod"];
    let form3AttributeModList = ["form3_strength_mod", "form3_constitution_mod", "form3_dexterity_mod", "form3_charisma_mod", "form3_intelligence_mod", "form3_mentalstrength_mod"];
    let attributeModLists = {
        "character": characterAttributeModList,
        "form1": form1AttributeModList,
        "form2": form2AttributeModList,
        "form3": form3AttributeModList
    };
    let formsList = ["character", "form1", "form2", "form3"];

    function parseIntValue(attr) {
        return parseInt(attr)||0;
    }

    function calcAttributeModFromBase(baseValue) {
        return Math.floor((baseValue - 9) / 2);
    }

    function calcRegenerationHp(maxLp) {
        if (maxLp < 11) {
            return "1d6";
        }
        if (maxLp < 21) {
            return "1d6+1";
        }
        if (maxLp < 31) {
            return "1d6+2";
        }
        if (maxLp < 41) {
            return "2d6";
        }
        if (maxLp < 51) {
            return "2d6+1";
        }
        if (maxLp < 61) {
            return "2d6+2";
        }
        return "3d6";
    }

    function calcRegenerationLp(maxMp) {
        let diceNumber = Math.floor((maxMp - 1) / 10) + 1;
        return diceNumber.toString() + "d6+6";
    }

    /*
        Property change path
                                                         repeating_*_skillvalue \      repeating_*_diversificationskillvalue \
        character_*_base -> character_*_mod -v                                v                                            v
                                             repeating_*_mod -> repeating_*_totalvalue -> repeating_*_diversificationtotalvalue
                      repeating_*_attribute -^

    */


    function getOnBaseAttributeChangeCallback(user) {
        return function() {
            getAttrs([`${user}_strength_base`, `${user}_constitution_base`, `${user}_dexterity_base`, `${user}_charisma_base`, `${user}_intelligence_base`, `${user}_mentalstrength_base`,
                  `bodydevelopment_${user}`, `minddevelopment_${user}`, `${user}_armorreduction`], function(values) {

                let strengthBase = parseIntValue(values[`${user}_strength_base`]);
                let constitutionBase = parseIntValue(values[`${user}_constitution_base`]);
                let dexterityBase = parseIntValue(values[`${user}_dexterity_base`]);
                let charismaBase = parseIntValue(values[`${user}_charisma_base`]);
                let intelligenceBase = parseIntValue(values[`${user}_intelligence_base`]);
                let mentalstrengthBase = parseIntValue(values[`${user}_mentalstrength_base`]);
                let armorreduction = parseIntValue(values[`${user}_armorreduction`]);

                let strength_mod = calcAttributeModFromBase(strengthBase);
                let constitution_mod = calcAttributeModFromBase(constitutionBase);
                let dexterity_mod = calcAttributeModFromBase(dexterityBase);
                let charisma_mod = calcAttributeModFromBase(charismaBase);
                let intelligence_mod = calcAttributeModFromBase(intelligenceBase);
                let mentalstrength_mod = calcAttributeModFromBase(mentalstrengthBase);

                let max_hp = strengthBase + constitutionBase + parseIntValue(values[`bodydevelopment_${user}`]);
                let max_mp = mentalstrengthBase + parseIntValue(values[`minddevelopment_${user}`]);

                let attrsToSet = {};
                attrsToSet[`${user}_strength_mod`] = strength_mod;
                attrsToSet[`${user}_constitution_mod`] = constitution_mod;
                attrsToSet[`${user}_dexterity_mod`] = dexterity_mod;
                attrsToSet[`${user}_charisma_mod`] = charisma_mod;
                attrsToSet[`${user}_intelligence_mod`] = intelligence_mod;
                attrsToSet[`${user}_mentalstrength_mod`] = mentalstrength_mod;
                attrsToSet[`${user}_initiative_body`] = dexterityBase - armorreduction;
                attrsToSet[`${user}_initiative_mind`] = mentalstrengthBase;
                attrsToSet[`${user}_criticalhit`] = constitutionBase;
                attrsToSet[`${user}_death`] = -Math.floor(constitutionBase / 3);
                attrsToSet[`${user}_dodge`] = Math.floor(dexterityBase / 3) - armorreduction;
                attrsToSet[`${user}_magicresistance`] = mentalstrengthBase;
                attrsToSet[`${user}_regenerationhp`] = calcRegenerationHp(max_hp);
                attrsToSet[`${user}_regenerationmp`] = calcRegenerationLp(max_mp);
                attrsToSet[`${user}_max_hp`] = max_hp;
                attrsToSet[`${user}_max_mp`] = max_mp;

                setAttrs(attrsToSet);
            });
        };
    }

    // on base attribute change
    on("sheet:opened change:character_strength_base change:character_constitution_base change:character_dexterity_base change:character_charisma_base change:character_intelligence_base change:character_mentalstrength_base",
        getOnBaseAttributeChangeCallback("character")
    );
    on("sheet:opened change:form1_strength_base change:form1_constitution_base change:form1_dexterity_base change:form1_charisma_base change:form1_intelligence_base change:form1_mentalstrength_base",
        getOnBaseAttributeChangeCallback("form1")
    );
    on("sheet:opened change:form2_strength_base change:form2_constitution_base change:form2_dexterity_base change:form2_charisma_base change:form2_intelligence_base change:form2_mentalstrength_base",
        getOnBaseAttributeChangeCallback("form2")
    );
    on("sheet:opened change:form3_strength_base change:form3_constitution_base change:form3_dexterity_base change:form3_charisma_base change:form3_intelligence_base change:form3_mentalstrength_base",
        getOnBaseAttributeChangeCallback("form3")
    );

    function getModChangeSkillCallback(repeatingName, user) {
        return function(idarray) {
            let repeatingAttrs = [];
            for(var i=0; i < idarray.length; i++) {
                let id = idarray[i];
                repeatingAttrs.push("repeating_" + repeatingName + "_" + id + "_attribute");
            }

            let attributeModList = attributeModLists[user];
            getAttrs(repeatingAttrs.concat(attributeModList), function(values) {
                let attrsToSet = {};
                //debugger;
                for(var i=0; i < idarray.length; i++) {
                    let id = idarray[i];
                    let attrName = values["repeating_" + repeatingName + "_" + id + "_attribute"];

                    if (attrName === "none") {
                        continue;
                    }

                    let newModValue = parseIntValue(values[`${user}_${attrName}_mod`]);

                    attrsToSet["repeating_" + repeatingName + "_" + id + "_mod"] = newModValue;
                }
                setAttrs(attrsToSet);
            });
        }
    }

    // on attribute mod change
    formsList.forEach(form => {
        let attributeModList = attributeModLists[form];

        attributeModList.forEach(attrMod => {
            on(`change:${attrMod}`, function() {
                getSectionIDs(`${form}normalskills`, getModChangeSkillCallback(`${form}normalskills`, form));
                getSectionIDs(`${form}weaponskills`, getModChangeSkillCallback(`${form}weaponskills`, form));
                getSectionIDs(`${form}magicskills`, getModChangeSkillCallback(`${form}magicskills`, form));
            });
        });
    });

    function getOnBodyDevelopmentUpdateCallback(user) {
        return function() {
            getAttrs([`bodydevelopment_${user}normalskills`, `bodydevelopment_${user}weaponskills`, `bodydevelopment_${user}magicskills`, `bodydevelopment_${user}autocalculation`], function(values) {
                if(values[`bodydevelopment_${user}autocalculation`] === "0") {
                    return;
                }

                let normalSkills = parseIntValue(values[`bodydevelopment_${user}normalskills`]);
                let weaponSkills = parseIntValue(values[`bodydevelopment_${user}weaponskills`]);
                let magicSkills = parseIntValue(values[`bodydevelopment_${user}magicskills`]);

                let totalBodyDevelopment = normalSkills + weaponSkills + magicSkills;
                let attrsToSet = {};
                attrsToSet[`bodydevelopment_${user}`] = totalBodyDevelopment;
                setAttrs(attrsToSet);
            });
        };
    }

    // on bodydevelopment update
    formsList.forEach(form => {
        on(`change:bodydevelopment_${form}normalskills change:bodydevelopment_${form}weaponskills change:bodydevelopment_${form}magicskills`, getOnBodyDevelopmentUpdateCallback(form));
    });

    function getOnBodyDevelopmentUpdate2Callback(user) {
        return function() {
            getAttrs([`bodydevelopment_${user}`, `${user}_strength_base`, `${user}_constitution_base`], values  => {
                let strengthBase = parseIntValue(values[`${user}_strength_base`]);
                let constitutionBase = parseIntValue(values[`${user}_constitution_base`]);
                let totalBodyDevelopment = parseIntValue(values[`bodydevelopment_${user}`]);
                let attrsToSet = {};
                attrsToSet[`${user}_max_hp`] = strengthBase + constitutionBase + totalBodyDevelopment;
                setAttrs(attrsToSet);
            });
        };
    };

    formsList.forEach(form => {
        on(`change:bodydevelopment_${form}`, getOnBodyDevelopmentUpdate2Callback(form));
    });

    function getOnMindDevelopmentUpdateCallback(user) {
        return function() {
            getAttrs([`minddevelopment_${user}normalskills`, `minddevelopment_${user}weaponskills`, `minddevelopment_${user}magicskills`, `minddevelopment_${user}autocalculation`], function(values) {

                if(values[`minddevelopment_${user}autocalculation`] === "0") {
                    return;
                }

                let normalSkills = parseIntValue(values[`minddevelopment_${user}normalskills`]);
                let weaponSkills = parseIntValue(values[`minddevelopment_${user}weaponskills`]);
                let magicSkills = parseIntValue(values[`minddevelopment_${user}magicskills`]);

                let attrsToSet = {};
                attrsToSet[`minddevelopment_${user}`] =  normalSkills + weaponSkills + magicSkills;
                setAttrs(attrsToSet);
            });
        };
    }

    // on minddevelopment update
    formsList.forEach(form => {
        on(`change:minddevelopment_${form}normalskills change:minddevelopment_${form}weaponskills change:minddevelopment_${form}magicskills`, getOnMindDevelopmentUpdateCallback(form));
    });

    function getOnMindDevelopmentUpdate2Callback(user) {
        return function() {
            getAttrs([`minddevelopment_${user}`, `${user}_mentalstrength_base`], values  => {
                let mentalstrengthBase = parseIntValue(values[`${user}_mentalstrength_base`]);
                let totalMindDevelopment = parseIntValue(values[`minddevelopment_${user}`]);

                let attrsToSet = {};
                attrsToSet[`${user}_max_mp`] = mentalstrengthBase + totalMindDevelopment;
                setAttrs(attrsToSet);
            });
        };
    }

    formsList.forEach(form => {
        on(`change:minddevelopment_${form}`, getOnMindDevelopmentUpdate2Callback(form));
    });

    function getOnMpHpChangeCallback(user) {
        return function() {
            getAttrs([`${user}_max_hp`, `${user}_temp_hp`, `${user}_max_mp`, `${user}_temp_mp`], function(values) {
                let newTotalHp = parseIntValue(values[`${user}_max_hp`]) + parseIntValue(values[`${user}_temp_hp`]);
                let newTotalMp = parseIntValue(values[`${user}_max_mp`]) + parseIntValue(values[`${user}_temp_mp`]);

                let attrsToSet = {};
                attrsToSet[`${user}_total_hp`] = newTotalHp;
                attrsToSet[`${user}_total_mp`] = newTotalMp;
                setAttrs(attrsToSet);
            });
        };
    }

    // on max hp/mp or temp hp/mp change
    formsList.forEach(form => {
        on(`change:${form}_max_hp change:${form}_max_mp change:${form}_temp_hp change:${form}_temp_mp`, getOnMpHpChangeCallback(form));
    });
    
    function isBodyDevelopmentAttribute(attrName) {
        return attrName === "strength" || attrName === "constitution";
    }

    function isMindDevelopmentAttribute(attrName) {
        return attrName === "mentalstrength";
    }

    function getAttributeChangeSkillCallback(repeatingName, user) {
        return function(eventInfo) {

            if (eventInfo.previousValue === undefined) {
                // skip re-calculation if this event was triggered by new row creation
                return;
            }

            const triggerRowId = eventInfo.sourceAttribute.split('_')[2].toLowerCase();
            const newAttributeValue = eventInfo.newValue;
            const oldAttributeValue = eventInfo.previousValue;
            let attributeModList = attributeModLists[user];

            getAttrs(attributeModList.concat([`${user}_armorreduction`]), function(values) {
                let attrsToSet = {};

                // update the mod value
                let value = values[`${user}_${newAttributeValue}_mod`];
                let attributeModValue = (newAttributeValue === "none") ? 0 : parseIntValue(value);
                attrsToSet["repeating_" + repeatingName + "_mod"] = attributeModValue;

                let newArmorreduction = (newAttributeValue === "dexterity") ? values[`${user}_armorreduction`] : 0;

                // update all diversification rows that belong to this row & re-calculate body/mind development of the section/repeating
                getSectionIDs(repeatingName, function(idarray) {

                    let triggerPos = idarray.indexOf(triggerRowId); // the index of the row that triggered this function

                    // create a list with all attributes we need for the updates
                    let repeatingAttrs = [];
                    for(var i=0; i < idarray.length; i++) {
                        let id = idarray[i];
                        if (i > triggerPos) { // we only need the values for the diversification rows (which follow directly after the triggering row)
                            repeatingAttrs.push("repeating_" + repeatingName + "_" + id + "_diversification");
                        }
                        repeatingAttrs.push("repeating_" + repeatingName + "_" + id + "_attribute");
                    }

                    let bodyDevelopmentCount = 0;
                    let mindDevelopmentCount = 0;

                    getAttrs(repeatingAttrs, function(values) {
                        let silentAttrsToSet = {};
                        let diversificationRowUpdateComplete = false; // flag to control that only "attribute" values of the diversification rows of the triggering row are updated

                        for(var i=0; i < idarray.length; i++) {
                            let id = idarray[i];

                            if (i > triggerPos && !diversificationRowUpdateComplete && values[`repeating_${repeatingName}_${id}_diversification`] === '0') {
                                // reached the next non-diversification row, all following rows may not be updated
                                diversificationRowUpdateComplete = true;
                            }

                            if (i > triggerPos && !diversificationRowUpdateComplete) {
                                silentAttrsToSet[`repeating_${repeatingName}_${id}_attribute`] = newAttributeValue;
                                silentAttrsToSet[`repeating_${repeatingName}_${id}_armorreduction`] = newArmorreduction;

                                if (isBodyDevelopmentAttribute(newAttributeValue)) {
                                    bodyDevelopmentCount++;
                                } else if (isMindDevelopmentAttribute(newAttributeValue)) {
                                    mindDevelopmentCount++;
                                }
                            } else {
                                let attributeValue = values[`repeating_${repeatingName}_${id}_attribute`];
                                if (isBodyDevelopmentAttribute(attributeValue)) {
                                    bodyDevelopmentCount++;
                                } else if (isMindDevelopmentAttribute(attributeValue)) {
                                    mindDevelopmentCount++;
                                }
                            }
                        }

                        if (Object.keys(silentAttrsToSet).length > 0) {
                            setAttrs(silentAttrsToSet, {silent:true}); // silent update = disable trigger for attribute update, so that it will not re-run this function
                        }

                        //console.log("Row attribute update, new bodydevelopmentcount " + bodyDevelopmentCount + ", new mindDevelopmentCount "+mindDevelopmentCount);
                        attrsToSet["bodydevelopment_" + repeatingName] = bodyDevelopmentCount;
                        attrsToSet["minddevelopment_" + repeatingName] = mindDevelopmentCount;

                        attrsToSet[`repeating_${repeatingName}_${triggerRowId}_armorreduction`] = newArmorreduction;
                        setAttrs(attrsToSet);
                    });
                });
            });
        };
    }

    formsList.forEach(form => {
        // on normal skill attribute change
        on(`change:repeating_${form}normalskills:attribute`, getAttributeChangeSkillCallback(`${form}normalskills`, form));

        // on weapon skill attribute change
        on(`change:repeating_${form}weaponskills:attribute`, getAttributeChangeSkillCallback(`${form}weaponskills`, form));

        // on magic skill attribute change
        on(`change:repeating_${form}magicskills:attribute`, getAttributeChangeSkillCallback(`${form}magicskills`, form));
    });

    function getSkillModChangeOrSkillvalueChange(user, skillType) {
        return function(eventInfo) {
            const triggerRowId = eventInfo.sourceAttribute.split('_')[2].toLowerCase();

            getSectionIDs(`repeating_${user}${skillType}skills`, idarray => {
                let triggerPos = idarray.indexOf(triggerRowId);
                idarray = idarray.slice(triggerPos + 1);
                let rowsToGet = [];
                idarray.forEach(id => {
                    rowsToGet.push(`repeating_${user}${skillType}skills_${id}_diversification`);
                });

                getAttrs([...rowsToGet, `repeating_${user}${skillType}skills_skillvalue`, `repeating_${user}${skillType}skills_mod`], function(values) {
                    // calculate the new totalValue of the row that triggered
                    let skillValue = parseIntValue(values[`repeating_${user}${skillType}skills_skillvalue`]);
                    let modValue = parseIntValue(values[`repeating_${user}${skillType}skills_mod`]);
                    let totalValue = (skillValue + modValue);

                    let attrsToSet = {};
                    attrsToSet[`repeating_${user}${skillType}skills_totalvalue`] = totalValue;

                    // find all diversification rows (subrows)
                    for (var i = 0; i < idarray.length; i++) {
                        let id = idarray[i];

                        if (values[`repeating_${user}${skillType}skills_${id}_diversification`] === '0') {
                            // next non-diversification row reached, stop here
                            break;
                        }
                        attrsToSet[`repeating_${user}${skillType}skills_${id}_totalvalue`] = totalValue;
                    }

                    setAttrs(attrsToSet);
                });
            });
        };
    }

    formsList.forEach(form => {
        // on normal skill mod change or normal skill skillvalue change
        on(`change:repeating_${form}normalskills:mod change:repeating_${form}normalskills:skillvalue`, getSkillModChangeOrSkillvalueChange(form, "normal"));

        // on magic skill mod change or magic skill skillvalue change
        on(`change:repeating_${form}magicskills:mod change:repeating_${form}magicskills:skillvalue`, getSkillModChangeOrSkillvalueChange(form, "magic"));
    });

    function getSkillTotalValueChangeCallback(user, skillType) {
        return function(eventInfo) {
            getAttrs([`repeating_${user}${skillType}skills_diversificationskillvalue`, `repeating_${user}${skillType}skills_totalvalue`], function(values) {
                let diversificationSkillValue = parseInt(values[`repeating_${user}${skillType}skills_diversificationskillvalue`]);
                let totalValue = parseInt(values[`repeating_${user}${skillType}skills_totalvalue`]);

                let attrsToSet = {};
                attrsToSet[`repeating_${user}${skillType}skills_diversificationtotalvalue`] = (diversificationSkillValue + totalValue);
                setAttrs(attrsToSet);
            });
        };
    }

    formsList.forEach(form => {
        // on normal skill totalvalue change, update diversificationtotalvalue
        on(`change:repeating_${form}normalskills:totalvalue change:repeating_${form}normalskills:diversificationskillvalue`, getSkillTotalValueChangeCallback(form, "normal"));

        // on magic skill totalvalue change, update diversificationtotalvalue
        on(`change:repeating_${form}magicskills:totalvalue change:repeating_${form}magicskills:diversificationskillvalue`, getSkillTotalValueChangeCallback(form, "magic"));
    });

    function generateUniqueRowIDs(numberOfIds) {
        let uniquevalues = {};
        while (Object.keys(uniquevalues).length < numberOfIds) {
            uniquevalues[generateRowID()] = true;
        }
        return Object.keys(uniquevalues);
    }

    function onPowersDetailToggleCallback(user) {
        return function(eventInfo) {
            getAttrs([`repeating_${user}powers_detailtoggle`], function(values) {
                let attrsToSet = {};
                attrsToSet[`repeating_${user}powers_detailtoggle`] = (values[`repeating_${user}powers_detailtoggle`]  === '0' ? '1' : '0');
                setAttrs(attrsToSet);
            });
        };
    }

    // on character powers detail toggle
    formsList.forEach(form => {
        on(`clicked:repeating_${form}powers:togglecharacterpowerdetail`, onPowersDetailToggleCallback(form));
    });

    function onRaceDetailToggleCallback(user) {
        return function(eventInfo) {
            getAttrs([`repeating_${user}raceskills_detailtoggle`], function(values) {
                let attrsToSet = {};
                attrsToSet[`repeating_${user}raceskills_detailtoggle`] = (values[`repeating_${user}raceskills_detailtoggle`]  === '0' ? '1' : '0');
                setAttrs(attrsToSet);
            });
        };
    }

    // on race skills detail toggle
    formsList.forEach(form => {
        on(`clicked:repeating_${form}raceskills:toggleraceskillsdetail`, onRaceDetailToggleCallback(form));
    });

    function onSpecialequipmentDetailToggleCallback() {
        return function(eventInfo) {
            getAttrs([`repeating_specialequipment_detailtoggle`], function(values) {
                let attrsToSet = {};
                attrsToSet[`repeating_specialequipment_detailtoggle`] = (values[`repeating_specialequipment_detailtoggle`]  === '0' ? '1' : '0');
                setAttrs(attrsToSet);
            });
        };
    }

    // on special equipment detail toggle
    on(`clicked:repeating_specialequipment:togglespecialequipment`, onSpecialequipmentDetailToggleCallback());

    // skill point change
    function getSkillPointChangeCallback(attribute) {
        return function() {
            getAttrs([attribute + "_notused", attribute + "_used"], function(values) {
                let totalValue = parseIntValue(values[attribute + "_notused"]) + parseIntValue(values[attribute + "_used"]);
                let attrsToSet = {};
                attrsToSet[attribute + "_total"] = totalValue;
                setAttrs(attrsToSet);
            });
        };
    }

    let skillPointList = ["str", "con", "dex", "cha", "int", "mp", "all"];
    skillPointList.forEach(attribute => {
        on(`change:${attribute}_used change:${attribute}_notused`, getSkillPointChangeCallback(attribute));
    });

    let newRowSkillFields = {
        "normal": ['skillname', 'attribute', 'skillvalue', 'totalvalue', 'mod', 'diversification', 'mastery', 'diversificationtotalvalue', 'diversificationskillvalue', 'armorreduction'],
        "magic": ['skillname', 'attribute', 'skillvalue', 'totalvalue', 'mod', 'diversification', 'mastery', 'diversificationtotalvalue', 'diversificationskillvalue', 'armorreduction'],
        "weapon": ['skillname', 'attribute', 'attack', 'parry', 'mod', 'diversification', 'mastery', 'weapondamage', 'armorreduction']
    }

    function getAddSkillDiversificationRowCallback(user, skillType) {
        return function(eventInfo) {
            const skillFields = newRowSkillFields[skillType];
            const triggerRowId = eventInfo.sourceAttribute.split('_')[2].toLowerCase();

            getSectionIDs(`repeating_${user}${skillType}skills`, idarray => {
                const fieldnames = [];
                fieldnames.push(`minddevelopment_${user}${skillType}skills`);
                fieldnames.push(`bodydevelopment_${user}${skillType}skills`);

                // get the name of EVERY attribute on every row.

                idarray.forEach(id => skillFields.forEach(field => fieldnames.push(`repeating_${user}${skillType}skills_${id}_${field}`)));
                getAttrs(fieldnames, v => {

                    let mindDevelopment = parseIntValue(v[`minddevelopment_${user}${skillType}skills`]);
                    let bodyDevelopment = parseIntValue(v[`bodydevelopment_${user}${skillType}skills`]);

                    let allrows = [];
                    // need to go throw every row and get the values, and store them with out the id
                    idarray.forEach(id => {
                        // get all the value of every attribute in a row, and story it in object with the field name
                        const thisrow = {};
                        skillFields.forEach(field => thisrow[field] = v[`repeating_${user}${skillType}skills_${id}_${field}`]);
                        allrows = [...allrows, thisrow];

                        // Create a new row right after the row that triggered the script
                        const newrow = {}
                        if (id === triggerRowId) {
                            skillFields.forEach(field => newrow[field] = v[`repeating_${user}${skillType}skills_${id}_${field}`]);
                            newrow["skillname"] = v[`repeating_${user}${skillType}skills_${id}_skillname`] + " Ausprägung";
                            newrow["diversification"] = "1";
                            newrow["diversificationskillvalue"] = 4;
                            newrow["diversificationtotalvalue"] = newrow["totalvalue"] + newrow["diversificationskillvalue"];
                            allrows = [...allrows, newrow];

                            if (isBodyDevelopmentAttribute(newrow.attribute)) {
                                bodyDevelopment++;
                            } else if (isMindDevelopmentAttribute(newrow.attribute)) {
                                mindDevelopment++;
                            }
                        }
                    });

                    // generate new unique IDs
                    let newRowIds = generateUniqueRowIDs(allrows.length);

                    // now we create a new output function
                    const attrsToSet = {};

                    allrows.forEach(row => {
                        // create new complete repeating section attribute names for each field
                        const rowid = newRowIds.shift();
                        skillFields.forEach(field => attrsToSet[`repeating_${user}${skillType}skills_${rowid}_${field}`] = row[field]);
                    });

                    // finally update the sheet. If a connection error happens between the previous row and next row, the entire repeating section is lost forever.
                    setAttrs(attrsToSet, {silent:true}, function() {
                        idarray.forEach(id => removeRepeatingRow(`repeating_${user}${skillType}skills_${id}`));
                    });

                    // mind / body development
                    const mindBodyDevelopmentAttrsToSet = {};
                    mindBodyDevelopmentAttrsToSet[`minddevelopment_${user}${skillType}skills`] = mindDevelopment;
                    mindBodyDevelopmentAttrsToSet[`bodydevelopment_${user}${skillType}skills`] = bodyDevelopment;
                    setAttrs(mindBodyDevelopmentAttrsToSet);
                });
            });
        };
    }

    formsList.forEach(form => {
        // add normal skill diversification row
        on(`clicked:repeating_${form}normalskills:addnormalskilldiversification`, getAddSkillDiversificationRowCallback(form, "normal"));

        // add magic skill diversification row
        on(`clicked:repeating_${form}magicskills:addmagicskilldiversification`, getAddSkillDiversificationRowCallback(form, "magic"));

        // add weapon skill diversification row
        on(`clicked:repeating_${form}weaponskills:addweaponskilldiversification`, getAddSkillDiversificationRowCallback(form, "weapon"));
    });

    // remove skill rows
    function getRemoveSkillRowCallback(repeatingName) {
        return function(eventInfo) {
            let attribute = eventInfo.removedInfo[eventInfo.sourceAttribute + "_attribute"];
            if (isBodyDevelopmentAttribute(attribute)) {
                getAttrs([`bodydevelopment_${repeatingName}`], values => {
                    let bodyDevelopmentNew = values["bodydevelopment_" + repeatingName] - 1;
                    let attrsToSet = {};
                    attrsToSet["bodydevelopment_" + repeatingName] = bodyDevelopmentNew;
                    setAttrs(attrsToSet);
                });
            } else if (isMindDevelopmentAttribute(attribute)) {
                getAttrs([`minddevelopment_${repeatingName}`], values => {
                    let mindDevelopmentNew = values["minddevelopment_" + repeatingName] - 1;
                    let attrsToSet = {};
                    attrsToSet["minddevelopment_" + repeatingName] = mindDevelopmentNew;
                    setAttrs(attrsToSet);
                });
            }
        };
    }

    formsList.forEach(form => {
        on(`remove:repeating_${form}normalskills`, getRemoveSkillRowCallback(`${form}normalskills`));
        on(`remove:repeating_${form}magicskills`, getRemoveSkillRowCallback(`${form}magicskills`));
        on(`remove:repeating_${form}weaponskills`, getRemoveSkillRowCallback(`${form}weaponskills`));
    });

    function getWeaponMasteryChangeCallback(repeatingName) {
        return function(eventInfo) {
            getAttrs([`repeating_${repeatingName}_mastery`], function(values) {
                let attackMastery = values[`repeating_${repeatingName}_mastery`] === "attackmastery" ? 1 : 0;
                let paradeMastery = values[`repeating_${repeatingName}_mastery`] === "parademastery" ? 1 : 0;

                let attrsToSet = {};
                attrsToSet[`repeating_${repeatingName}_attackmastery`] = attackMastery;
                attrsToSet[`repeating_${repeatingName}_parademastery`] = paradeMastery;
                setAttrs(attrsToSet);
            });
        };
    }

    // on character weapon mastery change
    formsList.forEach(form => {
        on(`change:repeating_${form}weaponskills:mastery`, getWeaponMasteryChangeCallback(`${form}weaponskills`));
    });

    // enable / disable auto calculation of body/mind development
    formsList.forEach(form => {
        on(`change:bodydevelopment_${form}autocalculation`, getOnBodyDevelopmentUpdateCallback(form));
        on(`change:minddevelopment_${form}autocalculation`, getOnMindDevelopmentUpdateCallback(form));
    });

    function getArmorreductionUpdateSkillCallback(repeatingName, form) {
        return function(idarray) {
            let repeatingAttrs = [];
            for(var i=0; i < idarray.length; i++) {
                let id = idarray[i];
                repeatingAttrs.push("repeating_" + repeatingName + "_" + id + "_attribute");
            }
            repeatingAttrs.push(`${form}_armorreduction`);

            getAttrs(repeatingAttrs, function(values) {
                let armorreduction = parseIntValue(values[`${form}_armorreduction`]);

                let attrsToSet = {};
                for(var i=0; i < idarray.length; i++) {
                    let id = idarray[i];
                    let attrName = values["repeating_" + repeatingName + "_" + id + "_attribute"];

                    let newValue = (attrName === "dexterity") ? armorreduction : 0;

                    attrsToSet["repeating_" + repeatingName + "_" + id + "_armorreduction"] = newValue;

                }
                setAttrs(attrsToSet);
            });
        }
    }

    function getOnArmorreductionUpdateCallback(form) {
        return function() {
            getAttrs([`${form}_armorreduction`, `${form}_dexterity_base`], function(values) {

                let dexterityBase = parseIntValue(values[`${form}_dexterity_base`]);
                let armorreduction = parseIntValue(values[`${form}_armorreduction`]);

                let attrsToSet = {};
                attrsToSet[`${form}_initiative_body`] = dexterityBase - armorreduction;
                attrsToSet[`${form}_dodge`] = Math.floor(dexterityBase / 3) - armorreduction;
                setAttrs(attrsToSet);
            });

            getSectionIDs(`${form}normalskills`, getArmorreductionUpdateSkillCallback(`${form}normalskills`, form));
            getSectionIDs(`${form}weaponskills`, getArmorreductionUpdateSkillCallback(`${form}weaponskills`, form));
            getSectionIDs(`${form}magicskills`, getArmorreductionUpdateSkillCallback(`${form}magicskills`, form));

        };
    }

    // on armorreduction update
    formsList.forEach(form => {
        on(`change:${form}_armorreduction`, getOnArmorreductionUpdateCallback(form));
    });

    // on armorreduction auto calc toggle change
    formsList.forEach(form => {
        on(`change:armorreduction_${form}_autocalc`, function(event) {
            getAttrs([`${form}_armorreduction`, `${form}_armorreduction_manual`], function(values) {
                let attrsToSet = {};
                if (event.newValue === '1') {
                    attrsToSet[`${form}_armorreduction`] = values[`${form}_armorreduction_manual`];
                } else {
                    attrsToSet[`${form}_armorreduction_manual`] = values[`${form}_armorreduction`];
                    attrsToSet[`${form}_armorreduction`] = '0';
                }
                setAttrs(attrsToSet);
            });
        });
    });

    formsList.forEach(form => {
        on(`clicked:${form}criticalhit`, (info) => {
            getAttrs(["optionalRuleCriticalHit"], function(values) {
                let optionalRuleCriticalHit = values["optionalRuleCriticalHit"] === "1";

                const rollString = "&{template:criticalhit} [[ [[1d20]][Würfel] [[@{" + form +"_criticalhit}]][Kritischer Treffer] [[?{Modifier|0}]][Mod] " +
                                   (optionalRuleCriticalHit ? " [[?{LP-Verlust|0}]][LP-Verlust] ]] " : "") +
                                   "{{roll=$[[0]]}} {{skill=$[[1]]}} {{mod=$[[2]]}} " +
                                   (optionalRuleCriticalHit ? " {{lploss=$[[3]]}} " : "") +
                                   "{{skillname=Kritischer Treffer}} {{user=@{" + form + "_name}}} {{calcresult=$[[0]]}}"

                startRoll(rollString, (results) => {
                    let skill = results.results.skill.result;
                    let roll = results.results.roll.result;
                    let mod = results.results.mod.result;
                    let lploss = results.results.hasOwnProperty("lploss") ? results.results.lploss.result : 0;
                    let lploss_penalty = lploss - skill > 0 ? -(lploss - skill) : 0;
                    const calculated_result = skill + mod + roll + lploss_penalty;
                    const calculated = {
                          calcresult: calculated_result,
                          lploss: lploss_penalty
                    }
                    finishRoll(results.rollId, calculated);
                });
            });
        });
    });
</script>
