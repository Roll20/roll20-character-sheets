<div class="sheet-header">
	<!-- Header Start -->
	<h1 class="title">
		<img
			src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Draw%20Steel/images/powered_by_draw_steel.webp"
			alt="Powered By Draw Steel"
			style="height: 60px"
		/>
	</h1>
	<label class="sheet-options-checkbox-label" for="sheet-options-checkbox">y</label>
	<input id="sheet-options-checkbox" class="sheet-options-checkbox" type="checkbox" />
	<div class="sheet-panel sheet-options-toggle">
	<!-- Options Panel for choosing Player/NPC sheet and imports -->
		<div class="sheet-panel-box">
			<input id="npc-checkbox" name="attr_is_npc" class="npc-checkbox" type="checkbox" />
			<label for="npc-checkbox" data-i18n="npc-toggle"></label>
			<div>
				<span data-i18n="whisper-gm"></span>
				<select name="attr_wtype">
					<option value="" data-i18n="never-whisper-roll" selected></option>
					<option value="?{Whisper?|Public Roll,|Whisper Roll,/w gm }" data-i18n="query-whisper-roll"></option>
					<option value="/w gm " data-i18n="always-whisper-roll"></option>
				</select>	
			</div>
		</div>
		<div class="sheet-panel-box">
			<h5 data-i18n="import"></h5>
			<p>Paste the contents of the Forge Steel data export (*.ds-hero file) into the text box below, then click "Import".</p>
			<p class="text-warning">This will overwrite attributes on this sheet. This cannot be undone.</p>
			<textarea name="attr_forgesteel_json"></textarea>
			<button type="action" name="act_import">Import Player</button>
			<button type="action" name="act_importmonster">Import Monster</button>
		</div>
	</div>
	
	<!-- Header End -->
</div>
<input type="hidden" class="npc-checkbox" name="attr_is_npc" />
<!-- Character Sheet Start -->
<div class="sheet-body">
	<!-- Header Panel --> 
	<div class="sheet-panel header-panel">
		<div class="sheet-panel-box profile-panel">
			<div class="name-input-group panel-dark">
				<input type="text" name="attr_character_name" />
				<label class="sublabel panel-dark" data-i18n="character-name"></label>
			</div>
			<div class="ancestry-input-group panel-dark">
				<input type="text" class="input-md" name="attr_ancestry" />
				<label class="sublabel panel-dark" data-i18n="ancestry"></label>
			</div>
			<div class="class-input-group panel-dark">
				<input type="text" class="input-md" name="attr_class" />
				<label class="sublabel panel-dark" data-i18n="class"></label>
			</div>
			<div class="career-input-group panel-dark">
				<input type="text" class="input-md" name="attr_career" />
				<label class="sublabel panel-dark" data-i18n="career"></label>
			</div>
			<div class="subclass-input-group panel-dark">
				<input type="text" class="input-md" name="attr_subclass" />
				<label class="sublabel panel-dark" data-i18n="subclass"></label>
			</div>
		</div>
		<div class="sheet-panel-box progress-panel">
			<div class="victories-input-group">
				<h5 data-i18n="victories"></h5>
				<span name="attr_victories" class="victory-count"></span>
				<div class="progressbox-group">
					<input id="victories-checkbox-1" type="checkbox" value="1" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-1"></label>
					<input id="victories-checkbox-2" type="checkbox" value="2" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-2"></label>
					<input id="victories-checkbox-3" type="checkbox" value="3" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-3"></label>
					<input id="victories-checkbox-4" type="checkbox" value="4" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-4"></label>
					<input id="victories-checkbox-5" type="checkbox" value="5" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-5"></label>
					<input id="victories-checkbox-6" type="checkbox" value="6" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-6"></label>
					<input id="victories-checkbox-7" type="checkbox" value="7" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-7"></label>
					<input id="victories-checkbox-8" type="checkbox" value="8" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-8"></label>
					<input id="victories-checkbox-9" type="checkbox" value="9" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-9"></label>
					<input id="victories-checkbox-10" type="checkbox" value="10" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-10"></label>
					<input id="victories-checkbox-11" type="checkbox" value="11" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-11"></label>
					<input id="victories-checkbox-12" type="checkbox" value="12" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-12"></label>
					<input id="victories-checkbox-13" type="checkbox" value="13" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-13"></label>
					<input id="victories-checkbox-14" type="checkbox" value="14" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-14"></label>
					<input id="victories-checkbox-15" type="checkbox" value="15" name="attr_victories" />
					<label class="progressbox" for="victories-checkbox-15"></label>
				</div>
			</div>
			<div class="level-input-group panel-dark">
				<h5 data-i18n="level"></h5>
				<input type="number" name="attr_level" />
			</div>
			<div class="wealth-input-group">
				<label data-i18n="wealth"></label>
				<input type="number" class="input-md" name="attr_wealth" />
			</div>
			<div class="renown-input-group">
				<label data-i18n="renown"></label>
				<input type="number" class="input-md" name="attr_renown" />
			</div>
			<div class="experience-input-group">
				<label data-i18n="experience"></label>
				<input type="number" class="input-md" name="attr_experience" />
			</div>
		</div>
	</div>
	<!-- Stats Panel -->
	<div class="sheet-panel stats-panel minimizable">
		<div class="minimize-control">
			<input id="stats-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="stats-minimize-checkbox" data-i18n="characteristics"></label>
		</div>
		<div class="stat-dashboard minimize-ignore">
			<div class="dashboard-characteristics minimize-ignore">
				<div class="dashboard-stat-group characteristic-input-group">
					<label data-characteristic="might" data-i18n="might">Might</label>
					<input type="number" name="attr_might" />
				</div>
				<div class="dashboard-stat-group characteristic-input-group">
					<label data-characteristic="agility" data-i18n="agility">Agility</label>
					<input type="number" name="attr_agility" />
				</div>
				<div class="dashboard-stat-group characteristic-input-group">
					<label data-characteristic="reason" data-i18n="reason"></label>
					<input type="number" name="attr_reason" />				
				</div>
				<div class="dashboard-stat-group characteristic-input-group">
					<label data-characteristic="intuition" data-i18n="intuition"></label>
					<input type="number" name="attr_intuition" />				
				</div>
				<div class="dashboard-stat-group characteristic-input-group">
					<label data-characteristic="presence" data-i18n="presence"></label>
					<input type="number" name="attr_presence" />					
				</div>
			</div>
			<div class="dashboard-stamina minimize-ignore">
				<div class="dashboard-stat-group">
					<label data-i18n="stamina">Stamina</label>
					<input type="number" name="attr_stamina" />	
				</div>
				<div>
					<div class="stamina-winded-input-group minimize-ignore">
						<label class="sublabel" data-i18n="winded">Winded</label>
						<div>
							<span class="sublabel" name="attr_stamina_winded">12</span>
						</div>
					</div>
					<div class="stamina-dying-input-group minimize-ignore">
						<label class="sublabel" data-i18n="dying">Dying</label>
						<div>
							0 to <span class="sublabel" name="attr_stamina_dead">-12</span></div>
						</div>
					</div>
				</div>
			<div class="dashboard-recoveries minimize-ignore">
				<div class="dashboard-stat-group">
					<label data-characteristic="recoveries" data-i18n="recoveries">Recoveries</label>
					<input type="number" name="attr_recoveries" />			
				</div>
			</div>
			<div class="dashboard-resource minimize-ignore"> 
				<div class="dashboard-stat-group">
					<label data-characteristic="resource" data-i18n="resource">Heroic Resource</label>
					<input type="number" name="attr_resource" />		
				</div>
			</div>
			<div class="dashboard-surges minimize-ignore">
				<div class="dashboard-stat-group">
					<label data-characteristic="surges" data-i18n="surges">Surges</label>
					<input type="number" name="attr_surges" />				
				</div>
			</div>
		</div>
		<!-- Movement -->
		<div class="movement">
			<div class="movement-input-group">
				<input type="text" class="input-md" name="attr_size" />
				<label class="sublabel" data-i18n="size"></label>
			</div>
			<div class="movement-input-group">
				<input type="number" class="input-md" name="attr_speed" />
				<label class="sublabel" data-i18n="speed"></label>
			</div>
			<div class="movement-input-group">
				<input type="number" class="input-md" name="attr_disengage" />
				<label class="sublabel" data-i18n="disengage"></label>
			</div>
			<div class="movement-input-group">
				<input type="number" class="input-md" name="attr_stability" />
				<label class="sublabel" data-i18n="stability"></label>
			</div>
		</div>
		<!-- Stamina --> 
		<div class="stamina-panel">
			<div class="stamina-temp-max-group">
				<div class="stamina-temporary-input-group">
					<input type="number" class="input-md" name="attr_stamina_temporary" />
					<label class="sublabel" data-i18n="stamina-temporary"></label>
				</div>
				<div class="stamina-max-input-group">
					<input type="number" class="input-stamina minimize-ignore" name="attr_stamina_max" />
					<label class="sublabel minimize-ignore" data-i18n="stamina-max"></label>
				</div>
			</div>
		</div>
		<!-- Recoveries -->
		<div class="recoveries-panel">
			<div class="recovery-amount-input-group">
				<input type="number" class="input-md" name="attr_recovery_amount" />
				<label class="sublabel" data-i18n="recovery-amount"></label>
			</div>
			<div class="recoveries-max-input-group">
				<input type="number" class="input-md" name="attr_recoveries_max" />
				<label class="sublabel" data-i18n="recoveries-max"></label>
			</div>
		</div>
		<!-- Heroic Resource Name -->
		<div class="resource-panel">
			<div class="resource-name-input-group">
				<input type="text" class="input-md" name="attr_resource_name" data-i18n-placeholder="resource-name-placeholder" />
			</div>
		</div>
		<!-- Surges -->
		<div class="surges-panel">
			<label class="sublabel">
				1 Surge:
			</label>
			<span>Damage</span>
			<input type="number" class="input-md" name="attr_surge_damage">
			<label class="sublabel">2 Surges:</label>
			<span>Potency + 1</span>
		</div>
		<!-- Potencies -->
		<div class="potencies sheet-panel-box">
				<h5 class="panel-title" data-i18n="potencies"></h5>
				<div class="potency-input-group">
					<label data-i18n="potency-strong"></label>
					<input type="number" class="input-md" name="attr_potency_strong" />
				</div>
				<div class="potency-input-group">
					<label data-i18n="potency-average"></label>
					<input type="number" class="input-md" name="attr_potency_average" />
				</div>
				<div class="potency-input-group">
					<label data-i18n="potency-weak"></label>
					<input type="number" class="input-md" name="attr_potency_weak" />
				</div>
		</div>
		<!-- Immunity and Weakness-->
		<div class="damage-mod-panel sheet-panel-box">
			<label><span data-i18n="immunity"></span></label>
			<input type="text" class="input-md" name="attr_immunity" />
			<label><span data-i18n="weakness"></span></label>
			<input type="text" class="input-md" name="attr_weakness" />
		</div>
		<!-- Heroic Resource Description -->
		<div class="resource-description-panel sheet-panel-box">
			<textarea data-i18n-placeholder="resource-description-placeholder" name="attr_resource_description"></textarea>
		</div>
		<!-- Conditions -->
		<div class="conditions-panel sheet-panel-box">
			<h5 class="panel-title" data-i18n="conditions"></h5>
			<fieldset class="repeating_conditions">
				<input type="text" name="attr_condition_name" data-i18n-placeholder="condition" />
				<div>
					<input type="radio" name="attr_end" value="eot" />
					<label data-i18n="eot"></label>
				</div>
				<div>
					<input type="radio" name="attr_end" value="save-ends" />
					<label data-i18n="save-ends"></label>
				</div>
			</fieldset>
		</div>		
	</div>
	<!-- Biography Panel-->
	<div class="sheet-panel biography-panel minimizable">
		<div class="minimize-control">
			<input id="biography-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="biography-minimize-checkbox" data-i18n="biography"></label>
		</div>
		<div class="sheet-panel-box career-panel">
			<h5 class="panel-title" data-i18n="career"></h5>
			<input type="text" name="attr_career" />
			<label class="sublabel" data-i18n="career-benefit"></label>
			<textarea name="attr_career_benefit" spellcheck="false"></textarea>
			<label class="sublabel" data-i18n="career-incident"></label>
			<textarea name="attr_career_incident" spellcheck="false"></textarea>
		</div>
		<div class="sheet-panel-box complication-panel">
			<h5 class="panel-title" data-i18n="complication"></h5>
			<input type="text" name="attr_complication" />
			<label class="sublabel" data-i18n="complication-benefit"></label>
			<textarea name="attr_complication_benefit" spellcheck="false"></textarea>
			<label class="sublabel" data-i18n="complication-drawback"></label>
			<textarea name="attr_complication_drawback" spellcheck="false"></textarea>
		</div>
		<div class="sheet-panel-box culture-panel">
			<h5 class="panel-title" data-i18n="culture"></h5>
			<label class="sublabel" data-i18n="culture-environment"></label>
			<label class="sublabel" data-i18n="culture-organization"></label>
			<label class="sublabel" data-i18n="culture-upbringing"></label>
			<input type="text" name="attr_culture_environment" />
			<input type="text" name="attr_culture_organization" />
			<input type="text" name="attr_culture_upbringing" />
			<textarea name="attr_culture_environment_description" spellcheck="false"></textarea>
			<textarea name="attr_culture_organization_description" spellcheck="false"></textarea>
			<textarea name="attr_culture_upbringing_description" spellcheck="false"></textarea>
		</div>
	</div>
	<!-- Skills and Languages Panel-->
	<div class="sheet-panel skills-languages-panel minimizable panel-dark">
		<div class="minimize-control">
			<input id="skills-languages-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="skills-languages-minimize-checkbox" data-i18n="skills-languages"></label>
		</div>
		<div class="skills-panel">
			<h5 class="panel-title" data-i18n="skills"></h5>
			<label data-i18n="crafting"></label>
			<input type="text" name="attr_skills_crafting" />
			<label data-i18n="exploration"></label>
			<input type="text" name="attr_skills_exploration" />
			<label data-i18n="interpersonal"></label>
			<input type="text" name="attr_skills_interpersonal" />
			<label data-i18n="intrigue"></label>
			<input type="text" name="attr_skills_intrigue" />
			<label data-i18n="lore"></label>
			<input type="text" name="attr_skills_lore" />
		</div>
		<div class="languages-panel">
			<h5 class="panel-title" data-i18n="languages"></h5>
			<input type="text" data-i18n-placeholder="caelian" name="attr_languages" />
		</div>
	</div>
	<!-- Features Panel-->
	<div class="sheet-panel features-panel minimizable panel-dark">
		<div class="minimize-control">
			<input id="features-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="features-minimize-checkbox" data-i18n="features"></label>
		</div>
		<!-- Class Features Panel -->
		<div class="sheet-panel-box class-panel">
			<h5 class="panel-title" data-i18n="class-features"></h5>
			<fieldset class="repeating_classfeatures">
				<div class="class-feature-header">
					<button class="feature-button" type="action" data-i18n-title="feature-share" name="act_classfeatureshare">
						<!-- speech balloon -->
						&#128172;
					</button>
					<input type="text" name="attr_classfeature_name" />
					<textarea name="attr_classfeature_description"></textarea>
				</div>
			</fieldset>
		</div>
		<!-- Ancestry Features Panel -->
		<div class="sheet-panel-box ancestry-panel">
			<h5 class="panel-title" data-i18n="ancestry-traits"></h5>
			<fieldset class="repeating_ancestrytraits">
				<div class="anc-feature-header">
					<button class="feature-button" type="action" data-i18n-title="feature-share" name="act_ancfeatureshare">
						<!-- speech balloon -->
						&#128172;
					</button>
					<input type="text" name="attr_ancestrytrait_name" />
					<textarea name="attr_ancestrytrait_description"></textarea>
				</div>
			</fieldset>
		</div>
		<!-- Modifiers Panel -->
		<div class="sheet-panel-box modifiers-panel">
			<h5 class="panel-title" data-i18n="modifiers"></h5>
			<fieldset class="repeating_modifiers">
				<div class="modifier-card">
					<input type="text" class="modifier-all modifier-name" data-i18n-placeholder="modifier-name" name="attr_modifier_name" />
					<select class="modifier-all modifier-type" name="attr_modifier_type">
						<option value="basic" data-i18n="modifier-basic" selected></option>
						<option value="kit" data-i18n="kit"></option>
					</select>
					<div class="kit input-group kit-weapon-input-group">
						<input type="text" class="kit kit-weapon" name="attr_kit_weapon" />
						<label class="sublabel" data-i18n="weapon-implement"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-speed" name="attr_kit_speed" />
						<label class="sublabel" data-i18n="speed"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-melee-distance" name="attr_kit_melee_distance" />
						<label class="sublabel" data-i18n="melee"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-ranged-distance" name="attr_kit_ranged_distance" />
						<label class="sublabel" data-i18n="ranged"></label>
					</div>
					<div class="kit input-group kit-armor-input-group">
						<input type="text" class="kit kit-armor" name="attr_kit_armor" />
						<label class="sublabel" data-i18n="armor"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-disengage" name="attr_kit_disengage" />
						<label class="sublabel" data-i18n="disengage"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-stability" name="attr_kit_stability" />
						<label class="sublabel" data-i18n="stability"></label>
					</div>
					<div class="kit input-group">
						<input type="number" class="kit kit-stamina" name="attr_kit_stamina" />
						<label class="sublabel" data-i18n="stamina"></label>
					</div>
					<label class="kit kit-damage-label sublabel" data-i18n="melee-weapon-damage"></label>
					<textarea class="modifier-all modifier-description" name="attr_modifier_description"></textarea>
					<div class="kit input-group kit-melee-damage-1-input-group">
						<input type="number" class="kit-melee-damage-1" name="attr_kit_melee_damage_1" />
						<label class="sublabel">≤11</label>
					</div>
					<div class="kit input-group kit-melee-damage-2-input-group">
						<input type="number" class="kit-melee-damage-2" name="attr_kit_melee_damage_2" />
						<label class="sublabel">12-16</label>
					</div>
					<div class="kit input-group kit-melee-damage-3-input-group">
						<input type="number" class="kit-melee-damage-3" name="attr_kit_melee_damage_3" />
						<label class="sublabel">17+</label>
					</div>
					<label class="kit kit-damage-label sublabel" data-i18n="ranged-weapon-damage"></label>
					<div class="kit input-group kit-ranged-damage-1-input-group">
						<input type="number" class="kit-ranged-damage-1" name="attr_kit_ranged_damage_1" />
						<label class="sublabel">≤11</label>
					</div>
					<div class="kit input-group kit-ranged-damage-2-input-group">
						<input type="number" class="kit-ranged-damage-2" name="attr_kit_ranged_damage_2" />
						<label class="sublabel">12-16</label>
					</div>
					<div class="kit input-group kit-ranged-damage-3-input-group">
						<input type="number" class="kit-ranged-damage-3" name="attr_kit_ranged_damage_3" />
						<label class="sublabel">17+</label>
					</div>
				</div>
			</fieldset>
		</div>
		<!-- Perks Panel -->
		<div class="sheet-panel-box perks-panel">
			<h5 class="panel-title" data-i18n="perks"></h5>
			<fieldset class="repeating_perks">
				<div class="perk-feature-header">
					<button class="feature-button" type="action" data-i18n-title="feature-share" name="act_perkfeatureshare">
						<!-- speech balloon -->
						&#128172;
					</button>
					<input type="text" name="attr_perk_name" />
					<textarea name="attr_perk_description"></textarea>
				</div>
			</fieldset>
		</div>
		<!-- Titles Panel -->
		<div class="sheet-panel-box titles-panel">
			<h5 class="panel-title" data-i18n="titles"></h5>
			<fieldset class="repeating_titles">
				<div class="title-feature-header">
					<button class="feature-button" type="action" data-i18n-title="feature-share" name="act_titlefeatureshare">
						<!-- speech balloon -->
						&#128172;
					</button>
					<input type="text" name="attr_title_name" />
					<textarea name="attr_title_description"></textarea>
				</div>
			</fieldset>
		</div>
	</div>
	<!-- Abilities Panel-->
	<div class="sheet-panel abilities-panel minimizable panel-dark">
		<div class="minimize-control">
			<input id="abilities-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="abilities-minimize-checkbox" data-i18n="abilities"></label>
		</div>
		<!-- Ability Type Tabs -->
		<input type="hidden" class="sheet-tabstoggle" name="attr_abilitiesTab" value="action" />
		<div class="abilities-buttons">
		    <button type="action" name="act_action" class="sheet-button-action">Main Actions</button>
		    <button type="action" name="act_maneuver" class="sheet-button-maneuver">Maneuver</button>
		    <button type="action" name="act_triggered" class="sheet-button-triggered">Triggered</button>
		    <button type="action" name="act_noaction" class="sheet-button-noaction">No Action/Traits</button>
		    <button type="action" name="act_move" class="sheet-button-move">Move</button>
		</div>
		<!-- Main Action Abilities -->
		<div class="sheet-action">
			<!-- Main Actions: repeating_abilities -->
		    <h2 data-i18n="main-actions"></h2>
			<fieldset class="repeating_abilities">
				<input class="ability-edit" type="checkbox" id="ability-edit"/>
				<div class="ability-card card-edit">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_ability_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_ability_cost" />
					</div>
					<div class="ability-details">
						<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_ability_description" />
						<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_ability_keywords" />
						<input type="hidden" name="attr_ability_type" value="main-action" />
						<span class="ability-type" data-i18n="main-action"></span>
					
						<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_ability_distance" />
						<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_ability_target" />
						<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_ability_trigger"></textarea>
						<div class="power-roll">
							<div class="power-roll-mods">
								<input type="checkbox" name="attr_has_power_roll" checked />
								<label data-i18n="power-roll"></label>
								<span>+</span>
								<select class="ability-type" name="attr_ability_characteristic">
								  <option value="might" data-i18n="might"></option>
								  <option value="agility" data-i18n="agility"></option>
								  <option value="reason" data-i18n="reason"></option>
								  <option value="intuition" data-i18n="intuition"></option>
								  <option value="presence" data-i18n="presence"></option>
								</select>
							</div>
							<label class="sublabel">≤ 11</label>
							<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_1" />
							<label class="sublabel">12-16</label>
							<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_2" />
							<label class="sublabel">17+</label>
							<input type="text" class="power-roll-tier-effect" name="attr_ability_tier_3" />
						</div>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_ability_effect"></textarea>
					</div>
				</div>
				<div class="ability-card card-display">
					<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_share">
						<!-- speech balloon -->
						&#128172;
					</button>
					<span class="ability-name" name="attr_ability_name"></span>
					<div class="ability-cost">
						<input type="hidden" name="attr_ability_cost" />
						<span data-i18n="ability-cost"></span>
						<span>:&nbsp;</span>
						<span name="attr_ability_cost"></span>
					</div>
						&nbsp;
					<div class="ability-details">
						<span class="ability-description" name="attr_ability_description"></span>
				
						<span class="ability-keywords" name="attr_ability_keywords"></span>
						<span class="ability-type" name="attr_ability_type" data-i18n-dynamic></span>
						
						<span class="ability-distance" name="attr_ability_distance" ></span>
						<span class="ability-target" name="attr_ability_target" ></span>
						<input class="ability-type" type="hidden" name="attr_ability_type" />
						<!--<span class="ability-trigger" name="attr_ability_trigger"></span>-->
						<input type="hidden" name="attr_has_power_roll" id="power-roll-flag" />
						<div class="power-roll">
							<div class="power-roll-mods">
								<label>2d10</label>
								<span>+</span>
								<span class="power-roll-characteristic" data-i18n-dynamic name="attr_ability_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_power-roll-share">
									<!-- Dice pic -->
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
								</button>
							</div>
							<label class="sublabel">≤ 11</label>
							<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_ability_tier_1" ></span>
							<label class="sublabel">12-16</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_ability_tier_2" ></span>
							<label class="sublabel">17+</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_ability_tier_3" ></span>
						</div>
						<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_ability_effect"></span>
					</div>
				</div>
			</fieldset>
			<!-- Standard Abilities -->
			<div class="standard-abilities">
				<!-- Melee Free Strike Ability -->
				<div class="standard-abilities-item">
					<input class="ability-edit" type="checkbox" id="ability-edit"/>
					<div class="ability-card card-edit">
						<input type="text" class="ability-name" data-i18n-placeholder="melee-free-strike" name="attr_melee_free_strike_name" value="Melee Weapon Free Strike" />
						<div class="ability-details">
							<input type="text" class="ability-keywords" data-i18n-placeholder="melee-free-strike-keywords" name="attr_melee_free_strike_keywords" value="Charge, Melee, Strike, Weapon" />
							<input type="hidden" name="attr_melee_free_strike_type" value="main-action" />
							<div class="ability-type">
								<span data-i18n="main-action"></span>
							</div>
							<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_melee_free_strike_distance" value="Melee 1" />
							<input type="text" class="ability-target" data-i18n-placeholder="one-creature-object" name="attr_melee_free_strike_target" value="One creature or object" />
							<input type="hidden" name="attr_melee_free_strike_has_power_roll" value="on" />
							<div class="power-roll">
								<div class="power-roll-mods">
									<label data-i18n="power-roll"></label>
									<span>+</span>
									<select class="power-roll-characteristic" name="attr_melee_free_strike_characteristic">
										<option value="might" data-i18n="might"></option>
										<option value="agility" data-i18n="agility"></option>
									</select>
								</div>
								<label class="sublabel">≤11</label>
								<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_1" value="2 + (Might or Agility) damage" />
								<label class="sublabel">12-16</label>
								<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_2" value="5 + (Might or Agility) damage" />
								<label class="sublabel">17+</label>
								<input type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_3" value="7 + (Might or Agility) damage" />
							</div>
						</div>
					</div>
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_melee_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_melee_free_strike_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_melee_free_strike_keywords"></span>
							<span class="ability-type" data-i18n="main-action"></span>
							
							<span class="ability-distance" name="attr_melee_free_strike_distance" ></span>
							<span class="ability-target" name="attr_melee_free_strike_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_melee_free_strike_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_melee_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_melee_free_strike_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_melee_free_strike_tier_3" ></span>
							</div>
						</div>
					</div>
				</div>
				<!-- Ranged Free Strike Ability -->
				<div class="standard-abilities-item">
					<input class="ability-edit" type="checkbox" id="ability-edit"/>
					<div class="ability-card card-edit">
						<input type="text" class="ability-name" data-i18n-placeholder="ranged-free-strike" name="attr_ranged_free_strike_name" value="Ranged Weapon Free Strike" />
						<div class="ability-details">
							<input type="text" class="ability-keywords" data-i18n-placeholder="ranged-free-strike-keywords" name="attr_ranged_free_strike_keywords" value="Ranged, Strike, Weapon" />
							<input type="hidden" name="attr_ranged_free_strike_type" value="main-action" />
							<div class="ability-type">
								<span data-i18n="main-action"></span>
							</div>
							<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_ranged_free_strike_distance" value="Ranged 5" />
							<input type="text" class="ability-target" data-i18n-placeholder="one-creature-object" name="attr_ranged_free_strike_target" value="One creature or object" />
							<input type="hidden" name="attr_ranged_free_strike_has_power_roll" value="on" />
							<div class="power-roll">
								<div class="power-roll-mods">
									<label data-i18n="power-roll"></label>
									<span>+</span>
									<select class="power-roll-characteristic" name="attr_ranged_free_strike_characteristic">
										<option value="might" data-i18n="might"></option>
										<option value="agility" data-i18n="agility"></option>
									</select>
								</div>
								<label class="sublabel">≤11</label>
								<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_1" value="2 + (Might or Agility) damage" />
								<label class="sublabel">12-16</label>
								<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_2" value="5 + (Might or Agility) damage" />
								<label class="sublabel">17+</label>
								<input type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_3" value="7 + (Might or Agility) damage" />
							</div>
						</div>
					</div>
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_ranged_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_ranged_free_strike_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_ranged_free_strike_keywords"></span>
							<span class="ability-type" data-i18n="main-action"></span>
							
							<span class="ability-distance" name="attr_ranged_free_strike_distance" ></span>
							<span class="ability-target" name="attr_ranged_free_strike_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_ranged_free_strike_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_ranged_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_ranged_free_strike_tier_3" ></span>
							</div>
						</div>
					</div>
				</div>
				<!-- Charge Main Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="charge" name="attr_charge_name" value="Charge" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="charge-keywords" name="attr_charge_keywords" value="" />
					<input type="hidden" name="attr_charge_type" value="main-action" />
					<input type="hidden" class="ability-effect" name="attr_charge_effect" value="When a creature takes the Charge main action, they move up to their speed in a straight line, then make a melee free strike against a target when they end their move. If the creature has an ability with the Charge keyword, they can use that ability against the target instead of a free strike. A creature can’t move through difficult terrain or shift when they charge. They can fly or burrow as part of the Charge main action if they have that movement available to them, but they can’t climb or swim while charging unless they can automatically use that movement at full speed." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_charge_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_charge_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_charge_keywords"></span>
							<span class="ability-type" data-i18n="main-action"></span>
							
							<span class="ability-effect read-ability-effect" name="attr_charge_effect"></span>
						</div>
					</div>
				</div>
				<!-- Defend Main Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="defend" name="attr_defend_name" value="Defend" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="defend-keywords" name="attr_defend_keywords" value="" />
					<input type="hidden" name="attr_defend_type" value="Main Action" />
					<input type="hidden" class="ability-effect" name="attr_defend_effect" value="When a creature takes the Defend main action, ability rolls made against them have a double bane until the start of their next turn. Additionally, you have a double edge on tests when called for to resist environmental effects or a creature’s traits or abilities. A creature gains no benefit from this action while another creature is taunted by them." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_defend_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Defend" name="attr_defend_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" data-i18n-placeholder="defend" name="attr_defend_keywords"></span>
							<span class="ability-type" data-i18n="main-action"></span>
							<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_defend_effect"></span>
						</div>
					</div>
				</div>
				<!-- Heal Main Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="heal" name="attr_heal_name" value="Heal" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="heal-keywords" name="attr_heal_keywords" value="" />
					<input type="hidden" name="attr_heal_type" value="Main Action" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_heal_distance" value="Melee 1" />
					<input type="hidden" class="ability-target" name="attr_heal_target" value="One creature" />
					<input type="hidden" class="ability-effect" name="attr_heal_effect" value="A creature who uses the Heal main action employs medicine or inspiring words to make an adjacent creature feel better and stay in the fight. The target creature can spend a Recovery to regain Stamina, or can make a saving throw against one effect they are suffering that is ended by a saving throw." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_heal_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Heal" name="attr_heal_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" data-i18n-placeholder="heal-keywords" name="attr_heal_keywords"></span>
							<span class="ability-type" data-i18n="main-action"></span>
							<span class="ability-distance read-ability-distance" data-i18n-placeholder="Distance" name="attr_heal_distance" ></span>
							<span class="ability-target read-ability-target" data-i18n-placeholder="Target" name="attr_heal_target" ></span>
							<span class="ability-effect read-ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_heal_effect"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Maneuver Abilities -->
		<div class="sheet-maneuver">
			<!-- Maneuvers: repeating_maneuvers -->
			<h2 data-i18n="maneuvers"></h2>
			 <fieldset class="repeating_maneuvers">
				<input class="ability-edit" type="checkbox" id="ability-edit"/>
				<div class="ability-card card-edit">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_maneuver_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_maneuver_cost" />
					</div>
					<div class="ability-details">
						<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_maneuver_description" />
						<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_maneuver_keywords" />
						<input type="hidden" name="attr_moves_type" />
						<select class="ability-type" name="attr_maneuver_type">
							<option value="maneuver" data-i18n="maneuver"></option>
							<option value="free-maneuver" data-i18n="free-maneuver"></option>
						</select>
						<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_maneuver_distance" />
						<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_maneuver_target" />
						<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_maneuver_trigger"></textarea>
						<div class="power-roll">
							<div class="power-roll-mods">
								<input type="checkbox" name="attr_has_power_roll" checked />
								<label data-i18n="power-roll"></label>
								<span>+</span>
								<select class="ability-type" name="attr_maneuver_characteristic">
								  <option value="might" data-i18n="might"></option>
								  <option value="agility" data-i18n="agility"></option>
								  <option value="reason" data-i18n="reason"></option>
								  <option value="intuition" data-i18n="intuition"></option>
								  <option value="presence" data-i18n="presence"></option>
								</select>
							</div>
							<label class="sublabel">≤ 11</label>
							<input type="text" class="power-roll-tier-effect" name="attr_maneuver_tier_1" />
							<label class="sublabel">12-16</label>
							<input type="text" class="power-roll-tier-effect" name="attr_maneuver_tier_2" />
							<label class="sublabel">17+</label>
							<input type="text" class="power-roll-tier-effect" name="attr_maneuver_tier_3" />
						</div>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_maneuver_effect"></textarea>
					</div>
				</div>
				<div class="ability-card card-display">
					<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_share">
						<!-- speech balloon -->
						&#128172;
					</button>
					<span class="ability-name" name="attr_maneuver_name"></span>
					<div class="ability-cost">
						<input type="hidden" name="attr_maneuver_cost" />
						<span data-i18n="ability-cost"></span>
						<span>:&nbsp;</span>
						<span name="attr_maneuver_cost"></span>
					</div>
						&nbsp;
					<div class="ability-details">
						<span class="ability-description" name="attr_maneuver_description"></span>
				
						<span class="ability-keywords" name="attr_maneuver_keywords"></span>
						<span class="ability-type" name="attr_maneuver_type" data-i18n-dynamic></span>
						
						<span class="ability-distance" name="attr_maneuver_distance" ></span>
						<span class="ability-target" name="attr_maneuver_target" ></span>
						<input class="ability-type" type="hidden" name="attr_maneuver_type" />
						<!--<span class="ability-trigger" name="attr_maneuver_trigger"></span>-->
						<input type="hidden" name="attr_has_power_roll" id="power-roll-flag" />
						<div class="power-roll">
							<div class="power-roll-mods">
								<label>2d10</label>
								<span>+</span>
								<span class="power-roll-characteristic" data-i18n-dynamic name="attr_maneuver_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_power-roll-share">
									<!-- Dice pic -->
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
								</button>
							</div>
							<label class="sublabel">≤ 11</label>
							<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_maneuver_tier_1" ></span>
							<label class="sublabel">12-16</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_maneuver_tier_2" ></span>
							<label class="sublabel">17+</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_maneuver_tier_3" ></span>
						</div>
						<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_maneuver_effect"></span>
					</div>
				</div>
			</fieldset>
			
			<!-- Standard Maneuvers -->
			<div class="standard-abilities">
				<!-- Knockback -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="knockback" name="attr_knockback_name" value="Knockback" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="knockback-keywords" name="attr_knockback_keywords" value="Melee, Weapon" />
					<input type="hidden" name="attr_knockback_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_knockback_distance" value="Melee 1" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_knockback_target" value="One creature" />
					<input type="hidden" name="attr_knockback_has_power_roll" value="on" />
					<input type="hidden" class="power-roll-characteristic" name="attr_knockback_characteristic" value="might" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_knockback_tier_1" value="Push 1" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_knockback_tier_2" value="Push 2" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_knockback_tier_3" value="Push 3" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_knockback_effect" value="Effect: You can usually target only creatures of your size or smaller. If your Might score is 2 or higher, you can target any creature with a size equal to or less than your Might score." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_knockback_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Knockback" name="attr_knockback_name"></span>
						<div class="ability-details">
							
							<span class="ability-keywords" data-i18n-placeholder="knockback-keywords" name="attr_knockback_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							
							<span class="ability-distance" data-i18n-placeholder="Distance" name="attr_knockback_distance" ></span>
							<span class="ability-target" data-i18n-placeholder="Target" name="attr_knockback_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_knockback_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_knockback_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_knockback_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_knockback_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_knockback_tier_3" ></span>
							</div>
							<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_knockback_effect"></span>
						</div>
					</div>
				</div>
				<!-- Grab -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="grab" name="attr_grab_name" value="Grab" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="grab-keywords" name="attr_grab_keywords" value="Melee, Weapon" />
					<input type="hidden" name="attr_grab_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_grab_distance" value="Melee 1" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_grab_target" value="One creature" />
					<input type="hidden" name="attr_grab_has_power_roll" value="on" />
					<input type="hidden" class="power-roll-characteristic" name="attr_grab_characteristic" value="might" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_grab_tier_1" value="No effect." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_grab_tier_2" value="You can grab the target, but if you do, the target can make a melee free strike against you before they are grabbed." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_grab_tier_3" value="The target is grabbed by you." />
					<input type="hidden" class="ability-effect" name="attr_grab_effect" value="Effect: You can usually target only creatures of your size or smaller. If your Might score is 2 or higher, you can target any creature with a size equal to or less than your Might score. Unless otherwise indicated, a creature can grab only one creature at a time." />
					
					<div class="ability-card">
						<button type="action" data-i18n-title="ability-share" name="act_grab_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Grab" name="attr_grab_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" data-i18n-placeholder="grab-keywords" name="attr_grab_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							
							<span class="ability-distance" data-i18n-placeholder="Distance" name="attr_grab_distance" ></span>
							<span class="ability-target" data-i18n-placeholder="Target" name="attr_grab_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_grab_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_grab_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_grab_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_grab_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_grab_tier_3" ></span>
							</div>
							<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_grab_effect"></span>
						</div>
					</div>
				</div>
				<!-- Escape Grab -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="escape-grab" name="attr_escape_grab_name" value="Escape Grab" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="escape-grab-keywords" name="attr_escape_grab_keywords" value="" />
					<input type="hidden" name="attr_escape_grab_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_escape_grab_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_escape_grab_target" value="Self" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_escape_grab_tier_1" value="No effect." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_escape_grab_tier_2" value="You can escape the grab, but if you do, a creature who has you grabbed can make a melee free strike against you before you are no longer grabbed." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_escape_grab_tier_3" value="You are no longer grabbed." />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_escape_grab_effect" value="Effect: You take a bane on this maneuver if your size is smaller than the size of the creature, object, or effect that has you grabbed" />
					
					<input class="ability-edit" type="checkbox" id="ability-edit"/>
					<div class="ability-card card-edit">
						<span class="ability-name" data-i18n-placeholder="Escape Grab" name="attr_escape_grab_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" data-i18n-placeholder="knockback-keywords" name="attr_escape_grab_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
						
							<span class="ability-distance" data-i18n-placeholder="Distance" name="attr_escape_grab_distance" ></span>
							<span class="ability-target" data-i18n-placeholder="Target" name="attr_escape_grab_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label data-i18n="power-roll"></label>
									<span>+</span>
									<select class="ability-type" name="attr_escape_grab_characteristic">
										<option value="might" data-i18n="might"></option>
										<option value="agility" data-i18n="agility"></option>
									</select>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_escape_grab_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_escape_grab_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_escape_grab_tier_3" ></span>
							</div>
							<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_escape_grab_effect"></span>						
						</div>
					</div>
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_escape_grab_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Escape Grab" name="attr_escape_grab_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" data-i18n-placeholder="knockback-keywords" name="attr_escape_grab_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
						
							<span class="ability-distance" data-i18n-placeholder="Distance" name="attr_escape_grab_distance" ></span>
							<span class="ability-target" data-i18n-placeholder="Target" name="attr_escape_grab_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_escape_grab_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_escape_grab_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_escape_grab_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_escape_grab_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_escape_grab_tier_3" ></span>
							</div>
							<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_escape_grab_effect"></span>
						</div>
					</div>
				</div>
				<!-- Claw Dirt Maneuver -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="claw-dirt" name="attr_claw_dirt_name" value="Claw Dirt" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="claw-dirt-keywords" name="attr_claw_dirt_keywords" value="" />
					<input type="hidden" name="attr_claw_dirt_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_claw_dirt_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_claw_dirt_target" value="Self" />
					<input type="hidden" class="power-roll-characteristic" data-i18n-placeholder="might" name="attr_claw_dirt_characteristic" value="might" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_claw_dirt_tier_1" value="You can move 1 square into, out of, or through ground you are touching that can be burrowed through, and you are slowed and weakened (EoT)." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_claw_dirt_tier_2" value="You can use your main action this turn to move 1 square into, out of, or through ground you are touching that can be burrowed through, and you are slowed (EoT)." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_claw_dirt_tier_3" value="You can move 1 square into, out of, or through ground you are touching that can be burrowed through." />
					<input type="hidden" name="attr_claw_dirt_has_power_roll" value="on" />
						
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_claw_dirt_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_claw_dirt_name"></span>
						<div class="ability-details"> 						
							<span class="ability-keywords" name="attr_claw_dirt_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							
							<span class="ability-distance" name="attr_claw_dirt_distance" ></span>
							<span class="ability-target" name="attr_claw_dirt_target" ></span>
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_claw_dirt_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_claw_dirt_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_claw_dirt_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span class="power-roll-tier-effect" name="attr_claw_dirt_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span class="power-roll-tier-effect" name="attr_claw_dirt_tier_3" ></span>
							</div>
							<span class="ability-effect" name="attr_claw_dirt_effect"></span>
						</div>
					</div>
				</div>
				<!-- Aid Attack -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" name="attr_aid_attack_name" value="Aid Attack" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="heal-keywords" name="attr_aid_attack_keywords" value="" />
					<input type="hidden" name="attr_aid_attack_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_aid_attack_distance" value="Melee 1" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_aid_attack_target" value="One enemy" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_aid_attack_effect" value="A creature who uses the Aid Attack maneuver chooses an enemy adjacent to them. The next ability roll an ally makes against that enemy before the start of the aiding creature’s next turn gains an edge." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_aid_attack_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Aid Attack" name="attr_aid_attack_name"></span>
						<div class="ability-details">
							<span class="ability-keywords read-ability-keywords" data-i18n-placeholder="aid-attack-keywords" name="attr_aid_attack_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							
							<span class="ability-distance read-ability-distance" data-i18n-placeholder="Distance" name="attr_aid_attack_distance" ></span>
							<span class="ability-target read-ability-target" data-i18n-placeholder="Target" name="attr_aid_attack_target" ></span>
							<span class="ability-effect read-ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_aid_attack_effect"></span>
						</div>
					</div>
				</div>
				<!-- Catch Breath -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="catch-breath" name="attr_catch_breath_name" value="Catch Breath" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="catch-breath-keywords" name="attr_catch_breath_keywords" value="" />
					<input type="hidden" name="attr_catch_breath_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_catch_breath_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_catch_breath_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_catch_breath_effect" value="A creature who uses the Catch Breath maneuver spends a Recovery and regains Stamina equal to their recovery value. A creature who is dying can’t use the Catch Breath maneuver, but other creatures can help them spend Recoveries in other ways." />
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_catch_breath_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" data-i18n-placeholder="Catch Breath" name="attr_catch_breath_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_catch_breath_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							<span class="ability-distance" name="attr_catch_breath_distance" ></span>
							<span class="ability-target" name="attr_catch_breath_target" ></span>
							<span class="ability-effect" name="attr_catch_breath_effect"></span>
						</div>
					</div>
				</div>
				<!-- Hide Maneuver -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="hide" name="attr_hide_name" value="Hide" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="hide-keywords" name="attr_hide_keywords" value="" />
					<input type="hidden" name="attr_hide_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_hide_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_hide_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_hide_effect" value="Using the Hide maneuver, a creature attempts to hide from other creatures who aren’t observing them while they have cover or concealment." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_hide_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_hide_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_hide_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							<span class="ability-distance" name="attr_hide_distance" ></span>
							<span class="ability-target" name="attr_hide_target" ></span>
							<span class="ability-effect" name="attr_hide_effect"></span>
						</div>
					</div>
				</div>
				<!-- Search Maneuver -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="search" name="attr_search_name" value="Search for Hidden Creatures" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="search-keywords" name="attr_search_keywords" value="" />
					<input type="hidden" name="attr_hide_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_search_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_search_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_search_effect" value="The Search for Hidden Creatures maneuver allows a creature to attempt to locate creatures hidden from them." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_search_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_search_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_search_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							<span class="ability-distance" name="attr_search_distance" ></span>
							<span class="ability-target" name="attr_search_target" ></span>
							<span class="ability-effect" name="attr_search_effect"></span>
						</div>
					</div>
				</div>
				<!-- Stand Up -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="standup" name="attr_standup_name" value="Stand Up" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="standup-keywords" name="attr_standup_keywords" value="" />
					<input type="hidden" name="attr_hide_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_standup_distance" value="Self or Melee 1" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_standup_target" value="Self or one creature" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_standup_effect" value="A creature can use the Stand Up maneuver to stand up if they are prone, ending that condition. Alternatively, they can use this maneuver to make a willing adjacent prone creature stand up." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_standup_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_standup_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_standup_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							<span class="ability-distance" name="attr_standup_distance" ></span>
							<span class="ability-target" name="attr_standup_target" ></span>
							<span class="ability-effect" name="attr_standup_effect"></span>
						</div>
					</div>
				</div>
				<!-- Use Consumable -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="consumable" name="attr_consumable_name" value="Use Consumable" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="consumable-keywords" name="attr_consumable_keywords" value="" />
					<input type="hidden" name="attr_hide_type" value="maneuver" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_consumable_distance" value="Self or Melee 1" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="self" name="attr_consumable_target" value="Self or one creature" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_consumable_effect" value="Unless otherwise noted in its description, a creature can activate a consumable treasure such as a potion with the Use Consumable maneuver. A creature can use this maneuver to administer a consumable treasure that benefits the user either to themself or to a willing adjacent creature." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_standup_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_consumable_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_consumable_keywords"></span>
							<span class="ability-type" data-i18n="maneuver"></span>
							<span class="ability-distance" name="attr_consumable_distance" ></span>
							<span class="ability-target" name="attr_consumable_target" ></span>
							<span class="ability-effect" name="attr_consumable_effect"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Triggered Abilities-->
		<div class="sheet-triggered">
		    <h2 data-i18n="triggered"></h2>
			<!-- Triggered: repeating_triggered -->
			<fieldset class="repeating_triggered">
				<input class="ability-edit" type="checkbox" id="ability-edit"/>
				<div class="ability-card card-edit">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_triggered_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_triggered_cost" />
					</div>
					<div class="ability-details">
						<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_triggered_description" />
						<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_triggered_keywords" />
						<select class="ability-type" name="attr_triggered_type">
							<option value="triggered-action" data-i18n="triggered-action"></option>
							<option value="free-triggered-action" data-i18n="free-triggered-action"></option>
						</select>
						<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_triggered_distance" />
						<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_triggered_target" />
						<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_triggered_trigger"></textarea>
						<div class="power-roll">
							<div class="power-roll-mods">
								<input type="checkbox" name="attr_has_power_roll" checked />
								<label data-i18n="power-roll"></label>
								<span>+</span>
								<select class="ability-type" name="attr_triggered_characteristic">
								  <option value="might" data-i18n="might"></option>
								  <option value="agility" data-i18n="agility"></option>
								  <option value="reason" data-i18n="reason"></option>
								  <option value="intuition" data-i18n="intuition"></option>
								  <option value="presence" data-i18n="presence"></option>
								</select>
							</div>
							<label class="sublabel">≤ 11</label>
							<input type="text" class="power-roll-tier-effect" name="attr_triggered_tier_1" />
							<label class="sublabel">12-16</label>
							<input type="text" class="power-roll-tier-effect" name="attr_triggered_tier_2" />
							<label class="sublabel">17+</label>
							<input type="text" class="power-roll-tier-effect" name="attr_triggered_tier_3" />
						</div>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_triggered_effect"></textarea>
					</div>
				</div>
				<div class="ability-card card-display">
					<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_share">
						<!-- speech balloon -->
						&#128172;
					</button>
					<span class="ability-name" name="attr_triggered_name"></span>
					<div class="ability-cost">
						<input type="hidden" name="attr_triggered_cost" />
						<span data-i18n="ability-cost"></span>
						<span>:&nbsp;</span>
						<span name="attr_triggered_cost"></span>
					</div>
						&nbsp;
					<div class="ability-details">
						<span class="ability-description" name="attr_triggered_description"></span>
				
						<span class="ability-keywords" name="attr_triggered_keywords"></span>
						<span class="ability-type" name="attr_triggered_type" data-i18n-dynamic></span>
						
						<span class="ability-distance" name="attr_triggered_distance" ></span>
						<span class="ability-target" name="attr_triggered_target" ></span>
						<input class="ability-type" type="hidden" name="attr_triggered_type" />
						<span class="ability-trigger" name="attr_triggered_trigger"></span>
						<input type="hidden" name="attr_has_power_roll" id="power-roll-flag" />
						<div class="power-roll">
							<div class="power-roll-mods">
								<label>2d10</label>
								<span>+</span>
								<span class="power-roll-characteristic" data-i18n-dynamic name="attr_triggered_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_power-roll-share">
									<!-- Dice pic -->
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
								</button>
							</div>
							<label class="sublabel">≤ 11</label>
							<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_triggered_tier_1" ></span>
							<label class="sublabel">12-16</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_triggered_tier_2" ></span>
							<label class="sublabel">17+</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_triggered_tier_3" ></span>
						</div>
						<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_triggered_effect"></span>
					</div>
				</div>
			</fieldset>
		</div>
		<!-- No-Actions Abilities -->
		<div class="sheet-noaction">
		    <h2 data-i18n="no-action-trait"></h2>
			<!-- No Actions/Traits: repeating_noaction -->
			<fieldset class="repeating_noaction">
				<input class="ability-edit" type="checkbox" id="ability-edit"/>
				<div class="ability-card card-edit">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_noaction_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_noaction_cost" />
					</div>
					<div class="ability-details">
						<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_noaction_description" />
						<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_noaction_keywords" />
						<input type="hidden" name="attr_moves_type" value="no-action" />
						<span class="ability-type" data-i18n="no-action"></span>
					
						<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_noaction_distance" />
						<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_noaction_target" />
						<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_noaction_trigger"></textarea>
						<div class="power-roll">
							<div class="power-roll-mods">
								<input type="checkbox" name="attr_has_power_roll" checked />
								<label data-i18n="power-roll"></label>
								<span>+</span>
								<select class="ability-type" name="attr_noaction_characteristic">
								  <option value="might" data-i18n="might"></option>
								  <option value="agility" data-i18n="agility"></option>
								  <option value="reason" data-i18n="reason"></option>
								  <option value="intuition" data-i18n="intuition"></option>
								  <option value="presence" data-i18n="presence"></option>
								</select>
							</div>
							<label class="sublabel">≤ 11</label>
							<input type="text" class="power-roll-tier-effect" name="attr_noaction_tier_1" />
							<label class="sublabel">12-16</label>
							<input type="text" class="power-roll-tier-effect" name="attr_noaction_tier_2" />
							<label class="sublabel">17+</label>
							<input type="text" class="power-roll-tier-effect" name="attr_noaction_tier_3" />
						</div>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_noaction_effect"></textarea>
					</div>
				</div>
				<div class="ability-card card-display">
					<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_share">
						<!-- speech balloon -->
						&#128172;
					</button>
					<span class="ability-name" name="attr_noaction_name"></span>
					<div class="ability-cost">
						<input type="hidden" name="attr_noaction_cost" />
						<span data-i18n="ability-cost"></span>
						<span>:&nbsp;</span>
						<span name="attr_noaction_cost"></span>
					</div>
						&nbsp;
					<div class="ability-details">
						<span class="ability-description" name="attr_noaction_description"></span>
				
						<span class="ability-keywords" name="attr_noaction_keywords"></span>
						<span class="ability-type"></span>
						
						<span class="ability-distance" name="attr_noaction_distance" ></span>
						<span class="ability-target" name="attr_noaction_target" ></span>
						<input class="ability-type" type="hidden" name="attr_noaction_type" />
						<!--<span class="ability-trigger" name="attr_noaction_trigger"></span>-->
						<input type="hidden" name="attr_has_power_roll" id="power-roll-flag" />
						<div class="power-roll">
							<div class="power-roll-mods">
								<label>2d10</label>
								<span>+</span>
								<span class="power-roll-characteristic" data-i18n-dynamic name="attr_noaction_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_power-roll-share">
									<!-- Dice pic -->
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
								</button>
							</div>
							<label class="sublabel">≤ 11</label>
							<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_noaction_tier_1" ></span>
							<label class="sublabel">12-16</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_noaction_tier_2" ></span>
							<label class="sublabel">17+</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_noaction_tier_3" ></span>
						</div>
						<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_noaction_effect"></span>
					</div>
				</div>
			</fieldset>
			<!-- Standard Abilities -->
			<div class="standard-abilities">
				<!-- Jump Move -->
				<div class="standard-abilities-item">
					<input type="hidden" data-i18n-placeholder="jump" name="attr_jump_name" value="Jump" />
					<input type="hidden" name="attr_jump_type" value="no-action" />
					<input type="hidden" name="attr_jump_has_power_roll" value="on" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_jump_tier_1" value="You don’t jump any farther than your baseline jump allows." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_jump_tier_2" value="You jump 1 square longer and higher than your baseline jump allows." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_jump_tier_3" value="You jump 2 squares longer and higher than your baseline jump allows." />
					<input type="hidden" class="ability-effect" name="attr_jump_effect" value="You can’t jump farther or higher than the distance of the effect that allows you to move. You can’t jump out of difficult terrain or damaging terrain." />
					
					<input class="ability-edit" type="checkbox" id="ability-edit"/>
					<div class="ability-card card-edit">
						<span class="ability-name" name="attr_jump_name"></span>
						<div class="ability-details">
							<div class="power-roll">
								<div class="power-roll-mods">
									<label data-i18n="power-roll"></label>
									<span>+</span>
									<select class="ability-type" name="attr_jump_characteristic">
										<option value="might" data-i18n="might"></option>
										<option value="agility" data-i18n="agility"></option>
									</select>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_jump_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_jump_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_jump_tier_3" ></span>
							</div>
							<span class="ability-effect" name="attr_jump_effect"></span>						
						</div>
					</div>
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_jump_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_jump_name"></span>
						<div class="ability-details">
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_jump_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_jump_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_jump_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_jump_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_jump_tier_3" ></span>
							</div>
							<span class="ability-effect" name="attr_jump_effect"></span>
						</div>
					</div>
				</div>
				<!-- Climb Creature Maneuver -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="climb-creature" name="attr_climb_creature_name" value="Climbing Other Creatures" />
					<input type="hidden" name="attr_climb_creature_type" value="no-action" />
					<input type="hidden" name="attr_climb_creature_has_power_roll" value="on" />
					<input type="hidden" class="power-roll-tier-effect" name="attr_climb_creature_tier_1" value="You fail to climb the creature, and they can make a free strike against you." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_climb_creature_tier_2" value="You fail to climb the creature." />
					<input type="hidden" class="power-roll-tier-effect" name="attr_climb_creature_tier_3" value="You climb the creature." />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_climb_creature_effect" value="While you climb or ride a creature, you gain an edge on melee abilities used against them." />
					
					<input class="ability-edit" type="checkbox" id="ability-edit"/>
					<div class="ability-card card-edit">
						<span class="ability-name" name="attr_climb_creature_name"></span>
						<div class="ability-details">
							<div class="power-roll">
								<div class="power-roll-mods">
									<label data-i18n="power-roll"></label>
									<span>+</span>
									<select class="ability-type" name="attr_climb_creature_characteristic">
										<option value="might" data-i18n="might"></option>
										<option value="agility" data-i18n="agility"></option>
									</select>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_climb_creature_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_climb_creature_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_climb_creature_tier_3" ></span>
							</div>
							<span class="ability-effect" name="attr_climb_creature_effect"></span>						
						</div>
					</div>
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_climb_creature_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_climb_creature_name"></span>
						<div class="ability-details">
							<div class="power-roll">
								<div class="power-roll-mods">
									<label>2d10</label>
									<span>+</span>
									<span class="power-roll-characteristic" data-i18n-dynamic name="attr_climb_creature_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_climb_creature_power_roll_share">
										<!-- Dice pic -->
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
										<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
									</button>
								</div>
								<label class="sublabel">≤ 11</label>
								<span class="power-roll-tier-effect" name="attr_climb_creature_tier_1" ></span>
								<label class="sublabel">12-16</label>
								<span type="text" class="power-roll-tier-effect" name="attr_climb_creature_tier_2" ></span>
								<label class="sublabel">17+</label>
								<span type="text" class="power-roll-tier-effect" name="attr_climb_creature_tier_3" ></span>
							</div>
							<span class="ability-effect" name="attr_climb_creature_effect"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- Move Abilities -->
		<div class="sheet-move">
		    <h2 data-i18n="move-actions"></h2>
			<!-- Moves: repeating_moves -->
			<fieldset class="repeating_moves">
				<input class="ability-edit" type="checkbox" id="ability-edit"/>
				<div class="ability-card card-edit">
					<input type="text" class="ability-name" data-i18n-placeholder="ability-name" name="attr_moves_name" />
					<div class="ability-cost-input-group">
						<label data-i18n="ability-cost"></label>
						<input type="number" name="attr_moves_cost" />
					</div>
					<div class="ability-details">
						<input type="text" class="ability-description" data-i18n-placeholder="ability-description" name="attr_moves_description" />
						<input type="text" class="ability-keywords" data-i18n-placeholder="keywords" name="attr_moves_keywords" />
						<input type="hidden" name="attr_moves_type" value="move-action" />
						<span class="ability-type" data-i18n="main-action"></span>
					
						<input type="text" class="ability-distance" data-i18n-placeholder="distance" name="attr_moves_distance" />
						<input type="text" class="ability-target" data-i18n-placeholder="target" name="attr_moves_target" />
						<textarea class="ability-trigger triggered-show" data-i18n-placeholder="trigger" name="attr_moves_trigger"></textarea>
						<div class="power-roll">
							<div class="power-roll-mods">
								<input type="checkbox" name="attr_has_power_roll" checked />
								<label data-i18n="power-roll"></label>
								<span>+</span>
								<select class="ability-type" name="attr_moves_characteristic">
								  <option value="might" data-i18n="might"></option>
								  <option value="agility" data-i18n="agility"></option>
								  <option value="reason" data-i18n="reason"></option>
								  <option value="intuition" data-i18n="intuition"></option>
								  <option value="presence" data-i18n="presence"></option>
								</select>
							</div>
							<label class="sublabel">≤ 11</label>
							<input type="text" class="power-roll-tier-effect" name="attr_moves_tier_1" />
							<label class="sublabel">12-16</label>
							<input type="text" class="power-roll-tier-effect" name="attr_moves_tier_2" />
							<label class="sublabel">17+</label>
							<input type="text" class="power-roll-tier-effect" name="attr_moves_tier_3" />
						</div>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_moves_effect"></textarea>
					</div>
				</div>
				<div class="ability-card card-display">
					<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_share">
						<!-- speech balloon -->
						&#128172;
					</button>
					<span class="ability-name" name="attr_moves_name"></span>
					<div class="ability-cost">
						<input type="hidden" name="attr_moves_cost" />
						<span data-i18n="ability-cost"></span>
						<span>:&nbsp;</span>
						<span name="attr_moves_cost"></span>
					</div>
						&nbsp;
					<div class="ability-details">
						<span class="ability-description" name="attr_moves_description"></span>
				
						<span class="ability-keywords" name="attr_moves_keywords"></span>
						<span class="ability-type" name="attr_moves_type" data-i18n-dynamic></span>
						
						<span class="ability-distance" name="attr_moves_distance" ></span>
						<span class="ability-target" name="attr_moves_target" ></span>
						<input class="ability-type" type="hidden" name="attr_moves_type" />
						<!--<span class="ability-trigger" name="attr_moves_trigger"></span>-->
						<input type="hidden" name="attr_has_power_roll" id="power-roll-flag" />
						<div class="power-roll">
							<div class="power-roll-mods">
								<label>2d10</label>
								<span>+</span>
								<span class="power-roll-characteristic" data-i18n-dynamic name="attr_moves_characteristic" ></span>
									<button type="action" data-i18n-title="power-roll-share" name="act_power-roll-share">
									<!-- Dice pic -->
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;">
									<img src="https://game-icons.net/icons/ffffff/000000/1x1/skoll/d10.svg" alt="Roll Dice" style="width:32px; height:32px;"> 
								</button>
							</div>
							<label class="sublabel">≤ 11</label>
							<span class="power-roll-tier-effect" data-i18n-placeholder="Tier 1 effect" name="attr_moves_tier_1" ></span>
							<label class="sublabel">12-16</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 2 effect" name="attr_moves_tier_2" ></span>
							<label class="sublabel">17+</label>
							<span type="text" class="power-roll-tier-effect" data-i18n-placeholder="Tier 3 effect" name="attr_moves_tier_3" ></span>
						</div>
						<span class="ability-effect" data-i18n-placeholder="Effect: effect text" name="attr_moves_effect"></span>
					</div>
				</div>
			</fieldset>
			<!-- Standard Moves -->
			<div class="standard-abilities">
				<!-- Advance Move Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="advance" name="attr_advance_name" value="Advance" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="advance-keywords" name="attr_advance_keywords" value="" />
					<input type="hidden" name="attr_advance_type" value="move-action" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_advance_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_advance_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_advance_effect" value="When a creature takes the Advance move action, they move a number of squares up to their speed. They can break up this movement with their maneuver and main action however they wish." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_advance_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_advance_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_advance_keywords"></span>
							<span class="ability-type" data-i18n="move-action"></span>
							<span class="ability-distance" name="attr_advance_distance" ></span>
							<span class="ability-target" name="attr_advance_target" ></span>
							<span class="ability-effect" name="attr_advance_effect"></span>
						</div>
					</div>
				</div>
				<!--Disengage Move Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="disengage" name="attr_disengage_name" value="Disengage" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="disengage-keywords" name="attr_disengage_keywords" value="" />
					<input type="hidden" name="attr_disengage_type" value="move-action" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_disengage_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_disengage_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_disengage_effect" value="When a creature takes the Disengage move action, they can shift 1 square. Certain class features, kits, and other rules allow a creature to shift more than 1 square when they disengage. A creature who does so can break up their shift with their maneuver and main action however they wish." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_disengage_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_disengage_name"></span>
						<div class="ability-details">
							<span class="ability-keywords read-ability-keywords" name="attr_disengage_keywords"></span>
							<span class="ability-type" data-i18n="move-action"></span>
							<span class="ability-distance" name="attr_disengage_distance" ></span>
							<span class="ability-target" name="attr_disengage_target" ></span>
							<span class="ability-effect"  name="attr_disengage_effect"></span>
						</div>
					</div>
				</div>
				<!-- Ride Move Action -->
				<div class="standard-abilities-item">
					<input type="hidden" class="ability-name" data-i18n-placeholder="ride" name="attr_ride_name" value="Ride" />
					<input type="hidden" class="ability-keywords" data-i18n-placeholder="ride-keywords" name="attr_ride_keywords" value="" />
					<input type="hidden" name="attr_ride_type" value="move-action" />
					<input type="hidden" class="ability-distance" data-i18n-placeholder="distance" name="attr_ride_distance" value="Self" />
					<input type="hidden" class="ability-target" data-i18n-placeholder="one-creature" name="attr_ride_target" value="Self" />
					<input type="hidden" class="ability-effect" data-i18n-placeholder="effect" name="attr_ride_effect" value="A creature can take the Ride move action only while mounted on another creature. When a creature takes the Ride move action, they cause their mount to move up to the mount’s speed, taking the rider with them. Alternatively, a creature can use the Ride move action to have their mount use the Disengage move action as a free triggered action. A creature can use the Ride move action only once per round. A mounted creature can only have this move action applied to them once per round. This movement can be broken with the rider’s maneuver and main action however they wish." />
					
					<div class="ability-card card-display">
						<button type="action" class="ability-share-button" data-i18n-title="ability-share" name="act_ride_share">
							<!-- speech balloon -->
							&#128172;
						</button>
						<span class="ability-name" name="attr_ride_name"></span>
						<div class="ability-details">
							<span class="ability-keywords" name="attr_ride_keywords"></span>
							<span class="ability-type" data-i18n="move-action"></span>
							<span class="ability-distance" name="attr_ride_distance" ></span>
							<span class="ability-target" name="attr_ride_target" ></span>
							<span class="ability-effect" name="attr_ride_effect"></span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Inventory Panel -->
	<div class="sheet-panel inventory-panel minimizable panel-dark">
		<div class="minimize-control">
			<input id="inventory-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="inventory-minimize-checkbox" data-i18n="inventory"></label>
		</div>
		<!-- Trinkets -->
		<div class="sheet-panel-box trinket-panel">
			<h5 class="panel-title" data-i18n="trinkets"></h5>
			<fieldset class="repeating_trinkets">
				<input class="name-input" type="text" name="attr_trinket_name" />
				<textarea name="attr_trinket_description"></textarea>
			</fieldset>
		</div>
		<!-- Consumables -->
		<div class="sheet-panel-box consumable-panel">
			<h5 class="panel-title" data-i18n="consumables"></h5>
			<fieldset class="repeating_consumables">
				<input class="name-input" type="text" name="attr_consumable_name" />
				<textarea name="attr_consumable_description"></textarea>
			</fieldset>
		</div>
		<!-- Leveled Treasures -->
		<div class="sheet-panel-box level-treasure-panel">
			<h5 class="panel-title" data-i18n="level-treasure"></h5>
			<div class="carry-checks">
				<span class="carry-label" data-i18n="carry-three-safely">carry three safely:</span>
				<label><input type="checkbox" name="attr_carry_1" /></label>
				<label><input type="checkbox" name="attr_carry_2" /></label>
				<label><input type="checkbox" name="attr_carry_3" /></label>
			</div>
			<fieldset class="repeating_leveltreasure">
				<input class="name-input" type="text" name="attr_leveltreasure_name" />
				<textarea name="attr_leveltreasure_description"></textarea>
			</fieldset>
		</div>
	</div>
	<!-- Projects Panel -->
	<div class="sheet-panel projects-panel minimizable panel-dark">
		<div class="minimize-control">
			<input id="projects-minimize-checkbox" class="minimize" type="checkbox" checked />
			<label for="projects-minimize-checkbox" data-i18n="projects"></label>
		</div>
		<fieldset class="repeating_projects">
			<input type="text" data-i18n-placeholder="project-name" name="attr_project_name" />
			<input type="text" data-i18n-placeholder="assigned-hero-follower" name="attr_project_assigned" />
			<input type="text" data-i18n-placeholder="characteristic" name="attr_project_characteristic" />
			<div class="project-goal-input-group">
				<input type="number" name="attr_project_goal" />
				/
				<input type="number" name="attr_project_goal_max" />
			</div>
		</fieldset>
	</div>
</div>
<!-- NPC Sheet View -->
<div class="npc-sheet-body">
	<label class="npc-edit-icon" for="npc-edit-toggle">p</label><input class="npc-edit-toggle" type="checkbox" id="npc-edit-toggle" />
	<!-- NPC Edit Form -->
	<div class="npc-edit">
		<div class="npc-edit-group npc-edit-text">
			<label data-i18n="character-name" for="attr_character_name"></label>
			<input type="text" id="attr_character_name" name="attr_character_name" />
			<label data-i18n="level" for="attr_level"></label>
			<input type="text" id="attr_level" name="attr_level" />
			<label data-i18n="npc-role" for="attr_npc_role"></label>
			<input type="text" id="attr_npc_role" name="attr_npc_role" />
			<label data-i18n="keywords" for="attr_npc_keywords"></label>
			<input type="text" id="attr_npc_keywords" name="attr_npc_keywords" />
			<label data-i18n="encounter-value-abbr" for="attr_npc_EV"></label>
			<input type="text" id="attr_npc_EV" name="attr_npc_EV" />
		</div>
		<div class="npc-edit-group npc-edit-stats">
			<label data-i18n="size" for="attr_size"></label>
			<input type="text" id="attr_size" name="attr_size" />
			<label data-i18n="speed" for="attr_speed"></label>
			<input type="number" id="attr_speed" name="attr_speed" />
			<label data-i18n="stamina" for="attr_stamina"></label>
			<input type="number" id="attr_stamina" name="attr_stamina" />
			<label data-i18n="stability" for="attr_stability"></label>
			<input type="number" id="attr_stability" name="attr_stability" />
			<label data-i18n="free-strike" for="attr_npc_freestrike"></label>
			<input type="number" id="attr_npc_freestrike" name="attr_npc_freestrike" />
		</div>
		<div class="npc-edit-group npc-edit-text">
			<label data-i18n="immunity" for="attr_immunity"></label>
			<input type="text" id="attr_immunity" name="attr_immunity" />
			<label data-i18n="weakness" for="attr_weakness"></label>
			<input type="text" id="attr_weakness" name="attr_weakness" />
			<label data-i18n="movement" for="attr_npc_movement"></label>
			<input type="text" id="attr_npc_movement" name="attr_npc_movement" />
			<label data-i18n="with-captain" for="attr_npc_with_captain"></label>
			<input type="text" id="attr_npc_with_captain" name="attr_npc_with_captain" />
		</div>
		<div class="npc-edit-group npc-edit-stats">
			<label data-i18n="might" for="attr_might"></label>
			<input type="number" id="attr_might" name="attr_might" />
			<label data-i18n="agility" for="attr_agility"></label>
			<input type="number" id="attr_agility" name="attr_agility" />
			<label data-i18n="reason" for="attr_reason"></label>
			<input type="number" id="attr_reason" name="attr_reason" />
			<label data-i18n="intuition" for="attr_intuition"></label>
			<input type="number" id="attr_intuition" name="attr_intuition" />
			<label data-i18n="presence" for="attr_presence"></label>
			<input type="number" id="attr_presence" name="attr_presence" />
		</div>
		
	</div>
	<!-- NPC Display -->
	<div class="npc-display">
		<div class="npc-header-panel npc-panel">
			<div class="npc-name"><span name="attr_character_name"></span></div>
			<div class="npc-level"><span data-i18n="level"></span>&nbsp;<span name="attr_level"></span>&nbsp;<span name="attr_npc_role"></span></div>
			<div><span name="attr_npc_keywords"></span></div>
			<div><span data-i18n="encounter-value-abbr"></span>&nbsp;<span name="attr_npc_EV"></span></div>
		</div>
		<div class="npc-stats-panel npc-panel">
			<div class="npc-stat">
				<span name="attr_size"></span>
				<label class="sublabel" data-i18n="size"></label>
			</div>
			<div class="npc-stat">
				<span name="attr_speed"></span>
				<label class="sublabel" data-i18n="speed"></label>
			</div>
			<div class="npc-stat">
				<span name="attr_stamina"></span>
				<label class="sublabel" data-i18n="stamina"></label>
			</div>
			<div class="npc-stat">
				<span name="attr_stability"></span>
				<label class="sublabel" data-i18n="stability"></label>
			</div>
			<div class="npc-stat">
				<span name="attr_npc_freestrike"></span>
				<label class="sublabel" data-i18n="free-strike"></label>
			</div>
		</div>
		<div class="npc-skills-panel npc-panel" >
				<div>
					<label data-i18n="immunity"></label>:
					<span name="attr_immunity"></span>
				</div>
				<div>
					<label data-i18n="weakness"></label>:
					<span name="attr_weakness"></span>
				</div>
				<div>
					<label data-i18n="movement"></label>:
					<span name="attr_npc_movement"></span>
				</div>
				<div>
					<label data-i18n="with-captain"></label>:
					<span name="attr_npc_with_captain"></span>
				</div>
		</div>
		<div class="npc-marip-panel npc-panel">
			<div class="npc-characteristic-input-group">
				<label data-characteristic="might" data-i18n="might"></label>
				<span name="attr_might"></span>
			</div>
			<div class="npc-characteristic-input-group">
				<label data-characteristic="agility" data-i18n="agility"></label>
				<span name="attr_agility"></span>
			</div>
			<div class="npc-characteristic-input-group">
				<label data-characteristic="reason" data-i18n="reason"></label>
				<span name="attr_reason"></span>
			</div>
			<div class="npc-characteristic-input-group">
				<label data-characteristic="intuition" data-i18n="intuition"></label>
				<span name="attr_intuition"></span>
			</div>
			<div class="npc-characteristic-input-group">
				<label data-characteristic="presence" data-i18n="presence"></label>
				<span name="attr_presence"></span>
			</div>
		</div>
	</div>
	<div class="npc-conditions npc-panel">
		<h5 class="panel-title" data-i18n="conditions"></h5>
		<fieldset class="repeating_conditions">
			<input type="text" name="attr_condition_name" data-i18n-placeholder="condition" />
			<div>
				<input type="radio" name="attr_end" value="eot" />
				<label data-i18n="eot"></label>
			</div>
			<div>
				<input type="radio" name="attr_end" value="save-ends" />
				<label data-i18n="save-ends"></label>
			</div>
		</fieldset>
	</div>
	<!-- NPC Abilities -->
	<div class="npc-abilities-panel">
		<fieldset class="repeating_npcabilities">
			<input class="ability-edit" type="checkbox" id="ability-edit" />
			<div class="npc-ability-card card-edit">
				<input type="text" class="npc-ability-name" data-i18n-placeholder="ability-name" name="attr_ability_name" />
				<select class="npc-ability-subtype-selector" name="attr_ability_subtype">
					<option value="normal-ability" selected data-i18n="normal-ability"></option>
					<option value="signature-ability" data-i18n="signature-ability"></option>
					<option value="villain-ability" data-i18n="villain-ability"></option>
					<option value="solo-monster" data-i18n="solo-monster"></option>
					<option value="trait" data-i18n="trait"></option>
					<option value="malice-ability" data-i18n="malice-ability"></option>
					<option value="malice-trait" data-i18n="malice-trait"></option>
				</select>
				
				<div class="npc-ability-solo-monster grid-span-full">
					<label><span data-i18n="solo-monster-entry-title"></span>&nbsp;1</label>
					<input type="text" name="attr_ability_solo_1_name" />
					<textarea class="grid-span-full" data-i18n-placeholder="solo-monster-entry-text" name="attr_ability_solo_1_text" spellcheck="false"></textarea>
					<label><span data-i18n="solo-monster-entry-title"></span>&nbsp;2</label>
					<input type="text" name="attr_ability_solo_2_name" />
					<textarea class="grid-span-full" data-i18n-placeholder="solo-monster-entry-text" name="attr_ability_solo_2_text" spellcheck="false"></textarea>
				</div>
				
				<div class="npc-ability-malice-cost grid-span-full">
					<label><span data-i18n="malice-cost"></span>:</label>
					<input type="number" placeholder="3" name="attr_ability_malice_cost" />
				</div>

				<textarea class="npc-ability-trait grid-span-full" data-i18n-placeholder="trait" name="attr_ability_trait"></textarea>
				
				<div class="npc-ability-details grid-span-full">
					<input type="text" class="npc-ability-keywords" data-i18n-placeholder="keywords" name="attr_ability_keywords" />
					<select class="npc-ability-type" name="attr_ability_type">
						<option value="no-action" selected data-i18n="no-action"></option>
						<option value="main-action" data-i18n="main-action"></option>
						<option value="maneuver" data-i18n="maneuver"></option>
						<option value="free-maneuver" data-i18n="free-maneuver"></option>
						<option value="move-action" data-i18n="move-action"></option>
						<option value="triggered-action" data-i18n="triggered-action"></option>
						<option value="free-triggered-action" data-i18n="free-triggered-action"></option>
					</select>
					<input type="text" class="npc-ability-distance" data-i18n-placeholder="distance" name="attr_ability_distance" />
					<input type="text" class="npc-ability-target" data-i18n-placeholder="target" name="attr_ability_target" />
					<textarea class="npc-ability-trigger triggered-show grid-span-full" data-i18n-placeholder="trigger" name="attr_ability_trigger" spellcheck="false"></textarea>
					<div class="npc-power-roll">
						<div class="npc-power-roll-mods">
							<input type="checkbox" name="attr_has_power_roll" />
							<label data-i18n="power-roll"></label>
							<span>+</span>
							<input type="text" class="npc-power-roll-characteristic" name="attr_ability_characteristic" />
						</div>
						<label class="sublabel">≤ 11</label>
						<input type="text" class="npc-power-roll-tier-effect" name="attr_ability_tier_1" />
						<label class="sublabel">12-16</label>
						<input type="text" class="npc-power-roll-tier-effect" name="attr_ability_tier_2" />
						<label class="sublabel">17+</label>
						<input type="text" class="npc-power-roll-tier-effect" name="attr_ability_tier_3" />
					</div>
					<div class="ability-toggle-group">
						<input type="checkbox" name="attr_has_effect" />
						<label data-i18n="effect"></label>
						<textarea class="ability-effect" data-i18n-placeholder="effect" name="attr_ability_effect" spellcheck="false"></textarea>
					</div>
					<div class="ability-toggle-group">
						<input type="checkbox" name="attr_has_special" />
						<label data-i18n="special"></label>						
						<textarea class="ability-special" data-i18n-placeholder="special" name="attr_ability_special" spellcheck="false"></textarea>
					</div>
					<div class="ability-toggle-group">
						<input type="checkbox" name="attr_has_malice" />
						<label data-i18n="malice"></label>
						<div class="grid-span-full">
							<label data-i18n="malice-cost"></label>
							<input type="text" name="attr_ability_cost" />
						</div>
						<textarea class="ability-malice" data-i18n-placeholder="malice" name="attr_ability_malice" spellcheck="false"></textarea>
					</div>
				</div>			
			</div>
			<div class="npc-ability-card card-display">
				<button class="ability-share-button" type="action" data-i18n-title="ability-share" name="act_share">
					<!-- speech balloon -->
					&#128172;
				</button>
				<span class="npc-ability-name" name="attr_ability_name"></span>
				<input id="npc-ability-subtype-selector" type="hidden" name="attr_ability_subtype" />
				<div class="npc-ability-subtype malice-show">
					<span name="attr_ability_malice_cost"></span>&nbsp;<span data-i18n="malice"></span>
				</div>
				<span class="npc-ability-subtype subtype-hide" name="attr_ability_subtype" data-i18n-dynamic></span>
				<span class="trait-show grid-span-full" name="attr_ability_trait"></span>
				
				<div class="solo-monster-show grid-span-full">
					<div>
						<label><span name="attr_ability_solo_1_name"></span>:</label><span name="attr_ability_solo_1_text"></span>
					</div>
					<div>
						<label><span name="attr_ability_solo_2_name"></span>:</label><span name="attr_ability_solo_2_text"></span>
					</div>
				</div>
				
				<div class="npc-ability-details details-hide grid-span-full">
					<input type="hidden" name="attr_ability_type" />
					<span class="npc-ability-keywords" name="attr_ability_keywords"></span>
					<div class="npc-ability-type"><span name="attr_ability_type" data-i18n-dynamic></span></div>
						
					<div class="npc-ability-distance">&#128208;<span name="attr_ability_distance" ></span></div>
					<div class="npc-ability-target">&#127919;<span name="attr_ability_target" ></span></div>
					<div class="npc-ability-trigger grid-span-full">
						<label><span data-i18n="trigger"></span>:</label>
						<span name="attr_ability_trigger"></span>
					</div>
				</div>
				<input type="hidden" name="attr_has_power_roll" />
				<div class="npc-power-roll">
					<div class="npc-power-roll-mods">
						<button type="roll" data-i18n-title="power-roll-button-tooltip" value="@{wtype} &{template:abilitypowerroll} {{roll=[[ [[2d10cs>11cf<0]][2d10]  + [[@{ability_characteristic}]] ]]}} {{name=@{ability_name}}} {{charactername=@{character_name}}}"></button>
						<label>2d10</label>
						<span>+</span>
						<span class="power-roll-characteristic" name="attr_ability_characteristic" ></span>
					</div>
					<label class="sublabel">≤ 11</label>
					<span class="npc-power-roll-tier-effect" name="attr_ability_tier_1" ></span>
					<label class="sublabel">12-16</label>
					<span class="npc-power-roll-tier-effect" name="attr_ability_tier_2" ></span>
					<label class="sublabel">17+</label>
					<span class="npc-power-roll-tier-effect" name="attr_ability_tier_3" ></span>
				</div>
				<input type="hidden" name="attr_has_special" />
				<div class="npc-ability-special grid-span-full">
					<label data-i18n="special"></label>:
					<span class="ability-special" name="attr_ability_special"></span>
				</div>
				<input type="hidden" name="attr_has_effect" />
				<div class="npc-ability-effect grid-span-full">
					<label data-i18n="effect"></label>:
					<span class="ability-effect" name="attr_ability_effect"></span>
				</div>
				<input type="hidden" name="attr_has_malice" />					
				<div class="npc-ability-malice grid-span-full">
					<label><span name="attr_ability_cost"></span>&nbsp;<span data-i18n="malice"></span>:</label>
					<span class="ability-malice" name="attr_ability_malice"></span>
				</div>
				
			</div>
		</fieldset>
	</div>
</div>
<!-- Disclaimer -->
<div class="disclaimer">
	<span data-i18n="disclaimer"></span>
</div>
<!-- Power Roll Roll Template and Ability Template combined -->
<rolltemplate class="sheet-rolltemplate-powerrollability">
	<div class="sheet-roll-container">
		<div class="character-name">
			{{charactername}}
		</div>
		<div class="header">
			{{name}}
		</div>
		<div class="subtype">
			{{subtype}}
		</div>
		<div class="section">
			{{#description}}
			<div class="description">
				{{description}}
			</div>
			{{/description}}
			{{#rollTotal() hasTrait 1}}
			<div class="trait">
				{{trait}}
			</div>
			{{/rollTotal() hasTrait 1}}
			{{#rollTotal() hasSolo 1}}
			<div class="effect-block">
				<div class="effect-label">{{solo1name}}</span>:</div>
				<div class="effect-text">{{solo1text}}</div>
			</div>
			<div class="effect-block">
				<div class="effect-label">{{solo2name}}</span>:</div>
				<div class="effect-text">{{solo2text}}</div>
			</div>
			{{/rollTotal() hasSolo 1}}
		</div>
		<div class="meta-row">
			<div class="keywords">{{keywords}}</div>
			<div class="action-type">{{type}}</div>
		</div>
		<div class="action-row">
			<div class="distance">
			{{#distance}}
				<!-- triangle-ruler -->
				&#128208;{{distance}}
				{{/distance}}
			</div>
			<div class="target">
				{{#target}}
				<!-- bullseye -->
					&#127919;{{target}}
				{{/target}}
			</div>
		</div>
		{{#rollTotal() hasTrigger 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="trigger"></span>:</div>
			<div class="effect-text">{{trigger}}</div>
		</div>
		{{/rollTotal() hasTrigger 1}}
		{{#rollTotal() hasPowerRoll 1}}
		<div class="stat-row">
			<div class="roll-label">{{powerRoll}}:</div>
			<span class="roll-formula">2d10 + {{characteristic}}</span>
		</div>
		<div class="roll-column1">
			<div class="powerroll-2d10">
				<label>2d10:</label> {{2d10}}
			</div>
			<div class="powerroll-characteristic">
				<label><span data-i18n="{{characteristic}}"></span>:</label> {{characteristicValue}}
			</div>
		</div>
		{{#rollTotal() computed::isDoubleEdge 1}}
		<div class="powerroll-edge-bane" data-i18n="double-edge"></div>
		{{/rollTotal() computed::isDoubleEdge 1}}
		{{#rollGreater() edgeBane 0}}
		<div class="powerroll-edge-bane" data-i18n="edge"></div>
		{{/rollGreater() edgeBane 0}}
		{{#rollLess() edgeBane 0}}
		<div class="powerroll-edge-bane" data-i18n="bane"></div>
		{{/rollLess() edgeBane 0}}
		{{#rollTotal() computed::isDoubleBane 1}}
		<div class="powerroll-edge-bane" data-i18n="double-bane"></div>
		{{/rollTotal() computed::isDoubleBane 1}}
		{{#rollGreater() bonus 0}}
		<div class="powerroll-bonus-penalty">
			<label><span data-i18n="bonus"></span>:</label> {{bonus}}
		</div>
		{{/rollGreater() bonus 0}}
		{{#rollLess() bonus 0}}
		<div class="powerroll-bonus-penalty">
			<label><span data-i18n="penalty"></span>:</label> {{bonus}}
		</div>
		{{/rollLess() bonus 0}}
		{{#rollGreater() 2d10 18}}
			<div class="powerroll-crit" data-i18n="critical-hit"></div>
		{{/rollGreater() 2d10 18}}
		<div class="roll-column2">
			<div class="powerroll-total">
				<label><span data-i18n="power-roll-total"></span>:</label> {{total}}
			</div>
			<div class="powerroll-tier">
				<label><span data-i18n="tier"></span>:</label> {{computed::tier}}
			</div>
		</div>
		<div class="tiers">
			<span class="range">≤ 11</span>
			<span class="damage">{{tier1}}</span>
			<span class="range">12–16</span>
			<span class="damage">{{tier2}}</span>
			<span class="range">17+</span>
			<span class="damage">{{tier3}}</span>
		</div>
		{{/rollTotal() hasPowerRoll 1}}
		{{#rollTotal() hasSpecial 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="special"></span>:</div>
			<div class="effect-text">{{special}}</div>
		</div>
		{{/rollTotal() hasSpecial 1}}
		{{#rollTotal() hasEffect 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="effect"></span>:</div>
			<div class="effect-text">{{effect}}</div>
		</div>
		{{/rollTotal() hasEffect 1}}
		{{#rollTotal() hasMalprop 1}}
		<div class="effect-block">
			<div class="effect-label">{{malpropcost}}&nbsp;<span data-i18n="malice"></span>:</div>
			<div class="effect-text">{{malprop}}</div>
		</div>
		{{/rollTotal() hasMalprop 1}}
	</div>
</rolltemplate>
<!-- Power Roll Roll Template -->
<rolltemplate class="sheet-rolltemplate-powerroll">
	<div class="sheet-roll-container">
		<div class="character-name">
			{{charactername}}
		</div>
		<div class="header">
			{{name}}
		</div>
		<div class="powerroll-2d10">
			<label>2d10:</label> {{2d10}}
		</div>
		<div class="powerroll-characteristic">
			<label><span data-i18n="{{characteristic}}"></span>:</label> {{characteristicValue}}
		</div>
		{{#rollTotal() computed::isDoubleEdge 1}}
		<div class="powerroll-edge-bane" data-i18n="double-edge"></div>
		{{/rollTotal() computed::isDoubleEdge 1}}
		{{#rollGreater() edgeBane 0}}
		<div class="powerroll-edge-bane" data-i18n="edge"></div>
		{{/rollGreater() edgeBane 0}}
		{{#rollLess() edgeBane 0}}
		<div class="powerroll-edge-bane" data-i18n="bane"></div>
		{{/rollLess() edgeBane 0}}
		{{#rollTotal() computed::isDoubleBane 1}}
		<div class="powerroll-edge-bane" data-i18n="double-bane"></div>
		{{/rollTotal() computed::isDoubleBane 1}}
		{{#rollGreater() bonus 0}}
		<div class="powerroll-bonus-penalty">
			<label><span data-i18n="bonus"></span>:</label> {{bonus}}
		</div>
		{{/rollGreater() bonus 0}}
		{{#rollLess() bonus 0}}
		<div class="powerroll-bonus-penalty">
			<label><span data-i18n="penalty"></span>:</label> {{bonus}}
		</div>
		{{/rollLess() bonus 0}}
		{{#rollGreater() 2d10 18}}
			<div class="powerroll-crit" data-i18n="critical-hit"></div>
		{{/rollGreater() 2d10 18}}
		<div class="powerroll-total">
			<label><span data-i18n="power-roll-total"></span>:</label> {{total}}
		</div>
		<div class="powerroll-tier">
			<label><span data-i18n="tier"></span>:</label> {{computed::tier}}
		</div>
	</div>
</rolltemplate>
<!-- Ability Roll Template -->
<rolltemplate class="sheet-rolltemplate-ability">
	<div class="sheet-roll-container">
		<div class="header">{{name}}</div>
		<div class="description">{{description}}</div>
		<div class="meta-row">
			<div class="keywords">{{keywords}}</div>
			<div class="action-type">{{type}}</div>
		</div>
		<div class="action-row">
			{{#rollTotal() hasDistance 1}}
			<div class="distance">
				<!-- triangle-ruler -->
					&#128208;{{distance}}
			</div>
			{{/rollTotal() hasDistance 1}}
			{{#rollTotal() hasTarget 1}}
			<div class="target">
				<!-- bullseye -->
					&#127919;{{target}}
			</div>
			{{/rollTotal() hasTarget 1}}
		</div>
		{{#rollTotal() hasTrigger 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="trigger"></span>:</div>
			<div class="effect-text">{{trigger}}</div>
		</div>
		{{/rollTotal() hasTrigger 1}}
		{{#rollTotal() hasPowerRoll 1}}
		<div class="stat-row">
			<div class="roll-label">{{powerRoll}}:</div>
			<span class="roll-formula">2d10 + {{characteristic}}</span>
		</div>
		<div class="tiers">
			<div class="tier">
				<span class="range">≤ 11</span>
				<span class="damage">{{tier1}}</span>
			</div>
			<div class="tier">
				<span class="range">12–16</span>
				<span class="damage">{{tier2}}</span>
			</div>
			<div class="tier">
				<span class="range">17+</span>
				<span class="damage">{{tier3}}</span>
			</div>
		</div>
		{{/rollTotal() hasPowerRoll 1}}
		{{#rollTotal() hasEffect 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="effect"></span>:</div>
			<div class="effect-text">{{effect}}</div>
		</div>
		{{/rollTotal() hasEffect 1}}
	</div>
</rolltemplate>
<!-- Monster Ability Roll Template -->
<rolltemplate class="sheet-rolltemplate-monsterability">
	<div class="sheet-roll-container">
		<div class="character-name">
			{{charactername}}
		</div>
		<div class="header">
			{{name}}
		</div>
		<div class="subtype">
			{{subtype}}
		</div>
		<div class="section">
			{{#description}}
			<div class="description">
				{{description}}
			</div>
			{{/description}}
			{{#rollTotal() hasTrait 1}}
			<div class="trait">
				{{trait}}
			</div>
			{{/rollTotal() hasTrait 1}}
			{{#rollTotal() hasSolo 1}}
			<div class="effect-block">
				<div class="effect-label">{{solo1name}}</span>:</div>
				<div class="effect-text">{{solo1text}}</div>
			</div>
			<div class="effect-block">
				<div class="effect-label">{{solo2name}}</span>:</div>
				<div class="effect-text">{{solo2text}}</div>
			</div>
			{{/rollTotal() hasSolo 1}}
		</div>
		<div class="meta-row">
			<div class="keywords">{{keywords}}</div>
			<div class="action-type">{{type}}</div>
		</div>
		<div class="action-row">
			<div class="distance">
			{{#distance}}
				<!-- triangle-ruler -->
				&#128208;{{distance}}
				{{/distance}}
			</div>
			<div class="target">
				{{#target}}
				<!-- bullseye -->
					&#127919;{{target}}
				{{/target}}
			</div>
		</div>
		{{#rollTotal() hasTrigger 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="trigger"></span>:</div>
			<div class="effect-text">{{trigger}}</div>
		</div>
		{{/rollTotal() hasTrigger 1}}
		{{#rollTotal() hasPowerRoll 1}}
		<div class="stat-row">
			<div class="roll-label">{{powerRoll}}:</div>
			<span class="roll-formula">2d10 + {{characteristic}}</span>
		</div>
		<div class="tiers">
			<span class="range">≤ 11</span>
			<span class="damage">{{tier1}}</span>
			<span class="range">12–16</span>
			<span class="damage">{{tier2}}</span>
			<span class="range">17+</span>
			<span class="damage">{{tier3}}</span>
		</div>
		{{/rollTotal() hasPowerRoll 1}}
		{{#rollTotal() hasSpecial 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="special"></span>:</div>
			<div class="effect-text">{{special}}</div>
		</div>
		{{/rollTotal() hasSpecial 1}}
		{{#rollTotal() hasEffect 1}}
		<div class="effect-block">
			<div class="effect-label"><span data-i18n="effect"></span>:</div>
			<div class="effect-text">{{effect}}</div>
		</div>
		{{/rollTotal() hasEffect 1}}
		{{#rollTotal() hasMalprop 1}}
		<div class="effect-block">
			<div class="effect-label">{{malpropcost}}&nbsp;<span data-i18n="malice"></span>:</div>
			<div class="effect-text">{{malprop}}</div>
		</div>
		{{/rollTotal() hasMalprop 1}}
	</div>
</rolltemplate>
<!-- Ability Power Roll -->
<rolltemplate class="sheet-rolltemplate-abilitypowerroll">
	<div class="sheet-roll-container">
		<div class="character-name">{{charactername}}</div>
		<div class="header">
			{{name}}
		</div>
		<div class="powerroll-2d10">
			<label><span data-i18n="power-roll">:</label> {{roll}}
		</div>
		<div class="powerroll-tier">
			<label><span data-i18n="tier"></span>
			{{#rollLess() roll 12}}
			<span>1 (&le;11)</span>
			{{/rollLess() roll 12}}
			{{#rollBetween() roll 12 16}}
			<span>2 (12-16)</span>
			{{/rollBetween() roll 12 16}}
			{{#rollGreater() roll 16}}
			<span>3 (17+)</span>
			{{/rollGreater() roll 16}}
			</label>
		</div>
	</div>
</rolltemplate>
<!-- Sheet Workers -->
<script type="text/worker">
	function setActiveCharacterId(id) {
		const ocid = getActiveCharacterId();
		const data = {
			id: '0',
			type: 'setActiveCharacter',
			data: id,
		};
		if (self.dispatchEvent) {
			const event = new CustomEvent('message');
			event.data = data;
			self.dispatchEvent(event);
		}
		else {
			self.onmessage({ data });
		}
		return ocid;
	}
	function getAttrsAsync(props) {
		const acid = getActiveCharacterId();
		let ocid = null;
		return new Promise((resolve, reject) => {
			ocid = setActiveCharacterId(acid);
			try {
				getAttrs(props, (values) => resolve(values));
			}
			catch {
				reject();
			}
		}).finally(() => {
			setActiveCharacterId(ocid);
		});
	}
	function setAttrsAsync(props) {
		const acid = getActiveCharacterId();
		let ocid = null;
		return new Promise((resolve, reject) => {
			ocid = setActiveCharacterId(acid);
			try {
				setAttrs(props, undefined, (values) => resolve(values));
			}
			catch {
				reject();
			}
		}).finally(() => {
			setActiveCharacterId(ocid);
		});
	}
	function getSectionIDsAsync(sectionName) {
		const acid = getActiveCharacterId();
		let ocid = null;
		return new Promise((resolve, reject) => {
			ocid = setActiveCharacterId(acid);
			try {
				getSectionIDs(sectionName, (values) => resolve(values));
			}
			catch {
				reject();
			}
		}).finally(() => {
			setActiveCharacterId(ocid);
		});
	}

/**
**Tab switching in Ability Panel
**/

    const buttonlist = ["action", "maneuver", "triggered","noaction","move"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                abilitiesTab: button
            });
        });
    });

/**
** Power Roll
**/
	async function rollPower(characteristic, abilityName) {
		const attrs = await getAttrsAsync([characteristic]);
		const characteristicValue = attrs[characteristic];
		const characteristicTranslation = getTranslationByKey(characteristic) || characteristic;
		const powerRollTranslation = getTranslationByKey('power-roll') || 'Power Roll';
		const edgeOrBaneTranslation = getTranslationByKey('edge-or-bane') || 'edge-or-bane';
		const noEdgeOrBaneTranslation = getTranslationByKey('no-edge-or-bane') || 'no-edge-or-bane';
		const doubleEdgeTranslation = getTranslationByKey('double-edge') || 'double-edge';
		const edgeTranslation = getTranslationByKey('edge') || 'edge';
		const baneTranslation = getTranslationByKey('bane') || 'bane';
		const doubleBaneTranslation = getTranslationByKey('double-bane') || 'double-bane';
		const bonusOrPenaltyTranslation = getTranslationByKey('bonus-or-penalty') || 'bonus-or-penalty';
		const name = abilityName ? abilityName : characteristicTranslation + ` ` + powerRollTranslation;
		const roll = '&{template:powerroll} ' +
			'[[ [[2d10cs>11cf<0]][2d10] ' +
			` + [[${characteristicValue}[${characteristicTranslation}]]][${characteristicTranslation}] ` +
			' + [[?{' +
				edgeOrBaneTranslation +
				`|${noEdgeOrBaneTranslation},0` +
				`|${doubleEdgeTranslation},0[${doubleEdgeTranslation}]` +
				`|${edgeTranslation},2[${edgeTranslation}]` +
				`|${baneTranslation},-2[${baneTranslation}]` +
				`|${doubleBaneTranslation},0[${doubleBaneTranslation}]` +
				`}]][${edgeOrBaneTranslation}] ` +
				` + [[?{${bonusOrPenaltyTranslation}|0}]][${bonusOrPenaltyTranslation}] ` +
			']] ' +
			'{{2d10=$[[0]]}} ' +
			'{{characteristicValue=$[[1]]}} ' +
			'{{edgeBane=$[[2]]}} ' +
			'{{bonus=$[[3]]}} ' +
			'{{total=$[[4]]}} ' +
			`{{name=${name}}} ` +
			`{{characteristic=${characteristic}}} ` +
			`{{isDoubleEdge=[[0]]}} ` +
			`{{isDoubleBane=[[0]]}} ` +
			'{{tier=[[0]]}} ' +
			'{{charactername=@{character_name}}} ';
		console.log('roll', roll);
		startRoll(roll, ({ rollId, results }) => {
			console.log('roll results', results);
			const isDoubleEdge = results.edgeBane.expression === `0[${doubleEdgeTranslation}]`
				? 1 : 0;
			const isDoubleBane = results.edgeBane.expression === `0[${doubleBaneTranslation}]`
				? 1 : 0;
			const tierBase = (() => {
				if (results.total.result >= 17) {
					return 3;
				}
				return results.total.result >= 12
					? 2
					: 1;
			})();
			const tierMod = (() => {
				switch (results.edgeBane.expression) {
					case `0[${doubleEdgeTranslation}]`:
						return 1;
					case `0[${doubleBaneTranslation}]`:
						return -1;
					default:
						return 0;
				}
			})();
			const tier = Math.max(1, Math.min(3, tierBase + tierMod));
			finishRoll(rollId, { isDoubleEdge, isDoubleBane, tier });
		});
	}

/**
** Feature Display 
**/	

	function featureDisplay(name, subtitle, description) {
		const roll = `@{wtype}&{template:monsterability}` 
			+ '{{charactername=@{character_name}}} ' 
			+ '{{name=' + name + '}} ' 
			+ '{{trait=' + description + '}} '
			+ '{{subtype=' + subtitle + '}} '
			+ '{{hasTrait=[[1]]}}';
		console.log('Feature Display:', roll);
		startRoll(roll, ({ rollId }) => finishRoll(rollId));
	}

/**
** Build Ability Roll
   constructs and executes rolls using the ability sharing roll template
**/

	function buildAbilityRoll(directMap, rollValueMap) {
	
		const isDefined = (value) => {
			// Exclude null, undefined, and empty strings
			if (!value) return false;
			// Specifically exclude the string '0' (for things like ability_cost = 0)
			if (typeof value === 'string' && value.trim() === '0') return false;
			return true;
		};
		
		const roll = `@{wtype}&{template:monsterability} `
			+ '{{charactername=@{character_name}}} ' 
			+ '{{powerRoll=^{power-roll}}} '
			+ Object.entries(directMap)
				.filter(([key, value]) => isDefined(value))
				.map(([key, value]) => `{{${key}=${value}}} `)
				.join(' ')
			+ Object.entries(rollValueMap)
				.filter(([key, value]) => value === 1)
				.map(([key, value]) => `{{${key}=[[${value}]]}} `)
				.join(' ');
		startRoll(roll, ({ rollId }) => finishRoll(rollId));
		return roll;
	}

/**
** Build ability when there is a Power Roll
   constructs and executes rolls using the ability sharing roll template
**/

async function buildPowerRollAbility(characteristic, abilityName, directMap = {}, rollValueMap = {}) {
	const attrs = await getAttrsAsync([characteristic]);
	const characteristicValue = attrs[characteristic];

	// Translations
	const characteristicTranslation = getTranslationByKey(characteristic) || characteristic;
	const powerRollTranslation = getTranslationByKey('power-roll') || 'Power Roll';
	const edgeOrBaneTranslation = getTranslationByKey('edge-or-bane') || 'edge-or-bane';
	const noEdgeOrBaneTranslation = getTranslationByKey('no-edge-or-bane') || 'no-edge-or-bane';
	const doubleEdgeTranslation = getTranslationByKey('double-edge') || 'double-edge';
	const edgeTranslation = getTranslationByKey('edge') || 'edge';
	const baneTranslation = getTranslationByKey('bane') || 'bane';
	const doubleBaneTranslation = getTranslationByKey('double-bane') || 'double-bane';
	const bonusOrPenaltyTranslation = getTranslationByKey('bonus-or-penalty') || 'bonus-or-penalty';

	const name = abilityName || `${characteristicTranslation} ${powerRollTranslation}`;

	// Helper to exclude null/undefined/empty/"0"
	const isDefined = (value) => {
		if (!value) return false;
		if (typeof value === 'string' && value.trim() === '0') return false;
		return true;
	};

	// Build roll string
	const roll = `@{wtype}&{template:powerrollability} ` +
		'[[ [[2d10cs>11cf<0]][2d10] ' +
		` + [[${characteristicValue}[${characteristicTranslation}]]][${characteristicTranslation}] ` +
		' + [[?{' +
			edgeOrBaneTranslation +
			`|${noEdgeOrBaneTranslation},0` +
			`|${doubleEdgeTranslation},0[${doubleEdgeTranslation}]` +
			`|${edgeTranslation},2[${edgeTranslation}]` +
			`|${baneTranslation},-2[${baneTranslation}]` +
			`|${doubleBaneTranslation},0[${doubleBaneTranslation}]` +
			`}]][${edgeOrBaneTranslation}] ` +
			` + [[?{${bonusOrPenaltyTranslation}|0}]][${bonusOrPenaltyTranslation}] ` +
		']] '
		+ `{{charactername=@{character_name}}} `
		+ `{{name=${name}}} `
		+ `{{powerRoll=^{power-roll}}} `
		+ `{{characteristic=${characteristic}}} `
		+ `{{hasPowerRoll=[[1]]}} `
		+ `{{2d10=$[[0]]}} `
		+ `{{characteristicValue=$[[1]]}} `
		+ `{{edgeBane=$[[2]]}} `
		+ `{{bonus=$[[3]]}} `
		+ `{{total=$[[4]]}} `
		+ `{{isDoubleEdge=[[0]]}} `
		+ `{{isDoubleBane=[[0]]}} `
		+ `{{tier=[[0]]}} `
		+ Object.entries(directMap)
			.filter(([_, value]) => isDefined(value))
			.map(([key, value]) => `{{${key}=${value}}} `)
			.join(' ')
		+ Object.entries(rollValueMap)
			.filter(([_, value]) => value === 1)
			.map(([key]) => `{{${key}=[[1]]}} `)
			.join(' ');

	startRoll(roll, ({ rollId, results }) => {
		const isDoubleEdge = results.edgeBane.expression === `0[${doubleEdgeTranslation}]` ? 1 : 0;
		const isDoubleBane = results.edgeBane.expression === `0[${doubleBaneTranslation}]` ? 1 : 0;

		const tierBase = results.total.result >= 17 ? 3 : results.total.result >= 12 ? 2 : 1;
		const tierMod = (() => {
			switch (results.edgeBane.expression) {
				case `0[${doubleEdgeTranslation}]`: return 1;
				case `0[${doubleBaneTranslation}]`: return -1;
				default: return 0;
			}
		})();
		const tier = Math.max(1, Math.min(3, tierBase + tierMod));

		finishRoll(rollId, { isDoubleEdge, isDoubleBane, tier });
	});
}
	
/** 
** Ability Sharing Handler
**/

	async function handleAbilityShare(prefix, abilityPrefix) {
		// 1. Define all possible ability attributes across both player and NPC sections.
		const allAbilityAttributeNames = [
			'name', 'cost', 'description', 'keywords',
			'type', 'distance', 'target', 'trigger',
			'characteristic', 'tier_1', 'tier_2', 'tier_3', 'effect',
			'subtype', 'malice_cost', 'trait',
			'solo_1_name', 'solo_1_text', 'solo_2_name', 'solo_2_text',
			'special', 'malice',
		];
		
		const allAbilityToggles = [
			'has_power_roll', 'has_effect', 'has_special', 'has_malice',
		];
		
		abPrefix = abilityPrefix ? `${abilityPrefix}_` : '';
		
		// 2. Define the character-level attributes needed for both.
		const globalAttrsToGet = prefix === 'repeating_npcabilities'
			? [] // Monster abilities need nothing
			: ['resource_name']; // Player abilities need resource_name
			
		// 3. Construct the full list of attributes to fetch.
		const attrsToFetch = [
			...globalAttrsToGet,
			...allAbilityAttributeNames.map(x => `${prefix}_${abPrefix}${x}`),
			...allAbilityToggles.map(x => `${prefix}_${x}`),
		];
		
		const attrs = await getAttrsAsync(attrsToFetch);
		
		// 4. Execute the custom logic (player or monster specific)
		const { directMap, rollValueMap } = getAbilityMaps(attrs, prefix, abPrefix);
		
		// 5. Call the shared roll function
		const roll = buildAbilityRoll(directMap, rollValueMap);

		console.log(`${prefix}_${abilityPrefix}:`, roll);
	}

	async function handleAbilitySharePowerRoll(prefix, abilityPrefix,characteristic, abilityName) {
		// 1. Define all possible ability attributes across both player and NPC sections.
		const allAbilityAttributeNames = [
			'name', 'cost', 'description', 'keywords',
			'type', 'distance', 'target', 'trigger',
			'characteristic', 'tier_1', 'tier_2', 'tier_3', 'effect',
			'subtype', 'malice_cost', 'trait',
			'solo_1_name', 'solo_1_text', 'solo_2_name', 'solo_2_text',
			'special', 'malice',
		];
		
		const allAbilityToggles = [
			'has_power_roll', 'has_effect', 'has_special', 'has_malice',
		];
		
		abPrefix = abilityPrefix ? `${abilityPrefix}_` : '';
		
		// 2. Define the character-level attributes needed for both.
		const globalAttrsToGet = prefix === 'repeating_npcabilities'
			? [] // Monster abilities need nothing
			: ['resource_name']; // Player abilities need resource_name
			
		// 3. Construct the full list of attributes to fetch.
		const attrsToFetch = [
			...globalAttrsToGet,
			...allAbilityAttributeNames.map(x => `${prefix}_${abPrefix}${x}`),
			...allAbilityToggles.map(x => `${prefix}_${x}`),
		];
		
		const attrs = await getAttrsAsync(attrsToFetch);
		
		// 4. Execute the custom logic (player or monster specific)
		const { directMap, rollValueMap } = getAbilityMaps(attrs, prefix, abPrefix);
		
		// 5. Call the shared roll function
		const roll = buildPowerRollAbility(characteristic, abilityName,directMap, rollValueMap);

		console.log(`${prefix}_${abilityPrefix}:`, roll);
	}

	// Function builds the maps specific to player and NPC abilities.
	function getAbilityMaps(attrs, prefix, abilityPrefix) {
		let directMap = {};
		let rollValueMap = {};
		let translateMap = {};
		let subtype = '';
		let trait = '';
		let hasTrait = 0;
		let characteristic = '';
		let description = '';
		
		if (prefix === 'repeating_npcabilities') {
			// NPC Ability Logic
			switch(attrs[`${prefix}_${abilityPrefix}subtype`]) {
				case 'signature-ability':
				case 'villain-ability':
					subtype = getTranslationByKey(attrs[`${prefix}_${abilityPrefix}subtype`]) || '';
					break;
				case 'malice-ability':
				case 'malice-trait':
					subtype = attrs[`${prefix}_${abilityPrefix}malice_cost`] + ' ' + getTranslationByKey('malice');
					break;
			}
			characteristic = attrs[`${prefix}_${abilityPrefix}characteristic`] || '';
			trait = attrs[`${prefix}_${abilityPrefix}trait`] || '';
			hasTrait = attrs[`${prefix}_${abilityPrefix}subtype`].includes('trait') && trait ? 1 : 0;
			hasEffect = attrs[`${prefix}_has_effect`] === 'on' ? 1 : 0;
		} else {
			// PLAYER Ability Logic
			const resourceName = attrs.resource_name || getTranslationByKey('resource-name-placeholder');
			const cost = attrs[`${prefix}_${abilityPrefix}cost`];
			subtype = cost && cost !== '0' ? `(${cost} ${resourceName})` : '';
			characteristic = attrs[`${prefix}_${abilityPrefix}characteristic`] ? getTranslationByKey(attrs[`${prefix}_${abilityPrefix}characteristic`]) || '' : '';
			description = attrs[`${prefix}_${abilityPrefix}description`] || '';
			hasTrait = 1;
			hasEffect = attrs[`${prefix}_${abilityPrefix}effect`] ? 1 : 0;
		}
		

		const type = attrs[`${prefix}_${abilityPrefix}type`] === 'no-action' ? '' : getTranslationByKey(attrs[`${prefix}_${abilityPrefix}type`]);
		
		// Build the directMap - these will be transformed into a {{key=value}} format.
		directMap = {
			name: attrs[`${prefix}_${abilityPrefix}name`],
			subtype: subtype,
			trait: trait,
			description: description,
			type: type, 
			keywords: attrs[`${prefix}_${abilityPrefix}keywords`] || '',
			distance: attrs[`${prefix}_${abilityPrefix}distance`] || '',
			target: attrs[`${prefix}_${abilityPrefix}target`] || '',
			trigger: attrs[`${prefix}_${abilityPrefix}trigger`] || '',
			characteristic: characteristic,
			tier1: attrs[`${prefix}_${abilityPrefix}tier_1`] || '',
			tier2: attrs[`${prefix}_${abilityPrefix}tier_2`] || '',
			tier3: attrs[`${prefix}_${abilityPrefix}tier_3`] || '',
			special: attrs[`${prefix}_${abilityPrefix}special`] || '',
			effect: attrs[`${prefix}_${abilityPrefix}effect`] || '',
			malprop: attrs[`${prefix}_${abilityPrefix}malice`] || '',
			malpropcost: attrs[`${prefix}_${abilityPrefix}cost`] || '',
			solo1name: attrs[`${prefix}_${abilityPrefix}solo_1_name`] || '',
			solo1text: attrs[`${prefix}_${abilityPrefix}solo_1_text`] || '',
			solo2name: attrs[`${prefix}_${abilityPrefix}solo_2_name`] || '',
			solo2text: attrs[`${prefix}_${abilityPrefix}solo_2_text`] || '',
		}	

		//Build the rollValueMap - these will be transformed into a {{key=[[value]]}} format.
		rollValueMap = {
			hasTrait: hasTrait,
			hasSolo: attrs[`${prefix}_${abilityPrefix}subtype`] && attrs[`${prefix}_${abilityPrefix}subtype`].includes('solo') ? 1 : 0,
			hasTrigger: attrs[`${prefix}_${abilityPrefix}type`].includes('triggered') && attrs[`${prefix}_${abilityPrefix}trigger`] ? 1 : 0,
			hasPowerRoll: attrs[`${prefix}_has_power_roll`] === 'on' ? 1 : 0,
			hasSpecial: attrs[`${prefix}_has_special`] === 'on' ? 1 : 0,
			hasEffect: hasEffect,
			hasMalprop: attrs[`${prefix}_has_malice`] === 'on' ? 1 : 0,
		};

		return { directMap, rollValueMap };
	}

/**
**Repeated Maneuvers display
**/
	on('clicked:repeating_maneuvers:share', async (event) => {
		handleAbilityShare('repeating_maneuvers', 'maneuver');
	});

/**
**Repeated Triggered display
**/
	on('clicked:repeating_triggered:share', async (event) => {
		handleAbilityShare('repeating_triggered', 'triggered');
	});

/**
**Repeated No Action display
**/
	on('clicked:repeating_noaction:share', async (event) => {
		handleAbilityShare('repeating_noaction', 'noaction');
	});

/**
**Repeated Moves display
**/
	on('clicked:repeating_moves:share', async (event) => {
		handleAbilityShare('repeating_moves', 'moves');
	});

/**
**Repeated Moves Power Roll
**/
	on('clicked:repeating_moves:power-roll-share', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_moves_moves_name',
			'repeating_moves_moves_characteristic',
		]);
		handleAbilitySharePowerRoll('repeating_moves', 'moves',attrs.repeating_moves_moves_characteristic, attrs.repeating_moves_moves_name);
	});

/**
**Repeated Maneuvers power roll
**/
	on('clicked:repeating_maneuvers:power-roll-share', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_maneuvers_maneuver_name',
			'repeating_maneuvers_maneuver_characteristic',
		]);
		handleAbilitySharePowerRoll('repeating_maneuvers', 'maneuver',attrs.repeating_maneuvers_maneuver_characteristic, attrs.repeating_maneuvers_maneuver_name);
	});

/**
**Repeated Triggered power roll
**/
	on('clicked:repeating_triggered:power-roll-share', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_triggered_triggered_name',
			'repeating_triggered_triggered_characteristic',
		]);
		handleAbilitySharePowerRoll('repeating_triggered', 'triggered',attrs.repeating_triggered_triggered_characteristic, attrs.repeating_triggered_triggered_name);
	});

/**
**Repeated No Action power roll
**/
	on('clicked:repeating_noaction:power-roll-share', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_noaction_noaction_name',
			'repeating_noaction_noaction_characteristic',
		]);
		handleAbilitySharePowerRoll('repeating_noaction', 'noaction',attrs.repeating_noaction_noaction_characteristic, attrs.repeating_noaction_noaction_name);
	});

/**
**Knockback Display
**/
	on('clicked:knockback_share', async (event) => {
		handleAbilityShare('knockback', '');
	});

/**
**Grab Display
**/
	on('clicked:grab_share', async (event) => {
		handleAbilityShare('grab', '');
	});

/**
**Escape Grab Display
**/
	on('clicked:escape_grab_share', async (event) => {
		handleAbilityShare('escape_grab', '');
	});

/**
** Escape Grab Power Roll
**/
	on('clicked:escape_grab_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'escape_grab_name',
			'escape_grab_characteristic',
		]);
		handleAbilitySharePowerRoll('escape_grab', '',attrs.escape_grab_characteristic, attrs.escape_grab_name);
	});
	
/**
**Claw Dirt Display
**/
	on('clicked:claw_dirt_share', async (event) => {
		handleAbilityShare('claw_dirt', '');
	});

/**
**Advance Display
**/
	on('clicked:advance_share', async (event) => {
		handleAbilityShare('advance', '');
	});

/**
**Disengage Display
**/
	on('clicked:disengage_share', async (event) => {
		handleAbilityShare('disengage', '');
	});

/**
**Ride Display
**/
	on('clicked:ride_share', async (event) => {
		handleAbilityShare('ride', '');
	});

/**
**Jump Display
**/
	on('clicked:jump_share', async (event) => {
		handleAbilityShare('jump', '');
	});

/**
**Climb Other Creatures Display
**/
	on('clicked:climb_creature_share', async (event) => {
		handleAbilityShare('climb_creature', '');
	});

/**
**Charge Display
**/
	on('clicked:charge_share', async (event) => {
		handleAbilityShare('charge', '');
	});

/**
**Defend Display
**/
	on('clicked:defend_share', async (event) => {
		handleAbilityShare('defend', '');
	});

/**
**Heal Display
**/
	on('clicked:heal_share', async (event) => {
		handleAbilityShare('heal', '');
	});

/**
**Aid Attack Display
**/
	on('clicked:aid_attack_share', async (event) => {
		handleAbilityShare('aid_attack', '');
	});

/**
**Catch Breath Display
**/
	on('clicked:catch_breath_share', async (event) => {
		handleAbilityShare('catch_breath', '');
	});

/**
**Hide Display
**/
	on('clicked:hide_share', async (event) => {
		handleAbilityShare('hide', '');
	});

/**
**Search Display
**/
	on('clicked:search_share', async (event) => {
		handleAbilityShare('search', '');
	});

/**
**Stand up Display
**/
	on('clicked:standup_share', async (event) => {
		handleAbilityShare('standup', '');
	});

/**
**Use Consumable Display
**/
	on('clicked:consumable_share', async (event) => {
		handleAbilityShare('consumable', '');
	});

/**
**Knockback Power Roll
**/
	on('clicked:knockback_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'knockback_name',
			'knockback_characteristic',
		]);
		handleAbilitySharePowerRoll('knockback', '',attrs.knockback_characteristic, attrs.knockback_name);
	});

/**
**Grab Power Roll
**/
	on('clicked:grab_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'grab_name',
			'grab_characteristic',
		]);
		handleAbilitySharePowerRoll('grab', '',attrs.grab_characteristic, attrs.grab_name);
	});

/**
**Claw Dirt Power Roll
**/
	on('clicked:claw_dirt_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'claw_dirt_name',
			'claw_dirt_characteristic',
		]);
		handleAbilitySharePowerRoll('claw_dirt', '',attrs.claw_dirt_characteristic, attrs.claw_dirt_name);
	});

/**
**Jump Power Roll
**/
	on('clicked:jump_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'jump_name',
			'jump_characteristic',
		]);
		handleAbilitySharePowerRoll('jump', '',attrs.jump_characteristic, attrs.jump_name);
	});

/**
**Climb Other Creature Power Roll
**/
	on('clicked:climb_creature_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync([
			'climb_creature_characteristic',
			'climb_creature_name', 
		]);
		handleAbilitySharePowerRoll('climb_creature', '',attrs.climb_creature_characteristic,attrs.climb_creature_name);
	});

/** 
** Event Listeners
**/
	
// Characteristic Power Rolls
	$20('.npc-characteristic-input-group > label').on('click', (e) => {
		const characteristic = e.htmlAttributes['data-characteristic'];
		rollPower(characteristic);
	});
	
	$20('.characteristic-input-group > label').on('click', (e) => {
		const characteristic = e.htmlAttributes['data-characteristic'];
		rollPower(characteristic);
	});
	
	
// Share Player Repeated Ability
	on('clicked:repeating_abilities:share', async (event) => {
		handleAbilityShare('repeating_abilities','ability');
	});

// Repeated Ability power roll
	on('clicked:repeating_abilities:power-roll-share', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_abilities_ability_characteristic',
			'repeating_abilities_ability_name', 
		]);
		handleAbilitySharePowerRoll('repeating_abilities','ability',attrs.repeating_abilities_ability_characteristic,attrs.repeating_abilities_ability_name);
	});

// Share Monster Repeated Abilities
	on('clicked:repeating_npcabilities:share', async (event) => {
		handleAbilityShare('repeating_npcabilities', 'ability');
	});
	
//Melee Free Strike Display
	on('clicked:melee_share', async (event) => {
		handleAbilityShare('melee_free_strike', '');
	});
	
// Melee Free Strike Power Roll

	on('clicked:melee_power_roll_share', async (event) => {
	  	const attrs = await getAttrsAsync(['melee_free_strike_characteristic','melee_free_strike_name']);
		handleAbilitySharePowerRoll('melee_free_strike', '',attrs.melee_free_strike_characteristic, attrs.melee_free_strike_name);
	});

// Ranged Free Strike Display
	on('clicked:ranged_share', async (event) => {
		handleAbilityShare('ranged_free_strike', ''); 
	});

// Ranged Free Strike Power Roll
	on('clicked:ranged_power_roll_share', async (event) => {
		const attrs = await getAttrsAsync(['ranged_free_strike_characteristic','ranged_free_strike_name']);
		handleAbilitySharePowerRoll('ranged_free_strike', '',attrs.ranged_free_strike_characteristic, attrs.ranged_free_strike_name);
	});

// Share Class Features
	on('clicked:repeating_classfeatures:classfeatureshare', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_classfeatures_classfeature_name',
			'repeating_classfeatures_classfeature_description',
		]);
		const subtitle = getTranslationByKey('class-features');
		featureDisplay(attrs.repeating_classfeatures_classfeature_name, subtitle, attrs.repeating_classfeatures_classfeature_description);
	});

// Share Ancestry Features
	on('clicked:repeating_ancestrytraits:ancfeatureshare', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_ancestrytraits_ancestrytrait_name',
			'repeating_ancestrytraits_ancestrytrait_description',
		]);
		const subtitle = getTranslationByKey('ancestry-traits');
		featureDisplay(attrs.repeating_ancestrytraits_ancestrytrait_name, subtitle, attrs.repeating_ancestrytraits_ancestrytrait_description);
	});

// Share Perk Features
	on('clicked:repeating_perks:perkfeatureshare', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_perks_perk_name',
			'repeating_perks_perk_description',
		]);
		const subtitle = getTranslationByKey('perks');
		featureDisplay(attrs.repeating_perks_perk_name, subtitle,attrs.repeating_perks_perk_description);
	
	});

// Share Title Features 
	on('clicked:repeating_titles:titlefeatureshare', async (event) => {
		const attrs = await getAttrsAsync([
			'repeating_titles_title_name',
			'repeating_titles_title_description',
		]);
		const subtitle = getTranslationByKey('titles');
		featureDisplay(attrs.repeating_titles_title_name, subtitle, attrs.repeating_titles_title_description);
	});

// Looking for Power Roll for Ability Card
	on("change:repeating_abilities:has_power_roll", function(event) {
		const repeatingId = event.sourceAttribute.match(/repeating_abilities_[^_]+/)[0];
		const sourceAttr = `${repeatingId}_has_power_roll`;
		const targetAttr = `${repeatingId}_show_power_roll`;
		getAttrs([sourceAttr], function(values) {
			const show = values[sourceAttr] === "on" ? "1" : "0";
			setAttrs({
				[targetAttr]: show
			});
		});
	});

// Winded Calculation
	on("change:stamina_max sheet:opened", function() {  
		getAttrs(["stamina_max"], function(values) {
			let staminaMax = parseInt(values.stamina_max)||0;
			let winded = Math.floor(staminaMax/2);
			let dead = winded * -1;
			setAttrs({                            
				"stamina_winded": winded,
				"stamina_dead": dead,			
			});
		});
	});

// Surge Calculation
	on("change:might change:agility change:reason change:intuition change:presence sheet:opened", function() {
		getAttrs(["might", "agility", "reason", "intuition", "presence"], function(attrs) {
			let highest = 0;
			for(const val of Object.values(attrs)) {
				const num = parseInt(val) || 0;
				highest = Math.max(highest, num);
			}
			setAttrs({
				"surge_damage": highest,
			});
		});
	});

/**
** Import from Forge Steel Start
**/
	
	/**
	 * Processes a feature to unpack its children if it's a container type.
	 * @param {object} feature The feature to process.
	 * @param {number} level The character's level.
	 * @returns {Array<object>|null} An array of child features, or null if it's not a container.
	 */
	function unpackFeature(feature, level) {
		switch (feature.type) {
			case 'Choice':
				return feature.data.selected;
			case 'Domain':
				// A domain provides both a "DomainChoice" feature and its level-based features.
				const selectedDomains = feature.data.selected;
				const domainChoices = selectedDomains.map(d => ({ ...d, type: 'DomainChoice' }));
				const domainFeatures = selectedDomains
					.flatMap(d => d.featuresByLevel)
					.filter(fbl => fbl.level <= level)
					.flatMap(fbl => fbl.features);
				return [...domainChoices, ...domainFeatures];
			case 'Kit':
				// A kit provides a "KitStats" object and its specific features.
				return feature.data.selected.flatMap(kit => [
					{ ...kit, type: 'KitStats', features: undefined }, // Main stats object
					...kit.features, // Individual features from the kit
				]);
			case 'Multiple Features':
				return feature.data.features;
			default:
				// This is not a container feature that needs unpacking.
				return null;
		}
	}

	/**
	 * Iteratively flattens a nested array of features into a single-level array.
	 * This is more robust than recursion as it avoids stack overflow errors.
	 * @param {Array<object>} initialFeatures The initial array of features.
	 * @param {number} level The character's level, for filtering level-dependent features.
	 * @returns {Array<object>} A new, flattened array of all active features.
	 */
	function getFeatures(forgesteelData) {
		const { ancestry, career, class: characterClass, culture, features: rootFeatures } = forgesteelData;
		const level = characterClass.level;

		// Helper to extract features that are filtered by level.
		const getFeaturesByLevel = (featureList) => featureList
			.filter(item => item.level <= level)
			.flatMap(item => item.features);

		// 1. Collect all features from various sources into one initial list.
		const initialFeatures = [
			...rootFeatures,
			...ancestry.features,
			...career.features,
			...getFeaturesByLevel(characterClass.featuresByLevel),
			...characterClass.subclasses
				.filter(sc => sc.selected)
				.flatMap(sc => getFeaturesByLevel(sc.featuresByLevel)),
			culture.environment,
			culture.organization,
			culture.upbringing,
		].filter(Boolean); // Filter out any null or undefined entries.

		// 2. Iteratively process the features to flatten them.
		const flattenedFeatures = [];
		const queue = [...initialFeatures]; // A work-list of features to process.

		while (queue.length > 0) {
			const currentFeature = queue.shift(); // Get the next feature to process.
			const children = unpackFeature(currentFeature, level);

			if (children) {
				// If it was a container, add its children to the front of the queue to be processed next.
				queue.unshift(...children);
			} else {
				// If it was a simple feature, add it to our final list.
				flattenedFeatures.push(currentFeature);
			}
		}

		return flattenedFeatures;
	}
	/**
	 * Removes all rows from a given repeating section.
	 * @param {string} sectionName The name of the section (e.g., 'abilities', 'modifiers').
	 */
	async function clearRepeatingSection(sectionName) {
		try {
			const rowIDs = await getSectionIDsAsync(sectionName);
			// Create an array of promises for each row removal.
			const removalPromises = rowIDs.map(id => 
				removeRepeatingRow(`repeating_${sectionName}_${id}`)
			);
			// Execute all removals concurrently.
			await Promise.all(removalPromises);
		} catch (error) {
			console.error(`Failed to clear repeating section "${sectionName}":`, error);
		}
	}
	
	// Configuration mapping ability usage types to sheet section details.
	const ABILITY_TYPE_MAP = {
		'Main Action':      { section: 'abilities',    prefix: 'ability',   type: 'main-action' },
		'Triggered Action': { section: 'triggered',    prefix: 'triggered', type: 'triggered-action' },
		'Maneuver':         { section: 'maneuvers',    prefix: 'maneuver',  type: 'maneuver' },
		'Move Action':      { section: 'moves',        prefix: 'move',      type: 'moves' },
		'Villain Action':   { section: 'npcabilities', prefix: 'ability',   type: 'no-action' },
		'default':          { section: 'noaction',     prefix: 'noaction',  type: 'no-action' },
	};

	/**
	 * Processes ability data into a flat object for setting repeating section attributes.
	 * @param {object} abilityData The JSON object for a single ability.
	 * @returns {object} An object of attribute keys and values for setAttrs.
	 */
	function processAbility(abilityData) {
		// 1. Determine ability type and get configuration.
		const usage = abilityData.type.usage;
		const config = ABILITY_TYPE_MAP[usage] || ABILITY_TYPE_MAP.default;
		const id = generateRowID();

		// 2. Extract and format primary data fields.
		const distanceInfo = abilityData.distance?.[0];
		const distance = distanceInfo ? `${distanceInfo.type} ${distanceInfo.value || ''}`.trim() : '';

		const effect = abilityData.sections
			.filter(s => s.type === 'text' || s.type === 'field')
			.map(s => s.name ? `${s.name} ${s.value}: ${s.effect}` : s.text)
			.join('\n');

		// 3. Handle the conditional power roll section.
		const powerRollSection = abilityData.sections.find(s => s.type === 'roll');
		
		// 4. Assemble the final attribute object.
		const attributes = {
			[`repeating_${config.section}_${id}_${config.prefix}_name`]: abilityData.name,
			[`repeating_${config.section}_${id}_${config.prefix}_description`]: abilityData.description,
			[`repeating_${config.section}_${id}_${config.prefix}_type`]: config.type,
			[`repeating_${config.section}_${id}_${config.prefix}_keywords`]: abilityData.keywords.join(', '),
			[`repeating_${config.section}_${id}_${config.prefix}_trigger`]: abilityData.type.trigger ?? '',
			[`repeating_${config.section}_${id}_${config.prefix}_distance`]: distance,
			[`repeating_${config.section}_${id}_${config.prefix}_target`]: abilityData.target,
			[`repeating_${config.section}_${id}_${config.prefix}_cost`]: parseInt(abilityData.cost, 10) || 0,
			[`repeating_${config.section}_${id}_${config.prefix}_effect`]: effect,
			[`repeating_${config.section}_${id}_has_power_roll`]: powerRollSection ? 'on' : 0,
		};
		
		if (powerRollSection) {
			Object.assign(attributes, {
				[`repeating_${config.section}_${id}_${config.prefix}_characteristic`]: powerRollSection.roll.characteristic[0].toLowerCase(),
				[`repeating_${config.section}_${id}_${config.prefix}_tier_1`]: powerRollSection.roll.tier1,
				[`repeating_${config.section}_${id}_${config.prefix}_tier_2`]: powerRollSection.roll.tier2,
				[`repeating_${config.section}_${id}_${config.prefix}_tier_3`]: powerRollSection.roll.tier3,
			});
		}

		return attributes;
	}
		
	/**
	* Extracts Class abilities from the import data.
	* Constructs a list of ability ids and the pulls them from the full list in the import data.
	*
	* @param {Array<Object>} forgesteelData - The import data object.
	* @param <String>  abilityIds - The ability id to look for. 
	* @returns {Array<Object>} The ability data for the found ability.
	*/
	function extractClassAbility(forgesteelData, abilityId) {
		const ability = forgesteelData.class.abilities.find(x => x.id === abilityId);
		console.log(`Found Ability ${abilityId}`, ability);
		return ability;
	}	
	
	/**
	 * A collection of constant values used for filtering and identifying feature types.
	 * This prevents typos and centralizes key strings for easy updates.
	 */
	const FEATURE_TYPES = {
		BONUS: 'Bonus',
		KIT_STATS: 'KitStats',
		SIZE: 'Size',
		DOMAIN_CHOICE: 'DomainChoice',
		SPEED: 'Speed',
		DAMAGE_MODIFIER: 'Damage Modifier',
		HEROIC_RESOURCE: 'Heroic Resource',
		SKILL_CHOICE: 'Skill Choice',
		LANGUAGE_CHOICE: 'Language Choice',
		PERK: 'Perk',
		TEXT: 'Text',
		ABILITY: 'Ability',
		CLASS_ABILITY: 'Class Ability',
	};

	/**
	 * A list of all possible damage types in the system.
	 */
	const DAMAGE_TYPES = [
		'Acid', 'Cold', 'Corruption', 'Fire', 'Holy', 'Lightning',
		'Poison', 'Psychic', 'Sonic',
	];

	/**
	 * An object grouping skill names by their respective categories.
	 */
	const SKILL_GROUPS = {
		crafting: ['Alchemy', 'Architecture', 'Blacksmithing', 'Carpentry', 'Cooking', 'Fletching', 'Forgery', 'Jewelry', 'Mechanics', 'Tailoring'],
		exploration: ['Climb', 'Drive', 'Endurance', 'Gymnastics', 'Heal', 'Jump', 'Lift', 'Navigate', 'Ride', 'Swim'],
		interpersonal: ['Brag', 'Empathize', 'Flirt', 'Gamble', 'Handle Animals', 'Interrogate', 'Intimidate', 'Lead', 'Lie', 'Music', 'Perform', 'Persuade', 'Read Person'],
		intrigue: ['Alertness', 'Conceal Object', 'Disguise', 'Eavesdrop', 'Escape Artist', 'Hide', 'Pick Lock', 'Pick Pocket', 'Sabotage', 'Search', 'Sneak', 'Track'],
		lore: ['Criminal Underworld', 'Culture', 'History', 'Magic', 'Monsters', 'Nature', 'Psionics', 'Religion', 'Rumors', 'Society', 'Strategy', 'Timescape'],
	};

	/**
	 * Calculates a combat statistic (like speed, disengage, stability) by summing its
	 * base value, bonuses from features, and the maximum value from equipped kits.
	 * @param {Array<Object>} features - The character's list of features.
	 * @param {string} statName - The name of the stat to calculate (e.g., 'Speed').
	 * @param {number} baseValue - The starting base value for the stat.
	 * @returns {number} The calculated total for the combat statistic.
	 */
	const calculateCombatStat = (features, statName, baseValue = 0) => {
		// Sum bonuses from features of type 'Bonus' that match the stat name.
		const bonusFromFeatures = features
			.filter(f => f.type === FEATURE_TYPES.BONUS && f.data.field === statName)
			.reduce((sum, f) => sum + f.data.field.value, 0);

		// Find the highest bonus from all equipped kits for this stat.
		const bonusFromKits = Math.max(
			0, // Ensures we don't get -Infinity if there are no kits.
			...features
				.filter(f => f.type === FEATURE_TYPES.KIT_STATS)
				.map(f => f[statName.toLowerCase()] || 0)
		);

		return baseValue + bonusFromFeatures + bonusFromKits;
	};

	/**
	 * Generates a comma-separated string of damage resistances or weaknesses.
	 * @param {Array<Object>} features - The character's list of features.
	 * @param {number} level - The character's current level.
	 * @param {string} modifierType - The type of modifier to look for ('Immunity' or 'Weakness').
	 * @returns {string} A formatted string of damage modifiers (e.g., "Fire 5, Cold 2").
	 */
	const getDamageModifiers = (features, level, modifierType) => {
		const damageModifiers = features
			.filter(f => f.type === FEATURE_TYPES.DAMAGE_MODIFIER)
			.flatMap(f => f.data.modifiers);

		return DAMAGE_TYPES
			.map(damageType => {
				const amount = damageModifiers
					.filter(m => m.damageType === damageType && m.type === modifierType)
					.reduce((sum, m) => sum + (m.value + ((level - 1) * m.valuePerLevel)), 0);
				return { damageType, amount };
			})
			.filter(({ amount }) => amount > 0) // Only include modifiers with a value.
			.map(({ damageType, amount }) => `${damageType} ${amount}`)
			.join(', ');
	};

	/**
	 * Extracts and joins selected skills from a specific skill group.
	 * @param {Array<Object>} features - The character's list of features.
	 * @param {Array<string>} skillGroup - An array of skill names to filter by.
	 * @returns {string} A comma-separated string of the selected skills in that group.
	 */
	const getSkillsByGroup = (features, skillGroup) => {
		return features
			.filter(f => f.type === FEATURE_TYPES.SKILL_CHOICE)
			.flatMap(f => f.data.selected)
			.filter(skill => skillGroup.includes(skill))
			.join(', ');
	};


	// --- Main Event Listener ---

	on('clicked:import', async () => {
		try {
			// 1. DATA RETRIEVAL & PARSING
			// ---------------------------
			// Get the raw JSON string from the character sheet attributes.
			const { forgesteel_json } = await getAttrsAsync(['forgesteel_json']);
			if (!forgesteel_json) {
				console.warn('Import data is empty. Aborting.');
				return;
			}

			const data = JSON.parse(forgesteel_json);
			const {
				name: character_name,
				ancestry,
				class: characterClass, 
				career,
				state,
				culture,
				complication,
			} = data;
			
			// Collate all features from different sources into one array for easier processing.
			const allFeatures = getFeatures(data);
			const level = characterClass.level;


			// 2. CORE CHARACTER INFORMATION
			// -----------------------------
			const subclass = [
				...characterClass.subclasses.filter(sc => sc.selected).map(sc => sc.name),
				...allFeatures.filter(f => f.type === FEATURE_TYPES.DOMAIN_CHOICE).map(f => f.name),
			].join(', ');
			
			// Primary characteristics (attributes).
			const characteristics = characterClass.characteristics;
			const findCharacteristic = (name) => characteristics.find(c => c.characteristic === name)?.value || 0;
			const might = findCharacteristic('Might');
			const agility = findCharacteristic('Agility');
			const reason = findCharacteristic('Reason');
			const intuition = findCharacteristic('Intuition');
			const presence = findCharacteristic('Presence');


			// 3. DERIVED & COMBAT STATISTICS
			// ------------------------------
			const potency_strong = Math.max(might, agility, reason, intuition, presence);
			
			const sizeObject = allFeatures.find(f => f.type === FEATURE_TYPES.SIZE)?.data.size ?? { value: 1, mod: 'M' };
			const size = `${sizeObject.value}${sizeObject.mod ?? ''}`;
			
			const baseSpeed = allFeatures.find(f => f.type === FEATURE_TYPES.SPEED)?.data.speed ?? 5;
			const speed = calculateCombatStat(allFeatures, 'Speed', baseSpeed);
			const disengage = calculateCombatStat(allFeatures, 'Disengage', 1);
			const stability = calculateCombatStat(allFeatures, 'Stability', 0);

			const stamina_max = allFeatures
				.filter(f => f.type === FEATURE_TYPES.BONUS && f.data.field === 'Stamina')
				.reduce((sum, f) => sum + (f.data.value + ((level - 1) * f.data.valuePerLevel)), 0);

			const recoveries_max = allFeatures
				.filter(f => f.type === FEATURE_TYPES.BONUS && f.data.field === 'Recoveries')
				.reduce((sum, f) => sum + f.data.value, 0);
				
			const immunity = getDamageModifiers(allFeatures, level, 'Immunity');
			const weakness = getDamageModifiers(allFeatures, level, 'Weakness');
			const resource_name = allFeatures.find(f => f.type === FEATURE_TYPES.HEROIC_RESOURCE)?.name ?? '';


			// 4. BIOGRAPHICAL INFORMATION
			// ---------------------------
			const incidentOption = career.incitingIncidents.options
				.find(opt => opt.id === career.incitingIncidents.selectedID);
			const career_incident = incidentOption ? `${incidentOption.name}\n${incidentOption.description}` : '';


			// 5. SKILLS & LANGUAGES
			// ---------------------
			const skills_crafting = getSkillsByGroup(allFeatures, SKILL_GROUPS.crafting);
			const skills_exploration = getSkillsByGroup(allFeatures, SKILL_GROUPS.exploration);
			const skills_interpersonal = getSkillsByGroup(allFeatures, SKILL_GROUPS.interpersonal);
			const skills_intrigue = getSkillsByGroup(allFeatures, SKILL_GROUPS.intrigue);
			const skills_lore = getSkillsByGroup(allFeatures, SKILL_GROUPS.lore);

			const languages = [
				...culture.languages,
				...allFeatures.filter(f => f.type === FEATURE_TYPES.LANGUAGE_CHOICE).flatMap(f => f.data.selected),
			].join(', ');


			// 6. REPEATING SECTIONS (Kits, Perks, Abilities, etc.)
			// ----------------------------------------------------
			// Process kits into a format suitable for setAttrs.
			const kits = allFeatures
				.filter(f => f.type === FEATURE_TYPES.KIT_STATS)
				.reduce((acc, kit) => {
					const id = generateRowID();
					acc[`repeating_modifiers_${id}_modifier_name`] = kit.name;
					acc[`repeating_modifiers_${id}_modifier_type`] = 'kit';
					acc[`repeating_modifiers_${id}_kit_weapon`] = kit.weapon.join(', ');
					acc[`repeating_modifiers_${id}_kit_armor`] = kit.armor.join(', ');
					// ... add other kit properties similarly ...
					acc[`repeating_modifiers_${id}_modifier_description`] = kit.description;
					return acc;
				}, {});

			// Process perks, ancestry traits, features, and abilities.
			const perks = allFeatures
				.filter(f => f.type === FEATURE_TYPES.PERK)
				.reduce((acc, f) => { /* ... perk processing logic ... */ return acc; }, {});
				
			const ancestryFeatures = ancestry.features
				.filter(f => f.description)
				.reduce((acc, f) => {
					const id = generateRowID();
					acc[`repeating_ancestrytraits_${id}_ancestrytrait_name`] = f.name;
					acc[`repeating_ancestrytraits_${id}_ancestrytrait_description`] = f.description;
					return acc;
				}, {});
				
			const classFeatures = allFeatures
				.filter(f => f.type === FEATURE_TYPES.TEXT)
				.reduce((acc, f) => {
					const id = generateRowID();
					acc[`repeating_classfeatures_${id}_classfeature_name`] = f.name;
					acc[`repeating_classfeatures_${id}_classfeature_description`] = f.description;
					return acc;
				}, {});
				
			const abilityFeatures = allFeatures
				.filter(f => f.type === FEATURE_TYPES.ABILITY)
				.reduce((acc, f) => ({ ...acc, ...processAbility(f.data.ability) }), {});
				
			const classAbilities = allFeatures
				.filter(f => f.type === FEATURE_TYPES.CLASS_ABILITY)
				.flatMap(f => f.data.selectedIDs)
				.reduce((acc, id) => {
					const abilityData = extractClassAbility(data, id);
					return { ...acc, ...processAbility(abilityData) };
				}, {});


			// 7. FINAL ASSEMBLY & ATTRIBUTE SETTING
			// -------------------------------------
			// Consolidate all processed data into a single object for setAttrs.
			const newAttrs = {
				forgesteel_json: '', // Clear the import field.
				// Core Info
				character_name,
				ancestry: ancestry.name,
				class: characterClass.name,
				career: career.name,
				subclass,
				victories: state.victories,
				level,
				wealth: state.wealth,
				renown: state.renown,
				experience: state.xp,
				// Characteristics
				might,
				agility,
				reason,
				intuition,
				presence,
				// Derived Stats
				potency_strong,
				potency_average: potency_strong - 1,
				potency_weak: potency_strong - 2,
				size,
				speed,
				disengage,
				stability,
				stamina_max,
				stamina_winded: Math.floor(stamina_max / 2),
				stamina_dead: -Math.floor(stamina_max / 2),
				recoveries_max,
				recovery_amount: Math.floor(stamina_max / 3),
				immunity,
				weakness,
				resource_name,
				surge_damage: potency_strong,
				// Biography
				career_incident,
				complication: complication?.name ?? '',
				complication_benefit: complication?.features[0]?.description ?? '',
				complication_drawback: complication?.features[1]?.description ?? '',
				culture_environment: culture.environment.name,
				culture_environment_description: culture.environment.description,
				culture_organization: culture.organization.name,
				culture_organization_description: culture.organization.description,
				culture_upbringing: culture.upbringing.name,
				culture_upbringing_description: culture.upbringing.description,
				// Skills & Languages
				skills_crafting,
				skills_exploration,
				skills_interpersonal,
				skills_intrigue,
				skills_lore,
				languages,
				// Spread in repeating section data
				...kits,
				...perks,
				...ancestryFeatures,
				...classFeatures,
				...abilityFeatures,
				...classAbilities,
			};

			// Clear existing repeating sections before adding new data.
			await Promise.all([
				clearRepeatingSection('modifiers'),
				clearRepeatingSection('perks'),
				clearRepeatingSection('ancestrytraits'),
				clearRepeatingSection('classfeatures'),
				clearRepeatingSection('abilities'),
				clearRepeatingSection('noaction'),
				clearRepeatingSection('maneuvers'),
				clearRepeatingSection('triggered'),
				clearRepeatingSection('moves'),
			]);

			// Set the new attributes on the character sheet.
			await setAttrsAsync(newAttrs);
			
			console.log('Character import successful!', newAttrs);

		} catch (error) {
			console.error("Failed to import character data. Please ensure the JSON is valid.", error);
		}
	});
	
	/* Monster Import */
	on('clicked:importmonster', async () => {
		try {
			// 1. DATA RETRIEVAL & PARSING
			// ---------------------------
			// Get the raw JSON string from the character sheet attributes.
			const { forgesteel_json } = await getAttrsAsync(['forgesteel_json']);
			if (!forgesteel_json) {
				console.warn('Import data is empty. Aborting.');
				return;
			}

			const data = JSON.parse(forgesteel_json);
						
			// 2. CORE MONSTER INFORMATION
			// -----------------------------
			
			// Primary characteristics (attributes).
			const findCharacteristic = (name) => data.characteristics.find(c => c.characteristic === name)?.value || 0;
			const might = findCharacteristic('Might');
			const agility = findCharacteristic('Agility');
			const reason = findCharacteristic('Reason');
			const intuition = findCharacteristic('Intuition');
			const presence = findCharacteristic('Presence');
			
			// Keywords and Role
			const keywords = data.keywords.join(', ');
			const roletype = data.role.type === 'No Role' ? '' : ` ${data.role.type}`;
			const role = `${data.role.organization}${roletype}`;

			// Size, Speed and Movement Types
			const sizeObject = data.size ?? { value: 1, mod: 'M' };
			const size = `${sizeObject.value}${sizeObject.mod ?? ''}`;
			const speed = data.speed.value ?? 5;
			const movement = data.speed.modes.join(', ') ?? '';  
			
			// Stability and Stamina
			const stability = data.stability ?? 0;
			const stamina = data.stamina ?? 0;
			
			// Immunities and Weaknesses
			const immunity = getDamageModifiers(data.features, 1, 'Immunity');
			const weakness = getDamageModifiers(data.features, 1, 'Weakness');
			
			// EV, With Captain, and Free Strike Damage
			const encountervalue = data.encounterValue;
			const withcaptain = data.withCaptain;
			const freestrike = data.freeStrikeDamage;
		
			// 3. REPEATING ABILITIES
			// ----------------------------------------------------
			
			const traits = data.features
				.filter(f => f.type === FEATURE_TYPES.TEXT)
				.reduce((acc, f) => {
					const id = generateRowID();
					if (f.name === 'Solo Monster' || f.name === 'Ajax') {
						const parts = f.description.trim().split('\n');
						
						const firstPart = parts[0].replace('* **', '').split('** ');
						const soloOne = firstPart[0];
						const soloOneText = firstPart[1];

						const secondPart = parts[1].replace('* **', '').split('** ');
						const soloTwo = secondPart[0];
						const soloTwoText = secondPart[1];

						acc[`repeating_npcabilities_${id}_ability_name`] = f.name;
						acc[`repeating_npcabilities_${id}_ability_subtype`] = 'solo-monster';
						acc[`repeating_npcabilities_${id}_ability_solo_1_name`] = soloOne;
						acc[`repeating_npcabilities_${id}_ability_solo_1_text`] = soloOneText;
						acc[`repeating_npcabilities_${id}_ability_solo_2_name`] = soloTwo;
						acc[`repeating_npcabilities_${id}_ability_solo_2_text`] = soloTwoText;
					} else {
						acc[`repeating_npcabilities_${id}_ability_name`] = f.name;
						acc[`repeating_npcabilities_${id}_ability_subtype`] = 'trait';
						acc[`repeating_npcabilities_${id}_ability_trait`] = f.description;
					}
					return acc;
				}, {});
				
			const abilityFeatures = data.features
				.filter(f => f.type === FEATURE_TYPES.ABILITY)
				.reduce((acc, f) => ({ ...acc, ...processMonsterAbility(f.data.ability) }), {});
				


			// 4. FINAL ASSEMBLY & ATTRIBUTE SETTING
			// -------------------------------------
			// Consolidate all processed data into a single object for setAttrs.
			const newAttrs = {
				forgesteel_json: '', // Clear the import field.
				is_npc: 'on',
				
				// Core Info
				character_name: data.name,
				level: data.level,
				npc_role: role,
				npc_keywords: keywords,
				npc_EV: encountervalue,
				// Stats
				size,
				speed,
				stamina,
				stability: stability,
				npc_freestrike: freestrike,
				
				immunity,
				weakness,
				npc_movement: movement,
				npc_with_captain: withcaptain,
				
				might,
				agility,
				reason,
				intuition,
				presence,
				// Spread in repeating section data
				...traits,
				...abilityFeatures,
			};

			// Clear existing repeating sections before adding new data.
			await clearRepeatingSection('npcabilities');
			
			// Set the new attributes on the character sheet.
			await setAttrsAsync(newAttrs);
			
			console.log('Monster import successful!', newAttrs);

		} catch (error) {
			console.error("Failed to import monster data. Please ensure the JSON is valid.", error);
		}
	});

	/**
	 * Processes ability data into a flat object for setting repeating section attributes.
	 * @param {object} abilityData The JSON object for a single ability.
	 * @returns {object} An object of attribute keys and values for setAttrs.
	 */

	function processMonsterAbility(abilityData) {
		// 1. Determine ability type and get configuration.
		const usage = ABILITY_TYPE_MAP[abilityData.type.usage].type;
		const cost = abilityData.cost === 'signature' ? abilityData.cost : parseInt(abilityData.cost) || 0;
		
		let subtype = 'normal-ability';
		if (abilityData.type.usage === 'Villain Action') {
			subtype = 'villain-ability'; 
		} else if (cost === 'signature') {
			subtype = 'signature-ability';
		} else if (cost > 0) {
			subtype = 'malice-ability';
		}
		
		const id = generateRowID();

		// 2. Extract and format primary data fields.
		const distanceInfo = abilityData.distance?.[0];
		const distance = distanceInfo ? `${distanceInfo.type} ${distanceInfo.value || ''}`.trim() : '';
						
		const malice = abilityData.sections.find(s => s.type === 'field' && (s.name === 'Spend' || s.name === 'Malice'));	
			
		const effect = abilityData.sections
			.filter(s => s.type === 'text' && !s.text.startsWith('**Special:**'))
			.map(s => s.name ? `${s.name} ${s.value}: ${s.effect}` : s.text)
			.join('\n');
		
		const special = abilityData.sections.find(s => s.type === 'text' && s.text.startsWith('**Special:**'));
		
		// 3. Handle the conditional power roll section.
		const powerRollSection = abilityData.sections.find(s => s.type === 'roll');
		// 4. Assemble the final attribute object.
		const attributes = {
			[`repeating_npcabilities_${id}_ability_name`]: abilityData.name,
			[`repeating_npcabilities_${id}_ability_description`]: abilityData.description,
			[`repeating_npcabilities_${id}_ability_type`]: usage,
			[`repeating_npcabilities_${id}_ability_subtype`]: subtype,
			[`repeating_npcabilities_${id}_ability_keywords`]: abilityData.keywords.join(', '),
			[`repeating_npcabilities_${id}_ability_trigger`]: abilityData.type.trigger ?? '',
			[`repeating_npcabilities_${id}_ability_distance`]: distance,
			[`repeating_npcabilities_${id}_ability_target`]: abilityData.target,
			[`repeating_npcabilities_${id}_ability_malice_cost`]: cost,
			[`repeating_npcabilities_${id}_has_effect`]: effect ? 'on' : 0,
			[`repeating_npcabilities_${id}_ability_effect`]: effect,
			[`repeating_npcabilities_${id}_has_power_roll`]: powerRollSection ? 'on' : 0,
		};
		
		if (powerRollSection) {
			Object.assign(attributes, {
				[`repeating_npcabilities_${id}_ability_characteristic`]: powerRollSection.roll.bonus,
				[`repeating_npcabilities_${id}_ability_tier_1`]: powerRollSection.roll.tier1,
				[`repeating_npcabilities_${id}_ability_tier_2`]: powerRollSection.roll.tier2,
				[`repeating_npcabilities_${id}_ability_tier_3`]: powerRollSection.roll.tier3,
			});
		}
		
		if (special) {
			Object.assign(attributes, {
				[`repeating_npcabilities_${id}_has_special`]: 'on',
				[`repeating_npcabilities_${id}_ability_special`]: special.text.replace('**Special:** ', ''),
			});
		}
		
		if (malice) {
			Object.assign(attributes, {
				[`repeating_npcabilities_${id}_has_malice`]: 'on',
				[`repeating_npcabilities_${id}_ability_cost`]: malice.value,
				[`repeating_npcabilities_${id}_ability_malice`]: malice.effect,
			});
		}
		
		return attributes;
	}
	
	/**
	** import end
	**/
</script>
